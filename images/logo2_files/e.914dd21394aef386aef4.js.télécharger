(()=>{"use strict";var e,t,s,i,a,n,o,r,h={8132:(e,t,s)=>{s.a(e,(async(e,i)=>{try{s.r(t),s.d(t,{Displacement:()=>n.KL,Gif:()=>n.nt,GifBuffer:()=>n.ZM,Layer:()=>n.mh,Mp4:()=>n.HE,PXD:()=>n.BS,Stroke:()=>n.mP,ZipReader:()=>n.Mr,ZipWriter:()=>n._Q,__wbg_buffer_397eaa4d72ee94dd:()=>n.jp,__wbg_height_28c0c13811abedde:()=>n.mE,__wbg_new_de1f835fd3453d3d:()=>n.MS,__wbg_newwithbyteoffsetandlength_8252bb2eb6e239b2:()=>n.dZ,__wbg_width_5491bf1bf3b1e78a:()=>n.gI,__wbg_x_84616b3462f445c9:()=>n.bi,__wbg_y_3b1c131c2eb62473:()=>n.lK,__wbindgen_memory:()=>n.oH,__wbindgen_object_drop_ref:()=>n.ug,__wbindgen_rethrow:()=>n.nD,__wbindgen_string_new:()=>n.h4,__wbindgen_throw:()=>n.Or,distanceTransform:()=>n.TK,distanceTransformInv:()=>n.Mt});var a=s(2982),n=s(2646),o=e([a,n]);[a,n]=o.then?(await o)():o,i()}catch(r){i(r)}}))},2646:(e,t,s)=>{s.a(e,(async(i,a)=>{try{s.d(t,{BS:()=>z,HE:()=>_,KL:()=>R,MS:()=>Y,Mr:()=>B,Mt:()=>A,Or:()=>K,TK:()=>M,ZM:()=>D,_Q:()=>O,bi:()=>H,dZ:()=>j,gI:()=>$,h4:()=>U,jp:()=>X,lK:()=>q,mE:()=>V,mP:()=>N,mh:()=>F,nD:()=>Q,nt:()=>I,oH:()=>G,ug:()=>W});var n=s(6817),o=s(2982);e=s.hmd(e);var r=i([o]);o=(r.then?(await r)():r)[0];let h=new("undefined"==typeof TextDecoder?(0,e.require)("util").TextDecoder:TextDecoder)("utf-8",{ignoreBOM:!0,fatal:!0});h.decode();let l=null;function c(){return null!==l&&l.buffer===o.memory.buffer||(l=new Uint8Array(o.memory.buffer)),l}function d(e,t){return h.decode(c().subarray(e,e+t))}const u=new Array(32).fill(void 0);u.push(void 0,null,!0,!1);let p=u.length;function g(e){p===u.length&&u.push(u.length+1);const t=p;return p=u[t],u[t]=e,t}function m(e){return u[e]}function v(e){e<36||(u[e]=p,p=e)}function f(e){const t=m(e);return v(e),t}let y=0;let w=new("undefined"==typeof TextEncoder?(0,e.require)("util").TextEncoder:TextEncoder)("utf-8");const b="function"==typeof w.encodeInto?function(e,t){return w.encodeInto(e,t)}:function(e,t){const s=w.encode(e);return t.set(s),{read:e.length,written:s.length}};function x(e,t,s){if(void 0===s){const s=w.encode(e),i=t(s.length);return c().subarray(i,i+s.length).set(s),y=s.length,i}let i=e.length,a=t(i);const n=c();let o=0;for(;o<i;o++){const t=e.charCodeAt(o);if(t>127)break;n[a+o]=t}if(o!==i){0!==o&&(e=e.slice(o)),a=s(a,i,i=o+3*e.length);const t=c().subarray(a+o,a+i);o+=b(e,t).written}return y=o,a}function Z(e,t){const s=t(1*e.length);return c().set(e,s/1),y=e.length,s}let k=null;function P(){return null!==k&&k.buffer===o.memory.buffer||(k=new Int32Array(o.memory.buffer)),k}function E(e,t){return c().subarray(e/1,e/1+t)}let S=null;function T(e,t){return(null!==S&&S.buffer===o.memory.buffer||(S=new Uint8ClampedArray(o.memory.buffer)),S).subarray(e/1,e/1+t)}let C=null;function L(e,t){return(null!==C&&C.buffer===o.memory.buffer||(C=new Float32Array(o.memory.buffer)),C).subarray(e/4,e/4+t)}function M(e,t,s){try{const l=o.__wbindgen_add_to_stack_pointer(-16);var i=Z(s,o.__wbindgen_malloc),a=y;o.distanceTransform(l,e,t,i,a);var n=P()[l/4+0],r=P()[l/4+1],h=L(n,r).slice();return o.__wbindgen_free(n,4*r),h}finally{o.__wbindgen_add_to_stack_pointer(16)}}function A(e,t,s){try{const l=o.__wbindgen_add_to_stack_pointer(-16);var i=Z(s,o.__wbindgen_malloc),a=y;o.distanceTransformInv(l,e,t,i,a);var n=P()[l/4+0],r=P()[l/4+1],h=L(n,r).slice();return o.__wbindgen_free(n,4*r),h}finally{o.__wbindgen_add_to_stack_pointer(16)}}class R{static __wrap(e){const t=Object.create(R.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();o.__wbg_displacement_free(e)}constructor(e,t,s,i,a,n){var r=Z(e,o.__wbindgen_malloc),h=y,l=o.displacement_new(r,h,t,s,i,a,n);return R.__wrap(l)}beginStroke(){var e=o.displacement_beginStroke(this.ptr);return N.__wrap(e)}setStampSize(e){o.displacement_setStampSize(this.ptr,e)}setDensity(e){o.displacement_setDensity(this.ptr,e)}setStrength(e){o.displacement_setStrength(this.ptr,e)}retarget(e,t,s){var i=Z(e,o.__wbindgen_malloc),a=y;o.displacement_retarget(this.ptr,i,a,t,s)}setMode(e){var t=x(e,o.__wbindgen_malloc,o.__wbindgen_realloc),s=y;o.displacement_setMode(this.ptr,t,s)}applyFast(e){return f(o.displacement_applyFast(this.ptr,g(e)))}applyQuality(e){return f(o.displacement_applyQuality(this.ptr,g(e)))}}class I{static __wrap(e){const t=Object.create(I.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();o.__wbg_gif_free(e)}constructor(e,t,s){var i=o.gif_new(e,t,s);return I.__wrap(i)}addFrame(e,t,s){var i=Z(e,o.__wbindgen_malloc),a=y;o.gif_addFrame(this.ptr,i,a,t,s)}takeResult(){try{const i=this.__destroy_into_raw(),a=o.__wbindgen_add_to_stack_pointer(-16);o.gif_takeResult(a,i);var e=P()[a/4+0],t=P()[a/4+1],s=T(e,t).slice();return o.__wbindgen_free(e,1*t),s}finally{o.__wbindgen_add_to_stack_pointer(16)}}}class D{__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();o.__wbg_gifbuffer_free(e)}}class F{static __wrap(e){const t=Object.create(F.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();o.__wbg_layer_free(e)}get kind(){try{const s=o.__wbindgen_add_to_stack_pointer(-16);o.layer_kind(s,this.ptr);var e=P()[s/4+0],t=P()[s/4+1];return d(e,t)}finally{o.__wbindgen_add_to_stack_pointer(16),o.__wbindgen_free(e,t)}}get x(){return o.layer_x(this.ptr)}get y(){return o.layer_y(this.ptr)}get name(){try{const s=o.__wbindgen_add_to_stack_pointer(-16);o.layer_name(s,this.ptr);var e=P()[s/4+0],t=P()[s/4+1];return d(e,t)}finally{o.__wbindgen_add_to_stack_pointer(16),o.__wbindgen_free(e,t)}}get width(){return o.layer_width(this.ptr)}get height(){return o.layer_height(this.ptr)}get alpha(){return o.layer_alpha(this.ptr)}get blendMode(){try{const s=o.__wbindgen_add_to_stack_pointer(-16);o.layer_blendMode(s,this.ptr);var e=P()[s/4+0],t=P()[s/4+1];return d(e,t)}finally{o.__wbindgen_add_to_stack_pointer(16),o.__wbindgen_free(e,t)}}get visible(){return 0!==o.layer_visible(this.ptr)}get locked(){return 0!==o.layer_locked(this.ptr)}get rotation(){return o.layer_rotation(this.ptr)}takeCanvas(){try{const i=o.__wbindgen_add_to_stack_pointer(-16);o.layer_takeCanvas(i,this.ptr);var e=P()[i/4+0],t=P()[i/4+1],s=T(e,t).slice();return o.__wbindgen_free(e,1*t),s}finally{o.__wbindgen_add_to_stack_pointer(16)}}takeMask(){try{const i=o.__wbindgen_add_to_stack_pointer(-16);o.layer_takeMask(i,this.ptr);var e=P()[i/4+0],t=P()[i/4+1],s=T(e,t).slice();return o.__wbindgen_free(e,1*t),s}finally{o.__wbindgen_add_to_stack_pointer(16)}}get meta(){try{const s=o.__wbindgen_add_to_stack_pointer(-16);o.layer_meta(s,this.ptr);var e=P()[s/4+0],t=P()[s/4+1];return d(e,t)}finally{o.__wbindgen_add_to_stack_pointer(16),o.__wbindgen_free(e,t)}}}class _{static __wrap(e){const t=Object.create(_.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();o.__wbg_mp4_free(e)}constructor(e){var t=o.mp4_new(e);return _.__wrap(t)}addVideoTrack(e,t,s){var i=Z(s,o.__wbindgen_malloc),a=y;return o.mp4_addVideoTrack(this.ptr,e,t,i,a)>>>0}addFrame(e,t,s,i,a,n){var r=Z(n,o.__wbindgen_malloc),h=y;o.mp4_addFrame(this.ptr,e,t,s,i,a,r,h)}fetchFile(){try{const i=this.__destroy_into_raw(),a=o.__wbindgen_add_to_stack_pointer(-16);o.mp4_fetchFile(a,i);var e=P()[a/4+0],t=P()[a/4+1],s=E(e,t).slice();return o.__wbindgen_free(e,1*t),s}finally{o.__wbindgen_add_to_stack_pointer(16)}}}class z{static __wrap(e){const t=Object.create(z.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();o.__wbg_pxd_free(e)}get width(){return o.__wbg_get_pxd_width(this.ptr)}set width(e){o.__wbg_set_pxd_width(this.ptr,e)}get height(){return o.__wbg_get_pxd_height(this.ptr)}set height(e){o.__wbg_set_pxd_height(this.ptr,e)}get layers(){return o.__wbg_get_pxd_layers(this.ptr)}set layers(e){o.__wbg_set_pxd_layers(this.ptr,e)}static decode(e){var t=Z(e,o.__wbindgen_malloc),s=y,i=o.pxd_decode(t,s);return z.__wrap(i)}takeNextLayer(){var e=o.pxd_takeNextLayer(this.ptr);return F.__wrap(e)}}class N{static __wrap(e){const t=Object.create(N.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();o.__wbg_stroke_free(e)}push(e,t,s){return f(o.stroke_push(this.ptr,e,t,s))}}class B{static __wrap(e){const t=Object.create(B.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();o.__wbg_zipreader_free(e)}constructor(e){var t=Z(e,o.__wbindgen_malloc),s=y,i=o.zipreader_new(t,s);return B.__wrap(i)}readFile(e){try{const r=o.__wbindgen_add_to_stack_pointer(-16);var t=x(e,o.__wbindgen_malloc,o.__wbindgen_realloc),s=y;o.zipreader_readFile(r,this.ptr,t,s);var i=P()[r/4+0],a=P()[r/4+1],n=E(i,a).slice();return o.__wbindgen_free(i,1*a),n}finally{o.__wbindgen_add_to_stack_pointer(16)}}readString(e){try{const n=o.__wbindgen_add_to_stack_pointer(-16);var t=x(e,o.__wbindgen_malloc,o.__wbindgen_realloc),s=y;o.zipreader_readString(n,this.ptr,t,s);var i=P()[n/4+0],a=P()[n/4+1];return d(i,a)}finally{o.__wbindgen_add_to_stack_pointer(16),o.__wbindgen_free(i,a)}}}class O{static __wrap(e){const t=Object.create(O.prototype);return t.ptr=e,t}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();o.__wbg_zipwriter_free(e)}constructor(){var e=o.zipwriter_new();return O.__wrap(e)}writeFile(e,t,s){var i=x(e,o.__wbindgen_malloc,o.__wbindgen_realloc),a=y,n=Z(t,o.__wbindgen_malloc),r=y;o.zipwriter_writeFile(this.ptr,i,a,n,r,s)}writeString(e,t,s){var i=x(e,o.__wbindgen_malloc,o.__wbindgen_realloc),a=y,n=x(t,o.__wbindgen_malloc,o.__wbindgen_realloc),r=y;o.zipwriter_writeString(this.ptr,i,a,n,r,s)}finish(){try{const i=this.__destroy_into_raw(),a=o.__wbindgen_add_to_stack_pointer(-16);o.zipwriter_finish(a,i);var e=P()[a/4+0],t=P()[a/4+1],s=E(e,t).slice();return o.__wbindgen_free(e,1*t),s}finally{o.__wbindgen_add_to_stack_pointer(16)}}}function U(e,t){return g(d(e,t))}function H(e){return m(e).x}function q(e){return m(e).y}function $(e){return m(e).width}function V(e){return m(e).height}function G(){return g(o.memory)}function X(e){return g(m(e).buffer)}function j(e,t,s){return g(new Uint8ClampedArray(m(e),t>>>0,s>>>0))}function W(e){f(e)}function Y(e,t,s,i){return g(new n.Z(e,t,s,i))}function K(e,t){throw new Error(d(e,t))}function Q(e){throw f(e)}a()}catch(h){a(h)}}))},1030:(e,t,s)=>{s.d(t,{Z:()=>a});var i=s(4820);const a=(e,t)=>{if("undefined"==typeof ga||"function"!=typeof ga.getAll||void 0===ga.getAll()[0])return;const s=ga.getAll()[0].get("name");ga(`${s}.send`,{hitType:"event",eventCategory:(i.ZP.user&&"guest"!==i.ZP.user.name?i.ZP.user.subscription?"Premium":"User":"Guest")+":"+i.ZP.product,eventAction:e,eventLabel:t})}},2396:(e,t,s)=>{s.d(t,{Z:()=>n});var i=s(3990),a=s(7318);class n{constructor(e=!1,t,s,i,a){this.block=e,this.enter=t,this.scene=s,this.exit=i,this.stagger=a}}n.fromInjection=(e,t)=>{let s=t?n.clone(t):new n;if(s.block=!1,!e)return s;if(e.enter&&(s.enter&&(e.enter.delay=s.enter.delay,e.enter.speed=s.enter.speed),s.enter=e.enter,s.enter.duration=s.enter.duration?s.enter.duration:n.getMotionsDuration(s.enter.motions)),e.scene&&(s.scene&&(e.scene.delay=s.scene.delay,e.scene.speed=s.scene.speed,e.scene.repeat=s.scene.repeat,e.scene.gap=s.scene.gap),s.scene=e.scene,s.scene.motions)){let e=n.getMotionsDuration(s.scene.motions);s.scene.duration=e+s.scene.repeat*(e+s.scene.gap)}return e.exit&&(s.exit&&(e.exit.delay=s.exit.delay,e.exit.speed=s.exit.speed),s.exit=e.exit,s.exit.duration=n.getMotionsDuration(s.exit.motions)),e.stagger&&(s.stagger=e.stagger),s},n.getSegment=(e,t)=>{if(t)switch(e){case"enter":return t.enter;case"scene":return t.scene;case"exit":return t.exit}},n.setSegmentSpeed=(e,t)=>{if(!e)return;e.speed=t;let s=n.getMotionsDuration(e.motions,e.speed);e.duration=s+e.repeat*(s+e.gap)},n.setSegmentRepeat=(e,t)=>{if(!e)return;let s=n.getMotionsDuration(e.motions,e.speed);e.repeat=t,e.duration=s+t*(s+e.gap)},n.setSegmentGap=(e,t)=>{if(!e)return;let s=n.getMotionsDuration(e.motions,e.speed);e.gap=t,e.duration=s+e.repeat*(s+e.gap)},n.getAnimationSegment=(e,t)=>{if(!t)return;const s=new n(t.block);return"enter"===e&&(s.enter=new i.Z(t.enter.name,[...t.enter.motions],t.enter.option,t.enter.duration,t.enter.delay,t.enter.speed,t.enter.repeat,t.enter.gap)),"scene"===e&&(s.scene=new i.Z(t.scene.name,[...t.scene.motions],t.scene.option,t.scene.duration,t.scene.delay,t.scene.speed,t.scene.repeat,t.scene.gap)),"exit"===e&&(s.exit=new i.Z(t.exit.name,[...t.exit.motions],t.exit.option,t.exit.duration,t.exit.delay,t.exit.speed,t.exit.repeat,t.exit.gap)),s},n.getMotionsDuration=(e,t=1)=>{if(!e||0===e.length)return 0;let s=0;for(const i of e)s=Math.max(s,Math.round((i.delay+i.duration)*t));return s},n.clone=e=>{if(!e)return;const t=new n(e.block);return e.enter&&(t.enter=new i.Z(e.enter.name,[...e.enter.motions],e.enter.option,e.enter.duration,e.enter.delay,e.enter.speed,e.enter.repeat,e.enter.gap)),e.scene&&(t.scene=new i.Z(e.scene.name,[...e.scene.motions],e.scene.option,e.scene.duration,e.scene.delay,e.scene.speed,e.scene.repeat,e.scene.gap)),e.exit&&(t.exit=new i.Z(e.exit.name,[...e.exit.motions],e.exit.option,e.exit.duration,e.exit.delay,e.exit.speed,e.exit.repeat,e.exit.gap)),e.stagger&&(t.stagger=new a.Z(e.stagger.duration,e.stagger.metod)),t}},7339:(e,t,s)=>{s.d(t,{Z:()=>l});var i=s(9872),a=s(3673),n=s(4256),o=s(9422),r=s(7318),h=s(2396);class l{constructor(e,t){this.scantime=0,this.scantype="none",this.getDuration=()=>{let e=0;return this.transitions.forEach((t=>{e=Math.max(e,t.getDuration())})),e},this.prepare=e=>{for(const t of this.transitions)t.motion.fill&&(t.begin(this.getProperty(t.motion.method,e)),this.setProperty(t.motion.method,t.motion.manner,e,t.step(0)))},this.step=(e,t)=>{for(const s of this.transitions)s.shouldRun(e)&&(s.playing||s.begin(this.getProperty(s.motion.method,t)),this.setProperty(s.motion.method,s.motion.manner,t,s.step(e)))},this.setProperty=(e,t,s,i)=>{switch(e){case"opacity":this.layer.transform.opacity=i;break;case"rotate":this.layer.transform.rotation=360*i,this.layer.transform.rAnchor=this.anchorToPoint(t);break;case"scale":this.layer.transform.scale.x=i,this.layer.transform.scale.y=i,this.layer.transform.sAnchor=this.anchorToPoint(t);break;case"scale-width":this.layer.transform.scale.x=i,this.layer.transform.sAnchor=this.anchorToPoint(t);break;case"scale-height":this.layer.transform.scale.y=i,this.layer.transform.sAnchor=this.anchorToPoint(t);break;case"self-x":this.layer.transform.offset.x=i*this.layer.getRect().width;break;case"self-y":this.layer.transform.offset.y=i*this.layer.getRect().height;break;case"offset-x":this.layer.transform.offset.x=i*s.width;break;case"offset-y":this.layer.transform.offset.y=i*s.height;break;case"viewport-x":this.layer.transform.offset.x=i*s.width-this.layer.getRect().center().x;break;case"viewport-y":this.layer.transform.offset.y=i*s.height-this.layer.getRect().center().y;break;case"viewport-box-x":const a=this.transformedRectWidth();this.layer.transform.offset.x=this.layer.getRect().center().x-(.5*a+i*(s.width-a));break;case"viewport-box-y":const n=this.transformedRectHeight();this.layer.transform.offset.y=this.layer.getRect().center().y-(.5*n+i*(s.height-n));break;default:this.setShader(e,i,t)}},this.transformedRectWidth=()=>this.layer.getRect().width*this.layer.transform.scale.x,this.transformedRectHeight=()=>this.layer.getRect().height*this.layer.transform.scale.y,this.anchorToPoint=e=>{switch(e){case"topleft":return new a.Z(0,0);case"top":return new a.Z(.5,0);case"topright":return new a.Z(1,0);case"left":return new a.Z(0,.5);case"center":return new a.Z(.5,.5);case"right":return new a.Z(1,.5);case"bottomleft":return new a.Z(0,1);case"bottom":return new a.Z(.5,1);case"bottomright":return new a.Z(1,1)}return new a.Z(.5,.5)},this.setShader=(e,t,s)=>{switch(this.shaders||(this.shaders=new n.Z),e){case"wipe":this.shaders.addShader("wipe",{direction:s,amount:t});break;case"slot":this.shaders.addShader("slot",{direction:s,amount:t});break;case"blinds":this.shaders.addShader("blinds",{direction:s,amount:t});break;case"melt":this.shaders.addShader("melt",{direction:s,amount:t});break;case"warp":this.shaders.addShader("warp",{direction:s,amount:t});break;case"curtain":this.shaders.addShader("curtain",{direction:s,amount:t});break;case"split":this.shaders.addShader("split",{direction:s,sections:2,amount:t});break;case"line":this.shaders.addShader("split",{direction:s,sections:8,amount:t});break;default:this.shaders.addShader(e,t)}this.layer.transient=this.shaders.apply(this.layer.baked?this.layer.baked:this.layer.canvas)},this.getProperty=(e,t)=>{switch(e){case"opacity":return this.layer.transform.opacity;case"rotate":return this.layer.transform.rotation/360;case"scale":case"scale-width":return this.layer.transform.scale.x;case"scale-height":return this.layer.transform.scale.y;case"self-x":return this.layer.transform.offset.x/this.layer.getRect().width;case"self-y":return this.layer.transform.offset.y/this.layer.getRect().height;case"offset-x":return this.layer.transform.offset.x/t.width;case"offset-y":return this.layer.transform.offset.y/t.height;case"viewport-x":return(this.layer.getRect().center().x+this.layer.transform.offset.x)/t.width;case"viewport-y":return(this.layer.getRect().center().y+this.layer.transform.offset.y)/t.height;case"viewport-box-x":return(this.layer.getRect().center().x+this.layer.transform.offset.x)/(t.width-this.transformedRectWidth());case"viewport-box-y":return(this.layer.getRect().center().y+this.layer.transform.offset.y)/(t.height-this.transformedRectHeight())}return 0},this.finish=()=>{this.layer.transient=void 0,this.layer.transform=void 0},this.layer=e,this.transitions=t,this.layer.transform={sAnchor:new a.Z(.5,.5),rAnchor:new a.Z(.5,.5),scale:new a.Z(1,1),offset:new a.Z(0,0),rotation:0,opacity:1}}}l.bakeAnimators=e=>{const t=new Array;for(const s of e.layers)if(!s.animation&&e.animation){const i=l.createPageTransitions(s,e,e.animation);i.length>0&&t.push(new l(s,i))}else if(s.animation&&!s.animation.block){const e=l.createLayerTransitions(s.animation);t.push(new l(s,e))}return t},l.createPageTransitions=(e,t,s)=>{const a=t.layerNr(e.id),n=t.layers.length,h=new i.Z(t.width,t.height),c=l.filterMotions(s.enter,e,a,n,h),d=l.filterMotions(s.scene,e,a,n,h),u=l.filterMotions(s.exit,e,a,n,h);if(!c&&!d&&!u&&0===c.length&&0===d.length&&0===u.length)return;const p=0===a&&e.settings.locked?0:r.Z.getOffset(e,t,s.stagger),g=s.enter?s.enter.duration+s.enter.delay:0,m=s.scene?s.scene.duration+s.scene.delay:0,v=new Array;if(c)for(const i of c)v.push(new o.Z(i,s.enter.speed,s.enter.delay+p));if(d)for(const i of d)v.push(new o.Z(i,s.scene.speed,s.scene.delay+p+g));if(u)for(const i of u)v.push(new o.Z(i,s.exit.speed,s.enter.delay+p+g+m));return v},l.createLayerTransitions=(e,t=!1)=>{const s=!!e.enter,i=!!e.scene,a=new Array;let n=s?e.enter.duration:0,r=i?e.scene.duration:0;if(!t&&s&&(n+=e.enter.delay),(t&&s&&i||!t&&i)&&(r+=e.scene.delay),e.enter){const s=t?0:e.enter.delay;for(const t of e.enter.motions)a.push(new o.Z(t,e.enter.speed,s))}if(e.scene){const i=t&&!s?0:e.scene.delay;for(const t of e.scene.motions)a.push(new o.Z(t,e.scene.speed,i+n));if(e.scene.repeat>0){let t=h.Z.getMotionsDuration(e.scene.motions,e.scene.speed),s=t+e.scene.gap;for(let r=0;r<e.scene.repeat;r++){for(const t of e.scene.motions)a.push(new o.Z(t,e.scene.speed,s+i+n));s+=t+e.scene.gap}}}if(e.exit){const h=!t||s||i?e.exit.delay:0;for(const t of e.exit.motions)a.push(new o.Z(t,e.exit.speed,h+n+r))}return a},l.createSegmentTransitions=e=>{const t=new Array;if(e)for(const s of e.motions)t.push(new o.Z(s,e.speed));return t},l.filterMotions=(e,t,s,i,a)=>{if(!e||!e.motions||0===e.motions.length)return;let n;for(const o of e.motions)if(l.filterMotion(t,s,i,a,o)){n=o.filter;break}return e.motions.filter((e=>e.filter===n))},l.filterMotion=(e,t,s,i,a)=>{if("background"===a.filter)return 0===t&&e.settings.locked;if(0===t&&e.settings.locked)return!1;if("foreground"===a.filter)return t===s-1;if("all"===a.filter||a.filter===e.type)return!0;if("large"===a.filter)return e.getRect().width>.75*i.width||e.getRect().height>.75*i.height;if("medium"===a.filter)return e.getRect().width>.25*i.width&&e.getRect().width<.75*i.width&&e.getRect().height>.25*i.height&&e.getRect().height<.75*i.height;if("small"===a.filter)return e.getRect().width<.25*i.width||e.getRect().height<.25*i.height;switch(a.filter){case"odd":return t%2==1;case"even":return t%2==0;case"1-three":return t%3==0;case"2-three":return t%3==1;case"3-three":return t%3==2;case"1-four":return t%4==0;case"2-four":return t%4==1;case"3-four":return t%4==2;case"4-four":return t%4==3}}},1750:(e,t,s)=>{s.d(t,{Z:()=>i});class i{constructor(e){switch(this.type=e,this.type){case i.EASE_LINEAR:this.calculate=i.linear;break;case i.EASE_TWENTY_LADDER:this.calculate=i.ladderTwenty;break;case i.EASE_TEN_LADDER:this.calculate=i.ladderTen;break;case i.EASE_FIVE_LADDER:this.calculate=i.ladderFive;break;case i.EASE_THREE_LADDER:this.calculate=i.ladderThree;break;case i.EASE_IN_SINE:this.calculate=i.inSine;break;case i.EASE_OUT_SINE:this.calculate=i.outSine;break;case i.EASE_IN_OUT_SINE:this.calculate=i.inOutSine;break;case i.EASE_IN_CUBIC:this.calculate=i.inCubic;break;case i.EASE_OUT_CUBIC:this.calculate=i.outCubic;break;case i.EASE_IN_OUT_CUBIC:this.calculate=i.inOutCubic;break;case i.EASE_IN_QUINT:this.calculate=i.inQuint;break;case i.EASE_OUT_QUINT:this.calculate=i.outQuint;break;case i.EASE_IN_OUT_QUINT:this.calculate=i.inOutQuint;break;case i.EASE_IN_CIRC:this.calculate=i.inCirc;break;case i.EASE_OUT_CIRC:this.calculate=i.outCirc;break;case i.EASE_IN_OUT_CIRC:this.calculate=i.inOutCirc;break;case i.EASE_IN_QUAD:this.calculate=i.inQuad;break;case i.EASE_OUT_QUAD:this.calculate=i.outQuad;break;case i.EASE_IN_OUT_QUAD:this.calculate=i.inOutQuad;break;case i.EASE_IN_QUART:this.calculate=i.inQuart;break;case i.EASE_OUT_QUART:this.calculate=i.outQuart;break;case i.EASE_IN_OUT_QUART:this.calculate=i.inOutQuart;break;case i.EASE_IN_EXPO:this.calculate=i.inExpo;break;case i.EASE_OUT_EXPO:this.calculate=i.outExpo;break;case i.EASE_IN_OUT_EXPO:this.calculate=i.inOutExpo;break;case i.EASE_IN_BACK:this.calculate=i.inBack;break;case i.EASE_OUT_BACK:this.calculate=i.outBack;break;case i.EASE_IN_OUT_BACK:this.calculate=i.inOutBack;break;case i.EASE_IN_BOUNCE:this.calculate=i.inBounce;break;case i.EASE_OUT_BOUNCE:this.calculate=i.outBounce;break;case i.EASE_IN_OUT_BOUNCE:this.calculate=i.inOutBounce;break;case i.EASE_IN_ELASTIC:this.calculate=i.inElastic;break;case i.EASE_OUT_ELASTIC:this.calculate=i.outElastic;break;case i.EASE_IN_OUT_ELASTIC:this.calculate=i.inOutElastic}}static inOutQuint(e){return e<.5?16*e*e*e*e*e:1-Math.pow(-2*e+2,5)/2}static outCirc(e){return Math.sqrt(1-Math.pow(e-1,2))}static inOutCirc(e){return e<.5?(1-Math.sqrt(1-Math.pow(2*e,2)))/2:(Math.sqrt(1-Math.pow(-2*e+2,2))+1)/2}}i.EASE_LINEAR="linear",i.EASE_TWENTY_LADDER="twenty-ladder",i.EASE_TEN_LADDER="ten-ladder",i.EASE_FIVE_LADDER="five-ladder",i.EASE_THREE_LADDER="three-ladder",i.EASE_IN_SINE="in-sine",i.EASE_OUT_SINE="out-sine",i.EASE_IN_OUT_SINE="in-out-sine",i.EASE_IN_CUBIC="in-cubic",i.EASE_OUT_CUBIC="out-cubic",i.EASE_IN_OUT_CUBIC="in-out-cubic",i.EASE_IN_QUINT="in-quint",i.EASE_OUT_QUINT="out-quint",i.EASE_IN_OUT_QUINT="in-out-quint",i.EASE_IN_CIRC="in-circ",i.EASE_OUT_CIRC="out-circ",i.EASE_IN_OUT_CIRC="in-out-circ",i.EASE_IN_QUAD="in-quad",i.EASE_OUT_QUAD="out-quad",i.EASE_IN_OUT_QUAD="in-out-quad",i.EASE_IN_QUART="in-quart",i.EASE_OUT_QUART="out-quart",i.EASE_IN_OUT_QUART="in-out-quart",i.EASE_IN_EXPO="in-expo",i.EASE_OUT_EXPO="out-expo",i.EASE_IN_OUT_EXPO="in-out-expo",i.EASE_IN_BACK="in-back",i.EASE_OUT_BACK="out-back",i.EASE_IN_OUT_BACK="in-out-back",i.EASE_IN_BOUNCE="in-bounce",i.EASE_OUT_BOUNCE="out-bounce",i.EASE_IN_OUT_BOUNCE="in-out-bounce",i.EASE_IN_ELASTIC="in-elastic",i.EASE_OUT_ELASTIC="out-elastic",i.EASE_IN_OUT_ELASTIC="in-out-elastic",i.linear=e=>e,i.ladderTwenty=e=>i.ladder(e,20),i.ladderTen=e=>i.ladder(e,10),i.ladderFive=e=>i.ladder(e,5),i.ladderThree=e=>i.ladder(e,3),i.ladder=(e,t)=>Math.ceil(e*t)*(1/t),i.inSine=e=>1-Math.cos(e*Math.PI/2),i.outSine=e=>Math.sin(e*Math.PI/2),i.inOutSine=e=>-(Math.cos(Math.PI*e)-1)/2,i.inCubic=e=>e*e*e,i.outCubic=e=>1-Math.pow(1-e,3),i.inOutCubic=e=>e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2,i.inQuint=e=>e*e*e*e*e,i.outQuint=e=>1-Math.pow(1-e,5),i.inCirc=e=>1-Math.sqrt(1-Math.pow(e,2)),i.inQuad=e=>e*e,i.outQuad=e=>1-(1-e)*(1-e),i.inOutQuad=e=>e<.5?2*e*e:1-Math.pow(-2*e+2,2)/2,i.inQuart=e=>e*e*e*e,i.outQuart=e=>1-Math.pow(1-e,4),i.inOutQuart=e=>e<.5?8*e*e*e*e:1-Math.pow(-2*e+2,4)/2,i.inExpo=e=>0===e?0:Math.pow(2,10*e-10),i.outExpo=e=>1===e?1:1-Math.pow(2,-10*e),i.inOutExpo=e=>0===e?0:1===e?1:e<.5?Math.pow(2,20*e-10)/2:(2-Math.pow(2,-20*e+10))/2,i.inBack=e=>{const t=1.70158;return 2.70158*e*e*e-t*e*e},i.outBack=e=>{const t=1.70158;return 1+2.70158*Math.pow(e-1,3)+t*Math.pow(e-1,2)},i.inOutBack=e=>{const t=2.5949095;return e<.5?Math.pow(2*e,2)*(7.189819*e-t)/2:(Math.pow(2*e-2,2)*((t+1)*(2*e-2)+t)+2)/2},i.inBounce=e=>1-i.outBounce(1-e),i.outBounce=e=>{const t=7.5625,s=2.75;return e<1/s?t*e*e:e<2/s?t*(e-=1.5/s)*e+.75:e<2.5/s?t*(e-=2.25/s)*e+.9375:t*(e-=2.625/s)*e+.984375},i.inOutBounce=e=>e<.5?(1-i.outBounce(1-2*e))/2:(1+i.outBounce(2*e-1))/2,i.inElastic=e=>{const t=2*Math.PI/3;return 0===e?0:1===e?1:-Math.pow(2,10*e-10)*Math.sin((10*e-10.75)*t)},i.outElastic=e=>{const t=2*Math.PI/3;return 0===e?0:1===e?1:Math.pow(2,-10*e)*Math.sin((10*e-.75)*t)+1},i.inOutElastic=e=>{const t=2*Math.PI/4.5;return 0===e?0:1===e?1:e<.5?-Math.pow(2,20*e-10)*Math.sin((20*e-11.125)*t)/2:Math.pow(2,-20*e+10)*Math.sin((20*e-11.125)*t)/2+1}},3990:(e,t,s)=>{s.d(t,{Z:()=>i});class i{constructor(e,t,s,a=0,n=0,o=i.SPEED_NORMAL,r=0,h=0){this.name=e,this.motions=t,this.option=s,this.duration=a,this.delay=n,this.speed=o,this.repeat=r,this.gap=h}}i.SPEED_SLOW=2,i.SPEED_NORMAL=1,i.SPEED_FAST=.5},7318:(e,t,s)=>{s.d(t,{Z:()=>n});var i=s(3655),a=s(3673);class n{constructor(e,t="top"){this.duration=e,this.metod=t}}n.getOffset=(e,t,s)=>{let n=0;if(void 0===s||0===s.duration)return n;switch(s.metod){case"top":n=e.getRect().y/t.height;break;case"bottom":n=1-e.getRect().y/t.height;break;case"left":n=e.getRect().x/t.width;break;case"right":n=1-e.getRect().x/t.width;break;case"back":n=t.layerNr(e.id)/t.layers.length;break;case"front":n=1-t.layerNr(e.id)/t.layers.length;break;case"center":n=new a.Z(t.width/2,t.height/2).distanceTo(e.getRect().center())/Math.sqrt(t.width*t.width+t.height*t.height)/2;break;case"bounds":n=1-new a.Z(t.width/2,t.height/2).distanceTo(e.getRect().center())/Math.sqrt(t.width*t.width+t.height*t.height)/2}return Math.round((0,i.uZ)(n*s.duration,0,s.duration))}},3409:(e,t,s)=>{s.d(t,{Z:()=>o});var i=s(3655),a=s(9872),n=s(7339);class o{constructor(e,t=24,s=1,o=!1){this.requestFrame=async()=>{if(this.currentFrame+=1,this.currentFrame>this.totalFrames)return void this.cancel();const e=this.currentFrame*this.interval,t=new a.Z(this.fresco.width,this.fresco.height);for(const s of this.animators)s.step(e,t);return this.stage.renderOutputFrame(this.ctx,this.inclusive),1!==this.scale?(await i.iF(),await i.vJ(this.output,this.scaled.width,this.scaled.height,this.scaled)):this.output},this.cancel=()=>{if(this.animators)for(const e of this.animators)e.finish()},this.scale=s,this.stage=e,this.fresco=e.fresco,this.inclusive=o,this.animators=[];let r=this.fresco.width,h=this.fresco.height;if(r%2==1&&(r-=1),h%2==1&&(h-=1),this.output=i.vL(r,h),1!==s){let e=Math.round(this.fresco.width*s),t=Math.round(this.fresco.height*s);e%2==1&&(e-=1),t%2==1&&(t-=1),this.scaled=i.vL(e,t)}this.ctx=this.output.getContext("2d"),this.animators=n.Z.bakeAnimators(e.fresco),this.runTime=0;for(const i of this.animators)this.runTime=Math.max(this.runTime,i.getDuration()),i.prepare(new a.Z(this.fresco.width,this.fresco.height));this.currentFrame=0,this.interval=1e3/t,this.totalFrames=Math.ceil((this.runTime+50)/1e3)*t}}},9422:(e,t,s)=>{s.d(t,{Z:()=>a});var i=s(1750);class a{constructor(e,t,s=0){this.shouldRun=e=>{const t=e<this.idelay,s=e>this.idelay+this.iduration;return s&&!this.end?(this.end=!0,!0):!t&&!s},this.getDuration=()=>this.idelay+this.iduration,this.fill=e=>{this.initial=void 0===this.motion.value.set?e:this.motion.value.set;const t=void 0===this.motion.value.from?this.initial:this.motion.value.from,s=void 0===this.motion.value.to?this.initial:this.motion.value.to;return 2===this.motion.direction||4===this.motion.direction?s-(s-t):t+(s-t)},this.begin=e=>{this.end=!1,this.playing=!0,this.initial=void 0===this.motion.value.set?e:this.motion.value.set,this.ibefore=void 0===this.motion.value.from?this.initial:this.motion.value.from,this.iafter=void 0===this.motion.value.to?this.initial:this.motion.value.to},this.step=e=>{if(0===e||e-this.idelay<1||0===this.ipass||0===this.motion.iterations)return this.ibefore;let t=Math.ceil((e-this.idelay)/this.ipass),s=(e-this.idelay)%this.ipass,i=0===s?1:s/this.ipass;(this.end||t>this.motion.iterations)&&(t=this.motion.iterations,i=1);const a=(this.iafter-this.ibefore)*this.ease.calculate(i);return this.flip(t)?this.iafter-a:this.ibefore+a},this.flip=e=>2===this.motion.direction||3===this.motion.direction&&e%2==0||4===this.motion.direction&&e%2==1,this.motion=e,this.ease=new i.Z(e.easing),this.idelay=Math.round(this.motion.delay*t+s),this.iduration=Math.round(this.motion.duration*t),this.ipass=0===this.iduration||0===this.motion.iterations?0:this.iduration/this.motion.iterations}}},165:(e,t,s)=>{s.a(e,(async(e,i)=>{try{s.d(t,{Z:()=>P});var a=s(6548),n=s(3655),o=s(5934),r=s(5574),h=s(3947),l=s(6817),c=s(1030),d=s(3673),u=s(4188),p=s(8776),g=s(4820),m=s(4256),v=s(4211),f=s(4178),y=s(8132),w=s(1951),b=s(1302),x=s(7630),Z=e([y]);y=(Z.then?(await Z)():Z)[0];class k{constructor(e,t,s,i,a,n,o){this.id=e,this.name=t,this.original=s,this.preview=i,this.result=a,this.levels=n,this.saturation=o}}class P{constructor(e,t){this.active=0,this.limit=g.ZP.user.subscription?50:3,this.allTasks=["crop","resize","border","auto","vibrance","saturation","brightness","temperature","tint","contrast","exposure","highlights","shadows","monochrome","sharpen","clarity","glamour","bloom","smooth","blur","grain"],this.appendAddImage=()=>{this.content.append((0,h.T)("div",{id:"batch-add-image"},(0,a.Z)("titleAddImage"))),(0,h.ZP)("batch-add-image").addEventListener("click",this.addImage)},this.addImage=async()=>{this.batch.length>=this.limit?new w.Z(this.home.web.stage,"BATCH"):await(0,o.Q0)(!0).then((async e=>{0!==e.length&&await this.append(e)}))},this.append=async e=>{const t=new Array;for(let s=0;s<e.length&&(this.active+1===this.limit&&(0,h.ZP)("batch-add-image").classList.add("premium"),!(this.active>=this.limit));s++){this.active++;const i=n.M8();t.push({id:i,file:e[s]}),(0,h.ZP)("batch-add-image").after((0,h.T)("div",{id:i,className:"box queue"},(0,h.T)("div",{className:"loading small"})))}t.forEach((async e=>{var t;const s=e.id,i=e.file.name;(0,c.Z)("open-file",null!==(t=e.file.type)&&void 0!==t?t:""),(0,r.s4)(e.file).then((e=>{e&&window.requestAnimationFrame((()=>{const t=l.Z.bestFit(e.width,e.height,800,200),a=l.Z.bestFit(e.width,e.height,g.ZP.user.subscription?8196:4096,g.ZP.user.subscription?8196:4096);let o=n.eY(e,a.width,a.height),r=n.eY(o,t.width,t.height),c=n.dN(r);c.id="result-"+s;const d=n.gr(r),u=n.fu(r);this.batch.push(new k(s,i,o,r,c,d,u)),(0,h.ZP)(s).innerHTML="",(0,h.ZP)(s).classList.remove("queue"),(0,h.ZP)(s).append(c,(0,h.T)("span",{className:"meta"},i)),this.generatePreview(),this.render()}))}))}))},this.generatePreview=()=>{if(this.crop){const e=200,t=Math.round(e/this.crop.y*this.crop.x);this.batch.forEach((s=>{const i=l.Z.fillFit(s.original.width,s.original.height,t,e);s.preview.width=t,s.preview.height=e;s.preview.getContext("2d").drawImage(s.original,i.x,i.y,i.width,i.height),s.result.width=s.preview.width,s.result.height=s.preview.height}))}else this.batch.forEach((e=>{const t=l.Z.bestFit(e.original.width,e.original.height,800,200);e.preview=n.eY(e.original,t.width,t.height),e.result.width=e.preview.width,e.result.height=e.preview.height}))},this.render=()=>{this.batch.forEach((e=>{const t=(0,h.ZP)("result-"+e.id).getContext("2d");"fix"===this.auto&&(this.shaders.addShader("bwpoint",{black:e.levels.x,white:e.levels.y},!0),this.shaders.addShader("vibrance",e.saturation<.7?.7-e.saturation:void 0,!0)),t.drawImage(this.shaders.apply(e.preview),0,0)}))},this.appendAllTasks=()=>{this.allTasks.forEach((e=>{const t=(0,h.T)("div",{id:"task-"+e,className:"batch-task"},(0,h.T)("img",{className:"type ic",src:"/img/tool/"+e+".svg"}),(0,h.T)("div",{id:"task-"+e+"-name",className:"name"},(0,a.Z)(e),(0,h.T)("span",{id:"task-"+e+"-value"})),(0,h.T)("div",{id:"task-"+e+"-settings",className:"settings"}));t.addEventListener("click",this.showTask),t.setAttribute("data",e),(0,h.ZP)("flow-offering").append(t)}))},this.showTask=e=>{const t=e.currentTarget.getAttribute("data");if(t===this.activeTask)return;if(this.activeTask){(0,h.ZP)("task-"+this.activeTask).classList.contains("flow")?this.updateTask(e):((0,h.ZP)("task-"+this.activeTask).classList.remove("active"),(0,h.ZP)("task-"+this.activeTask+"-settings").innerHTML="",this.update(void 0))}this.activeTask=t,(0,h.ZP)("task-"+this.activeTask).classList.add("active");const s=(0,h.ZP)("task-"+this.activeTask+"-settings"),i=(0,h.ZP)("task-"+this.activeTask).classList.contains("flow");switch(s.append((0,h.T)("img",{className:"close ic",src:"/img/icon/close.svg",onclick:e=>i?this.updateTask(e):this.closeTask(e)})),this.activeTask){case"crop":const e=(0,h.T)("div");e.innerHTML+='\n                    <div class="select pad-4">\n                        <select id="batch-crop-aspect">\n                            <option value="1:1" selected>1:1 (Square)</option>\n                            \n                            <option value="3:4">3:4 (Social post)</option>\n                            <option value="9:16">9:16 (Social story)</option>\n\n                            <option value="1:2">1:2 (High)</option>\n                            <option value="2:1">2:1 (Wide)</option>\n\n                            <option value="3:2">3:2 (35mm film)</option>\n                            <option value="3:1">3:1 (Panorama)</option>\n                            <option value="4:1">4:1 (4 page social)</option>\n                        \n                            <option value="4:3">4:3 (Monitor)</option>\n\n                            <option value="14:9">14:9</option>\n                            <option value="16:9">16:9 (Widescreen)</option>\n                            <option value="16:10">16:10</option>\n                            \n                            <option value="5:4">5:4</option>\n                            <option value="7:5">7:5</option>\n                            <option value="19:10">19:10</option>\n                            <option value="21:9">21:9 (Cinemascope)</option>\n                            <option value="32:9">32:9 (Super ultra wide)</option>\n                        </select>\n                    </div>\n                ',s.append(e),i&&this.crop?(0,h.ZP)("batch-crop-aspect").value=this.crop.x+":"+this.crop.y:this.update(new d.Z(1,1)),(0,h.ZP)("batch-crop-aspect").addEventListener("change",(()=>{const e=(0,h.ZP)("batch-crop-aspect").value.split(":"),t=new d.Z(Number(e[0]),Number(e[1]));this.update(t)}));break;case"resize":const t=(0,h.T)("div");if(t.innerHTML+='\n                    <div class="select pad-4" style="margin-bottom:10px">\n                        <select id="batch-resize-method">\n                            <option value="fit-inside" selected>Fit inside</option>\n                            <option value="max-width">By width</option>\n                            <option value="max-height">By height</option>\n                        </select>\n                    </div>\n                    <label id="batch-resize-width" class="pad-5 split">Width <input id="batch-resize-width-value" value="500" type="number"></label>\n                    <label id="batch-resize-height" class="pad-5 split">Height <input id="batch-resize-height-value" value="500" type="number"></label>\n                ',s.append(t),(0,h.ZP)("batch-resize-method").addEventListener("change",(()=>{const e=(0,h.ZP)("batch-resize-method").value;(0,h.ZP)("batch-resize-width").style.display="max-height"===e?"none":"block",(0,h.ZP)("batch-resize-height").style.display="max-width"===e?"none":"block"})),i&&this.resize){let e="fit-inside";this.resize.x>0&&0===this.resize.y?e="max-width":0===this.resize.x&&this.resize.y>0&&(e="max-height"),(0,h.ZP)("batch-resize-method").value=e,(0,h.ZP)("batch-resize-width-value").value=this.resize.x.toString(),(0,h.ZP)("batch-resize-height-value").value=this.resize.y.toString(),(0,h.ZP)("batch-resize-width").style.display="max-height"===e?"none":"block",(0,h.ZP)("batch-resize-height").style.display="max-width"===e?"none":"block"}break;case"border":if(s.append((0,h.T)("div",{id:"batch-border-size"}),(0,h.T)("label",{className:"split pad-10"},(0,a.Z)("color"),(0,h.T)("div",{id:"batch-border-color"}))),this.amount=new u.Z("batch-border-size",{label:(0,a.Z)("size"),range:[0,.2],step:.01,labelFormat:e=>`${Math.round(100*e)}%`,labelParse:e=>parseInt(e,10)/100,onEnd:e=>this.update(0===e?void 0:{size:this.amount.getValue(),color:this.color.getColor()})}),this.color=new v.Z("batch-border-color",new p.Z(255,255,255),(()=>{this.update({size:this.amount.getValue(),color:this.color.getColor()})})),i){let e=this.shaders.getShaderValue(this.activeTask);this.amount.setValue(e.size),this.color.setColor(e.color)}break;case"auto":const o=(0,h.T)("div");o.innerHTML+='\n                    <ul class="push-buttons tiny">\n                        <li id="batch-auto-fix"><img src="/img/tool/thick/wand.svg" class="ic" width="24" height="24" loading="lazy"><span>Fix</span></li>\n                        <li id="batch-auto-bw"><img src="/img/tool/thick/bw.svg" class="ic" width="24" height="24" loading="lazy"><span>BW</span></li>\n                        <li id="batch-auto-pop"><img src="/img/tool/thick/temper.svg" class="ic" width="24" height="24" loading="lazy"><span>Pop</span></li>\n                    </ul>\n                ',s.append(o),(0,h.ZP)("batch-auto-fix").addEventListener("click",(()=>this.setAuto("fix"))),(0,h.ZP)("batch-auto-bw").addEventListener("click",(()=>this.setAuto("bw"))),(0,h.ZP)("batch-auto-pop").addEventListener("click",(()=>this.setAuto("pop"))),i?(0,h.ZP)("batch-auto-"+this.auto).classList.add("selected"):this.setAuto("fix");break;case"monochrome":var n=(0,h.T)("div",{style:"margin-top:2px",className:"select"});if(n.innerHTML='\n                    <select id="batch-monochrome-preset">\n                        <option value="0.299:0.587:0.114" selected>Rec601 Luma (Vision)</option>\n                        <option value="0.2126:0.7152:0.0722">sRGB ITU-R BT.709</option>\n                        <option value="0.2627:0.6780:0.0593">HDR ITU-R BT.2100</option>\n                        <option value="0.3333333:0.3333334:0.3333333">Unweighted</option>\n                        <option value="1:0:0">Red</option>\n                        <option value="0:1:0">Green</option>\n                        <option value="0:0:1">Blue</option>\n                        <option value="0.18:0.41:0.41">Agfa 200X</option>\n                        <option value="0.25:0.39:0.36">Agfapan 25</option>\n                        <option value="0.21:0.40:0.39">Agfapan 100</option>\n                        <option value="0.20:0.41:0.39">Agfapan 400</option>\n                        <option value="0.21:0.42:0.37">Ilford Delta 100 & XP2 Super</option>\n                        <option value="0.22:0.42:0.36">Ilford Delta 400</option>\n                        <option value="0.31:0.36:0.33">Ilford Delta 400 Pro & 3200</option>\n                        <option value="0.28:0.41:0.31">Ilford FP4</option>\n                        <option value="0.23:0.37:0.40">Ilford HP5</option>\n                        <option value="0.33:0.36:0.31">Ilford Pan F</option>\n                        <option value="0.36:0.31:0.33">Ilford SFX</option>\n                        <option value="0.21:0.42:0.37">Ilford</option>\n                        <option value="0.24:0.37:0.39">Kodak Tmax 100</option>\n                        <option value="0.27:0.36:0.37">Kodak Tmax 400</option>\n                        <option value="0.25:0.35:0.40">Kodak Tri-X</option>\n                        <option value="0.5:0.5:0">Red Green</option>\n                        <option value="0:0.5:0.5">Green Blue</option>\n                        <option value="0.5:0:0.5">Blue Red</option>\n                    </select>\n                ',s.append(n),i){let e=this.shaders.getShaderValue(this.activeTask);(0,h.ZP)("batch-monochrome-preset").value=e.r+":"+e.g+":"+e.b}else this.update({r:.299,g:.587,b:.114});(0,h.ZP)("batch-monochrome-preset").addEventListener("change",(()=>{let e=(0,h.ZP)("batch-monochrome-preset").value.split(":");this.update({r:Number(e[0]),g:Number(e[1]),b:Number(e[2])})}));break;default:s.append((0,h.T)("div",{id:"batch-task-amount"})),this.amount=new u.Z("batch-task-amount",{label:(0,a.Z)("amount"),range:this.isPosScale()?[0,1]:[-1,1],step:.01,labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,onEnd:e=>this.update(e)}),i&&this.amount.setValue(this.shaders.getShaderValue(this.activeTask))}i?s.append((0,h.T)("div",{className:"buttons small pad-20"},(0,h.T)("a",{className:"button positive",onclick:e=>this.updateTask(e)},(0,a.Z)("update")),(0,h.T)("a",{className:"button negative",onclick:e=>this.removeTask(e)},(0,a.Z)("remove")))):s.append((0,h.T)("a",{className:"button positive pad-20",onclick:e=>this.addTask(e)},(0,a.Z)("add")))},this.isPosScale=(e=this.activeTask)=>"sharpen"===e||"smooth"===e||"blur"===e||"glamour"===e||"bloom"===e||"grain"===e,this.isTaskTypeValid=e=>{for(let t=0;t<this.allTasks.length;t++)if(this.allTasks[t]===e)return!0;return!1},this.addTask=e=>{switch(e.stopPropagation(),e.preventDefault(),this.activeTask){case"crop":(0,h.ZP)("task-"+this.activeTask+"-value").innerText=(0,a.Z)("aspect")+" "+this.crop.x+":"+this.crop.y,this.moveTaskToFlow();break;case"resize":const e=Number((0,h.ZP)("batch-resize-width-value").value),t=Number((0,h.ZP)("batch-resize-height-value").value);if(t>0||e>0){const s=(0,h.ZP)("batch-resize-method").value;this.resize=new d.Z("max-height"!==s?e:0,"max-width"!==s?t:0),(0,h.ZP)("task-"+this.activeTask+"-value").innerText="fit-inside"===s?(0,a.Z)("fitInside")+" "+this.resize.x+"x"+this.resize.y+"px":"max-width"===s?(0,a.Z)("maxWidth")+" "+this.resize.x+"px":(0,a.Z)("maxHeight")+" "+this.resize.y+"px",this.moveTaskToFlow()}break;case"border":this.amount.getValue()>0&&((0,h.ZP)("task-"+this.activeTask+"-value").innerText=(0,a.Z)("size")+": "+Math.round(100*this.amount.getValue())+"%",this.moveTaskToFlow());break;case"auto":(0,h.ZP)("task-"+this.activeTask+"-value").innerText=this.auto.toUpperCase(),this.moveTaskToFlow();break;case"monochrome":let s=this.shaders.getShaderValue(this.activeTask);(0,h.ZP)("task-"+this.activeTask+"-value").innerText="R: "+(100*s.r).toFixed(1)+"%, G: "+(100*s.g).toFixed(1)+"%, B: "+(100*s.b).toFixed(1)+"%",this.moveTaskToFlow();break;default:0!==this.amount.getValue()&&((0,h.ZP)("task-"+this.activeTask+"-value").innerText=(0,a.Z)("amount")+": "+Math.round(100*this.amount.getValue()),this.moveTaskToFlow())}(0,h.ZP)("task-"+this.activeTask).classList.remove("active"),(0,h.ZP)("task-"+this.activeTask+"-settings").innerHTML="",this.activeTask=void 0},this.moveTaskToFlow=(e=this.activeTask)=>{(0,h.ZP)("batch-tasks").style.display="block",(0,h.ZP)("batch-description").style.display="none",(0,h.ZP)("batch-tasks").append((0,h.ZP)("task-"+e)),(0,h.ZP)("task-"+e).classList.add("flow")},this.updateTask=e=>{switch(e.stopPropagation(),e.preventDefault(),this.activeTask){case"crop":(0,h.ZP)("task-"+this.activeTask+"-value").innerText=(0,a.Z)("aspect")+" "+this.crop.x+":"+this.crop.y;break;case"resize":const e=Number((0,h.ZP)("batch-resize-width-value").value),t=Number((0,h.ZP)("batch-resize-height-value").value);if(t>0||e>0){const s=(0,h.ZP)("batch-resize-method").value;this.resize=new d.Z("max-height"!==s?e:0,"max-width"!==s?t:0),(0,h.ZP)("task-"+this.activeTask+"-value").innerText="fit-inside"===s?(0,a.Z)("fitInside")+" "+this.resize.x+"x"+this.resize.y+"px":"max-width"===s?(0,a.Z)("maxWidth")+" "+this.resize.x+"px":(0,a.Z)("maxHeight")+" "+this.resize.y+"px"}break;case"border":(0,h.ZP)("task-"+this.activeTask+"-value").innerText=(0,a.Z)("size")+": "+Math.round(100*this.amount.getValue())+"%";break;case"auto":(0,h.ZP)("task-"+this.activeTask+"-value").innerText=this.auto.toUpperCase();break;case"monochrome":let s=this.shaders.getShaderValue(this.activeTask);(0,h.ZP)("task-"+this.activeTask+"-value").innerText="R: "+(100*s.r).toFixed(1)+"%, G: "+(100*s.g).toFixed(1)+"%, B: "+(100*s.b).toFixed(1)+"%";break;default:(0,h.ZP)("task-"+this.activeTask+"-value").innerText=(0,a.Z)("amount")+": "+Math.round(100*this.amount.getValue())}(0,h.ZP)("task-"+this.activeTask).classList.remove("active"),(0,h.ZP)("task-"+this.activeTask+"-settings").innerHTML="",this.activeTask=void 0},this.removeTask=e=>{this.activeTask&&(null==e||e.stopPropagation(),null==e||e.preventDefault(),this.update(void 0),(0,h.ZP)("flow-offering").prepend((0,h.ZP)("task-"+this.activeTask)),(0,h.ZP)("task-"+this.activeTask).classList.remove("flow"),(0,h.ZP)("task-"+this.activeTask).classList.remove("active"),(0,h.ZP)("task-"+this.activeTask+"-settings").innerHTML="",(0,h.ZP)("task-"+this.activeTask+"-value").innerHTML="",this.activeTask=void 0)},this.closeTask=e=>{null==e||e.stopPropagation(),null==e||e.preventDefault(),this.activeTask&&(this.update(),(0,h.ZP)("task-"+this.activeTask).classList.remove("active"),(0,h.ZP)("task-"+this.activeTask+"-settings").innerHTML=""),this.activeTask=void 0},this.anyTask=()=>void 0!==this.crop||void 0!==this.resize||0!==this.shaders.chain.length||void 0!==this.auto,this.update=(e,t=this.activeTask)=>{switch(t){case"crop":this.crop=e,this.generatePreview();break;case"resize":void 0===e&&(this.resize=void 0);break;case"auto":void 0===e&&(this.shaders.removeShaderSidekick(),this.auto=void 0);break;default:this.shaders.addShader(t,e)}this.render()},this.export=async()=>{let e;if(this.closeTask(),(0,x.Zp)()&&(e=await(0,x.f1)("batch","zip","Zip achive","application/zip"),!1===e))return;const t=(0,h.T)("div",{id:"modal-batch",className:"modal"});document.body.appendChild(t);const s=document.querySelector("input[name=batch-format]:checked").value,i=document.querySelector("input[name=batch-quality]:checked").value,o=new Array;for(let a=0;a<this.batch.length;a++){document.dispatchEvent(new CustomEvent("loading",{detail:"Export "+(a+1)+" of "+this.batch.length}));let e=this.batch[a].original;if(this.crop){let t=e.width,s=e.height;this.crop.y/this.crop.x*(e.width/e.height)<this.crop.x/this.crop.y*(e.height/e.width)?s=Math.round(e.width*(this.crop.y/this.crop.x)):t=Math.round(e.height*(this.crop.x/this.crop.y)),e=n.fg(e,new l.Z(Math.round(.5*(e.width-t)),Math.round(.5*(e.height-s)),t,s))}if(this.resize){const t=this.resize.x>0?this.resize.x:4096,s=this.resize.y>0?this.resize.y:4096,i=l.Z.bestFit(e.width,e.height,t,s);e=n.Ai(e,i.width,i.height)}"fix"===this.auto&&(this.shaders.addShader("bwpoint",{black:this.batch[a].levels.x,white:this.batch[a].levels.y},!0),this.shaders.addShader("vibrance",this.batch[a].saturation<.7?.7-this.batch[a].saturation:void 0,!0));const t=this.shaders.apply(e),r=await new Promise((e=>t.toBlob(e,"image/"+s.replace("jpg","jpeg"),i)));o.push(new File([r],this.batch[a].name.split(".")[0]+"."+s))}document.dispatchEvent(new CustomEvent("loading",{detail:"Create zip"}));let r=new y.ZipWriter;for(let a=0;a<o.length;a++){const e=o[a];let t=await e.arrayBuffer(),s=new Uint8Array(t);r.writeFile(e.name,s,!1)}const c=r.finish(),d=new File([new Blob([c.buffer])],"batch.zip",{type:"application/zip"});e?(await(0,x.BI)(e,d),document.dispatchEvent(new CustomEvent("loading",{detail:"stop"})),document.dispatchEvent(new CustomEvent("notification",{detail:(0,a.Z)("fileSaved")}))):((0,x.vV)(d,"batch","zip"),document.dispatchEvent(new CustomEvent("loading",{detail:"stop"}))),t.remove()},this.setAuto=(e,t=!0)=>{this.shaders.removeShaderSidekick(),this.auto=e,t&&((0,h.ZP)("batch-auto-bw").classList.toggle("selected","bw"===this.auto),(0,h.ZP)("batch-auto-fix").classList.toggle("selected","fix"===this.auto),(0,h.ZP)("batch-auto-pop").classList.toggle("selected","pop"===this.auto)),"bw"===this.auto&&(this.shaders.addShader("saturation",-1,!0),this.shaders.addShader("contrast",.2,!0),this.shaders.addShader("exposure",.1,!0),this.shaders.addShader("clarity",.1,!0)),"pop"===this.auto&&(this.shaders.addShader("highlights",.5,!0),this.shaders.addShader("shadows",-.5,!0),this.shaders.addShader("vibrance",.5,!0),this.shaders.addShader("saturation",.2,!0),this.shaders.addShader("exposure",.2,!0),this.shaders.addShader("clarity",.2,!0)),this.render()},this.openMacro=async()=>{g.ZP.user.subscription?await(0,o.Q0)(!1,!0).then((async e=>{if(0===e.length)return;const t=new b.m;try{const i=t.parseJsonString(await e[0].text());if(i)for(var s=0;s<i.length;s++){const e=i[s];if(this.isTaskTypeValid(e.task)){switch(e.task){case"crop":let t=e.param.aspect.split(":");this.update(new d.Z(Number(t[0]),Number(t[1])),e.task),(0,h.ZP)("task-"+e.task+"-value").innerText=(0,a.Z)("aspect")+" "+this.crop.x+":"+this.crop.y;break;case"resize":let s=e.param;this.resize=new d.Z(s.width,s.height);let i="fit-inside";this.resize.x>0&&0===this.resize.y?i="max-width":0===this.resize.x&&this.resize.y>0&&(i="max-height"),(0,h.ZP)("task-"+e.task+"-value").innerText="fit-inside"===i?(0,a.Z)("fitInside")+" "+this.resize.x+"x"+this.resize.y+"px":"max-width"===i?(0,a.Z)("maxWidth")+" "+this.resize.x+"px":(0,a.Z)("maxHeight")+" "+this.resize.y+"px";break;case"border":let n=e.param;(0,h.ZP)("task-"+e.task+"-value").innerText=(0,a.Z)("size")+": "+Math.round(100*n.size)+"%",this.update({size:n.size,color:p.Z.fromHEX(n.color)},e.task);break;case"auto":let o=e.param.method;(0,h.ZP)("task-"+e.task+"-value").innerText=o.toUpperCase(),this.setAuto(o,!1);break;case"monochrome":let r=e.param;(0,h.ZP)("task-"+e.task+"-value").innerText="R: "+(100*r.r).toFixed(1)+"%, G: "+(100*r.g).toFixed(1)+"%, B: "+(100*r.b).toFixed(1)+"%",this.update(e.param,e.task);break;default:let l=e.param.amount;(0,h.ZP)("task-"+e.task+"-value").innerText=(0,a.Z)("amount")+": "+Math.round(100*l),this.update(l,e.task)}this.moveTaskToFlow(e.task)}}}catch(i){console.log(i)}})):new w.Z(this.home.web.stage,"BATCH")},this.saveMacro=async()=>{if(!g.ZP.user.subscription)return void new w.Z(this.home.web.stage,"BATCH");if(!this.anyTask())return void document.dispatchEvent(new CustomEvent("notification",{detail:(0,a.Z)("macroNoSave")}));const e=new b.Z;if(this.crop&&e.addTask("crop",{aspect:this.crop.x+":"+this.crop.y}),this.resize){const t=this.resize.x>0&&this.resize.y>0?"fit-inside":this.resize.x>0?"max-width":"max-height";e.addTask("resize",{method:t,width:this.resize.x,height:this.resize.y})}let t;if(this.auto&&e.addTask("auto",{method:this.auto}),e.addChain(this.shaders.chain),(0,x.Zp)()&&(t=await(0,x.f1)("batch-macro","pxm","Pixlr macro","application/json"),!1===t))return;const s=new File([e.toBlob()],"batch-macro.pxm");t?(await(0,x.BI)(t,s),document.dispatchEvent(new CustomEvent("notification",{detail:(0,a.Z)("fileSaved")}))):(0,x.vV)(s,"batch-macro","pxm")},this.clear=()=>{this.active=0,this.content.innerHTML="",this.batch=new Array,this.appendAddImage(),document.dispatchEvent(new CustomEvent("notification",{detail:(0,a.Z)("clear")}))},this.close=()=>{(0,h.ZP)("batch-close").removeEventListener("click",this.close),(0,h.ZP)("batch-cancel").removeEventListener("click",this.close),this.flow=void 0,this.content=void 0,(0,h.ZP)("batch-out").remove(),(0,h.ZP)("batch-flow").remove(),(0,h.ZP)("batch-section").remove(),this.shaders.cleanUp(),this.shaders=void 0,this.batch=void 0,this.home.closeBatch(),this.home=void 0},this.home=e,this.shaders=new m.Z([]),this.batch=new Array,this.flow=(0,h.T)("div",{className:"flow"},(0,h.T)("div",{id:"flow-offering",className:"flatbox-content"})),this.flow.style.height=(0,h.ZP)("home").clientHeight-400+"px",this.content=(0,h.T)("div",{id:"batch-content",className:"batch-holder"});const s=(0,h.T)("div",{className:"content"});s.innerHTML=`\n            <label class="pad-0">${(0,a.Z)("dialogSaveFileType")}</label>\n            <div id="batch-format-switch" class="switch-field" style="width:230px">\n                <input type="radio" id="batch-format-jpg" name="batch-format" value="jpg" checked/><label for="batch-format-jpg">jpg</label>\n                <input type="radio" id="batch-format-png" name="batch-format" value="png" /><label for="batch-format-png">png</label>\n                <input type="radio" id="batch-format-webp" name="batch-format" value="webp" /><label for="batch-format-webp">webp</label>\n            </div>\n\n            <label class="pad-20">${(0,a.Z)("quality")}</label>\n            <div id="batch-quality-switch" class="switch-field" style="width:230px">\n                <input type="radio" id="batch-quality-low" name="batch-quality" value="50"/><label for="batch-quality-low">${(0,a.Z)("dialogSaveLow")}</label>\n                <input type="radio" id="batch-quality-med" name="batch-quality" value="70" /><label for="batch-quality-med">${(0,a.Z)("dialogSaveMed")}</label>\n                <input type="radio" id="batch-quality-high" name="batch-quality" value="90" checked /><label for="batch-quality-high">${(0,a.Z)("dialogSaveHigh")}</label>\n            </div>\n        `,(0,h.ZP)("home-wrap").append((0,h.T)("div",{id:"batch-flow"},(0,h.T)("div",{className:"flatbox tasks"},(0,h.T)("span",{className:"title"},(0,a.Z)("batchEdit")),(0,h.T)("div",{className:"icon-button",style:"position:absolute;left:6px;top:6px",onclick:this.close},(0,h.T)("img",{src:"/img/icon/home.svg",className:"ic",width:22,height:22,loading:"lazy"})),(0,h.T)("div",{className:"splitter"}),(0,h.T)("div",{className:"flatbox-content"},(0,h.T)("div",{id:"batch-tasks",style:"display:none"}),(0,h.T)("p",{id:"batch-description"},(0,a.Z)("batchDesk")),(0,h.T)("div",{style:"text-align:center",className:"pad-30"},(0,h.T)("a",{id:"batch-open-macro",className:"link"},(0,a.Z)("macroOpen")),(0,h.T)("span",{style:"display:inline-block;padding-left:8px;padding-right:8px"},(0,a.Z)("or")),(0,h.T)("a",{id:"batch-save-macro",className:"link"},(0,a.Z)("macroSave"))))),(0,h.T)("div",{className:"flatbox tasks pad-20"},(0,h.T)("span",{className:"title"},(0,a.Z)("addTask")),(0,h.T)("div",{className:"splitter"}),this.flow)),(0,h.T)("div",{id:"batch-section",className:"flatbox"},this.content,(0,h.T)("div",{className:"buttons pad-20"},(0,h.T)("a",{id:"batch-clear",className:"button negative"},(0,a.Z)("clear")),(0,h.T)("a",{id:"batch-cancel",className:"button negative"},(0,a.Z)("close")))),(0,h.T)("div",{id:"batch-out",className:"flatbox"},(0,h.T)("img",{id:"batch-close",className:"close ic",src:"/img/icon/close.svg"}),(0,h.T)("span",{className:"title"},(0,a.Z)("output")),(0,h.T)("div",{className:"splitter"}),s,(0,h.T)("div",{className:"buttons pad-20"},(0,h.T)("a",{id:"batch-export",className:"button positive w-100"},(0,a.Z)("export"))))),(0,h.ZP)("batch-clear").addEventListener("click",this.clear),(0,h.ZP)("batch-close").addEventListener("click",this.close),(0,h.ZP)("batch-cancel").addEventListener("click",this.close),(0,h.ZP)("batch-export").addEventListener("click",this.export),(0,h.ZP)("batch-save-macro").addEventListener("click",this.saveMacro),(0,h.ZP)("batch-open-macro").addEventListener("click",this.openMacro),this.appendAllTasks(),this.appendAddImage(),new f.Z(this.flow),t&&this.append(t)}}i()}catch(k){i(k)}}))},6577:(e,t,s)=>{s.d(t,{Z:()=>c});var i=s(6548),a=s(3947),n=s(4820),o=s(7909),r=s(9344),h=s(1951),l=s(840);class c extends o.Z{constructor(e,t,o){var c,d,u,p,g;super(!0),this.checkoutUrl="/checkout/payments",this.encryptedCardData={isValid:!1,paymentMethod:null},this.billingAddress={},this.currency="USD",this.subDuration="month",this.checkoutMode="checkout",this.currencySymbol="$",this.monthName=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],this.checkoutPlan="premium-monthly",this.renewalPrice=7.99,this.totalPrice=7.99,this.promoCode={promoApplied:!1,code:"",discountedAmount:0},this.isPaypal=!1,this.paypalCheckoutSubscriptionsUrl="/paypal/subscriptions",this.paypalCheckoutTemplateUrl="/paypal/templates",this.tax={status:!1},this.paymentMethodOption="",this.contentForm="",this.billingDetailsForm="",this.freeTrial=!1,this.populateCountry=async()=>{const e=await fetch("/api/country"),t=await e.json();this.countryList=Object.assign({},t.data);const s=(0,a.ZP)("country");for(const i in this.countryList.country){const e=(0,a.T)("option",{value:this.countryList.country[i]},this.countryList.country[i]);i===n.ZP.user.country&&(e.selected=!0),s.append(e)}this.updateCountry()},this.creditCardForm=async()=>{var e;const[t]=await Promise.all([s.e(600).then(s.bind(s,4884)).then((e=>e.default)),s.e(600).then(s.bind(s,697))]);(0,a.ZP)("billing-page").classList.add("hide"),(0,a.ZP)("google_pay").classList.add("hide"),(0,a.ZP)("payment-method").classList.remove("hide"),(0,a.ZP)("card-page").classList.remove("hide"),(0,a.ZP)("back-premium-icon").classList.remove("hide"),null===(e=(0,a.ZP)(`${this.checkoutType}-pay-btn`))||void 0===e||e.classList.remove("hide"),"subscription"===this.checkoutType?this.freeTrial?(0,a.ZP)("subscription-pay-btn").innerText="Start 30 Days free Trial":(0,a.ZP)("subscription-pay-btn").innerText=`Pay ${this.currencySymbol}${this.totalPrice.toFixed(2)}`:(0,a.ZP)("template-pay-btn").innerHTML=(0,i.Z)("payNow"),this.isReadyToPay();const{paymentMethods:o}=await this.getPaymentMethods(this.checkoutPlan);return new t({locale:"en_US",environment:"pixlr.com"===window.location.hostname?"live":"test",clientKey:n.ZP.adyenClientKey,paymentMethodsResponse:o,onChange:this.handleOnChange}).create("card",{hasHolderName:!0,holderNameRequired:!0}).mount("#component-container"),!0},this.paypalForm=()=>{var e;(0,a.ZP)("google_pay").classList.add("hide"),(0,a.ZP)("card-page").classList.add("hide"),(0,a.ZP)(`${this.checkoutType}-pay-btn`).innerHTML="Continue on paypal",null===(e=(0,a.ZP)(`${this.checkoutType}-pay-btn`))||void 0===e||e.removeAttribute("disabled")},this.gPayFrom=()=>{var e;(0,a.ZP)("google_pay").classList.remove("hide"),(0,a.ZP)("card-page").classList.add("hide"),(0,a.ZP)(`${this.checkoutType}-pay-btn`).innerHTML="Continue",null===(e=(0,a.ZP)(`${this.checkoutType}-pay-btn`))||void 0===e||e.removeAttribute("disabled")},this.checkoutMethod=()=>{for(var e=document.getElementsByName("payment"),t=0;t<e.length;t++)1==e[t].checked&&this.paymentSection(e[t].value)},this.paymentMethods=()=>{this.paymentMethodOption=`\n            <div id="payment-method" class="hide top-20">\n                <h2>${(0,i.Z)("paymentMethod")}</h2>\n                <div class="top-20">\n                    <div class="radio-options">\n                        <input type="radio" name="payment" value="adyen" id="adyen-radio-option" checked />\n                        <label for="adyen-radio-option">${(0,i.Z)("useCreditCard")}</label>\n                    </div>\n                    <div class="radio-options" style="margin-left:10px">\n                        <input type="radio" name="payment" value="paypal" id="paypal-radio-option" />\n                        <label for="paypal-radio-option"> <img class="paypal-icon" src="/img/icon/paypal.png"/></label>\n                    </div>\n                </div>\n            </div>\n        `},this.paymentSection=async e=>{if("paypal"===e)this.paypalForm(),this.isPaypal=!0;else this.creditCardForm(),this.isPaypal=!1},this.showAndGetBilling=()=>{(0,a.ZP)("card-page").classList.add("hide"),(0,a.ZP)("payment-method").classList.add("hide"),(0,a.ZP)("billing-page").classList.remove("hide"),(0,a.ZP)("back-premium-icon").classList.add("hide");const e=(0,a.ZP)("billing-address").getElementsByTagName("input");for(let t=0;t<e.length;t++){const s=e[t];s.addEventListener("keyup",(()=>{this.billingAddress[s.id]=s.value,this.isReadyToPay()}))}},this.updateCountry=()=>{const e=Object.keys(this.countryList.country).find((e=>this.countryList.country[e]===(0,a.ZP)("country").value));this.countryList.tax[e]?(this.tax.status=!0,this.tax.percentage=this.countryList.tax[e]):this.tax.status=!1,this.countryList.countryEU.some((t=>t===e))?this.currency="EUR":this.currency="USD",this.currencySymbol="USD"===this.currency?"$":"",Array.from(document.getElementsByClassName("currency")).forEach((e=>e.innerHTML=this.currency)),Array.from(document.getElementsByClassName("currency-symbol")).forEach((e=>e.innerHTML=this.currencySymbol)),this.updatePrice()},this.resultModal=e=>{(0,a.ZP)("overview").style.display="none",(0,a.ZP)("checkout").style.display="none";const t=e.status;return(t||"success"===t)&&(n.ZP.user=e.data.settings),document.contains((0,a.ZP)("result-modal"))&&(0,a.ZP)("result-modal").remove(),e.loading?`\n            <div id="result-modal">\n                <img class="loader" src="/images/myaccount/black-loading.gif" alt="loading">'\n                <h1 class="pad-30">${(0,i.Z)("pleaseCompleteYourPaymentAtPaypal")}!</h1>\n                <p class="pad-10">${(0,i.Z)("pleaseDoNotRefreshOrCloseThisPageWhilePaymentIsProcessing")}.</p>\n                <p>${(0,i.Z)("youWillAutomaticallyBeRedirectedToTheEditor")}</p>\n            </div>\n            `:t||"success"===t?`\n            <div id="result-modal">\n                <img src="/images/myaccount/green-tick.png" alt="success">'\n                <h1 class="pad-30">${(0,i.Z)("thankYouForYourPurchase")}!</h1>\n                ${"template"===this.checkoutType?`<p class="pad-10">${(0,i.Z)("theTemplateIsLoading")}.</p>`:""}\n                <p>${(0,i.Z)("youWillAutomaticallyBeRedirectedToTheEditor")}</p>\n            </div>`:`\n            <div id="result-modal">\n                <img src="/images/myaccount/red-cross.png" alt="fail">\n                <h1 class="pad-30">${(0,i.Z)("paymentFailed")}</h1>\n                <p class="pad-10">${(0,i.Z)("paymentUnsuccessful")}.</p>\n            </div>`},this.billingInput=(e,t=100,s)=>`\n            <div class="form-group w-${t}">\n                <span class="adyen-checkout__label__text">${(0,i.Z)(e)}</span>\n                <input type="text" id="${e}" maxlength="56" ${s?`value="${s}"`:""} required>\n            </div>\n        `,this.countryInput=(e,t=100)=>`\n            <div class="form-group w-${t}">\n                <span class="adyen-checkout__label__text">${(0,i.Z)(e)}</span>\n                <select id="${e}" name="${e}" class="country-select"></select>\n            </div>\n        `,this.handleOnChange=e=>{const{data:{paymentMethod:t},isValid:s}=e;this.encryptedCardData.isValid=s,this.encryptedCardData.paymentMethod=t,this.encryptedCardData.cardHolderName=document.getElementsByClassName("adyen-checkout__input--text")[0].value,this.isReadyToPay()},this.getPaymentMethods=async e=>{try{const t=await fetch("/checkout/paymentmethods",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({splan:e})});return await t.json()}catch({message:t,response:s}){return{message:s.data.message}}},this.getCheckoutData=()=>{const e={paymentMethod:this.encryptedCardData.paymentMethod,billingAddress:this.billingAddress,currency:this.currency,promo:this.promoCode,upgradeDetails:{type:"checkout"},freeTrialSource:"editor",checkoutMethod:this.checkoutMode};return"subscription"===this.checkoutType?(e.splan=this.checkoutPlan,this.freeTrial&&(e.freeTrial="true")):"template"===this.checkoutType&&(e.templateId=this.templateId),e},this.makePayment=async()=>{var e;if(!this.isReadyToPay())return;if(null===(e=(0,a.ZP)(`${this.checkoutType}-pay-btn`))||void 0===e||e.setAttribute("disabled","true"),this.isPaypal)return this.paypalCheckout();this.billingAddress.country=(0,a.ZP)("country").value;let t="subscription"===this.checkoutType?this.checkoutUrl:this.checkoutUrl+"/template/";const s=this.getCheckoutData();s.captchaToken="!!";const i=this.getUTMParam();try{const e=await fetch(t+"?platform=editor"+i,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(s)}),a=await e.json();this.setContent(this.resultModal(a)),a.status&&setTimeout((()=>{this.stage.unblock(),null==this||this.cleanUp()}),2500)}catch({message:n}){this.setContent(this.resultModal({status:!1}))}},this.paypalCheckout=async()=>{const e="subscription"===this.checkoutType?this.paypalCheckoutSubscriptionsUrl:this.paypalCheckoutTemplateUrl,t=this.getCheckoutData();try{const s=await fetch(e+"?platform=editor",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(t)}),i=await s.json();if(i.status){const e=this.createPopupWin(i.redirectUrl,"Paypal Checkout",800,650);this.setContent(this.resultModal({loading:!0}));const t=await(0,r.n)((async()=>{try{const e=await this.getPaypalResult(i.id,this.checkoutType);return Promise.resolve(e)}catch(e){return Promise.reject(e)}}),500,15e3);"success"===t.status?(e.close(),this.setContent(this.resultModal(t)),setTimeout((()=>{null==this||this.cleanUp(),this.stage.unblock()}),2500)):console.log("failed modal?")}else this.setContent(this.resultModal({status:!1}))}catch(s){console.error(s),this.setContent(this.resultModal({status:!1}))}},this.getPaypalResult=async(e,t)=>(await fetch(`/paypal/polling?id=${e}&type=${t}`,{method:"POST",headers:{"Content-Type":"application/json"}})).json(),this.promoCodeOnInput=()=>{const e=(0,a.ZP)("promocode-input");e.value=e.value.toUpperCase()},this.applyPromoCode=async()=>{var e;if("REMOVE"===(0,a.ZP)("promocode-submit").innerText)return this.removePromoCode(),!1;const t=(0,a.ZP)("promocode-input");this.options.code&&((0,a.ZP)("promocode-add").style.display="none",(0,a.ZP)("promocode-toggle").style.display="block",t.value=this.options.code);let s=null!==(e=this.options.code)&&void 0!==e?e:t.value.toUpperCase();try{const e=await fetch(`/api/promo/status/?code=${s}&product=Pixlr Premium&splan=${this.checkoutPlan}`),i=await e.json();if(!i.status)throw new Error("Invalid promocode!");const{percentage:n,amount:o,productName:r,productCode:h}=i.promo;return(0,a.ZP)("promocode-percentage").innerText=n?`${n}% Off first paying month`:`${o} Only first paying month`,this.promoCode=Object.assign(Object.assign({},this.promoCode),{percentage:n,amount:o,productName:r,productCode:h}),this.promoCode.code=s,this.togglePromoApplied(),this.updatePrice(),t.readOnly=!0,(0,a.ZP)("promo-tac").style.display="none",(0,a.ZP)("promocode-submit").innerText="REMOVE",!0}catch({response:i,message:n}){return s="",t.value="",(0,a.ZP)("promocode-error").style.display="block",setTimeout((()=>{(0,a.ZP)("promocode-error").style.display="none"}),1500),!1}},this.removePromoCode=()=>{this.promoCode={promoApplied:!1,code:"",discountedAmount:0},this.updatePrice(this.renewalPrice);const e=(0,a.ZP)("promocode-input");e.value="",e.readOnly=!1,(0,a.ZP)("promo-tac").style.display="block",(0,a.ZP)("promo-section").style.display="flex",(0,a.ZP)("promocode-submit").innerText="APPLY"},this.togglePromoApplied=()=>{this.promoCode.promoApplied=!this.promoCode.promoApplied},this.updatePrice=e=>{if(e&&(this.renewalPrice=e,this.totalPrice=e),this.promoCode.promoApplied){const e="All Plans"===this.promoCode.productName,t="Pixlr Premium"===this.promoCode.productName&&!this.promoCode.productCode,s="Pixlr Premium"===this.promoCode.productName&&this.promoCode.productCode===this.checkoutPlan;e||t||s?(this.promoCode.percentage&&(this.promoCode.discountedAmount=this.renewalPrice*(this.promoCode.percentage/100)),this.promoCode.amount&&(this.promoCode.discountedAmount=this.promoCode.amount)):this.removePromoCode()}if(this.tax.status?this.tax.amount=(this.renewalPrice-this.promoCode.discountedAmount)*(this.tax.percentage/100):this.tax.amount=0,this.totalPrice=this.renewalPrice-this.promoCode.discountedAmount+this.tax.amount,this.freeTrial){const e=new Date;e.setMonth(e.getMonth()+1);const t=`${e.getDate()} ${this.monthName[e.getMonth()]} ${e.getFullYear()}`,s=document.getElementById("freetrial-note");null!=s&&(s.innerHTML=`${(0,i.Z)("yourFreeTrialWillEndOn")} <b>${t}</b> ${(0,i.Z)("andYouWillBeCharged")} <b>${this.currencySymbol}${this.totalPrice.toFixed(2)}</b> ${(0,i.Z)("forTheFollowingPayingMonth")}.`,s.style.display="block")}(0,a.ZP)("plan-price")&&((0,a.ZP)("plan-price").innerText=this.renewalPrice.toFixed(2)),(0,a.ZP)("total-price")&&((0,a.ZP)("total-price").innerText=`${this.currencySymbol}${this.freeTrial?"0.00":this.totalPrice.toFixed(2)}`),(0,a.ZP)("subscription-pay-btn")&&(this.freeTrial?(0,a.ZP)("subscription-pay-btn").innerText=`${(0,i.Z)("startOneMonthFreeTrial")}`:(0,a.ZP)("subscription-pay-btn").innerText=`Pay ${this.currencySymbol}${this.totalPrice.toFixed(2)}`),this.shouldShowPriceSummary()},this.toggleCheckoutPlan=()=>{"stack"===this.checkoutMode&&((0,a.ZP)("checkout-plan").checked=!0);const e=(0,a.ZP)("checkout-plan").checked;n.ZP.eligibleFreeTrial&&!e?this.freeTrial=!0:this.freeTrial=!1,e?(this.checkoutPlan="premium-yearly",(0,a.ZP)("switch-handle").classList.remove("switch-label-monthly"),(0,a.ZP)("switch-handle").classList.add("switch-label-yearly"),(0,a.ZP)("save-38").innerHTML='You\'re saving <span style="color:#c70909;">38%</span>',(0,a.ZP)("plan-duration").innerText="year",(0,a.ZP)("yearly-discount").style.display="block",(0,a.ZP)("freetrial-note").style.display="none",this.updatePrice(59),this.checkoutMethod()):(this.checkoutPlan="premium-monthly",(0,a.ZP)("switch-handle").classList.remove("switch-label-yearly"),(0,a.ZP)("switch-handle").classList.add("switch-label-monthly"),(0,a.ZP)("save-38").innerHTML='Pay yearly to <span style="color:#c70909;">Save 38%</span>',(0,a.ZP)("plan-duration").innerText="month",(0,a.ZP)("yearly-discount").style.display="none",(0,a.ZP)("freetrial-note").style.display=this.freeTrial?"block":"none",this.updatePrice(7.99),this.checkoutMethod())},this.isReadyToPay=()=>{var e,t;const{isValid:s,paymentMethod:i}=this.encryptedCardData,n=Object.values(this.billingAddress).length;try{if(this.isPaypal)return!0;if(!s)throw!1;if(0===this.encryptedCardData.cardHolderName.length)throw!1;if(0!==n&&6!==n)throw!1;return null===(e=(0,a.ZP)(`${this.checkoutType}-pay-btn`))||void 0===e||e.removeAttribute("disabled"),!0}catch({message:o}){return null===(t=(0,a.ZP)(`${this.checkoutType}-pay-btn`))||void 0===t||t.setAttribute("disabled","true"),!1}},this.createPopupWin=(e,t,s,i)=>{const a=(screen.width-s)/2,n=(screen.height-i)/4;return window.open(e,t,`resizable=yes,width=${s},height=${i},top=${n},left=${a}`)},this.backPreviousPopup=()=>{switch(this.cleanUp(),this.options.bounceSource){case"premiumbounce":new h.Z(this.stage,this.options.bounceType);break;case"premiumtemplatebounce":new l.Z(this.stage)}},this.shouldShowPriceSummary=()=>{this.promoCode.promoApplied?((0,a.ZP)("promo-summary").style.display="block",(0,a.ZP)("promo-details").innerHTML=`- ${this.currencySymbol}${this.promoCode.discountedAmount.toFixed(2)}`):((0,a.ZP)("promo-summary").style.display="none",(0,a.ZP)("promo-details").innerHTML=""),this.tax.status?((0,a.ZP)("tax-summary").style.display="block",(0,a.ZP)("tax-details").innerHTML=`${this.currencySymbol}${this.tax.amount.toFixed(2)}`):((0,a.ZP)("tax-summary").style.display="none",(0,a.ZP)("tax-details").innerHTML="")},this.getUTMParam=()=>{const e={};let t="";return this.options.utm_source&&(e.utm_source=this.options.utm_source),this.options.utm_medium&&(e.utm_medium=this.options.utm_medium),this.options.utm_campaign&&(e.utm_campaign=this.options.utm_campaign),t+=Object.keys(e).map((t=>t+"="+e[t])).join("&"),t?`&${t}`:t},this.stage=e,this.checkoutType=t,this.currency="USD",this.options=o,"template"===t&&(this.templateId=null!==(u=null===(d=null===(c=this.stage.fresco)||void 0===c?void 0:c.templateMeta)||void 0===d?void 0:d.templateId)&&void 0!==u?u:"-",this.renewalPrice=1,this.totalPrice=1),"subscription"===t&&this.options.plan&&(this.checkoutPlan=this.options.plan),"subscription"===t&&"premium-yearly"===this.checkoutPlan&&(this.renewalPrice=this.totalPrice=59),"subscription"===t&&"premium-monthly"===this.checkoutPlan&&n.ZP.eligibleFreeTrial&&(this.freeTrial=!0),this.options.checkoutMode&&(this.checkoutMode=this.options.checkoutMode),this.paymentMethodOption=`\n            <div id="payment-method" class="hide top-20">\n                <h2 class="pad-30">${(0,i.Z)("paymentMethod")}</h2>\n                <div class="top-20">\n                    <div class="radio-options">\n                        <input type="radio" name="payment" value="adyen" id="adyen-radio-option" data-checked="true" checked/>\n                        <label for="adyen-radio-option">${(0,i.Z)("useCreditCard")}</label>\n                    </div>\n                    <div class="radio-options ${"stack"===this.checkoutMode?"hidden":""}" style="margin-left:10px">\n                        <input type="radio" name="payment" value="paypal" id="paypal-radio-option" data-checked="false"/>\n                        <label for="paypal-radio-option"> <img class="paypal-icon" src="/img/icon/paypal.png"/></label>\n                    </div>\n                </div>\n            </div>\n        `,this.contentForm=`\n            <div id="card-page" class="hide">\n                <div class="w-100">\n                    <div id="component-container" style="padding-top: 25px"></div>\n                    <div id="add-billing-container">\n                        <a id="add-billing-info" class="anchor-blue"><img src="/img/icon/plus-circle-light-blue.svg">${(0,i.Z)("AddOptionalBillingInformation")}</a>\n                    </div>\n                </div>\n            </div>\n            <div id="google_pay" class="hide">\n                <div class="container pt-2">\n                    <div class="row gpay_div d-flex align-content-center flex-wrap ">\n                        <div>\n                            <h3 class="gpay_text_color">Google Play</h3>\n                            <span>click continue button to proceed payment <br /> with google play</span>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `,this.billingDetailsForm=`\n            <div id="billing-page" class="hide">\n                <img id="back-billing-icon" src="/img/icon/arrow-left-black.svg">\n                <div class="billing-form w-100">\n                    <h2 class="pad-30">${(0,i.Z)("billingDetailsSmallCap")}</h2>\n                    <form id="billing-address">\n                        <div class="flex">\n                            ${this.billingInput("firstName",50)}\n                            ${this.billingInput("lastName",50)}\n                        </div>\n                        <div class="flex">\n                            ${this.billingInput("address",100)}\n                        </div>\n                        <div class="flex">\n                            ${this.billingInput("city",50)}\n                            ${this.billingInput("zipCode",50)}\n                        </div>\n                        <div class="flex">\n                            ${this.billingInput("state",50)}\n                            ${this.countryInput("country",50)}\n                        </div>\n                    </form>\n                </div>\n\t\t\t</div>\n        `;const m=`\n            <div>\n                <input type="checkbox" class="toggle-check" id="checkout-plan" />\n                <label class="switch pad-4" for="checkout-plan">\n                    <span id="switch-handle" class="switch-label-monthly ${"stack"===this.checkoutMode?"cursor-error":""}" data-on="Monthly" data-off="Yearly"></span>\n                </label>\n            </div>\n        `,v=`\n            <a id="promocode-add">${(0,i.Z)("iHaveAPromoCode")}!</a>\n            <span id="gpay-promo" class="hide">Please add promo code in Google Pay window</span>\n            <div id="promocode-toggle" style="display:none">\n                <p class="heavy">Promo Code </p>\n                <div id="promo-section">\n                    <input type="text" id="promocode-input" placeholder="Promo Code *">\n                    <span id="promocode-submit" class="apply">Apply</span>\n                </div>\n                <p id="promocode-error">Invalid promo code!</p>\n                <p id="promo-tac" style="font-size: 10px; color: #666">* ${(0,i.Z)("promoCode")}</p>\n            </div>\n        `,f=`\n            <div id="breakdown-summary" class="top-20">\n                <p id="yearly-discount" style="display:none;margin: 6px 0 0;">\n                    ${(0,i.Z)("yearlyPlanOff")}\n                    <span style="float:right;color:#c70909;">-<span class="currency-symbol">$</span>37.00</span>\n                </p>\n                <p id="promo-summary" style="display:none;margin: 6px 0 0;">\n                    ${(0,i.Z)("promoCode")}: \n                    <span id="promocode-percentage"></span>\n                    <span id="promo-details" style="float:right;"></span>\n                </p>\n                <p id="tax-summary" style="display:none;margin: 6px 0 0;">\n                    GST: 7%\n                    <span id="tax-details" style="float:right;"></span>\n                </p>\n            </div>\n        `,y=`\n            <div id="premium-options" class="padding-35">\n                <div class="card" style="height:100%">\n\n                    <div style="background-color:#fafafa;margin:-15px -15px 0 -15px;padding:15px;">\n                        <h2>${(0,i.Z)("orderSummary")}</h2>\n                        <h3 class="pad-10">Pixlr Premium <a class="link" style="float:right;" href="/pricing/" target="_blank">${(0,i.Z)("planBenefits")}</a></h3>\n                        <div class="row v-center pad-10">\n                            ${m}\n                            <p id="save-38">${(0,i.Z)("payYearlyTo")} <span style="color:#c70909;">${(0,i.Z)("save")} 38%</span></p>\n                        </div>\n                        <p><span class="currency">${this.currency}</span> <span id="plan-price">${this.totalPrice}</span>/<span id="plan-duration">${this.subDuration}</span>  ${(0,i.Z)("autorenewalBasis")}</p>\n                    \n                        <p class="slanted">${(0,i.Z)("youCanCancelAuto")}.</p>\n                    </div>\n\n                    ${v}\n                    ${f}\n                    <div class="row space-between pad-15">\n                        <h3 class="caps heavy" style="opacity: 1;color: #333">${(0,i.Z)("total")}</h3>\n                        <h3 style="font-size: 18px;opacity: 1;color: #333">\n                            <span class="currency heavy">${this.currency}</span>\n                            <span id="total-price">${this.currencySymbol}${this.totalPrice}</span>\n                        </h3>\n                    </div>\n                    <button id="subscription-pay-btn" class="button big blue w-100 pad-15">Pay ${this.currencySymbol}${this.totalPrice}</button>\n                    <span id="freetrial-note" class="pad-10"></span>\n                    \n                </div>\n            </div>\n        `,w=`\n            <div id="premium-options" class="padding-35">\n                <div class="card" style="height:100%">\n                    <h2>${(0,i.Z)("orderSummary")}</h2>\n                    <p style="text-transform: capitalize; font-weight: bold;">Pixlr Template</p>\n                    <p><span class="currency">${this.currency}</span> ${this.currencySymbol}1.00/template</p>\n\n                    <div class="row space-between pad-15 template-info">\n                        <div id="template-canvas" style="padding:9px;"></div>\n                        <div class="desc">${(0,i.Z)("dontJustPayForOne")} <span id="premium-check">here</span></div>\n                    </div>\n                    ${f}\n                    <div class="row space-between pad-15">\n                        <h3 style="font-size:18px" class="caps">${(0,i.Z)("total")}</h3>\n                        <h3 style="font-size:18px">\n                            <span class="currency">${this.currency}</span>\n                            <span id="total-price">${this.currencySymbol}${this.totalPrice.toFixed(2)}</span>\n                        </h3>\n                    </div>\n                    <button id="template-pay-btn" class="button big blue w-100 pad-15">${(0,i.Z)("payNow")}</button>\n                </div>\n            </div>\n        `;this.content.style.padding="40px",this.setContent(`\n            <div id="checkout" class="padding-35 w-50">\n                <img id="back-premium-icon" class="hide" src="/img/icon/arrow-left-black.svg">\n                ${this.paymentMethodOption}\n                ${this.contentForm}\n                ${this.billingDetailsForm}\n            </div>\n            <div id="overview" class="left-panel">\n            </div>\n        `),"template"===t?((0,a.ZP)("overview").innerHTML=w,(0,a.ZP)("template-canvas").appendChild(this.stage.getOutputCanvas(.08)),(0,a.ZP)("premium-check").addEventListener("click",(()=>{this.cleanUp(),new l.Z(this.stage)}))):((0,a.ZP)("overview").innerHTML=y,(0,a.ZP)("checkout-plan").addEventListener("change",this.toggleCheckoutPlan),(0,a.ZP)("promocode-submit").addEventListener("click",this.applyPromoCode),(0,a.ZP)("promocode-input").addEventListener("input",this.promoCodeOnInput),(0,a.ZP)("promocode-add").addEventListener("click",(()=>{(0,a.ZP)("promocode-toggle").style.display="block",(0,a.ZP)("promocode-add").style.display="none"})),"premium-yearly"===this.checkoutPlan&&(0,a.ZP)("checkout-plan").click(),this.options.code&&this.applyPromoCode()),null===(p=(0,a.ZP)(`${this.checkoutType}-pay-btn`))||void 0===p||p.addEventListener("click",this.makePayment),(0,a.ZP)("add-billing-info").addEventListener("click",this.showAndGetBilling),(0,a.ZP)("back-billing-icon").addEventListener("click",this.creditCardForm),(0,a.ZP)("paypal-radio-option").addEventListener("click",this.checkoutMethod),(0,a.ZP)("adyen-radio-option").addEventListener("click",this.checkoutMethod),(0,a.ZP)("back-premium-icon").classList.remove("hide"),(0,a.ZP)("back-premium-icon").addEventListener("click",this.backPreviousPopup),null===(g=(0,a.ZP)("country"))||void 0===g||g.addEventListener("change",this.updateCountry),this.creditCardForm(),this.populateCountry(),this.position()}}},2409:(e,t,s)=>{s.d(t,{Ev:()=>n,V:()=>o,ZF:()=>h});var i=s(3947),a=s(4820);async function n(){if(!("getDigitalGoodsService"in window))return!1;try{return!!(await window.getDigitalGoodsService("https://play.google.com/billing"))}catch(e){return console.log(e),!1}}async function o(e,t){const s=(0,i.pR)("__pat",""),n="premium_monthly",o="product_1",h="com.pixlr."+a.ZP.product;if("getDigitalGoodsService"in window)try{const i=await window.getDigitalGoodsService("https://play.google.com/billing");if(i){if(!("PaymentRequest"in window))return console.log("something went wrong"),!1;{const a=new PaymentRequest([{supportedMethods:"https://play.google.com/billing",data:{sku:e?o:n}}]);try{const l=await a.show();if(await l.complete(),e){let e=await async function(e,t,s,i,a){try{const n=await fetch("/api/purchase/validate/google",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:"Bearer "+e},body:JSON.stringify({productId:t,packageName:i,purchaseToken:s,itemId:a})});return null!=(await n.json()).status}catch(n){return console.log(n),!1}}(s,o,l.details.token,h,t);return e?"acknowledge"in i?(console.log("v1"),await i.acknowledge(l.details.token,"repeatable"),!0):(await i.consume(l.details.token),console.log("v2"),!0):(console.log("status false"),!1)}return!!(await r(s,n,l.details.token,h))&&("acknowledge"in i&&await i.acknowledge(l.details.token,"onetime"),!0)}catch(l){return console.log("catch false"),console.log(l),!1}}}}catch(l){return console.log(l),!1}}async function r(e,t,s,i,a=!1){try{const n=await fetch("/api/subscription/validate/google",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:"Bearer "+e},body:JSON.stringify({productId:t,packageName:i,purchaseToken:s,freeTrial:a})});return null!=(await n.json()).status}catch(n){return console.log(n),!1}}async function h(){const e=(0,i.pR)("__pat",""),t="com.pixlr."+a.ZP.product;if(!("getDigitalGoodsService"in window))return console.log("no digital good window"),!1;try{const i=await window.getDigitalGoodsService("https://play.google.com/billing");if(!i)return console.log("no playbilling service"),!1;{const a=await i.listPurchases();if(a&&a.length)for(const i of a)try{const s=await fetch("/api/subscription/google/get",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({packageName:t,productId:i.itemId,purchaseToken:i.purchaseToken})}),a=await s.json();if(a&&0===a.data.acknowledgementState){return!!(await r(e,i.itemId,i.purchaseToken,t,!0))}}catch({message:s,response:n}){return console.log(n),!1}}}catch(o){return console.error("Play billing",o),!1}}},9344:(e,t,s)=>{async function i(e,t=5e3,s=3e4){const i=(new Date).getTime()+s,a=(s,n)=>{Promise.resolve(e()).then((e=>{console.log(e);const o=(new Date).getTime();"success"===e.status?s(e):o<i||"pending"===e.status?setTimeout(a,t,s,n):n(new Error("AsyncPoller: reached timeout"))})).catch((e=>{n(e)}))};return new Promise(a)}s.d(t,{n:()=>i})},3770:(e,t,s)=>{s.d(t,{X3:()=>a});var i=s(3655);async function a(){try{return await r.open()}catch(e){return Promise.resolve(new c)}}class n{constructor(e){this.next=()=>this.queue.pop(),this.queue=[new i.L5];let t=this.queue[0];e.onsuccess=()=>{const s=e.result;s?(t.resolve({done:!1,value:s.value}),t=new i.L5,this.queue.unshift(t),s.continue()):t.resolve({done:!0,value:void 0})},e.onerror=()=>{t.reject(e.error)}}[Symbol.asyncIterator](){return this}}class o{constructor(e){this.inner=e}static bound(e,t,s=!1,i=!1){return new o(IDBKeyRange.bound(e,t,s,i))}static lowerBound(e,t){return new o(IDBKeyRange.lowerBound(e,t))}static upperBound(e,t){return new o(IDBKeyRange.upperBound(e,t))}static only(e){return new o(IDBKeyRange.only(e))}static unwrap(e){return e instanceof o?e.inner:e}}class r{constructor(e){this.underlying=e}static availiable(){return!navigator.userAgent.includes("Edge")&&!!window.indexedDB}transaction(e,...t){const s=this.underlying.transaction(t,e);return t.map((e=>new h(s.objectStore(e))))}}r.open=async()=>r.availiable()?new Promise(((e,t)=>{const s=window.indexedDB.open("pixlr",2);s.onupgradeneeded=e=>{const t=s.result;0===e.oldVersion?(t.createObjectStore("blobs"),t.createObjectStore("fonts"),t.createObjectStore("document-meta",{keyPath:"id"}),t.createObjectStore("document-selection"),t.createObjectStore("document-thumbnail"),t.createObjectStore("layer-meta",{keyPath:"id"}).createIndex("document","document"),t.createObjectStore("layer-mask"),t.createObjectStore("layer-bitmap")):t.deleteObjectStore("history")},s.onerror=e=>t(s.error),s.onsuccess=()=>e(new r(s.result))})):Promise.reject(new Error("Browser does not support indexedDB"));class h{constructor(e){this.underlying=e}get(e){return new Promise(((t,s)=>{const i=this.underlying.get(e);i.onsuccess=()=>t(i.result),i.onerror=()=>s(i.error)}))}getAll(e,t){return new Promise(((s,i)=>{const a=this.underlying.getAll(o.unwrap(e),t);a.onsuccess=()=>s(a.result),a.onerror=()=>i(a.error)}))}iterate(e,t){const s=this.underlying.openCursor(o.unwrap(e),t);return new n(s)}index(e){const t=this.underlying.index(e);return new l(t)}cursor(e,t,s){return new Promise(((i,a)=>{const n=this.underlying.openCursor(o.unwrap(t),s);n.onsuccess=()=>{const t=n.result;if(t){const s=e(t.value,t);"number"==typeof s?t.advance(s):!1!==s?t.continue():i()}else i()},n.onerror=()=>a(n.error)}))}put(e,t){return new Promise(((s,i)=>{const a=this.underlying.put(e,t);a.onsuccess=()=>{s()},a.onerror=()=>{i(a.error)}}))}add(e,t){return new Promise(((s,i)=>{const a=this.underlying.add(e,t);a.onsuccess=()=>{s()},a.onerror=()=>{i(a.error)}}))}clear(){return new Promise(((e,t)=>{let s=this.underlying.clear();s.onsuccess=()=>e(),s.onerror=()=>t(s.error)}))}count(e){return new Promise(((t,s)=>{let i;i=void 0===e?this.underlying.count():this.underlying.count(o.unwrap(e)),i.onsuccess=()=>t(i.result),i.onerror=()=>s(i.error)}))}delete(e){return new Promise(((t,s)=>{const i=this.underlying.delete(o.unwrap(e));i.onsuccess=()=>t(),i.onerror=()=>s(i.error)}))}}class l{constructor(e){this.underlying=e,this.name=e.name,this.keyPath=e.keyPath,this.multiEntry=e.multiEntry,this.unique=e.unique}get(e){return new Promise(((t,s)=>{const i=this.underlying.get(e);i.onsuccess=()=>t(i.result),i.onerror=()=>s(i.error)}))}getAll(e,t){return new Promise(((s,i)=>{const a=this.underlying.getAll(o.unwrap(e),t);a.onsuccess=()=>s(a.result),a.onerror=()=>i(a.error)}))}count(e){return new Promise(((t,s)=>{let i;i=void 0===e?this.underlying.count():this.underlying.count(o.unwrap(e)),i.onsuccess=()=>t(i.result),i.onerror=()=>s(i.error)}))}cursor(e,t,s){return new Promise(((i,a)=>{const n=this.underlying.openCursor(o.unwrap(t),s);n.onsuccess=()=>{const t=n.result;t?(e(t.value,t),t.continue()):i()},n.onerror=()=>a(n.error)}))}iterate(e,t){const s=this.underlying.openCursor(o.unwrap(e),t);return new n(s)}getAllKeys(e,t){return new Promise(((s,i)=>{const a=this.underlying.getAllKeys(o.unwrap(e),t);a.onsuccess=()=>s(a.result),a.onerror=()=>i(a.error)}))}}class c{transaction(e,...t){return t.map((e=>new d(e)))}}class d{constructor(e){this.name=e}index(e){return this}put(e,t){}add(e,t){}clear(){}delete(e){}async get(e){}async getAll(e,t){return[]}async count(e){return 0}async cursor(e,t,s){}iterate(e,t){return{next:()=>Promise.resolve({done:!0,value:void 0}),[Symbol.asyncIterator](){return this}}}}},3947:(e,t,s)=>{s.d(t,{Rg:()=>r,T:()=>n,ZP:()=>a,pR:()=>o});var i=s(3673);function a(e){return document.getElementById(e)}function n(e,...t){const s=document.createElement(e);if(0===t.length)return s;const i=t[0],a=!("string"==typeof i||i instanceof HTMLElement),n=a?t.slice(1):t;if(a&&i)if(i.style){const e=i.style;delete i.style,Object.assign(s,i),"string"==typeof e?s.setAttribute("style",e):Object.assign(s.style,e)}else Object.assign(s,i);return s.append(...n.filter((e=>null!=e))),s}function o(e,t){const s=document.cookie.split(";").map((e=>e.trim().split("="))).find((([t,s])=>t===e));return s?s[1]:t}function r(e,t,s,a){e.style.touchAction="none";const n=e=>{e.stopPropagation(),e.preventDefault(),s&&s(new i.Z(e.clientX,e.clientY))},o=t=>{t.stopPropagation(),t.preventDefault(),a&&a(new i.Z(t.clientX,t.clientY)),e.removeEventListener("pointermove",n,!0),e.removeEventListener("pointerup",o,!0),e.releasePointerCapture(t.pointerId)};e.addEventListener("pointerdown",(s=>{s.preventDefault(),s.button>0||(e.addEventListener("pointermove",n,!0),e.addEventListener("pointerup",o,!0),e.setPointerCapture(s.pointerId),t&&t(new i.Z(s.clientX,s.clientY)))}),!0)}},7163:(e,t,s)=>{s.d(t,{Z:()=>h});var i=s(3655),a=s(3770),n=s(5574),o=s(7758);class r{constructor(e,t,s=!1,i="woff",a,n){this.name=e,this.short=t,this.premium=s,this.local=!!a,this.thumb=n,this.font=a,this.type=i}static async save(e){const t=await(0,a.X3)(),[s]=t.transaction("readwrite","fonts");await s.put(e,e.name)}static async delete(e){const t=await(0,a.X3)(),[s]=t.transaction("readwrite","fonts");await s.delete(e.name)}}class h{static async loadFontFromTemplate(e,t,s){var i,a;let n=null===(i=s.split(".")[0])||void 0===i?void 0:i.toLowerCase(),o=null===(a=s.split(".")[1])||void 0===a?void 0:a.toLowerCase();return await h.createLocalFontDesc(e,t,n,o)}static async loadFontFromUpload(e){var t,s;let i=null===(t=e.name.split(".")[0])||void 0===t?void 0:t.toLowerCase().substring(0,50).replace(" ","-"),a=null===(s=e.name.split(".")[1])||void 0===s?void 0:s.toLowerCase(),n=i.substring(0,20).replace("-","").toLowerCase();if(i=(null==i?void 0:i.charAt(0).toUpperCase())+(null==i?void 0:i.slice(1)),h.fontList.find((e=>e.name===i)))return void document.dispatchEvent(new CustomEvent("notification",{detail:"Font already exists!"}));let o=a;switch(a){case"otf":o="opentype";break;case"ttf":o="truetype"}const r=new Blob([e],{type:"font/"+o});let l=await h.createLocalFontDesc(r,i,n,a);return l&&document.dispatchEvent(new CustomEvent("notification",{detail:"Font was added!"})),l}static async createLocalFontDesc(e,t,s,a){const n=new r(t,s,!1,a,e);try{await h.addToDOM(n)}catch(p){return console.log(p),void document.dispatchEvent(new CustomEvent("notification",{detail:"Failed to load font!"}))}let l=new o.Z(t,56);l.height>72&&l.setSize(Math.floor(72/l.height*56));const c=i.vL(400,80),d=c.getContext("2d");d.font=l.getCssFont(),d.fillStyle="#ffffff",d.textBaseline="top",d.fillText(t,0,Math.round((80-l.height)/2)-l.ascent);var u;return n.thumb=await(u=c,new Promise(((e,t)=>{u.toBlob((t=>{e(t)}),"image/png")}))),await r.save(n),h.fontList.unshift(n),n}static async removeLocalFontDesc(e){let t=h.getFontDesc(e);t&&(await r.delete(t),h.fontList=h.fontList.filter((e=>e!==t)))}static async addToDOM(e){if(!e)return;const t=e.local?new FontFace(e.name,await(0,n.h0)(e.font)):new FontFace(e.name,`url(/font/${e.short}.woff) format('woff')`);if(document.fonts.has(t))return Promise.resolve(t);let s=await t.load();return document.fonts.add(s),s}static getFontDesc(e){return h.fontList.find((t=>t.name===e))}static async getFontFile(e){let t=this.getFontDesc(e);if(!t)return;if(t.local)return new File([t.font],t.name);let s=await fetch("/font/"+t.short+".woff").then((e=>e.blob()));return s?new File([s],t.short+".woff",{type:"font/woff"}):void 0}static async loadSaved(){const e=await(0,a.X3)(),[t]=e.transaction("readonly","fonts");return t.iterate()}}h.fontList=[new r("Arial","arial"),new r("Courier New","courier"),new r("Georgia","georgia"),new r("Trebuchet MS","trebuchet"),new r("Verdana","verdana"),new r("Aberus","aberus"),new r("Ablation","ablation",!0),new r("Adeft","adeft"),new r("Adelya","adelya",!0),new r("Adios Amigos","adios"),new r("Adolfine","adolfine"),new r("Agnostic","agnostic",!0),new r("Aiden","aiden"),new r("Amaranth","amaranth"),new r("Amateur Typewriter","amateur",!0),new r("Alder","alder",!0),new r("Almondia","almondia"),new r("Aloma Island","alomaisland",!0),new r("Alvida","alvida"),new r("Amoreiza","amoreiza"),new r("AmoretteLight","amorette"),new r("Angeleno Brush Script","angeleno",!0),new r("Antreas","antreas"),new r("Arm Race","arm"),new r("Artick","artick"),new r("Asap","asap"),new r("Atomsfer","atomosfer"),new r("Atthens","atthens"),new r("Avocado Sans","avocado",!0),new r("Baangkarr Press","baangkarr",!0),new r("Badstar","badstar",!0),new r("Bahram","bahram"),new r("Baileyns","baileyns"),new r("Barooduck","barooduck",!0),new r("Bearley","bearley"),new r("Beat","beat",!0),new r("BebasNeue","bebasneue"),new r("Bellquinas","bellquinas"),new r("Bengrraas","bengrraas"),new r("Beornheard","beornheard"),new r("Berretti","berretti"),new r("Biker New","biker",!0),new r("Blossom Berry Script","blossomberry",!0),new r("Boullervard","boullervard"),new r("Bondie","bondie",!0),new r("Bondrians","bondrians",!0),new r("Braga Deco","braga"),new r("Brave Hearted","brave"),new r("Bright Orchid","brightorchid",!0),new r("Brioche","brioche",!0),new r("Brocklyn","brocklyn"),new r("Bronzier","bronzier",!0),new r("Brooklyn","brooklyn",!0),new r("Brodetto","brodetto"),new r("Bronela","bronela",!0),new r("The Brownies","brownies"),new r("Bubbble Gum","bubbblegum",!0),new r("Brushcheetah","brushcheetah"),new r("Butternut Script","butternut",!0),new r("Caang","caang"),new r("Cakehtreuks","cakehtreuks"),new r("Cannoli Poke","cannoli",!0),new r("Camille","camille"),new r("Calamandria","calamandria"),new r("Caldwell","caldwell",!0),new r("Carafun","carafun"),new r("Carnavonts","carnavonts"),new r("Carvino","carvino"),new r("Cervantes","cervantes"),new r("Chaiaathah","chaiaathah",!0),new r("Chalkyal","chalkyal"),new r("Chiqarine","chiqarine"),new r("Chukies","chukies"),new r("Cincoyo","cincoyo"),new r("Clockwise","clockwise",!0),new r("Coast Redwood","coast"),new r("Colombo","colombo",!0),new r("College","college",!0),new r("Companion","companion"),new r("Corlombus","corlombus"),new r("Conseration","conseration",!0),new r("CuprumFFU","cuprum"),new r("Cupello sons","cupello",!0),new r("Costa Mala","costamala",!0),new r("Cozy","cozy",!0),new r("CreamyMoony","creamy"),new r("Cross Road","crossroad",!0),new r("Cross Road Slab","crossroadslab",!0),new r("Daddy Day","daddy"),new r("Dankduck","dankduck"),new r("Darbots","darbots",!0),new r("Davish","davish",!0),new r("Davish Rounded","davishround",!0),new r("Dear Journal","dearjournal",!0),new r("Delicious","delicious",!0),new r("Desmodus","desmodus"),new r("Desmosedici","desmosedici"),new r("Dhangdose","dhangdose"),new r("Dingle","dingle",!0),new r("Djangart Rough","djangart"),new r("Dolington","dolington",!0),new r("Doppelganger","doppelganger",!0),new r("Dorr","dorr",!0),new r("Dustin","dustin",!0),new r("Earth And Sky","earth"),new r("Easterica","easterica"),new r("Eastone","eastone"),new r("Eastwood","eastwood",!0),new r("Echizen","echizen"),new r("El-Karnito","elkarnito"),new r("Elliot","elliot"),new r("Elysian","elysian",!0),new r("Emery","emery"),new r("Empire View","empire"),new r("Eugiene","eugiene"),new r("Espano","espano",!0),new r("Erleane","erleane"),new r("Everleigh","everleigh",!0),new r("Exquisite","exquisite",!0),new r("Espano","espano",!0),new r("Farewell Angelina","angelina",!0),new r("Father and Son","father"),new r("Fatherly","fatherly"),new r("Fenord","fenord",!0),new r("Finland","finland",!0),new r("Flamingo","flamingo"),new r("FoxyMist","foxy"),new r("Forever Freedom","forever",!0),new r("Game On","game"),new r("Gamour","gamour",!0),new r("Gallerina","gallerina",!0),new r("Geronide","geronide",!0),new r("Geronide Stamp","geronidestamp",!0),new r("Gingle Snowland","ginglesnowland",!0),new r("Gingerbreads","gingerbreads"),new r("Gladiolusy","gladiolusy",!0),new r("Glamper","glamper",!0),new r("Goldie Dreambox","goldiedreambox",!0),new r("Gordon","gordon",!0),new r("Gorgeous","gorgeous",!0),new r("Gingerly","gingerly",!0),new r("Goorraatt","goorraatt"),new r("Grayson","grayson",!0),new r("Great Again","great"),new r("Grovana","grovana",!0),new r("Gustavo","gustavo"),new r("Haahloddoh","haahloddoh"),new r("Hadrea","hadrea"),new r("Hairmusk","hairmusk"),new r("Hakushou","hakushou"),new r("Harietta","harietta",!0),new r("Hattori Hanzo","hattori"),new r("Haystacks","haystacks",!0),new r("Heater","heater"),new r("Hedonist","hedonist",!0),new r("Hello Alpha","helloa"),new r("Hello Daddy","hellod",!0),new r("Hello People","hello"),new r("Hello Spring","hellospring",!0),new r("Hellowins","hellowins"),new r("Heypatricks","heypatricks"),new r("Highway","highway",!0),new r("Hippo Letto","hippo"),new r("Historia","historia",!0),new r("Hollawind","hollawind"),new r("Hodor","hodor",!0),new r("Honey","honey"),new r("Honeyspice","honeyspice",!0),new r("Huckleberries","huckleberries"),new r("Hymned Sans","hymnedsans",!0),new r("Hymned Script","hymnedscript",!0),new r("IacottNeue","iacottneue",!0),new r("Icebold","icebold",!0),new r("Inder","inder"),new r("Indigo","indigo",!0),new r("Irish gold","irishgold"),new r("Irishgreen","irishgreen"),new r("Its mine","itsmine"),new r("Jacinda","jacinda",!0),new r("Jared","jared"),new r("Jarots","jarots"),new r("Jomantara","jomantara"),new r("Josefin","josefin"),new r("Juneville","juneville"),new r("Jura","jura"),new r("Kajika","kajika"),new r("Kakamora","kakamora"),new r("Katey Blue","kateyblue",!0),new r("Keripik","keripik"),new r("Ketapang","ketapang"),new r("Kindel","kindel",!0),new r("Kingbirds","kingbirds",!0),new r("Laahleggek","laahleggek"),new r("Laborations","laborations"),new r("La Fiesta","lafiesta"),new r("Landon","landon"),new r("Landre","landre",!0),new r("Langley","langley"),new r("La Vonn","vonn"),new r("Laudya Bloods","laudya"),new r("Leaderson","leaderson"),new r("Leath","leath"),new r("Legendum","legendum"),new r("Leobronx","leobronx"),new r("Little Edelweiss","little"),new r("Little Girl","littlegirl"),new r("Lotus Eater","lotuseater",!0),new r("Lobster","lobster"),new r("Lovalicious","lovalicious",!0),new r("Loverstruck","loverstruck"),new r("MaaLLaangBronks","maallaangbronks"),new r("Madison","madison"),new r("Magic Winter","magicwinter"),new r("Magic Trick","magic"),new r("Mai Leho Bahhrala","maileho"),new r("Maldisa","maldisa"),new r("Malinsha","malinsha",!0),new r("Maple Leaves","mapleleaves",!0),new r("Maxton","maxton"),new r("Market","market"),new r("Marones","marones",!0),new r("Me and my dog","meandmydog",!0),new r("Meidy","meidy"),new r("Menighampiil","menighampiil"),new r("Mewton","mewton"),new r("Merry Merry","merrymerry",!0),new r("Molot","molot"),new r("Momday","momday"),new r("Moms Note","moms"),new r("Monday Lovers","monday"),new r("Monetta","monetta"),new r("Mongli","mongli"),new r("Montour","montour"),new r("Morissette Script","morissette"),new r("Mountain","mountain"),new r("Mooka","mooka",!0),new r("More Magic","moremagic",!0),new r("Morgana Sonz","morgana",!0),new r("Nature Force","natureforce",!0),new r("Ms Orange Sky","ms"),new r("Najova","najova"),new r("Natarajasana","natarajasana"),new r("Naville","naville"),new r("Neorah","neorah"),new r("New Autumn","new"),new r("No Siesta","nosiesta"),new r("Night Jump","nightjump"),new r("Notes","notes",!0),new r("NoFire","nofire"),new r("North Avellion","northavellion",!0),new r("Northern","northern"),new r("North High Shadow","northhighsdw",!0),new r("North High","northhigh",!0),new r("Novante","novante",!0),new r("Nunu","nunu"),new r("Offlander","offlander",!0),new r("Oliemolly","oliemolly",!0),new r("Oracles","oracles"),new r("Ostern","ostern"),new r("Otakaku","otakaku"),new r("Out Hill","out"),new r("Overdose","overdose"),new r("Paabaalioot","paabaalioot"),new r("Painted Gallery","paintedgallery",!0),new r("Pandoura","pandoura"),new r("PapaRocknRoll","papa"),new r("Paradise","paradise"),new r("Patlabour","patlabour",!0),new r("Peach Market","peachmarket",!0),new r("Peanut","peanut"),new r("Peony Rose","peonyrose",!0),new r("Perfect Thoughts","perfectthoughts",!0),new r("Pina Colada","pinacolada",!0),new r("Piqolo","piqolo"),new r("Pixelo","pixelo"),new r("Plunge","plunge"),new r("Pop Fist","pop"),new r("Ponch","ponch",!0),new r("Popera","popera"),new r("Powder","powder",!0),new r("Practish","practish"),new r("Print Clearly","print"),new r("Pulsate","pulsate",!0),new r("Qlassik","qlassik"),new r("quatro","quatro",!0),new r("Quattrocento","quattrocento"),new r("Queenata","queenata"),new r("Quella Script","quella"),new r("Questro","questro"),new r("Quickie Sweet","quickie"),new r("Quill & Ink","quillink"),new r("Quish","quish"),new r("Ranania","ranania"),new r("Rankings Caps","rankingscaps",!0),new r("Raroedette","raroedette"),new r("Rawwwing","rawwwing"),new r("Raquella","raquella"),new r("Reepouh","reepouh"),new r("Regan Slab","regan"),new r("Reewoooh","reewoooh",!0),new r("Reilly","reilly"),new r("Remembrance","remembrance",!0),new r("Retrocycles","retrocycles"),new r("Retros","retros"),new r("Revans","revans",!0),new r("Reynolds Square","reynoldssquare",!0),new r("Rhapsody","rhapsody"),new r("Riverside","riverside"),new r("Republiko","republiko",!0),new r("Rocky","rocky"),new r("Roars","roars"),new r("Rockford","rockford",!0),new r("Rockrace","rockrace",!0),new r("Romaniesta","romaniesta"),new r("Romelio","romelio"),new r("Roossooh","roossooh"),new r("Ropa","ropa"),new r("Rolves","rolves",!0),new r("Roque","roque"),new r("Rosario","rosario"),new r("Roundaries","roundaries"),new r("Rowan","rowan",!0),new r("Salmonberry","salmonberry",!0),new r("San Barley","san"),new r("Saqanone","saqanone"),new r("Sants","sants"),new r("Sanur beach","sanur"),new r("Scriptonesia","scriptonesia",!0),new r("Secretary Typewriter","secretary",!0),new r("Sedalia","sedalia",!0),new r("Search","search",!0),new r("Searchlight","searchlight",!0),new r("See De Mayo","see"),new r("Serenity","serenity"),new r("The Servant","servant"),new r("Sheraton","sheraton",!0),new r("Shoelaces","shoelaces",!0),new r("Silvertone","silvertone",!0),new r("Smoother","smoother",!0),new r("Spring Break","springbreak",!0),new r("Spotlights Thin","spotlightsthin",!0),new r("Spotlights Chunky","spotlightschunky",!0),new r("Squiborn","squiborn",!0),new r("Staatliches","staatliches"),new r("Stardust Moonlight","stardust"),new r("The Stoothgart","stoothgart"),new r("Summer Coconut","summer"),new r("Summer Joy","summerjoy"),new r("Summer Nude","summernude",!0),new r("Summer Peach","summerpeach"),new r("Summer Solstice","summersolstice",!0),new r("Summery","summery"),new r("Sun Again","sunagain"),new r("Sun Pepper","sun"),new r("Sun Streets","sunstreets"),new r("Sunny Bay","sunnybay",!0),new r("Sunshine Boy","sunshine"),new r("Super Slayers","super"),new r("Surface","surface"),new r("Sweeneey","sweeneey"),new r("Teaspoon","teaspoon"),new r("Tabu","tabu"),new r("Teodore","teodore",!0),new r("TeXGyreHeros","texgyreheros"),new r("The Brocker","brocker"),new r("The California","thecalifornia"),new r("The Harison","harison"),new r("The Love For Money","theloveformoney",!0),new r("The Mastiff","mastiff"),new r("The Patriot","patriot"),new r("The Pinta","pinta"),new r("The Roxv","roxv"),new r("The Rogue","rogue"),new r("The Stegris","thestegris",!0),new r("The Queen","queen"),new r("Thirtylane","thirtylane",!0),new r("Titian","titian"),new r("Todes","todes",!0),new r("Tropical Coast","tropicalcoast"),new r("Torberta","torberta"),new r("Twigs","twigs"),new r("Twirly Ballerina","twirly",!0),new r("Unreal","unreal"),new r("Vaganza","vaganza"),new r("Valeria","valeria",!0),new r("Valery","valery"),new r("Vignette","vignette"),new r("Von Everect","von"),new r("The Voyager","voyager",!0),new r("Wandering Flowers","wandering",!0),new r("Wargate","wargate",!0),new r("Western Shooter","westernshooter",!0),new r("West Java","westjava",!0),new r("Winter Sunrise","wintersunrise",!0),new r("White Wonder","whitewonder",!0),new r("Yanone Kaffeesatz","kaffeesatz"),new r("Wonderul Wilderness","wonderulwilderness",!0),new r("Yoseline","yoseline"),new r("Zombie Dust","zombie")],h.loadFont=e=>{let t=h.fontList.find((t=>t.name===e));if(t)return h.addToDOM(t)}},5574:(e,t,s)=>{async function i(e,t){return new Promise(((s,i)=>{var a=new XMLHttpRequest,n=!1;a.responseType="arraybuffer",a.withCredentials=!1,a.open("GET",e,!0),a.onprogress=function(e){e.lengthComputable?t&&t(e.loaded/e.total*100):n||(n=!0,t&&t(-1))},a.onloadend=function(){a.status.toString().match(/^2/)?(n||t&&t(100),s(new Blob([this.response],{type:a.getResponseHeader("Content-Type")}))):i(a)},a.send()}))}function a(e){return new Promise(((t,s)=>{let i=new Image;i.onload=()=>t(i),i.onerror=e=>s(e),i.src=e}))}function n(e){return new Promise(((t,s)=>{const i=new FileReader;i.onerror=()=>s(i.error),i.onloadend=()=>t(i.result),i.readAsArrayBuffer(e)}))}function o(e){return new Promise((async(t,s)=>{const i=URL.createObjectURL(e);let a=new Image;a.crossOrigin="Anonymous",a.onload=()=>{URL.revokeObjectURL(i),a.width+a.height==0?s("Could not open file!"):t(a)},a.onerror=function(){URL.revokeObjectURL(i),s("Could not open file!")},a.name=e instanceof File?e.name:"",a.src=i}))}s.d(t,{OA:()=>a,c6:()=>i,h0:()=>n,s4:()=>o})},1302:(e,t,s)=>{s.d(t,{Z:()=>i,m:()=>a});class i{constructor(){this.addTask=(e,t,s)=>{let i={task:e};void 0!==t&&(i.param=t),void 0!==s&&(i.target=s),this.macro.push(i)},this.addChain=e=>{for(var t=0;t<e.length;t++)if(!1===e[t].sidekick)switch(e[t].type){case"border":let s=e[t].value;this.addTask("border",{size:Number(s.size.toFixed(2)),color:s.color.toHEX()});break;case"monochrome":let i=e[t].value;this.addTask("monochrome",{r:Number(i.r.toFixed(3)),g:Number(i.g.toFixed(3)),b:Number(i.b.toFixed(3))});break;default:this.addTask(e[t].type,{amount:Number(e[t].value.toFixed(2))})}},this.toJson=()=>JSON.stringify({macro:this.macro}),this.toBlob=()=>new Blob([this.toJson()],{type:"application/json"}),this.macro=new Array}}class a{constructor(){this.parseJsonString=e=>JSON.parse(e).macro}}},5934:(e,t,s)=>{s.d(t,{$k:()=>I,Hi:()=>R,Q0:()=>L,ZB:()=>A,d3:()=>F});var i=s(6548),a=s(3655),n=s(4375),o=s(5574),r=s(3947),h=s(2542),l=s(8776),c=s(3673),d=s(9591),u=s(6817),p=s(6584),g=s(9868),m=s(1030),v=s(4820),f=s(4170),y=s(8685),w=s(7108),b=s(1294),x=s(2282),Z=s(7359),k=s(7758),P=s(4686),E=s(9067),S=s(7163),T=(s(5453),s(8027)),C=s(2804);function L(e,t=!1){return new Promise(((s,i)=>{(0,r.ZP)("browse")&&(0,r.ZP)("browse").remove();let a=document.createElement("input");a.id="browse",a.type="file",a.multiple=e,a.className="offscreen",t&&(a.accept="image/*",a.capture="camera"),a.addEventListener("change",(()=>{a.files.length>0&&s(a.files),(0,r.ZP)("workspace").removeChild(a)}),!1),(0,r.ZP)("workspace").appendChild(a),a.click()}))}async function M(e){await async function(e,t,s=3e4){let i=!1;for(let a=0;a<document.head.childNodes.length;a++){const t=document.head.childNodes[a];if(t.nodeType===Node.ELEMENT_NODE&&t.getAttribute("src")===e){i=!0;break}}i||document.head.appendChild((0,r.T)("script",{src:e}));let n=0;for(;!t();){if(n>=s)throw new Error(`Timeout triggered when loading script ${e}`);const t=500;n+=t,await a.Dc(t)}}("/js/psd.js",(()=>window.require&&window.require("psd")));const t=window.require("psd"),s=await new Response(e).arrayBuffer(),i=new t(new Uint8Array(s));return i.parse(),i}async function A(e,t,i=!0,n="add"){var r,l;if(t){const d=null!==(r=t.type)&&void 0!==r?r:"";(0,m.Z)("open-file",d);try{switch(d){case"image/psd":case"application/psd":case"application/photoshop":case"application/x-photoshop":case"image/vnd.adobe.photoshop":(0,m.Z)("open-file","image/psd"),await z(e,t);break;case"image/tiff":await async function(e,t){const i=await async function(e){const t=await s.e(556).then(s.t.bind(s,4166,23));let i=await(0,o.h0)(e);return new t.default({buffer:i})}(t);let a=t.name.replace(/^.*[\\\/]/,"");e.addImage(i.toCanvas(),a,"add")}(e,t);break;default:const r=null===(l=t.name)||void 0===l?void 0:l.toLowerCase();if(r){if(r.endsWith(".psd"))return(0,m.Z)("open-file","image/psd"),void(await z(e,t));if(r.endsWith(".pxd"))return(0,m.Z)("open-file","image/pxd"),void(await async function(e,t){document.dispatchEvent(new CustomEvent("loading",{detail:"start"}));const{PXD:i}=await s.e(215).then(s.bind(s,8132)),n=await(0,o.h0)(t),r=i.decode(new Uint8Array(n)),h=new T.Z(a.M8(),t.name,r.width,r.height);try{e.supressRender=!0,e.addTab(h,"document");for(let t=0;t<r.layers;t++){const t=r.takeNextLayer(),s=t.width,i=t.height;switch(t.kind){case"bitmap":case"shape":{if(0===s||0===i){const s=new x.Z(a.M8(),t.name,void 0,void 0,!1);s.settings.opacity=t.alpha,s.settings.blendmode=t.blendMode,s.settings.visible=t.visible,s.settings.locked=t.locked,e.fresco.layers.push(s),t.free();continue}const n=a.vL(s,i),o=n.getContext("2d"),r=t.takeCanvas();o.putImageData(new ImageData(r,s,i),0,0);const h=new x.Z(a.M8(),t.name,n,new u.Z(t.x,t.y,s,i,t.rotation),t.locked);h.settings.opacity=t.alpha,h.settings.blendmode=t.blendMode,h.settings.visible=t.visible;const l=t.takeMask();if(l.length>0){const e=a.vL(s,i);e.getContext("2d").putImageData(new ImageData(l,s,i),0,0),h.mask=e,h.render()}e.fresco.layers.push(h);break}case"text":{const n=JSON.parse(t.meta),o=new k.Z(n.textSettings.font,n.textSettings.size);Object.assign(o,n.textSettings);const r=new y.Z(a.M8(),n.text,new u.Z(t.x,t.y,s,i,t.rotation),o);r.settings.opacity=t.alpha,r.settings.blendmode=t.blendMode,r.settings.visible=t.visible,await S.Z.loadFont(o.font),o.measureText(),await r.prepare(),e.fresco.layers.push(r)}}t.free()}}finally{r.free(),e.supressRender=!1,document.dispatchEvent(new CustomEvent("loading",{detail:"stop"}))}return await e.syncDocument(e.fresco),e.selectLayer(e.fresco.layers[0]),e.setZoom("fit"),document.dispatchEvent(new CustomEvent("layer-list-render")),Promise.reject()}(e,t));if(r.endsWith(".pxz"))return(0,m.Z)("open-file","image/pxz"),void(await D(e,t));if(r.endsWith(".svg")&&"frame"!==n)return(0,m.Z)("open-file","image/svg+xml"),void(await async function(e,t,s=!0,i){let a=await t.text();e.addSVGShape(a,t.name,"add")}(e,t,i));if(r.endsWith(".otf")||r.endsWith(".ttf")||r.endsWith(".woff")||r.endsWith(".woff2"))return(0,m.Z)("open-file","font/"+t.name.split(".")[1]),void(await S.Z.loadFontFromUpload(t))}await async function(e,t,s=!0,i){const n=await(0,o.s4)(t);let r,l,c="e"===v.ZP.product&&s||"e"!==v.ZP.product?"create":"layer";if(("x"===v.ZP.product||"drop"===i)&&(c=s&&e.fresco?await(new g.Z).init():e.fresco?"layer":"create","close"===c))return;if(v.ZP.askToPreResize&&"m"!==v.ZP.product&&"create"===c&&(n.width>2500||n.height>2500)){if([r,l]=await new p.Z(n,await h.Z.rotation(t)).init(),void 0===r)return}else r=u.Z.bestFit(n.width,n.height,v.ZP.user.subscription?8196:4096,v.ZP.user.subscription?8196:4096).size(),l=0;let d=a.qT(n,r.width>r.height?r.width:r.height,l),m=t.name?t.name:n.src.replace(/^.*[\\\/]/,"");"create"===c&&e.addTab(new T.Z(a.M8(),m,d.width,d.height),"image");e.addImage(d,m,i)}(e,t,i,n)}}catch(c){throw document.dispatchEvent(new CustomEvent("loading",{detail:"stop"})),c}}else document.dispatchEvent(new CustomEvent("loading",{detail:"stop"}))}async function R(e,t){let s=await C._y(t);await I(e,s)}async function I(e,t){(0,m.Z)("template-"+t.category,t.id);const{url:s,purchased:a}=await C.cI(t.id),o=new n.Z(e,{title:t.name,referrer:(0,i.Z)("templates")});let r=await o.load(s);if(!r)return;let h={locked:t.premium&&!v.ZP.user.subscription,premium:t.premium,templateId:t.id,categoryId:t.categoryId};a&&(h.locked=!1);try{(0,m.Z)("open-file","image/pxz"),await D(e,r,h)}catch(l){throw document.dispatchEvent(new CustomEvent("loading",{detail:"stop"})),l}}async function D(e,t,i){const{ZipReader:n}=await s.e(215).then(s.bind(s,8132));let o;try{e.supressRender=!0;let s=await t.arrayBuffer();o=new n(new Uint8Array(s));let h=o.readString("manifest.json"),l=JSON.parse(h);const d=new T.Z(a.M8(),l.name,l.width,l.height,l.background,l.animation,i);e.addTab(d,"template"),document.dispatchEvent(new CustomEvent("loading",{detail:"start"}));try{let t=o.readFile("thumbnail.webp"),s=await a.Td(new Blob([t.buffer]));e.renderPreview(s)}catch(r){console.log(r)}let u=await _(l,new c.Z,o);e.fresco.layers.push(...u),await e.syncDocument(e.fresco)}catch(h){return console.log(h),void alert("Error while loading PXZ file :(")}finally{null==o||o.free(),e.supressRender=!1,document.dispatchEvent(new CustomEvent("loading",{detail:"stop"}))}e.selectLayer(e.fresco.layers[0]),e.setZoom("fit"),document.dispatchEvent(new CustomEvent("layer-list-render"))}async function F(e,t){let s;document.dispatchEvent(new CustomEvent("loading",{detail:"start"}));let i=new c.Z;try{const a=await fetch(t),n=await a.json();i.x=Math.round((e.fresco.width-n.width)/2),i.y=Math.round((e.fresco.height-n.height)/2),s=await _(n,i)}catch(a){console.log(a),document.dispatchEvent(new CustomEvent("loading",{detail:"stop"}))}s&&0!==s.length&&(e.addLayer(s),document.dispatchEvent(new CustomEvent("loading",{detail:"stop"})),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-list-render")))}async function _(e,t=new c.Z,s,i){var n;let r=new Array;if(e.stack)for(let h=0;h<e.stack.length;h++){let c=e.stack[h];switch(c.type){case f.Z.TYPE_IMAGE:case f.Z.TYPE_ELEMENT:{let e,n=c.rect?new u.Z(c.rect.x+t.x,c.rect.y+t.y,c.rect.w,c.rect.h,c.rect.r):void 0;if(void 0!==c.content)if(s){let t=s.readFile(c.content);t&&(e=await a.Td(new Blob([t.buffer])))}else{let t=await(0,o.c6)(i+c.content);t&&(e=await a.Td(t))}let h=new x.Z(a.M8(),c.name,e,n,c.locked);if(void 0!==c.opacity&&(h.settings.opacity=c.opacity),void 0!==c.blendmode&&(h.settings.blendmode=c.blendmode),void 0!==c.locked&&(h.settings.locked=c.locked),void 0!==c.visible&&(h.settings.visible=c.visible),void 0!==c.animation&&(h.animation=c.animation),void 0!==c.macro&&(h.macro=c.macro),void 0!==c.mask&&s){let e=s.readFile(c.mask);e&&(h.mask=await a.Td(new Blob([e.buffer]))),h.render()}r.push(h);break}case f.Z.TYPE_TEXT:{if(!c.format)continue;let e=new k.Z(null===(n=c.format.font)||void 0===n?void 0:n.name,c.format.size);void 0!==c.format.align&&(e.align=c.format.align),void 0!==c.format.bold&&(e.bold=c.format.bold),void 0!==c.format.italic&&(e.italic=c.format.italic),void 0!==c.format.underline&&(e.undeline=c.format.underline),void 0!==c.format.uppercase&&(e.uppercase=c.format.uppercase),void 0!==c.format.linespace&&(e.lineSpace=c.format.linespace),void 0!==c.format.letterspace&&(e.letterSpace=c.format.letterspace);let h=new y.Z(a.M8(),c.content,new u.Z(c.rect.x+t.x,c.rect.y+t.y,c.rect.w,c.rect.h,c.rect.r),e);if(void 0!==c.opacity&&(h.settings.opacity=c.opacity),void 0!==c.blendmode&&(h.settings.blendmode=c.blendmode),void 0!==c.locked&&(h.settings.locked=c.locked),void 0!==c.visible&&(h.settings.visible=c.visible),void 0!==c.animation&&(h.animation=c.animation),void 0!==c.macro&&(h.macro=c.macro),e.font){let t=S.Z.getFontDesc(e.font);if(!t&&c.format.font.content){let e;e=s?new Blob([s.readFile(c.format.font.content)]):await(0,o.c6)(i+c.format.font.content),e&&(t=await S.Z.loadFontFromTemplate(e,c.format.font.name,c.format.font.content))}else t&&await S.Z.addToDOM(t);e.measureText()}if(c.style&&(c.style.curve&&(h.textSettings.curve=!0,void 0!==c.style.curve.type&&(h.textSettings.curveType=c.style.curve.type),void 0!==c.style.curve.amount&&(h.textSettings.curveAmount=c.style.curve.amount),void 0!==c.style.curve.spread&&(h.textSettings.curveSpread=c.style.curve.spread),void 0!==c.style.curve.flip&&(h.textSettings.curveFlip=c.style.curve.flip)),c.style.background&&(h.textSettings.background=!0,void 0!==c.style.background.color&&(h.textSettings.backgroundColor=c.style.background.color),void 0!==c.style.background.type&&(h.textSettings.backgroundType=c.style.background.type),void 0!==c.style.background.punch&&(h.textSettings.backgroundPunch=c.style.background.punch),void 0!==c.style.background.offset&&(h.textSettings.backgroundOffset=c.style.background.offset)),c.style.outline&&(h.textSettings.outline=!0,void 0!==c.style.outline.size&&(h.textSettings.outlineSize=c.style.outline.size),void 0!==c.style.outline.color&&(h.textSettings.outlineColor=c.style.outline.color),void 0!==c.style.outline.punch&&(h.textSettings.outlinePunch=c.style.outline.punch),void 0!==c.style.outline.distance&&(h.textSettings.outlineDistance=c.style.outline.distance),void 0!==c.style.outline.direction&&(h.textSettings.outlineDirection=c.style.outline.direction)),c.style.shadow&&(h.textSettings.shadow=!0,void 0!==c.style.shadow.blur&&(h.textSettings.shadowBlur=c.style.shadow.blur),void 0!==c.style.shadow.color&&(h.textSettings.shadowColor=c.style.shadow.color),void 0!==c.style.shadow.opacity&&(h.textSettings.shadowAlpha=c.style.shadow.opacity),void 0!==c.style.shadow.distance&&(h.textSettings.shadowDistance=c.style.shadow.distance),void 0!==c.style.shadow.direction&&(h.textSettings.shadowDirection=c.style.shadow.direction))),void 0!==c.format.fill){let e;switch(c.format.fill.type){case"color":e=new d.Z(l.Z.fromHEX(c.format.fill.value));break;case"gradient":e=new d.Z(Z.ZP.fromIGradient(c.format.fill.value));break;case"pattern":let t=c.format.fill.value;if(s)t.svg=s.readString(t.svg);else{let e=await(0,o.c6)(i+t.svg);e&&(t.svg=await e.text())}e=new d.Z(await E.Z.fromIPattern(t))}h.textSettings.fillType=e.getType(),h.textSettings.fillValue=e.getStringValue(),h.fill=e}await h.prepare(),h.settings.name=c.name,r.push(h);break}case f.Z.TYPE_SHAPE:{let e=new P.Z;if(e.variant=c.format?c.format.variant:"svg","svg"===e.variant){let t;if(c.content)if(s)t=s.readString(c.content);else{let e=await(0,o.c6)(i+c.content);e&&(t=await e.text())}if(!t)continue;e.content=t}"path"===e.variant&&(e.content=c.content),c.style&&(c.style.outline&&(void 0!==c.style.outline.size&&(e.outlineSize=c.style.outline.size),void 0!==c.style.outline.color&&(e.outlineColor=c.style.outline.color)),c.style.shadow&&(e.shadow=!0,void 0!==c.style.shadow.blur&&(e.shadowBlur=c.style.shadow.blur),void 0!==c.style.shadow.color&&(e.shadowColor=c.style.shadow.color),void 0!==c.style.shadow.opacity&&(e.shadowOpacity=c.style.shadow.opacity),void 0!==c.style.shadow.distance&&(e.shadowDistance=c.style.shadow.distance),void 0!==c.style.shadow.direction&&(e.shadowDirection=c.style.shadow.direction)));let n=new w.Z(a.M8(),c.name,new u.Z(c.rect.x+t.x,c.rect.y+t.y,c.rect.w,c.rect.h,c.rect.r),e);if(void 0!==c.opacity&&(n.settings.opacity=c.opacity),void 0!==c.blendmode&&(n.settings.blendmode=c.blendmode),void 0!==c.locked&&(n.settings.locked=c.locked),void 0!==c.visible&&(n.settings.visible=c.visible),void 0!==c.animation&&(n.animation=c.animation),void 0!==c.macro&&(n.macro=c.macro),void 0!==c.format){if(void 0!==c.format.fill){let e;switch(c.format.fill.type){case"color":e=new d.Z(l.Z.fromHEX(c.format.fill.value));break;case"gradient":e=new d.Z(Z.ZP.fromIGradient(c.format.fill.value));break;case"pattern":let t=c.format.fill.value;if(s)t.svg=s.readString(t.svg);else{let e=await(0,o.c6)(i+t.svg);e&&(t.svg=await e.text())}e=new d.Z(await E.Z.fromIPattern(t))}n.shapeSettings.fillType=e.getType(),n.shapeSettings.fillValue=e.getStringValue(),n.fill=e}c.format.radii&&(n.shapeSettings.radii=c.format.radii)}await n.prepare(),r.push(n);break}case f.Z.TYPE_FRAME:{let e=new b.Z(a.M8(),c.name,new u.Z(c.rect.x+t.x,c.rect.y+t.y,c.rect.w,c.rect.h,c.rect.r));if(void 0!==c.opacity&&(e.settings.opacity=c.opacity),void 0!==c.blendmode&&(e.settings.blendmode=c.blendmode),void 0!==c.locked&&(e.settings.locked=c.locked),void 0!==c.visible&&(e.settings.visible=c.visible),void 0!==c.animation&&(e.animation=c.animation),void 0!==c.macro&&(e.macro=c.macro),c.frame&&(void 0!==c.frame.trim&&(e.trim=new u.Z(c.frame.trim.x,c.frame.trim.y,c.frame.trim.w,c.frame.trim.h)),void 0!==c.frame.clip&&(e.frameSettings.clip=c.frame.clip)),c.content)if(s){let t=s.readFile(c.content);t&&(e.canvas=await a.Td(new Blob([t.buffer])))}else{let t=await(0,o.c6)(i+c.content);t&&(e.canvas=await a.Td(t))}c.style&&(c.style.outline&&(e.frameSettings.outline=!0,void 0!==c.style.outline.size&&(e.frameSettings.outlineSize=c.style.outline.size),void 0!==c.style.outline.color&&(e.frameSettings.outlineColor=c.style.outline.color)),c.style.shadow&&(e.frameSettings.shadow=!0,void 0!==c.style.shadow.blur&&(e.frameSettings.shadowBlur=c.style.shadow.blur),void 0!==c.style.shadow.color&&(e.frameSettings.shadowColor=c.style.shadow.color),void 0!==c.style.shadow.opacity&&(e.frameSettings.shadowOpacity=c.style.shadow.opacity),void 0!==c.style.shadow.distance&&(e.frameSettings.shadowDistance=c.style.shadow.distance),void 0!==c.style.shadow.direction&&(e.frameSettings.shadowDirection=c.style.shadow.direction))),e.prepare(),r.push(e);break}}}return r}async function z(e,t){document.dispatchEvent(new CustomEvent("loading",{detail:"start"}));const s=await M(t),i=s.tree(),n=new T.Z(a.M8(),t.name,s.header.cols,s.header.rows);try{e.supressRender=!0,e.addTab(n,"document");let t=i.descendants();for(let s=t.length-1;s>=0;s--){const i=t[s];if(!i.isGroup())try{const n=new u.Z(i.layer.left,i.layer.top,i.layer.width,i.layer.height),o=i.get("typeTool");let r;if(o){const e=o.export();let t=e.font.sizes?e.font.sizes[0]:12;const s=e.font.name.trim(),i=new k.Z(s.substr(0,s.length-1),t);r=new y.Z(a.M8(),e.value.trim(),n.clone(),i),r.textSettings.fillType="color",r.textSettings.fillValue=new l.Z(e.font.colors[0][0],e.font.colors[0][1],e.font.colors[0][2],e.font.colors[0][3]).toHEX(),r.prepare()}else{const e=await new Promise(((e,t)=>{const s=i.toPng();s.onload=()=>e(s),s.onerror=e=>t(e)}));let o=a.qT(e,4096);r=new x.Z(a.M8(),i.layer.name,o,n,s==t.length-1)}const h={norm:"source-over",dark:"darken",lite:"lighten",hue:"hue",sat:"saturation",colr:"color",lum:"luminosity",mul:"multiply",scrn:"screen",diss:"source-over",over:"overlay",hLit:"hard-light",sLit:"soft-light",diff:"difference",smud:"exclusion",div:"color-doge",idiv:"color-burn",lbrn:"source-over",lddg:"source-over",vLit:"source-over",lLit:"source-over",pLit:"source-over",hMix:"source-over",pass:"source-over",dkCl:"source-over",lgCl:"source-over",fsub:"source-over",fdiv:"source-over"};r.settings.blendmode=h[i.layer.blendMode.blendKey]||"source-over",r.settings.visible=i.layer.visible,r.settings.opacity=i.layer.opacity/255,e.fresco.layers.push(r)}catch(o){console.log("pxd layer read",o)}}e.selectLayer(e.fresco.layers[0]),await e.syncDocument(e.fresco)}catch(o){throw e.close(n.id),o}finally{e.supressRender=!1,document.dispatchEvent(new CustomEvent("loading",{detail:"stop"}))}e.setZoom("fit"),document.dispatchEvent(new CustomEvent("layer-list-render"))}},7630:(e,t,s)=>{s.d(t,{BI:()=>v,DD:()=>x,Zp:()=>g,b4:()=>Z,f1:()=>m,iM:()=>y,sj:()=>w,vV:()=>f});var i=s(3947),a=s(3655),n=s(7359),o=s(1030),r=s(8776),h=s(4170),l=s(9067),c=s(3409),d=s(7664),u=s(7163),p=s(7282);function g(){return void 0!==window.showSaveFilePicker}async function m(e,t,s,i="image/png"){try{return await window.showSaveFilePicker({suggestedName:e+"."+t,types:[{description:s,accept:{[i]:["."+t]}}]})}catch(a){return console.log(a,a.name),"AbortError"!==a.name&&void 0}}async function v(e,t){try{const s=await e.createWritable();await s.write(t),await s.close()}catch(s){return console.log(s),!1}return!0}function f(e,t,s){let a=(0,i.T)("a",{id:"download-link"});window.document.body.append(a),a.download=t+"."+s,a.href=URL.createObjectURL(e),void 0===a.download?window.location=a.href:a.click(),a.remove()}async function y(e,t){const{ZipWriter:i}=await s.e(215).then(s.bind(s,8132)),o=e.fresco,c="pixel"!==t.unit,p=o.color&&"component"!==t.type?o.color:void 0;let g=(e,t)=>0==t?e:g(t,e%t),m=e=>c?e/o.width:e,v=e=>c?e/o.height:e;const f=g(o.width,o.height),y=c?o.width/f:o.width,b=c?o.height/f:o.height;let x={id:t.id,name:t.name,type:t.type,unit:t.unit,width:y,height:b,background:p,stack:new Array};o.animation&&(x.animation=o.animation);const Z=new Array,k=new Array,P=e.getOutputCanvas();if("template"===t.type){const t=a.Ai(P,Math.round(o.width*(640/o.height)),640),s=await new Promise((e=>t.toBlob(e,"image/webp",90)));if(Z.push(new File([s],"preview.webp")),e.fresco.hasAnimation()){const t=300/b,s=await w(e,24,t,!0);Z.push(new File([s],"preview.mp4"))}}const E="component"===t.type?480:350,S=a.Ai(P,Math.round(o.width*(E/o.height)),E),T=await new Promise((e=>S.toBlob(e,"image/webp",70)));Z.push(new File([T],"thumbnail.webp"));for(let s=0;s<o.layers.length;s++){let e=o.layers[s];if("document"!==t.type&&!e.settings.visible||!e.rect)continue;const i=a.Zd();let c={name:e.settings.name,type:e.type,rect:e.rect?{x:m(e.rect.x),y:v(e.rect.y),w:m(e.rect.width),h:v(e.rect.height),r:Number(e.rect.rotation.toFixed(2))}:void 0,blendmode:""!==e.settings.blendmode?e.settings.blendmode:void 0,opacity:Math.round(100*e.settings.opacity)/100,locked:e.settings.locked,visible:e.settings.visible};switch(e.animation&&(c.animation=e.animation),e.macro&&(c.macro=e.macro),e.type){case h.Z.TYPE_ELEMENT:case h.Z.TYPE_IMAGE:c.type=h.Z.TYPE_IMAGE;let s=e.canvas;if(e instanceof d.Z&&e.rect&&s&&(e.rect.width===s.width&&e.rect.height===s.height||(s=a.Ai(s,e.rect.width,e.rect.height))),e.mask){let t=a.Zd();const s=await new Promise((t=>e.mask.toBlob(t,"image/webp",60)));Z.push(new File([s],t+".webp")),c.mask=t+".webp"}if(s){const e=await new Promise((e=>s.toBlob(e,t.nonDestructive?"image/png":"image/webp",t.quality)));Z.push(new File([e],i+(t.nonDestructive?".png":".webp"))),c.content=i+(t.nonDestructive?".png":".webp")}break;case h.Z.TYPE_TEXT:let o=e,p=u.Z.getFontDesc(o.textSettings.font);if(p&&!k.find((e=>e.name===p.name))&&k.push(p),c.content=o.text,c.format={size:v(o.textSettings.size),align:o.textSettings.align,bold:o.textSettings.bold,italic:o.textSettings.italic,underline:o.textSettings.undeline,uppercase:o.textSettings.uppercase,linespace:o.textSettings.lineSpace,letterspace:o.textSettings.letterSpace,font:{name:o.textSettings.font,content:p?p.short+"."+p.type:""}},o.fill&&o.fill.value&&(c.format.fill={type:o.fill.getType()},o.fill.value instanceof r.Z&&(c.format.fill.value=o.fill.value.toHEX()),o.fill.value instanceof n.ZP&&(c.format.fill.value=o.fill.value.toIGradient()),o.fill.value instanceof l.Z)){let e=a.Zd();Z.push(new File([new Blob([o.fill.value.svg],{type:"image/svg+xml;charset=utf-8"})],e+".svg")),c.format.fill.value=o.fill.value.toIPattern(e+".svg")}(o.textSettings.curve||o.textSettings.background||o.textSettings.outline||o.textSettings.shadow)&&(c.style={},o.textSettings.curve&&(c.style.curve={type:o.textSettings.curveType,amount:o.textSettings.curveAmount,spread:o.textSettings.curveSpread,flip:o.textSettings.curveFlip}),o.textSettings.background&&(c.style.background={type:o.textSettings.backgroundType,color:o.textSettings.backgroundColor,punch:o.textSettings.backgroundPunch,offset:o.textSettings.backgroundOffset}),o.textSettings.outline&&(c.style.outline={size:o.textSettings.outlineSize,color:o.textSettings.outlineColor,punch:o.textSettings.outlinePunch,distance:o.textSettings.outlineDistance,direction:o.textSettings.outlineDirection}),o.textSettings.shadow&&(c.style.shadow={blur:o.textSettings.shadowBlur,color:o.textSettings.shadowColor,opacity:o.textSettings.shadowAlpha,distance:o.textSettings.shadowDistance,direction:o.textSettings.shadowDirection}));break;case h.Z.TYPE_SHAPE:let g=e;if("svg"===g.shapeSettings.variant)g.shapeSettings.content&&(Z.push(new File([new Blob([g.shapeSettings.content],{type:"image/svg+xml;charset=utf-8"})],i+".svg")),c.content=i+".svg"),c.format={variant:g.shapeSettings.variant};else if(c.content=g.shapeSettings.content,c.format={variant:g.shapeSettings.variant},0!==g.shapeSettings.radii&&(c.format.radii=g.shapeSettings.radii),g.fill&&g.fill.value&&(c.format.fill={type:g.fill.getType()},g.fill.value instanceof r.Z&&(c.format.fill.value=g.fill.value.toHEX()),g.fill.value instanceof n.ZP&&(c.format.fill.value=g.fill.value.toIGradient()),g.fill.value instanceof l.Z)){let e=a.Zd();Z.push(new File([new Blob([g.fill.value.svg],{type:"image/svg+xml;charset=utf-8"})],e+".svg")),c.format.fill.value=g.fill.value.toIPattern(e+".svg")}(g.shapeSettings.shadow||g.shapeSettings.outlineSize>0)&&(c.style={},g.shapeSettings.outlineSize>0&&(c.style.outline={size:g.shapeSettings.outlineSize,color:g.shapeSettings.outlineColor}),g.shapeSettings.shadow&&(c.style.shadow={blur:g.shapeSettings.shadowBlur,color:g.shapeSettings.shadowColor,opacity:g.shapeSettings.shadowOpacity,distance:g.shapeSettings.shadowDistance,direction:g.shapeSettings.shadowDirection}));break;case h.Z.TYPE_FRAME:let f=e;if(f.canvas){!f.trim||f.trim.width===f.canvas.width&&f.trim.height===f.canvas.height||(f.canvas=a.Ai(f.canvas,f.trim.width,f.trim.height));const e=await new Promise((e=>f.canvas.toBlob(e,"image/webp",t.quality)));Z.push(new File([e],i+".webp")),c.content=i+".webp"}c.frame={trim:f.trim?{x:m(f.trim.x),y:v(f.trim.y),w:m(f.trim.width),h:v(f.trim.height),r:0}:void 0,clip:f.frameSettings.clip},(f.frameSettings.outline||f.frameSettings.shadow)&&(c.style={},f.frameSettings.outline&&(c.style.outline={size:f.frameSettings.outlineSize,color:f.frameSettings.outlineColor}),f.frameSettings.shadow&&(c.style.shadow={blur:f.frameSettings.shadowBlur,color:f.frameSettings.shadowColor,opacity:f.frameSettings.shadowOpacity,distance:f.frameSettings.shadowDistance,direction:f.frameSettings.shadowDirection}))}x.stack.push(c)}let C=new i;C.writeString("manifest.json",JSON.stringify(x),!0);for(let s=0;s<Z.length;s++){const e=Z[s];let t=await e.arrayBuffer(),i=new Uint8Array(t);C.writeFile(e.name,i,e.name.endsWith(".svg"))}for(let s=0;s<k.length;s++){const e=k[s];let t=await u.Z.getFontFile(e.name);if(t){let s=await t.arrayBuffer(),i=new Uint8Array(s);C.writeFile(e.short+"."+e.type,i,!0)}}const L=C.finish();return new Blob([L.buffer])}function w(e,t,i,n,r){return function(e){let t;try{return t=new window.VideoEncoder({output:()=>{},error:()=>{}}),t.configure({width:16,height:16,codec:e,hardwareAcceleration:"prefer-software",framerate:30,bitrate:4e6}),!0}catch(s){return!1}finally{null==t||t.close()}}("avc1.42001e")?((0,o.Z)("video-encode","fast"),function(e,t,i,n,o){let r,h;return new a.k3((()=>new Promise((async(a,l)=>{try{const{Mp4:d}=await s.e(132).then(s.bind(s,8132)),p=1e6;h=new d(p);const g=Math.round(p/t),m=new c.Z(e,t,i,n);let v=0,f=!1,y=null;r=new VideoEncoder({output:(e,t)=>{if(f)return void console.error("Unexpected frames to process");if(null===y&&"key"===e.type){const e=new Uint8Array(t.decoderConfig.description);y=h.addVideoTrack(t.decoderConfig.codedWidth,t.decoderConfig.codedHeight,e)}const s=new Uint8Array(e.byteLength);e.copyTo(s),h.addFrame(y,g*v,g,0,"key"===e.type,s),v+=1,o&&o(v/m.totalFrames),v===m.totalFrames&&(f=!0,a(new Blob([h.fetchFile()],{type:"video/mp4"})))},error:e=>{console.error(e),l(e)}});let w=await m.requestFrame();const x=b(w.width,w.height,t);for(r.configure({width:w.width,height:w.height,codec:"avc1.42001e",hardwareAcceleration:"prefer-software",framerate:t,bitrate:x});w;){const e=new VideoFrame(w,{timestamp:g*(m.currentFrame-1),duration:g});r.encode(e),e.close(),w=await m.requestFrame()}await r.flush()}catch(d){console.error(d)}finally{try{null==r||r.close()}catch(u){}}}))),(()=>{try{null==r||r.close(),null==h||h.free()}catch(e){}}))}(e,t,i,n,r)):((0,o.Z)("video-encode","slow"),function(e,t,s,i,n){const o=new p.Y3,r=new a.k3((async()=>{try{const h=new c.Z(e,t,s,i);let l,d,u=await h.requestFrame();for(;u;){const e=await new Promise(((e,t)=>{u.toBlob((t=>e(t)),"image/jpeg",.92)})),t=await new Promise(((t,s)=>{const i=new FileReader;i.onload=()=>t(new Uint8Array(i.result)),i.readAsArrayBuffer(e)}));if(r.isCanceled())throw new a.Mk;o.send({type:"addFile",name:`${h.currentFrame}.jpeg`,data:t},[t.buffer]),l=u.width,d=u.height,n&&n(h.currentFrame/h.totalFrames/2),u=await h.requestFrame()}const p=b(l,d,t);for(o.send({type:"run",arguments:["-r",t.toFixed(0),"-f","image2","-s",`${l}x${d}`,"-i","%d.jpeg","-start_number","1","-vframes",h.totalFrames.toFixed(0),"-vcodec","libx264","-crf","23","-vb",p.toFixed(0),"-pix_fmt","yuv420p","-preset","ultrafast","out.mp4"]});;){const e=await o.receive();switch(e.type){case"progress":n&&n(e.frame/h.totalFrames/2+.5);break;case"result":return new Blob([e.data],{type:"video/mp4"})}}}finally{null==o||o.terminate()}}),(()=>{null==o||o.terminate()}));return r}(e,t,i,n,r))}function b(e,t,s,i=.18){return Math.round(e*t*s*i)}function x(e,t,s,i,n,o,r){const h=new p.Bm;return new a.k3((async()=>{try{let a=new c.Z(e,t,s,o),l=Math.round(100/t/i),d=await a.requestFrame();for(h.send({type:"start",width:d.width,height:d.height,repeat:n}),await h.receive();d;){let e=d.getContext("2d").getImageData(0,0,d.width,d.height);r&&r(a.currentFrame/a.totalFrames),h.send({type:"frame",buffer:e,delay:l},[e.data.buffer]),d=await a.requestFrame(),await h.receive()}h.send({type:"done"});const u=await h.receive();if("result"!==u.type)throw new Error("No file");return new Blob([u.message])}finally{h.terminate()}}),(()=>{null==h||h.terminate()}))}async function Z(e,t){const i=await s.e(500).then(s.bind(s,9055)),a=await i.PDFDocument.create(),n=a.addPage([e.fresco.width,e.fresco.height]),o=await a.embedJpg(await t.arrayBuffer());return n.drawImage(o,{x:0,y:0,width:e.fresco.width,height:e.fresco.height}),new Blob([await a.save()])}},3506:(e,t,s)=>{s.d(t,{ZP:()=>a});class i{constructor(e,t,s,i,a){this.id=e,this.urls=t,this.description=s,this.downloadLink=i,this.credits=a,this.downloadUrl=()=>fetch(this.downloadLink+"&client_id=0fded05dc29e00f3a22e79c451bbbf4905f3d17d9ba2d5348398c648bd1603ca").then((e=>e.json())).then((e=>e.url)),this.source="unsplash",this.thumbnail=t.thumb}}class a{}a.backends=[{name:"unsplashed",query:e=>function e(t,s){return fetch(`https://api.unsplash.com/search/photos?page=${s}&query=${t}&per_page=50`,{headers:{Authorization:"Client-ID 0fded05dc29e00f3a22e79c451bbbf4905f3d17d9ba2d5348398c648bd1603ca"}}).then((e=>e.json())).then((e=>e)).then((a=>{const n=a.total_pages===s;return{items:a.results.map((e=>new i(e.id,e.urls,e.description,e.links.download_location,{name:e.user.name,profile:e.user.links.html}))),nextPage:n?void 0:()=>e(t,s+1)}}))}(e,1)}],a.randomDefault=()=>{const e=["candy","cake","cookies","nature","spring","winter","forest","architecture","park","new york","flower","london","tokyo","kyoto","cherry blossom","waterfall","jungle","italy","food","garden","lion","reef","river","mountain","boats"];return e[Math.floor(Math.random()*e.length)]},a.queryAll=e=>{const t=e=>{const t=e.filter((e=>!!e.nextPage)).map((e=>e.nextPage()));if(0!==t.length)return()=>Promise.all(t).then(s)},s=e=>{let s=[];return e.forEach((e=>{s=s.concat(e.items)})),{items:s.sort(((e,t)=>Math.random()>.5?-1:1)),nextPage:t(e)}};return Promise.all(a.backends.map((t=>t.query(e)))).then(s)},a.query=(e,t)=>{const s=a.backends.find((t=>t.name===e));return s?Promise.reject(`No such backend: ${e}`):s.query(t)}},2804:(e,t,s)=>{async function i(e,t={}){const s=function(e,t={}){const s=[];for(var i in t)s.push(`${i}=${encodeURIComponent(t[i].toString())}`);return 0==s.length?e:`${e}?${s.join("&")}`}(`https://${function(){const e=window.location.hostname;return"dev.pixlr.com"===e?e:"pixlr.com"}()}`+e,t),i=await fetch(s),a=i.headers.get("content-type");if(a&&-1===a.indexOf("application/json"))return;const n=await i.json();if(!1===n.status)throw new Error(n.message);return n.data}s.d(t,{Qz:()=>a,RH:()=>o,_y:()=>n,cI:()=>r});const a=(e={})=>i("/api/templates/",Object.assign({features:"image,text,shape,frame,group,animation"},e)),n=e=>i(`/api/templates/${e}/`),o=(e,t)=>i(`/api/templates/collections/${e}/?limit=${t}`),r=e=>i(`/api/templates/${e}/download/`)},3049:(e,t,s)=>{s.d(t,{Z:()=>i});class i{constructor(e,t,s){this.framebuffer=e,this.renderbuffer=t,this.texture=s}destroy(e){e.deleteFramebuffer(this.framebuffer),e.deleteRenderbuffer(this.renderbuffer),e.deleteTexture(this.texture)}}},2634:(e,t,s)=>{s.d(t,{Z:()=>l});var i=s(8776),a=s(9679),n=s(4084),o=s(9389),r=s(1662),h=s(134);class l{static init(){l.presets||(l.grouping={friends:["aladin","alex","amber","anne","antonio","bob","greg","hagrid","harry","ivan","jean","josh","karen","lucas","melissa","peter","salomon","sara","sophia","tony"],"too-old":["agnes","conny","gordon","harrison","henry","logan","olay","porter","sampi","tom","vinny"],instage:["borg","carl","coco","doris","doug","earl","sun","blues","country","lemonpell","tiny dc","minker"],colors:["superone","tonola","reddish","fellowing","grassland","springs","justblues","bluesteel","flowerpot","stinker","violiin","blupur","beyllo","wifortress"],retro:["vib","ranguit","rangeen","creamlow","sven","yenely","ragwarm","greered","danligter","garage"],shades:["strawberry","clementine","pear","apple","blueberry","grapes","dragon"],tuning:["punch","bright","contrast","vivid","clairify"],artzy:["poster","glitch","mozak","frank","pinvet","night vision","darkstreet","blomberg","lolita","atonic"],portrait:["matte","deep","film","sunny","gritty"],food:["berry","ensalat","morning","corn","sharp"],urban:["cement","style","mold","shimmer","stalker","sham"],nature:["beach","flower","forest"]},l.presets={flower:[new a.Z("vibrance",.2),new a.Z("saturation",.1),new a.Z("temperature",.1)],forest:[new a.Z("saturation",-.2),new a.Z("vibrance",1),new a.Z("clarity",.2),new a.Z("temperature",.16),new a.Z("tint",.2),new a.Z("curves",new h.z([[0,0,65,52,173,190,236,255],[0,0,255,255],[0,0,255,255],[0,0,255,255]]))],beach:[new a.Z("saturation",.2),new a.Z("vibrance",.2),new a.Z("curves",new h.z([[0,0,68,56,199,208,255,255],[0,0,255,255],[0,0,98,97,196,201,255,255],[0,0,87,85,201,182,255,255]])),new a.Z("temperature",.1)],sham:[new a.Z("saturation",-.3),new a.Z("fill",new n.Z(new i.Z(153,221,255),"overlay",.3)),new a.Z("curves",new h.z([[60,31,191,217],[0,0,120,134,255,255],[0,0,255,255],[0,0,120,144,255,255]]))],stalker:[new a.Z("curves",new h.z([[62,64,190,191],[0,0,133,125,255,255],[0,0,54,65,209,208,255,255],[60,62,96,99,240,230,255,255]])),new a.Z("contrast",.1),new a.Z("saturation",-.2)],shimmer:[new a.Z("temperature",-.2),new a.Z("tint",-.12),new a.Z("fill",new n.Z(new i.Z(190,11,255),"screen",.12)),new a.Z("curves",new h.z([[8,23,244,227],[0,0,255,255],[0,0,131,124,255,255],[0,0,149,112,255,255]]))],mold:[new a.Z("curves",new h.z([[65,64,233,233],[0,0,138,121,255,255],[0,0,60,75,184,184,255,255],[0,0,64,75,181,176,255,255]])),new a.Z("contrast",.1),new a.Z("saturation",-.12)],style:[new a.Z("curves",new h.z([[0,0,73,74,191,177,235,221,255,255],[0,26,89,64,121,126,180,213,255,255],[0,0,71,50,190,210,255,255],[61,64,112,97,199,198,255,255]])),new a.Z("vibrance",-.1),new a.Z("saturation",-.4),new a.Z("temperature",.1)],cement:[new a.Z("curves",new h.z([[0,0,73,74,191,177,235,221,255,255],[0,0,255,255],[0,0,60,54,198,210,255,255],[0,0,73,37,150,149,199,198,255,255]])),new a.Z("vibrance",-.1),new a.Z("saturation",-.1)],sharp:[new a.Z("curves",new h.z([[0,0,42,20,199,218,224,246,255,255],[0,0,255,255],[0,0,255,255],[0,0,255,255]])),new a.Z("vibrance",.1),new a.Z("sharpen",.1),new a.Z("clarity",.1)],corn:[new a.Z("temperature",.1),new a.Z("vibrance",.3),new a.Z("contrast",.1),new a.Z("curves",new h.z([[0,0,66,78,255,255],[0,0,255,255],[0,0,255,255],[0,0,255,255]]))],morning:[new a.Z("tint",.18),new a.Z("temperature",.1),new a.Z("highlights",.08),new a.Z("levels",new r.Z(0,245,0,255)),new a.Z("curves",new h.z([[64,64,150,181,254,255],[0,0,122,138,255,255],[0,0,255,255],[0,0,255,255]])),new a.Z("fill",new n.Z(new i.Z(194,120,41),"overlay",.2))],ensalat:[new a.Z("highlights",.2),new a.Z("shadows",-.2),new a.Z("brightness",.1),new a.Z("levels",new r.Z(10,245,0,255)),new a.Z("curves",new h.z([[0,0,135,119,191,193,255,255],[0,0,255,255],[0,0,129,121,255,255],[0,0,255,255]])),new a.Z("clarity",.2),new a.Z("sharpen",.15)],berry:[new a.Z("vibrance",.44),new a.Z("curves",new h.z([[0,0,62,66,121,135,255,255],[0,0,255,255],[0,0,255,255],[0,0,255,255]])),new a.Z("contrast",.2),new a.Z("highlights",.4),new a.Z("shadows",-.2),new a.Z("levels",new r.Z(20,255,0,255))],gritty:[new a.Z("saturation",-.4),new a.Z("levels",new r.Z(20,255,0,255)),new a.Z("curves",new h.z([[0,0,50,33,128,112,190,215,255,255],[0,0,255,255],[0,0,255,255],[0,0,255,255]])),new a.Z("clarity",1),new a.Z("grain",.3)],sunny:[new a.Z("fill",new n.Z(new i.Z(255,194,96),"overlay",.2)),new a.Z("temperature",.1),new a.Z("glamour",.4),new a.Z("clarity",.3)],film:[new a.Z("sharpen",.2),new a.Z("glamour",.5),new a.Z("grain",.5),new a.Z("highlights",-.2),new a.Z("shadows",-.2),new a.Z("saturation",-.2)],matte:[new a.Z("curves",new h.z([[0,50,38,56,79,82,152,153,255,255],[0,0,255,255],[0,0,255,255],[0,0,255,255]])),new a.Z("contrast",.12),new a.Z("saturation",-.1)],deep:[new a.Z("curves",new h.z([[0,0,117,99,191,198,255,255],[0,0,71,38,177,209,255,255],[0,0,236,255],[0,28,75,101,190,171,254,233]])),new a.Z("saturation",-.3)],aladin:[new a.Z("curves",new h.z([[0,0,255,255],[0,52,87,99,255,255],[0,0,106,107,194,190,254,212],[0,0,166,129,254,142]]))],amber:[new a.Z("curves",new h.z([[0,0,255,255],[0,0,98,150,255,255],[0,0,138,117,255,255],[0,128,254,129]]))],anne:[new a.Z("contrast",.25),new a.Z("curves",new h.z([[0,0,255,255],[0,0,78,66,135,171,255,255],[0,0,99,87,180,208,255,255],[0,0,94,93,171,161,255,255]]))],antonio:[new a.Z("glamour",.8)],alex:[new a.Z("glamour",.6)],bob:[new a.Z("saturation",-.6),new a.Z("highlights",.5)],greg:[new a.Z("curves",new h.z([[0,0,255,255],[0,0,74,50,181,198,255,255],[0,0,61,41,108,170,158,207,254,208],[0,0,83,56,168,204,255,255]]))],hagrid:[new a.Z("vibrance",.9),new a.Z("saturation",.1),new a.Z("clarity",.5),new a.Z("shadows",-.3)],harry:[new a.Z("fill",new n.Z(new i.Z(214,178,119),"overlay",.7)),new a.Z("grain",.5)],ivan:[new a.Z("fill",new n.Z(new i.Z(255,0,68),"overlay",.4)),new a.Z("shadows",.15),new a.Z("levels",new r.Z(6,255,0,255))],jean:[new a.Z("levels",new r.Z(56,233,0,255)),new a.Z("saturation",-1),new a.Z("tint",.1),new a.Z("exposure",.78),new a.Z("bloom",.1)],josh:[new a.Z("curves",new h.z([[0,0,78,52,175,207,255,255],[0,0,255,255],[0,0,255,255],[0,64,87,129,254,193]]))],karen:[new a.Z("curves",new h.z([[0,0,255,255],[0,0,89,144,255,255],[0,0,138,112,255,255],[0,0,162,88,255,255]]))],lucas:[new a.Z("tint",1),new a.Z("saturation",-.85),new a.Z("contrast",.4),new a.Z("shadows",1),new a.Z("temperature",.1)],melissa:[new a.Z("curves",new h.z([[0,0,255,255],[0,62,255,255],[0,0,255,255],[0,61,254,193]]))],peter:[new a.Z("curves",new h.z([[0,0,255,255],[0,6,31,20,65,26,87,51,195,190,254,230],[0,11,24,27,102,131,189,195,255,255],[0,40,126,148,254,177]]))],salomon:[new a.Z("curves",new h.z([[0,0,255,255],[0,0,83,50,177,213,255,255],[0,0,69,55,186,205,255,255],[11,56,254,212]])),new a.Z("contrast",-.2)],sara:[new a.Z("vibrance",1),new a.Z("contrast",.1),new a.Z("highlights",.3)],sophia:[new a.Z("curves",new h.z([[0,0,255,255],[0,0,140,116,222,254],[0,0,70,59,182,201,255,255],[0,29,252,227]])),new a.Z("saturation",.3)],tony:[new a.Z("curves",new h.z([[0,0,255,255],[0,0,92,42,218,252],[0,0,73,75,157,194,255,255],[0,27,254,227]]))],agnes:[new a.Z("desaturate",1),new a.Z("contrast",.5)],conny:[new a.Z("saturation",-.55),new a.Z("temperature",.25),new a.Z("brightness",-.25),new a.Z("levels",new r.Z(14,233,0,255)),new a.Z("exposure",.35),new a.Z("highlights",-.9)],gordon:[new a.Z("desaturate",1),new a.Z("temperature",.7),new a.Z("tint",.3),new a.Z("saturation",-.2)],harrison:[new a.Z("toning",new o.Z(new i.Z(255,240,215),new i.Z(48,26,24),1)),new a.Z("grain",.2)],henry:[new a.Z("toning",new o.Z(new i.Z(255,240,215),new i.Z(48,26,24),1)),new a.Z("saturation",-.5)],logan:[new a.Z("glamour",.5),new a.Z("tint",.4),new a.Z("saturation",-.35),new a.Z("toning",new o.Z(new i.Z(255,240,215),new i.Z(48,26,24),.8))],olay:[new a.Z("saturation",-1),new a.Z("grain",.5),new a.Z("vignette",.5)],porter:[new a.Z("saturation",-1),new a.Z("vignette",.4),new a.Z("levels",new r.Z(50,205))],tom:[new a.Z("desaturate",1)],sampi:[new a.Z("toning",new o.Z(new i.Z(255,228,196),new i.Z(0,0,0),1)),new a.Z("levels",new r.Z(0,217,0,255)),new a.Z("temperature",.3)],vinny:[new a.Z("curves",new h.z([[0,0,133,111,255,255],[0,0,255,255],[0,0,255,255],[0,0,133,138,255,255]])),new a.Z("vibrance",-1),new a.Z("saturation",1),new a.Z("temperature",.8),new a.Z("contrast",-.1),new a.Z("highlights",.1)],borg:[new a.Z("curves",new h.z([[0,0,255,255],[0,0,94,66,227,255],[0,0,93,94,179,198,255,255],[0,19,254,228]])),new a.Z("fill",new n.Z(new i.Z(204,255,0),"",.1))],carl:[new a.Z("curves",new h.z([[0,0,255,255],[0,0,93,64,227,255],[0,0,93,94,181,189,255,255],[0,19,254,228]])),new a.Z("vignette",.3),new a.Z("contrast",.15),new a.Z("saturation",-.3)],coco:[new a.Z("curves",new h.z([[0,0,255,255],[0,0,64,97,255,255],[0,0,142,122,255,255],[0,0,144,112,255,255]]))],doris:[new a.Z("curves",new h.z([[0,0,255,255],[0,0,78,48,177,209,255,255],[0,0,92,94,179,208,255,255],[0,52,254,215]])),new a.Z("saturation",-.2)],doug:[new a.Z("curves",new h.z([[0,0,255,255],[0,64,255,255],[0,0,255,255],[1,64,252,193]]))],earl:[new a.Z("vignette",.4),new a.Z("curves",new h.z([[0,0,255,255],[0,0,222,254],[0,47,223,254],[0,129,222,255]])),new a.Z("fill",new n.Z(new i.Z(247,218,174),"multiply",.8))],sun:[new a.Z("fill",new n.Z(new i.Z(251,242,163),"multiply",.8)),new a.Z("vignette",-.25)],blues:[new a.Z("curves",new h.z([[0,0,255,255],[0,0,77,54,181,207,255,255],[0,0,73,51,180,209,255,255],[0,0,54,75,201,185,255,255]]))],country:[new a.Z("curves",new h.z([[0,0,84,74,115,105,255,255],[0,0,73,80,93,124,255,255],[0,0,50,34,93,105,119,142,255,255],[0,0,85,85,125,112,255,255]]))],lemonpell:[new a.Z("curves",new h.z([[0,36,80,84,156,190,255,255],[0,0,255,255],[0,0,103,105,158,176,255,255],[0,19,107,83,198,196,255,255]]))],"tiny dc":[new a.Z("curves",new h.z([[0,0,255,255],[0,0,79,46,199,217,255,255],[9,1,110,126,254,232],[0,46,92,103,191,158,254,205]])),new a.Z("grain",.3)],minker:[new a.Z("toning",new o.Z(new i.Z(255,216,153),new i.Z(26,0,77),.8)),new a.Z("levels",new r.Z(0,247,8,255)),new a.Z("brightness",.14),new a.Z("contrast",.4),new a.Z("vibrance",.5)],superone:[new a.Z("toning",new o.Z(new i.Z(255,216,153),new i.Z(77,0,51),.8)),new a.Z("levels",new r.Z(50,175,0,255))],tonola:[new a.Z("toning",new o.Z(new i.Z(221,255,153),new i.Z(77,0,51),.8)),new a.Z("levels",new r.Z(26,213,0,255)),new a.Z("saturation",.36),new a.Z("temperature",.22)],reddish:[new a.Z("toning",new o.Z(new i.Z(255,214,147),new i.Z(110,37,0),.8)),new a.Z("contrast",.3),new a.Z("highlights",1)],fellowing:[new a.Z("toning",new o.Z(new i.Z(255,216,153),new i.Z(77,47,0),.8)),new a.Z("levels",new r.Z(24,203,0,255)),new a.Z("contrast",.14),new a.Z("saturation",.3),new a.Z("temperature",.18)],grassland:[new a.Z("toning",new o.Z(new i.Z(221,255,153),new i.Z(0,77,25),.7)),new a.Z("levels",new r.Z(18,227,0,255)),new a.Z("contrast",.16)],springs:[new a.Z("toning",new o.Z(new i.Z(221,255,153),new i.Z(0,26,38),1)),new a.Z("highlights",1),new a.Z("levels",new r.Z(40,155,0,255)),new a.Z("shadows",1)],justblues:[new a.Z("toning",new o.Z(new i.Z(198,236,255),new i.Z(26,0,77),.79)),new a.Z("levels",new r.Z(16,189,0,255)),new a.Z("saturation",.2),new a.Z("contrast",.2)],bluesteel:[new a.Z("toning",new o.Z(new i.Z(255,216,153),new i.Z(26,0,77),.8)),new a.Z("levels",new r.Z(0,215,12,255))],flowerpot:[new a.Z("toning",new o.Z(new i.Z(255,153,221),new i.Z(51,77,0),.8)),new a.Z("levels",new r.Z(22,215,0,255)),new a.Z("vignette",-.2)],stinker:[new a.Z("toning",new o.Z(new i.Z(255,216,153),new i.Z(26,0,77),.8)),new a.Z("levels",new r.Z(0,247,8,255)),new a.Z("brightness",.14),new a.Z("contrast",.4)],violiin:[new a.Z("contrast",.32),new a.Z("toning",new o.Z(new i.Z(195,166,255),new i.Z(33,0,0),1)),new a.Z("levels",new r.Z(22,223,0,255)),new a.Z("exposure",.22),new a.Z("brightness",.12)],blupur:[new a.Z("toning",new o.Z(new i.Z(255,153,221),new i.Z(7,68,97),.8)),new a.Z("vibrance",.7),new a.Z("contrast",.3)],beyllo:[new a.Z("vibrance",1),new a.Z("saturation",1),new a.Z("temperature",-.55),new a.Z("tint",.1),new a.Z("levels",new r.Z(0,255,24,249)),new a.Z("toning",new o.Z(new i.Z(255,213,0),new i.Z(125,3,84),.76)),new a.Z("curves",new h.z([[0,0,255,255],[0,0,131,115,255,255],[0,0,136,128,255,255],[0,0,122,145,255,255]])),new a.Z("vignette",.28)],wifortress:[new a.Z("toning",new o.Z(new i.Z(108,206,255),new i.Z(0,26,38),1)),new a.Z("highlights",1),new a.Z("levels",new r.Z(40,155,0,255)),new a.Z("shadows",1)],vib:[new a.Z("vibrance",.1),new a.Z("saturation",.5),new a.Z("brightness",.1),new a.Z("temperature",.5),new a.Z("levels",new r.Z(12,253,0,255)),new a.Z("highlights",.2),new a.Z("curves",new h.z([[0,0,255,255],[0,0,70,80,198,181,255,255],[0,0,140,135,255,255],[0,0,74,96,200,172,255,255]])),new a.Z("toning",new o.Z(new i.Z(255,238,210),new i.Z(54,6,6),.07)),new a.Z("contrast",-.1)],ranguit:[new a.Z("saturation",.22),new a.Z("temperature",.96),new a.Z("tint",-.28),new a.Z("contrast",.14),new a.Z("brightness",-.2),new a.Z("levels",new r.Z(0,237,56,255)),new a.Z("toning",new o.Z(new i.Z(221,255,153),new i.Z(41,35,33),.26))],rangeen:[new a.Z("vibrance",1),new a.Z("saturation",.46),new a.Z("temperature",.36),new a.Z("levels",new r.Z(0,251,14,255)),new a.Z("shadows",.34),new a.Z("highlights",.12),new a.Z("toning",new o.Z(new i.Z(121,255,224),new i.Z(245,22,107),.12)),new a.Z("contrast",-.1),new a.Z("curves",new h.z([[0,0,144,152,255,255],[0,0,136,107,255,255],[0,0,115,102,255,255],[0,0,106,91,255,255]]))],creamlow:[new a.Z("vibrance",.82),new a.Z("saturation",-.24),new a.Z("temperature",1),new a.Z("tint",.78),new a.Z("contrast",-.3),new a.Z("levels",new r.Z(40,247,0,255)),new a.Z("highlights",.64),new a.Z("toning",new o.Z(new i.Z(221,255,153),new i.Z(145,39,9),.29)),new a.Z("curves",new h.z([[0,0,5,13,78,83,172,162,255,255],[0,0,255,255],[0,0,131,120,255,255],[0,0,68,61,175,184,255,255]]))],sven:[new a.Z("vibrance",.7),new a.Z("temperature",.5),new a.Z("tint",.3),new a.Z("exposure",.2),new a.Z("contrast",-.2),new a.Z("levels",new r.Z(4,255,0,235)),new a.Z("highlights",-.3),new a.Z("shadows",.3),new a.Z("grain",.3),new a.Z("vignette",.45)],yenely:[new a.Z("tint",.5),new a.Z("levels",new r.Z(0,235,20,255)),new a.Z("saturation",-.62),new a.Z("contrast",-.3),new a.Z("shadows",-.6),new a.Z("curves",new h.z([[0,0,148,105,255,255],[0,0,92,79,128,227,255,255],[0,0,74,103,119,172,255,255],[0,0,111,148,255,255]])),new a.Z("highlights",1),new a.Z("brightness",.14),new a.Z("temperature",.3),new a.Z("vibrance",1),new a.Z("exposure",-.1)],ragwarm:[new a.Z("temperature",.62),new a.Z("levels",new r.Z(32,255,0,243)),new a.Z("highlights",-.14),new a.Z("vignette",.28),new a.Z("toning",new o.Z(new i.Z(153,255,187),new i.Z(21,55,143),.07)),new a.Z("curves",new h.z([[0,0,126,125,255,255],[0,0,255,255],[0,0,130,121,255,255],[0,0,138,124,255,255]]))],greered:[new a.Z("vibrance",.32),new a.Z("temperature",.4),new a.Z("tint",-.5),new a.Z("brightness",.24),new a.Z("contrast",-.1),new a.Z("vignette",.31),new a.Z("shadows",.38)],danligter:[new a.Z("saturation",.86),new a.Z("temperature",-1),new a.Z("tint",-.92),new a.Z("brightness",.22),new a.Z("exposure",.22),new a.Z("contrast",.1),new a.Z("levels",new r.Z(0,239,0,255)),new a.Z("highlights",-.12),new a.Z("dehaze",-.12),new a.Z("toning",new o.Z(new i.Z(255,216,153),new i.Z(0,52,77),.14)),new a.Z("curves",new h.z([[0,0,255,255],[0,0,96,115,162,194,255,255],[0,0,101,97,185,189,255,255],[0,0,144,130,222,228,255,255]]))],garage:[new a.Z("tint",.6),new a.Z("saturation",-.04),new a.Z("shadows",-1),new a.Z("grain",.42),new a.Z("glamour",.3)],strawberry:[new a.Z("fill",new n.Z(new i.Z(255,0,0),"soft-light",.5))],clementine:[new a.Z("fill",new n.Z(new i.Z(255,158,0),"soft-light",.5))],pear:[new a.Z("fill",new n.Z(new i.Z(170,255,0),"soft-light",.5))],apple:[new a.Z("fill",new n.Z(new i.Z(0,255,85),"soft-light",.5))],blueberry:[new a.Z("fill",new n.Z(new i.Z(0,170,255),"soft-light",.5))],grapes:[new a.Z("fill",new n.Z(new i.Z(85,0,255),"soft-light",.5))],dragon:[new a.Z("fill",new n.Z(new i.Z(255,0,170),"soft-light",.5))],punch:[new a.Z("curves",new h.z([[0,0,80,64,173,193,255,255],[0,0,255,255],[0,0,255,255],[0,0,255,255]])),new a.Z("vibrance",.5)],bright:[new a.Z("highlights",-.3),new a.Z("shadows",.5),new a.Z("levels",new r.Z(0,215,10,255))],contrast:[new a.Z("contrast",.2),new a.Z("highlights",.2),new a.Z("levels",new r.Z(20,215,0,255)),new a.Z("shadows",.4)],vivid:[new a.Z("vibrance",.4),new a.Z("shadows",.25)],clairify:[new a.Z("clarity",.6),new a.Z("sharpen",.1),new a.Z("glamour",.2)],poster:[new a.Z("posterize",.08)],glitch:[new a.Z("scanlines",{size:.03,amount:.05,colorize:!1,direction:!1}),new a.Z("slice",{seed:86,amount:4,distance:.12,line:!0}),new a.Z("bleed",{seed:58,amplitude:.05,block:1.2})],mozak:[new a.Z("mosaic",.5),new a.Z("fringe",.2)],frank:[new a.Z("fringe",.4)],pinvet:[new a.Z("bloom",.33),new a.Z("invert",1),new a.Z("pixelate",.7)],blomberg:[new a.Z("bloom",.33),new a.Z("invert",1),new a.Z("tint",1),new a.Z("temperature",-.8),new a.Z("saturation",-.5)],lolita:[new a.Z("fill",new n.Z(new i.Z(255,153,153),"vivid-light",1))],atonic:[new a.Z("curves",new h.z([[0,0,255,255],[6,235,246,4],[131,3,138,255],[1,42,251,213]]))],"night vision":[new a.Z("fill",new n.Z(new i.Z(30,255,0),"multiply",1)),new a.Z("levels",new r.Z(0,183,0,255)),new a.Z("vignette",.85),new a.Z("grain",.6)],darkstreet:[new a.Z("temperature",-1),new a.Z("highlights",.58),new a.Z("shadows",-1),new a.Z("levels",new r.Z(100,249,0,255)),new a.Z("grain",1),new a.Z("exposure",-1)]})}static named(e){return l.init(),this.presets[e]}static firstInGroup(e){return l.init(),l.grouping[e][0]}static groups(){l.init();const e=[];for(const t in l.grouping)e.push(t);return e}static names(e){l.init();const t=[];for(const s in l.grouping[e])t.push(l.grouping[e][s]);return t}}},2673:(e,t,s)=>{s.d(t,{Z:()=>a});var i=s(2381);class a{constructor(e,t,s){this.uniform={},this.attribute={},this.texture=new Map,this.program=e.createProgram(),e.attachShader(this.program,this.compile(e,t,e.VERTEX_SHADER)),e.attachShader(this.program,this.compile(e,s,e.FRAGMENT_SHADER)),e.linkProgram(this.program),e.useProgram(this.program),e.getProgramParameter(this.program,e.LINK_STATUS)||console.log(e.getProgramInfoLog(this.program));const a=this.collect(t,"attribute");for(const[i,l]of a)this.attribute[i]=e.getAttribLocation(this.program,i);let n=[];const o=this.collect(t,"uniform");for(const[i,l]of o)this.uniform[i]=e.getUniformLocation(this.program,i);const r=this.collect(s,"uniform");for(const[i,l]of r)this.uniform[i]=e.getUniformLocation(this.program,i),"sampler2D"===l&&n.push(i);for(var h in n){let t=n[h],s=e.getUniformLocation(this.program,t);"texture"===t?(e.uniform1i(s,0),this.texture.set(0,new i.Z(t))):(e.uniform1i(s,1),this.texture.set(1,new i.Z(t)))}}collect(e,t){const s=[],i=new RegExp("\\b"+t+" (\\w+) (\\w+)","ig");return e.replace(i,(function(e,t,i){return s.push([i,t]),e})),s}compile(e,t,s){var i=e.createShader(s);return e.shaderSource(i,t),e.compileShader(i),e.getShaderParameter(i,e.COMPILE_STATUS)?i:(console.log(e.getShaderInfoLog(i)),console.log(t),null)}getTextureById(e){let t=null;return this.texture.forEach((function(s){s.id!==e||(t=s)})),t||(console.error("Having no texture that is named `%s`.",e),null)}destroy(e){e.deleteProgram(this.program),this.texture.forEach((function(t){t.destroy(e)})),this.texture.clear()}}},4256:(e,t,s)=>{s.d(t,{Z:()=>u});var i=s(2634),a=s(3673),n=s(2381),o=s(2673),r=s(3049),h=s(4084),l=s(9389),c=s(1662),d=s(134);class u{constructor(e){this.drawShader=0,this.sourceTexture=null,this.lastInChain=!1,this.currentFramebufferIndex=0,this.tempFramebuffers={},this.width=-1,this.height=-1,this.vertexBuffer=null,this.lastTextureSlot=-1,this.debug=!1,this.addPreset=(e,t=1)=>{const s=i.Z.named(e);s&&(1!==t?s.forEach((e=>{switch(e.name){case"curves":{const s=e.value,i=d.z.createCurveSet(s);i.percent=t,this.addShader(e.name,i);break}case"levels":{const s=e.value,i=new c.Z(Math.round(s.minin*t),Math.round(255-(255-s.maxin)*t));this.addShader(e.name,i);break}case"toning":{const s=e.value,i=new l.Z(s.highlight,s.shadow,s.amount*t);this.addShader(e.name,i);break}case"fill":{const s=e.value,i=new h.Z(s.color,s.blend,s.amount*t);this.addShader(e.name,i);break}default:this.addShader(e.name,e.value*t)}})):s.forEach((e=>this.addShader(e.name,e.value))))},this.cleanUp=()=>{this.sourceTexture=null,this.canvas=null,this.ctx=null},this.VERTEX_IDENTITY="\n        precision highp float;\n        attribute vec2 apos;\n        attribute vec2 auv;\n        varying vec2 uv;\n        uniform vec4 transform;\n\n        void main(void) {\n            uv = auv;\n            gl_Position = vec4(apos.x * transform.x + transform.z, apos.y * transform.y + transform.w, 0.0, 1.0);\n        }",this.FRAGMENT_IDENTITY="\n        precision highp float;\n        varying vec2 uv;\n        uniform sampler2D texture;\n\n        void main(void) {\n            gl_FragColor = texture2D(texture, uv);\n        }",this.GAUSSKERN_MAX=15,this.chain=e||[],this.compiledProgram=new Map,this.canvas=document.createElement("canvas"),this.canvas.id="shaders-temp",this.initContext(),this.canvas.addEventListener("webglcontextlost",this.handleContextLost.bind(this),!1)}initContext(){this.ctx=this.canvas.getContext("webgl",{alpha:!0,premultipliedAlpha:!1,depth:!1,stencil:!1,antialias:!1})}handleContextLost(){null==this.canvas&&(this.canvas=document.createElement("canvas")),this.initContext()}getError(){this.debug&&this.ctx.getError()}addShader(e,t,s=!1){if("fill"==e&&0==t.amount||"toning"==e&&0==t.amount||"levels"==e&&t.isFlat()||null==t||0===t)this.removeShader(e,s);else{for(var i=0;i<this.chain.length;i++)if(this.chain[i].type===e&&this.chain[i].sidekick===s)return void(this.chain[i].value=t);this.chain.push(new p(e,t,s))}}getShaderValue(e){for(var t=0;t<this.chain.length;t++)if(this.chain[t].type==e)return this.chain[t].value}removeShaderSidekick(){let e=new Array;for(var t=0;t<this.chain.length;t++)this.chain[t].sidekick||e.push(this.chain[t]);this.chain=e}removeShader(e,t=!1){for(var s=0;s<this.chain.length;s++)if(this.chain[s].type===e&&this.chain[s].sidekick===t)return void this.chain.splice(s,1)}runShader(e,t){switch(e){case"vibrance":return this.vibrance(t);case"saturation":return this.saturation(t);case"brightness":return this.brightness(t);case"lightness":return this.lightness(t);case"temperature":return this.temperature(t);case"balance":return this.balance(t);case"tint":return this.tint(t);case"hue":return this.hue(t);case"colorize":return this.colorize(t);case"grain":return this.grain(t);case"noise":return this.noise(t);case"vignette":return this.vignette(t);case"sharpen":return this.sharpen(t);case"blur":return this.blur(t);case"zoom":return this.zoom(t);case"bokeh":return this.bokeh(t);case"gaussian":return this.gaussian(t);case"motion":return this.motion(t);case"radial":return this.radial(t);case"smooth":return this.smooth(t);case"denoise":return this.denoise(t);case"contrast":return this.contrast(t);case"monochrome":return this.monochrome(t);case"desaturate":return this.desaturate();case"invert":return this.invert();case"exposure":return this.exposure(t);case"highlights":return this.highlights(t);case"shadows":return this.shadows(t);case"dehaze":return this.dehaze(t);case"curves":return this.curves(t);case"toning":return this.toning(t);case"lookup":return this.lookup(t);case"fill":return this.fill(t);case"bwpoint":return this.bwpoint(t);case"levels":return this.levels(t);case"multilevels":return this.multilevels(t);case"threshold":return this.threshold(t);case"bloom":return this.bloom(t);case"glamour":return this.glamour(t);case"mimichdr":return this.mimicHDR(t);case"posterize":return this.posterize(t);case"fringe":return this.fringe(t);case"pixelate":return this.pixelate(t);case"clarity":return this.clarity(t);case"mosaic":return this.mosaic(t);case"polarcoordinates":return this.polarcoordinates(t);case"kaleidoscope":return this.kaleidoscope(t);case"reflect":return this.reflect(t);case"wave":return this.wave(t);case"fisheye":return this.fisheye(t);case"scanlines":return this.scanlines(t);case"dealiasing":return this.dealiasing();case"alpha-invert":return this.alphaInvert();case"alpha-mask":return this.alphaMask();case"alpha-shift-mask":return this.alphaShiftMask();case"outer-glow":return this.outerGlow(t);case"inner-glow":return this.innerGlow(t);case"sobel":return this.sobel();case"solarize":return this.solarize();case"halftone":return this.halftone(t);case"stroke":return this.stroke(t);case"bevel":return this.bevel(t);case"border":return this.border(t);case"rgb-split":return this.rgbSplit(t);case"slice":return this.slice(t);case"bleed":return this.bleed(t);case"interference":return this.interference(t);case"melt":return this.melt(t);case"gooey":return this.gooey(t);case"block":return this.block(t);case"curtain":return this.curtain(t);case"blinds":return this.blinds(t);case"wipe":return this.wipe(t);case"slot":return this.slot(t);case"split":return this.split(t);case"circular":return this.circular(t);case"ripple":return this.ripple(t);case"warp":return this.warp(t);default:return console.error("We don't have this type shader, "+e)}}reset(){this.chain=[],this.compiledProgram.forEach((function(e){e.destroy(this.ctx)}),this),this.compiledProgram.clear(),this.sourceTexture&&(this.activeSourceTexture=void 0,this.sourceTexture.destroy(this.ctx),this.sourceTexture=null);for(let e in this.tempFramebuffers){this.tempFramebuffers[e].destroy(this.ctx)}this.tempFramebuffers={}}apply(e,t=!1){if(0==this.chain.length)return e;this.resize(e.width,e.height),this.drawShader=0,this.sourceTexture&&this.width==e.width&&this.height==e.height||(this.sourceTexture&&(this.sourceTexture.destroy(this.ctx),this.sourceTexture=null),this.sourceTexture=new n.Z("texture"),this.sourceTexture.createTexture(this.ctx,e.width,e.height)),(e!==this.activeSourceTexture||t)&&(this.sourceTexture.uploadData(this.ctx,e),this.activeSourceTexture=e);for(var s=0;s<this.chain.length;s++)this.lastInChain=s==this.chain.length-1,this.runShader(this.chain[s].type,this.chain[s].value);return this.currentFramebufferIndex=0,this.canvas}resize(e,t){if(e!=this.width||t!=this.height){if(this.canvas.width=this.width=e,this.canvas.height=this.height=t,!this.vertexBuffer){var s=new Float32Array([-1,-1,0,0,1,-1,1,0,-1,1,0,1,-1,1,0,1,1,-1,1,0,1,1,1,1]);this.vertexBuffer=this.ctx.createBuffer(),this.ctx.bindBuffer(this.ctx.ARRAY_BUFFER,this.vertexBuffer),this.ctx.bufferData(this.ctx.ARRAY_BUFFER,s,this.ctx.STATIC_DRAW)}this.ctx.viewport(0,0,this.width,this.height);for(let e in this.tempFramebuffers){this.tempFramebuffers[e].destroy(this.ctx)}this.tempFramebuffers={}}}getTempFramebuffer(e){return this.tempFramebuffers[e]=this.tempFramebuffers[e]||this.createFramebufferTexture(this.width,this.height),this.tempFramebuffers[e]}createFramebufferTexture(e,t){let s=this.ctx.createFramebuffer();this.ctx.bindFramebuffer(this.ctx.FRAMEBUFFER,s);let i=this.ctx.createRenderbuffer();this.ctx.bindRenderbuffer(this.ctx.RENDERBUFFER,i),this.ctx.renderbufferStorage(this.ctx.RENDERBUFFER,this.ctx.DEPTH_COMPONENT16,e,t);let a=this.ctx.createTexture();return this.ctx.bindTexture(this.ctx.TEXTURE_2D,a),this.ctx.texImage2D(this.ctx.TEXTURE_2D,0,this.ctx.RGBA,e,t,0,this.ctx.RGBA,this.ctx.UNSIGNED_BYTE,null),this.ctx.texParameteri(this.ctx.TEXTURE_2D,this.ctx.TEXTURE_MAG_FILTER,this.ctx.NEAREST),this.ctx.texParameteri(this.ctx.TEXTURE_2D,this.ctx.TEXTURE_MIN_FILTER,this.ctx.NEAREST),this.ctx.texParameteri(this.ctx.TEXTURE_2D,this.ctx.TEXTURE_WRAP_S,this.ctx.CLAMP_TO_EDGE),this.ctx.texParameteri(this.ctx.TEXTURE_2D,this.ctx.TEXTURE_WRAP_T,this.ctx.CLAMP_TO_EDGE),this.ctx.framebufferTexture2D(this.ctx.FRAMEBUFFER,this.ctx.COLOR_ATTACHMENT0,this.ctx.TEXTURE_2D,a,0),this.ctx.framebufferRenderbuffer(this.ctx.FRAMEBUFFER,this.ctx.DEPTH_ATTACHMENT,this.ctx.RENDERBUFFER,i),this.ctx.bindTexture(this.ctx.TEXTURE_2D,null),this.ctx.bindFramebuffer(this.ctx.FRAMEBUFFER,null),new r.Z(s,i,a)}draw(e,t=!1){if((this.chain.length<=1||this.lastInChain)&&!t)this.ctx.bindFramebuffer(this.ctx.FRAMEBUFFER,null);else{let e=this.getTempFramebuffer(this.currentFramebufferIndex);this.ctx.bindFramebuffer(this.ctx.FRAMEBUFFER,e.framebuffer)}this.ctx.uniform4f(e.uniform.transform,1,1,0,0),this.ctx.clear(this.ctx.COLOR_BUFFER_BIT),this.ctx.clearColor(0,0,0,0),this.setTexture(e.texture),this.ctx.drawArrays(this.ctx.TRIANGLES,0,6),this.drawShader++,this.currentFramebufferIndex^=1,this.getError()}setTexture(e){let t=-1;e.forEach((function(e,s){if(this.ctx.activeTexture(this.ctx.TEXTURE0+s),0===s&&0===this.drawShader)this.ctx.bindTexture(this.ctx.TEXTURE_2D,this.sourceTexture.texture);else if(0===s){let e=1^this.currentFramebufferIndex,t=this.getTempFramebuffer(e);this.ctx.bindTexture(this.ctx.TEXTURE_2D,t.texture)}else this.ctx.bindTexture(this.ctx.TEXTURE_2D,e.texture);t=Math.max(t,s)}),this);for(let s=t+1;s<=this.lastTextureSlot;++s)this.ctx.activeTexture(this.ctx.TEXTURE0+s),this.ctx.bindTexture(this.ctx.TEXTURE_2D,null);this.lastTextureSlot=t}compileShader(e,t=this.VERTEX_IDENTITY){let s=new o.Z(this.ctx,t,e);var i=Float32Array.BYTES_PER_ELEMENT;return this.ctx.enableVertexAttribArray(s.attribute.apos),this.ctx.vertexAttribPointer(s.attribute.apos,2,this.ctx.FLOAT,!1,4*i,0*i),this.ctx.enableVertexAttribArray(s.attribute.auv),this.ctx.vertexAttribPointer(s.attribute.auv,2,this.ctx.FLOAT,!1,4*i,2*i),s}bevel(e){let t=this.compiledProgram.get("bevel");if(!t){let e="\n                precision highp float;\n\n                varying vec2 uv;\n                \n                uniform float zeroPoint;\n                uniform vec3 lightNormal;\n                uniform float dz;\n                uniform float size;\n\n                uniform vec4 lowColor;\n                uniform vec4 highColor;\n                \n                uniform sampler2D dist;\n                uniform sampler2D texture;\n                uniform vec2 px;\n\n                vec4 straightBlend(vec4 src, vec4 dst) {\n                    float alpha = src.a + dst.a * (1.0 - src.a);\n\n                    return vec4(\n                        ((src.rgb * src.a) + (dst.rgb * dst.a) * (1.0 - src.a)) / alpha,\n                        alpha\n                    );\n                }\n                \n                void main() {                    \n                    vec2 flipuv = vec2(uv.x, 1.0 - uv.y);\n                                         \n                    /* PER PIXEL OPS */\n                    float tl = clamp(0.0, size, texture2D(dist, flipuv + vec2(-px.x, -px.y)).a);\n                    float tm = clamp(0.0, size, texture2D(dist, flipuv + vec2(    0, -px.y)).a);\n                    float tr = clamp(0.0, size, texture2D(dist, flipuv + vec2( px.x, -px.y)).a);\n                \n                    float ml = clamp(0.0, size, texture2D(dist, flipuv + vec2(-px.x,     0)).a);\n                    float mr = clamp(0.0, size, texture2D(dist, flipuv + vec2( px.x,     0)).a);\n                \n                    float bl = clamp(0.0, size, texture2D(dist, flipuv + vec2(-px.x,  px.y)).a);\n                    float bm = clamp(0.0, size, texture2D(dist, flipuv + vec2(    0,  px.y)).a);\n                    float br = clamp(0.0, size, texture2D(dist, flipuv + vec2( px.x,  px.y)).a);\n                \n                    float dx = (tr + 2.0 * mr + br) - (tl + 2.0 * ml + bl);\n                    float dy = (bl + 2.0 * bm + br) - (tl + 2.0 * tm + tr);\n                \n                    vec3 surfaceNormal = vec3(dx, dy, dz);\n                    float norm = sqrt(dx*dx + dy*dy + dz*dz);\n                \n                    // Calculate incident light amount, range [-1, 0]\n                    float incidentLight = ((dot(surfaceNormal, lightNormal) / norm) - zeroPoint) - (1.0 - zeroPoint);\n                    \n                    vec4 slopes = mix(lowColor, highColor, 1.0 - abs(incidentLight));\n                    \n                    // Texture\n                    vec4 color = texture2D(texture, uv);\n\n                    // Bevel color, only use the the color where we need it\n                    float alpha = smoothstep(1e-5, dz + 8.0, distance(vec3(0.0,0.0,dz), surfaceNormal));\n                    vec4 bevelColor = vec4(slopes.rgb, slopes.a * alpha);\n\n                    gl_FragColor = straightBlend(\n                        bevelColor,\n                        color\n                    );\n                }";t=this.compileShader(e),this.compiledProgram.set("bevel",t)}this.ctx.useProgram(t.program);t.getTextureById("dist").setTexture(e.distanceMap);const s=Math.sin(e.lightElevation);this.ctx.uniform2f(t.uniform.px,1/this.width,1/this.height),this.ctx.uniform1f(t.uniform.zeroPoint,s),this.ctx.uniform3f(t.uniform.lightNormal,Math.cos(e.lightElevation)*-Math.cos(e.lightAngle),Math.cos(e.lightElevation)*-Math.sin(e.lightAngle),s),this.ctx.uniform4f(t.uniform.lowColor,e.lowLightColor.r/255,e.lowLightColor.g/255,e.lowLightColor.b/255,e.lowOpacity),this.ctx.uniform4f(t.uniform.highColor,e.highLightColor.r/255,e.highLightColor.g/255,e.highLightColor.b/255,e.highOpacity),this.ctx.uniform1f(t.uniform.dz,1/e.depth),this.ctx.uniform1f(t.uniform.size,e.size),this.draw(t)}stroke(e){const t="stroke"+(e.cutout?"-cutout":"");let s=this.compiledProgram.get(t);if(!s){let i=`\n                precision highp float;\n\n                #define CUTOUT ${e.cutout?1:0}\n\n                varying vec2 uv;\n                \n                uniform sampler2D texture;\n                uniform sampler2D distanceMap;\n                            \n                uniform vec4 glowColor;\n                uniform float size;\n\n                vec4 straightBlend(vec4 src, vec4 dst) {\n                    float alpha = src.a + dst.a * (1.0 - src.a);\n\n                    return vec4(\n                        ((src.rgb * src.a) + (dst.rgb * dst.a) * (1.0 - src.a)) / alpha,\n                        alpha\n                    );\n                }\n\n                void main(void) {           \n                    vec2 flipped = vec2(uv.x, 1.0 - uv.y);\n\n                    float distance = texture2D(distanceMap, flipped).a;\n                    float gAlpha = 1.0-smoothstep(size - 3.0, size, distance);\n\n                    vec4 gColor = vec4(\n                        glowColor.rgb, \n                        gAlpha * glowColor.a\n                    );\n\n                    vec4 texColor = texture2D(texture, uv);\n\n                    #if CUTOUT == 1\n                        vec4 tran = vec4(0);\n                        gl_FragColor = mix(gColor, tran, texColor.a);\n                    #else\n                        gl_FragColor = straightBlend(texColor, gColor);                    \n                    #endif\n                }\n            `;s=this.compileShader(i),this.compiledProgram.set(t,s)}this.ctx.useProgram(s.program),this.ctx.uniform4f(s.uniform.glowColor,e.color.r/255,e.color.g/255,e.color.b/255,e.opacity);s.getTextureById("distanceMap").setTexture(e.distanceMap),this.ctx.uniform1f(s.uniform.size,e.size),this.draw(s)}innerGlow(e){let t=this.compiledProgram.get("innerglow");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                \n                uniform sampler2D texture;\n                uniform sampler2D distanceMap;\n                            \n                uniform vec4 glowColor;\n                uniform float size;\n                uniform float feather;\n\n                void main(void) {           \n                    vec2 flipped = vec2(uv.x, 1.0 - uv.y);\n\n                    float distance = texture2D(distanceMap, flipped).a;\n                    float balance = 1.0-smoothstep(size * (1.0-feather), size, distance);\n\n                    vec4 texColor = texture2D(texture, uv);\n\n                    vec4 gColor = vec4(\n                        glowColor.rgb, \n                        texColor.a\n                    );\n                       \n                    gl_FragColor = mix(texColor, gColor, balance * glowColor.a);\n                }\n            ";t=this.compileShader(e),this.compiledProgram.set("innerglow",t)}this.ctx.useProgram(t.program),this.ctx.uniform4f(t.uniform.glowColor,e.color.r/255,e.color.g/255,e.color.b/255,e.opacity);t.getTextureById("distanceMap").setTexture(e.distanceMap),this.ctx.uniform1f(t.uniform.size,e.size),this.ctx.uniform1f(t.uniform.feather,e.feather),this.draw(t)}outerGlow(e){let t=this.compiledProgram.get("outerglow");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                \n                uniform sampler2D texture;\n                uniform sampler2D distanceMap;\n                            \n                uniform vec4 glowColor;\n                uniform float size;\n                uniform float feather;\n\n                vec4 straightBlend(vec4 src, vec4 dst) {\n                    float alpha = src.a + dst.a * (1.0 - src.a);\n\n                    return vec4(\n                        ((src.rgb * src.a) + (dst.rgb * dst.a) * (1.0 - src.a)) / alpha,\n                        alpha\n                    );\n                }\n                \n                void main(void) {           \n                    vec2 flipped = vec2(uv.x, 1.0 - uv.y);\n\n                    float distance = texture2D(distanceMap, flipped).a;\n                    float gAlpha = 1.0-smoothstep(size * (1.0-feather), size, distance);\n\n                    vec4 gColor = vec4(\n                        glowColor.rgb, \n                        gAlpha * glowColor.a\n                    );\n\n                    vec4 texColor = texture2D(texture, uv);\n                    \n                    gl_FragColor = straightBlend(texColor, gColor);                    \n                }\n            ";t=this.compileShader(e),this.compiledProgram.set("outerglow",t)}this.ctx.useProgram(t.program),this.ctx.uniform4f(t.uniform.glowColor,e.color.r/255,e.color.g/255,e.color.b/255,e.opacity);t.getTextureById("distanceMap").setTexture(e.distanceMap),this.ctx.uniform1f(t.uniform.size,e.size),this.ctx.uniform1f(t.uniform.feather,e.feather),this.draw(t)}sobel(){let e=this.compiledProgram.get("sobel");if(!e){let t="\n                precision mediump float;\n\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform vec2 px;\n\n                uniform float m[3];\n                #define M_PI 3.1415926535897932384626433832795\n                #define GET_PIXEL(x,y) (texture2D(texture, uv + px*vec2(x,y)))\n\n                void main() {\n\n                    float dx = (length(GET_PIXEL(-1, -1)*m[0] +\n                                GET_PIXEL(-1,  0)*m[1] +\n                                GET_PIXEL(-1, +1)*m[2]) -\n                            length(GET_PIXEL(+1, -1)*m[0] +\n                                GET_PIXEL(+1,  0)*m[1] +\n                                GET_PIXEL(+1, +1)*m[2]));\n\n                    float dy = (length(GET_PIXEL(-1, -1)*m[0] +\n                                GET_PIXEL(0, -1)*m[1] +\n                                GET_PIXEL(+1, -1)*m[2]) -\n                            length(GET_PIXEL(-1, +1)*m[0] +\n                                GET_PIXEL(0, +1)*m[1] +\n                                GET_PIXEL(+1, +1)*m[2]));\n\n                    float theta = (atan(dy, dx) + M_PI) / (2.0*M_PI);\n\n                    gl_FragColor = vec4(length(vec2(dx, dy)), theta, 0.0, 1.0);\n                }";e=this.compileShader(t),this.compiledProgram.set("sobel",e)}if(this.ctx.useProgram(e.program),this.ctx.uniform2f(e.uniform.px,1/this.width,1/this.height),this.ctx.uniform1fv(e.uniform.m,[1,2,1]),this.draw(e,!0),e=this.compiledProgram.get("sobelNMS"),!e){let t="\n                precision mediump float;\n\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform vec2 px;\n\n                #define M_PI 3.1415926535897932384626433832795\n\n                void main() {\n                    vec4 cc = texture2D(texture, uv);  \n                    float theta = degrees(cc.y*M_PI*2.0); \n                    int ax = 0, ay = 0; \n                    if ((theta >= 337.5) || (theta < 22.5)) { ax = 1; ay = 0; } \n                    else if ((theta >= 22.5) && (theta < 67.5)) { ax = 1; ay = 1; } \n                    else if ((theta >= 67.5) && (theta < 112.5)) { ax = 0; ay = 1; } \n                    else if ((theta >= 112.5) && (theta < 157.5)) { ax =-1; ay = 1; } \n                    else if ((theta >= 157.5) && (theta < 202.5)) { ax =-1; ay = 0; } \n                    else if ((theta >=202.5) && (theta < 247.5)) { ax =-1; ay =-1; } \n                    else if ((theta >=247.5) && (theta < 292.5)) { ax = 0; ay =-1; } \n                    else if ((theta >= 292.5) && (theta < 337.5)) { ax = 1; ay =-1; }\n                \n                    vec4 ca = texture2D(texture, uv + px*vec2(ax, ay));\n                    vec4 cb = texture2D(texture, uv + px*vec2(-ax, -ay));\n                    gl_FragColor = vec4((((cc.x <= ca.x) || (cc.x < cb.x)) ? vec3(0) : vec3(cc.x)), 1.0);\n                }";e=this.compileShader(t),this.compiledProgram.set("sobelNMS",e)}this.ctx.useProgram(e.program),this.ctx.uniform2f(e.uniform.px,1/this.width,1/this.height),this.draw(e)}vibrance(e){let t=this.compiledProgram.get("vibrance");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n\n                void main() {\n\n                    vec4 col = texture2D(texture, uv.xy);\n                    vec3 color = col.rgb;\n                \n                    float luminance = color.r*0.299 + color.g*0.587 + color.b*0.114;\n                    float mn = min(min(color.r, color.g), color.b);\n                    float mx = max(max(color.r, color.g), color.b);\n                    float sat = (1.0-(mx - mn)) * (1.0-mx) * luminance * 5.0;\n                    vec3 lightness = vec3((mn + mx)/2.0);\n                \n                    // vibrance\n                    color = mix(color, mix(color, lightness, -amount), sat);\n                \n                    // negative vibrance\n                    gl_FragColor = vec4(mix(color, lightness, (1.0-lightness)*(1.0-amount)/2.0*abs(amount)), col.a);\n                }";t=this.compileShader(e),this.compiledProgram.set("vibrance",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.amount,e),this.draw(t)}lightness(e){let t=this.compiledProgram.get("lightness");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n\n                void main() {\n                    vec4 color = texture2D(texture, uv);\n                    color.rgb += amount;\n                    gl_FragColor = color;\n                }";t=this.compileShader(e),this.compiledProgram.set("lightness",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.amount,e),this.draw(t)}brightness(e){let t;if(e>0){if(t=this.compiledProgram.get("brightness-up"),!t){let e="\n                    precision highp float;\n                    varying vec2 uv;\n                    uniform sampler2D texture;\n                    uniform float amount;\n\n                    #define PI 3.1415926535897932384626433832795\n\n                    void main() {\n                        vec4 color = texture2D(texture, uv);\n\n                        color.r = color.r + amount * sin(color.r * PI);\n                        color.g = color.g + amount * sin(color.g * PI);\n                        color.b = color.b + amount * sin(color.b * PI);\n\n                        gl_FragColor = color;\n                    }";t=this.compileShader(e),this.compiledProgram.set("brightness-up",t)}}else if(t=this.compiledProgram.get("brightness-down"),!t){let e="\n                    precision highp float;\n                    varying vec2 uv;\n                    uniform sampler2D texture;\n                    uniform float amount;\n\n                    void main() {\n                        vec4 color = texture2D(texture, uv);\n     \n                        color.r = (1.0 + amount) * color.r;\n                        color.g = (1.0 + amount) * color.g;\n                        color.b = (1.0 + amount) * color.b;\n\n                        gl_FragColor = color;\n                    }";t=this.compileShader(e),this.compiledProgram.set("brightness-down",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.amount,e>0?.35*e:.75*e),this.draw(t)}bwpoint(e){let t=this.compiledProgram.get("bwpoint");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n\n                uniform float white;\n                uniform float black;\n\n                void main() {\n\n                    float bval = black / 255.0;\n                    float wval = (255.0 / (white - black));\n                \n                    vec3 color = texture2D(texture, uv).rgb;\n                    color = color * wval - (bval *  wval);\n\n                    gl_FragColor = vec4(color, texture2D(texture, uv).a);\n                }";t=this.compileShader(e),this.compiledProgram.set("bwpoint",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.black,e.black),this.ctx.uniform1f(t.uniform.white,e.white),this.draw(t)}dealiasing(){let e=this.compiledProgram.get("dealiasing");if(!e){let t="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n\n                void main() {\n                    vec4 color = texture2D(texture, uv);\n                    color.a = (color.a < 0.25) ? 0.0 : 1.0;\n                    gl_FragColor = color;\n                }";e=this.compileShader(t),this.compiledProgram.set("dealiasing",e)}this.ctx.useProgram(e.program),this.draw(e)}alphaInvert(){let e=this.compiledProgram.get("alpha-invert");if(!e){let t="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n\n                void main() {\n                    vec4 color = texture2D(texture, uv);\n                    color.a = 1.0 - color.a;\n                    gl_FragColor = color;\n                }";e=this.compileShader(t),this.compiledProgram.set("alpha-invert",e)}this.ctx.useProgram(e.program),this.draw(e)}alphaMask(){let e=this.compiledProgram.get("alpha-mask");if(!e){let t="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n\n                void main() {\n                    gl_FragColor = vec4(0,0,0, texture2D(texture, uv).a);\n                }";e=this.compileShader(t),this.compiledProgram.set("alpha-mask",e)}this.ctx.useProgram(e.program),this.draw(e)}alphaShiftMask(){let e=this.compiledProgram.get("alpha-shift-mask");if(!e){let t="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n\n                void main() {\n                    gl_FragColor = vec4(0,0,0, texture2D(texture, uv).r);\n                }";e=this.compileShader(t),this.compiledProgram.set("alpha-shift-mask",e)}this.ctx.useProgram(e.program),this.draw(e)}border(e){let t=this.compiledProgram.get("border");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n\n                uniform sampler2D texture;\n                uniform float size;\n                uniform vec4 color;\n                uniform vec2 screen;\n                uniform vec2 px;\n\n                void main() {\n                    vec4 pixel = texture2D(texture, uv);\n\n                    if(uv.y <= size*px.y || uv.y >= (screen.y-size)*px.y ||\n                       uv.x <= size*px.x || uv.x >= (screen.x-size)*px.x) {\n                        gl_FragColor = color;\n                    } else {\n                        gl_FragColor = pixel;\n                    }\n                }";t=this.compileShader(e),this.compiledProgram.set("border",t)}let s=Math.round((this.width+this.height)/2*e.size);this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.size,s),this.ctx.uniform2f(t.uniform.screen,this.width,this.height),this.ctx.uniform2f(t.uniform.px,1/this.width,1/this.height),this.ctx.uniform4f(t.uniform.color,e.color.r/255,e.color.g/255,e.color.b/255,1),this.draw(t)}balance(e){let t=this.compiledProgram.get("balance");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n\n                uniform float sr;\n                uniform float sg;\n                uniform float sb;\n                uniform float mr;\n                uniform float mg;\n                uniform float mb;\n                uniform float hr;\n                uniform float hg;\n                uniform float hb;\n                uniform float preserve;\n\n                #define PI 3.1415926535897932384626433832795\n\n                float Lum(vec4 c){\n                    return 0.299*c.r + 0.587*c.g + 0.114*c.b;\n                }\n\n                void main() {\n                    vec4 color = texture2D(texture, uv);\n                    \n                    float olum = Lum(color);\n\n                    //highlight\n                    color.r = clamp(color.r + (hr * (exp(color.r) - 1.0)), 0.0, 1.0);\n                    color.g = clamp(color.g + (hg * (exp(color.g) - 1.0)), 0.0, 1.0);\n                    color.b = clamp(color.b + (hb * (exp(color.b) - 1.0)), 0.0, 1.0);\n\n                    //midtone\n                    color.r = clamp(color.r + (mr * 0.25) * sin(color.r * PI), 0.0, 1.0);\n                    color.g = clamp(color.g + (mg * 0.25) * sin(color.g * PI), 0.0, 1.0);\n                    color.b = clamp(color.b + (mb * 0.25) * sin(color.b * PI), 0.0, 1.0);\n\n                    //shadow\n                    color.r = clamp((1.0 - sr * 0.5) * color.r + (1.0 - (1.0 - sr * 0.5)), 0.0, 1.0);\n                    color.g = clamp((1.0 - sg * 0.5) * color.g + (1.0 - (1.0 - sg * 0.5)), 0.0, 1.0);\n                    color.b = clamp((1.0 - sb * 0.5) * color.b + (1.0 - (1.0 - sb * 0.5)), 0.0, 1.0);\n                    \n                    if(preserve == 1.0) {\n                        float nlum = Lum(color);\n                        color.rgb = color.rgb * (olum/nlum);\n                    }\n\n                    gl_FragColor = color;\n                }";t=this.compileShader(e),this.compiledProgram.set("balance",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.sr,e.shadowRed),this.ctx.uniform1f(t.uniform.sg,e.shadowGreen),this.ctx.uniform1f(t.uniform.sb,e.shadowBlue),this.ctx.uniform1f(t.uniform.mr,e.midtoneRed),this.ctx.uniform1f(t.uniform.mg,e.midtoneGreen),this.ctx.uniform1f(t.uniform.mb,e.midtoneBlue),this.ctx.uniform1f(t.uniform.hr,e.highlightRed),this.ctx.uniform1f(t.uniform.hg,e.highlightGreen),this.ctx.uniform1f(t.uniform.hb,e.highlightBlue),this.ctx.uniform1f(t.uniform.preserve,Number(e.preserve)),this.draw(t)}temperature(e){let t=this.compiledProgram.get("temperature");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n\n                void main() {\n                    vec4 color = texture2D(texture, uv);\n                    color.r = clamp(color.r + amount, 0.0, 1.0);\n                    color.b = clamp(color.b - amount, 0.0, 1.0);\n                    gl_FragColor = color;\n                }";t=this.compileShader(e),this.compiledProgram.set("temperature",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.amount,e/6),this.draw(t)}tint(e){let t=this.compiledProgram.get("tint");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n\n                void main() {\n                    vec4 color = texture2D(texture, uv);\n                    color.g = clamp(color.g + amount, 0.0, 1.0);\n                    gl_FragColor = color;\n                }";t=this.compileShader(e),this.compiledProgram.set("tint",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.amount,e/6),this.draw(t)}threshold(e){let t=this.compiledProgram.get("threshold");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n\n                void main() {\n                    vec4 color = texture2D(texture, uv);\n                    float value = (color.r + color.g + color.b) / 3.0 < amount ? 0.0 : 1.0;\n                    gl_FragColor = vec4(value, value, value, color.a);\n                }";t=this.compileShader(e),this.compiledProgram.set("threshold",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.amount,e),this.draw(t)}noise(e){let t=this.compiledProgram.get("noise");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n\n                float random(vec2 p) {\n                    vec2 r = vec2(23.14069263277926,2.665144142690225);\n                    return fract(cos(mod(12345678.,256. * dot(p,r))));\n                }\n\n                void main() {\n                    vec4 color = texture2D(texture, uv);\n                    float noise = (random(uv) -0.5)*amount;\n\n                    gl_FragColor = vec4(color.r+noise, color.g+noise, color.b+noise, color.a);\n                }";t=this.compileShader(e),this.compiledProgram.set("noise",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.amount,e),this.draw(t)}halftone(e){let t=this.compiledProgram.get("halftone");if(!t){this.ctx.getExtension("OES_standard_derivatives");let e="\n                #ifdef GL_OES_standard_derivatives\n                #extension GL_OES_standard_derivatives : enable\n                #endif\n\n                precision highp float;                \n\n                uniform sampler2D texture;\n                uniform vec2 size;\n                uniform float frequency;\n  \n                varying vec2 uv; // Texcoords\n\n                float aastep(float threshold, float value) {\n                #ifdef GL_OES_standard_derivatives\n                    float afwidth = 0.7 * length(vec2(dFdx(value), dFdy(value)));\n                #else\n                    float afwidth = frequency * (1.0/size.x);\n                #endif\n                    return smoothstep(threshold-afwidth, threshold+afwidth, value);\n                }\n\n                // Explicit bilinear texture lookup to circumvent bad hardware precision.\n                // The extra arguments specify the dimension of the texture. (GLSL 1.30\n                // introduced textureSize() to get that information from the sampler.)\n                // 'dims' is the width and height of the texture, 'one' is 1.0/dims.\n                // (Precomputing 'one' saves two divisions for each lookup.)\n                vec4 texture2D_bilinear(sampler2D tex, vec2 st, vec2 dims, vec2 one) {\n                    vec2 uv = st * dims;\n                    vec2 uv00 = floor(uv - vec2(0.5)); // Lower left corner of lower left texel\n                    vec2 uvlerp = uv - uv00 - vec2(0.5); // Texel-local lerp blends [0,1]\n                    vec2 st00 = (uv00 + vec2(0.5)) * one;\n                    vec4 texel00 = texture2D(tex, st00);\n                    vec4 texel10 = texture2D(tex, st00 + vec2(one.x, 0.0));\n                    vec4 texel01 = texture2D(tex, st00 + vec2(0.0, one.y));\n                    vec4 texel11 = texture2D(tex, st00 + one);\n                    vec4 texel0 = mix(texel00, texel01, uvlerp.y); \n                    vec4 texel1 = mix(texel10, texel11, uvlerp.y); \n                    return mix(texel0, texel1, uvlerp.x);\n                }\n\n                vec2 mod289(vec2 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }\n                vec3 mod289(vec3 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }\n                vec3 permute(vec3 x) { return mod289((( x * 34.0) + 1.0) * x); }\n                \n                float snoise(vec2 v) {\n                    const vec4 C = vec4(0.211324865405187,  // (3.0-sqrt(3.0))/6.0\n                                        0.366025403784439,  // 0.5*(sqrt(3.0)-1.0)\n                                        -0.577350269189626,  // -1.0 + 2.0 * C.x\n                                        0.024390243902439); // 1.0 / 41.0\n                    // First corner\n                    vec2 i = floor(v + dot(v, C.yy) );\n                    vec2 x0 = v - i + dot(i, C.xx);\n                    // Other corners\n                    vec2 i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);\n                    vec4 x12 = x0.xyxy + C.xxzz;\n                    x12.xy -= i1;\n                    // Permutations\n                    i = mod289(i); // Avoid truncation effects in permutation\n                    vec3 p = permute( permute( i.y + vec3(0.0, i1.y, 1.0 ))\n                                            + i.x + vec3(0.0, i1.x, 1.0 ));\n                    vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy),\n                                            dot(x12.zw,x12.zw)), 0.0);\n                    m = m*m; m = m*m;\n                    // Gradients\n                    vec3 x = 2.0 * fract(p * C.www) - 1.0;\n                    vec3 h = abs(x) - 0.5;\n                    vec3 a0 = x - floor(x + 0.5);\n                    // Normalise gradients implicitly by scaling m\n                    m *= 1.792843 - 0.853735 * ( a0*a0 + h*h );\n                    // Compute final noise value at P\n                    vec3 g;\n                    g.x = a0.x * x0.x + h.x * x0.y;\n                    g.yz = a0.yz * x12.xz + h.yz * x12.yw;\n                    return 130.0 * dot(m, g);\n                }\n                \n                void main() {\n                    // Correct UVs for aspect ratio so we get round balls not squished\n                    vec2 auv = uv;\n                    auv.x *= size.x / size.y;\n\n                    vec3 color = texture2D_bilinear(texture, uv, size, 1.0 / size).rgb;\n\n                    float n = 0.1*snoise(auv*200.0); // Fractal noise\n                    n += 0.05*snoise(auv*400.0);\n                    n += 0.025*snoise(auv*800.0);\n\n                    vec3 white = vec3(n*0.2 + 0.97);\n                    vec3 black = vec3(n + 0.1);\n\n                    // Perform a rough RGB-to-CMYK conversion\n                    vec4 cmyk;\n                    cmyk.xyz = 1.0 - color;\n                    cmyk.w = min(cmyk.x, min(cmyk.y, cmyk.z)); // Create K\n                    cmyk.xyz -= cmyk.w; // Subtract K equivalent from CMY\n                \n                    // Distance to nearest point in a grid of\n                    // (frequency x frequency) points over the unit square\n                    vec2 Kst = frequency*mat2(0.707, -0.707, 0.707, 0.707)*auv;\n                    vec2 Kuv = 2.0*fract(Kst)-1.0;\n                    float k = aastep(0.0, sqrt(cmyk.w)-length(Kuv)+n);\n                    vec2 Cst = frequency*mat2(0.966, -0.259, 0.259, 0.966)*auv;\n                    vec2 Cuv = 2.0*fract(Cst)-1.0;\n                    float c = aastep(0.0, sqrt(cmyk.x)-length(Cuv)+n);\n                    vec2 Mst = frequency*mat2(0.966, 0.259, -0.259, 0.966)*auv;\n                    vec2 Muv = 2.0*fract(Mst)-1.0;\n                    float m = aastep(0.0, sqrt(cmyk.y)-length(Muv)+n);\n                    vec2 Yst = frequency*auv; // 0 deg\n                    vec2 Yuv = 2.0*fract(Yst)-1.0;\n                    float y = aastep(0.0, sqrt(cmyk.z)-length(Yuv)+n);\n                \n                    vec3 rgbscreen = 1.0 - 0.9*vec3(c,m,y) + n;\n                    rgbscreen = mix(rgbscreen, black, 0.85*k + 0.3*n);\n                \n                    #ifdef GL_OES_standard_derivatives\n                        float afwidth = 2.0 * frequency * max(length(dFdx(uv)), length(dFdy(uv)));\n                    #else\n                        float afwidth = frequency * (1.0/size.x);\n                    #endif\n                    \n                    float blend = smoothstep(0.7, 1.4, afwidth); \n                    gl_FragColor = vec4(mix(rgbscreen, color, blend), 1.0);\n                }\n            ";t=this.compileShader(e),this.compiledProgram.set("halftone",t)}this.ctx.useProgram(t.program),this.ctx.uniform2f(t.uniform.size,this.width,this.height),this.ctx.uniform1f(t.uniform.frequency,Math.round(100*e)),this.draw(t)}vignette(e){let t=this.compiledProgram.get(e<0?"vignette-white":"vignette-black");if(!t){let s=["precision highp float;","varying vec2 uv;","uniform sampler2D texture;","uniform float amount;","uniform float size;","void main() {","vec4 color = texture2D(texture, uv);","float dist = distance(uv, vec2(0.5, 0.5));","float grd = smoothstep(0.8, size * 0.799, dist * (amount*0.6 + size*2.0));","color.rgb += vec3(1.0, 1.0, 1.0) * (1.0 - grd);","gl_FragColor = color;","}"].join("\n"),i=["precision highp float;","varying vec2 uv;","uniform sampler2D texture;","uniform float amount;","uniform float size;","void main() {","vec4 color = texture2D(texture, uv);","float dist = distance(uv, vec2(0.5, 0.5));","color.rgb *= smoothstep(0.8, size * 0.799, dist * (amount*0.75 + size*2.0));","gl_FragColor = color;","}"].join("\n");t=this.compileShader(e<0?s:i),this.compiledProgram.set(e<0?"vignette-white":"vignette-black",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.size,.25),this.ctx.uniform1f(t.uniform.amount,e<0?-1*e:e),this.draw(t)}grain(e){let t=this.compiledProgram.get("grain");if(!t){let e=["precision highp float;","uniform sampler2D texture;","varying vec2 uv;","uniform float width;","uniform float height;","uniform float grainamount;","uniform float timer;","const float permTexUnit = 1.0/256.0;","const float permTexUnitHalf = 0.5/256.0;","float grainsize = 1.8;","float lumamount = 1.0;","vec4 rnm(in vec2 tc)","{","float noise =  sin(dot(tc + vec2(timer,timer),vec2(12.9898,78.233))) * 43758.5453;","float noiseR =  fract(noise)*2.0-1.0;","float noiseG =  fract(noise*1.2154)*2.0-1.0; ","float noiseB =  fract(noise*1.3453)*2.0-1.0;","float noiseA =  fract(noise*1.3647)*2.0-1.0;","return vec4(noiseR,noiseG,noiseB,noiseA);","}","float fade(in float t) {","return t*t*t*(t*(t*6.0-15.0)+10.0);","}","float pnoise3D(in vec3 p)","{","vec3 pi = permTexUnit*floor(p)+permTexUnitHalf;","vec3 pf = fract(p);","float perm00 = rnm(pi.xy).a ;","vec3  grad000 = rnm(vec2(perm00, pi.z)).rgb * 4.0 - 1.0;","float n000 = dot(grad000, pf);","vec3  grad001 = rnm(vec2(perm00, pi.z + permTexUnit)).rgb * 4.0 - 1.0;","float n001 = dot(grad001, pf - vec3(0.0, 0.0, 1.0));","float perm01 = rnm(pi.xy + vec2(0.0, permTexUnit)).a ;","vec3  grad010 = rnm(vec2(perm01, pi.z)).rgb * 4.0 - 1.0;","float n010 = dot(grad010, pf - vec3(0.0, 1.0, 0.0));","vec3  grad011 = rnm(vec2(perm01, pi.z + permTexUnit)).rgb * 4.0 - 1.0;","float n011 = dot(grad011, pf - vec3(0.0, 1.0, 1.0));","float perm10 = rnm(pi.xy + vec2(permTexUnit, 0.0)).a ;","vec3  grad100 = rnm(vec2(perm10, pi.z)).rgb * 4.0 - 1.0;","float n100 = dot(grad100, pf - vec3(1.0, 0.0, 0.0));","vec3  grad101 = rnm(vec2(perm10, pi.z + permTexUnit)).rgb * 4.0 - 1.0;","float n101 = dot(grad101, pf - vec3(1.0, 0.0, 1.0));","float perm11 = rnm(pi.xy + vec2(permTexUnit, permTexUnit)).a ;","vec3  grad110 = rnm(vec2(perm11, pi.z)).rgb * 4.0 - 1.0;","float n110 = dot(grad110, pf - vec3(1.0, 1.0, 0.0));","vec3  grad111 = rnm(vec2(perm11, pi.z + permTexUnit)).rgb * 4.0 - 1.0;","float n111 = dot(grad111, pf - vec3(1.0, 1.0, 1.0));","vec4 n_x = mix(vec4(n000, n001, n010, n011), vec4(n100, n101, n110, n111), fade(pf.x));","vec2 n_xy = mix(n_x.xy, n_x.zw, fade(pf.y));","float n_xyz = mix(n_xy.x, n_xy.y, fade(pf.z));","return n_xyz;","}","vec2 coordRot(in vec2 tc, in float angle)","{","float aspect = width/height;","float rotX = ((tc.x*2.0-1.0)*aspect*cos(angle)) - ((tc.y*2.0-1.0)*sin(angle));","float rotY = ((tc.y*2.0-1.0)*cos(angle)) + ((tc.x*2.0-1.0)*aspect*sin(angle));","rotX = ((rotX/aspect)*0.5+0.5);","rotY = rotY*0.5+0.5;","return vec2(rotX,rotY);","}","void main() ","{","vec3 rotOffset = vec3(1.425,3.892,5.835);","vec2 rotCoordsR = coordRot(uv, timer + rotOffset.x);","vec3 noise = vec3(pnoise3D(vec3(rotCoordsR*vec2(width/grainsize,height/grainsize),0.0)));","vec4 tex = texture2D(texture, uv);","vec3 col = tex.rgb;","vec3 lumcoeff = vec3(0.299,0.587,0.114);","float luminance = mix(0.0,dot(col, lumcoeff),lumamount);","float lum = smoothstep(0.2,0.0,luminance);","lum += luminance;","noise = mix(noise,vec3(0.0),pow(lum,4.0));","col = col+noise*grainamount;","gl_FragColor =  vec4(col, tex.w);","}"].join("\n");t=this.compileShader(e),this.compiledProgram.set("grain",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.width,this.width),this.ctx.uniform1f(t.uniform.height,this.height),this.ctx.uniform1f(t.uniform.grainamount,e/10),this.draw(t)}sharpen(e){let t=this.compiledProgram.get("sharpen");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform vec2 px;\n                uniform float m[9];\n                uniform float amount;\n\n                void main(void) {\n                    vec4 c11 = texture2D(texture, uv - px); // top left\n                    vec4 c12 = texture2D(texture, vec2(uv.x, uv.y - px.y)); // top center\n                    vec4 c13 = texture2D(texture, vec2(uv.x + px.x, uv.y - px.y)); // top right\n\n                    vec4 c21 = texture2D(texture, vec2(uv.x - px.x, uv.y) ); // mid left\n                    vec4 c22 = texture2D(texture, uv); // mid center\n                    vec4 c23 = texture2D(texture, vec2(uv.x + px.x, uv.y) ); // mid right\n\n                    vec4 c31 = texture2D(texture, vec2(uv.x - px.x, uv.y + px.y) ); // bottom left\n                    vec4 c32 = texture2D(texture, vec2(uv.x, uv.y + px.y) ); // bottom center\n                    vec4 c33 = texture2D(texture, uv + px ); // bottom right\n\n                    vec4 color = \n                        c11 * m[0] + c12 * m[1] + c13 * m[2] +\n                        c21 * m[3] + c22 * m[4] + c23 * m[5] +\n                        c31 * m[6] + c32 * m[7] + c33 * m[8];\n\n                    gl_FragColor = color * amount + (c22 * (1.0 - amount));\n                }";t=this.compileShader(e),this.compiledProgram.set("sharpen",t)}let s=new Float32Array([-1,-1,-1,-1,9,-1,-1,-1,-1]);this.ctx.useProgram(t.program),this.ctx.uniform1fv(t.uniform.m,s),this.ctx.uniform2f(t.uniform.px,1/this.width,1/this.height),this.ctx.uniform1f(t.uniform.amount,e/2),this.draw(t)}blur(e,t=!1){let s=this.compiledProgram.get("blur");if(!s){let e="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform vec2 size;\n                float random(vec3 scale, float seed) {\n                    return fract(sin(dot(gl_FragCoord.xyz + seed, scale)) * 43758.5453 + seed);\n                }\n                void main() {\n                    vec4 color = vec4(0.0);\n                    float total = 0.0;\n                    float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\n                    for (float t = -30.0; t <= 30.0; t++) {\n                        float percent = (t + offset - 0.5) / 30.0;\n                        float weight = 1.0 - abs(percent);\n                        vec4 sample = texture2D(texture, uv + size * percent);\n                        sample.rgb *= sample.a;\n                        color += sample * weight;\n                        total += weight;\n                    }\n                    gl_FragColor = color / total;\n                    gl_FragColor.rgb /= gl_FragColor.a + 0.00001;\n                }";s=this.compileShader(e),this.compiledProgram.set("blur",s)}let i=40*e/this.canvas.width,a=40*e/this.canvas.height;this.ctx.useProgram(s.program),this.ctx.uniform2f(s.uniform.size,0,a),this.draw(s,!0),this.ctx.uniform2f(s.uniform.size,i,0),this.draw(s,t)}zoom(e){let t=this.compiledProgram.get("zoom");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n\n                uniform vec2 center;\n                uniform float amount;\n                uniform vec2 px;\n                \n                float random(vec3 scale, float seed) {\n                    /* use the fragment position for a different seed per-pixel */                    return fract(sin(dot(gl_FragCoord.xyz + seed, scale)) * 43758.5453 + seed);\n                }\n                void main() {\n                    vec4 color = vec4(0.0);\n                    float total = 0.0;\n                    vec2 toCenter = (center - uv) * px;\n                    \n                    /* randomize the lookup values to hide the fixed number of samples */\n                    float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\n                    \n                    for (float t = 0.0; t <= 40.0; t++) {\n                        float percent = (t + offset) / 40.0;\n                        float weight = 4.0 * (percent - percent * percent);\n                        vec4 sample = texture2D(texture, uv + toCenter * percent * amount / px);\n                        \n                        /* switch to pre-multiplied alpha to correctly blur transparent images */\n                        sample.rgb *= sample.a;\n                        \n                        color += sample * weight;\n                        total += weight;\n                    }\n                    gl_FragColor = color / total;\n                    gl_FragColor.rgb /= gl_FragColor.a + 0.00001;\n                }";t=this.compileShader(e),this.compiledProgram.set("zoom",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.amount,e.amount),this.ctx.uniform2f(t.uniform.center,e.x,e.y),this.ctx.uniform2f(t.uniform.px,1/this.width,1/this.height),this.draw(t)}makeKernel(e){const t=this.GAUSSKERN_MAX+Number(!(1&this.GAUSSKERN_MAX)),s=Math.sqrt(2*Math.PI)*e,i=2*e*e;var a,n,o=~~(t/2),r=new Float32Array(t);for(n=0,a=-o;n<t;a++,n++)r[n]=Math.exp(-a*a/i)/s;return r}scaleKernel(e){const t=e.reduce(((e,t)=>e+t))||1;return e.map((e=>e/t))}gaussian(e){const t=this.makeKernel(10*e),s=t.length+Number(!(1&t.length));let i=this.compiledProgram.get(`guass-${s}`);if(!i){let e=`\n                precision mediump float;\n                #define KERNEL_SIZE ${s}\n                #define KERNEL_HALF KERNEL_SIZE / 2\n                // our texture\n                varying vec2 uv;\n                uniform vec2 px;\n                uniform sampler2D texture;\n                uniform float kernel[KERNEL_SIZE];\n                void main() {\n                    vec4 result = vec4(0.0);\n                    for (int i = 0; i < KERNEL_SIZE; i++) {\n                        result += texture2D(texture, uv + px*vec2(i - KERNEL_HALF))*kernel[i];\n                    }\n                    gl_FragColor = result;\n                }\n            `;i=this.compileShader(e),this.compiledProgram.set(`guass-${s}`,i)}this.ctx.useProgram(i.program),this.ctx.uniform2f(i.uniform.px,0,1/this.height),this.ctx.uniform1fv(i.uniform.kernel,this.scaleKernel(t)),this.draw(i,!0),this.ctx.uniform2f(i.uniform.px,1/this.width,0),this.draw(i)}radial(e){let t=this.compiledProgram.get("radial");if(!t){let e="\n                precision highp float;\n                const float PI = 3.1415926535897932384626433832795;\n                const float samples = 100.;\n\n                uniform sampler2D texture;\n\n                varying vec2 uv;\n                uniform vec2 center;\n                uniform vec2 resolution;\n\n                uniform float amount;\n                uniform int direction;\n                uniform int symmetry;\n               \n                mat2 rotate2d(float _angle){\n                    return mat2(cos(_angle),-sin(_angle),\n                                sin(_angle),cos(_angle));\n                }\n\n                vec2 rotateUV(vec2 uv, mat2 transform, vec2 centerc) {\n                    uv -= centerc;\n                    uv = transform * uv;\n                    uv += centerc;\n                    return uv;\n                }\n             \n                void main(void) {\n                    float ar = resolution.x / resolution.y;\n                    vec2 uvc = uv;\n                    vec2 centerc = center;\n\n                    if (symmetry == 1)\n                    {\n                        if (resolution.x > resolution.y) {\n                            centerc.y /= ar;\n                            uvc.y /= ar;\n                        }\n                        else {\n                            centerc.x *= ar;\n                            uvc.x *= ar;\n                        }\n                    }\n\n                    vec2 coordcw = uvc;\n                    vec2 coordccw = uvc;\n                    vec4 FragColor = vec4(0.0, 0.0, 0.0, 0.0);\n                    vec2 toCenter = uvc - centerc;\n                    float endsamples = 0.;\n\n                    float a = amount / samples;\n\n                    mat2 matcw = rotate2d(-a * PI / 180.);\n                    mat2 matccw = rotate2d(a * PI / 180.);\n\n                    for (float i = 0.; i < samples; i+=1.) {\n                        if (direction == 1 || direction == 2) {\n                            coordccw = rotateUV(coordccw, matccw, centerc);\n                            FragColor += texture2D(texture, coordccw);\n                            endsamples += 1.;\n                        }\n\n                        if (direction == 0 || direction == 2) {\n                            coordcw = rotateUV(coordcw, matcw, centerc);\n                            FragColor += texture2D(texture, coordcw);\n                            endsamples += 1.;\n                        }\n                    }\n                    FragColor /= endsamples;\n                    gl_FragColor = FragColor;\n                }\n            ";t=this.compileShader(e),this.compiledProgram.set("radial",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.amount,180*e.amount),this.ctx.uniform2f(t.uniform.center,e.x,e.y),this.ctx.uniform1i(t.uniform.direction,e.direction),this.ctx.uniform2f(t.uniform.resolution,this.width,this.height),this.ctx.uniform1i(t.uniform.symmetry,e.symmetry?1:0),this.draw(t)}motion(e){let t=this.compiledProgram.get("motion");if(!t){let e="\n                precision mediump float;\n                uniform float KERNEL_SIZE;\n                varying vec2 uv;\n                uniform vec2 resolution;\n                uniform sampler2D texture;\n                uniform float angle;\n\n                bool outOfRange(vec2 uv) {\n                    return uv.x < 0. || uv. y < 0. || uv.x > 1. || uv.y > 1.;\n                }\n                mat2 rotate2d(float _angle){\n                    return mat2(cos(_angle),-sin(_angle),\n                                sin(_angle),cos(_angle));\n                }\n                void main() {\n                    vec4 result = vec4(0.0);\n                    vec2 resol = vec2 (1./resolution.x, 0.);//1./resolution.y);\n                    resol = rotate2d(angle) * resol;\n                    float divcnt = 1.;\n                    for (float i=1.; i <= 100.; i+=1.) {\n                        vec2 before = uv - resol * i;\n                        if (!outOfRange(before)) {\n                            result += texture2D(texture, before);\n                            divcnt += 1.;\n                        }\n                        vec2 after = uv + resol * i;\n                        if (!outOfRange(after)) {\n                            result += texture2D(texture, after);\n                            divcnt += 1.;\n                        }\n                        if (i >= KERNEL_SIZE) break;\n                    }\n                    result += texture2D(texture, uv);\n                    result /= divcnt;\n                    gl_FragColor = result;\n                }\n            ";t=this.compileShader(e),this.compiledProgram.set("motion",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.KERNEL_SIZE,100*e.amount),this.ctx.uniform1f(t.uniform.angle,e.angle),this.ctx.uniform2f(t.uniform.resolution,this.width,this.height),this.draw(t)}clarity(e){let t=this.compiledProgram.get("clarity");if(!t){const e="\n                #define GLSLIFY 1\n                precision highp float;\n                varying vec2 uv;\n                \n                uniform sampler2D texture;\n                uniform float amount;\n                uniform vec2 px;\n                           \n                float Lum(vec3 c){\n                    return 0.299*c.r + 0.587*c.g + 0.114*c.b;\n                }\n                float BlendOverlayf(float base, float blend){\n                    return (base < 0.5 ? (2.0 * base * blend) : (1.0 - 2.0 * (1.0 - base) * (1.0 - blend)));\n                }\n                vec3 BlendOverlay(vec3 base, vec3 blend){\n                    return vec3(BlendOverlayf(base.r, blend.r), BlendOverlayf(base.g, blend.g), BlendOverlayf(base.b, blend.b));\n                }\n                float BlendVividLightf(float base, float blend){\n                    float BlendColorBurnf = (((2.0 * blend) == 0.0) ? (2.0 * blend) : max((1.0 - ((1.0 - base) / (2.0 * blend))), 0.0));\n                    float BlendColorDodgef =  (((2.0 * (blend - 0.5)) == 1.0) ? (2.0 * (blend - 0.5)) : min(base / (1.0 - (2.0 * (blend - 0.5))), 1.0));\n                    return ((blend < 0.5) ? BlendColorBurnf : BlendColorDodgef);\n                }\n                vec3 BlendVividLight(vec3 base, vec3 blend){\n                    return vec3(BlendVividLightf(base.r, blend.r), BlendVividLightf(base.g, blend.g), BlendVividLightf(base.b, blend.b));\n                }\n\n                float normpdf(in float x, in float sigma) {\n                    return 0.39894*exp(-0.5*x*x/(sigma*sigma))/sigma;\n                }\n\n                vec3 blurMap() {\n                    //declare stuff\n                    const int mSize = 11;\n                    const int kSize = (mSize-1)/2;\n                    float kernel[mSize];\n                    vec3 final_colour = vec3(0.0);\n                    \n                    //create the 1-D kernel\n                    float sigma = 7.0;\n                    float Z = 0.0;\n                    for (int j = 0; j <= kSize; ++j){\n                        kernel[kSize+j] = kernel[kSize-j] = normpdf(float(j), sigma);\n                    }\n                    \n                    //get the normalization factor (as the gaussian has been clamped)\n                    for (int j = 0; j < mSize; ++j){\n                        Z += kernel[j];\n                    }\n                    \n                    //read out the texels\n                    for (int i=-kSize; i <= kSize; ++i){\n                        for (int j=-kSize; j <= kSize; ++j){\n                            final_colour += kernel[kSize+j] * kernel[kSize+i] * texture2D(texture, (uv.xy + vec2(float(i),float(j))*px)).rgb;\n                        }\n                    }\n                    return vec3(final_colour/(Z*Z));\n                }\n    \n                void main() {\n\n                    vec4 base4 = texture2D(texture, uv.xy);\n                    \n                    vec3 blurMap = blurMap();\n                    vec3 base = base4.rgb;\n                    \n                    float intensity = (amount < 0.0) ? (amount / 2.0) : amount;\n                    float lum = Lum(base);\n                  \n                    vec3 col = vec3(lum);\n                    vec3 mask = vec3(1.0 - pow(lum, 1.8));\n                    // invert blurred texture\n                    vec3 layer = vec3(1.0 - Lum(blurMap));\n                    vec3 detail = clamp(BlendVividLight(col, layer), 0.0, 1.0);\n                    // we get negative detail by inverting the detail layer\n                    vec3 inverse = mix(1.0 - detail, detail, (intensity+1.0)/2.0);\n                  \n                    gl_FragColor = vec4(BlendOverlay(base, mix(vec3(0.5), inverse, mask)), base4.a);       \n                }";t=this.compileShader(e),this.compiledProgram.set("clarity",t)}this.ctx.useProgram(t.program),this.ctx.uniform2f(t.uniform.px,1/this.width,1/this.height),this.ctx.uniform1f(t.uniform.amount,2*e),this.draw(t)}smooth(e){let t=this.compiledProgram.get("smooth");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform vec2 px;\n                uniform float m[9];\n                uniform float amount;\n\n                void main(void) {\n                    vec4 c11 = texture2D(texture, uv - px);\n                    vec4 c12 = texture2D(texture, vec2(uv.x, uv.y - px.y));\n                    vec4 c13 = texture2D(texture, vec2(uv.x + px.x, uv.y - px.y));\n\n                    vec4 c21 = texture2D(texture, vec2(uv.x - px.x, uv.y) );\n                    vec4 c22 = texture2D(texture, uv);\n                    vec4 c23 = texture2D(texture, vec2(uv.x + px.x, uv.y) );\n\n                    vec4 c31 = texture2D(texture, vec2(uv.x - px.x, uv.y + px.y) );\n                    vec4 c32 = texture2D(texture, vec2(uv.x, uv.y + px.y) );\n                    vec4 c33 = texture2D(texture, uv + px );\n\n                    vec4 color = \n                        c11 * m[0] + c12 * m[1] + c13 * m[2] +\n                        c21 * m[3] + c22 * m[4] + c23 * m[5] +\n                        c31 * m[6] + c32 * m[7] + c33 * m[8];\n\n                    gl_FragColor = color * amount + (c22 * (1.0 - amount));\n                }";t=this.compileShader(e),this.compiledProgram.set("smooth",t)}let s=new Float32Array([1/16,2/16,1/16,2/16,.25,2/16,1/16,2/16,1/16]);this.ctx.useProgram(t.program),this.ctx.uniform1fv(t.uniform.m,s),this.ctx.uniform2f(t.uniform.px,1/this.width,1/this.height),this.ctx.uniform1f(t.uniform.amount,e),this.draw(t)}denoise(e){const t=Math.round(30*e[0]);let s=this.compiledProgram.get("denoise"+t);if(!s){let e="\n                precision mediump float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                \n                uniform float sigma;\n                uniform float threshold;\n                uniform vec2 resolution;\n\n                #define INV_SQRT_OF_2PI 0.39894228040143267793994605993439  // 1.0/SQRT_OF_2PI\n                #define INV_PI 0.31830988618379067153776752674503\n                #define RADIUS %radius%.0\n              \n                void main(void) {\n\n                       float invSigmaQx2 = .5 / (sigma * sigma);      // 1.0 / (sigma^2 * 2.0)\n                       float invSigmaQx2PI = INV_PI * invSigmaQx2;    // 1.0 / (sqrt(PI) * sigma)\n                       \n                       float invThresholdSqx2 = .5 / (threshold * threshold);     // 1.0 / (sigma^2 * 2.0)\n                       float invThresholdSqrt2PI = INV_SQRT_OF_2PI / threshold;   // 1.0 / (sqrt(2*PI) * sigma)\n                       \n                       vec4 center = texture2D(texture,uv); \n                       \n                       float zBuff = 0.0;\n                       vec4 aBuff = vec4(0.0);\n                       \n                       for(float x=-RADIUS; x <= RADIUS; x++) {\n                           float pt = sqrt(RADIUS*RADIUS-x*x);  // pt = yRadius: have circular trend\n                           for(float y=-RADIUS; y <= RADIUS; y++) {\n   \n                               if(y >= pt || y <= pt) {\n   \n                                   vec2 d = vec2(x,y)/resolution;\n                       \n                                   float blurFactor = exp( -dot(d , d) * invSigmaQx2 ) * invSigmaQx2;\n                                   \n                                   vec4 pxx =  texture2D(texture,uv+d);\n                       \n                                   vec4 dC = pxx-center;\n                                   float deltaFactor = exp( -dot(dC, dC) * invThresholdSqx2) * invThresholdSqrt2PI * blurFactor;\n                                                       \n                                   zBuff += deltaFactor;\n                                   aBuff += deltaFactor*pxx;\n                               }\n                           }\n                       }\n                       gl_FragColor = aBuff/zBuff;\n                } ";s=this.compileShader(e.replace(/%radius%/g,t.toString())),this.compiledProgram.set("denoise"+t,s)}this.ctx.useProgram(s.program),this.ctx.uniform1f(s.uniform.sigma,t/3),this.ctx.uniform1f(s.uniform.threshold,e[1]),this.ctx.uniform2f(s.uniform.resolution,this.width,this.height),this.draw(s)}colorMatrix(e){let t=new Float32Array(e);t[4]/=255,t[9]/=255,t[14]/=255,t[19]/=255;let s=1==t[18]&&0==t[3]&&0==t[8]&&0==t[13]&&0==t[15]&&0==t[16]&&0==t[17]&&0==t[19],i="colorMatrix"+(s?"0":"1"),a=this.compiledProgram.get(i);if(!a){let e=["precision highp float;","varying vec2 uv;","uniform sampler2D texture;","uniform float m[20];","void main(void) {","vec4 c = texture2D(texture, uv);","gl_FragColor.r = m[0] * c.r + m[1] * c.g + m[2] * c.b + m[3] * c.a + m[4];","gl_FragColor.g = m[5] * c.r + m[6] * c.g + m[7] * c.b + m[8] * c.a + m[9];","gl_FragColor.b = m[10] * c.r + m[11] * c.g + m[12] * c.b + m[13] * c.a + m[14];","gl_FragColor.a = m[15] * c.r + m[16] * c.g + m[17] * c.b + m[18] * c.a + m[19];","}"].join("\n"),t=["precision highp float;","varying vec2 uv;","uniform sampler2D texture;","uniform float m[20];","void main(void) {","vec4 c = texture2D(texture, uv);","gl_FragColor.r = m[0] * c.r + m[1] * c.g + m[2] * c.b + m[4];","gl_FragColor.g = m[5] * c.r + m[6] * c.g + m[7] * c.b + m[9];","gl_FragColor.b = m[10] * c.r + m[11] * c.g + m[12] * c.b + m[14];","gl_FragColor.a = c.a;","}"].join("\n"),n=s?t:e;a=this.compileShader(n),this.compiledProgram.set(i,a)}this.ctx.useProgram(a.program),this.ctx.uniform1fv(a.uniform.m,t),this.draw(a)}saturation(e){var t=2*Number(e)/3+1,s=-.5*(t-1);this.colorMatrix([t,s,s,0,0,s,t,s,0,0,s,s,t,0,0,0,0,0,1,0])}desaturate(){this.saturation(-1)}invert(){this.colorMatrix([-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0])}contrast(e){var t=Number(e)+1,s=-128*(t-1);this.colorMatrix([t,0,0,0,s,0,t,0,0,s,0,0,t,0,s,0,0,0,1,0])}hue(e){e=e/180*Math.PI;var t=Math.cos(e),s=Math.sin(e),i=.213,a=.715,n=.072;this.colorMatrix([i+.787*t+s*-i,a+t*-a+s*-a,n+t*-n+.928*s,0,0,i+t*-i+.143*s,a+t*(1-a)+.14*s,n+t*-n+-.283*s,0,0,i+t*-i+-.787*s,a+t*-a+s*a,n+.928*t+s*n,0,0,0,0,0,1,0])}colorize(e){const t=.3086,s=.6094,i=.082;var a,n,o,r=(e-=1)/60,h=Math.round(r),l=r-h,c=1*(1-1*l),d=1*(1-1*(1-l));switch(h){case 0:case 6:a=1,n=d,o=0;break;case 1:a=c,n=1,o=0;break;case 2:a=0,n=1,o=d;break;case 3:a=0,n=c,o=1;break;case 4:a=d,n=0,o=1;break;case 5:a=1,n=0,o=c}this.colorMatrix([a*t,a*s,a*i,0,0,n*t,n*s,n*i,0,0,o*t,o*s,o*i,0,0,0,0,0,1,0])}exposure(e){let t=this.compiledProgram.get("exposure");if(!t){let e=["#define GLSLIFY 1","precision highp float;","varying vec2 uv;","uniform sampler2D texture;","uniform float amount;","const float epsilon = 0.000001;","const float mx = 1.0 - epsilon;","const mat3 matRGBtoROMM = mat3(0.5293459296226501, 0.3300727903842926, 0.14058130979537964, 0.09837432950735092, 0.8734610080718994, 0.028164653107523918, 0.01688321679830551, 0.11767247319221497, 0.8654443025588989);","const mat3 matROMMtoRGB = mat3(2.0340757369995117, -0.727334201335907, -0.3067416846752167, -0.22881317138671875, 1.2317301034927368, -0.0029169507324695587, -0.008569774217903614, -0.1532866358757019, 1.1618564128875732);","float ramp(in float t){","t *= 2.0;","if (t >= 1.0) {","t -= 1.0;","t = log(0.5) / log(0.5*(1.0-t) + 0.9332*t);","}","return clamp(t, 0.001, 10.0);","}","vec3 rgb2hsv(in vec3 c) {","vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);","vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));","vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));","float d = q.x - min(q.w, q.y);","float e = 1.0e-10;","return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);","}","vec3 hsv2rgb(in vec3 c) {","vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);","vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);","return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);","}","vec3 setHue(in vec3 res, in vec3 base) {","vec3 hsv = rgb2hsv(base);","vec3 res_hsv = rgb2hsv(res);","return hsv2rgb(vec3(hsv.x, res_hsv.y, res_hsv.z));","}","void main() {","lowp vec4 col = texture2D(texture, uv.xy);","vec3 base = col.rgb * matRGBtoROMM;","float a = abs(amount) * col.a + epsilon;","float v = pow(2.0, a*2.0+1.0)-2.0;","float m = mx - exp(-v);","vec3 res = (amount > 0.0) ? (1.0 - exp(-v*base)) / m : log(1.0-base*m) / -v;","res = mix(base, res, min(a*100.0, 1.0));","res = setHue(res, base);","res = pow(res, vec3(ramp(1.0 - (0.0 * col.a + 1.0) / 2.0)));","res = res * matROMMtoRGB;","gl_FragColor = vec4(res, col.a);","}"].join("\n");t=this.compileShader(e),this.compiledProgram.set("exposure",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.amount,e),this.draw(t)}highlights(e){let t=this.compiledProgram.get("highlights");if(!t){let e=["#define GLSLIFY 1","precision highp float;","varying vec2 uv;","uniform sampler2D texture;","uniform float amount;","const float epsilon = 0.000001;","const float mx = 1.0 - epsilon;","const float PI = 3.1415926535897932384626433832795;","const mat3 matRGBtoROMM = mat3(0.5293459296226501, 0.3300727903842926, 0.14058130979537964, 0.09837432950735092, 0.8734610080718994, 0.028164653107523918, 0.01688321679830551, 0.11767247319221497, 0.8654443025588989);","const mat3 matROMMtoRGB = mat3(2.0340757369995117, -0.727334201335907, -0.3067416846752167, -0.22881317138671875, 1.2317301034927368, -0.0029169507324695587, -0.008569774217903614, -0.1532866358757019, 1.1618564128875732);","float luma_romm(in vec3 color){","return dot(color, vec3(0.242655, 0.755158, 0.002187));","}","float luma(in vec3 color){","return dot(color, vec3(0.298839, 0.586811, 0.11435));","}","vec3 rgb2hsv(in vec3 c) {","vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);","vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));","vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));","float d = q.x - min(q.w, q.y);","float e = 1.0e-10;","return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);","}","vec3 hsv2rgb(in vec3 c) {","vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);","vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);","return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);","}","vec3 setHue(in vec3 res, in vec3 base) {","vec3 hsv = rgb2hsv(base);","vec3 res_hsv = rgb2hsv(res);","return hsv2rgb(vec3(hsv.x, res_hsv.y, res_hsv.z));","}","float gaussian(in float x) {","return 1.0 - exp(-PI*2.0*x*x);","}","void main() {","lowp vec4 col = texture2D(texture, uv.xy);","lowp vec3 map = col.rgb;","vec3 base = col.rgb * matRGBtoROMM;","float base_lum = luma(col.rgb);","float map_lum = luma_romm(map * matRGBtoROMM);","float exposure = mix(amount, 0.0, 1.0 - map_lum) * col.a;","float a = abs(exposure) * col.a + epsilon;","float v = pow(2.0, a+1.0)-2.0;","float m = mx - exp(-v);","vec3 res = (exposure > 0.0) ? (1.0 - exp(-v*base)) / m : log(1.0-base*m) / -v;","res = mix(base, res, min(a*100.0, 1.0));","res = setHue(res, base);","res = res * matROMMtoRGB;","gl_FragColor = vec4(res, col.a);","}"].join("\n");t=this.compileShader(e),this.compiledProgram.set("highlights",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.amount,e),this.draw(t)}shadows(e){let t=this.compiledProgram.get("shadows");if(!t){let e=["#define GLSLIFY 1","precision highp float;","varying vec2 uv;","uniform sampler2D texture;","uniform float amount;","const float epsilon = 0.000001;","const float mx = 1.0 - epsilon;","const float PI = 3.1415926535897932384626433832795;","const mat3 matRGBtoROMM = mat3(0.5293459296226501, 0.3300727903842926, 0.14058130979537964, 0.09837432950735092, 0.8734610080718994, 0.028164653107523918, 0.01688321679830551, 0.11767247319221497, 0.8654443025588989);","const mat3 matROMMtoRGB = mat3(2.0340757369995117, -0.727334201335907, -0.3067416846752167, -0.22881317138671875, 1.2317301034927368, -0.0029169507324695587, -0.008569774217903614, -0.1532866358757019, 1.1618564128875732);","float luma_romm(in vec3 color){","return dot(color, vec3(0.242655, 0.755158, 0.002187));","}","float luma(in vec3 color){","return dot(color, vec3(0.298839, 0.586811, 0.11435));","}","vec3 rgb2hsv(in vec3 c) {","vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);","vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));","vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));","float d = q.x - min(q.w, q.y);","float e = 1.0e-10;","return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);","}","vec3 hsv2rgb(in vec3 c) {","vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);","vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);","return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);","}","vec3 setHue(in vec3 res, in vec3 base) {","vec3 hsv = rgb2hsv(base);","vec3 res_hsv = rgb2hsv(res);","return hsv2rgb(vec3(hsv.x, res_hsv.y, res_hsv.z));","}","float gaussian(in float x) {","return 1.0 - exp(-PI*2.0*x*x);","}","void main() {","lowp vec4 col = texture2D(texture, uv.xy);","lowp vec3 map = col.rgb;","vec3 base = col.rgb * matRGBtoROMM;","float base_lum = luma(col.rgb);","float map_lum = luma_romm(map * matRGBtoROMM);","float exposure = mix(0.0, amount, 1.0 - map_lum) * col.a;","float a = abs(exposure) * col.a + epsilon;","float v = pow(2.0, a+1.0)-2.0;","float m = mx - exp(-v);","vec3 res = (exposure > 0.0) ? (1.0 - exp(-v*base)) / m : log(1.0-base*m) / -v;","res = mix(base, res, min(a*100.0, 1.0));","res = setHue(res, base);","res = res * matROMMtoRGB;","gl_FragColor = vec4(res, col.a);","}"].join("\n");t=this.compileShader(e),this.compiledProgram.set("shadows",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.amount,e),this.draw(t)}dehaze(e){let t=this.compiledProgram.get("dehaze");if(!t){let e="\n\n                #define GLSLIFY 1;\n                precision highp float;\n                varying vec2 uv;\n\n                uniform sampler2D texture;\n                uniform float amount;  // -1.0 ~ 1.0\n\n                uniform vec2 size;\n\n                float hazeMap(vec4 base) {\n                    vec3 color = vec3(1.0, 1.0, 1.0);\n                    vec2 step = vec2(1.0 / size.xy);\n                    const int patchRadius = 1; // the half size for shift in 3 x 3 patch.\n                    for (int i = -patchRadius; i <= patchRadius; ++i) {\n                       for (int j = -patchRadius; j <= patchRadius; ++j) {\n                           vec2 uv = clamp(uv + (vec2(i, j) * step), 0.0, 1.0);\n                           color = min(color, base.rgb);\n                        }\n                    }\n                    return min(color.r, min(color.g, color.b));\n                }\n\n                void main() {\n                    \n                    lowp vec4 base = texture2D(texture, uv.xy);\n                    lowp float haze = hazeMap(base);\n\n                    float transmission = 1.0 - 0.95 * haze;\n                    const float A = 0.95; //0.95 intensity. We can consider to collect 0.1% brightest pixel from the dark channel image.\n                    const float t0 = 0.1; //0.1 in the paper, we can increase it for solving the color bleeding.\n                    float t = mix(1.0, max(t0, transmission), amount);\n                    vec3 J = (base.rgb - A) / t + A;\n                    gl_FragColor = vec4(J, base.a);\n                }";t=this.compileShader(e),this.compiledProgram.set("dehaze",t)}this.ctx.useProgram(t.program),this.ctx.uniform2f(t.uniform.size,this.width,this.height),this.ctx.uniform1f(t.uniform.amount,e),this.draw(t)}solarize(){this.paletteMap||(this.paletteMap=new ImageData(256,1));for(let e=0;e<256;++e){let t=255*(e/255>.5?2*(e/255-.5):2*(.5-e/255));t=t>255?255:t<0?0:t,this.paletteMap.data[4*e]=this.paletteMap.data[4*e+1]=this.paletteMap.data[4*e+2]=t}this.mapping(this.paletteMap)}monochrome(e){let t=this.compiledProgram.get("monochrome");if(!t){let e="\n            precision highp float;\n            varying vec2 uv;\n            \n            uniform sampler2D texture;\n\n            uniform float r;\n            uniform float g;\n            uniform float b;\n            \n            float luma(vec3 color) {\n                return dot(color, vec3(r, g, b));\n            }\n            void main() {\n                lowp vec4 base = texture2D(texture, uv.xy);\n                float avg = luma(base.rgb);\n\n                gl_FragColor = vec4(avg, avg, avg, base.a);\n            }";t=this.compileShader(e),this.compiledProgram.set("monochrome",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.r,e.r),this.ctx.uniform1f(t.uniform.g,e.g),this.ctx.uniform1f(t.uniform.b,e.b),this.draw(t)}curves(e){this.paletteMap||(this.paletteMap=new ImageData(256,1)),void 0!==e.preset&&(e=d.z.createCurveSet(e)),d.Z.fillPaletteMap(e,this.paletteMap),this.mapping(this.paletteMap)}levels(e){this.paletteMap||(this.paletteMap=new ImageData(256,1)),c.Z.fillPaletteMap(e,this.paletteMap),this.mapping(this.paletteMap)}multilevels(e){this.paletteMap||(this.paletteMap=new ImageData(256,1)),c.Z.fillRGBPaletteMap(e[0].isFlat()?void 0:e[0],e[1].isFlat()?void 0:e[1],e[2].isFlat()?void 0:e[2],this.paletteMap),this.mapping(this.paletteMap)}mapping(e){let t=this.compiledProgram.get("mapping");if(!t){let e="\n                #define GLSLIFY 1\n                precision highp float;\n                varying vec2 uv;\n\n                uniform sampler2D texture;\n                uniform sampler2D paletteMap;\n\n                void main() {\n                    lowp vec4 base = texture2D(texture, uv.xy);\n                    float r = texture2D(paletteMap, vec2(base.r, 0)).r;\n                    float g = texture2D(paletteMap, vec2(base.g, 0)).g;\n                    float b = texture2D(paletteMap, vec2(base.b, 0)).b;\n                    gl_FragColor = vec4(r, g, b, base.a);\n                }";t=this.compileShader(e),this.compiledProgram.set("mapping",t)}this.ctx.useProgram(t.program);let s=t.getTextureById("paletteMap");s.createTexture(this.ctx,e.width,e.height),s.uploadData(this.ctx,e),this.draw(t)}lookup(e){let t=this.compiledProgram.get("lookup");if(!t){let e="\n            precision highp float;\n            varying vec2 uv;\n\n            uniform sampler2D texture;\n            uniform sampler2D paletteMap;\n            \n            float luma(vec3 color) {\n                return dot(color, vec3(0.299, 0.587, 0.114));\n            }\n\n            void main() {\n                lowp vec4 base = texture2D(texture, uv.xy);\n                float avg = luma(base.rgb);\n                float r = texture2D(paletteMap, vec2(avg, 0)).r;\n                float g = texture2D(paletteMap, vec2(avg, 0)).g;\n                float b = texture2D(paletteMap, vec2(avg, 0)).b;\n                gl_FragColor = vec4(r, g, b, base.a);\n            }";t=this.compileShader(e),this.compiledProgram.set("lookup",t)}this.ctx.useProgram(t.program);let s=t.getTextureById("paletteMap");s.createTexture(this.ctx,e.width,e.height),s.uploadData(this.ctx,e),this.draw(t)}toning(e){this.paletteMap||(this.paletteMap=new ImageData(256,1)),l.Z.fillPaletteMap(e,this.paletteMap);let t=this.compiledProgram.get("toning");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n\n                uniform sampler2D texture;\n                uniform sampler2D paletteMap;\n\n                uniform float amount;\n                \n                float luma(vec3 color) {\n                    return dot(color, vec3(0.299, 0.587, 0.114));\n                }\n\n                void main() {\n                    lowp vec4 base = texture2D(texture, uv.xy);\n                    float avg = luma(base.rgb);\n                    float r = texture2D(paletteMap, vec2(avg, 0)).r;\n                    float g = texture2D(paletteMap, vec2(avg, 0)).g;\n                    float b = texture2D(paletteMap, vec2(avg, 0)).b;\n                    gl_FragColor = mix(base, vec4(r, g, b, base.a), amount);\n                }";t=this.compileShader(e),this.compiledProgram.set("toning",t)}this.ctx.useProgram(t.program);let s=t.getTextureById("paletteMap");s.createTexture(this.ctx,this.paletteMap.width,this.paletteMap.height),s.uploadData(this.ctx,this.paletteMap),this.ctx.uniform1f(t.uniform.amount,e.amount),this.draw(t)}fill(e){let t=this.compiledProgram.get("fill-"+e.blend);if(!t){let s="";switch(e.blend){case"soft-light":s="\n                        precision highp float;\n                        varying vec2 uv;\n                        uniform sampler2D texture;\n                        uniform float amount;\n                        uniform vec4 color;\n\n                        float blendSoftLight(float base, float blend) {\n                            return (blend<0.5)?(2.0*base*blend+base*base*(1.0-2.0*blend)):(sqrt(base)*(2.0*blend-1.0)+2.0*base*(1.0-blend));\n                        }\n                        vec3 blendSoftLight(vec3 base, vec3 blend) {\n                            return vec3(blendSoftLight(base.r,blend.r),blendSoftLight(base.g,blend.g),blendSoftLight(base.b,blend.b));\n                        }\n                        vec3 blendSoftLight(vec3 base, vec3 blend, float opacity) {\n                            return (blendSoftLight(base, blend) * opacity + base * (1.0 - opacity));\n                        }\n\n                        void main() {\n                            vec4 base = texture2D(texture, uv.xy);\n                            gl_FragColor = vec4(blendSoftLight(base.rgb, color.rgb, amount), base.a);\n                        }";break;case"hard-light":s="\n                        precision highp float;\n                        varying vec2 uv;\n                        uniform sampler2D texture;\n                        uniform float amount;\n                        uniform vec4 color;\n\n                        float blendOverlay(float base, float blend) {\n                            return base<0.5?(2.0*base*blend):(1.0-2.0*(1.0-base)*(1.0-blend));\n                        }\n                        vec3 blendOverlay(vec3 base, vec3 blend) {\n                            return vec3(blendOverlay(base.r,blend.r),blendOverlay(base.g,blend.g),blendOverlay(base.b,blend.b));\n                        }\n                        vec3 blendHardLight(vec3 base, vec3 blend) {\n                            return blendOverlay(blend,base);\n                        }\n                        vec3 blendHardLight(vec3 base, vec3 blend, float opacity) {\n                            return (blendHardLight(base, blend) * opacity + base * (1.0 - opacity));\n                        }\n\n                        void main() {\n                            vec4 base = texture2D(texture, uv.xy);\n                            gl_FragColor = vec4(blendHardLight(base.rgb, color.rgb, amount), base.a);\n                        }";break;case"vivid-light":s="\n                        precision highp float;\n                        varying vec2 uv;\n                        uniform sampler2D texture;\n                        uniform float amount;\n                        uniform vec4 color;\n\n                        float blendColorBurn(float base, float blend) {\n                            return (blend==0.0)?blend:max((1.0-((1.0-base)/blend)),0.0);\n                        }\n                        float blendColorDodge(float base, float blend) {\n                            return (blend==1.0)?blend:min(base/(1.0-blend),1.0);\n                        }\n                        float blendVividLight(float base, float blend) {\n                            return (blend<0.5)?blendColorBurn(base,(2.0*blend)):blendColorDodge(base,(2.0*(blend-0.5)));\n                        }\n                        vec3 blendVividLight(vec3 base, vec3 blend) {\n                            return vec3(blendVividLight(base.r,blend.r),blendVividLight(base.g,blend.g),blendVividLight(base.b,blend.b));\n                        }\n                        vec3 blendVividLight(vec3 base, vec3 blend, float opacity) {\n                            return (blendVividLight(base, blend) * opacity + base * (1.0 - opacity));\n                        }\n\n                        void main() {\n                            vec4 base = texture2D(texture, uv.xy);\n                            gl_FragColor = vec4(blendVividLight(base.rgb, color.rgb, amount), base.a);\n                        }";break;case"overlay":s="\n                        precision highp float;\n                        varying vec2 uv;\n                        uniform sampler2D texture;\n                        uniform float amount;\n                        uniform vec4 color;\n\n                        float blendOverlay(float base, float blend) {\n                            return base<0.5?(2.0*base*blend):(1.0-2.0*(1.0-base)*(1.0-blend));\n                        }\n                        vec3 blendOverlay(vec3 base, vec3 blend) {\n                            return vec3(blendOverlay(base.r,blend.r),blendOverlay(base.g,blend.g),blendOverlay(base.b,blend.b));\n                        }\n                        vec3 blendOverlay(vec3 base, vec3 blend, float opacity) {\n                            return (blendOverlay(base, blend) * opacity + base * (1.0 - opacity));\n                        }\n\n                        void main() {\n                            vec4 base = texture2D(texture, uv.xy);\n                            gl_FragColor = vec4(blendOverlay(base.rgb, color.rgb, amount), base.a);\n                        }";break;case"multiply":s="\n                        precision highp float;\n                        varying vec2 uv;\n                        uniform sampler2D texture;\n                        uniform float amount;\n                        uniform vec4 color;\n                        \n                        vec3 blendMultiply(vec3 base, vec3 blend) {\n                            return base*blend;\n                        }\n                        vec3 blendMultiply(vec3 base, vec3 blend, float opacity) {\n                            return (blendMultiply(base, blend) * opacity + base * (1.0 - opacity));\n                        }\n\n                        void main() {\n                            vec4 base = texture2D(texture, uv.xy);\n                            gl_FragColor = vec4(blendMultiply(base.rgb, color.rgb, amount), base.a);\n                        }";break;case"color-dodge":s="\n                        precision highp float;\n                        varying vec2 uv;\n                        uniform sampler2D texture;\n                        uniform float amount;\n                        uniform vec4 color;\n                        \n                        float blendColorDodge(float base, float blend) {\n                            return (blend==1.0)?blend:min(base/(1.0-blend),1.0);\n                        }\n                        vec3 blendColorDodge(vec3 base, vec3 blend) {\n                            return vec3(blendColorDodge(base.r,blend.r),blendColorDodge(base.g,blend.g),blendColorDodge(base.b,blend.b));\n                        }\n                        vec3 blendColorDodge(vec3 base, vec3 blend, float opacity) {\n                            return (blendColorDodge(base, blend) * opacity + base * (1.0 - opacity));\n                        }\n\n                        void main() {\n                            vec4 base = texture2D(texture, uv.xy);\n                            gl_FragColor = vec4(blendColorDodge(base.rgb, color.rgb, amount), base.a);\n                        }";break;case"color-burn":s="\n                        precision highp float;\n                        varying vec2 uv;\n                        uniform sampler2D texture;\n                        uniform float amount;\n                        uniform vec4 color;\n                        \n                        float blendColorBurn(float base, float blend) {\n                            return (blend==0.0)?blend:max((1.0-((1.0-base)/blend)),0.0);\n                        }\n                        vec3 blendColorBurn(vec3 base, vec3 blend) {\n                            return vec3(blendColorBurn(base.r,blend.r),blendColorBurn(base.g,blend.g),blendColorBurn(base.b,blend.b));\n                        }\n                        vec3 blendColorBurn(vec3 base, vec3 blend, float opacity) {\n                            return (blendColorBurn(base, blend) * opacity + base * (1.0 - opacity));\n                        }\n\n                        void main() {\n                            vec4 base = texture2D(texture, uv.xy);\n                            gl_FragColor = vec4(blendColorBurn(base.rgb, color.rgb, amount), base.a);\n                        }";break;case"screen":s="\n                        precision highp float;\n                        varying vec2 uv;\n                        uniform sampler2D texture;\n                        uniform float amount;\n                        uniform vec4 color;\n                        \n                        float blendScreen(float base, float blend) {\n                            return 1.0-((1.0-base)*(1.0-blend));\n                        }\n                        vec3 blendScreen(vec3 base, vec3 blend) {\n                            return vec3(blendScreen(base.r,blend.r),blendScreen(base.g,blend.g),blendScreen(base.b,blend.b));\n                        }\n                        vec3 blendScreen(vec3 base, vec3 blend, float opacity) {\n                            return (blendScreen(base, blend) * opacity + base * (1.0 - opacity));\n                        }\n\n                        void main() {\n                            vec4 base = texture2D(texture, uv.xy);\n                            gl_FragColor = vec4(blendScreen(base.rgb, color.rgb, amount), base.a);\n                        }";break;default:s="\n                        precision highp float;\n                        varying vec2 uv;\n                        uniform sampler2D texture;\n                        uniform float amount;\n                        uniform vec4 color;\n                        \n                        void main() {\n                            vec4 base = texture2D(texture, uv.xy);\n                            gl_FragColor = mix(base, color, amount);\n                        }"}t=this.compileShader(s),this.compiledProgram.set("fill-"+e.blend,t)}this.ctx.useProgram(t.program),this.ctx.uniform4f(t.uniform.color,e.color.r/255,e.color.g/255,e.color.b/255,1),this.ctx.uniform1f(t.uniform.amount,e.amount),this.draw(t)}glamour(e){let t=this.compiledProgram.get("glamour");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n                uniform vec2 px;\n\n                float normpdf(in float x, in float sigma) {\n                    return 0.39894*exp(-0.5*x*x/(sigma*sigma))/sigma;\n                }\n\n                vec3 blurMap() {\n                    //declare stuff\n                    const int mSize = 11;\n                    const int kSize = (mSize-1)/2;\n                    float kernel[mSize];\n                    vec3 final_colour = vec3(0.0);\n                    \n                    //create the 1-D kernel\n                    float sigma = 7.0;\n                    float Z = 0.0;\n                    for (int j = 0; j <= kSize; ++j){\n                        kernel[kSize+j] = kernel[kSize-j] = normpdf(float(j), sigma);\n                    }\n                    \n                    //get the normalization factor (as the gaussian has been clamped)\n                    for (int j = 0; j < mSize; ++j){\n                        Z += kernel[j];\n                    }\n                    \n                    //read out the texels\n                    for (int i=-kSize; i <= kSize; ++i){\n                        for (int j=-kSize; j <= kSize; ++j){\n                            final_colour += kernel[kSize+j] * kernel[kSize+i] * texture2D(texture, (uv.xy + vec2(float(i),float(j))*px)).rgb;\n                        }\n                    }\n                    return vec3(final_colour/(Z*Z));\n                }\n\n                float luma(vec3 color) {\n                    return dot(color, vec3(0.299, 0.587, 0.114));\n                }\n\n                void main() {\n                    \n                    vec4 base = texture2D(texture, uv);\n                    vec3 color = blurMap();\n                    \n                    color = vec3(luma(color));\n\n                    color = vec3(\n                        (base.r <= 0.5) ? (2.0 * base.r * color.r) : (1.0 - 2.0 * (1.0 - base.r) * (1.0 - color.r)),\n                        (base.g <= 0.5) ? (2.0 * base.g * color.g) : (1.0 - 2.0 * (1.0 - base.g) * (1.0 - color.g)),\n                        (base.b <= 0.5) ? (2.0 * base.b * color.b) : (1.0 - 2.0 * (1.0 - base.b) * (1.0 - color.b))\n                    );\n                \n                    gl_FragColor = mix(base, vec4(color, base.a), amount);\n                }";t=this.compileShader(e),this.compiledProgram.set("glamour",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.amount,e),this.ctx.uniform2f(t.uniform.px,1/this.width,1/this.height),this.draw(t)}kaleidoscope(e){let t=this.compiledProgram.get("kaleidoscope");if(!t){let e="\n                precision mediump float;\n                varying vec2 uv;\n                #define PI 3.14159265359\n\n                uniform sampler2D texture;\n                uniform vec2 resolution;\n\n                uniform float u_stretch;\n                uniform float u_position;\n                uniform float u_amount;\n\n                int modwhole(float a, float b) {\n                    float m = mod(a, b);\n\n                    return int (m+.5);\n                }\n\n                void main(void) {\n                    int numOfAxis = int(u_amount);\n                    float angleFrac = (2. * PI) / float ( 2 * numOfAxis);\n\n                    vec2 uvc = uv;\n                    uvc -= .5;\n\n                    // Convert to Polar\n                    float phi = abs(atan(uvc.x, uvc.y));\n                    float r = length(uvc);\n\n                    int count = int(phi / angleFrac);\n\n                    phi = mod(phi, angleFrac);\n                    if (modwhole (float(count), 2.) == 1) {\n                        phi = angleFrac - phi;\n                    }\n\n                    // from polar coordiantes\n                    float x = r * cos(phi);\n                    float y = r * sin(phi);\n\n                    float stretch = 1. + (1. - u_stretch);\n                    float position = u_position * PI * .5;\n\n                    uvc = vec2(x, y) * stretch + sin(position);\n\n                    if (uvc.x < 0.) uvc.x += 1.;\n                    if (uvc.x > 1.) uvc.x -= 1.;\n                \n                    if (uvc.y < 0.) uvc.y += 1.;\n                    if (uvc.y > 1.) uvc.y -= 1.;\n\n                    gl_FragColor = texture2D (texture, uvc);\n                }\n            ";t=this.compileShader(e),this.compiledProgram.set("kaleidoscope",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.u_amount,e.amount),this.ctx.uniform1f(t.uniform.u_stretch,e.stretch),this.ctx.uniform1f(t.uniform.u_position,e.position),this.ctx.uniform2f(t.uniform.resolution,this.width,this.height),this.draw(t)}polarcoordinates(e){let t=this.compiledProgram.get("polarcoordinates");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                #define PI 3.14159265359\n                #define PI_2 6.2831\n\n                uniform sampler2D texture;\n                uniform int flip;\n                uniform float overlap;\n                uniform float rotate;\n                uniform vec2 resolution;\n                uniform int symmetry;\n\n                mat2 rotate2d(float _angle){\n                    return mat2(cos(_angle),-sin(_angle),\n                                sin(_angle),cos(_angle));\n                }\n\n                vec2 squareImage(vec2 uv) {\n                    // Aspect Ratio\n                    float ar = resolution.x / resolution.y;\n\n                    // Square the image at the center if rectangular\n                    if (symmetry == 1) {\n                        if (resolution.x > resolution.y) {\n                            float leftEdge = (1.0-1.0/ar) * 0.5;\n                            float rightEdge = 1.0 - leftEdge;\n\n                            if (uv.x < leftEdge) {\n                                uv = vec2(0, uv.y); // Fill in the left edge\n                            } else if (uv.x > rightEdge) {\n                                uv = vec2(1, uv.y); // Fill in the right edge\n                            }\n                            else {\n                                uv.x -= leftEdge; // Square the image on X\n                                uv.x *= ar;\n                            }\n                        } else if (resolution.y > resolution.x) {\n                            float bottomEdge = (1.0-ar) * 0.5;\n                            float topEdge = 1.0 - bottomEdge;\n\n                            if (uv.y < bottomEdge) {\n                                uv = vec2(uv.x, 0); // Fill in the bottom edge\n                            } else if (uv.y > topEdge) {\n                                uv = vec2(uv.x, 1); // Fill in the top edge\n                            }\n                            else {\n                                uv.y -= bottomEdge; // Square the image on Y\n                                uv.y /= ar;\n                            }\n                        }\n                    }\n                    return uv;\n                }\n\n                void main(void) {           \n                    // Square the image\n                    vec2 uvc = squareImage(uv);\n\n                    // Bring uv coordinates to center 0.5\n                    uvc = uvc-0.5;\n\n                    // Rotate uv by angle\n                    uvc = rotate2d( rotate ) * uvc;\n\n                    // Cartesian to polar\n                    float r = length(uvc) * 2.0;\n                    float a = atan(uvc.x, uvc.y);\n\n                    // Move from -PI -> PI to 0 -> 1\n                    vec2 uvp = vec2(a / (PI_2 + overlap) + 0.5, r);\n\n                    // Flip the image by 180 degrees\n                    uvp = flip == 1 ? 1.0 - uvp : uvp;\n\n                    // Compute color\n                    gl_FragColor = texture2D(texture, uvp);\n                }\n            ";t=this.compileShader(e),this.compiledProgram.set("polarcoordinates",t)}this.ctx.useProgram(t.program),this.ctx.uniform1i(t.uniform.flip,e.flip?1:0),this.ctx.uniform1i(t.uniform.symmetry,e.symmetry?1:0),this.ctx.uniform1f(t.uniform.overlap,e.overlap),this.ctx.uniform1f(t.uniform.rotate,e.rotate),this.ctx.uniform2f(t.uniform.resolution,this.width,this.height),this.draw(t)}fisheye(e){let t=this.compiledProgram.get("fisheye");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                #define PI 3.14159265359\n\n                uniform sampler2D texture;\n                uniform vec2 center;\n                uniform float amount;\n                uniform float aperture;\n                uniform int edgeFill;\n                uniform vec2 resolution;\n\n                vec2 edgeFillReflect(vec2 uvc) {\n                    if (uvc.x < 0.) uvc.x = -uvc.x;\n                    if (uvc.y < 0.) uvc.y = -uvc.y;\n                    if (uvc.x > 1.) uvc.x = 2. - uvc.x;\n                    if (uvc.y > 1.) uvc.y = 2. - uvc.y;\n\n                    return uvc;\n                }\n\n                vec2 edgeFillRepeat(vec2 uvc) {\n                    if (uvc.x < 0.) uvc.x = 1. + uvc.x;\n                    if (uvc.y < 0.) uvc.y = 1. + uvc.y;\n                    if (uvc.x > 1.) uvc.x = uvc.x - 1.;\n                    if (uvc.y > 1.) uvc.y = uvc.y - 1.;\n\n                    return uvc;\n                }\n\n                int edgeFillNone(vec2 uvc) {\n                    if (uvc.x < 0. || uvc.y < 0. || uvc.x > 1. || uvc.y > 1.) {\n                        return 1;\n                    }\n                    return 0;\n                }\n\n                void main(void) {\n\n                    // Normalized device space i.e. range of [-1, 1]\n                    vec2 ndcPos = uv * 2. - center * 2.;\n\n                    // Aspect ratio of the viewport\n                    float aspect = resolution.x / resolution.y;\n\n                    // Relationship between the radius of the perimeter circle (r or half_dist) and\n                    // the angle (eye_angle): \n                    // Bisect the isosceles triangle\n                    float eye_angle = abs(aperture);\n                    float half_angle = eye_angle / 2.;\n                    float half_dist = tan(half_angle);\n\n                    // With the aspect ratio of the viewport (aspect)\n                    vec2 vp_scale = vec2(aspect, 1.);\n                    vec2 P = ndcPos * vp_scale;\n\n                    // Diameter or the length of the viewport\n                    float vp_dia = length(vp_scale);\n\n                    // Relative distance to the center of the viewport\n                    float rel_dist = length(P) / vp_dia;\n\n                    // Relative position of the point P in relation to the aspect ratio\n                    vec2 rel_P = normalize(P) / normalize(vp_scale);\n\n                    vec2 pos_prj = ndcPos;\n                    if (aperture > 0.) {\n                        // Projection from spherical surface to the place\n                        float beta = rel_dist * half_angle;\n                        pos_prj = rel_P * tan(beta) / half_angle * pow(.9, amount * 5.);\n                    } else if (aperture < 0.) {\n                        // Projection from the plane to the spherical surface\n                        float beta = atan(rel_dist * half_dist);\n                        pos_prj = rel_P * beta / half_angle * pow(.9, amount * 5.);\n                    }\n\n                    vec2 uv_prj = pos_prj * .5 + center;\n\n                    // Return transparent if no edge fill\n                    if (edgeFill == 0) {\n                        if (edgeFillNone(uv_prj) == 1) {\n                            discard;\n                        }\n                    }\n                    if (edgeFill == 1) {\n                        uv_prj = edgeFillReflect(uv_prj);\n                    } \n                    if (edgeFill == 2) {\n                        uv_prj = edgeFillRepeat(uv_prj);\n                    }\n\n                    gl_FragColor = texture2D(texture, uv_prj);;\n                }";t=this.compileShader(e),this.compiledProgram.set("fisheye",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.amount,e.amount),this.ctx.uniform1f(t.uniform.aperture,e.aperture),this.ctx.uniform2f(t.uniform.center,e.x,e.y),this.ctx.uniform1i(t.uniform.edgeFill,e.edgeFill),this.ctx.uniform2f(t.uniform.resolution,this.width,this.height),this.draw(t)}wave(e){let t=this.compiledProgram.get("wave");if(!t){let e="\n                precision mediump float;\n                uniform int type;\n                uniform float amplitude;\n                uniform float scale;\n                varying vec2 uv;\n                uniform int edgeApprox;\n                // uniform vec2 resolution;\n                uniform sampler2D texture;\n                uniform float rotate;\n                #define PI 3.14159265359\n\n                mat2 rotate2d(float _angle){\n                    return mat2(cos(_angle),-sin(_angle),\n                                sin(_angle),cos(_angle));\n                }\n\n                float cot(float angle) {\n                    return cos(angle) / sin(angle);\n                }\n\n                float sinewave(float rad) {\n                    return amplitude * sin(scale * 2. * PI * rad);\n                }\n\n                float trianglewave(float rad) {\n                    return amplitude * 2. / PI * asin(sin(scale * 2. * PI * rad));\n                }\n\n                float squarewave(float rad) {\n                    return amplitude * sign(sin(scale * 2. * PI * rad));\n                }\n\n                void main() {\n                    vec2 uvc = uv;\n\n                    uvc -= 0.5;\n                    uvc = rotate2d(-rotate) * uvc;\n\n                    if (type == 0) {\n                        // sine wave\n                        uvc.y = sinewave(uvc.x) + uvc.y;\n                    } else if (type == 1) {\n                        // triangular wave\n                        uvc.y = trianglewave(uvc.x) + uvc.y;\n                    } else if (type == 2) {\n                        // square wave\n                        uvc.y = squarewave(uvc.x) + uvc.y;\n                    } else {\n                        // sawtooth wave\n                        // uvc.y = amplitude * 2. / PI * atan(cot(scale * 2. * PI * uvc.x));\n                    }\n                    \n                    uvc = rotate2d(rotate) * uvc;\n                    uvc += 0.5;\n                    \n                    // Clamp\n                    // uvc = clamp(uvc, 0., 1.);\n\n                    if (edgeApprox == 2) {\n                        // Repeat acros the edges with the opposite side color\n                        if (uvc.x < 0.) uvc.x = 1. + uvc.x;\n                        if (uvc.y < 0.) uvc.y = 1. + uvc.y;\n                        if (uvc.x > 1.) uvc.x = uvc.x - 1.;\n                        if (uvc.y > 1.) uvc.y = uvc.y - 1.;\n                    } else if (edgeApprox == 1) {\n                        // Approximate (natural) around the edges with the reflection color\n                        if (uvc.x < 0.) uvc.x = -uvc.x;\n                        if (uvc.y < 0.) uvc.y = -uvc.y;\n                        if (uvc.x > 1.) uvc.x = 2. - uvc.x;\n                        if (uvc.y > 1.) uvc.y = 2. - uvc.y;    \n                    } else {\n                        // Don't approximate, render transparent\n                        if (uvc.x < 0. || uvc.x > 1. || \n                            uvc.y < 0. || uvc.y > 1.) {\n                            gl_FragColor = vec4 (0.0, 0.0, 0.0, 0.0);\n                            return;\n                        }    \n                    }\n\n                    gl_FragColor = texture2D(texture, uvc);\n                    return;\n                }\n            ";t=this.compileShader(e),this.compiledProgram.set("wave",t)}this.ctx.useProgram(t.program),this.ctx.uniform1i(t.uniform.type,e.type),this.ctx.uniform1f(t.uniform.amplitude,e.amplitude),this.ctx.uniform1f(t.uniform.scale,e.scale),this.ctx.uniform1f(t.uniform.rotate,e.rotate),this.ctx.uniform1i(t.uniform.edgeApprox,e.edgeApprox),this.draw(t)}reflect(e){let t=this.compiledProgram.get("reflect");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                #define PI 3.14159265359\n                #define PI_2 6.2831\n\n                uniform sampler2D texture;\n                uniform int type;\n                uniform vec2 resolution;\n                uniform vec2 center;\n\n                // constant integers for directions\n                const int RIGHT = 1, LEFT = -1, ZERO = 0;\n\n                const float ALMOST_ZERO = 0.00001;\n\n                mat2 rotate2d(float _angle){\n                    return mat2(cos(_angle),-sin(_angle),\n                                sin(_angle),cos(_angle));\n                }\n\n                vec2 squareImage(vec2 uv) {\n                    // return uv;\n\n                    float ar = resolution.x / resolution.y;\n\n                    if (resolution.x > resolution.y) {\n                        uv.y /= ar;\n                    }\n                    else {\n                        uv.x *= ar;\n                    }\n                    return uv;\n                }\n\n                vec2 squareImagereverse(vec2 uv) {\n                    float ar = resolution.x / resolution.y;\n\n                    if (resolution.x > resolution.y) {\n                        uv.y /= ar;\n                        uv.y += (1. - 1./ar) * 0.5;\n                    }\n                    else {\n                        uv.x *= ar;\n                        uv.x += (1. - ar) * 0.5;\n                    }\n                    return uv;\n                }\n\n                int direction(vec2 A, vec2 B, vec2 P) {\n                    // subtracting co-ordinates of point A from\n                    // B and P, to make A as origin\n                    B.x -= A.x;\n                    B.y -= A.y;\n                    P.x -= A.x;\n                    P.y -= A.y;\n                \n                    // Determining cross Product\n                    float cross_product = B.x * P.y - B.y * P.x;\n                \n                    // return RIGHT if cross product is positive\n                    if (cross_product > ALMOST_ZERO)\n                        return LEFT;\n                \n                    // return LEFT if cross product is negative\n                    if (cross_product < -ALMOST_ZERO)\n                        return RIGHT;\n                \n                    // return ZERO if cross product is zero.\n                    return ZERO;\n                }\n                \n                vec2 reflectmagic(vec2 uvc, int reflectfrom, mat2 transf, vec2 A, vec2 B, vec2 center) {\n\n                    vec2 cent = center - 0.5;\n                    uvc -= center;\n\n                    int dircent = direction(A, B, cent);\n                    int diruv = direction(A, B, uvc);\n\n                    uvc = dircent >= ZERO && diruv >= ZERO || dircent == LEFT && diruv == LEFT ? transf * uvc : uvc;\n\n                    uvc += center;\n\n                    uvc -= 0.5;\n\n                    if (reflectfrom == LEFT) {\n                        uvc = dircent >= ZERO ? uvc : transf * uvc;\n                    } else {\n                        uvc = dircent == LEFT ? uvc : transf * uvc;\n                    }\n\n                    uvc += 0.5;\n\n                    return uvc;\n                }\n\n                vec2 reflectx(vec2 uvc, int reflectfrom) {\n                    mat2 transf = mat2(-1., 0., 0., 1.);     \n\n                    vec2 A = vec2 (0., -1.);\n                    vec2 B = vec2 (0., 1.);\n\n                    return reflectmagic(uvc, reflectfrom, transf, A, B, center);\n                }\n\n                vec2 reflecty(vec2 uvc, int reflectfrom) {\n                    mat2 transf = mat2(1., 0., 0., -1.);    \n\n                    vec2 A = vec2 (-1., 0.);\n                    vec2 B = vec2 (1., 0.);\n\n                    return reflectmagic(uvc, reflectfrom, transf, A, B, center);\n                }\n\n                vec2 reflectxequalminusy(vec2 uvc, int reflectfrom) {\n                    mat2 transf = mat2(0., 1., 1., 0.);\n\n                    vec2 A = vec2 (-1., -1.);\n                    vec2 B = vec2 (1., 1.);\n\n                    return reflectmagic(uvc, reflectfrom, transf, A, B, vec2(center.x, 1.-center.x));\n                }\n\n                vec2 reflectxequaly(vec2 uvc, int reflectfrom) {\n                    mat2 transf = mat2(0., -1., -1., 0.);\n\n                    vec2 A = vec2 (-1., 1.);\n                    vec2 B = vec2 (1., -1.);\n\n                    return reflectmagic(uvc, reflectfrom, transf, A, B, vec2(center.x, center.x));\n                }\n\n                vec2 reflect(vec2 uvc) {\n                    //reflect-type-minus-x\n                    if (type == 1) {\n                        uvc = reflectx(uvc, LEFT);\n                    }\n\n                    //reflect-type-minus-y\n                    else if (type == 2) {\n                        uvc = reflecty(uvc, LEFT);\n                    }\n\n                    //reflect-type-plus-x\n                    if (type == 3) {\n                        uvc = reflectx(uvc, RIGHT);\n                    }\n\n                    //reflect-type-plus-y\n                    else if (type == 4) {\n                        uvc = reflecty(uvc, RIGHT);\n                    }\n\n                    //reflect-type-minus-x-minus-y\n                    else if (type == 5) {\n                        uvc = reflectx(uvc, LEFT);\n                        uvc = reflecty(uvc, LEFT);\n                    }\n\n                    //reflect-type-minus-x-plus-y\n                    else if (type == 6) {\n                        uvc = reflectx(uvc, LEFT);\n                        uvc = reflecty(uvc, RIGHT);\n                    }\n\n                    //reflect-type-plus-x-plus-y\n                    else if (type == 7) {\n                        uvc = reflectx(uvc, RIGHT);\n                        uvc = reflecty(uvc, RIGHT);\n                    }\n\n                    //reflect-type-plus-x-minus-y\n                    else if (type == 8) {\n                        uvc = reflectx(uvc, RIGHT);\n                        uvc = reflecty(uvc, LEFT);\n                    }\n\n                    //reflect-type-above-x-equalto-y\n                    else if (type == 9) {\n                        uvc = reflectxequalminusy(uvc, LEFT);\n                    }\n\n                    // reflect-type-below-x-equalto-minus-y\n                    else if (type == 10) {\n                        uvc = reflectxequaly(uvc, RIGHT);\n                    }\n\n                    // reflect-type-above-x-equalto-minus-y\n                    else if (type == 11) {\n                        uvc = reflectxequaly(uvc, LEFT);\n                    }\n\n                    // reflect-type-below-x-equalto-y\n                    else if (type == 12) {\n                        uvc = reflectxequalminusy(uvc, RIGHT);\n                    }\n\n                    return uvc;\n                }\n\n                void main(void) {\n                    vec2 uvc = reflect(uv);\n                    gl_FragColor = texture2D(texture, uvc);\n                }\n            ";t=this.compileShader(e),this.compiledProgram.set("reflect",t)}this.ctx.useProgram(t.program),this.ctx.uniform1i(t.uniform.type,e.type),this.ctx.uniform2f(t.uniform.center,e.x,e.y),this.ctx.uniform2f(t.uniform.resolution,this.width,this.height),this.draw(t)}bloom(e){let t=this.compiledProgram.get("bloom");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n                uniform vec2 px;\n                float thresh = .5;\n                \n                void main() {\n                    vec4 sum = vec4(0);\n                \n                    // mess of for loops due to gpu compiler/hardware limitations\n                    int j=-2;\n                    for( int i=-2; i<=2; i++) sum+=texture2D(texture,uv+vec2(i,j)*px);\n                    j=-1;\n                    for( int i=-2; i<=2; i++) sum+=texture2D(texture,uv+vec2(i,j)*px);\n                    j=0;\n                    for( int i=-2; i<=2; i++) sum+=texture2D(texture,uv+vec2(i,j)*px);\n                    j=1;\n                    for( int i=-2; i<=2; i++) sum+=texture2D(texture,uv+vec2(i,j)*px);\n                    j=2;\n                    for( int i=-2; i<=2; i++) sum+=texture2D(texture,uv+vec2(i,j)*px);\n                    sum/=25.0;\n                \n                    gl_FragColor= texture2D(texture, uv);\n                \n                    // use the blurred colour if it's bright enough\n                    if (length(sum) > thresh) {\n                        gl_FragColor += sum*amount;\n                    }\n                }";t=this.compileShader(e),this.compiledProgram.set("bloom",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.amount,e),this.ctx.uniform2f(t.uniform.px,1/this.width,1/this.height),this.draw(t)}posterize(e){let t=this.compiledProgram.get("posterize");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n\n                float areas = 256.0 / amount;\n                float values = 255.0 / (amount - 1.0);\n                \n                void main() {\n                    vec4 px = texture2D(texture, uv);\n\n                    px.r = floor(values * floor((px.r*255.0) / areas))/255.0;\n                    px.g = floor(values * floor((px.g*255.0) / areas))/255.0;\n                    px.b = floor(values * floor((px.b*255.0) / areas))/255.0;\n\n                    gl_FragColor = px;\n                }";t=this.compileShader(e),this.compiledProgram.set("posterize",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.amount,100*e+1),this.draw(t)}fringe(e){let t=this.compiledProgram.get("fringe");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform vec2 amount;\n\n                void main() {\n                    vec2 dir = uv - vec2( .5 );\n                    float d = .7 * length( dir );\n                    normalize( dir );\n                    vec2 value = d * dir * amount;\n                \n                    vec4 c1 = texture2D( texture, uv - value);\n                    vec4 c2 = texture2D( texture, uv );\n                    vec4 c3 = texture2D( texture, uv + value);\n                    \n                    gl_FragColor = vec4( c1.r, c2.g, c3.b, c1.a + c2.a + c3.b);\n                }";t=this.compileShader(e),this.compiledProgram.set("fringe",t)}this.ctx.useProgram(t.program),this.ctx.uniform2f(t.uniform.amount,e,e),this.draw(t)}rgbSplit(e){let t=0,s=0,i=0;const a=e.distance;switch(e.type){case"red-blue":t=a,i=-a;break;case"green-red":t=-a,s=a;break;case"blue-green":s=-a,i=a;break;case"red":t=a;break;case"green":s=a;break;case"blue":i=a}let n=this.compiledProgram.get("rgb-split");if(!n){let e="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n\n                uniform vec2 r;\n                uniform vec2 g;\n                uniform vec2 b;\n\n                void main() {\n                \n                    vec4 px = texture2D(texture, uv);\n\n                    vec4 c1 = texture2D( texture, uv - r);\n                    vec4 c2 = texture2D( texture, uv - g);\n                    vec4 c3 = texture2D( texture, uv - b);\n                    \n                    gl_FragColor = mix(px, vec4( c1.r, c2.g, c3.b, (c1.a + c2.a + c3.a)/3.0), amount);\n                }";n=this.compileShader(e),this.compiledProgram.set("rgb-split",n)}this.ctx.useProgram(n.program),this.ctx.uniform1f(n.uniform.amount,e.amount);var o=e.direction*Math.PI/180,r=Math.cos(o),h=Math.sin(o);this.ctx.uniform2f(n.uniform.r,r*t,h*t),this.ctx.uniform2f(n.uniform.g,r*s,h*s),this.ctx.uniform2f(n.uniform.b,r*i,h*i),this.draw(n)}interference(e){let t=this.compiledProgram.get("interference");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float seed;\n                uniform float amount;\n                uniform int direction;\n\n                float rand(vec2 co){\n                    return fract(sin(dot(co.xy, vec2(12.9898,78.233)*3.141)) * 43758.5453);\n                }\n\n                void main() {\n\n                    float rand1 = rand(vec2(seed,seed));\n                    float rand2 = rand(vec2(seed,rand1));\n                \n                    float rand1xy = rand(vec2(rand1*uv.x,rand2*uv.y));\n                    float rand2xy = rand(vec2(rand1*uv.y,rand2*uv.x));\n                  \n                    float rand1x = rand(vec2(rand1*uv.x,rand2));\n                    float rand2x = rand(vec2(rand1x,rand1x));     \n\n                    float rand1y = rand(vec2(rand1*uv.y,rand2));\n                    float rand2y = rand(vec2(rand1y,rand1y));                       \n                    \n                    if(direction == 0) {\n                        if(rand2y/100.0 > rand1y) {\n                            if(rand2xy < 0.3) gl_FragColor = vec4(rand1xy, rand1xy, rand1xy, 0.0);\n                            else gl_FragColor = texture2D(texture, uv);\n                        }\n                        else {\n                            gl_FragColor = texture2D(texture, vec2(uv.x + rand1y * amount, uv.y));\n                        }\n                    } else {\n                        if(rand2x/100.0 > rand1x) {\n                            if(rand2xy < 0.3) gl_FragColor = vec4(rand1xy, rand1xy, rand1xy, 0.0);\n                            else gl_FragColor = texture2D(texture, uv);\n                        }\n                        else {\n                            gl_FragColor = texture2D(texture, vec2(uv.x, uv.y + rand1x * amount));\n                        }\n                    }\n                }";t=this.compileShader(e),this.compiledProgram.set("interference",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.seed,e.seed),this.ctx.uniform1f(t.uniform.amount,e.amount/15),this.ctx.uniform1i(t.uniform.direction,e.direction?1:0),this.draw(t)}bleed(e){let t=this.compiledProgram.get("bleed");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float seed;\n                uniform float block;\n                uniform float amplitude;\n              \n                float rand(vec2 n) { \n                    return fract(sin(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);\n                }\n                float randomRange (in vec2 sd, in float min, in float max) {\n                    return min + rand(sd) * (max - min);\n                }\n                float insideRange(float v, float bottom, float top) {\n                   return step(bottom, v) - step(top, v);\n                }\n\n                float noise(vec2 uv, float blockiness){   \n                    vec2 lv = fract(uv);\n                    vec2 id = floor(uv);\n                    \n                    float n1 = rand(id);\n                    float n2 = rand(id+vec2(1,0));\n                    float n3 = rand(id+vec2(0,1));\n                    float n4 = rand(id+vec2(1,1));\n                    \n                    vec2 u = smoothstep(0.0, 1.0 + blockiness, lv);\n\n                    return mix(mix(n1, n2, u.x), mix(n3, n4, u.x), u.y);\n                }\n\n                float fbm(vec2 uv, int count, float blockiness, float complexity) {\n                    float val = 0.0;\n                    float amp = 0.5;\n                    \n                    for (int i = 0; i < 1000; i++) {\n                        if(i == count) break;\n                        \n                        val += amp * noise(uv, blockiness);\n                        amp *= 0.5;\n                        uv *= complexity;    \n                    }  \n                    return val;\n                }\n\n                const float shift = 2.0; //2\n\n                void main()\n                {\n                    vec4 px = texture2D(texture, uv);\n\n                    for (float i = 0.0; i < 20.0; i += 1.0) {\n\n                        float sliceY = rand(vec2(seed, 2035.0 + float(i)));\n                        float sliceX = rand(vec2(seed, 3234.0 + float(i)));\n\n                        float sliceH = rand(vec2(seed, 2035.0 - float(i))) * 0.1;\n                        float sliceW = rand(vec2(seed, 3234.0 + float(i))) * 1.5;\n\n                        if(insideRange(uv.y, sliceY, fract(sliceY+sliceH)) == 1.0 && insideRange(uv.x, sliceX, fract(sliceX+sliceW)) == 1.0){\n                           \n                            vec2 id = floor(uv * 5.0);\n        \n                            // Generate shift amplitude\n                            float shift = amplitude * fbm(uv, int(id * 6.), shift, block);\n                            //float shift = randomRange(vec2(seed, 5234.0 + float(i)), -amplitude, amplitude);\n        \n                            float r = texture2D(texture, vec2(uv.x + shift, uv.y)).r * (1. - shift) ;\n                            float g = texture2D(texture, vec2(uv.x - shift, uv.y)).g * (1. - shift) + rand(id) * shift;\n                            float b = texture2D(texture, vec2(uv.x - shift, uv.y)).b * (1. - shift);\n        \n                            px = mix(vec4(r, g, b, px.a), px, 0.5);\n                        }\n                        gl_FragColor = px;\n                    }\n                }";t=this.compileShader(e),this.compiledProgram.set("bleed",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.seed,e.seed),this.ctx.uniform1f(t.uniform.amplitude,e.amplitude),this.ctx.uniform1f(t.uniform.block,e.block),this.draw(t)}slice(e){let t=this.compiledProgram.get("slice");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float seed;\n                uniform float amount;\n                uniform float distance;\n                uniform int line;\n\n                //2D (returns 0 - 1)\n                float random2d(vec2 n) { \n                    return fract(sin(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);\n                }\n                float randomRange (in vec2 sd, in float min, in float max) {\n                    return min + random2d(sd) * (max - min);\n                }\n                \n                // return 1 if v inside 1d range\n                float insideRange(float v, float bottom, float top) {\n                   return step(bottom, v) - step(top, v);\n                }\n                  \n                void main() {\n                  \n                    vec4 px = texture2D(texture, uv);\n\n                    for (float i = 0.0; i < 100.0; i += 1.0) {\n\n                        if(i == amount) break;\n\n                        float sliceY = random2d(vec2(seed, 2035.0 + float(i)));\n                        float sliceX = random2d(vec2(seed, 5234.0 + float(i)));\n\n                        float sliceH = random2d(vec2(seed, 2035.0 - float(i))) * 0.1;\n                        float sliceW = random2d(vec2(seed, 5234.0 + float(i))) * 1.5;\n\n                        float hOffset = randomRange(vec2(seed, 2035.0 + float(i)), -distance*.5, distance*.5);\n                        float wOffset = randomRange(vec2(seed, 5234.0 + float(i)), -distance, distance);\n\n                        vec2 uvOff = uv;\n                        uvOff.x += wOffset;\n                        uvOff.y += hOffset;\n\n                        if(insideRange(uv.y, sliceY, fract(sliceY+sliceH)) == 1.0 && (line == 1 || insideRange(uv.x, sliceX, fract(sliceX+sliceW)) == 1.0)){\n                            px = texture2D(texture, uvOff);\n                        }\n                    }\n                    gl_FragColor = px;\n                }";t=this.compileShader(e),this.compiledProgram.set("slice",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.seed,e.seed),this.ctx.uniform1f(t.uniform.amount,e.amount),this.ctx.uniform1f(t.uniform.distance,e.distance/3),this.ctx.uniform1i(t.uniform.line,e.line?1:0),this.draw(t)}mimicHDR(e){let t=this.compiledProgram.get("mimicHDR");if(!t){const e="\n                precision highp float;\n\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform sampler2D blurMap;\n\n                uniform float amount;\n                uniform float contra;\n                \n                float blendSoftLight(float base, float blend) {\n                    return (blend<0.5)?(2.0*base*blend+base*base*(1.0-2.0*blend)):(sqrt(base)*(2.0*blend-1.0)+2.0*base*(1.0-blend));\n                }\n                vec4 blendSoftLight(vec4 base, vec4 blend) {\n                    return vec4(blendSoftLight(base.r,blend.r),blendSoftLight(base.g,blend.g),blendSoftLight(base.b,blend.b), base.a);\n                }\n\n                float blendOverlay(float base, float blend) {\n                    return base<0.5?(2.0*base*blend):(1.0-2.0*(1.0-base)*(1.0-blend));\n                }\n                vec4 blendOverlay(vec4 base, vec4 blend) {\n                    return vec4(blendOverlay(base.r,blend.r),blendOverlay(base.g,blend.g),blendOverlay(base.b,blend.b), base.a);\n                }\n               \n                void main() {\n                    vec4 px = texture2D(texture, uv);\n                    vec4 blur = texture2D(blurMap, uv);\n\n                    vec4 blend = blendOverlay(px, blur);\n                    blend = mix(blend, blendSoftLight(px, blend), contra);\n\n                    gl_FragColor = mix(px, blend, amount);\n                }";t=this.compileShader(e),this.compiledProgram.set("mimicHDR",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.amount,e.amount),this.ctx.uniform1f(t.uniform.contra,e.contra);let s=t.getTextureById("blurMap");s.createTexture(this.ctx,e.blurMap.width,e.blurMap.height),s.uploadData(this.ctx,e.blurMap),this.draw(t)}pixelate(e){let t=this.compiledProgram.get("pixelate");if(!t){const e="\n                precision highp float;\n                varying vec2 uv;\n                uniform vec2 resolution;\n                uniform sampler2D texture;\n                uniform float amount;\n\n                void main() {\n                    float d = 1.0 / amount;\n                    float ar = resolution.x / resolution.y;\n                    float u = floor( uv.x / d ) * d + d*0.5;\n                    d = ar / amount;\n                    float v = floor( uv.y / d ) * d + d*0.5;\n                    gl_FragColor = texture2D(texture, vec2( u, v ) );\n                }";t=this.compileShader(e),this.compiledProgram.set("pixelate",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.amount,4*(100-100*e)),this.ctx.uniform2f(t.uniform.resolution,this.width,this.height),this.draw(t)}scanlines(e){let t=this.compiledProgram.get("scanlines");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n                uniform float size;\n\n                uniform int colorize;\n                uniform int direction;\n\n                void main() {\n                    \n                    vec2 sl;\n                    vec4 scanlines;\n                    vec4 color = texture2D(texture, uv);\n\n                    if(direction == 0) {\n                        sl = vec2(sin(uv.y * size), cos(uv.y * size)) * amount;\n                    }\n                    else {\n                        sl = vec2(sin(uv.x * size), cos(uv.x * size)) * amount;\n                    }\n\n                    if(colorize == 1) {\n                        scanlines = vec4(sl.x, sl.y, sl.x, 1.0);\n                    } \n                    else {\n                        scanlines = vec4(sl.x, sl.x, sl.x, 1.0);\n                    }\n\n                    gl_FragColor = vec4(color.r + scanlines.r, color.g + scanlines.g, color.b + scanlines.b, color.a);\n                }";t=this.compileShader(e),this.compiledProgram.set("scanlines",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.size,e.direction?Math.round(this.height/e.size):Math.round(this.width/e.size)),this.ctx.uniform1f(t.uniform.amount,e.amount),this.ctx.uniform1i(t.uniform.colorize,e.colorize?1:0),this.ctx.uniform1i(t.uniform.direction,e.direction?1:0),this.draw(t)}mosaic(e){let t=this.compiledProgram.get("mosaic");if(!t){const e="\n                precision highp float;\n                varying vec2 uv;\n                \n                uniform sampler2D texture;\n                uniform vec2 num;\n                \n                void main()\n                {\n                    vec2 uv = uv;\n                    vec2 uv2 = floor(uv*num)/num;\n                    uv -= uv2;\n                    uv *= num;\n                    gl_FragColor = texture2D(texture, \n                                    uv2 + vec2(step(1.0-uv.y,uv.x)/(2.0*num.x),\n                                    step(uv.x,uv.y)/(2.0*num.y)));\n                }";t=this.compileShader(e),this.compiledProgram.set("mosaic",t)}let s=Math.round(100*(1-e)),i=Math.round(this.height/this.width*s);this.ctx.useProgram(t.program),this.ctx.uniform2f(t.uniform.num,s,i),this.draw(t)}bokeh(e){let t=this.compiledProgram.get("bokeh-"+e.type);if(!t){let s="";switch(e.type){case"circle":s="\n                        precision highp float;\n                        varying vec2 uv;\n                        uniform sampler2D texture;\n                        uniform float amount;\n                        uniform float size;\n                        uniform vec2 px;\n                        \n                        #define PI 3.1415926538\n                        #define KNL 100.0\n\n                        void main() {\n\n                            float spread = floor(size*30.0 + 0.5) + 1.0;\n                            float myx = spread*2.0;\n\n                            vec3 mcol = vec3(0.0);\n                            vec3 avg  = vec3(0.0);                          \n                            float rc = 0.0;\n\n                            for(float x = 0.0; x < KNL; x += 1.0)\n                            {\n                                if(x == myx) break;\n        \n                                for(float y = 0.0; y < KNL; y += 1.0)\n                                {\n                                    if(y == myx) break;\n        \n                                    float l = length(vec2(x-spread,y-spread));\n                                    if(l <= spread)\n                                    {\n                                        vec3 col = texture2D(texture, uv + px * vec2(x-spread,y-spread) * 2.0).rgb;\n                                        mcol = max(mcol, col);\n                                        avg += col;\n                                        rc += 1.0;\n                                    }\n                                }\n                            }\n                            gl_FragColor = vec4(mix(avg / rc, mcol, amount), 1.0);\n                        }";break;case"square":s="\n                        precision highp float;\n                        varying vec2 uv;\n                        uniform sampler2D texture;\n                        uniform float amount;\n                        uniform float size;\n                        uniform vec2 px;\n\n                        #define KNL 100.0\n\n                        void main() {\n\n                            float spread = floor(size*30.0 + 0.5) + 1.0;\n                            float myx = spread*2.0;\n\n                            vec3 mcol = vec3(0.0);\n                            vec3 avg = vec3(0.0);\n        \n                            for(float x = 0.0; x < KNL; x += 1.0)\n                            {\n                                if(x == myx) break;\n        \n                                for(float y = 0.0; y < KNL; y += 1.0)\n                                {\n                                    if(y == myx) break;\n        \n                                    vec3 col = texture2D(texture, uv + px * vec2(x-spread,y-spread) * 2.0).rgb;\n                                    mcol = max(mcol, col);\n                                    avg += col;\n                                }\n                            }\n                            gl_FragColor = vec4(mix(avg / (myx * myx), mcol, amount), 1.0);\n                        }";break;case"hexagon":s="\n                        precision highp float;\n                        varying vec2 uv;\n                        uniform sampler2D texture;\n                        uniform float amount;\n                        uniform float size;\n                        uniform vec2 px;\n                        \n                        #define PI 3.1415926538\n                        #define PI2 6.283185308\n                        #define KNL 100.0\n\n                        void main() {\n\n                            float spread = floor(size*30.0 + 0.5) + 1.0;\n                            float myx = spread*2.0;\n\n                            vec3 mcol = vec3(0.0);\n                            vec3 avg  = vec3(0.0);\n                            float rc = 0.0;\n        \n                            for(float x = 0.0; x < KNL; x += 1.0)\n                            {\n                                if(x == myx) break;\n        \n                                for(float y = 0.0; y < KNL; y += 1.0)\n                                {\n                                    if(y == myx) break;\n        \n                                    vec2 pt = vec2(x-spread, y-spread);\n        \n                                    float an = 0.33 + atan(pt.x, pt.y); //0.33 Angle\n                                    float ngon = cos(an - (PI2 * floor((PI + 6.0 * an) / PI2)) / 6.0) / cos(PI / 6.0); //6 corners\n                                    float ngonSdf = ngon * length(pt) - spread;\n                            \n                                    if(ngonSdf <= 0.0) {\n                                        vec3 col = texture2D(texture, uv + px * vec2(x-spread, y-spread) * 2.0).rgb;\n                                        mcol = max(mcol, col);\n                                        avg += col;\n                                        rc += 1.0;\n                                    }\n                                }\n                            }\n                            gl_FragColor = vec4(mix(avg / rc, mcol, amount), 1.0);\n                        }";break;case"cross":s="\n                        precision highp float;\n                        varying vec2 uv;\n                        uniform sampler2D texture;\n                        uniform float amount;\n                        uniform float size;\n                        uniform vec2 px;\n                        \n                        #define KNL 100.0\n\n                        void main() {\n\n                            float spread = floor(size*30.0 + 0.5) + 1.0;\n        \n                            vec3 mcol = vec3(0.0);\n                            vec3 avg  = vec3(0.0);\n                            float rc = 0.0;\n        \n                            float myx = spread*2.0;\n                            float low = spread*.7;\n                            float high = spread*1.3;\n        \n                            for(float x = 0.0; x < KNL; x += 1.0)\n                            {\n                                if(x == myx) break;\n        \n                                for(float y = 0.0; y < KNL; y += 1.0)\n                                {\n                                    if(y == myx) break;\n        \n                                    if((y > low && y < high) || (x > low && x < high))\n                                    {\n                                        vec3 col = texture2D(texture, uv + px * vec2(x-spread,y-spread) * 2.0).rgb;\n                                        mcol = max(mcol, col);\n                                        avg += col;\n                                        rc += 1.0;\n                                    }\n                                }\n                            }\n                            gl_FragColor = vec4(mix(avg / rc, mcol, amount), 1.0);\n                        }"}t=this.compileShader(s),this.compiledProgram.set("bokeh-"+e.type,t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.size,e.size),this.ctx.uniform1f(t.uniform.amount,e.amount),this.ctx.uniform2f(t.uniform.px,1/this.width,1/this.height),this.draw(t)}art(e){let t=this.compiledProgram.get("art");if(!t){let e=["precision highp float;","uniform sampler2D texture;","varying vec2 uv;","void main() {","vec4 color, tmp, add;","vec2 uv = uv + vec2( sin( uv.y * 100.0 ), sin( uv.x * 100.0 )) * 0.0005;","color = texture2D( texture, uv );","add = tmp = texture2D( texture, uv + vec2( 0.0015, 0.0015 ));","if( tmp.r < color.r ) color = tmp;","add += tmp = texture2D( texture, uv + vec2( -0.0015, 0.0015 ));","if( tmp.r < color.r ) color = tmp;","add += tmp = texture2D( texture, uv + vec2( -0.0015, -0.0015 ));","if( tmp.r < color.r ) color = tmp;","add += tmp = texture2D( texture, uv + vec2( 0.0015, -0.0015 ));","if( tmp.r < color.r ) color = tmp;","add += tmp = texture2D( texture, uv + vec2( 0.002, 0.0 ));","if( tmp.r < color.r ) color = tmp;","add += tmp = texture2D( texture, uv + vec2( -0.002, 0.0 ));","if( tmp.r < color.r ) color = tmp;","add += tmp = texture2D( texture, uv + vec2( 0, 0.002 ));","if( tmp.r < color.r ) color = tmp;","add += tmp = texture2D( texture, uv + vec2( 0, -0.002 ));","if( tmp.r < color.r ) color = tmp;","uv = (uv - vec2(0.5)) * vec2(0.7);","gl_FragColor = vec4(mix(color.rgb * color.rgb * vec3(1.8), color.ggg * color.ggg - vec3(0.4), vec3(dot(uv, uv))), 1.0);","}"].join("\n");t=this.compileShader(e),this.compiledProgram.set("art",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.screenWidth,this.canvas.width),this.ctx.uniform1f(t.uniform.screenHeight,this.canvas.height),this.ctx.uniform1f(t.uniform.sampleDistance,e),this.ctx.uniform1f(t.uniform.waveFactor,.01),this.draw(t)}melt(e){let t=this.compiledProgram.get("melt");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n                uniform vec2 center;\n              \n                float rand(vec2 co){\n                    return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n                }\n                vec3 mod289(vec3 x) {\n                    return x - floor(x * (1.0 / 289.0)) * 289.0;\n                }\n                  \n                vec2 mod289(vec2 x) {\n                    return x - floor(x * (1.0 / 289.0)) * 289.0;\n                }\n                  \n                vec3 permute(vec3 x) {\n                    return mod289(((x*34.0)+1.0)*x);\n                }\n                  \n                float snoise(vec2 v) {\n\n                    const vec4 C = vec4(0.211324865405187,  // (3.0-sqrt(3.0))/6.0\n                                        0.366025403784439,  // 0.5*(sqrt(3.0)-1.0)\n                                       -0.577350269189626,  // -1.0 + 2.0 * C.x\n                                        0.024390243902439); // 1.0 / 41.0\n                  // First corner\n                    vec2 i  = floor(v + dot(v, C.yy) );\n                    vec2 x0 = v -   i + dot(i, C.xx);\n                  \n                  // Other corners\n                    vec2 i1;\n                    i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);\n                    vec4 x12 = x0.xyxy + C.xxzz;\n                    x12.xy -= i1;\n                  \n                  // Permutations\n                    i = mod289(i); // Avoid truncation effects in permutation\n                    vec3 p = permute( permute( i.y + vec3(0.0, i1.y, 1.0 ))\n                          + i.x + vec3(0.0, i1.x, 1.0 ));\n                  \n                    vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy), dot(x12.zw,x12.zw)), 0.0);\n                    m = m*m ;\n                    m = m*m ;\n                                   \n                    vec3 x = 2.0 * fract(p * C.www) - 1.0;\n                    vec3 h = abs(x) - 0.5;\n                    vec3 ox = floor(x + 0.5);\n                    vec3 a0 = x - ox;\n                  \n                    m *= 1.79284291400159 - 0.85373472095314 * ( a0*a0 + h*h );\n                  \n                  // Compute final noise value at P\n                    vec3 g;\n                    g.x  = a0.x  * x0.x  + h.x  * x0.y;\n                    g.yz = a0.yz * x12.xz + h.yz * x12.yw;\n                    return 130.0 * dot(m, g);\n                }\n\n                void main() {\n                    vec4 px = texture2D(texture, uv);\n                    \n                    float opacity = 0.0;\n\n                    if(amount == 0.0 || amount == 1.0) {\n                        opacity = amount;\n                    } \n                    else {\n                        if(center.x == 0.5) {\n                            float dist = distance(center, uv)- amount*exp(snoise(vec2(uv.x, 0.0)));\n                            float r = amount - rand(vec2(uv.x, 0.1));\n                            opacity = dist <= r ? 1.0 : (amount*amount*amount);\n                        }\n                        else {\n                            float dist = distance(center, uv)- amount*exp(snoise(vec2(0.0, uv.y)));\n                            float r = amount - rand(vec2(0.1, uv.y));\n                            opacity = dist <= r ? 1.0 : (amount*amount*amount);\n                        }   \n                    }\n                    gl_FragColor = vec4(px.rgb, px.a * (1.0 - opacity));\n                }";t=this.compileShader(e),this.compiledProgram.set("melt",t)}this.ctx.useProgram(t.program);let s=new a.Z(.5,.5);switch(e.direction){case"down":s.y=0;break;case"right":s.x=1;break;case"left":s.x=0;break;case"up":s.y=1}this.ctx.uniform2f(t.uniform.center,s.x,s.y),this.ctx.uniform1f(t.uniform.amount,e.amount),this.draw(t)}gooey(e){let t=this.compiledProgram.get("gooey");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n              \n                // http://byteblacksmith.com/improvements-to-the-canonical-one-liner-glsl-rand-for-opengl-es-2-0/\n                float random(vec2 co) {\n\n                    highp float a = 12.9898; //seed;\n                    highp float b = 78.233;\n                    highp float c = 43758.5453;\n                    highp float dt= dot(co.xy ,vec2(a,b));\n                    highp float sn= mod(dt,3.14);\n                    return fract(sin(sn) * c);\n                }\n\n                // 2D Noise based on Morgan McGuire @morgan3d\n                // https://www.shadertoy.com/view/4dS3Wd\n                float noise (in vec2 st) {\n\n                    vec2 i = floor(st);\n                    vec2 f = fract(st);\n\n                    // Four corners in 2D of a tile\n                    float a = random(i);\n                    float b = random(i + vec2(1.0, 0.0));\n                    float c = random(i + vec2(0.0, 1.0));\n                    float d = random(i + vec2(1.0, 1.0));\n\n                    // Cubic Hermine Curve.  Same as SmoothStep()\n                    vec2 u = f*f*(3.0-2.0*f);\n\n                    // Mix 4 coorners porcentages\n                    return mix(a, b, u.x) +\n                            (c - a)* u.y * (1.0 - u.x) +\n                            (d - b) * u.x * u.y;\n                }\n\n                void main() {\n\n                    vec4 col = texture2D(texture, uv);\n                    float n = noise(uv * 10.0); //scale\n                    \n                    float p = mix(-0.01, 1.0 + 0.01, amount);\n                    float lower = p - 0.01;\n                    float higher = p + 0.01;\n                    \n                    float opacity = smoothstep(lower, higher, n);\n                    \n                    gl_FragColor = vec4(col.rgb, col.a * opacity);\n                }";t=this.compileShader(e),this.compiledProgram.set("gooey",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.amount,e),this.draw(t)}block(e){let t=this.compiledProgram.get("block");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n              \n                float rand (vec2 co) {\n                    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n                }\n\n                void main() {\n                    vec4 col = texture2D(texture, uv);\n                    \n                    float r = rand(floor(vec2(10.0) * uv)); //size\n                    float opacity = smoothstep(0.0, -0.5, r - (amount * (1.0 + 0.5)));\n                   \n                    gl_FragColor = vec4(col.rgb, col.a * (1.0 - opacity));\n                }";t=this.compileShader(e),this.compiledProgram.set("block",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.amount,e),this.draw(t)}curtain(e){let t=this.compiledProgram.get("curtain-"+e.direction);if(!t){let s="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n              \n                void main() {\n                    vec2 p = uv;\n                    vec4 col = vec4(0);\n                ";"horizontal"===e.direction?s+="                    \n                        if(2.0 * abs(p.x-0.5) - amount > 0.0) {\n                            p = p + (p.x > 0.5 ? -1.0 : 1.0) * vec2(0.5*amount, 0.0);\n                            col = texture2D(texture, p);\n                        }\n                    ":s+="\n                        if(2.0 * abs(p.y-0.5) - amount > 0.0) {\n                            p = p + (p.y > 0.5 ? -1.0 : 1.0) * vec2(0.0, 0.5*amount);\n                            col = texture2D(texture, p);\n                        }\n                    ",s+="\n                    gl_FragColor = col;\n                }",t=this.compileShader(s),this.compiledProgram.set("curtain-"+e.direction,t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.amount,e.amount),this.draw(t)}blinds(e){let t=this.compiledProgram.get("blinds-"+e.direction);if(!t){let s="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n              \n                void main() {\n                    vec4 col = texture2D(texture, uv);\n                ";switch(e.direction){case"up":s+="float opacity = step(smoothstep(-0.5, 0.0, (1.0 - uv.y) - amount * (1.0 + 0.5)), fract(12.0 * uv.y));";break;case"right":s+="float opacity = step(smoothstep(-0.5, 0.0, (1.0 - uv.x) - amount * (1.0 + 0.5)), fract(12.0 * uv.x));";break;case"left":s+="float opacity = step(smoothstep(-0.5, 0.0, uv.x - amount * (1.0 + 0.5)), fract(12.0 * uv.x));";break;case"down":s+="float opacity = step(smoothstep(-0.5, 0.0, uv.y - amount * (1.0 + 0.5)), fract(12.0 * uv.y));"}s+="\n                    gl_FragColor = vec4(col.rgb, col.a * (1.0 - opacity));\n                }",t=this.compileShader(s),this.compiledProgram.set("blinds-"+e.direction,t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.amount,e.amount),this.draw(t)}wipe(e){let t=this.compiledProgram.get("wipe-"+e.direction);if(!t){let s="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n              \n                void main() {\n                    vec4 col = texture2D(texture, uv);\n                ";switch(e.direction){case"down":s+="float opacity = 1.0 - step(uv.y, amount);";break;case"right":s+="float opacity = step(uv.x, 1.0 - amount);";break;case"left":s+="float opacity = 1.0 - step(uv.x, amount);";break;case"up":s+="float opacity = step(uv.y, 1.0 - amount);"}s+="\n                    gl_FragColor = vec4(col.rgb, col.a * opacity);\n                }",t=this.compileShader(s),this.compiledProgram.set("wipe-"+e.direction,t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.amount,e.amount),this.draw(t)}slot(e){let t=this.compiledProgram.get("slot");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n                uniform vec2 dir;\n\n                void main() {\n                   \n                    vec2 p = uv + amount * sign(dir);\n                    vec2 f = fract(p);\n                    float opacity = step(0.0, p.y) * step(p.y, 1.0) * step(0.0, p.x) * step(p.x, 1.0);\n                   \n                    vec4 col = texture2D(texture, p);\n                    gl_FragColor = vec4(col.rgb, col.a * opacity);\n                }";t=this.compileShader(e),this.compiledProgram.set("slot",t)}let s=new a.Z(0,0);switch(e.direction){case"down":s.y=-1;break;case"right":s.x=1;break;case"left":s.x=-1;break;case"up":s.y=1}this.ctx.useProgram(t.program),this.ctx.uniform2f(t.uniform.dir,s.x,s.y),this.ctx.uniform1f(t.uniform.amount,e.amount),this.draw(t)}split(e){let t=this.compiledProgram.get("split-"+e.direction);if(!t){let s="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n                uniform float sections;\n\n                void main() {\n                    vec2 p = uv;\n                ";"horizontal"===e.direction?s+="float num = floor(uv.y*sections);\n                    float odd = num - (2.0 * floor(num/2.0));\n                    p.x = uv.x + amount*sign(odd-0.5);\n             \n                    float opacity = (p.x * (1.0-step(odd,0.5)*2.0) - sign(odd) > 0.0) ? 0.0 : 1.0;\n                    ":s+="float num = floor(uv.x*sections);\n                    float odd = num - (2.0 * floor(num/2.0));\n                    p.y = uv.y + amount*sign(odd-0.5);\n             \n                    float opacity = (p.y * (1.0-step(odd,0.5)*2.0) - sign(odd) > 0.0) ? 0.0 : 1.0;\n                    ",s+="vec4 col = texture2D(texture, p);\n                    gl_FragColor = vec4(col.rgb, col.a * opacity);\n                }",t=this.compileShader(s),this.compiledProgram.set("split-"+e.direction,t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.sections,e.sections),this.ctx.uniform1f(t.uniform.amount,e.amount),this.draw(t)}circular(e){let t=this.compiledProgram.get("circular");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n\n                const float PI = 3.141592653589;\n\n                void main() {\n                    vec4 col = texture2D(texture, uv);\n\n                    vec2 p = uv*2.-1.;\n                    float opacity = smoothstep(0.0, 0.5, atan(p.y,p.x) - (amount-.5) * PI * 2.5);\n                   \n                    gl_FragColor = vec4(col.rgb, col.a * opacity);\n                }";t=this.compileShader(e),this.compiledProgram.set("circular",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.amount,e),this.draw(t)}ripple(e){let t=this.compiledProgram.get("ripple");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n\n                void main() {\n                    \n                    vec2 dir = uv - vec2(.5);\n                    float dist = length(dir);\n                    vec2 offset = dir * (sin(amount * dist * 100.0 - amount * 40.0) + 0.5) / 30.0; //100 amp 40 speed\n\n                    float opacity = smoothstep(0.2, 1.0, amount);\n\n                    vec4 px = texture2D(texture, uv + offset);                   \n                    gl_FragColor = vec4(px.rgb, px.a * (1.0 - opacity));\n                }";t=this.compileShader(e),this.compiledProgram.set("ripple",t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.amount,e),this.draw(t)}warp(e){let t=this.compiledProgram.get("warp-"+e.direction);if(!t){let s="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n\n                void main() {\n            ";switch(e.direction){case"up":s+="float x = smoothstep(0.0, 1.0, (amount*2.0 + uv.y-1.0)); vec4 col = texture2D(texture, (uv-0.5)*(1.0-x)+0.5);";break;case"right":s+="float x = smoothstep(0.0, 1.0, (amount*2.0 + uv.x-1.0)); vec4 col = texture2D(texture, (uv-0.5)*(1.0-x)+0.5);";break;case"left":s+="float x = smoothstep(0.0, 1.0, ((1.0-amount)*2.0 + uv.x-1.0)); vec4 col = texture2D(texture, (uv-0.5)*(x)+0.5);";break;case"down":s+="float x = smoothstep(0.0, 1.0, ((1.0-amount)*2.0 + uv.y-1.0)); vec4 col = texture2D(texture, (uv-0.5)*(x)+0.5);"}s+="\n                gl_FragColor = vec4(col.rgb, col.a * (1.0 - amount));\n            }",t=this.compileShader(s),this.compiledProgram.set("warp-"+e.direction,t)}this.ctx.useProgram(t.program),this.ctx.uniform1f(t.uniform.amount,e.amount),this.draw(t)}cloneChain(){const e=[];for(let t=0;t<this.chain.length;t++){const s=this.chain[t];let i;switch(s.type){case"curves":{const e=s.value,t=e.rgb.map((e=>e.clone())),a=e.red.map((e=>e.clone())),n=e.green.map((e=>e.clone())),o=e.blue.map((e=>e.clone()));i=new d.Z(e.scale,t,a,n,o);break}case"levels":{const e=s.value;i=new c.Z(e.minin,e.maxin,e.minout,e.maxout,e.midin,e.mid);break}case"toning":{const e=s.value;i=new l.Z(e.highlight.clone(),e.shadow.clone(),e.amount);break}case"fill":{const e=s.value;i=new h.Z(e.color.clone(),e.blend,e.amount);break}default:i=s.value}e.push(new p(s.type,i))}return e}}class p{constructor(e,t,s=!1){this.type=e,this.value=t,this.sidekick=s}}},2381:(e,t,s)=>{s.d(t,{Z:()=>i});class i{constructor(e){this.id=e,this.texture=null}createTexture(e,t,s){this.texture=e.createTexture(),this.width=t,this.height=s}uploadData(e,t,s=e.NEAREST){e.bindTexture(e.TEXTURE_2D,this.texture),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,4),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,s),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,s),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t)}setTexture(e){this.texture=e}destroy(e){e.deleteTexture(this.texture)}}},1721:(e,t,s)=>{s.d(t,{G:()=>d});var i=s(3655),a=s(9872),n=s(6817),o=s(3673),r=s(9679),h=s(8685),l=s(2282),c=s(1294);function d(e,t){var s,d,u;const p=new Date;switch(t.type){case"bitmapChange":{const e=t.layer,s=i.$E(t.layer.canvas,t.patchRect),a=e.rect?e.rect.clone():void 0;let o=i.dN(e.mask);if(t.patch){const s=t.rect,n=!!e.canvas;e.extendCanvas(s),n&&(t.patchRect.x+=a.x-e.rect.x,t.patchRect.y+=a.y-e.rect.y);if(e.canvas.getContext("2d").putImageData(t.patch,t.patchRect.x,t.patchRect.y),t.rect.width<e.rect.width||t.rect.height<e.rect.height){const a=i.vL(t.rect.width,t.rect.height);a.getContext("2d").drawImage(e.canvas,e.rect.x-t.rect.x,e.rect.y-t.rect.y),t.patchRect.x+=e.rect.x-s.x,t.patchRect.y+=e.rect.y-s.y,e.canvas=a,e.rect=s}}else e.canvas=null,e.rect=new n.Z(0,0,0,0);return t.mask&&(e.mask=t.mask),e.render(),t.layer.syncRequested=p,{type:"bitmapChange",layer:e,rect:a,kind:t.kind,patch:s,patchRect:t.patchRect.clone(),mask:o}}case"bitmapSwitch":{const e=t.layer,s=i.dN(t.layer.canvas),a=t.layer.trim?t.layer.trim.clone():t.layer.rect.clone();return e.switchCanvas(t.canvas,t.rect),e.render(),t.layer.syncRequested=p,{type:"bitmapSwitch",kind:t.kind,layer:e,rect:a,canvas:s}}case"selectionAndBitmapSwitch":{const a=t.layer,n=i.dN(t.layer.canvas),o=a.rect.clone();a.switchCanvas(t.canvas,t.rect),a.render(),t.layer.syncRequested=p;const r=i.dN(null===(s=null==e?void 0:e.selection)||void 0===s?void 0:s.mask);return t.selection?(e.addSelection(),e.selection.setMask(t.selection),{type:"selectionAndBitmapSwitch",kind:t.kind,selection:r,layer:a,rect:o,canvas:n}):(e.removeSelection(),{type:"selectionAndBitmapSwitch",kind:t.kind,selection:r,layer:a,rect:o,canvas:n})}case"addLayer":return e.layers.splice(t.order,0,t.layer),{type:"addLayer",kind:t.kind,layer:t.layer};case"deleteLayer":return e.deleteLayerById(t.layer.id),t;case"order":return e.changeLayerOrder(t.to,t.from),t;case"layerSettings":{const e=Object.assign({},t.layer.settings);return t.layer.settings=t.settings,t.layer.syncRequested=p,{type:"layerSettings",kind:t.kind,layer:t.layer,settings:e}}case"textChange":{const e=t.layer.text;return t.layer.setText(t.text),t.layer.syncRequested=p,{type:"textChange",layer:t.layer,text:e}}case"textSettings":{const e=t.layer.textSettings.clone();return t.layer.textSettings=t.settings,t.layer.textSettings.measureText(),t.layer.prepare(!0),t.layer.syncRequested=p,{type:"textSettings",kind:t.kind,layer:t.layer,settings:e}}case"background":{const s=e.color;return e.color=t.color,{type:"background",color:s}}case"mask":{let e;const s=t.layer.hasMask();if(!s&&t.patch&&t.layer.addMask(),t.patch){const a=t.layer.mask.getContext("2d");s&&(e=i.$E(t.layer.mask,new n.Z(t.rect.x,t.rect.y,t.patch.width,t.patch.height))),a.putImageData(t.patch,t.rect.x,t.rect.y)}else t.layer.removeMask();return t.layer.render(),t.layer.syncRequested=p,{type:"mask",layer:t.layer,rect:t.rect,patch:e}}case"maskInvert":return t.layer.invertMask(),t.layer.render(),t.layer.syncRequested=p,{type:"maskInvert",layer:t.layer};case"adjust":{const e=t.shaders.cloneChain();return t.shaders.chain=t.chain,{type:"adjust",layer:t.layer,kind:t.kind,chain:e,shaders:t.shaders}}case"glitch":{const e=t.shaders.cloneChain();return t.shaders.chain=t.chain,{type:"glitch",layer:t.layer,kind:t.kind,chain:e,shaders:t.shaders}}case"effect":{let e,s;return t.tool.marked&&(e=t.tool.marked.name,s=t.tool.marked.value),t.tool.shaders.reset(),t.name?(t.tool.shaders.addPreset(t.name,t.value),t.tool.marked=new r.Z(t.name,t.value)):t.tool.marked=void 0,{type:"effect",layer:t.layer,kind:t.kind,tool:t.tool,name:e,value:s}}case"arrange":switch(t.layer.syncRequested=p,t.action.type){case"rect":{const e=t.layer.rect.clone();return t.layer.rect=t.action.rect,t.layer instanceof h.Z&&(e.height=t.layer.textSettings.size,t.layer.rect.height!==t.layer.textSettings.size&&t.layer.setTextSize(t.layer.rect.height)),t.layer instanceof c.Z&&t.layer.trimOnResize(e),t.layer instanceof l.Z||t.layer.render(),{type:"arrange",layer:t.layer,kind:t.kind,action:{type:"rect",rect:e}}}case"trim":{const e=t.layer.trim.clone();return t.layer.trim=t.action.rect,t.layer.render(),{type:"arrange",layer:t.layer,kind:t.kind,action:{type:"trim",rect:e}}}case"trans":{const e=i.dN(t.layer.canvas),s=i.dN(t.layer.mask),a=t.layer.rect.clone();return t.layer.canvas=t.action.data,t.layer.mask=t.action.mask,t.layer.rect=t.action.rect,t.layer.render(),{type:"arrange",layer:t.layer,kind:t.kind,action:{type:"trans",data:e,mask:s,rect:a}}}}case"arrangeStack":{let e=t.stack,s=t.rects,i=new Array;for(let t=0;t<e.length;t++){let a=e[t],n=a.rect?a.rect.clone():void 0;a.rect=s[t],a instanceof h.Z&&(n.height=a.textSettings.size,a.rect.height!==a.textSettings.size&&a.setTextSize(a.rect.height)),a instanceof c.Z&&a.trimOnResize(n),i.push(n),a.syncRequested=p,a.render()}return{type:"arrangeStack",id:t.id,kind:"arrange",stack:t.stack,rects:i}}case"flipLayer":return t.layer.flip(t.vertical),t.layer.render(),t.layer.syncRequested=p,{type:"flipLayer",layer:t.layer,vertical:t.vertical};case"rotateLayer":return t.layer.rotate(!t.counterClock),t.layer.render(),t.layer.syncRequested=p,{type:"rotateLayer",layer:t.layer,counterClock:!t.counterClock};case"crop":{const s=new o.Z(-t.offset.x,-t.offset.y),r=new a.Z(e.width,e.height);let h;if(e.crop(new n.Z(t.offset.x,t.offset.y,t.size.width,t.size.height)),t.straighten){const s=e.layers[0];h=i.dN(s.canvas),s.syncRequested=p,s.canvas=t.straighten,s.rect=new n.Z(0,0,s.canvas.width,s.canvas.height),e.width=s.rect.width,e.height=s.rect.height}return e.layers.forEach((e=>e.syncRequested=p)),document.dispatchEvent(new CustomEvent("reset-viewport")),{type:"crop",offset:s,size:r,straighten:h}}case"pageSize":{const s=new a.Z(e.width,e.height);return e.size(t.size.width,t.size.height,!1,t.anchor),document.dispatchEvent(new CustomEvent("reset-viewport")),{type:"pageSize",anchor:t.anchor,size:s}}case"pageResize":{const s=new a.Z(e.width,e.height),i=e.layers.map((e=>e.clone(!0)));e.width=t.size.width,e.height=t.size.height;for(let a=0;a<t.layers.length;a++){const s=t.layers[a];s.syncRequested=p,e.replaceLayer(s),s.render()}return e.selection&&e.selection.resize(e.width,e.height),document.dispatchEvent(new CustomEvent("reset-viewport")),{type:"pageResize",size:s,layers:i}}case"flip":return e.flip(t.vertical),e.layers.forEach((e=>e.syncRequested=p)),{type:"flip",vertical:t.vertical};case"rotate":return e.rotate(t.counterClock),document.dispatchEvent(new CustomEvent("reset-viewport")),e.layers.forEach((e=>e.syncRequested=p)),{type:"rotate",counterClock:t.counterClock};case"selectionChange":{const s=e.selection?i.dN(e.selection.mask):void 0;return t.selection?(e.addSelection(),e.selection.setMask(t.selection),Object.assign(Object.assign({},t),{selection:s})):(e.removeSelection(),Object.assign(Object.assign({},t),{selection:s}))}case"merge":{const s=t.from.map((t=>e.layers.find((e=>e.id===t.id)))),i=t.from,a=e.layers.map((e=>e.id));return e.layers=e.layers.filter((e=>!i.includes(e))),e.layers.splice(t.order,0,t.target),e.getSelected()&&!e.hasLayer(e.getSelected())&&e.selectLayerById(t.target.id),{type:"merge",kind:t.kind,target:t.target,order:a,layers:s}}case"rasterize":{const s=e.layers.findIndex((e=>e.id===t.newId));if(s<0)return;const[i]=e.layers.splice(s,1,t.layer);return(null===(d=null==e?void 0:e.getSelected())||void 0===d?void 0:d.id)===i.id&&e.selectLayerById(t.layer.id),{type:"rasterize",layer:i,kind:t.kind,newId:t.layer.id}}case"convertSelectionToMask":{const s=e.selection.mask;return t.layer.addMask(),t.layer.mask.getContext("2d").drawImage(e.selection.mask,-t.layer.rect.x,-t.layer.rect.y),t.layer.render(),e.removeSelection(),t.layer.syncRequested=p,{type:"convertSelectionToMask",layer:t.layer,selection:s}}case"convertMaskToSelection":{const s=t.layer.mask;return t.layer.removeMask(),e.addSelection(),e.selection.setMask(t.selection),t.layer.syncRequested=p,{type:"convertMaskToSelection",layer:t.layer,mask:s}}case"applyMask":{const e=t.layer.canvas,s=t.layer.mask;let i=t.layer.rect.clone();return t.layer.render(),t.layer.canvas=t.layer.baked,t.layer.removeMask(),t.layer.shrinkWrap(),t.layer.syncRequested=p,{type:"applyMask",layer:t.layer,canvas:e,mask:s,rect:i}}case"frameContent":{let e,s;return t.layer.canvas&&(e=i.dN(t.layer.canvas),s=null===(u=t.layer.trim)||void 0===u?void 0:u.clone()),t.layer.canvas=t.canvas,t.layer.trim=t.trim,t.layer instanceof c.Z&&t.layer.render(),{type:"frameContent",kind:t.kind,layer:t.layer,canvas:e,trim:s}}case"frameSettings":{const e=t.layer.frameSettings.clone();return t.layer.frameSettings=t.settings,t.layer.prepare(),t.layer.syncRequested=p,{type:"frameSettings",kind:t.kind,layer:t.layer,settings:e}}case"shapeSettings":{const e=t.layer.shapeSettings.clone();return t.layer.shapeSettings=t.settings,t.layer.prepare(),t.layer.syncRequested=p,{type:"shapeSettings",kind:t.kind,layer:t.layer,settings:e}}case"pageAnimation":{const s=e.animation?e.animation:void 0;return e.animation=t.animation,{type:"pageAnimation",kind:t.kind,animation:s}}case"layerAnimation":{const e=t.layer.animation?t.layer.animation:void 0;return t.layer.animation=t.animation,t.layer.syncRequested=p,{type:"layerAnimation",kind:t.kind,layer:t.layer,animation:e}}default:throw new Error("No handler for this redo type")}}},5453:(e,t,s)=>{s.d(t,{N:()=>d});var i=s(6548),a=s(3655),n=s(1030),o=s(4820),r=s(3402),h=s(1721),l=s(2209),c=s(2282);class d{constructor(e,t,s=!1){this.fresco=e,this.undoStack=[],this.redoStack=[],this.ignore=!1,this.disable=()=>{this.ignore=!0},this.enable=()=>{this.ignore=!1},this.dispatchHistoryStatus=()=>{document.dispatchEvent(new CustomEvent("history-update",{detail:{atStart:this.undoStack.length<=1,atEnd:0===this.redoStack.length}}))},this.undo=()=>{if(!this.ignore&&0!==this.undoStack.length&&"open"!==this.undoStack[this.undoStack.length-1].data.type)try{this.ignore=!0;const{local:e,data:t}=this.undoStack.pop(),s=(0,r.c)(this.fresco,t);s&&(this.redoStack.push({local:e,data:s}),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-list-render")),document.dispatchEvent(new CustomEvent("layer-select")),(0,n.Z)("undo")),document.dispatchEvent(new CustomEvent("notification",{detail:(0,i.Z)("titleUndo")})),document.dispatchEvent(new CustomEvent("sync-document",{detail:this.fresco})),this.dispatchHistoryStatus()}finally{this.ignore=!1}},this.redo=()=>{if(!this.ignore&&0!==this.redoStack.length)try{this.ignore=!0;const{local:e,data:t}=this.redoStack.pop(),s=(0,h.G)(this.fresco,t);s&&(this.undoStack.push({local:e,data:s}),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-list-render")),document.dispatchEvent(new CustomEvent("layer-select")),(0,n.Z)("redo")),document.dispatchEvent(new CustomEvent("notification",{detail:(0,i.Z)("titleRedo")})),document.dispatchEvent(new CustomEvent("sync-document",{detail:this.fresco}))}finally{this.ignore=!1,this.dispatchHistoryStatus()}},this.getActiveTransaction=()=>this.transaction,this.redos=e=>this.redoStack.filter((t=>t.local===e)).reverse().map((e=>e.data)),this.undos=e=>this.undoStack.filter((t=>t.local===e)).map((e=>e.data)),this.add=e=>{if(this.ignore)return;if(!(0,l.g)(this.fresco,e))return;this.validateTransaction(e);const t=o.ZP.maxHistoryUndos;!this.transaction&&this.undoStack.length>=t&&(this.undoStack=this.undoStack.slice(this.undoStack.length+1-t)),this.undoStack.push({local:!!this.transaction,data:e}),this.redoStack=[],this.dispatchHistoryStatus(),"open"!==e.type&&document.dispatchEvent(new CustomEvent("sync-document",{detail:this.fresco})),(this.undoStack.length<1||!this.undoStack[this.undoStack.length-1].local)&&document.dispatchEvent(new CustomEvent("layer-list-render"))},this.validateTransaction=e=>{if("arrange"===e.type||"arrangeStack"===e.type||"adjust"===e.type||"glitch"===e.type||"effect"===e.type||"textSettings"===e.type||"frameSettings"===e.type||"shapeSettings"===e.type||"pageAnimation"===e.type||"layerAnimation"===e.type){const t="pageAnimation"===e.type?"page":"arrangeStack"===e.type?e.id:e.layer.id;this.transaction&&this.transaction.id!==e.type+"-"+t&&this.commitTransaction(!0),this.transaction||(this.transaction={id:e.type+"-"+t,type:e.type})}else this.commitTransaction(!0)},this.abortTransaction=()=>{this.transaction&&(this.transaction=void 0,this.redoStack=this.redoStack.filter((e=>!e.local)),this.undoStack=this.undoStack.filter((e=>!e.local)),this.dispatchHistoryStatus())},this.commitTransaction=(e=!1)=>{if(!this.transaction)return;const t=new Date;this.transaction=void 0;const s=this.undoStack.filter((e=>e.local));if(0===s.length)return;this.undoStack=this.undoStack.filter((e=>!e.local)),this.redoStack=[];let i=s[0].data,n=!1;switch(i.type){case"arrange":{const e=i.layer,s=i.action.rect;if(e instanceof c.Z&&e.wouldApplyTransform()){const t=a.dN(e.canvas),i=a.dN(e.mask);e.applyTransform(o.ZP.smoothScaling),this.undoStack.push({local:!1,data:{type:"arrange",kind:"transform",layer:e,action:{type:"trans",data:t,mask:i,rect:s}}})}else this.undoStack.push({local:!1,data:{type:"arrange",kind:"arrange",layer:e,action:{type:"rect",rect:s}}});e.syncRequested=t,n=!0;break}case"arrangeStack":{let e=i.stack,s=i.rects,r=Array(),h=Array();for(let i=0;i<e.length;i++){let n=e[i],l=s[i];if(n instanceof c.Z&&n.wouldApplyTransform()){const e=a.dN(n.canvas),t=a.dN(n.mask);n.applyTransform(o.ZP.smoothScaling),this.undoStack.push({local:!1,data:{type:"arrange",kind:"transform",layer:n,action:{type:"trans",data:e,mask:t,rect:l}}})}else r.push(n),h.push(l);n.syncRequested=t}r.length>1?this.undoStack.push({local:!1,data:{type:"arrangeStack",id:i.id,kind:"arrange",stack:r,rects:h}}):1===r.length&&this.undoStack.push({local:!1,data:{type:"arrange",kind:"arrange",layer:r[0],action:{type:"rect",rect:h[0]}}}),n=!0;break}case"glitch":case"effect":case"adjust":break;case"textSettings":{const e=i.layer,s=i.settings;this.undoStack.push({local:!1,data:{type:"textSettings",kind:"settings",layer:e,settings:s}}),e.syncRequested=t,n=!0;break}case"frameSettings":{const e=i.layer,s=i.settings;this.undoStack.push({local:!1,data:{type:"frameSettings",kind:"settings",layer:e,settings:s}}),e.syncRequested=t,n=!0;break}case"shapeSettings":{const e=i.layer,s=i.settings;this.undoStack.push({local:!1,data:{type:"shapeSettings",kind:"settings",layer:e,settings:s}}),e.syncRequested=t,n=!0;break}case"pageAnimation":{const e=i.animation;this.undoStack.push({local:!1,data:{type:"pageAnimation",kind:"",animation:e}}),n=!0;break}case"layerAnimation":{const e=i.layer,s=i.animation;this.undoStack.push({local:!1,data:{type:"layerAnimation",kind:"",layer:e,animation:s}}),e.syncRequested=t,n=!0;break}}n&&!e&&(document.dispatchEvent(new CustomEvent("sync-document",{detail:this.fresco})),document.dispatchEvent(new CustomEvent("layer-list-render"))),this.dispatchHistoryStatus()},s?this.ignore=!0:(this.add({type:"open",kind:t}),this.dispatchHistoryStatus())}jump(e){if(!this.ignore&&0!==e)try{if(this.ignore=!0,document.dispatchEvent(new CustomEvent("render-enabled",{detail:!1})),e<0){const t=Math.min(this.undoStack.length,Math.abs(e));for(let e=0;e<t;e++){const{local:e,data:t}=this.undoStack.pop(),s=(0,r.c)(this.fresco,t);s&&this.redoStack.push({local:e,data:s})}t>0&&((0,n.Z)("undo"),document.dispatchEvent(new CustomEvent("notification",{detail:(0,i.Z)("titleUndo")})))}else{const t=Math.min(this.redoStack.length,e);for(let e=0;e<t;e++){const{local:e,data:t}=this.redoStack.pop(),s=(0,h.G)(this.fresco,t);s&&this.undoStack.push({local:e,data:s})}t>0&&((0,n.Z)("redo"),document.dispatchEvent(new CustomEvent("notification",{detail:(0,i.Z)("titleRedo")})))}document.dispatchEvent(new CustomEvent("render-enabled",{detail:!0})),document.dispatchEvent(new CustomEvent("layer-list-render")),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("sync-document",{detail:this.fresco}))}finally{this.ignore=!1,document.dispatchEvent(new CustomEvent("render-enabled",{detail:!0})),this.dispatchHistoryStatus()}}}},3402:(e,t,s)=>{s.d(t,{c:()=>d});var i=s(3655),a=s(9872),n=s(6817),o=s(3673),r=s(9679),h=s(8685),l=s(2282),c=s(1294);function d(e,t){var s,d,u,p;const g=new Date;switch(t.type){case"bitmapChange":{if(!e.hasLayer(t.layer))return;const s=t.layer,a=s.rect?s.rect.clone():void 0;let o,r=i.dN(s.mask);if(s.canvas){o=s.canvas.getContext("2d").getImageData(t.patchRect.x,t.patchRect.y,t.patchRect.width,t.patchRect.height)}if(t.patch){const e=t.rect,n=!!s.canvas;s.extendCanvas(e);const o=s.canvas.getContext("2d");if(n&&(t.patchRect.x+=a.x-s.rect.x,t.patchRect.y+=a.y-s.rect.y),o.putImageData(t.patch,t.patchRect.x,t.patchRect.y),t.rect.width<s.rect.width||t.rect.height<s.rect.height){const a=i.vL(t.rect.width,t.rect.height);a.getContext("2d").drawImage(s.canvas,s.rect.x-t.rect.x,s.rect.y-t.rect.y),t.patchRect.x+=s.rect.x-e.x,t.patchRect.y+=s.rect.y-e.y,s.canvas=a,s.rect=e}}else s.canvas=null,s.rect=new n.Z(0,0,0,0);return t.mask&&(s.mask=t.mask),s.render(),t.layer.syncRequested=g,{type:"bitmapChange",kind:t.kind,layer:s,rect:a,patch:o,patchRect:t.patchRect.clone(),mask:r}}case"bitmapSwitch":{const e=i.dN(t.layer.canvas),s=t.layer.trim?t.layer.trim.clone():t.layer.rect.clone();return t.layer.switchCanvas(t.canvas,t.rect),t.layer.render(),t.layer.syncRequested=g,{type:"bitmapSwitch",kind:t.kind,layer:t.layer,rect:s,canvas:e}}case"selectionAndBitmapSwitch":{const a=i.dN(t.layer.canvas),n=t.layer.rect.clone();t.layer.switchCanvas(t.canvas,t.rect),t.layer.render(),t.layer.syncRequested=g;const o=i.dN(null===(s=null==e?void 0:e.selection)||void 0===s?void 0:s.mask);return e.addSelection(),e.selection.setMask(t.selection),{type:"selectionAndBitmapSwitch",kind:t.kind,selection:o,layer:t.layer,rect:n,canvas:a}}case"addLayer":{const s=e.layerNr(t.layer.id),i=e.deleteLayerById(t.layer.id);return{type:"addLayer",kind:t.kind,layer:i,order:s}}case"deleteLayer":return e.layers.splice(t.index,0,t.layer),t;case"order":return e.changeLayerOrder(t.to,t.from),t;case"layerSettings":{const e=Object.assign({},t.layer.settings);return t.layer.settings=t.settings,t.layer.syncRequested=g,{type:"layerSettings",kind:t.kind,layer:t.layer,settings:e}}case"textChange":{const e=t.layer.text;return t.layer.setText(t.text),t.layer.syncRequested=g,{type:"textChange",layer:t.layer,text:e}}case"textSettings":{const e=t.layer.textSettings.clone();return t.layer.textSettings=t.settings,t.layer.textSettings.measureText(),t.layer.prepare(!0),t.layer.syncRequested=g,{type:"textSettings",kind:t.kind,layer:t.layer,settings:e}}case"background":{const s=e.color;return e.color=t.color,{type:"background",color:s}}case"mask":{const e=t.layer;let s;const i=e.hasMask();if(!i&&t.patch&&t.layer.addMask(),t.patch){const a=t.patch,n=e.mask.getContext("2d");i&&(s=n.getImageData(t.rect.x,t.rect.y,t.rect.width,t.rect.height)),n.putImageData(a,t.rect.x,t.rect.y)}else{if(i){s=e.mask.getContext("2d").getImageData(0,0,e.mask.width,e.mask.height)}t.layer.removeMask()}return e.render(),t.layer.syncRequested=g,{type:"mask",layer:e,rect:t.patch&&t.rect?t.rect:new n.Z(0,0,e.canvas.width,e.canvas.height),patch:s}}case"maskInvert":return t.layer.invertMask(),t.layer.render(),t.layer.syncRequested=g,{type:"maskInvert",layer:t.layer};case"adjust":{const e=t.shaders.cloneChain();return t.shaders.chain=t.chain,{type:"adjust",layer:t.layer,kind:t.kind,chain:e,shaders:t.shaders}}case"glitch":{const e=t.shaders.cloneChain();return t.shaders.chain=t.chain,{type:"glitch",layer:t.layer,kind:t.kind,chain:e,shaders:t.shaders}}case"effect":{let e,s;return t.tool.marked&&(e=t.tool.marked.name,s=t.tool.marked.value),t.tool.shaders.reset(),t.name?(t.tool.shaders.addPreset(t.name,t.value),t.tool.marked=new r.Z(t.name,t.value)):t.tool.marked=void 0,{type:"effect",layer:t.layer,kind:t.kind,tool:t.tool,name:e,value:s}}case"arrange":switch(t.layer.syncRequested=g,t.action.type){case"rect":{const e=t.layer.rect.clone();return t.layer.rect=t.action.rect,t.layer instanceof h.Z&&(e.height=t.layer.textSettings.size,t.layer.rect.height!==t.layer.textSettings.size&&t.layer.setTextSize(t.layer.rect.height)),t.layer instanceof c.Z&&t.layer.trimOnResize(e),t.layer instanceof l.Z||t.layer.render(),{type:"arrange",kind:t.kind,action:{type:"rect",rect:e},layer:t.layer}}case"trim":{const e=t.layer.trim.clone();return t.layer.trim=t.action.rect,t.layer.render(),{type:"arrange",kind:t.kind,action:{type:"trim",rect:e},layer:t.layer}}case"trans":{const e=i.dN(t.layer.canvas),s=i.dN(t.layer.mask),a=t.layer.rect.clone();return t.layer.canvas=t.action.data,t.layer.mask=t.action.mask,t.layer.rect=t.action.rect,t.layer.render(),{type:"arrange",layer:t.layer,kind:t.kind,action:{type:"trans",data:e,mask:s,rect:a}}}}case"arrangeStack":{let e=t.stack,s=t.rects,i=new Array;for(let t=0;t<e.length;t++){let a=e[t],n=a.rect?a.rect.clone():void 0;a.rect=s[t],a instanceof h.Z&&(n.height=a.textSettings.size,a.rect.height!==a.textSettings.size&&a.setTextSize(a.rect.height)),a instanceof c.Z&&a.trimOnResize(n),i.push(n),a.syncRequested=g,a.render()}return{type:"arrangeStack",id:t.id,kind:"arrange",stack:t.stack,rects:i}}case"flipLayer":return t.layer.flip(t.vertical),t.layer.render(),t.layer.syncRequested=g,{type:"flipLayer",layer:t.layer,vertical:t.vertical};case"rotateLayer":return t.layer.rotate(!t.counterClock),t.layer.render(),t.layer.syncRequested=g,{type:"rotateLayer",layer:t.layer,counterClock:!t.counterClock};case"crop":{const s=new o.Z(-t.offset.x,-t.offset.y),r=new a.Z(e.width,e.height);let h;if(e.crop(new n.Z(t.offset.x,t.offset.y,t.size.width,t.size.height)),t.straighten){const s=e.layers[0];h=i.dN(s.canvas),s.syncRequested=g,s.canvas=t.straighten,s.rect=new n.Z(0,0,s.canvas.width,s.canvas.height),e.width=s.rect.width,e.height=s.rect.height}return e.layers.forEach((e=>e.syncRequested=g)),document.dispatchEvent(new CustomEvent("reset-viewport")),{type:"crop",offset:s,size:r,straighten:h}}case"pageSize":{const s=new a.Z(e.width,e.height);return e.size(t.size.width,t.size.height,!1,t.anchor),document.dispatchEvent(new CustomEvent("reset-viewport")),{type:"pageSize",anchor:t.anchor,size:s}}case"pageResize":{const s=new a.Z(e.width,e.height),i=e.layers.map((e=>e.clone(!0)));e.width=t.size.width,e.height=t.size.height;for(let a=0;a<t.layers.length;a++){const s=t.layers[a];s.syncRequested=g,e.replaceLayer(s),s.render()}return e.selection&&e.selection.resize(e.width,e.height),document.dispatchEvent(new CustomEvent("reset-viewport")),{type:"pageResize",size:s,layers:i}}case"flip":return e.flip(t.vertical),e.layers.forEach((e=>e.syncRequested=g)),{type:"flip",vertical:t.vertical};case"rotate":return e.rotate(!t.counterClock),document.dispatchEvent(new CustomEvent("reset-viewport")),e.layers.forEach((e=>e.syncRequested=g)),{type:"rotate",counterClock:t.counterClock};case"selectionChange":{const s=e.selection?i.dN(e.selection.mask):void 0;return t.selection?(e.addSelection(),e.selection.setMask(t.selection),Object.assign(Object.assign({},t),{selection:s})):(e.removeSelection(),Object.assign(Object.assign({},t),{selection:s}))}case"merge":{const s=e.layers.findIndex((e=>e===t.target));if(s<0)return;const[i]=e.layers.splice(s,1);return t.layers.forEach((s=>{const i=t.order.findIndex((e=>e===s.id));i<0?e.layers.push(s):e.layers.splice(i,0,s)})),e.getSelected()&&!e.hasLayer(e.getSelected())&&e.selectLayerById(t.layers[0].id),{type:"merge",kind:t.kind,target:i,from:t.layers,order:s}}case"rasterize":{const s=e.layers.findIndex((e=>e.id===t.newId));if(s<0)return;const[i]=e.layers.splice(s,1,t.layer);return(null===(d=null==e?void 0:e.getSelected())||void 0===d?void 0:d.id)===i.id&&e.selectLayerById(t.layer.id),{type:"rasterize",layer:i,kind:t.kind,newId:t.layer.id}}case"convertSelectionToMask":{const s=t.layer.mask;return t.layer.removeMask(),t.layer.syncRequested=g,e.addSelection(),e.selection.mask=t.selection,e.selection.ctx=t.selection.getContext("2d"),e.selection.createOutline(),{type:"convertSelectionToMask",layer:t.layer,mask:s}}case"convertMaskToSelection":{const s=e.selection.mask;return e.removeSelection(),t.layer.mask=t.mask,t.layer.render(),t.layer.syncRequested=g,{type:"convertMaskToSelection",layer:t.layer,selection:s}}case"applyMask":return t.layer.canvas=t.canvas,t.layer.mask=t.mask,t.layer.rect=null===(u=t.rect)||void 0===u?void 0:u.clone(),t.layer.render(),t.layer.syncRequested=g,{type:"applyMask",layer:t.layer};case"frameContent":{let e,s;return t.layer.canvas&&(e=i.dN(t.layer.canvas),s=null===(p=t.layer.trim)||void 0===p?void 0:p.clone()),t.layer.canvas=t.canvas,t.layer.trim=t.trim,t.layer.render(),{type:"frameContent",kind:t.kind,layer:t.layer,canvas:e,trim:s}}case"frameSettings":{const e=t.layer.frameSettings.clone();return t.layer.frameSettings=t.settings,t.layer.prepare(),t.layer.syncRequested=g,{type:"frameSettings",kind:t.kind,layer:t.layer,settings:e}}case"shapeSettings":{const e=t.layer.shapeSettings.clone();return t.layer.shapeSettings=t.settings,t.layer.prepare(),t.layer.syncRequested=g,{type:"shapeSettings",kind:t.kind,layer:t.layer,settings:e}}case"pageAnimation":{const s=e.animation?e.animation:void 0;return e.animation=t.animation,{type:"pageAnimation",kind:t.kind,animation:s}}case"layerAnimation":{const e=t.layer.animation?t.layer.animation:void 0;return t.layer.animation=t.animation,t.layer.syncRequested=g,{type:"layerAnimation",kind:t.kind,layer:t.layer,animation:e}}default:throw new Error("No handler for this undo type")}}},2209:(e,t,s)=>{s.d(t,{g:()=>h});var i=s(1030),a=s(8685),n=s(1294),o=s(7108),r=s(7664);function h(e,t){const s=new Date;switch(t.type){case"open":return(0,i.Z)("open",t.kind),!0;case"addLayer":return(0,i.Z)("layer-add",t.layer.type),!0;case"bitmapSwitch":case"bitmapChange":return(0,i.Z)(t.kind),t.layer.syncRequested=s,!0;case"flipLayer":return(0,i.Z)("layer-flip"),t.layer.syncRequested=s,!0;case"rotateLayer":return(0,i.Z)("layer-rotate"),t.layer.syncRequested=s,!0;case"frameContent":return(0,i.Z)("frame-content"),t.layer.syncRequested=s,!0;case"frameSettings":return!t.layer.frameSettings.equalTo(t.settings)&&((0,i.Z)("frame-settings"),t.layer.syncRequested=s,!0);case"order":return(0,i.Z)("layer-order"),!0;case"layerSettings":return(0,i.Z)("layer-settings",t.kind),t.layer.syncRequested=s,!0;case"deleteLayer":return(0,i.Z)(t.layer.type+"-delete"),!0;case"textChange":return t.layer.text!==t.text&&((0,i.Z)("text-change"),t.layer.syncRequested=s,!0);case"textSettings":return!t.layer.textSettings.equalTo(t.settings)&&((0,i.Z)("text-settings"),t.layer.syncRequested=s,!0);case"shapeSettings":return!t.layer.shapeSettings.equalTo(t.settings)&&((0,i.Z)("shape-settings"),t.layer.syncRequested=s,!0);case"pageAnimation":return e.animation!==t.animation;case"layerAnimation":return t.layer.animation!==t.animation&&(t.layer.syncRequested=s,!0);case"mask":return(0,i.Z)("mask"),t.layer.syncRequested=s,!0;case"crop":return(0,i.Z)("crop"),e.layers.forEach((e=>e.syncRequested=s)),!0;case"background":return(0,i.Z)("background"),!0;case"maskInvert":return(0,i.Z)("mask-invert"),t.layer.syncRequested=s,!0;case"arrange":switch(t.action.type){case"rect":if(t.layer.rect.equalTo(t.action.rect))return!1;break;case"trim":if(t.layer.trim.equalTo(t.action.rect))return!1}return(0,i.Z)("arrange"),!0;case"arrangeStack":{let e=!1;for(let s=0;s<t.stack.length;s++)t.stack[s].rect&&!t.stack[s].rect.equalTo(t.rects[s])&&(e=!0);return(0,i.Z)("arrangeStack"),e}case"pageSize":return(0,i.Z)("page-size"),e.layers.forEach((e=>e.syncRequested=s)),!0;case"pageResize":return(0,i.Z)("page-resize"),t.layers.forEach((e=>e.syncRequested=s)),!0;case"flip":return(0,i.Z)("flip",t.vertical?"vertical":"horizontal"),e.layers.forEach((e=>e.syncRequested=s)),!0;case"rotate":return(0,i.Z)("rotate",t.counterClock?"left":"right"),e.layers.forEach((e=>e.syncRequested=s)),!0;case"merge":return(0,i.Z)("merge-layers",t.kind),!0;case"adjust":return(0,i.Z)("adjust",t.kind),!0;case"effect":return(0,i.Z)("effect",t.name),!0;case"glitch":return(0,i.Z)("glitch",t.kind),!0;case"selectionChange":case"selectionAndBitmapSwitch":return(0,i.Z)("selection",t.kind),!0;case"rasterize":return(0,i.Z)("rasterize",t.layer.type),t.layer instanceof r.Z||(t.layer instanceof a.Z||(t.layer instanceof n.Z||(t.layer instanceof o.Z||(console.warn("Tried to rasterize an unknown layer type"),!1))));case"convertSelectionToMask":return(0,i.Z)("selection-to-mask"),t.layer.syncRequested=s,!0;case"convertMaskToSelection":return(0,i.Z)("mask-to-selection"),t.layer.syncRequested=s,!0;case"applyMask":return(0,i.Z)("apply-mask"),t.layer.syncRequested=s,!0;default:return!1}}},3607:(e,t,s)=>{s.a(e,(async(e,i)=>{try{s.d(t,{Z:()=>T});var a=s(6548),n=s(165),o=s(3655),r=s(1030),h=s(3673),l=s(4820),c=s(5934),d=s(3506),u=s(4375),p=s(8093),g=s(3947),m=s(4652),v=s(6969),f=s(3747),y=s(6854),w=s(2804),b=s(4699),x=s(7976),Z=s(1951),k=s(6995),P=s(9924),E=s(2409),S=e([n]);n=(S.then?(await S)():S)[0];class T{constructor(e,t){var s,i,S,T,C,L,M;if(this.pollNews=async()=>{const e=new Date(l.ZP.lastNewsCheck);this.news=await fetch(`https://pixlr.com/api/news/poll/?product=${l.ZP.product}&from=${e.toISOString()}&limit=10`).then((e=>e.json()));const t=await this.news;!1!==t.status?(t.data.unread>0&&!t.data.pop&&(0,g.ZP)("news-tab").append((0,g.T)("span",{id:"news-count"},t.data.unread.toFixed(0))),t.data.pop&&new m.Z(t.data.news.docs)):console.error(t.message)},this.newsClick=async()=>{var e;(0,r.Z)("news-click");const t=await this.news;!1!==t.status&&t.data.news.docs.length?(null===(e=(0,g.ZP)("news-count"))||void 0===e||e.remove(),new m.Z(t.data.news.docs)):document.dispatchEvent(new CustomEvent("notification",{detail:(0,a.Z)("noNews")}))},this.urlClick=e=>{(0,r.Z)("open-url"),new f.Z(this.web.stage)},this.newClick=e=>{(0,r.Z)("open-new"),new v.Z(this.web.stage)},this.openClick=async e=>{(0,r.Z)("open-browse"),await c.Q0("e"===l.ZP.product).then((async e=>{for(let t=0;t<e.length;t++)await c.ZB(this.web.stage,e[t])}))},this.batchClick=async e=>{await c.Q0(!0).then((async e=>{0!==e.length&&this.setBatch(e)}))},this.menuClick=e=>{const t=e.currentTarget.getAttribute("data");t!==this.section&&("news"!==t?this.web.navigate(t):this.newsClick())},this.activate=(e,t=!1)=>{try{this.section&&this.section!==e&&((0,g.ZP)(this.section+"-content").style.display="none",(0,g.ZP)(this.section+"-tab").classList.remove("selected")),this.section=e||"home",(0,g.ZP)(this.section+"-content").style.display="block",(0,g.ZP)(this.section+"-tab").classList.add("selected")}catch(s){this.section="home",(0,g.ZP)(this.section+"-content").style.display="block",(0,g.ZP)(this.section+"-tab").classList.add("selected"),history.replaceState(null,null," ")}switch(this.section){case"home":this.setHome();break;case"history":this.setHistory();break;case"template":this.setTemplate();break;case"search":this.setSearch()}},this.showOrHideBackToEditor=()=>{(0,g.ZP)("editor-tab").style.display=this.web.stage&&this.web.stage.fresco?"block":"none",(0,g.ZP)("editor-open-count").innerHTML=this.web.stage?this.web.stage.tabs.length.toString():"0"},this.setHome=async()=>{if((0,g.ZP)("history-carousel")){this.historyCarousel||(this.historyCarousel=new p.Z("history-carousel")),this.historyCarousel.clearItem();const e=await b.q.history();(0,g.ZP)("home-history").style.display=0===e.length?"none":"block";for(let t=0;t<e.length&&(this.historyCarousel.addItem(this.createHistoryBox(e[t],"home")),!(t>14));t++);}if((0,g.ZP)("template-carousel")&&!this.templateCarousel){const e="e"===l.ZP.product?"604a0d511881596a2f2416fb":"604a0d5f082c442ccad3df8a";let t=await w.RH(e,40);if(t&&t.templates){this.templateCarousel=new p.Z("template-carousel");const e=o.Sy(t.templates);for(let t=0;t<e.length&&!(t>20);t++){const s=e[t],i=(0,g.T)("div",{id:s.id,className:"template-box"});s.premium?i.appendChild((0,g.T)("div",{className:"premium"})):i.appendChild((0,g.T)("div",{className:"free"},(0,a.Z)("free"))),i.title=s.name,i.addEventListener("click",(()=>this.previewTemplate(s)),!0);let n=(0,g.T)("img",{src:s.thumbnailSmall});n.height=180,n.width=Math.round(Number(s.ratio.width)/Number(s.ratio.height)*180),n.loading="lazy",n.alt=s.name,i.appendChild(n),this.templateCarousel.addItem(i)}}}},this.previewTemplate=e=>{new k.Z(this.web.stage,e)},this.setHistory=async()=>{const e=(0,g.ZP)("history-latest"),t=(0,g.ZP)("history-pinned");e.innerHTML="",t.innerHTML="";const s=await b.q.history();if(0==s.length)return(0,g.ZP)("history-latest").style.display="none",void((0,g.ZP)("history-no-content").style.display="block");const i=(0,g.ZP)("history-controls"),n=(0,g.ZP)("history-clear"),o=(0,g.ZP)("history-no-content");n.onclick=async()=>{await new x.Z("Confirm",(0,a.Z)("historyClearConfirm"),(0,a.Z)("clear")).init()&&(await b.q.deleteAll(),await this.setHistory(),this.web.stage&&this.web.stage.fresco&&(this.web.stage.close(),(0,g.ZP)("toggle-editor").style.display="none"))},s.forEach((s=>{let i=this.createHistoryBox(s,"hist");s.pinned?t.appendChild(i):e.appendChild(i)})),e.children.length>0?(e.style.display="flex",i.style.display="block",o.style.display="none"):(e.style.display="none",i.style.display="none",o.style.display="block"),t.children.length>0?((0,g.ZP)("history-pinned-divider").style.display="block",t.style.display="flex"):((0,g.ZP)("history-pinned-divider").style.display="none",t.style.display="none")},this.createHistoryBox=(e,t)=>{const s=this.web.stage&&this.web.stage.tabs.some((t=>t.fresco.id===e.id)),i=s&&e.id===this.web.stage.fresco.id;let n=document.createElement("div");n.id=t+"-"+e.id,n.classList.add("image-box");let r,l=(0,g.T)("div",{className:"holder"});n.appendChild(l),s&&(n.classList.add("selected"),n.appendChild((0,g.T)("label",{id:"active-image"},i?"active":"open"))),e.getThumbnail().then((t=>{t&&(r=t,t.alt=e.name,t.width=Math.round(t.width*(180/t.height)),t.height=180,l.appendChild(t))}));const c=async s=>{null==s||s.preventDefault(),null==s||s.stopPropagation(),await b.q.duplicate(e.id),"home"===t?this.setHome():this.setHistory()},d=async a=>{var n;null==a||a.preventDefault(),null==a||a.stopPropagation(),await e.remove(),s&&this.web.tabClose(e.id),i&&this.showOrHideBackToEditor(),null===(n=(0,g.ZP)(t+"-"+e.id))||void 0===n||n.remove()},u=(0,g.T)("div",{className:"top"});n.appendChild(u);const p=document.createElement("img");p.classList.add("close"),p.src="/img/icon/close.svg",p.title=`${(0,a.Z)("historyDelete")} ${e.name}`,p.alt=p.title,p.addEventListener("click",d),u.appendChild(p);const m=async s=>{null==s||s.preventDefault(),null==s||s.stopPropagation(),await(e.pinned?e.unpin():e.pin()),"home"===t?this.setHome():this.setHistory()},v=document.createElement("img");v.classList.add("pin"),v.src=e.pinned?"/img/icon/unpin.svg":"/img/icon/pin.svg",v.title=e.pinned?`${(0,a.Z)("historyUnpin")} ${e.name}`:`${(0,a.Z)("historyPin")} ${e.name}`,v.alt=v.title,v.addEventListener("click",m),u.appendChild(v);const f=document.createElement("img");f.classList.add("more"),f.src="/img/icon/three-dot.svg",f.title=(0,a.Z)("documentActions"),f.alt=(0,a.Z)("documentActions"),f.addEventListener("click",(t=>{t.preventDefault(),t.stopPropagation();const s=t.currentTarget.getBoundingClientRect();new P.C(new h.Z(s.x+(0,g.ZP)("home").scrollLeft+10,s.y+(0,g.ZP)("home").scrollTop+10),[new P.Z(e.pinned?(0,a.Z)("historyUnpin"):(0,a.Z)("historyPin"),m),new P.Z((0,a.Z)("historyDuplicate"),c),new P.Z,new P.Z((0,a.Z)("historyDelete"),d)])})),u.appendChild(f);let y=document.createElement("input");y.value=e.name.toLowerCase(),y.className="name",y.addEventListener("click",(e=>(e.stopPropagation(),!1))),y.addEventListener("keyup",o.d4(500,(()=>{e.name=y.value,e.save()}))),n.appendChild(y);let w=document.createElement("span");return w.innerText=o.ly(e.lastModified),w.className="since",n.appendChild(w),n.addEventListener("click",(()=>{this.web.stage&&this.web.stage.tabs.some((t=>t.fresco.id===e.id))?(this.web.navigate("editor"),this.web.tabSelect(e.id)):this.web.stage.openFromHistory(e,r).catch((e=>{alert("Error restoring document"),console.error(e)}))}),!1),n},this.setTemplate=async()=>{this.categoryCarousel||(this.categoryCarousel=new p.Z("category-carousel")),await this.getTemplates(!0),window.onhashchange=()=>{this.getTemplates(!1)}},this.getTemplates=async e=>{var t,s,i;(0,g.ZP)("template-more").style.display="none",(0,g.ZP)("template-loading").style.display="block";var n=window.location.hash.substr(1).split("&").reduce(((e,t)=>{var s=t.split("=");return e[s[0]]=s[1],e}),{});if(this.category&&(null===(t=(0,g.ZP)(this.category))||void 0===t||t.classList.remove("selected")),!n.page||e){let e=(0,g.ZP)("template-holder");e.innerHTML="",e.classList.value="template-holder",n.category&&e.classList.add(n.category)}if(n.keyword||n.category){let e={limit:50};e.page=Number(null!==(s=n.page)&&void 0!==s?s:1),n.category&&(e.category=n.category),n.keyword&&(e.keywords=n.keyword),n.sort&&(e.sort=n.sort),e.category?((0,g.ZP)("template-holder-title").innerHTML=(0,a.Z)(e.category),null===(i=(0,g.ZP)(e.category))||void 0===i||i.classList.add("selected"),this.category=e.category,"facebook-post"!==e.category&&"instagram-post"!==e.category||(e.category="social-media-post"),"facebook-story"!==e.category&&"instagram-story"!==e.category||(e.category="social-media-story")):(0,g.ZP)("template-holder-title").innerHTML=(0,a.Z)("keyword")+": "+e.keywords;const t=await w.Qz(e);if(t.page!==t.pages){const t=(0,g.ZP)("template-more");t.style.display="block",t.onclick=async()=>{let t="#template";n.category&&(t+="&category="+n.category),n.keyword&&(t+="&keyword="+n.keyword),n.sort&&(t+="&sort="+n.sort),t+="&page="+(e.page+1),window.location.hash=t,(0,g.ZP)("home").scrollBy(0,220)}}await this.renderTemplateResult(t.templates)}else{(0,g.ZP)("template-holder-title").innerHTML=(0,a.Z)("recommended"),(0,g.ZP)("curated").classList.add("selected"),this.category="curated";const e="e"===l.ZP.product?"604a0d511881596a2f2416fb":"604a0d5f082c442ccad3df8a",t=await w.RH(e,50);await this.renderTemplateResult(t.templates)}},this.renderTemplateResult=async e=>{if(!e||0===e.length)return;let t=(0,g.ZP)("template-holder");e.forEach((e=>{const s=(0,g.T)("div",{id:e.id,className:"template-box large"});e.premium?s.appendChild((0,g.T)("div",{className:"premium"})):s.appendChild((0,g.T)("div",{className:"free"},(0,a.Z)("free"))),s.title=e.name,s.addEventListener("click",(()=>this.previewTemplate(e)),!0);let i=(0,g.T)("img",{src:e.thumbnailMedium});i.height=300,i.width=Math.round(Number(e.ratio.width)/Number(e.ratio.height)*300),i.loading="lazy",i.alt=e.name,s.appendChild(i),t.append(s)})),(0,g.ZP)("template-loading").style.display="none"},this.setSearch=async()=>{const e=(0,g.ZP)("search-content-result"),t=(0,g.ZP)("search-input");t.value=d.ZP.randomDefault(),t.focus(),t.onkeyup=s=>{switch(s.key){case"Down":case"ArrowDown":case"Up":case"ArrowUp":case"Left":case"ArrowLeft":case"Right":case"ArrowRight":case"Meta":return}let i=t.value;i.length<=2||(e.innerHTML="",(0,g.ZP)("search-more").style.display="none",(0,g.ZP)("search-loading").style.display="block",(0,g.ZP)("search-error").style.display="none",(0,g.ZP)("search-offline").style.display="none",o.Ds("search-input",800,(()=>{this.doSearch(i,e)})))},(0,g.ZP)("search-loading").style.display="block",(0,g.ZP)("search-error").style.display="none",(0,g.ZP)("search-offline").style.display="none",this.doSearch(t.value,e)},this.doSearch=async(e,t)=>{t.innerHTML="",(0,g.ZP)("search-more").style.display="none";try{const s=await d.ZP.queryAll(e);this.renderResult(s,t)}catch(s){(0,g.ZP)("search-loading").style.display="none",window.navigator.onLine?(0,g.ZP)("search-error").style.display="block":(0,g.ZP)("search-offline").style.display="block"}},this.renderResult=(e,t)=>{e.items.forEach((e=>{let s=document.createElement("div");s.classList.add("box");let i=document.createElement("img");if(i.src=e.thumbnail,i.title=e.description,s.appendChild(i),e.credits){let t=document.createElement("a");t.className="meta",t.target="_blank",t.innerText=e.credits.name,t.title=`${e.credits.name} on ${e.source}`,t.href=e.credits.profile,s.appendChild(t)}s.onclick=()=>this.searchOpen(e),t.appendChild(s)}));const s=(0,g.ZP)("search-more");s.style.display=e.nextPage&&e.items.length>0?"block":"none",(0,g.ZP)("search-loading").style.display="none",(0,g.ZP)("search-no-result").style.display=0===e.items.length?"block":"none",s.onclick=async()=>{const s=await e.nextPage();this.renderResult(s,t)}},this.searchOpen=async e=>{(0,r.Z)("open-stock");const t=new u.Z(this.web.stage,{title:e.id,referrer:e.source}),s=await e.downloadUrl();let i=await t.load(s);c.ZB(this.web.stage,i)},this.setBatch=e=>{(0,r.Z)("open-batch"),history.pushState(null,null,"#batch"),(0,g.ZP)("menu-section").style.display="none",(0,g.ZP)("home-section").style.display="none",this.web.stage&&this.web.stage.fresco&&(this.web.stage.closeAll(),this.showOrHideBackToEditor()),new n.Z(this,e)},this.closeBatch=()=>{(0,g.ZP)("menu-section").style.display="block",(0,g.ZP)("home-section").style.display="block",this.web.navigate("home")},this.web=e,this.section="home",(0,g.ZP)("login")){(0,g.ZP)("login").addEventListener("click",(()=>{new y.k}));"true"===new URLSearchParams(window.location.search).get("showAgreements")&&new y.k("socialAgreements")}if((0,g.ZP)("try-premium")){const e=(0,g.ZP)("try-premium");e.removeAttribute("href"),e.addEventListener("click",(()=>{new Z.Z(this.web.stage,"HOME")}))}null===(s=(0,g.ZP)("welcome-open-image"))||void 0===s||s.addEventListener("mousedown",this.openClick,!0),null===(i=(0,g.ZP)("home-open-image"))||void 0===i||i.addEventListener("mousedown",this.openClick,!0),null===(S=(0,g.ZP)("home-open-new"))||void 0===S||S.addEventListener("mousedown",this.newClick,!0),null===(T=(0,g.ZP)("home-open-url"))||void 0===T||T.addEventListener("mousedown",this.urlClick,!0),null===(C=(0,g.ZP)("home-open-batch"))||void 0===C||C.addEventListener("mousedown",this.batchClick,!0);let A=(0,g.ZP)("home-menu").getElementsByTagName("li");for(var R=0;R<A.length;R++)A[R].addEventListener("click",this.menuClick,!1);null===(L=(0,g.ZP)("mobile-ignore"))||void 0===L||L.addEventListener("click",(()=>{(0,g.ZP)("mobile-variant").remove()}),!0),(0,g.ZP)("history-view-all").addEventListener("click",(()=>this.web.navigate("history",!0)),!0),null===(M=(0,g.ZP)("recommended-view-more"))||void 0===M||M.addEventListener("click",(()=>this.web.navigate("template",!0)),!0),this.pollNews(),this.activate(t,!0),"getDigitalGoodsService"in window&&(0,E.ZF)()}}i()}catch(T){i(T)}}))},6548:(e,t,s)=>{s.d(t,{Z:()=>n});var i=s(3947);let a=(0,i.ZP)("config_i18n")&&""!==(0,i.ZP)("config_i18n").innerText?JSON.parse((0,i.ZP)("config_i18n").innerText):"";function n(e,...t){let s=a[e];if(s||(console.log("No translation for key",e),s=e),!t||0===t.length)return s;let i=0;return s.replace(/%(\d+\$)?(s|d|f){1}/gm,((e,...s)=>{const[a,n]=s,o=a?parseInt(a.slice(0,-1),10):i++;switch(n){case"d":const s=t[o];return"number"!=typeof s?"NaN":s.toFixed(0);case"s":const i=t[o];return i?i.toString():e;default:return e}}))}},6222:(e,t,s)=>{s.d(t,{Z:()=>n});var i=s(3655),a=s(5574);async function n(e,t){t.addShader("alpha-shift-mask",!0);const s=await async function(e){const t=await fetch("/api/auth/ai/remove-background/"),s=await t.json();if(!1===s.status)throw new Error(s.message);const n=new AbortController,{signal:o}=n,r="https://api.phosus.com/bgremove/v1",h=await new Promise(((t,s)=>{i.eY(e,640,640).toBlob(t,"image/jpeg",.8)})),l=new FormData;l.set("image_file",new File([h],"file.jpg"));const c=await fetch(r,{method:"POST",headers:{authorizationtoken:s.data,Accept:"application/json"},body:l,signal:o}),d=await c.json();if(!d.ok)throw new Error(d.error);return await(0,a.OA)("data:image/jpeg;base64,"+d.results.mask)}(e.canvas),n=i.qT(s,1080);e.addMask();e.mask.getContext("2d").drawImage(t.apply(n),0,0,e.mask.width,e.mask.height),e.render()}},2257:(e,t,s)=>{s.d(t,{Z:()=>h});var i=s(3947),a=s(3655),n=s(8776),o=s(3673),r=s(972);class h{constructor(e){this.getSettingsString=()=>JSON.stringify(this.settings),this.setSettingsString=e=>{this.settings=a.mS(r.Z,JSON.parse(e)),this.generate()},this.getStep=()=>Math.round(this.settings.distance*this.settings.size),this.getCursorImage=(e,t=new n.Z(255,255,255,255))=>{if(!(this.canvas.width*e>512||this.canvas.height*e>512))return this.generatetOutline(e,t)},this.generateBasic=(e,t)=>{let s=this.settings.softness;if(this.settings.size<3){if(1===this.settings.size||s<.25)return this.canvas.width=this.settings.size,this.canvas.height=this.settings.size,this.context.fillStyle=e.toRGBA(),void this.context.fillRect(0,0,this.canvas.width,this.canvas.height);s-=.25}const i=this.settings.size,a=(i%2?i:i+1)/2;let n,r,h,l,c,d,u,p,g,m=0,v=0,f=new o.Z(0,0),y=new o.Z(0,0);switch(d=Math.sin(this.settings.angle*Math.PI/180),c=Math.cos(this.settings.angle*Math.PI/180),g=a*this.settings.aspect,f.x=c*a,f.y=d*a*-1,y.x=d*g,y.y=c*g,this.settings.type){case"circle":m=Math.ceil(Math.sqrt(f.x*f.x+y.x*y.x)),v=Math.ceil(Math.sqrt(f.y*f.y+y.y*y.y));break;case"square":m=Math.ceil(Math.abs(f.x)+Math.abs(y.x)),v=Math.ceil(Math.abs(f.y)+Math.abs(y.y));break;case"diamond":m=Math.ceil(Math.max(Math.abs(f.x),Math.abs(y.x))),v=Math.ceil(Math.max(Math.abs(f.y),Math.abs(y.y)))}this.settings.spikes>2&&(m=v=Math.ceil(Math.sqrt(a*a+g*g)),y.x=d*a,y.y=c*a),this.canvas.width=2*m+1,this.canvas.height=2*v+1;const w=this.lookupTable(a,s);u=Math.cos(-2*Math.PI/this.settings.spikes),p=Math.sin(-2*Math.PI/this.settings.spikes);const b=this.context.canvas.width,x=this.context.getImageData(0,0,b,this.context.canvas.height);for(h=-v;h<=v;++h)for(r=-m;r<=m;++r){let s=0,i=c*r-d*h,o=Math.abs(d*r+c*h);if(this.settings.spikes>2){let e,t,s=Math.atan2(o,i);for(;s>Math.PI/this.settings.spikes;)t=i,e=o,i=u*t-p*e,o=p*t+u*e,s-=2*Math.PI/this.settings.spikes}switch(o/=this.settings.aspect,this.settings.type){case"circle":s=Math.sqrt(i*i+o*o);break;case"square":s=Math.max(Math.abs(i),Math.abs(o));break;case"diamond":s=Math.abs(i)+Math.abs(o)}n=s<a+1?w[Math.floor(4*s)]:0,t&&(n=n<64?0:255),l=4*((h+v)*b+(r+m)),x.data[l]=e.r,x.data[l+1]=e.g,x.data[l+2]=e.b,x.data[l+3]=n}this.context.putImageData(x,0,0)},this.generateCustom=(e,t)=>{},this.canvas=(0,i.T)("canvas"),this.settings=e,this.context=this.canvas.getContext("2d",{willReadFrequently:!0}),this.generate()}generate(e=new n.Z,t=!1){"custom"===this.settings.type?this.generateCustom(e,t):this.generateBasic(e,t)}generatetOutline(e=1,t=new n.Z(255,255,255,255)){const s=Math.round(this.canvas.width*e)||1,i=Math.round(this.canvas.height*e)||1;let o=a.vL(s+2,i+2);const r=o.getContext("2d");r.fillStyle=t.toRGBA(),r.shadowColor=new n.Z(0,0,0).toRGBA(),r.shadowBlur=1,s>20&&i>20&&(r.fillRect(~~(s/2)-3,~~(i/2),8,2),r.fillRect(~~(s/2),~~(i/2)-3,2,8));let h,l,c,d,u,p=1!=e?a.eY(this.canvas,s,i,!1).getContext("2d").getImageData(0,0,s,i):this.context.getImageData(0,0,s,i);for(let a=0;a<i;++a){l=!0,c=Boolean(p.data[a*s*4+3]<64);for(let e=0;e<s;++e)h=l,l=c,c=e+1===s||p.data[4*(a*s+e+1)+3]<64,l||(d=a-1<0||p.data[4*((a-1)*s+e)+3]<64,u=a+1===i||p.data[4*((a+1)*s+e)+3]<64,(h||d||c||u)&&r.fillRect(e+1,a+1,1,1))}if(s<=20&&i<=20){const e=a.vL(33,33),s=e.getContext("2d");s.drawImage(o,Math.floor((33-o.width)/2),Math.floor((33-o.height)/2)),s.fillStyle=t.toRGBA(),s.shadowColor=new n.Z(0,0,0).toRGBA(),s.shadowBlur=1,s.fillRect(2,15,4,2),s.fillRect(26,15,4,2),s.fillRect(15,2,2,4),s.fillRect(15,26,2,4),o=e}return o}lookupTable(e,t){const s=new Array;let i,a,n=0;const o=new Array(4),r=Math.round(e+1),h=4*Math.ceil(1+Math.sqrt(r*r*2));let l;for(a=t<4e-7?1e6:.4/t,l=0;l<4;l++)i=Math.abs((l+.5)/4-.5),o[l]=i>e?0:this.gaussian(Math.pow(i/e,a)),n+=o[l];for(l=0;i<e||n>1e-5;i+=1/4){n-=o[l%4],o[l%4]=i>e?0:this.gaussian(Math.pow(i/e,a)),n+=o[l%4];let t=Math.floor(63.75*n);s[l++]=Math.max(0,t)}for(;l<h;)s[l++]=0;return s}gaussian(e){return e<-.5?2*(e=-1-e)*e:e<.5?1-2*e*e:2*(e=1-e)*e}}},972:(e,t,s)=>{s.d(t,{Z:()=>i});class i{constructor(e="circle",t=40,s=.2,i=1,a=0,n=1,o=2,r=.2,h){this.type=e,this.size=t,this.softness=s,this.opacity=i,this.angle=a,this.aspect=n,this.spikes=o,this.distance=r,this.source=h}}i.isEqual=(e,t)=>!(!e||!t)&&(e.type===t.type&&e.size===t.size&&e.softness===t.softness&&e.angle===t.angle&&e.aspect===t.aspect&&e.spikes===t.spikes&&e.source===t.source)},1662:(e,t,s)=>{s.d(t,{Z:()=>i});class i{constructor(e=0,t=255,s=0,i=255,a=1,n=.5){this.minin=e,this.maxin=t,this.minout=s,this.maxout=i,this.midin=a,this.mid=n,this.map=e=>(e=(e-this.minin)/(this.maxin-this.minin),e=Math.pow(e,this.midin),(e=this.minout+e*(this.maxout-this.minout))>this.maxout?e=this.maxout:e<this.minout&&(e=this.minout),Math.round(e))}reset(){this.minout=0,this.maxout=255,this.midin=1,this.minin=0,this.maxin=255,this.mid=.5}isFlat(){return Boolean(0==this.minout&&255==this.maxout&&.5==this.mid&&0==this.minin&&255==this.maxin)}setMid(e){this.mid=(e-this.minin)/(this.maxin-this.minin),this.midin=this.midToIn(this.mid)}midToIn(e){return Math.min(Math.max(Math.pow(9.99,2*e-1),.1),9.99)}static fillPaletteMap(e,t){for(let s=0;s<256;++s){let i=e.map(s);t.data[4*s]=i,t.data[4*s+1]=i,t.data[4*s+2]=i}}static fillRGBPaletteMap(e,t,s,i){for(let a=0;a<256;++a)i.data[4*a]=e?e.map(a):a,i.data[4*a+1]=t?t.map(a):a,i.data[4*a+2]=s?s.map(a):a}}},2468:(e,t,s)=>{s.d(t,{Z:()=>i});class i{constructor(e,t){var s,i,a,n,o,r,h,l,c,d,u,p,g;if(null!=e&&null!=t){for(l=e.length-1,n=[],u=[],h=[],d=[],p=[],i=[],s=[],a=[],r=[],c=[],o=0;0<=l?o<l:o>l;0<=l?o+=1:o-=1)n[o]=e[o+1]-e[o],r[o]=t[o+1]-t[o],c[o]=r[o]/n[o];for(o=1;1<=l?o<l:o>l;1<=l?o+=1:o-=1)u[o]=3/n[o]*(t[o+1]-t[o])-3/n[o-1]*(t[o]-t[o-1]);for(h[0]=1,d[0]=0,p[0]=0,o=1;1<=l?o<l:o>l;1<=l?o+=1:o-=1)h[o]=2*(e[o+1]-e[o-1])-n[o-1]*d[o-1],d[o]=n[o]/h[o],p[o]=(u[o]-n[o-1]*p[o-1])/h[o];for(h[l]=1,p[l]=0,i[l]=0,o=g=l-1;g<=0?o<=0:o>=0;g<=0?o+=1:o-=1)i[o]=p[o]-d[o]*i[o+1],s[o]=(t[o+1]-t[o])/n[o]-n[o]*(i[o+1]+2*i[o])/3,a[o]=(i[o+1]-i[o])/(3*n[o]);this.x=e.slice(0,l+1),this.a=t.slice(0,l),this.b=s,this.c=i.slice(0,l),this.d=a}}interpolate(e){var t,s,i;for(s=i=this.x.length-1;(i<=0?s<=0:s>=0)&&!(this.x[s]<=e);i<=0?s+=1:s-=1);return t=e-this.x[s],this.a[s]+this.b[s]*t+this.c[s]*Math.pow(t,2)+this.d[s]*Math.pow(t,3)}}},134:(e,t,s)=>{s.d(t,{Z:()=>o,z:()=>n});var i=s(3673),a=s(2468);class n{constructor(e){this.preset=e}static createCurveSet(e){const t=new Array,s=new Array,a=new Array,n=new Array;for(let o=0;o<e.preset[0].length;o+=2)t.push(new i.Z(e.preset[0][o],e.preset[0][o+1]));for(let o=0;o<e.preset[1].length;o+=2)s.push(new i.Z(e.preset[1][o],e.preset[1][o+1]));for(let o=0;o<e.preset[2].length;o+=2)a.push(new i.Z(e.preset[2][o],e.preset[2][o+1]));for(let o=0;o<e.preset[3].length;o+=2)n.push(new i.Z(e.preset[3][o],e.preset[3][o+1]));return new o(1,t,s,a,n)}}class o{constructor(e=255,t=[],s=[],i=[],a=[]){this.scale=e,this.rgb=t,this.red=s,this.green=i,this.blue=a,this.percent=1}static getInterpolation(e,t){let s=[],i=[],n=new Float32Array(256);for(var o=0;o<t.length;o++)s.push(t[o].x*e),i.push(t[o].y*e);let r=new a.Z(s,i);for(var h=0;h<Math.ceil(s[0]);h++)n[h]=i[0];for(h=Math.ceil(s[0]);h<Math.ceil(s[s.length-1]);h++)n[h]=r.interpolate(h);for(h=Math.ceil(s[s.length-1]);h<256;h++)n[h]=i[i.length-1];return n}static fillPaletteMap(e,t){let s=o.getInterpolation(e.scale,e.rgb),i=o.getInterpolation(e.scale,e.red),a=o.getInterpolation(e.scale,e.green),n=o.getInterpolation(e.scale,e.blue);for(let o=0;o<256;++o){let r=o-s[o];t.data[4*o]=o-Math.round((o-(i[o]-r))*e.percent),t.data[4*o+1]=o-Math.round((o-(a[o]-r))*e.percent),t.data[4*o+2]=o-Math.round((o-(n[o]-r))*e.percent)}}}},4084:(e,t,s)=>{s.d(t,{Z:()=>i});class i{constructor(e,t,s){this.color=e,this.blend=t,this.amount=s}}},2817:(e,t,s)=>{s.d(t,{Z:()=>y});var i=s(3947),a=s(6548),n=s(3655),o=s(9872),r=s(6817),h=s(3646),l=s(3673),c=s(4820),d=s(4170),u=s(1726),p=s(8685),g=s(1294),m=s(7108),v=s(2282),f=s(9924);class y{constructor(e,t){this.addPointer=e=>{this.pointers.push(e),this.stage.raster.setPointerCapture(e)},this.removePointer=e=>{for(let t=0;t<this.pointers.length;t++)if(this.pointers[t]===e){this.pointers.splice(t,1);break}this.stage.raster.releasePointerCapture(e)},this.addListener=()=>{this.stage.raster.addEventListener("pointerdown",this.pointerDown,!1),this.stage.raster.addEventListener("pointermove",this.pointerMove,!1),this.stage.raster.addEventListener("pointerup",this.pointerUp,!1),this.raster.addEventListener("dblclick",this.dblClick,!1),this.raster.addEventListener("contextmenu",this.contextMenu,!0),document.addEventListener("viewport-render",this.render,!1),document.addEventListener("keydown",this.keyDown,!1),document.addEventListener("keyup",this.keyUp,!1)},this.removeListener=()=>{this.ctx.clearRect(0,0,this.raster.width,this.raster.width),this.stage.raster.removeEventListener("pointerdown",this.pointerDown,!1),this.stage.raster.removeEventListener("pointermove",this.pointerMove,!1),this.stage.raster.removeEventListener("pointerup",this.pointerUp,!1),this.raster.removeEventListener("dblclick",this.dblClick,!1),this.raster.removeEventListener("contextmenu",this.contextMenu,!0),document.removeEventListener("viewport-render",this.render,!1),document.removeEventListener("keydown",this.keyDown,!1),document.removeEventListener("keyup",this.keyUp,!1)},this.pointerDown=e=>{e.stopPropagation(),this.stage.coating.override||e.button>0||(this.isShiftDown=e.shiftKey,this.addPointer(e.pointerId),1===this.pointers.length&&this.down(new l.Z(e.clientX-this.stage.rasterRect.x,e.clientY-this.stage.rasterRect.y),e.shiftKey||e.ctrlKey,e.altKey,e.ctrlKey,e.pointerType))},this.pointerMove=e=>{e.stopPropagation(),this.isShiftDown=e.shiftKey,this.pointers.length<2&&this.move(new l.Z(e.clientX-this.stage.rasterRect.x,e.clientY-this.stage.rasterRect.y),e.pointerType)},this.pointerUp=e=>{e.stopPropagation(),this.removePointer(e.pointerId),this.up(new l.Z(e.clientX-this.stage.rasterRect.x,e.clientY-this.stage.rasterRect.y),e.pointerType)},this.supress=e=>{e&&!this.supressed?(this.raster.style.cursor="unset",this.supressed=!0,this.removeListener()):!e&&this.supressed&&(this.supressed=!1,this.addListener())},this.keyDown=e=>{if("INPUT"!==document.activeElement.nodeName&&"TEXTAREA"!==document.activeElement.nodeName&&"SELECT"!==document.activeElement.nodeName&&("ArrowUp"===e.key||"ArrowDown"===e.key||"ArrowLeft"===e.key||"ArrowRight"===e.key)){let t=e.shiftKey?10:1,s="ArrowLeft"===e.key||"ArrowRight"===e.key?"ArrowLeft"===e.key?-t:t:0,i="ArrowUp"===e.key||"ArrowDown"===e.key?"ArrowUp"===e.key?-t:t:0;this.step(s,i)}},this.keyUp=e=>{},this.contextMenu=e=>{if(e.preventDefault(),e.stopPropagation(),"SIMPLE"===this.mode)return;const t=new l.Z(e.clientX-this.raster.offsetLeft,e.clientY-this.raster.offsetTop),s=this.getLayerAt(t);if(!s)return;const i=new Array;s.type===d.Z.TYPE_TEXT&&i.push(new f.Z((0,a.Z)("titleEditText"),(()=>this.dblClick())),new f.Z((0,a.Z)("titleRasterizeLayer"),(()=>this.stage.rasterize())),new f.Z),s.type!==d.Z.TYPE_SHAPE&&s.type!==d.Z.TYPE_ELEMENT||i.push(new f.Z((0,a.Z)("titleRasterizeLayer"),(()=>this.stage.rasterize())),new f.Z),s.type===d.Z.TYPE_FRAME&&i.push(new f.Z(s.canvas?(0,a.Z)("titleChangeImage"):(0,a.Z)("titleAddImage"),(()=>this.stage.browseFrameImage())),new f.Z(s.editMode?(0,a.Z)("titlePositionFrame"):(0,a.Z)("titlePositionContent"),s.canvas?this.dblClick:void 0),new f.Z((0,a.Z)("titleAutoFitContent"),s.canvas?()=>this.stage.fitFrameContent():void 0),new f.Z((0,a.Z)("titleRasterizeLayer"),s.canvas?()=>this.stage.rasterize():void 0),new f.Z((0,a.Z)("titleRemoveFrameImage"),s.canvas?()=>this.stage.deleteLayer(!0):void 0),new f.Z),i.push(new f.Z((0,a.Z)("titleHideLayer"),(()=>this.stage.changeVisible(s,!1))),new f.Z((0,a.Z)("titleLockLayer"),(()=>this.stage.changeLocked(s,!0))),new f.Z,new f.Z((0,a.Z)("titleCutLayer"),(()=>this.stage.cutLayer())),new f.Z((0,a.Z)("titleCopyLayer"),(()=>this.stage.copyLayer())),new f.Z((0,a.Z)("titlePasteLayer"),Array.isArray(this.stage.clipboard)?()=>this.stage.pasteLayer():void 0),new f.Z((0,a.Z)("titleDuplicateLayer"),(()=>this.stage.duplicateLayer())),new f.Z((0,a.Z)("titleDeleteLayer"),(()=>this.stage.deleteLayer()),"DEL")),s instanceof v.Z&&s.hasMask()&&i.push(new f.Z,new f.Z((0,a.Z)("titleLayerApplyMask"),(()=>this.stage.maskApply())),new f.Z((0,a.Z)("titleLayerDeleteMask"),(()=>this.stage.maskDelete())));const n=this.getLayersAt(t);if(n.length>1){const e=new Array;n.forEach((t=>{e.push(new f.Z(t.settings.name,(()=>this.stage.selectLayerById(t.id))))})),i.push(new f.Z,new f.Z((0,a.Z)("titleSelectLayer"),void 0,void 0,void 0,e))}new f.C(new l.Z(e.clientX,e.clientY),i)},this.setMode=e=>{this.mode=e,"ARRANGE"===this.mode||"SIMPLE"===this.mode?this.defaultCursor="unset":"TEXT"===this.mode?this.defaultCursor="text":this.defaultCursor="crosshair",this.render()},this.down=async(e,t,s,i,a)=>{if("INPUT"===document.activeElement.nodeName&&"radio"!==document.activeElement.getAttribute("type")||"SELECT"===document.activeElement.nodeName)return;"mouse"!==a&&this.move(e,a),this.isDown=!0,this.layerOver=void 0,this.downPoint=this.stage.translateRasterToFresco(e,void 0,!1);let n=this.stage.fresco.getSelectedStack();const o=n.length>1||1===n.length&&("TEXT"===this.mode&&n[0].type===d.Z.TYPE_TEXT||"FRAME"===this.mode&&n[0].type===d.Z.TYPE_FRAME||"SHAPE"===this.mode&&n[0].type===d.Z.TYPE_SHAPE);if(!this.isControl(n,e)&&c.ZP.autoSelect){let s=this.getLayerAt(e);!this.stage.fresco.isSelectedById(null==s?void 0:s.id)||i?(this.stage.selectLayer(s,t,i,!0),n=this.stage.fresco.getSelectedStack(),this.method="move"):window.requestAnimationFrame(this.render)}if(n.length>0){s&&(await this.stage.duplicateLayer(!1),n=this.stage.fresco.getSelectedStack());let e=1===n.length;if(!e||this.shouldReformLayer(n[0])){let t,s;if(e&&n[0].editMode&&n[0]instanceof g.Z?(this.anchorAlt=this.getAnchor(n[0].trim,n[0].trim.center(),0),this.downRect=[n[0].trim.clone()]):this.downRect=this.stage.fresco.getSelectedStackRect(),e?(s=n[0].rect.center(),t=n[0].editMode?n[0].trim:n[0].rect,t.rotation=n[0].rect.rotation):(n.forEach((e=>{e.rect&&(t=r.Z.merge(t,e.rect.getRotatedBounds()))})),s=t?t.center():void 0),"rotate"===this.method)this.raster.style.cursor="grabbing",this.downRotation=180/Math.PI*Math.atan2(this.downPoint.y-s.y,this.downPoint.x-s.x)-t.rotation;else if("move"!==this.method){let e,i;switch(this.method){case"nw-resize":i=t.topLeft(),e=t.bottomRight();break;case"n-resize":i=new l.Z(s.x,t.y),e=new l.Z(s.x,t.bottom());break;case"ne-resize":i=t.topRight(),e=t.bottomLeft();break;case"e-resize":i=new l.Z(t.right(),s.y),e=new l.Z(t.x,s.y);break;case"se-resize":i=t.bottomRight(),e=t.topLeft();break;case"s-resize":case"t-resize":i=new l.Z(s.x,t.bottom()),e=new l.Z(s.x,t.y);break;case"sw-resize":i=t.bottomLeft(),e=t.topRight();break;case"w-resize":i=new l.Z(t.x,s.y),e=new l.Z(t.right(),s.y)}this.downControl=this.rotatePoint(i,s,360-t.rotation),this.downAnchor=this.rotatePoint(e,s,360-t.rotation)}else this.downControl=t.topLeft()}}this.proxy&&(0===n.length||1===n.length&&!this.shouldReformLayer(n[0]))?this.proxy(e,o):(0===n.length||1===n.length&&n[0].settings.locked)&&(this.downPoint=e,this.method="select")},this.move=(e,t)=>{if(this.stage.fresco)if(this.isDown)this.stage.fresco.isSelectedStack()&&this.downRect.length>0?this.moveStack(e):this.stage.fresco.hasSelected()&&this.downRect.length>0?this.moveSingle(e):"select"===this.method&&(this.stage.coating.ctx.lineWidth=2,this.stage.coating.ctx.strokeStyle=n.xZ,this.stage.coating.ctx.clearRect(0,0,this.stage.coating.ctx.canvas.width,this.stage.coating.ctx.canvas.height),this.stage.coating.ctx.strokeRect(this.downPoint.x,this.downPoint.y,e.x-this.downPoint.x,e.y-this.downPoint.y));else{if("INPUT"===document.activeElement.nodeName||"TEXTAREA"===document.activeElement.nodeName||"SELECT"===document.activeElement.nodeName)return void(this.raster.style.cursor="unset");let t=this.stage.fresco.getSelectedStack();if(this.isControl(t,e))this.layerOver&&(this.layerOver=void 0,window.requestAnimationFrame(this.render));else if(c.ZP.autoSelect){let t=this.getLayerAt(e);if(this.layerOver&&this.layerOver===t)return;this.raster.style.cursor=this.method=t?"move":"ARRANGE"===this.mode||"SIMPLE"===this.mode?"unset":this.defaultCursor,t&&!this.stage.fresco.isSelectedById(t.id)?(this.layerOver=t,window.requestAnimationFrame(this.render)):this.layerOver&&(this.layerOver=void 0,window.requestAnimationFrame(this.render))}else 1!==t.length||t[0].settings.locked?this.raster.style.cursor=this.method=this.defaultCursor:this.raster.style.cursor=this.method="move"}},this.moveSingle=e=>{const t=this.stage.translateRasterToFresco(e,void 0,!1),s=this.stage.fresco.getSelected();if(this.shouldReformLayer(s)){if("move"===this.method){if(s instanceof g.Z)if(s.editMode&&s.trim){const e=this.rotatePoint(t,s.rect.center(),s.rect.rotation),i=this.rotatePoint(this.downPoint,s.rect.center(),s.rect.rotation);s.position(Math.round(this.downControl.x+(e.x-i.x)),Math.round(this.downControl.y+(e.y-i.y)))}else s.position(Math.round(this.downControl.x+(t.x-this.downPoint.x)),Math.round(this.downControl.y+(t.y-this.downPoint.y)));else{if(this.isShiftDown){const e=Math.abs(this.downPoint.x-t.x),s=Math.abs(this.downPoint.y-t.y);(e>4||s>4)&&(e<s?(t.x=this.downPoint.x,this.method="vertical"):(t.y=this.downPoint.y,this.method="horizontal"))}s.position(Math.round(this.downControl.x+(t.x-this.downPoint.x)),Math.round(this.downControl.y+(t.y-this.downPoint.y)))}this.checkMoveGuides()}else if("vertical"===this.method)this.isShiftDown||(this.method="move"),s.position(void 0,Math.round(this.downControl.y+(t.y-this.downPoint.y))),this.checkMoveGuides();else if("horizontal"===this.method)this.isShiftDown||(this.method="move"),s.position(Math.round(this.downControl.x+(t.x-this.downPoint.x)),void 0),this.checkMoveGuides();else if("rotate"===this.method){const e=s.rect.center();let i=180/Math.PI*Math.atan2(t.y-e.y,t.x-e.x)-this.downRotation;this.isShiftDown&&(i=11.25*Math.round(i/11.25)),i<0?i+=360:i>=360&&(i-=360),s.rect.rotation=i}else{let e=t.neg(this.downPoint),i=this.downAnchor,a=this.downControl.add(e);if(a=this.checkReformGuides(a),0!==s.rect.rotation){const e=new l.Z((i.x+a.x)/2,(i.y+a.y)/2);a=this.rotatePoint(a,e,s.rect.rotation),i=this.rotatePoint(i,e,s.rect.rotation)}let n=(void 0!==this.constrain?this.constrain:!this.isShiftDown)?this.downRect[0].getAspect():0;switch(this.method){case"nw-resize":s.calculate(a,i,n);break;case"ne-resize":s.calculate(new l.Z(i.x,a.y),new l.Z(a.x,i.y),n);break;case"sw-resize":s.calculate(new l.Z(a.x,i.y),new l.Z(i.x,a.y),n);break;case"se-resize":s.calculate(i,a,n);break;case"w-resize":s.calculate(a,i,n),s.render(!0);break;case"e-resize":s.calculate(i,a,n),s.render(!0);break;case"t-resize":let e=a.y-i.y;s.rect.height=Math.round(e),s.rect.width=Math.round(this.downRect[0].width*(e/this.downRect[0].height)),s.resetBaked()}if(s.editMode&&s instanceof g.Z){let e=this.anchorAlt.neg(this.getAnchor(s.trim,s.trim.center(),0));s.trim.x=Math.round(s.trim.x+e.x),s.trim.y=Math.round(s.trim.y+e.y),s.render()}else{let e=this.downAnchor.neg(this.getAnchor(s.rect,s.rect.center(),s.rect.rotation));s.rect.x=Math.round(s.rect.x+e.x),s.rect.y=Math.round(s.rect.y+e.y)}"move"!==this.method&&s instanceof m.Z&&s.render(!0),"move"!==this.method&&s instanceof g.Z&&s.update()}window.requestAnimationFrame((()=>{this.stage.render(),this.render()})),document.dispatchEvent(new CustomEvent("layer-arrange"))}},this.moveStack=e=>{const t=this.stage.translateRasterToFresco(e,void 0,!1),s=this.stage.fresco.getSelectedStack();if("move"===this.method){if(this.isShiftDown){const e=Math.abs(this.downPoint.x-t.x),s=Math.abs(this.downPoint.y-t.y);(e>4||s>4)&&(e<s?(t.x=this.downPoint.x,this.method="vertical"):(t.y=this.downPoint.y,this.method="horizontal"))}for(let e=0;e<s.length;e++)this.downRect[e]&&s[e].position(Math.round(this.downRect[e].x+(t.x-this.downPoint.x)),Math.round(this.downRect[e].y+(t.y-this.downPoint.y)));this.checkMoveGuides()}else if("vertical"===this.method){this.isShiftDown||(this.method="move");for(let e=0;e<s.length;e++)this.downRect[e]&&s[e].position(void 0,Math.round(this.downRect[e].y+(t.y-this.downPoint.y)));this.checkMoveGuides()}else if("horizontal"===this.method){this.isShiftDown||(this.method="move");for(let e=0;e<s.length;e++)this.downRect[e]&&s[e].position(Math.round(this.downRect[e].x+(t.x-this.downPoint.x)),void 0);this.checkMoveGuides()}else{let e=t.neg(this.downPoint),i=this.downControl.add(e);i=this.checkReformGuides(i);let a=r.Z.calculate(this.downAnchor,this.downControl),n=r.Z.calculate(this.downAnchor,i,a.getAspect());n.width<4&&(n.width=4);let o=n.getComparedScale(a),h=this.downAnchor.neg(this.getAnchor(n,n.center(),0));n.x+=h.x,n.y+=h.y;for(let t=0;t<s.length;t++){let e=this.downRect[t];e&&(s[t].rect.x=Math.round(n.x+(e.x-a.x)*o.width),s[t].rect.y=Math.round(n.y+(e.y-a.y)*o.height),s[t].rect.width=Math.round(e.width*o.width),s[t].rect.height=Math.round(e.height*o.height)),s[t]instanceof p.Z&&s[t].bect&&s[t].resetBaked()}}window.requestAnimationFrame((()=>{this.stage.render(),this.render()})),document.dispatchEvent(new CustomEvent("layer-arrange"))},this.getAnchor=(e,t,s)=>{let i;switch(this.method){case"nw-resize":i=e.bottomRight();break;case"n-resize":i=new l.Z(t.x,e.bottom());break;case"ne-resize":i=e.bottomLeft();break;case"e-resize":i=new l.Z(e.x,t.y);break;default:i=e.topLeft();break;case"s-resize":case"t-resize":i=new l.Z(t.x,e.y);break;case"sw-resize":i=e.topRight();break;case"w-resize":i=new l.Z(e.right(),t.y)}return this.rotatePoint(i,t,360-s)},this.rotatePoint=(e,t,s)=>0!==s&&360!==s&&t?(this.matrix.reset(),this.matrix.translate(t),this.matrix.rotateDegree(s),this.matrix.invert(),this.matrix.transformPoint(e).add(t)):e,this.up=(e,t)=>{if(this.isDown)if(this.downRect.length>0)this.downPoint.equalTo(this.stage.translateRasterToFresco(e,void 0,!1))||this.commitHistory();else if("select"===this.method){const t=this.stage.translateToRect(this.downPoint,e,!1,!0),s=this.getLayersInside(t);s.length>0&&this.stage.selectLayerStack(s,this.isShiftDown,!0)}"rotate"===this.method&&(this.raster.style.cursor="grab"),this.isDown=!1,this.layerOver=void 0,this.downPoint=void 0,this.downControl=void 0,this.downAnchor=void 0,this.downRect=[],this.guides=[],window.requestAnimationFrame((()=>{this.stage.render(),this.render()}))},this.commitHistory=(e=this.method)=>{const t=this.stage.fresco.getSelectedStack();if(this.historyRect){let e;1===t.length?e=t[0].editMode&&t[0]instanceof g.Z?t[0].trim:t[0].rect:t.forEach((t=>{t.rect&&(e=r.Z.merge(e,t.rect.getRotatedBounds()))}));const s=e.equalTo(this.historyRect);if(this.historyRect=void 0,s)return}for(let s=0;s<t.length;s++){let i=t[s];if(i instanceof p.Z&&this.downRect[s])if("w-resize"===e||"e-resize"===e)this.downRect[s].height=i.textSettings.size;else{let e=i.rect.height/this.downRect[s].height;this.downRect[s].height=i.textSettings.size,1!==e&&i.setHeightScale(e)}else"move"!==e&&i instanceof g.Z&&!i.editMode&&i.trimOnResize(this.downRect[s])}t.length>0&&(1===t.length?this.stage.history.add({type:"arrange",kind:"rotate"===e?"rotate":"move"===e||"vertical"===e||"horizontal"===e?"move":"resize",layer:t[0],action:{type:t[0].editMode?"trim":"rect",rect:this.downRect[0]}}):this.stage.history.add({type:"arrangeStack",id:this.stage.fresco.getSelectedStackId(),kind:"rotate"===e?"rotate":"move"===e||"vertical"===e||"horizontal"===e?"move":"resize",stack:Array.from(t),rects:this.downRect})),"move"!==e&&this.stage.fresco.getSelectedStack().forEach((e=>{e.render()})),document.dispatchEvent(new CustomEvent("layer-arrange"))},this.beginHistory=()=>{let e=this.stage.fresco.getSelectedStack();1===e.length?(this.downRect=[e[0].editMode&&e[0]instanceof g.Z?e[0].trim.clone():e[0].rect.clone()],this.historyRect=this.downRect[0]):(this.downRect=this.stage.fresco.getSelectedStackRect(),e.forEach((e=>{e.rect&&(this.historyRect=r.Z.merge(this.historyRect,e.rect.getRotatedBounds()))})))},this.inputRotation=e=>{const t=this.stage.fresco.getSelected();t&&t.rect&&(t.rect.rotation=e,window.requestAnimationFrame((()=>{this.stage.render(),this.render()})))},this.inputSize=(e,t)=>{let s=new o.Z;if(!this.historyRect)return s;e&&(e=Math.min(e,9999)),t&&(t=Math.min(t,9999));let i=this.stage.fresco.getSelectedStack();if(1===i.length)e&&i[0].setWidth(e,this.constrain?this.historyRect.getAspect():0),t&&i[0].setHeight(t,this.constrain||i[0]instanceof p.Z?this.historyRect.getAspect():0),s=i[0].editMode?i[0].trim.size():i[0].rect.size();else{let a=this.historyRect,n=this.historyRect.clone();e&&(n.width+=e-a.width,n.height=Math.round(n.width/a.getAspect())),t&&(n.height+=t-a.height,n.width=Math.round(n.height*a.getAspect()));let o=n.getComparedScale(a);for(let e=0;e<i.length;e++){let t=this.downRect[e];t&&(i[e].rect.x=Math.round(n.x+(t.x-a.x)*o.width),i[e].rect.y=Math.round(n.y+(t.y-a.y)*o.height),i[e].rect.width=Math.round(t.width*o.width),i[e].rect.height=Math.round(t.height*o.height))}s.width=n.width,s.height=n.width}return window.requestAnimationFrame((()=>{this.stage.render(),this.render()})),s},this.inputPosition=(e,t)=>{let s=this.stage.fresco.getSelectedStack();if(1===s.length)s[0].position(e,t);else{e-=this.historyRect.x,t-=this.historyRect.y;for(let i=0;i<s.length;i++){let a=this.downRect[i];s[i].position(a.x+e,a.y+t)}}window.requestAnimationFrame((()=>{this.stage.render(),this.render()}))},this.step=(e,t)=>{const s=this.stage.fresco.getSelectedStack();if(0!==s.length&&!this.historyRect&&!this.isDown){if(1===s.length){const i=s[0].editMode?s[0].trim.clone():s[0].rect.clone();s[0].position(i.x+e,i.y+t),this.stage.history.add({type:"arrange",kind:"move",layer:s[0],action:{type:s[0].editMode?"trim":"rect",rect:i}})}else{let i=this.stage.fresco.getSelectedStackRect();s.forEach((s=>{this.shouldReformLayer(s)&&s.position(s.rect.x+e,s.rect.y+t)})),this.stage.history.add({type:"arrangeStack",id:this.stage.fresco.getSelectedStackId(),kind:"move",stack:Array.from(s),rects:i})}document.dispatchEvent(new CustomEvent("layer-arrange")),window.requestAnimationFrame((()=>{this.stage.render(),this.render()}))}},this.render=()=>{if(!this.stage||!this.stage.fresco||this.stage.supressRender)return;let e,t;if(this.ctx.clearRect(0,0,this.raster.width,this.raster.height),this.ctx.lineWidth=1,this.layerOver){if(this.ctx.translate(.5,.5),this.ctx.strokeStyle=n.TA,e=this.stage.getLayerLocationRect(this.layerOver),0!==e.rotation){let t=e.center();this.ctx.translate(t.x,t.y),this.ctx.rotate(e.rotation*Math.PI/180),e.x-=t.x,e.y-=t.y}this.ctx.strokeRect(e.x-1,e.y-1,e.width+1,e.height+1),this.ctx.setTransform(1,0,0,1,0,0)}let s=this.stage.fresco.getSelectedStack();if(s.length>0){let e=1===s.length;if(e&&!this.shouldReformLayer(s[0]))return;let i,a,o=!0,h=n.xZ,l=n.wf;if(e?s[0].editMode&&s[0]instanceof g.Z?(i=this.stage.getLayerLocationTrim(s[0]),t=this.stage.getLayerLocationRect(s[0]),a=t.center(),h=n.kD,o=!1):(i=this.stage.getLayerLocationRect(s[0]),a=i.center()):(s.forEach((e=>{let t=this.stage.getLayerLocationRect(e);t&&(i=r.Z.merge(i,t.getRotatedBounds()))})),a=i.center(),o=!1),!i)return;this.ctx.translate(.5,.5);let c=10,u=5;i.width<20||i.height<20?(c=6,u=3):(i.width<40||i.height<40)&&(c=8,u=4),0!==i.rotation&&(this.ctx.translate(a.x,a.y),this.ctx.rotate(i.rotation*Math.PI/180),i.x-=a.x,i.y-=a.y,t&&(t.x-=a.x,t.y-=a.y),a.x=0,a.y=0),t&&(this.ctx.lineWidth=2,this.ctx.strokeStyle=n.XI,this.ctx.strokeRect(t.x-2,t.y-2,t.width+2,t.height+2),this.ctx.lineWidth=1),this.ctx.strokeStyle=h,this.ctx.fillStyle=l,this.ctx.strokeRect(i.x-1,i.y-1,i.width+1,i.height+1),this.isDown&&"unset"!==this.method||(0===i.rotation&&this.ctx.translate(-.5,-.5),o&&(this.ctx.fillStyle=h,this.ctx.fillRect(Math.round(i.x+i.width/2-1),i.y-10,2,10),this.ctx.beginPath(),this.ctx.arc(i.x+i.width/2,i.y-10-u,u+1,0,2*Math.PI,!1),this.ctx.fill(),this.ctx.closePath(),this.ctx.fillStyle=l,this.ctx.beginPath(),this.ctx.arc(i.x+i.width/2,i.y-10-u,u,0,2*Math.PI,!1),this.ctx.fill(),this.ctx.closePath()),this.ctx.fillStyle=h,e&&s[0].type===d.Z.TYPE_TEXT?(this.ctx.fillRect(i.x-4,i.y,5,i.height),this.ctx.fillRect(i.x+i.width-1,i.y,5,i.height),i.width>40&&this.ctx.fillRect(a.x-20,i.y+i.height-1,40,4),this.ctx.fillStyle=l,this.ctx.fillRect(i.x-2,i.y+1,1,i.height-2),this.ctx.fillRect(i.x+i.width+1,i.y+1,1,i.height-2),i.width>40&&this.ctx.fillRect(a.x-19,i.y+i.height+1,38,1)):(i.height>10&&(this.ctx.fillRect(i.x-u,i.y+i.height-u,c,c),this.ctx.fillRect(i.x+i.width-u,i.y-u,c,c)),this.ctx.fillRect(i.x-u,i.y-u,c,c),this.ctx.fillRect(i.x+i.width-u,i.y+i.height-u,c,c),this.ctx.fillStyle=l,i.height>10&&(this.ctx.fillRect(i.x-u+1,i.y+i.height-u+1,c-2,c-2),this.ctx.fillRect(i.x+i.width-u+1,i.y-u+1,c-2,c-2)),this.ctx.fillRect(i.x-u+1,i.y-u+1,c-2,c-2),this.ctx.fillRect(i.x+i.width-u+1,i.y+i.height-u+1,c-2,c-2))),this.ctx.setTransform(1,0,0,1,0,0)}this.guides&&this.guides.length>0&&(this.ctx.translate(.5,.5),this.guides.forEach((e=>{e.soft?this.ctx.strokeStyle=n.$n:this.ctx.strokeStyle=n.CE,this.ctx.beginPath(),this.ctx.moveTo(e.start.x,e.start.y),this.ctx.lineTo(e.end.x,e.end.y),this.ctx.stroke()})),this.ctx.setTransform(1,0,0,1,0,0))},this.isControl=(e,t)=>{if(0===e.length)return!1;let s,i,a=1===e.length,o=this.hitSize/2,h=this.hitSize;if(a&&e[0].editMode&&e[0]instanceof g.Z?(s=this.stage.getLayerLocationTrim(e[0]),i=this.stage.getLayerLocationRect(e[0]).center()):(a?s=this.stage.getLayerLocationRect(e[0]):e.forEach((e=>{let t=this.stage.getLayerLocationRect(e);t&&(s=r.Z.merge(s,t.getRotatedBounds()))})),i=s?s.center():void 0),s){if((s.width<40||s.height<40)&&(o/=2,h/=2),t=this.rotatePoint(t,i,s.rotation),a&&e[0].type===d.Z.TYPE_TEXT){if(n.aG(s.x-this.hitSize,s.y,2*this.hitSize,s.height,t.x,t.y))return this.raster.style.cursor=this.getRotatedCursor(90,s.rotation),this.method="w-resize",!0;if(n.aG(s.x+s.width-this.hitSize,s.y,2*this.hitSize,s.height,t.x,t.y))return this.raster.style.cursor=this.getRotatedCursor(270,s.rotation),this.method="e-resize",!0;if(s.width>40&&n.aG(i.x-20,s.y+s.height-3,40,10,t.x,t.y))return this.raster.style.cursor=this.getRotatedCursor(0,s.rotation),this.method="t-resize",!0}else{if(s.height>10){if(n.aG(s.x+s.width-o,s.y-o,h,h,t.x,t.y))return this.raster.style.cursor=this.getRotatedCursor(45,s.rotation),this.method="ne-resize",!0;if(n.aG(s.x-o,s.y+s.height-o,h,h,t.x,t.y))return this.raster.style.cursor=this.getRotatedCursor(225,s.rotation),this.method="sw-resize",!0}if(n.aG(s.x-o,s.y-o,h,h,t.x,t.y))return this.raster.style.cursor=this.getRotatedCursor(315,s.rotation),this.method="nw-resize",!0;if(n.aG(s.x+s.width-o,s.y+s.height-o,h,h,t.x,t.y))return this.raster.style.cursor=this.getRotatedCursor(135,s.rotation),this.method="se-resize",!0}return!(!a||e[0].editMode||!n.aG(s.x+s.width/2-o,s.y-(h+8),h,h,t.x,t.y))&&(this.raster.style.cursor="grab",this.method="rotate",!0)}},this.getRotatedCursor=(e,t)=>{let s=e+t;s<0&&(s+=360),s>360&&(s-=360),s+=22.5;let i=7;for(;i>0&&!(s>45*i&&s<360);)i--;return["n","ne","e","se","s","sw","w","nw"][i]+"-resize"},this.checkReformGuides=e=>{var t,s;if(this.guides=[],c.ZP.showGuides||c.ZP.snapToGuides){const i=this.stage.fresco.getSelectedStack(),a=5/this.stage.zoom,n=c.ZP.snapToGuides,o=c.ZP.showGuides;let h=1===i.length&&i[0].editMode&&i[0].trim;const d=h?i[0].rect:new r.Z(0,0,this.stage.fresco.width,this.stage.fresco.height),u=h?360-i[0].rect.rotation:0,p=d.center(),g=h?this.rotatePoint(e,p,1===i.length?i[0].rect.rotation:0):e;if(!h){const s=this.stage.fresco.getNotSelectedStack();for(let i=0;i<s.length;i++){const r=s[i].rect;if(r&&0===r.rotation&&s[i].settings.visible){if(this.willSnap(g.x,r.x,a)&&(n&&(e.x=r.x),o)){const e="ne-resize"===this.method||"se-resize"===this.method||"e-resize"===this.method;this.addGuide(new l.Z(r.x,r.y),new l.Z(r.x,r.bottom()),void 0,0,!0,new l.Z(e?0:-1,-1),new l.Z(e?0:-1,0))}if(this.willSnap(g.x,r.right(),a)&&(n&&(e.x=r.right()),o)){const e="nw-resize"===this.method||"sw-resize"===this.method||"w-resize"===this.method;this.addGuide(new l.Z(r.right(),r.y),new l.Z(r.right(),r.bottom()),void 0,0,!0,new l.Z(e?-1:0,-1),new l.Z(e?-1:0,0))}if(null!==(t=!this.constrain)&&void 0!==t?t:this.isShiftDown){if(this.willSnap(g.y,r.y,a)&&(n&&(e.y=r.y),o)){const e="sw-resize"===this.method||"se-resize"===this.method;this.addGuide(new l.Z(r.x,r.y),new l.Z(r.right(),r.y),void 0,0,!0,new l.Z(-1,e?0:-1),new l.Z(0,e?0:-1))}if(this.willSnap(g.y,r.bottom(),a)&&(n&&(e.y=r.bottom()),o)){const e="ne-resize"===this.method||"nw-resize"===this.method;this.addGuide(new l.Z(r.x,r.bottom()),new l.Z(r.right(),r.bottom()),void 0,0,!0,new l.Z(-1,e?-1:0),new l.Z(0,e?-1:0))}}}}}this.willSnap(g.x,d.x,a)&&(n&&(e.x=h?this.rotatePoint(new l.Z(d.x,g.y),p,u).x:d.x),o&&this.addGuide(new l.Z(d.x,d.y),new l.Z(d.x,d.bottom()),p,u,!1,new l.Z(-1,-1),new l.Z(-1,0))),this.willSnap(g.x,d.right(),a)&&(n&&(e.x=h?this.rotatePoint(new l.Z(d.right(),g.y),p,u).x:d.right()),o&&this.addGuide(new l.Z(d.right(),d.y),new l.Z(d.right(),d.bottom()),p,u,!1,new l.Z(0,-1))),(null!==(s=!this.constrain)&&void 0!==s?s:this.isShiftDown)&&(this.willSnap(g.y,d.top(),a)&&(n&&(e.y=h?this.rotatePoint(new l.Z(g.x,d.top()),p,u).y:d.top()),o&&this.addGuide(new l.Z(d.x,d.y),new l.Z(d.right(),d.y),p,u,!1,new l.Z(-1,-1),new l.Z(0,-1))),this.willSnap(g.y,d.bottom(),a)&&(n&&(e.y=h?this.rotatePoint(new l.Z(g.x,d.bottom()),p,u).y:d.bottom()),o&&this.addGuide(new l.Z(d.x,d.bottom()),new l.Z(d.right(),d.bottom()),p,u,!1,new l.Z(-1))))}return e},this.checkMoveGuides=()=>{if(this.guides=[],c.ZP.showGuides||c.ZP.snapToGuides){const e=this.stage.fresco.getSelectedStack(),t=this.stage.fresco.getNotSelectedStack(),s=5/this.stage.zoom,i=c.ZP.snapToGuides,a=c.ZP.showGuides;let n,o,h;if(1===e.length&&e[0].editMode?(n=e[0].getGlobalTrim(),o=e[0].rect,h=360-o.rotation):(o=new r.Z(0,0,this.stage.fresco.width,this.stage.fresco.height),e.forEach((e=>{e.rect&&(n=r.Z.merge(n,e.rect.getRotatedBounds()))}))),!n)return;let d=new l.Z(0,0);const u=n.center(),p=20/this.stage.zoom;for(let r=0;r<t.length;r++){const e=t[r].rect;if(e&&0===e.rotation&&t[r].settings.visible){const t=e.center();if(this.willSnap(n.x,e.x,s)&&(d.x=n.x-e.x,a)){const s=(e.y<n.y?e.y:n.y)-p,i=(e.y+e.height>n.y+n.height?e.y+e.height:n.y+n.height)+p;this.addGuide(new l.Z(e.x,s),new l.Z(e.x,i),t,h,!0,new l.Z(-1),new l.Z(-1))}if(this.willSnap(n.x,e.x+e.width,s)&&(d.x=n.x-(e.x+e.width),a)){const s=(e.y<n.y?e.y:n.y)-p,i=(e.y+e.height>n.y+n.height?e.y+e.height:n.y+n.height)+p;this.addGuide(new l.Z(e.x+e.width,s),new l.Z(e.x+e.width,i),t,h,!0,new l.Z(-1),new l.Z(-1))}if(this.willSnap(n.x+n.width,e.x,s)&&(d.x=n.x+n.width-e.x,a)){const s=(e.y<n.y?e.y:n.y)-p,i=(e.y+e.height>n.y+n.height?e.y+e.height:n.y+n.height)+p;this.addGuide(new l.Z(e.x,s),new l.Z(e.x,i),t,h,!0)}if(this.willSnap(n.x+n.width,e.x+e.width,s)&&(d.x=n.x+n.width-(e.x+e.width),a)){const s=(e.y<n.y?e.y:n.y)-p,i=(e.y+e.height>n.y+n.height?e.y+e.height:n.y+n.height)+p;this.addGuide(new l.Z(e.x+e.width,s),new l.Z(e.x+e.width,i),t,h,!0)}if(this.willSnap(n.y,e.y,s)&&(d.y=n.y-e.y,a)){const s=(e.x<n.x?e.x:n.x)-p,i=(e.x+e.width>n.x+n.width?e.x+e.width:n.x+n.width)+p;this.addGuide(new l.Z(s,e.y),new l.Z(i,e.y),t,h,!0,new l.Z(0,-1),new l.Z(0,-1))}if(this.willSnap(n.y,e.y+e.height,s)&&(d.y=n.y-(e.y+e.height),a)){const s=(e.x<n.x?e.x:n.x)-p,i=(e.x+e.width>n.x+n.width?e.x+e.width:n.x+n.width)+p;this.addGuide(new l.Z(s,e.y+e.height),new l.Z(i,e.y+e.height),t,h,!0,new l.Z(0,-1),new l.Z(0,-1))}if(this.willSnap(n.y+n.height,e.y,s)&&(d.y=n.y+n.height-e.y,a)){const s=(e.x<n.x?e.x:n.x)-p,i=(e.x+e.width>n.x+n.width?e.x+e.width:n.x+n.width)+p;this.addGuide(new l.Z(s,e.y),new l.Z(i,e.y),t,h,!0)}if(this.willSnap(n.y+n.height,e.y+e.height,s)&&(d.y=n.y+n.height-(e.y+e.height),a)){const s=(e.x<n.x?e.x:n.x)-p,i=(e.x+e.width>n.x+n.width?e.x+e.width:n.x+n.width)+p;this.addGuide(new l.Z(s,e.y+e.height),new l.Z(i,e.y+e.height),t,h,!0)}if(this.willSnap(u.x,t.x,s)&&(d.x=n.x-Math.round(t.x-n.width/2),a)){const s=(e.y<n.y?e.y:n.y)-p,i=(e.y+e.height>n.y+n.height?e.y+e.height:n.y+n.height)+p;this.addGuide(new l.Z(Math.floor(t.x),s),new l.Z(Math.floor(t.x),i),t,h,!0)}if(this.willSnap(u.y,t.y,s)&&(d.y=n.y-Math.round(t.y-n.height/2),a)){const s=(e.x<n.x?e.x:n.x)-p,i=(e.x+e.width>n.x+n.width?e.x+e.width:n.x+n.width)+p;this.addGuide(new l.Z(s,Math.floor(t.y)),new l.Z(i,Math.floor(t.y)),t,h,!0)}}}const g=o.center();this.willSnap(u.x,g.x,s)&&(d.x=n.x-Math.round(g.x-n.width/2),a&&this.addGuide(new l.Z(Math.floor(g.x),o.y),new l.Z(Math.floor(g.x),o.bottom()),g,h)),this.willSnap(u.y,g.y,s)&&(d.y=n.y-Math.round(g.y-n.height/2),a&&this.addGuide(new l.Z(o.x,Math.floor(g.y)),new l.Z(o.right(),Math.floor(g.y)),g,h)),this.willSnap(n.x,o.x,s)&&(d.x=n.x-o.x,a&&this.addGuide(new l.Z(o.x,o.y),new l.Z(o.x,o.bottom()),g,h,!1,new l.Z(-1,-1),new l.Z(-1,0))),this.willSnap(n.right(),o.right(),s)&&(d.x=n.x-(o.right()-n.width),a&&this.addGuide(new l.Z(o.right(),o.y),new l.Z(o.right(),o.bottom()),g,h,!1,new l.Z(0,-1))),this.willSnap(n.y,o.y,s)&&(d.y=n.y-o.y,a&&this.addGuide(new l.Z(o.x,o.y),new l.Z(o.right(),o.y),g,h,!1,new l.Z(-1,-1),new l.Z(0,-1))),this.willSnap(n.bottom(),o.bottom(),s)&&(d.y=n.y-(o.bottom()-n.height),a&&this.addGuide(new l.Z(o.x,o.bottom()),new l.Z(o.right(),o.bottom()),g,h,!1,new l.Z(-1))),!i||0===d.x&&0===d.y||(1===e.length&&e[0].editMode?e[0].position(e[0].trim.x-d.x,e[0].trim.y-d.y):e.forEach((e=>{this.shouldReformLayer(e)&&e.position(e.rect.x-d.x,e.rect.y-d.y)})))}},this.addGuide=(e,t,s,i=0,a=!1,n,o)=>{0!==i&&(e=this.rotatePoint(e,s,i),t=this.rotatePoint(t,s,i)),e=this.stage.translateFrescoToRaster(e).add(n),t=this.stage.translateFrescoToRaster(t).add(o),this.guides.push(new h.Z(e,t,a))},this.willSnap=(e,t,s)=>e<t+s&&e>t-s,this.shouldReformLayer=e=>{if(e&&e.settings.visible&&!e.settings.locked&&e.rect){if("ARRANGE"!==this.mode&&"SIMPLE"!==this.mode){if("TEXT"===this.mode&&e.type!==d.Z.TYPE_TEXT)return;if("FRAME"===this.mode&&e.type!==d.Z.TYPE_FRAME)return;if("SHAPE"===this.mode&&e.type!==d.Z.TYPE_SHAPE)return}return!0}},this.getLayerAt=e=>{if(this.stage.fresco&&this.stage.fresco.layers.length>0)for(let t=this.stage.fresco.layers.length-1;t>=0;t--){if(!this.shouldReformLayer(this.stage.fresco.layers[t]))continue;let s,i;if(this.stage.fresco.layers[t].editMode&&this.stage.fresco.layers[t]instanceof g.Z?(s=this.stage.getLayerLocationTrim(this.stage.fresco.layers[t]),i=this.stage.getLayerLocationRect(this.stage.fresco.layers[t]).center()):(s=this.stage.getLayerLocationRect(this.stage.fresco.layers[t]),i=s?s.center():void 0),s&&s.isInside(this.rotatePoint(e,i,s.rotation)))return this.stage.fresco.layers[t]}},this.getLayersAt=e=>{const t=new Array;if(this.stage.fresco&&this.stage.fresco.layers.length>0)for(let s=this.stage.fresco.layers.length-1;s>=0;s--){if("TEXT"===this.mode&&this.stage.fresco.layers[s].type!==d.Z.TYPE_TEXT)continue;if("FRAME"===this.mode&&this.stage.fresco.layers[s].type!==d.Z.TYPE_FRAME)continue;if("SHAPE"===this.mode&&this.stage.fresco.layers[s].type!==d.Z.TYPE_SHAPE)continue;let i,a;if(this.stage.fresco.layers[s].editMode&&this.stage.fresco.layers[s]instanceof g.Z?(i=this.stage.getLayerLocationTrim(this.stage.fresco.layers[s]),a=this.stage.getLayerLocationRect(this.stage.fresco.layers[s]).center()):(i=this.stage.getLayerLocationRect(this.stage.fresco.layers[s]),a=i?i.center():void 0),i&&i.isInside(this.rotatePoint(e,a,i.rotation))&&t.push(this.stage.fresco.layers[s]),t.length>5)break}return t},this.getLayersInside=e=>{const t=new Array;if(this.stage.fresco&&this.stage.fresco.layers.length>0)for(let s=this.stage.fresco.layers.length-1;s>=0;s--){const i=this.stage.getLayerLocationRect(this.stage.fresco.layers[s]);i&&e.contains(i)&&t.push(this.stage.fresco.layers[s])}return t},this.dblClick=()=>{let e=this.stage.fresco.getSelected();if(e instanceof p.Z){if((0,i.ZP)("floating-text-input"))return;e.settings.visible=!1,this.removeListener(),this.stage.render(),this.render(),this.stage.supressRender=!0;let t=this.stage.getLayerLocationRect(e);t.y+t.height>this.raster.offsetHeight&&(t.y=this.raster.offsetHeight-t.height-20),t.y<20&&(t.y=20),t.width>this.raster.offsetWidth&&(t.width=this.raster.offsetWidth-40),t.x+t.width>this.raster.offsetWidth&&(t.x=this.raster.offsetWidth-t.width-20),t.x<20&&(t.x=20);let s=document.createElement("textarea");s.id="floating-text-input",s.style.top=t.y+this.raster.offsetTop+"px",s.style.left=t.x+this.raster.offsetLeft+"px",s.style.width=t.width+"px",s.style.color="#111";let a=e.textSettings;const o=n.uZ(Math.round(a.size*this.stage.zoom),12,100);s.style.font=a.getCssFont(o),s.style.letterSpacing=Math.floor(a.letterSpace*(o/2.2))+"px",s.style.textAlign=a.align,s.value=e.text;const r=()=>window.setTimeout((()=>{let e=s.cloneNode();e.style.visibility="false",s.parentNode.insertBefore(e,s),e.style.height="auto",e.value=s.value;let t=e.scrollTop+e.scrollHeight+16;s.offsetTop+t>(0,i.ZP)("workspace").offsetHeight-20&&(t=(0,i.ZP)("workspace").offsetHeight-20-s.offsetTop,s.style.overflowY="auto"),s.style.height=t+"px",s.parentNode.removeChild(e)}),0);s.addEventListener("input",(()=>{r()}),!0),(0,i.ZP)("workspace").appendChild(s),window.setTimeout((()=>{r(),s.focus(),s.select()}),10),document.addEventListener("mousedown",this.outsideTextClick,!0)}else e instanceof g.Z&&!e.settings.locked&&(e.canvas&&e.trim?(e.editMode=!e.editMode,window.requestAnimationFrame(this.render),document.dispatchEvent(new CustomEvent("layer-select"))):this.stage.browseFrameImage())},this.outsideTextClick=e=>{let t=(0,i.ZP)("floating-text-input");if(e.target!==t){e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault(),this.stage.supressRender=!1;let s=this.stage.fresco.getSelected();if(s instanceof p.Z){s.settings.visible=!0;let e=s.text;s.setText(t.value),this.stage.history.add({type:"textChange",layer:s,text:e})}this.addListener(),document.removeEventListener("mousedown",this.outsideTextClick,!0),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("text-change")),t.remove()}},this.cleanUp=()=>{this.proxy=void 0,this.removeListener(),this.raster.style.cursor="unset",this.matrix=void 0,this.raster=void 0,this.stage=void 0,this.ctx=void 0},this.stage=e,this.ctx=e.coating.ctx,this.raster=e.coating.raster,this.pointers=new Array,this.matrix=new u.Z,this.hitSize=this.stage.canTouch?32:16,this.downRect=[],this.guides=[],this.addListener(),this.setMode(t)}}},2758:(e,t,s)=>{s.d(t,{Z:()=>h});var i=s(3655),a=s(6817),n=s(4256),o=s(3673),r=s(7175);class h{constructor(e,t){this.setMask=e=>{this.mask=e,this.ctx=this.mask.getContext("2d"),this.createOutline()},this.isSelected=e=>{var t;return!!(null===(t=this.bounds)||void 0===t?void 0:t.isInside(e))&&this.ctx.getImageData(e.x,e.y,1,1).data[3]>=64},this.applyOffset=()=>{let e=i.dN(this.mask);this.ctx.clearRect(0,0,this.mask.width,this.mask.height),this.ctx.drawImage(e,this.offset.x,this.offset.y),this.offset.x=this.offset.y=0,this.createOutline()},this.editRectangle=(e,t,s)=>{let a=i.vL(this.mask.width,this.mask.height),n=a.getContext("2d");r.Z.fill(n,"rectangle",e.topLeft(),e.bottomRight()),n=void 0,this.drawOnMask(a,t,!1,s)},this.editEllipse=(e,t,s,a)=>{let n=i.vL(this.mask.width,this.mask.height),o=n.getContext("2d");r.Z.fill(o,"ellipse",e.topLeft(),e.bottomRight()),o=void 0,this.drawOnMask(n,t,s,a)},this.editBezier=(e,t,s,a)=>{let n=i.vL(this.mask.width,this.mask.height),o=n.getContext("2d");o.beginPath(),o.moveTo(e[0].x,e[0].y);for(let i=1;i<e.length;i+=2)i+1===e.length?o.lineTo(e[i].x,e[i].y):o.quadraticCurveTo(e[i+1].x,e[i+1].y,e[i].x,e[i].y);o.fill(),o=void 0,this.drawOnMask(n,t,s,a)},this.editPolygon=(e,t,s,a)=>{let n=i.vL(this.mask.width,this.mask.height),o=n.getContext("2d");o.beginPath(),o.moveTo(e[0].x,e[0].y),e.forEach((e=>o.lineTo(e.x,e.y))),o.fill(),o=void 0,this.drawOnMask(n,t,s,a)},this.drawOnMask=(e,t=0,s=!1,i=!1,a=new o.Z(0,0))=>{if(t>0){let s=new n.Z;s.addShader("blur",t),e=s.apply(e)}else if(s){let t=new n.Z;t.addShader("dealiasing",!0),e=t.apply(e)}this.ctx.save(),i&&(this.ctx.globalCompositeOperation="destination-out"),this.ctx.drawImage(e,a.x,a.y),this.ctx.restore(),this.createOutline()},this.selectAll=()=>{this.ctx.fillRect(0,0,this.mask.width,this.mask.height),this.createOutline()},this.invert=()=>{const e=new n.Z([]);e.addShader("alpha-invert",1),this.mask=i.dN(e.apply(this.mask)),this.ctx=this.mask.getContext("2d"),this.createOutline()},this.size=(e,t)=>{const s=i.vL(e,t);this.ctx=s.getContext("2d");const a=Math.round(.5*(s.width-this.mask.width)),n=Math.round(.5*(s.height-this.mask.height));this.ctx.drawImage(this.mask,a,n),this.mask=s,this.createOutline()},this.resize=(e,t)=>{this.mask=i.eY(this.mask,e,t),this.ctx=this.mask.getContext("2d"),this.createOutline()},this.createOutline=()=>{let e=this.ctx.getImageData(0,0,this.mask.width,this.mask.height);if(this.bounds=i.vO(e),!this.bounds)return;let t=this.bounds.top(),s=this.bounds.left(),a=this.bounds.right(),n=this.bounds.bottom(),o=this.mask.width,r=this.mask.height;this.outline=new Array;let h,l,c,d,u,p=-1;for(let i=t;i<n;++i){l=0===s||e.data[4*(i*o+s-1)+3]<64,c=e.data[4*(i*o+s)+3]<64;for(let t=s;t<a;++t)h=l,l=c,c=t+1===o||e.data[4*(i*o+t+1)+3]<64,l||(p=-1,d=i-1<0||e.data[4*((i-1)*o+t)+3]<64,u=i+1===r||e.data[4*((i+1)*o+t)+3]<64,h&&d&&c&&u?p=8:h&&d&&u?p=9:c&&d&&u?p=10:c&&d&&h?p=11:c&&u&&h?p=12:h&&c?p=13:u&&d?p=14:h&&d?p=0:d&&c?p=2:h&&u?p=5:u&&c?p=7:d?p=1:h?p=3:c?p=4:u&&(p=6),-1!==p&&this.outline.push(t,i,p))}},this.clear=()=>{this.ctx.clearRect(0,0,this.mask.width,this.mask.height),this.outline=new Array},this.reset=()=>{this.ctx.clearRect(0,0,this.mask.width,this.mask.height),this.outline=new Array,this.offset=new o.Z,this.bounds=new a.Z},this.cleanUp=()=>{this.outline=void 0,this.offset=void 0,this.bounds=void 0,this.mask=void 0,this.ctx=void 0},this.mask=i.vL(e,t),this.offset=new o.Z,this.bounds=new a.Z,this.ctx=this.mask.getContext("2d")}}},887:(e,t,s)=>{s.d(t,{Z:()=>h});var i=s(6548),a=s(8203),n=s(3655),o=s(3673),r=s(9924);class h extends a.Z{constructor(e,t){super(e,t),this.moveLock="none",this.contextMenu=e=>{e.preventDefault(),e.stopPropagation(),this.stage.coating.frozen||new r.C(new o.Z(e.clientX,e.clientY),[new r.Z((0,i.Z)("titleSelectAll"),(()=>this.stage.selectionAll()),"Ctrl + A"),new r.Z((0,i.Z)("titleSelectPixels"),(()=>this.stage.selectionPixels())),new r.Z((0,i.Z)("titleSelectDeselect"),this.stage.fresco.hasSelection()?()=>this.stage.selectionDeselect():void 0,"Ctrl + D"),new r.Z((0,i.Z)("titleSelectInvert"),this.stage.fresco.hasSelection()?()=>this.stage.selectionInvert():void 0,"Ctrl + I")])},this.pointerDown=e=>{e.stopPropagation(),this.stage.coating.override||e.button>0||(this.isDown=!0,this.addPointer(e.pointerId),1===this.pointers.length&&this.preDown(new o.Z(e.clientX-this.stage.rasterRect.x,e.clientY-this.stage.rasterRect.y),e.pointerType,e.pressure))},this.pointerMove=e=>{e.stopPropagation();let t=new o.Z(e.clientX-this.stage.raster.offsetLeft,e.clientY-this.stage.raster.offsetTop);if(e.buttons||!this.isDown||this.noGoZone)if(this.isDown)this.preMove(t);else{if(this.stage.fresco.hasSelection()){let e=this.stage.translateRasterToFresco(t);if("new"===this.mode&&this.stage.fresco.selection.isSelected(e))return void(this.stage.raster.style.cursor="move")}this.stage.raster.style.cursor="crosshair"}else this.pointerUp(e)},this.pointerUp=e=>{e.stopPropagation(),this.preUp(new o.Z(e.clientX-this.stage.raster.offsetLeft,e.clientY-this.stage.raster.offsetTop))},this.setHistory=()=>{var e,t,s;this.snapshot=n.dN(null===(s=null===(t=null===(e=this.stage)||void 0===e?void 0:e.fresco)||void 0===t?void 0:t.selection)||void 0===s?void 0:s.mask)},this.addHistory=(e=this.name)=>{this.stage.history.add({type:"selectionChange",kind:e,selection:this.snapshot}),this.snapshot=void 0},this.addMoveListeners=()=>{this.stage.raster.addEventListener("pointerup",this.pointerUp,!1)},this.removeMoveListeners=()=>{this.stage.raster.removeEventListener("pointerup",this.pointerUp,!1)},this.superClean=()=>{this.removeDownListeners(),this.stage.raster.removeEventListener("pointermove",this.pointerMove,!1),this.stage.raster.removeEventListener("contextmenu",this.contextMenu,!0)},this.addDownListeners(),this.stage.raster.addEventListener("pointermove",this.pointerMove,!1),this.stage.raster.addEventListener("contextmenu",this.contextMenu,!0),this.stage.raster.style.cursor="crosshair"}preDown(e,t,s){if(this.isDown=!0,this.isMoving=!1,this.downPoint=e,this.stage.fresco.hasSelection()){let t=this.stage.translateRasterToFresco(e);this.isMoving="new"===this.mode&&this.stage.fresco.selection.isSelected(t)}this.isMoving?(this.setHistory(),this.stage.coating.freeze(!0),this.addMoveListeners()):this.down(e,t,s)}preMove(e,t,s){if(this.isMoving){if(this.isShiftDown&&"none"===this.moveLock){const t=Math.abs(this.downPoint.x-e.x),s=Math.abs(this.downPoint.y-e.y);(t>4||s>4)&&(t<s?(e.x=this.downPoint.x,this.moveLock="vertical"):(e.y=this.downPoint.y,this.moveLock="horizontal"))}this.isShiftDown||(this.moveLock="none"),"vertical"!==this.moveLock&&(this.stage.fresco.selection.offset.x=Math.round((e.x-this.downPoint.x)/this.stage.zoom)),"horizontal"!==this.moveLock&&(this.stage.fresco.selection.offset.y=Math.round((e.y-this.downPoint.y)/this.stage.zoom)),window.requestAnimationFrame((()=>this.stage.coating.render()))}else this.move(e,t,s)}preUp(e){this.isMoving?(this.isDown=!1,this.isMoving=!1,this.moveLock="none",this.stage.coating.freeze(!1),this.removeMoveListeners(),0===this.stage.fresco.selection.offset.x&&0===this.stage.fresco.selection.offset.y||(this.stage.fresco.selection.applyOffset(),this.addHistory("move"))):this.up(e)}}},9389:(e,t,s)=>{s.d(t,{Z:()=>i});class i{constructor(e,t,s=1){this.highlight=e,this.shadow=t,this.amount=s}static fillPaletteMap(e,t){for(let s=0;s<256;++s){let i=s/255;t.data[4*s]=Math.round(e.highlight.r*i+e.shadow.r*(1-i)),t.data[4*s+1]=Math.round(e.highlight.g*i+e.shadow.g*(1-i)),t.data[4*s+2]=Math.round(e.highlight.b*i+e.shadow.b*(1-i))}}}},8203:(e,t,s)=>{s.d(t,{Z:()=>a});var i=s(3673);class a{constructor(e,t){this.addPointer=e=>{this.pointers.push(e),this.stage.raster.setPointerCapture(e)},this.removePointer=e=>{for(let t=0;t<this.pointers.length;t++)if(this.pointers[t]===e.pointerId){this.pointers.splice(t,1);break}this.stage.raster.releasePointerCapture(e.pointerId)},this.pointerDown=e=>{e.stopPropagation(),this.stage.coating.override||e.button>0||(this.isDown=!0,this.addPointer(e.pointerId),1===this.pointers.length&&this.down(new i.Z(e.clientX-this.stage.rasterRect.x,e.clientY-this.stage.rasterRect.y),e.pointerType,e.pressure))},this.pointerMove=e=>{e.stopPropagation(),this.pointers.length<2&&this.move(new i.Z(e.clientX-this.stage.rasterRect.x,e.clientY-this.stage.rasterRect.y),e.pointerType,e.pressure)},this.pointerUp=e=>{e.stopPropagation(),this.isDown=!1,this.up(new i.Z(e.clientX-this.stage.rasterRect.x,e.clientY-this.stage.rasterRect.y))},this.dblClick=e=>{e.stopPropagation(),this.dbl(new i.Z(e.clientX-this.stage.rasterRect.x,e.clientY-this.stage.rasterRect.y))},this.addDownListeners=()=>{this.stage.raster.addEventListener("pointerdown",this.pointerDown,!1),this.stage.raster.addEventListener("pointerup",this.removePointer,!1)},this.removeDownListeners=()=>{this.stage.raster.removeEventListener("pointerdown",this.pointerDown,!1),this.stage.raster.removeEventListener("pointerup",this.removePointer,!1)},this.addMoveListeners=()=>{this.stage.raster.addEventListener("pointermove",this.pointerMove,!1),this.stage.raster.addEventListener("pointerup",this.pointerUp,!1)},this.removeMoveListeners=()=>{this.stage.raster.removeEventListener("pointermove",this.pointerMove,!1),this.stage.raster.removeEventListener("pointerup",this.pointerUp,!1)},this.down=(e,t,s)=>{},this.move=(e,t,s)=>{},this.dbl=e=>{},this.up=e=>{},this.apply=()=>{},this.cancel=()=>{},this.cleanUp=()=>{},this.name=e,this.stage=t,this.pointers=new Array}}},8776:(e,t,s)=>{s.d(t,{Z:()=>n});var i=s(3655);class a{constructor(e,t,s){this.h=e,this.s=t,this.b=s}toColor(){let e,t,s,i,a,o,r,h;if(0==this.b)e=0,t=0,s=0;else if(0==this.s)e=t=s=this.b;else switch(i=this.h/60,a=i-Math.floor(i),o=this.b*(1-this.s),h=this.b*(1-this.s*a),r=this.b*(1-this.s*(1-a)),Math.floor(i)){case 0:case 6:e=this.b,t=r,s=o;break;case 1:e=h,t=this.b,s=o;break;case 2:e=o,t=this.b,s=r;break;case 3:e=o,t=h,s=this.b;break;case 4:e=r,t=o,s=this.b;break;case 5:e=this.b,t=o,s=h}return new n(Math.round(255*e),Math.round(255*t),Math.round(255*s))}toHEX(){const e=this.toColor(),t=e=>{const t=e.toString(16);return 1===t.length?"0"+t:t};return`#${t(e.r)}${t(e.g)}${t(e.b)}`}}class n{constructor(e=255,t=255,s=255,n=255){this.isEqual=e=>!!e&&(this.r===e.r&&this.g===e.g&&this.b===e.b&&this.a===e.a),this.toHEX=()=>{const e=e=>{const t=e.toString(16);return 1===t.length?"0"+t:t};return`#${e(this.r)}${e(this.g)}${e(this.b)}`},this.toHEXA=()=>{const e=e=>{const t=e.toString(16);return 1===t.length?"0"+t:t};return`#${e(this.r)}${e(this.g)}${e(this.b)}${e(this.a)}`},this.toRGBA=(e=this.a)=>`rgba(${this.r},${this.g},${this.b},${e/255})`,this.toHSB=()=>{let e,t,s,i=Math.min(this.r,this.g,this.b),n=Math.max(this.r,this.g,this.b);s=n/255;let o=n-i;return o?(t=o/n,e=this.r==n?(this.g-this.b)/o*60:this.g==n?60*(2+(this.b-this.r)/o):60*(4+(this.r-this.g)/o),e>360?e-=360:e<0&&(e+=360)):e=t=0,new a(e,t,s)},this.r=i.uZ(e,0,255),this.g=i.uZ(t,0,255),this.b=i.uZ(s,0,255),this.a=i.uZ(n,0,255)}rotateHue(e){let t,s,i,a=Math.min(this.r,this.g,this.b),o=Math.max(this.r,this.g,this.b);t=o/255;var r=o-a;return r?(s=r/o,i=this.r==o?(this.g-this.b)/r*60:this.g==o?60*(2+(this.b-this.r)/r):60*(4+(this.r-this.g)/r)):i=s=0,i+=e,i>360?i-=360:i<0&&(i+=360),360===i&&(i=0),n.fromHSB(i,s,t)}static fromRGB(e){if(/^#[0-9A-F]{6}$/i.test(e))return n.fromHEX(e);let t=e.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);return!t||t.length<4?new n:new n(Number(t[1]),Number(t[2]),Number(t[3]))}static fromHEXA(e){let t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return!t||t.length<4?new n:new n(parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16),parseInt(t[4],16))}static fromHEX(e,t=255){let s=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return!s||s.length<3?new n:new n(parseInt(s[1],16),parseInt(s[2],16),parseInt(s[3],16),t)}static fromHSB(e,t,s){let i,a,o,r,h,l,c,d;if(0==s)i=0,a=0,o=0;else if(0==t)i=a=o=s;else switch(r=e/60,h=r-Math.floor(r),l=s*(1-t),d=s*(1-t*h),c=s*(1-t*(1-h)),Math.floor(r)){case 0:case 6:i=s,a=c,o=l;break;case 1:i=d,a=s,o=l;break;case 2:i=l,a=s,o=c;break;case 3:i=l,a=d,o=s;break;case 4:i=c,a=l,o=s;break;case 5:i=s,a=l,o=d}return new n(Math.round(255*i),Math.round(255*a),Math.round(255*o))}clone(){return new n(this.r,this.g,this.b,this.a)}}},2542:(e,t,s)=>{s.d(t,{Z:()=>i});class i{static rotation(e){return new Promise(((t,s)=>{const i=new FileReader;i.onload=e=>{e.target||t(0);const s=e.target,i=new DataView(s.result);65496!==i.getUint16(0,!1)&&t(0);const a=i.byteLength;let n=2;for(;n<a;){i.getUint16(n+2,!1)<=8&&t(0);const e=i.getUint16(n,!1);if(n+=2,65505===e){1165519206!==i.getUint32(n+=2,!1)&&t(0);const e=18761===i.getUint16(n+=6,!1);n+=i.getUint32(n+4,e);const s=i.getUint16(n,e);n+=2;for(let a=0;a<s;a++)if(274===i.getUint16(n+12*a,e)){switch(i.getUint16(n+12*a+8,e)){case 8:t(-90);break;case 6:t(90);break;case 3:t(180);break;default:t(0)}return}}else{if(65280!=(65280&e))break;n+=i.getUint16(n,!1)}}t(0)},i.readAsArrayBuffer(e)}))}}},9591:(e,t,s)=>{s.d(t,{Z:()=>o});var i=s(8776),a=s(7359),n=s(9067);class o{constructor(e){this.value=e,this.getType=()=>this.value instanceof i.Z?"color":this.value instanceof a.ZP?"gradient":this.value instanceof n.Z?"pattern":void 0,this.getStringValue=()=>this.value instanceof i.Z?this.value.toHEX():this.value instanceof a.ZP||this.value instanceof n.Z?this.value.toJSON():void 0,this.getCssValue=()=>this.value instanceof i.Z?this.value.toHEX():this.value instanceof a.ZP||this.value instanceof n.Z?this.value.toCSS():void 0,this.addToCanvas=e=>{this.value instanceof i.Z?e.fillStyle=this.value.toHEX():this.value instanceof a.ZP?e.fillStyle=this.value.createCanvasGradient(e):this.value instanceof n.Z&&(e.fillStyle=this.value.createCanvasPattern(e))}}}o.fromString=async(e,t)=>{let s;return"color"===e&&/^#[0-9A-F]{6}$/i.test(t)?s=new o(i.Z.fromHEX(t)):"gradient"===e?s=new o(a.ZP.fromJSON(t)):"pattern"===e&&(s=new o(await n.Z.fromJSON(t))),s}},7359:(e,t,s)=>{s.d(t,{Rt:()=>n,ZP:()=>r});var i=s(3655),a=s(8776);class n{constructor(e,t,s=135,i="linear"){this.colors=e,this.positions=t,this.direction=s,this.type=i,this.toCSS=()=>{let e="linear-gradient("+this.direction+"deg";for(let t=0;t<this.colors.length;++t)e+=", "+a.Z.fromHEXA(this.colors[t]).toRGBA()+" "+(100*this.positions[t]).toFixed(0)+"%";return e+=")",e}}}class o{constructor(e,t,s){this.id=e,this.color=t,this.position=s}}class r{constructor(){this.direction=0,this.type="linear",this.addStop=(e,t)=>{t=i.uZ(t,0,1);const s=new o(i.Zd(),e,t);return this.stops.push(s),this.sort(),s},this.removeStop=e=>{const t=this.stops.findIndex((t=>t.id===e));return-1!==t&&this.stops.splice(t,1),this.sort(),this.stops[0].id},this.getStop=e=>{let t;return this.stops.forEach((s=>{s.id===e&&(t=s)})),t},this.sort=()=>{this.stops.sort(((e,t)=>e.position-t.position))},this.toCSS=()=>{let e="linear-gradient(to right";for(let t=0;t<this.stops.length;++t)e+=", "+this.stops[t].color.toRGBA()+" "+(100*this.stops[t].position).toFixed(0)+"%";return e+=")",e},this.toJSON=()=>JSON.stringify(this.toIGradient()),this.toIGradient=()=>{let e=new Array;return this.stops.forEach((t=>{e.push({id:t.id,color:t.color.toHEXA(),position:t.position})})),{type:this.type,direction:this.direction,stops:e}},this.createCanvasGradient=e=>{let t;if("linear"===this.type){const s=(this.direction-90)*Math.PI/180,i=e.canvas.width,a=e.canvas.height,n=Math.sqrt(i*i+a*a)/2,o=Math.asin(a/2/n);let r=(s%(2*Math.PI)+4*Math.PI)%(2*Math.PI);r>Math.PI&&(r-=Math.PI),r>Math.PI/2&&r<=Math.PI&&(r=Math.PI/2-(r-Math.PI/2));let h=Math.PI/2-o-Math.abs(r),l=Math.abs(o-Math.abs(r)),c=Math.max(Math.cos(l)*i,Math.cos(h)*a)/2,d=Math.cos(s)*c,u=Math.sin(s)*c;t=e.createLinearGradient(i/2+d,a/2+u,i/2-d,a/2-u)}else{let s=e.canvas.width/2,i=e.canvas.height/2,a=Math.max(e.canvas.width,e.canvas.height)/2;t=e.createRadialGradient(s,i,0,s,i,a)}return this.addStopToCanvasGradient(t),t},this.addStopToCanvasGradient=(e,t=!1)=>{for(let s=0;s<this.stops.length;++s)e.addColorStop(this.stops[s].position,this.stops[s].color.toRGBA(t?255-this.stops[s].color.a:this.stops[s].color.a))},this.stops=new Array}static fromJSON(e){let t=JSON.parse(e);return r.fromIGradient(t)}static fromIGradient(e){const t=new r;if(t.type=e.type&&"radial"===e.type?"radial":"linear",t.direction=e.direction,e.stops)for(let s=0;s<e.stops.length;++s){let i="string"==typeof e.stops[s].color?a.Z.fromHEXA(e.stops[s].color):new a.Z(e.stops[s].color.r,e.stops[s].color.g,e.stops[s].color.b,e.stops[s].color.a);t.addStop(i,e.stops[s].position)}return t}static fromPreset(e){const t=new r;for(let s=0;s<e.colors.length;++s)t.addStop(a.Z.fromHEXA(e.colors[s]),e.positions[s]);return t.direction=e.direction+180,t.type=e.type,t}static fromColors(e,t){const s=new r;return s.addStop(e,0),s.addStop(t,1),s}}},3646:(e,t,s)=>{s.d(t,{Z:()=>i});class i{constructor(e,t,s=!1){this.start=e,this.end=t,this.soft=s}}},1726:(e,t,s)=>{s.d(t,{Z:()=>a});var i=s(3673);class a{constructor(e=1,t=0,s=0,i=1,n=0,o=0){this.a=e,this.b=t,this.c=s,this.d=i,this.e=n,this.f=o,this.reset=()=>{this.a=this.d=1,this.b=this.c=this.e=this.f=0},this.translate=e=>{this.transform(1,0,0,1,e.x,e.y)},this.rotate=e=>{let t=Math.cos(e),s=Math.sin(e);this.transform(t,s,-s,t,0,0)},this.rotateDegree=function(e){this.rotate(.017453292519943295*e)},this.transform=(e,t,s,i,a,n)=>{const o=this.a,r=this.b,h=this.c,l=this.d,c=this.e,d=this.f;this.a=o*e+h*t,this.b=r*e+l*t,this.c=o*s+h*i,this.d=r*s+l*i,this.e=o*a+h*n+c,this.f=r*a+l*n+d},this.invert=()=>{let e=this.a,t=this.b,s=this.c,i=this.d,n=this.e,o=this.f,r=(new a,e*i-t*s);this.a=i/r,this.b=-t/r,this.c=-s/r,this.d=e/r,this.e=(s*o-i*n)/r,this.f=-(e*o-t*n)/r}}transformPoint(e){return new i.Z(e.x*this.a+e.y*this.c+this.e,e.x*this.b+e.y*this.d+this.f)}}},9067:(e,t,s)=>{s.d(t,{Z:()=>n});var i=s(3655),a=s(5574);class n{constructor(e,t=1,s=0){this.svg=e,this.scale=t,this.direction=s,this.createCanvasPattern=e=>{let t;if(1!=this.scale){let s=i.vL(Math.round(this.image.width*this.scale),Math.round(this.image.height*this.scale));s.getContext("2d").drawImage(this.image,0,0,s.width,s.height),t=e.createPattern(s,"repeat")}else t=e.createPattern(this.image,"repeat");return 0!==this.direction&&t.setTransform((new DOMMatrix).rotate(this.direction)),t},this.toCSS=()=>"url(data:image/svg+xml;base64,"+btoa(this.svg)+")",this.toJSON=()=>JSON.stringify(this.toIPattern())}toIPattern(e=this.svg){return{svg:e,scale:this.scale,direction:this.direction}}}n.fromIPattern=async e=>{let t=new n(e.svg,e.scale,e.direction),s=new Blob([t.svg],{type:"image/svg+xml"});return t.image=await(0,a.s4)(s),t},n.fromJSON=async e=>{let t=JSON.parse(e);return n.fromIPattern(t)}},3673:(e,t,s)=>{s.d(t,{Z:()=>i});class i{constructor(e=0,t=0){this.x=e,this.y=t}distanceTo(e){return Math.sqrt(Math.pow(this.x-e.x,2)+Math.pow(this.y-e.y,2))}angleTo(e){let t=-(this.x-e.x),s=this.y-e.y,i=360-Math.atan2(s,t)*(180/Math.PI);return i<0&&(i+=360),i>360&&(i-=360),i}dot(e){return this.x*e.x+this.y*e.y}lengthSQ(){return this.dot(this)}length(){return Math.sqrt(this.lengthSQ())}hypot2(){return this.dot(this)}hypot(){return Math.hypot(this.x,this.y)}add(e){return e?e instanceof i?new i(this.x+e.x,this.y+e.y):new i(this.x+e,this.y+e):this}neg(e){return e instanceof i?new i(this.x-e.x,this.y-e.y):new i(this.x-e,this.y-e)}mul(e){return e instanceof i?new i(this.x*e.x,this.y*e.y):new i(this.x*e,this.y*e)}rotateAround(e,t){let s=Math.sin(t),a=Math.cos(t),n=this.x-e.x,o=this.y-e.y,r=n*s+o*a;return new i(n*a-o*s+e.x,r+e.y)}equalTo(e){return this.x===e.x&&this.y===e.y}clone(){return new i(this.x,this.y)}}},6817:(e,t,s)=>{s.d(t,{Z:()=>o});var i=s(1726),a=s(3673),n=s(9872);class o{constructor(e=0,t=0,s=0,i=0,a=0){this.x=e,this.y=t,this.width=s,this.height=i,this.rotation=a}left(){return this.x}right(){return this.x+this.width}top(){return this.y}bottom(){return this.y+this.height}size(){return new n.Z(this.width,this.height)}center(){return new a.Z(this.x+this.width/2,this.y+this.height/2)}topLeft(){return new a.Z(this.x,this.y)}topRight(){return new a.Z(this.right(),this.y)}bottomLeft(){return new a.Z(this.x,this.bottom())}bottomRight(){return new a.Z(this.right(),this.bottom())}setTop(e){this.height=this.y+this.height-e,this.y=e}setLeft(e){this.width=this.x+this.width-e,this.x=e}setRight(e){this.width=Math.round(e-this.x)}setBottom(e){this.height=Math.round(e-this.y)}setCenter(e){this.x=e.x-.5*this.width,this.y=e.y-.5*this.height}setCenterX(e){this.x=e-.5*this.width}setCenterY(e){this.y=e-.5*this.height}moveRight(e){this.x=Math.round(e-this.width)}moveBottom(e){this.y=Math.round(e-this.height)}isSet(){return this.x>0||this.y>0||this.width>0||this.height>0||this.rotation>0}isInside(e){return e.x>=this.x&&e.x<this.x+this.width&&e.y>=this.y&&e.y<this.y+this.height}contains(e){return e.x>=this.x&&e.y>=this.y&&e.bottom()<=this.bottom()&&e.right()<=this.right()}equalTo(e){return!!e&&(this.x===e.x&&this.y===e.y&&this.width===e.width&&this.height===e.height&&this.rotation===e.rotation)}clone(){return new o(this.x,this.y,this.width,this.height,this.rotation)}scale(e){return new o(Math.round(this.x*e),Math.round(this.y*e),Math.round(this.width*e),Math.round(this.height*e),this.rotation)}flipWidthAndHeight(){return new o(this.y,this.x,this.height,this.width)}union(e){if(!e)return this;const t=Math.min(this.x,e.x),s=Math.min(this.y,e.y),i=Math.max(this.x+this.width,e.x+e.width),a=Math.max(this.y+this.height,e.y+e.height);return new o(t,s,i-t,a-s)}intersect(e){let t=Math.max(this.x,e.x),s=Math.min(this.x+this.width,e.x+e.width);if(s<=t)return;let i=Math.max(this.y,e.y),a=Math.min(this.y+this.height,e.y+e.height);return a<=i?void 0:new o(t,i,s-t,a-i)}rebase(e,t){return new o(Math.round(this.x-e),Math.round(this.y-t),Math.round(this.width),Math.round(this.height))}gridAlign(){return new o(Math.floor(this.x),Math.floor(this.y),Math.ceil(this.width),Math.ceil(this.height))}getRotatedBounds(){if(0===this.rotation)return this;let e=new i.Z,t=this.center();e.translate(t),e.rotate(this.rotation*Math.PI/180),e.invert();const s=e.transformPoint(this.topLeft()),a=e.transformPoint(this.topRight()),n=e.transformPoint(this.bottomLeft()),r=e.transformPoint(this.bottomRight());let h=o.fromPoints([s,a,n,r]);return h.x=Math.round(h.x+t.x),h.y=Math.round(h.y+t.y),h.rotation=this.rotation,h}rotatedSize(e){const t=this.width,s=this.height,i=(e,t)=>{var s=e[0].x,i=e[0].y,n=e[1].x,o=e[1].y,r=t[0].x,h=t[0].y,l=t[1].x,c=t[1].y;return new a.Z(((s*o-i*n)*(r-l)-(s-n)*(r*c-h*l))/((s-n)*(h-c)-(i-o)*(r-l)),((s*o-i*n)*(h-c)-(i-o)*(r*c-h*l))/((s-n)*(h-c)-(i-o)*(r-l)))};let o,r,h,l,c,d,u;var p=e*(Math.PI/180),g=[new a.Z(0,0),new a.Z(t,0),new a.Z(t,s),new a.Z(0,s)],m=((e,t)=>{for(var s=new Array,i=0;i<e.length;++i)s.push(new a.Z(e[i].x*Math.cos(t)-e[i].y*Math.sin(t),e[i].x*Math.sin(t)+e[i].y*Math.cos(t)));return s})(g=((e,t,s)=>{for(var i=new Array,n=0;n<e.length;++n)i.push(new a.Z(e[n].x+t,e[n].y+s));return i})(g,-t/2,-s/2),p);return e>=0?(o=[new a.Z(0,0),new a.Z(-t/2,-s/2)],h=[m[0],m[3]],d=i(o,h),r=[new a.Z(0,0),new a.Z(t/2,-s/2)],l=[m[0],m[1]],u=i(r,l)):(o=[new a.Z(0,0),new a.Z(t/2,-s/2)],h=[m[1],m[2]],u=i(o,h),r=[new a.Z(0,0),new a.Z(-t/2,-s/2)],l=[m[0],m[1]],d=i(r,l)),c=new a.Z(Math.max(d.x,-u.x),Math.max(d.y,u.y)),new n.Z(Math.round(-c.x-c.x),Math.round(-c.y-c.y))}pad(e){return new o(this.x-e,this.y-e,this.width+2*e,this.height+2*e)}getAspect(){return this.width/this.height}getComparedScale(e){if(e)return new n.Z(this.width/e.width,this.height/e.height)}static calculate(e,t,s=0){if(!e||!t)return;let i=new o;return i.x=Math.round(e.x<t.x?e.x:t.x),i.y=Math.round(e.y<t.y?e.y:t.y),i.width=Math.round(e.x<t.x?t.x-i.x:e.x-i.x),i.height=0!==s?Math.round(i.width/s):Math.round(e.y<t.y?t.y-i.y:e.y-i.y),i}static merge(e,t){if(!e&&!t)return;if(e&&!t)return e;if(!e&&t)return t;const s=Math.round(Math.min(e.x,t.x)),i=Math.round(Math.min(e.y,t.y)),a=Math.round(Math.max(e.x+e.width,t.x+t.width)),n=Math.round(Math.max(e.y+e.height,t.y+t.height));return new o(s,i,a-s,n-i)}static fillFit(e,t,s,i,a=!1){let n=1;return n=e/t<s/i?s/e:i/t,a&&n>1&&(n=1),new o(Math.round((s-e*n)/2),Math.round((i-t*n)/2),Math.round(e*n),Math.round(t*n))}static bestFit(e,t,s,i){let a=1;return a=e/t>s/i?s/e:i/t,a>1&&(a=1),new o(Math.round((s-e*a)/2),Math.round((i-t*a)/2),Math.round(e*a),Math.round(t*a))}static fromPoints(e){let t=e[0].x,s=e[0].x,i=e[0].y,a=e[0].y;return e.forEach((e=>{t=Math.min(e.x,t),s=Math.max(e.x,s),i=Math.min(e.y,i),a=Math.max(e.y,a)})),new o(Math.round(t),Math.round(i),Math.round(s-t),Math.round(a-i))}static fromPointRects(e,t,s){let i=e[0].x,a=e[0].x+t,n=e[0].y,r=e[0].y+s;return e.forEach((e=>{i=Math.min(e.x,i),a=Math.max(e.x+t,a),n=Math.min(e.y,n),r=Math.max(e.y+s,r)})),new o(i,n,a-i,r-n)}}},3347:(e,t,s)=>{s.d(t,{Z:()=>i});class i{constructor(e,t,s){this.start=e,this.stop=t,this.row=s}}},9679:(e,t,s)=>{s.d(t,{Z:()=>i});class i{constructor(e,t){this.name=e,this.value=t}}},7175:(e,t,s)=>{s.d(t,{Z:()=>a});var i=s(6817);class a{static roundRect(e,t,s,i,a,n=0){const o=Math.min(i/2,a/2,n);e.beginPath(),e.moveTo(t+o,s),e.lineTo(t+i-o,s),e.quadraticCurveTo(t+i,s,t+i,s+o),e.lineTo(t+i,s+a-o),e.quadraticCurveTo(t+i,s+a,t+i-o,s+a),e.lineTo(t+o,s+a),e.quadraticCurveTo(t,s+a,t,s+a-o),e.lineTo(t,s+o),e.quadraticCurveTo(t,s,t+o,s),e.closePath()}}a.ellipse=(e,t,s)=>{let i=.5*(s.x-t.x),a=.5*(s.y-t.y),n=t.x+i,o=t.y+a,r=.01,h=r,l=2*Math.PI-r;for(e.beginPath(),e.moveTo(n+i*Math.cos(0),o+a*Math.sin(0));h<l;h+=r)e.lineTo(n+i*Math.cos(h),o+a*Math.sin(h));e.closePath()},a.triangle=(e,t,s)=>{e.beginPath(),e.moveTo(t.x,t.y),e.lineTo(s.x,s.y),e.lineTo(t.x-(s.x-t.x),s.y),e.lineTo(t.x,t.y),e.closePath()},a.star=(e,t,s)=>{let i=Math.sqrt(Math.pow(s.x-t.x,2)+Math.pow(s.y-t.y,2));e.beginPath(),e.translate(t.x,t.y),e.moveTo(0,0-i);for(var a=0;a<5;a++)e.rotate(Math.PI/5),e.lineTo(0,0-.5*i),e.rotate(Math.PI/5),e.lineTo(0,0-i);e.translate(-t.x,-t.y)},a.heart=(e,t,s)=>{let i=Math.sqrt(Math.pow(s.x-t.x,2)+Math.pow(s.y-t.y,2)),a=.8*i;e.save(),e.translate(t.x,t.y-i/2),e.rotate(45*Math.PI/180),e.beginPath(),e.moveTo(0,0),e.bezierCurveTo(-a,0,-a,i,0,i),e.lineTo(i,i),e.lineTo(i,0),e.bezierCurveTo(i,-a,0,-a,0,0),e.closePath(),e.restore()},a.rectangle=(e,t,s,i,a)=>{e.beginPath(),e.moveTo(t,s),e.lineTo(t+i,s),e.lineTo(t+i,s+a),e.lineTo(t,s+a),e.lineTo(t,s),e.closePath()},a.line=(e,t,s)=>{e.beginPath(),e.moveTo(t.x,t.y),e.lineTo(s.x,s.y)},a.bezier=(e,t,s,i)=>{e.beginPath(),e.moveTo(t.x,t.y),e.quadraticCurveTo(i.x,i.y,s.x,s.y)},a.arc=(e,t,s)=>{e.beginPath(),e.arc(t.x,t.y,s,0,2*Math.PI)},a.fill=(e,t,s,n,o)=>{switch(t){case"rectangle":e.fillRect(s.x,s.y,n.x-s.x,n.y-s.y);break;case"rounded":const t=i.Z.fromPoints([s,n]);a.roundRect(e,t.x,t.y,t.width,t.height,o),e.fill();break;case"ellipse":a.ellipse(e,s,n),e.fill();break;case"triangle":a.triangle(e,s,n),e.fill();break;case"star":a.star(e,s,n),e.fill();break;case"heart":a.heart(e,s,n),e.fill();break;case"line":a.line(e,s,n),e.stroke()}},a.stroke=(e,t,s,n,o)=>{switch(t){case"rectangle":e.strokeRect(s.x,s.y,n.x-s.x,n.y-s.y);break;case"rounded":const t=i.Z.fromPoints([s,n]);a.roundRect(e,t.x,t.y,t.width,t.height,o),e.stroke();break;case"ellipse":a.ellipse(e,s,n),e.stroke();break;case"triangle":a.triangle(e,s,n),e.stroke();break;case"star":a.star(e,s,n),e.stroke();break;case"heart":a.heart(e,s,n),e.stroke();break;case"line":a.line(e,s,n),e.stroke()}}},9872:(e,t,s)=>{s.d(t,{Z:()=>i});class i{constructor(e=0,t=0){this.width=e,this.height=t}}},9064:(e,t,s)=>{s.d(t,{Z:()=>l});var i=s(3655),a=s(3947),n=s(3673),o=s(8776),r=s(1726),h=s(4820);class l{constructor(e){this.zoomor=!1,this.hypo=void 0,this.cursorPos=new n.Z(-999,-999),this.lastPos=new n.Z(-999,-999),this.ants=Array(!0,!0,!0,!0,!1,!1,!1,!1,!0,!0,!0,!1,!1,!1,!1,!0,!0,!0,!1,!1,!1,!1,!0,!0,!0,!1,!1,!1,!1,!0,!0,!0,!1,!1,!1,!1,!0,!0,!0,!0,!1,!1,!1,!0,!0,!0,!0,!1,!1,!1,!0,!0,!0,!0,!1,!1,!1,!0,!0,!0,!0,!1,!1,!1),this.hide=()=>{this.raster.style.display="none"},this.show=()=>{this.raster.style.display="block"},this.drawDropPreviewRect=(e,t)=>{this.ctx.save(),this.ctx.strokeStyle=i.TA,this.clear();const s=this.stage.rasterRect,a=this.stage.zoom,n=t.rect.width*a,o=t.rect.height*a;this.ctx.strokeRect(e.x-s.x-n/2,e.y-s.y-o/2,n,o),this.dirty=!0,this.ctx.restore()},this.setPan=(e=this.raster)=>{this.override||(this.override=!0,e.addEventListener("mousedown",this.panDown,!1),e.classList.add("grab"),this.stage.resetAnchor(),this.cursorImage&&(0,a.ZP)("cursor-image")&&this.cursorImage.remove())},this.removePan=(e=this.raster)=>{(0,a.ZP)("color-picker-quick")||(this.override=!1,e.classList.remove("grab"),e.removeEventListener("mousedown",this.panDown,!1),this.cursorImage&&((0,a.ZP)("workspace").appendChild(this.cursorImage),this.positionCursorImage()))},this.panDown=e=>{e.stopPropagation(),this.stage.resetAnchor(),this.downPoint=new n.Z(e.clientX,e.clientY),this.downAnchor=this.stage.anchor.clone(),document.addEventListener("mousemove",this.panMove,!0),document.addEventListener("mouseup",this.panUp,!0)},this.panMove=e=>{let t=~~((e.clientX-this.downPoint.x)/this.stage.zoom),s=~~((e.clientY-this.downPoint.y)/this.stage.zoom);this.stage.setAnchor(new n.Z(this.downAnchor.x-t,this.downAnchor.y-s)),this.stage.updateViewport()},this.panUp=e=>{document.removeEventListener("mousemove",this.panMove,!0),document.removeEventListener("mouseup",this.panUp,!0)},this.setPicker=(e=this.raster)=>{var t;if(this.override)return;this.override=!0,e.addEventListener("mousedown",this.pickerDown,!1),e.addEventListener("mousemove",this.pickerMove,!1),e.classList.add("crosshair");const s=this.lastPos.clone(),l=new r.Z;let c=null!==(t=(0,a.ZP)("color-picker-quick"))&&void 0!==t?t:(0,a.T)("div",{id:"color-picker-quick"});for(let i=0;i<h.ZP.oldColor.length;i++){l.reset(),l.rotateDegree(14*-i);let e=l.transformPoint(new n.Z(-100,0));e.x+=s.x+20,e.y+=s.y-46;let t=(0,a.T)("div",{className:"color-pod small floater"});t.style.backgroundColor=h.ZP.oldColor[i],t.style.left=e.x+"px",t.style.top=e.y+"px",t.addEventListener("mousemove",(e=>{this.lastPos.x=e.clientX,this.lastPos.y=e.clientY,this.pickerPreview(this.lastPos.clone()),this.preview.style.backgroundColor=e.currentTarget.style.backgroundColor})),t.addEventListener("click",(e=>{let t=o.Z.fromRGB(e.currentTarget.style.backgroundColor);this.preview.style.backgroundColor=t.toHEX(),document.dispatchEvent(new CustomEvent("set-color",{detail:t}))})),c.append(t)}(0,a.ZP)("workspace").appendChild(c),this.pickerCanvas=i.dN(document.getElementsByClassName("canvas")[0]),this.pickerCanvasCTX=this.pickerCanvas.getContext("2d"),this.preview=document.createElement("div"),this.preview.id="color-picker-preview",this.preview.style.display="none",(0,a.ZP)("workspace").appendChild(this.preview),this.cursorImage&&(0,a.ZP)("cursor-image")&&this.cursorImage.remove(),this.pickerPreview(s)},this.updateHistoryPods=()=>{var e=(0,a.ZP)("color-picker-quick").children;for(let t=0;t<e.length;t++)e[t].style.backgroundColor=h.ZP.oldColor[t]},this.pickerMove=e=>{this.lastPos.x=e.clientX,this.lastPos.y=e.clientY,this.pickerPreview(this.lastPos.clone())},this.pickerPreview=e=>{if(this.preview.style.top=e.y-50+"px",this.preview.style.left=e.x+10+"px",this.preview.style.display="block",e.x-=this.stage.canvas.offsetLeft,e.y-=this.stage.canvas.offsetTop,e.x<0||e.y<0||e.x>this.stage.canvas.width||e.y>this.stage.canvas.height)return void(this.preview.style.display="none");let t=this.pickerCanvasCTX.getImageData(e.x,e.y,1,1).data;this.preview.style.backgroundColor=new o.Z(t[0],t[1],t[2]).toHEX()},this.pickerDown=e=>{let t=new n.Z(e.clientX-this.stage.canvas.offsetLeft,e.clientY-this.stage.canvas.offsetTop);if(t.x<0||t.y<0||t.x>this.stage.canvas.width||t.y>this.stage.canvas.height)return;let s=this.pickerCanvasCTX.getImageData(t.x,t.y,1,1).data;const i=new o.Z(s[0],s[1],s[2]);this.updateColorHistory(i),this.updateHistoryPods(),document.dispatchEvent(new CustomEvent("set-color",{detail:i}))},this.updateColorHistory=e=>{let t=e.toHEX(),s=h.ZP.oldColor.findIndex((e=>e===t));s>-1?h.ZP.oldColor.splice(0,0,h.ZP.oldColor.splice(s,1)[0]):(h.ZP.oldColor.pop(),h.ZP.oldColor.unshift(t)),(0,h.Lt)("oldColor",h.ZP.oldColor)},this.removePicker=(e=this.raster)=>{var t;this.override&&(this.override=!1,e.classList.remove("crosshair"),e.removeEventListener("mousedown",this.pickerDown,!1),e.removeEventListener("mousemove",this.pickerMove,!1),this.preview.remove(),null===(t=(0,a.ZP)("color-picker-quick"))||void 0===t||t.remove(),this.cursorImage&&(this.stage.workspace.appendChild(this.cursorImage),this.positionCursorImage()),this.pickerCanvasCTX=void 0,this.pickerCanvas=void 0)},this.setCursorImage=e=>{this.cursorImage&&(0,a.ZP)("cursor-image")&&(this.cursorImage.remove(),this.cursorImage=void 0),this.raster.style.cursor=e?"none":"crosshair",e&&(this.cursorImage=e,this.cursorImage.id="cursor-image",this.stage.workspace.appendChild(this.cursorImage),this.positionCursorImage())},this.animateCursorTap=()=>{const e=(0,a.T)("div",{className:"clickEffect"});e.style.top=this.cursorPos.y+this.stage.rasterRect.y+"px",e.style.left=this.cursorPos.x+this.stage.rasterRect.x+"px",e.addEventListener("animationend",(()=>e.remove())),this.stage.workspace.appendChild(e)},this.positionCursorImage=()=>{this.cursorImage&&(this.cursorImage.style.left=this.cursorPos.x-~~(this.cursorImage.width/2)+this.raster.offsetLeft+"px",this.cursorImage.style.top=this.cursorPos.y-~~(this.cursorImage.height/2)+this.raster.offsetTop+"px")},this.removeCursorImage=()=>{this.raster.style.cursor="unset",this.cursorImage&&(this.cursorImage.remove(),this.cursorImage=void 0,this.cursorPos.x=this.cursorPos.y=-999)},this.throttle=0,this.mouseWheel=e=>{if("none"!==h.ZP.scrollMode&&(e.preventDefault(),e.stopPropagation(),this.throttle+20<Date.now())){if(this.throttle=Date.now(),this.stage.supressRender=!0,"zoom"===h.ZP.scrollMode&&!e.shiftKey||"move"===h.ZP.scrollMode&&e.shiftKey){const t=this.stage.getViewPortCenter(),s=new n.Z(e.clientX-this.stage.rasterRect.x,e.clientY-this.stage.rasterRect.y),i=this.stage.translateRasterToFresco(s);this.stage.setFluidZoom(e.deltaY<0);const a=this.stage.translateRasterToFresco(s);this.stage.setAnchor(new n.Z(t.x+(i.x-a.x),t.y+(i.y-a.y)))}else{const t=this.stage.anchor.add(new n.Z(e.deltaX,e.deltaY));this.stage.setAnchor(t)}this.stage.supressRender=!1,this.stage.updateViewport()}},this.mouseMove=e=>{this.lastPos.x=e.clientX,this.lastPos.y=e.clientY,this.cursorPos.x=e.clientX-this.stage.rasterRect.x,this.cursorPos.y=e.clientY-this.stage.rasterRect.y,this.cursorImage&&this.positionCursorImage(),document.dispatchEvent(new CustomEvent("mouse-cord",{detail:this.stage.translateRasterToFresco(this.cursorPos)}))},this.mouseLeave=e=>{this.cursorPos.x=this.cursorPos.y=-999,this.positionCursorImage(),document.dispatchEvent(new CustomEvent("mouse-cord",{detail:void 0}))},this.touchMove=e=>{if(e.targetTouches.length>1){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();let t=Math.hypot(e.targetTouches[0].pageX-e.targetTouches[1].pageX,e.targetTouches[0].pageY-e.targetTouches[1].pageY);if(void 0===this.hypo)return this.hypo=t,this.downPoint=new n.Z((e.targetTouches[0].pageX+e.targetTouches[1].pageX)/2,(e.targetTouches[0].pageY+e.targetTouches[1].pageY)/2),this.stage.resetAnchor(),void(this.downAnchor=this.stage.anchor.clone());if(this.hypo-t<-20||this.hypo-t>20)this.stage.setFluidZoom(Boolean(t>this.hypo)),this.hypo=t;else{const t=new n.Z((e.targetTouches[0].pageX+e.targetTouches[1].pageX)/2,(e.targetTouches[0].pageY+e.targetTouches[1].pageY)/2),s=this.stage.isHDPI?.5*this.stage.zoom:this.stage.zoom,i=Math.round(t.x-this.downPoint.x)/s,a=Math.round(t.y-this.downPoint.y)/s;this.stage.setAnchor(new n.Z(this.downAnchor.x-i,this.downAnchor.y-a)),this.stage.updateViewport()}}else this.lastPos.x=e.targetTouches[0].pageX,this.lastPos.y=e.targetTouches[0].pageY,this.cursorPos.x=e.targetTouches[0].pageX-this.stage.rasterRect.x,this.cursorPos.y=e.targetTouches[0].pageY-this.stage.rasterRect.y,this.cursorImage&&this.positionCursorImage(),document.dispatchEvent(new CustomEvent("mouse-cord",{detail:this.stage.translateRasterToFresco(this.cursorPos)}))},this.touchEnd=e=>{e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),this.hypo=void 0,this.downPoint=void 0,this.downAnchor=void 0,this.cursorPos.x=this.cursorPos.y=-999,this.positionCursorImage(),document.dispatchEvent(new CustomEvent("mouse-cord",{detail:void 0}))},this.freeze=(e=!0)=>{this.frozen=e,e||this.render()},this.sleep=()=>{this.sleeping=!0,this.clear(!0)},this.wake=()=>{this.sleeping=!1,this.render()},this.so=7,this.render=(e,t=!0)=>{if(t&&this.clear(),this.sleeping)return;if(window.clearTimeout(this.timer),!this.stage||!this.stage.fresco||this.stage.supressRender)return;if(!this.stage.fresco.hasSelection())return void(e&&this.ctx.putImageData(e,0,0));let s,i,a,n,o,r=this.stage.zoom,h=this.stage.fresco.selection,l=this.stage.getViewPort(),c=this.stage.offset.x>0?this.stage.offset.x:0,d=this.stage.offset.y>0?this.stage.offset.y:0;if(e||(e=this.getImageData()),r>1){var u=Math.ceil(r)-1;for(let t=0,r=0,c=h.outline.length;t<c;t+=3)if(a=h.outline[t],n=h.outline[t+1],o=h.outline[t+2],a+h.offset.x>=l.x&&a+h.offset.x<l.x+l.width&&n+h.offset.y>=l.y&&n+h.offset.y<l.y+l.height)switch(s=Math.round((a+h.offset.x)*this.stage.zoom)+this.stage.offset.x,i=Math.round((n+h.offset.y)*this.stage.zoom)+this.stage.offset.y,o){case 0:for(this.drawAnt(s,i,e),r=1;r<=u;++r)this.drawAnt(s+r,i,e),this.drawAnt(s,i+r,e);break;case 1:for(r=0;r<=u;++r)this.drawAnt(s+r,i,e);break;case 2:for(s+=u,this.drawAnt(s,i,e),r=1;r<=u;++r)this.drawAnt(s-r,i,e),this.drawAnt(s,i+r,e);break;case 3:for(r=0;r<=u;++r)this.drawAnt(s,i+r,e);break;case 4:for(s+=u,r=0;r<=u;++r)this.drawAnt(s,i+r,e);break;case 5:for(i+=u,this.drawAnt(s,i,e),r=1;r<=u;++r)this.drawAnt(s,i-r,e),this.drawAnt(s+r,i,e);break;case 6:for(i+=u,r=0;r<=u;++r)this.drawAnt(s+r,i,e);break;case 7:for(s+=u,i+=u,this.drawAnt(s,i,e),r=1;r<=u;++r)this.drawAnt(s,i-r,e),this.drawAnt(s-r,i,e);break;case 8:for(this.drawAnt(s,i,e),this.drawAnt(s+u,i+u,e),r=1;r<=u;++r)this.drawAnt(s+r,i,e),this.drawAnt(s,i+r,e),this.drawAnt(s+u,i-r+u,e),this.drawAnt(s-r+u,i+u,e);break;case 9:for(this.drawAnt(s,i,e),r=1;r<=u;++r)this.drawAnt(s+r,i,e),this.drawAnt(s,i+r,e),this.drawAnt(s+r,i+u,e);break;case 10:for(s+=u,i+=u,this.drawAnt(s,i,e),r=1;r<=u;++r)this.drawAnt(s+r-u,i-u,e),this.drawAnt(s,i-r,e),this.drawAnt(s-r,i,e);break;case 11:for(r=0;r<=u;++r)this.drawAnt(s+r,i,e),this.drawAnt(s,i+r,e),this.drawAnt(s+u,i+r,e);break;case 12:for(r=0;r<=u;++r)this.drawAnt(s+r,i+u,e),this.drawAnt(s,i+r,e),this.drawAnt(s+u,i+r,e);break;case 13:for(r=0;r<=u;++r)this.drawAnt(s,i+r,e),this.drawAnt(s+u,i+r,e);break;case 14:for(r=0;r<=u;++r)this.drawAnt(s+r,i,e),this.drawAnt(s+r,i+u,e)}}else for(let p=0,g=h.outline.length;p<g;p+=3)a=h.outline[p],n=h.outline[p+1],o=h.outline[p+2],s=Math.round((a+h.offset.x-l.x)*r)+c,i=Math.round((n+h.offset.y-l.y)*r)+d,this.drawAnt(s,i,e);this.ctx.putImageData(e,0,0),this.dirty=!0,this.frozen||(this.timer=window.setTimeout((()=>{--this.so<0&&(this.so=7),this.frozen||this.render()}),400))},this.drawAnt=(e,t,s)=>{if(t=~~t,(e=~~e)>=0&&t>=0&&e<this.raster.width&&t<this.raster.height){let i=4*(t*this.raster.width+e);this.ants[(e+this.so)%8*8+t%8]?(s.data[i]=0,s.data[i+1]=0,s.data[i+2]=0,s.data[i+3]=255):(s.data[i]=255,s.data[i+1]=255,s.data[i+2]=255,s.data[i+3]=255)}},this.clear=(e=!1)=>{(e||this.dirty)&&(this.ctx&&this.ctx.clearRect(0,0,this.raster.width,this.raster.height),this.dirty=!1)},this.stage=e,this.raster=e.raster,this.ctx=this.raster.getContext("2d"),this.ctx.imageSmoothingEnabled=!1,this.raster.addEventListener("mousemove",this.mouseMove,!0),this.raster.addEventListener("mouseout",this.mouseLeave,!0),this.raster.addEventListener("touchmove",this.touchMove,{passive:!1}),this.raster.addEventListener("touchend",this.touchEnd,{passive:!1}),this.raster.addEventListener("wheel",this.mouseWheel,{passive:!1}),this.raster.addEventListener("contextmenu",(e=>{e.preventDefault()}),!1),"e"===h.ZP.product&&document.addEventListener("viewport-render",(()=>window.requestAnimationFrame((()=>this.render()))),!1)}getImageData(){return this.ctx.getImageData(0,0,this.raster.width,this.raster.height)}drawAntPolygon(e){this.clear(),e.length>0&&(this.ctx.save(),this.ctx.translate(.5,.5),this.ctx.strokeStyle="#ffffff",this.ctx.beginPath(),this.ctx.moveTo(e[0].x,e[0].y),e.forEach((e=>{this.ctx.lineTo(e.x,e.y)})),this.ctx.stroke(),this.ctx.strokeStyle="#000000",this.ctx.setLineDash([5,5]),this.ctx.beginPath(),this.ctx.moveTo(e[0].x,e[0].y),e.forEach((e=>{this.ctx.lineTo(e.x,e.y)})),this.ctx.stroke(),this.ctx.restore(),this.dirty=!0),this.render(void 0,!1)}drawAntBezier(e){if(this.clear(),e.length>0){this.ctx.save(),this.ctx.translate(.5,.5),this.ctx.strokeStyle="#ffffff",this.ctx.beginPath(),this.ctx.moveTo(e[0].x,e[0].y);for(let t=1;t<e.length;t+=2)t+1===e.length?this.ctx.lineTo(e[t].x,e[t].y):this.ctx.quadraticCurveTo(e[t+1].x,e[t+1].y,e[t].x,e[t].y);this.ctx.stroke(),this.ctx.strokeStyle="#000000",this.ctx.setLineDash([5,5]),this.ctx.beginPath(),this.ctx.moveTo(e[0].x,e[0].y);for(let t=1;t<e.length;t+=2)t+1===e.length?this.ctx.lineTo(e[t].x,e[t].y):this.ctx.quadraticCurveTo(e[t+1].x,e[t+1].y,e[t].x,e[t].y);this.ctx.stroke(),this.ctx.restore(),this.dirty=!0}this.render(void 0,!1)}drawAntRectangle(e){this.clear();let t=this.getImageData();for(var s=0;s<e.height;++s)this.drawAnt(e.x,e.y+s,t),this.drawAnt(e.right()-1,e.y+s,t);for(var i=0;i<e.width;++i)this.drawAnt(e.x+i,e.y,t),this.drawAnt(e.x+i,e.bottom()-1,t);this.dirty=!0,this.render(t,!1)}drawAntEllipse(e){this.clear();let t=this.getImageData();var s,i,a,n,o,r,h,l,c,d,u,p,g,m,v,f,y=e.width%2==0?1:0,w=e.height%2==0?1:0;s=.5*e.width,h=0,l=i=.5*e.height,u=(c=s*s)*(1-(i<<1))+(m=(d=i*i)<<1),p=d-(g=c<<1)*((i<<1)-1),a=3*m,n=f=d<<2,o=(v=c<<2)*(i-1),r=g*((i<<1)-3),this.drawAnt(e.x+h+s-y,e.y+l+i-w,t),this.drawAnt(e.x-h+s,e.y+l+i-w,t),this.drawAnt(e.x-h+s,e.y-l+i,t),this.drawAnt(e.x+h+s-y,e.y-l+i,t);do{u<0?(u+=a,p+=n,a+=f,n+=f,h++):p<0?(u+=a-o,a+=f,o-=v,p+=n-r,n+=f,r-=v,h++,l--):(u-=o,o-=v,p-=r,r-=v,l--),this.drawAnt(e.x+h+s-y,e.y+l+i-w,t),this.drawAnt(e.x-h+s,e.y+l+i-w,t),this.drawAnt(e.x-h+s,e.y-l+i,t),this.drawAnt(e.x+h+s-y,e.y-l+i,t)}while(l>0);this.dirty=!0,this.render(t,!1)}cleanUp(){window.clearTimeout(this.timer)}}},4699:(e,t,s)=>{s.d(t,{F:()=>w,q:()=>y});var i=s(3655),a=s(3770),n=s(5574),o=s(6817),r=s(8685),h=s(2282),l=s(1294),c=s(7108),d=s(7664),u=s(4170),p=s(7758),g=s(694),m=s(4686),v=s(7163),f=s(2396);class y{constructor(e,t,s,i,a,n,o){this.name=t,this.width=s,this.height=i,this.color=a,this.animation=o,this.templateMeta=n,this.id=e,this.lastModified=new Date,this.pinned=!1}async restore(e){const t=await(0,a.X3)();try{const[s,a]=t.transaction("readonly","layer-meta","document-selection"),[n,r]=await Promise.all([s.index("document").getAll(this.id),a.get(this.id)]);this.order||(this.order=n.sort(((e,t)=>e.order-t.order)).map((e=>e.id)));let h=[];if(this.order.forEach((e=>{const t=n.find((t=>t.id===e));t&&("bitmap"===t.type&&(t.type=u.Z.TYPE_IMAGE),t.settings.rotation&&t.rect&&void 0===t.rect.rotation&&(t.rect.rotation=t.settings.rotation),t.rect&&void 0===t.rect.rotation&&(t.rect=new o.Z(t.rect.x,t.rect.y,t.rect.width,t.rect.height,0)),h.push(t))})),h.length!==n.length){console.warn("Had layers that could not be sorted, this is a problem");const e=n.filter((e=>!this.order.includes(e.id)));h=h.concat(e)}if(r){e.fresco.addSelection();const t=e.fresco.selection;t.mask=await i.Td(r),t.ctx=t.mask.getContext("2d"),t.createOutline()}const l=await Promise.all(h.map((async e=>{const s=i.mS(w,e),[a,n]=t.transaction("readonly","layer-bitmap","layer-mask"),[o,r]=await Promise.all([a.get(s.id),n.get(s.id)]);return s.toLayer(o,r)})));l.forEach((t=>e.fresco.layers.push(t))),e.fresco.layers.length>0&&e.selectLayer(e.fresco.layers[0])}catch(s){throw console.error("Restore",s),s}}async save(){const e=await(0,a.X3)(),[t]=e.transaction("readwrite","document-meta");await t.put(this)}async remove(){const e=await(0,a.X3)(),[t,s,i,n,o,r]=e.transaction("readwrite","document-meta","document-thumbnail","document-selection","layer-meta","layer-mask","layer-bitmap"),h=[t.delete(this.id),s.delete(this.id),i.delete(this.id)],l=await n.index("document").getAll(this.id);for(let a=0;a<l.length;a++){const e=l[a];h.push(n.delete(e.id)),h.push(r.delete(e.id)),h.push(o.delete(e.id))}await Promise.all(h)}static async saveOrder(e){const t=e.layers.map((e=>e.id)),s=await(0,a.X3)(),[i]=s.transaction("readwrite","document-meta"),n=await i.get(e.id);n.order=t,await i.put(n)}static async duplicate(e){const t=await(0,a.X3)(),[s,n,o,r,h,l]=t.transaction("readwrite","document-meta","document-thumbnail","document-selection","layer-meta","layer-mask","layer-bitmap"),c=i.M8(),d=[(async()=>{const t=await n.get(e);t&&await n.add(t,c)})(),(async()=>{const t=await o.get(e);t&&await o.add(t,c)})()],u=await r.index("document").getAll(e),p={};for(let a=0;a<u.length;a++){const e=u[a],t=e.id,s=i.M8();p[t]=s,d.push((async()=>{e.id=s,e.document=c,await r.add(e)})(),(async()=>{const e=await l.get(t);e&&await l.add(e,s)})(),(async()=>{const e=await h.get(t);e&&await h.add(e,s)})())}d.push((async()=>{const t=await s.get(e);t.id=c,t.pinned=!1,t.order=t.order.map((e=>p[e])),t.lastModified=new Date,await s.add(t)})()),await Promise.all(d)}static async deleteAll(){const e=await(0,a.X3)(),[t]=e.transaction("readwrite","document-meta"),s=await t.getAll();for(let a=0;a<s.length;a++){const e=i.mS(y,s[a]);e.pinned||await e.remove()}}async getThumbnail(){const e=await(0,a.X3)(),[t]=e.transaction("readonly","document-thumbnail"),s=await t.get(this.id);return s?"string"==typeof s?(0,n.OA)(s):(0,n.s4)(s):Promise.resolve(void 0)}static async getAll(){const e=await(0,a.X3)(),[t]=e.transaction("readonly","document-meta");return(await t.getAll()).map((e=>i.mS(y,e)))}static async history(){return y.getAll().then((e=>e.sort(((e,t)=>e.lastModified===t.lastModified?0:e.lastModified<t.lastModified?1:-1))))}static async getByID(e){const t=await(0,a.X3)(),[s]=t.transaction("readonly","document-meta"),n=await s.get(e);return i.mS(y,n)}async pin(){this.pinned=!0,await this.save()}async unpin(){this.pinned=!1,await this.save()}}class w{constructor(e,t){this.order=0,this.id=e.id,this.type=e.type,this.document=t,this.settings=e.settings,this.animation=e.animation,this.rect=e.rect,this.trim=e.trim,e instanceof r.Z&&(this.textSettings=e.textSettings,this.text=e.text),e instanceof d.Z&&(this.url=e.url,this.variant=e.variant,this.scalemethod=e.scalemethod),e instanceof c.Z&&(this.shapeSettings=e.shapeSettings),e instanceof l.Z&&(this.frameSettings=e.frameSettings)}async toLayer(e,t){const s="string"==typeof e?await i.lU(e):await i.Td(e),a="string"==typeof t?await i.lU(t):await i.Td(t);switch(this.type){case u.Z.TYPE_IMAGE:{const e=new h.Z(this.id,this.settings.name,s,i.mS(o.Z,this.rect),this.settings.locked);return a&&(e.mask=a,e.render()),e.settings=this.settings,e.animation=i.mS(f.Z,this.animation),e}case u.Z.TYPE_ELEMENT:{const e=new d.Z(this.id,this.settings.name,s,this.url,this.variant,this.settings.blendmode,this.scalemethod);return e.settings=this.settings,e.rect=i.mS(o.Z,this.rect),e.animation=i.mS(f.Z,this.animation),e}case u.Z.TYPE_TEXT:{const e=new r.Z(this.id,this.text,i.mS(o.Z,this.rect),i.mS(p.Z,this.textSettings));return e.settings=this.settings,e.animation=i.mS(f.Z,this.animation),await v.Z.loadFont(this.textSettings.font),await e.prepare(),e}case u.Z.TYPE_SHAPE:{const e=new c.Z(this.id,this.settings.name,i.mS(o.Z,this.rect),i.mS(m.Z,this.shapeSettings));return e.settings=this.settings,e.animation=i.mS(f.Z,this.animation),await e.prepare(),e}case u.Z.TYPE_FRAME:{const e=new l.Z(this.id,this.settings.name,i.mS(o.Z,this.rect),i.mS(g.Z,this.frameSettings));return e.canvas=s,e.settings=this.settings,e.trim=i.mS(o.Z,this.trim),e.animation=i.mS(f.Z,this.animation),e.canvas&&e.render(),e}}}static async delete(e){const t=await(0,a.X3)();let[s,i,n]=t.transaction("readwrite","layer-bitmap","layer-meta","layer-mask");await Promise.all([s.delete(e),i.delete(e),n.delete(e)])}static async sync(e,t){if(!t.hasLayer(e))throw new Error("This is probably a bug, cant create layermeta from layer not in the fresco");const s=new w(e,t.id);let n=!1;if(e.type===u.Z.TYPE_IMAGE||e.type===u.Z.TYPE_ELEMENT?n=e.rect&&e.rect.isSet()&&!!e.canvas||!e.rect&&!e.canvas:e.type===u.Z.TYPE_FRAME&&(n=e.trim&&e.trim.isSet()&&!!e.canvas||!e.trim&&!e.canvas),n){const[t,n]=await Promise.all([i._c(e.canvas),i._c(e.mask)]),o=await(0,a.X3)();let[r,h,l]=o.transaction("readwrite","layer-bitmap","layer-meta","layer-mask");await Promise.all([h.put(s),t?r.put(t,s.id):r.delete(s.id),n?l.put(n,s.id):l.delete(s.id)])}else{const e=await(0,a.X3)();let[t]=e.transaction("readwrite","layer-meta");await t.put(s)}e.syncLatest=new Date}}},7664:(e,t,s)=>{s.d(t,{Z:()=>h});var i=s(3655),a=s(4170),n=s(6817),o=s(3673),r=s(2282);class h extends a.Z{constructor(e=i.M8(),t,s,l,c,d="",u=h.SCALE_METHOD_NONE){super(a.Z.TYPE_ELEMENT),this.id=e,this.rotateAndFit=(e,t)=>{this.settings.locked&&this.variant===h.VARIANT_OVERLAY?(this.rotate(e),this.calculate(new o.Z(0,0),new o.Z(t.width,t.height),0)):this.rect.rotation+=e?-90:90},this.calculate=(e,t,s)=>{this.rect.x=Math.round(e.x),this.rect.y=Math.round(e.y),this.rect.width=Math.round(t.x-e.x),this.rect.width<10&&(this.rect.width=10),0!==s?this.rect.height=Math.round(this.rect.width/s):(this.rect.height=Math.round(t.y-e.y),this.rect.height<10&&(this.rect.height=10))},this.rasterize=()=>{const e=new r.Z(i.M8(),this.settings.name,i.dN(this.canvas),this.rect.clone(),this.settings.locked);return e.settings=Object.assign({},this.settings),e.applyTransform(),e},this.clone=(e=!1)=>{let t=new h(e?this.id:i.M8(),this.settings.name,i.dN(this.canvas),this.url,this.variant,this.settings.blendmode,this.scalemethod);return t.settings=Object.assign({},this.settings),t.rect=this.rect.clone(),e&&(t.id=this.id,t.settings.name=this.settings.name),t},this.url=l,this.canvas=s,this.variant=c,this.scalemethod=u,this.settings.name=t,this.settings.blendmode=d,this.rect=new n.Z(0,0,s.width,s.height)}}h.VARIANT_OVERLAY="overlay",h.VARIANT_STICKER="sticker",h.SCALE_METHOD_STRETCH="stretch",h.SCALE_METHOD_FILL="fill",h.SCALE_METHOD_NONE="none"},1294:(e,t,s)=>{s.d(t,{Z:()=>d});var i=s(3655),a=s(4170),n=s(6817),o=s(8776),r=s(3673),h=s(2282),l=s(694),c=s(2396);class d extends a.Z{constructor(e=i.M8(),t,s,u=new l.Z){super(a.Z.TYPE_FRAME),this.id=e,this.prepare=()=>{this.setPath()},this.calculate=(e,t,s)=>{this.editMode&&this.trim?(this.trim.x=Math.round(e.x),this.trim.y=Math.round(e.y),this.trim.width=Math.round(t.x-e.x),this.trim.height=0===s?Math.round(t.y-e.y):Math.round(this.trim.width/(this.canvas.width/this.canvas.height)),this.trim.width<10&&(this.trim.width=10),this.trim.height<10&&(this.trim.height=10)):(this.rect.x=Math.round(e.x),this.rect.y=Math.round(e.y),this.rect.width=Math.round(t.x-e.x),this.rect.height=0!==s?Math.round(this.rect.width/s):Math.round(t.y-e.y),this.rect.width<10&&(this.rect.width=10),this.rect.height<10&&(this.rect.height=10))},this.setWidth=(e,t)=>{this.rect&&(e<1&&(e=1),this.editMode&&this.trim?(this.trim.width=e,0!==t&&(this.trim.height=Math.round(this.trim.width/(this.canvas.width/this.canvas.height)))):(this.rect.width=e,0!==t&&(this.rect.height=this.rect.width*t)),this.render())},this.setHeight=(e,t)=>{this.rect&&(e<1&&(e=1),this.editMode&&this.trim?(this.trim.height=e,0!==t&&(this.trim.height=Math.round(this.trim.height/(this.canvas.height/this.canvas.width)))):(this.rect.height=e,0!==t&&(this.rect.width=this.rect.height/t)),this.render())},this.position=(e,t)=>{this.rect&&(this.editMode?(this.trim&&(void 0!==e&&(this.trim.x=e),void 0!==t&&(this.trim.y=t)),this.render()):(void 0!==e&&(this.rect.x=e),void 0!==t&&(this.rect.y=t),this.bect.x=this.rect.x-(this.bect.width-this.rect.width)/2,this.bect.y=this.rect.y-(this.bect.height-this.rect.height)/2))},this.scale=(e,t)=>{this.rect&&(this.rect.x=Math.round(this.rect.x*e),this.rect.y=Math.round(this.rect.y*t),this.rect.width=Math.round(this.rect.width*e),this.rect.height=Math.round(this.rect.height*t),this.trim&&(this.trim.x=Math.round(this.trim.x*e),this.trim.y=Math.round(this.trim.y*t),this.trim.width=Math.round(this.trim.width*e),this.trim.height=Math.round(this.trim.height*t)),this.frameSettings.outlineSize>0&&(this.frameSettings.outlineSize=Math.round(this.frameSettings.outlineSize*e)),this.frameSettings.shadow&&(this.frameSettings.shadowDistance=Math.round(100*this.frameSettings.shadowDistance*e)/100,this.frameSettings.shadowBlur=Math.round(100*this.frameSettings.shadowBlur*e)/100),this.render())},this.rotate=e=>{this.rect.rotation+=e?-90:90},this.flip=e=>{this.canvas&&(this.canvas=i.x2(this.canvas,e),this.render())},this.setPath=(e=this.frameSettings.clip,t=!1)=>{e&&(t||(this.frameSettings.clip=e),this.path2D=new Path2D(e)),this.render()},this.setOutline=(e,t,s)=>{this.frameSettings.outline=e,this.frameSettings.outlineSize=t,this.frameSettings.outlineColor=s,this.render()},this.setShadow=(e,t,s,i,a,n)=>{this.frameSettings.shadow=e,this.frameSettings.shadowBlur=t,this.frameSettings.shadowOpacity=s,this.frameSettings.shadowColor=i,this.frameSettings.shadowDistance=a,this.frameSettings.shadowDirection=n,this.render()},this.setFrameSettings=e=>{this.frameSettings=e,this.render()},this.setContent=e=>{this.canvas=e,this.fitContent()},this.trimOnResize=e=>{if(!this.trim)return;let t=this.rect.getComparedScale(e);this.trim.x=Math.round(this.trim.x*t.width),this.trim.y=Math.round(this.trim.y*t.height),this.trim.width=Math.round(this.trim.width*t.width),this.trim.height=Math.round(this.trim.height*t.height)},this.fitContent=()=>{this.canvas?this.trim=n.Z.fillFit(this.canvas.width,this.canvas.height,this.rect.width,this.rect.height):this.trim=void 0,this.render()},this.getGlobalTrim=()=>{if(this.trim)return new n.Z(this.rect.x+this.trim.x,this.rect.y+this.trim.y,this.trim.width,this.trim.height,this.rect.rotation)},this.update=()=>{if(this.bect=this.rect.clone(),this.frameSettings.shadow){let e=100*this.frameSettings.shadowBlur;e+=Math.abs(100*this.frameSettings.shadowDistance),this.bect.width+=2*e,this.bect.height+=2*e,this.bect.x-=e,this.bect.y-=e}},this.render=()=>{this.update();const e=this.baked.getContext("2d");if(this.baked.width!==this.bect.width||this.baked.height!==this.bect.height?(this.baked.height=this.bect.height,this.baked.width=this.bect.width):e.clearRect(0,0,this.baked.width,this.baked.height),this.canvas){const t=new Path2D;let s=e.lineWidth=this.frameSettings.outline?Math.round(100*this.frameSettings.outlineSize):0;t.addPath(this.path2D,(new DOMMatrix).scale((this.rect.width-s)/100,(this.rect.height-s)/100)),e.save(),e.translate(this.rect.x-this.bect.x+s/2,this.rect.y-this.bect.y+s/2),this.frameSettings.outline?(e.strokeStyle=this.frameSettings.outlineColor,e.lineWidth=s,this.frameSettings.shadow&&this.shadowContext(e),e.fill(t),e.stroke(t)):this.frameSettings.shadow&&(this.shadowContext(e),e.fill(t)),e.shadowBlur=e.shadowOffsetX=e.shadowOffsetY=0,e.clip(t),e.imageSmoothingEnabled=!0,e.imageSmoothingQuality="high",e.drawImage(this.canvas,this.trim.x-s/2,this.trim.y-s/2,this.trim.width,this.trim.height),e.restore()}else{const t=new Path2D;let s=e.lineWidth=this.frameSettings.outline?Math.round(100*this.frameSettings.outlineSize):2;t.addPath(this.path2D,(new DOMMatrix).scale((this.rect.width-s)/100,(this.rect.height-s)/100)),e.save(),e.translate(this.rect.x-this.bect.x+s/2,this.rect.y-this.bect.y+s/2),this.frameSettings.outline?e.strokeStyle=this.frameSettings.outlineColor:e.strokeStyle="#ccc",e.fillStyle="rgba(0, 0, 0, 0.3)",this.frameSettings.shadow&&this.shadowContext(e),e.fill(t),e.stroke(t),e.restore();const i=new r.Z(Math.round(this.bect.width/2),Math.round(this.bect.height/2));let a=20;e.lineWidth=8,this.rect.width>500&&this.rect.height>500&&(e.lineWidth=16,a=40),e.save(),e.strokeStyle="rgba(255, 255, 255, 0.5)",e.beginPath(),e.moveTo(i.x-a,i.y),e.lineTo(i.x+a,i.y),e.moveTo(i.x,i.y-a),e.lineTo(i.x,i.y+a),e.closePath(),e.stroke(),e.restore()}},this.shadowContext=e=>{const t=o.Z.fromHEX(this.frameSettings.shadowColor,Math.round(255*this.frameSettings.shadowOpacity)).toRGBA();var s=(this.frameSettings.shadowDirection-90)*Math.PI/180,i=Math.cos(s)*this.frameSettings.shadowDistance,a=Math.sin(s)*this.frameSettings.shadowDistance;e.fillStyle=t,e.shadowColor=t,e.shadowBlur=100*this.frameSettings.shadowBlur,e.shadowOffsetX=100*i,e.shadowOffsetY=100*a},this.replaceCanvas=e=>{const t=this.canvas.getContext("2d");t.save(),t.globalCompositeOperation="copy",t.drawImage(e,0,0),t.restore()},this.switchCanvas=(e,t)=>{this.canvas=e,this.trim=t.clone(),this.render()},this.rasterize=()=>{let e=this.baked?this.baked:this.canvas,t=this.bect?this.bect.clone():this.rect.clone();const s=new h.Z(i.M8(),this.settings.name,e,t,this.settings.locked);return s.settings=Object.assign({},this.settings),s.applyTransform(),s},this.clone=(e=!1)=>{var t;let s=new d(e?this.id:i.M8(),this.settings.name,this.rect.clone(),this.frameSettings.clone());return s.settings=Object.assign({},this.settings),s.animation=c.Z.clone(this.animation),s.trim=null===(t=this.trim)||void 0===t?void 0:t.clone(),s.canvas=i.dN(this.canvas),s.render(),e&&(s.id=this.id,s.settings.name=this.settings.name),s},this.rect=s,this.settings.name=t,this.frameSettings=u,this.baked=i.vL(s.width,s.height),this.prepare()}}},694:(e,t,s)=>{s.d(t,{Z:()=>i});class i{constructor(){this.clip="M 0,0 H 100 V 100 H 0 Z",this.outline=!1,this.outlineColor="#555555",this.outlineSize=.3,this.shadow=!1,this.shadowBlur=.3,this.shadowOpacity=.8,this.shadowColor="#000000",this.shadowDistance=.3,this.shadowDirection=180}clone(){const e=Object.create(i.prototype);return Object.assign(e,this)}equalTo(e){return!!e&&(this.clip===e.clip&&this.outline===e.outline&&this.outlineSize===e.outlineSize&&this.outlineColor===e.outlineColor&&this.shadow===e.shadow&&this.shadowBlur===e.shadowBlur&&this.shadowColor===e.shadowColor&&this.shadowOpacity===e.shadowOpacity&&this.shadowDistance===e.shadowDistance&&this.shadowDirection===e.shadowDirection)}}},8027:(e,t,s)=>{s.d(t,{Z:()=>h});var i=s(4170),a=s(6817),n=s(1294),o=s(9198),r=s(2758);class h{constructor(e,t,s,o,r,h,l){this.block=!1,this.layerAddedCounterForUserEase=0,this.savedTimesCounterForUserEase=0,this.setBlock=(e=!1)=>{this.block=e||Boolean(!!this.templateMeta&&this.templateMeta.locked)},this.unblock=()=>{this.block=!1,this.templateMeta&&(this.templateMeta.locked=!1)},this.getSelected=()=>1!==this.selected.length?void 0:this.selected[0],this.getSelectedStack=()=>this.selected,this.getNotSelectedStack=()=>this.layers.filter((e=>!this.selected.includes(e))),this.getSelectedStackRect=()=>{let e=new Array;return this.selected.forEach((t=>{e.push(t.rect?t.rect.clone():void 0)})),e},this.getSelectedStackBounds=(e=this.selected)=>{let t;return 1===e.length?t=e[0].editMode&&e[0]instanceof n.Z?e[0].trim.clone():e[0].rect?e[0].rect.clone():void 0:e.forEach((e=>{e.rect&&(t=a.Z.merge(t,e.rect.getRotatedBounds()))})),t},this.getSelectedId=()=>{let e=new Array;return this.selected.forEach((t=>{e.push(t.id)})),e},this.getSelectedStackId=()=>{if(0===this.selected.length)return;if(1===this.selected.length)return this.selected[0].id;let e=this.getSelectedId().join(),t=0;for(let s=0;s<e.length;s++)t=(t<<5)-t+e.charCodeAt(s),t&=t;return t.toString()},this.getLayerById=e=>{let t;return this.layers.forEach((s=>{s.id===e&&(t=s)})),t},this.hasSelected=()=>this.selected.length>0,this.isSelectedStack=()=>this.selected.length>1,this.isSelectedType=e=>1===this.selected.length&&this.selected[0].type===e,this.isSelectedImageWithCanvas=()=>(!this.selected||1===this.selected.length)&&(this.selected[0].type===i.Z.TYPE_IMAGE&&!!this.selected[0].canvas),this.isSelectedShaderbleWithCanvas=()=>(!this.selected||1===this.selected.length)&&((this.selected[0].type===i.Z.TYPE_IMAGE||this.selected[0].type===i.Z.TYPE_FRAME||this.selected[0].type===i.Z.TYPE_ELEMENT)&&!!this.selected[0].canvas),this.isSelectedById=e=>{if(e)return-1!==this.selected.findIndex((t=>t.id===e))},this.selectLayerById=(e,t=!1,s=!1)=>{this.selected[0]&&(this.selected[0].editMode=!1);let a=!1;return e?t?this.isSelectedById(e)?s&&(this.unselectLayerById(e),a=!0):(this.selected.push(this.getLayerById(e)),a=!0):this.isSelectedById(e)&&1===this.selected.length||(this.selected=[this.getLayerById(e)],a=!0):0!==this.layers.length&&this.layers[0].settings.locked&&this.layers[0].type===i.Z.TYPE_IMAGE?0===this.selected.length||1===this.selected.length&&this.selected[0]===this.layers[0]||(this.selected=[this.layers[0]],a=!0):0!==this.selected.length&&(this.selected=[],a=!0),this.selected.length>1&&this.selected.sort(((e,t)=>this.layers.indexOf(e)-this.layers.indexOf(t))),a},this.unselectLayerById=e=>{const t=this.selected.findIndex((t=>t.id===e));return-1!==t&&(this.selected.splice(t,1),!0)},this.unselectLayers=()=>{this.selected=[]},this.selectLayerStack=(e,t=!1)=>{this.selected=e},this.deleteLayerById=e=>{const t=this.layers.findIndex((t=>t.id===e));let s;return-1!==t&&(s=this.layers[t],this.layers.splice(t,1),this.unselectLayerById(e)),!this.hasSelected()&&this.layers.length>0&&(this.selected=[this.layers[t>0?t-1:0]]),s},this.id=e,this.name=t,this.width=s,this.height=o,this.color=r,this.animation=h,this.templateMeta=l,this.layers=[],this.selected=[],this.setBlock()}addScratch(){return this.scratch||(this.scratch=new o.Z),this.scratch}removeScratch(){this.scratch=void 0}hasScratch(){return!!this.scratch&&"none"!==this.scratch.renderMode}addSelection(){this.selection||(this.selection=new r.Z(this.width,this.height))}removeSelection(){this.selection&&(this.selection.cleanUp(),this.selection=void 0)}hasSelection(){return this.selection&&this.selection.bounds&&this.selection.outline&&this.selection.outline.length>0}hasAnimation(){if(this.animation)return!0;for(const e of this.layers)if(e.animation&&!e.animation.block)return!0;return!1}hasLayers(){return this.layers.length>0}hasLayer(e){return this.layerNr(e.id)>=0}numLayers(){return this.layers.length}nextAddedLayerNumber(){return this.numLayers()>this.layerAddedCounterForUserEase&&(this.layerAddedCounterForUserEase=this.numLayers()),(this.layerAddedCounterForUserEase+1).toString()}lockedBackground(){return this.layers.length>0&&this.layers[0].settings.locked&&this.layers[0].type===i.Z.TYPE_IMAGE}selectedLayerNr(){if(0===this.selected.length)return-1;if(1===this.selected.length)return this.layerNr(this.selected[0].id);let e=0;return this.selected.forEach((t=>{e=Math.max(e,this.layerNr(t.id))})),e}layerNr(e){return this.layers.findIndex((t=>t.id===e))}changeLayerOrder(e,t){this.layers.splice(t,0,this.layers.splice(e,1)[0])}rotate(e){let t=this.width;this.width=this.height,this.height=t;for(let s=0;s<this.layers.length;s++)this.layers[s].rotate(e),this.layers[s].render()}flip(e){for(let t=0;t<this.layers.length;t++)this.layers[t].type===i.Z.TYPE_IMAGE&&(this.layers[t].flip(e),this.layers[t].render())}straighten(e,t,s){if(this.lockedBackground()){let i=this.layers[0];i.rect.rotation=e,i.rect.x=-(i.rect.width-t)/2,i.rect.y=-(i.rect.height-s)/2}this.width=t,this.height=s}crop(e){this.width=e.width,this.height=e.height;for(let t=0;t<this.layers.length;t++)this.layers[t].rect&&(this.layers[t].rect.x-=e.x,this.layers[t].rect.y-=e.y,this.layers[t].render());this.selection&&this.selection.size(this.width,this.height)}resize(e,t,s){let i=e/this.width,a=t/this.height;this.width=Math.round(this.width*i),this.height=Math.round(this.height*a),this.width=e,this.height=t;for(let n=0;n<this.layers.length;n++)this.layers[n].scale(i,a,s);this.selection&&this.selection.resize(this.width,this.height)}size(e,t,s,i){let a=s?e:e-this.width,n=s?t:t-this.height;if(this.width=s?this.width+e:e,this.height=s?this.height+t:t,"TL"!=i){"CL"!=i&&"BL"!=i||(a=0),"TC"!=i&&"CC"!=i&&"BC"!=i||(a=Math.round(a/2)),"TC"!=i&&"TR"!=i||(n=0),"CL"!=i&&"CC"!=i&&"CR"!=i||(n=Math.round(n/2));for(let e=0;e<this.layers.length;e++)this.layers[e].rect&&(this.layers[e].rect.x+=a,this.layers[e].rect.y+=n,this.layers[e].render())}this.selection&&this.selection.size(this.width,this.height)}addLayer(e){this.layerAddedCounterForUserEase++;let t=this.selectedLayerNr();return t>-1?this.layers.splice(t+1,0,e):this.layers.push(e),this.selected=[e],e}replaceLayer(e){const t=this.layers.findIndex((t=>t.id===e.id));this.layers[t]=e;const s=this.selected.findIndex((t=>t.id===e.id));-1!==s&&(this.selected[s]=e)}}},2282:(e,t,s)=>{s.d(t,{Z:()=>r});var i=s(4170),a=s(3655),n=s(6817),o=s(2396);class r extends i.Z{constructor(e=a.M8(),t,s,h,l=!1){super(i.Z.TYPE_IMAGE),this.id=e,this.calculate=(e,t,s)=>{this.canvas&&(this.rect.x=Math.round(e.x),this.rect.y=Math.round(e.y),this.rect.width=Math.round(t.x-e.x),this.rect.width<10&&(this.rect.width=10),0!==s?this.rect.height=Math.round(this.rect.width/s):(this.rect.height=Math.round(t.y-e.y),this.rect.height<10&&(this.rect.height=10)))},this.scale=(e,t,s)=>{this.rect&&(this.rect.x=Math.round(this.rect.x*e),this.rect.y=Math.round(this.rect.y*t),this.rect.width=Math.round(this.rect.width*e),this.rect.height=Math.round(this.rect.height*t),this.applyTransform(s))},this.wouldApplyTransform=()=>!(!this.canvas||!this.rect)&&(0!==this.rect.rotation||this.rect.width!==this.canvas.width||this.rect.height!==this.canvas.height),this.applyStraighten=e=>{this.canvas=a.zs(this.canvas,this.rect.rotation,e),this.mask&&(this.mask=a.zs(this.mask,this.rect.rotation,e)),this.rect=e,this.render()},this.applyTransform=(e=!0)=>{if(!this.wouldApplyTransform())return!1;if(this.rect.width===this.canvas.width&&this.rect.height===this.canvas.height||(this.canvas=e?a.Ai(this.canvas,this.rect.width,this.rect.height):a.ZE(this.canvas,this.rect.width,this.rect.height),this.mask&&(this.mask=a.Ai(this.mask,this.rect.width,this.rect.height))),0!==this.rect.rotation){this.rect=this.rect.getRotatedBounds(),this.canvas=a.zs(this.canvas,this.rect.rotation,this.rect),this.mask&&(this.mask=a.zs(this.mask,this.rect.rotation,this.rect));let e=a.l(this.canvas);e.equalTo(new n.Z(0,0,this.canvas.width,this.canvas.height))||(this.canvas=a.fg(this.canvas,e),this.mask&&(this.mask=a.fg(this.mask,e)),this.rect.width=e.width,this.rect.height=e.height,this.rect.x+=e.x,this.rect.y+=e.y),this.rect.rotation=0}return this.render(),!0},this.switchCanvas=(e,t)=>{this.mask&&!this.rect.equalTo(t)&&(this.mask=a.ST(this.mask,this.rect,t)),this.canvas=e,this.rect=t.clone()},this.extendCanvas=e=>{if(!this.canvas)return this.rect=e,void(this.canvas=a.vL(e.width,e.height));let t=this.rect.union(e);this.rect.equalTo(t)||(this.canvas=a.ST(this.canvas,this.rect,t),this.mask&&(this.mask=a.ST(this.mask,this.rect,t)),this.rect=t)},this.hasMask=()=>!!this.mask,this.addMask=(e="clear")=>{if(this.mask=a.vL(this.canvas.width,this.canvas.height),"fill"===e){this.mask.getContext("2d").fillRect(0,0,this.mask.width,this.mask.height)}},this.invertMask=()=>{if(this.mask){let e=a.vL(this.mask.width,this.mask.height),t=e.getContext("2d");t.save(),t.fillRect(0,0,e.width,e.height),t.globalCompositeOperation="xor",t.drawImage(this.mask,0,0),t.restore(),this.mask=e}},this.removeMask=()=>{this.mask=void 0,this.baked=void 0},this.render=()=>{if(this.mask){if(!this.canvas)return;this.baked&&this.baked.width===this.canvas.width&&this.baked.height===this.canvas.height||(this.baked=a.vL(this.canvas.width,this.canvas.height));var e=this.baked.getContext("2d");e.save(),e.globalCompositeOperation="copy",e.drawImage(this.canvas,0,0),e.globalCompositeOperation="destination-in",e.drawImage(this.mask,0,0),e.restore(),e=void 0}},this.shrinkWrap=()=>{const e=a.l(this.canvas);if(!e)return this.canvas=void 0,this.mask=void 0,this.baked=void 0,this.rect=void 0,!0;if(!e.equalTo(this.rect)){const t=a.vL(e.width,e.height);return t.getContext("2d").drawImage(this.canvas,-e.x,-e.y),this.canvas=t,this.rect=e.rebase(-this.rect.x,-this.rect.y),this.mask&&(this.mask=a.WL(this.mask,e)),!0}return!1},this.rasterize=()=>this.clone(),this.clone=(e=!1)=>{var t;let s=new r(e?this.id:a.M8(),this.settings.name,a.dN(this.canvas),null===(t=this.rect)||void 0===t?void 0:t.clone(),!1);return s.settings=Object.assign({},this.settings),s.settings.locked=!1,s.animation=o.Z.clone(this.animation),this.baked&&(s.baked=a.dN(this.baked)),this.hasMask()&&(s.mask=a.dN(this.mask)),s},this.canvas=s,this.rect=h,this.settings.name=t,this.settings.locked=l}}},4170:(e,t,s)=>{s.d(t,{Z:()=>a});var i=s(3655);class a{constructor(e){this.settings={opacity:1,blendmode:"",locked:!1,visible:!0,name:""},this.rotate=e=>{this.canvas&&(this.canvas=i.Xj(this.canvas,e?-90:90),this.mask&&(this.mask=i.Xj(this.mask,e?-90:90)),this.rect=this.rect.flipWidthAndHeight())},this.flip=e=>{this.canvas&&(this.canvas=i.x2(this.canvas,e),this.mask&&(this.mask=i.x2(this.mask,e)))},this.setWidth=(e,t)=>{this.rect&&(e<1&&(e=1),this.rect.width=e,0!==t&&(this.rect.height=Math.round(this.rect.width/t),this.rect.height<0&&(this.rect.height=1)))},this.setHeight=(e,t)=>{this.rect&&(e<1&&(e=1),this.rect.height=e,0!==t&&(this.rect.width=Math.round(this.rect.height*t),this.rect.width<0&&(this.rect.width=1)))},this.position=(e,t)=>{this.rect&&(void 0!==e&&(this.rect.x=e),void 0!==t&&(this.rect.y=t))},this.scale=(e,t,s)=>{this.rect&&(this.rect.x=Math.round(this.rect.x*e),this.rect.y=Math.round(this.rect.y*t),this.rect.width=Math.round(this.rect.width*e),this.rect.height=Math.round(this.rect.height*t),this.rect.width<0&&(this.rect.width=1),this.rect.height<0&&(this.rect.height=1))},this.setRect=e=>{this.bect?this.bect=e:this.rect=e},this.getRect=()=>this.bect?this.bect:this.rect,this.getCanvas=()=>this.transient?this.transient:this.baked?this.baked:this.canvas,this.setAltCanvas=()=>{this.transient=i.dN(this.canvas)},this.replaceCanvas=e=>{this.canvas?this.canvas.width===e.width&&this.canvas.height===e.height||(this.canvas.width=e.width,this.canvas.height=e.height):this.canvas=i.vL(this.rect.width,this.rect.height);const t=this.canvas.getContext("2d");t.save(),t.imageSmoothingEnabled=!1,t.globalCompositeOperation="copy",t.drawImage(e,0,0),t.restore()},this.extendCanvas=e=>{},this.switchCanvas=(e,t)=>{},this.render=()=>{},this.calculate=(e,t,s)=>{},this.rasterize=()=>{},this.clone=(e=!1)=>{},this.id=i.M8(),this.type=e}}a.TYPE_SCRATCH="scratch",a.TYPE_ELEMENT="element",a.TYPE_IMAGE="image",a.TYPE_SHAPE="shape",a.TYPE_FRAME="frame",a.TYPE_TEXT="text"},9198:(e,t,s)=>{s.d(t,{Z:()=>o});var i=s(3655),a=s(4170),n=s(3673);class o extends a.Z{constructor(){super(a.Z.TYPE_SCRATCH),this.renderMode="none",this.setRenderMode=e=>{this.renderMode=e},this.calculate=(e,t,s)=>{this.canvas&&(this.rect.x=Math.round(e.x),this.rect.y=Math.round(e.y),this.rect.width=Math.round(t.x-e.x),this.rect.width<10&&(this.rect.width=10),0!==s?this.rect.height=Math.round(this.rect.width/s):(this.rect.height=Math.round(t.y-e.y),this.rect.height<10&&(this.rect.height=10)))},this.clear=e=>{e?i.lI(this.canvas,e,new n.Z(0,0)):this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.baked&&this.btx.clearRect(0,0,this.baked.width,this.baked.height)},this.addBake=()=>{this.baked=i.dN(this.canvas),this.btx=this.baked.getContext("2d"),this.btx.imageSmoothingEnabled=!1},this.getCanvas=()=>this.baked?this.baked:this.canvas,this.applySelection=e=>{if(e.fresco.hasSelection()){let t=this.baked?this.btx:this.ctx;t.save(),this.baked&&(t.globalCompositeOperation="copy",t.drawImage(this.canvas,0,0)),t.globalCompositeOperation="destination-in",t.drawImage(e.fresco.selection.mask,-this.rect.x,-this.rect.y),t.restore()}},this.drawCanvas=(e,t="source-over",s=1)=>{e&&(this.ctx.save(),this.ctx.save(),this.ctx.globalAlpha=s,this.ctx.globalCompositeOperation=t,this.ctx.drawImage(e,0,0,e.width,e.height),this.ctx.restore())},this.drawToLayer=(e,t="source-over",s=1)=>{if(e&&e.canvas&&e.rect)if(e.type===a.Z.TYPE_FRAME){this.canvas.width===e.canvas.width&&this.canvas.height===e.canvas.height||(e.canvas.width=this.canvas.width,e.canvas.height=this.canvas.height);const t=e.canvas.getContext("2d");t.imageSmoothingEnabled=!1,t.clearRect(0,0,e.canvas.width,e.canvas.height),t.drawImage(this.canvas,0,0)}else{const i=e.canvas.getContext("2d");i.save(),i.globalAlpha=s,i.imageSmoothingEnabled=!1,i.globalCompositeOperation=t,i.drawImage(this.baked?this.baked:this.canvas,Math.round(this.rect.x-e.rect.x),Math.round(this.rect.y-e.rect.y),this.rect.width,this.rect.height),i.restore()}}}setTarget(e,t,s,a){this.id=e,this.rect=t.clone(),this.renderMode=s,this.canvas=a?i.dN(a):i.vL(t.width,t.height),this.ctx=this.canvas.getContext("2d"),this.ctx.imageSmoothingEnabled=!1}}},7108:(e,t,s)=>{s.d(t,{Z:()=>p});var i=s(3655),a=s(4170),n=s(9591),o=s(6817),r=s(8776),h=s(3673),l=s(7175),c=s(2282),d=s(5574),u=s(2396);class p extends a.Z{constructor(e=i.M8(),t,s,g){super(a.Z.TYPE_SHAPE),this.id=e,this.prepare=async()=>{if("svg"===this.shapeSettings.variant&&!this.image){let e=new Blob([this.shapeSettings.content],{type:"image/svg+xml"});this.image=await(0,d.s4)(e),this.rect||(this.rect=new o.Z(0,0,this.image.width,this.image.height))}"path"===this.shapeSettings.variant&&(this.path2D=new Path2D(this.shapeSettings.content)),this.shapeSettings.fillType&&(this.fill=await n.Z.fromString(this.shapeSettings.fillType,this.shapeSettings.fillValue),document.dispatchEvent(new CustomEvent("layer-select"))),"line"===this.shapeSettings.variant&&this.shapeSettings.outlineSize!==this.rect.height&&(this.rect.height=this.shapeSettings.outlineSize),this.canvas||(this.canvas=i.vL(this.rect.width,this.rect.height)),this.render()},this.setVariant=e=>{switch(e){case"rounded":this.shapeSettings.variant="rounded";break;case"rectangle":this.shapeSettings.variant="rectangle";break;case"ellipse":this.shapeSettings.variant="ellipse";break;case"line":this.shapeSettings.variant="line"}this.render()},this.setPath=(e,t=!1)=>{t||(this.shapeSettings.content=e),this.shapeSettings.variant="path",this.path2D=new Path2D(e),this.render()},this.setFill=(e,t=!1)=>{this.fill=e,t||(this.shapeSettings.fillType=e.getType(),this.shapeSettings.fillValue=e.getStringValue()),this.render()},this.setOutline=(e,t)=>{this.shapeSettings.outlineSize=e,this.shapeSettings.outlineColor=t,"line"===this.shapeSettings.variant&&(this.rect.height=0===e?1:e),this.render()},this.setShadow=(e,t,s,i,a,n)=>{this.shapeSettings.shadow=e,this.shapeSettings.shadowBlur=t,this.shapeSettings.shadowOpacity=s,this.shapeSettings.shadowColor=i,this.shapeSettings.shadowDistance=a,this.shapeSettings.shadowDirection=n,this.render()},this.setRadii=e=>{this.shapeSettings.radii=e,this.render()},this.render=(e=!1)=>{if(!this.canvas)return;const t=this.canvas.getContext("2d");if(this.canvas.width!==this.rect.width||this.canvas.height!==this.rect.height?(this.canvas.height=this.rect.height,this.canvas.width=this.rect.width):t.clearRect(0,0,this.canvas.width,this.canvas.height),"svg"===this.shapeSettings.variant)return t.imageSmoothingEnabled=!0,t.imageSmoothingQuality="high",void t.drawImage(this.image,0,0,this.rect.width,this.rect.height);if("line"===this.shapeSettings.variant)t.fillStyle=this.shapeSettings.outlineColor,t.fillRect(0,0,this.rect.width,this.rect.height);else{t.save();let e,s=2*this.shapeSettings.outlineSize,i=this.shapeSettings.outlineSize,a=this.rect.width-s,n=this.rect.height-s,o=i>0,r=!(!this.fill||!this.fill.value);switch(t.lineWidth=s,t.strokeStyle=this.shapeSettings.outlineColor,this.shapeSettings.variant){case"path":e=new Path2D,e.addPath(this.path2D,(new DOMMatrix).scale(a/100,n/100)),t.translate(i,i);break;case"rounded":l.Z.roundRect(t,i,i,a,n,this.shapeSettings.radii);break;case"rectangle":l.Z.rectangle(t,i,i,a,n);break;case"ellipse":l.Z.ellipse(t,new h.Z(i,i),new h.Z(i+a,i+n))}o&&e?t.stroke(e):o&&t.stroke(),r?this.fill.addToCanvas(t):(t.fillStyle="#ffffff",t.globalCompositeOperation="destination-out"),e?t.fill(e):t.fill(),t.restore()}if(this.shapeSettings.shadow&&!e){this.baked||(this.baked=document.createElement("canvas"));var s=100*this.shapeSettings.shadowBlur;s+=Math.abs(100*this.shapeSettings.shadowDistance),this.bect=new o.Z(this.rect.x-s,this.rect.y-s,this.rect.width+2*s,this.rect.height+2*s,this.rect.rotation),this.baked.width=this.bect.width,this.baked.height=this.bect.height;let e=this.baked.getContext("2d");var i=(this.shapeSettings.shadowDirection-90)*Math.PI/180,a=Math.cos(i)*this.shapeSettings.shadowDistance,n=Math.sin(i)*this.shapeSettings.shadowDistance;e.save(),e.shadowColor=r.Z.fromHEX(this.shapeSettings.shadowColor,Math.round(255*this.shapeSettings.shadowOpacity)).toRGBA(),e.shadowBlur=100*this.shapeSettings.shadowBlur,e.shadowOffsetX=100*a,e.shadowOffsetY=100*n,e.drawImage(this.canvas,s,s),e.restore()}else this.baked=void 0,this.bect=void 0},this.calculate=(e,t,s)=>{"line"===this.shapeSettings.variant?(this.rect.x=Math.round(e.x),this.rect.width=Math.round(t.x-e.x)):(this.rect.x=Math.round(e.x),this.rect.y=Math.round(e.y),this.rect.width=Math.round(t.x-e.x),this.rect.width<2&&(this.rect.width=2),0!==s?this.rect.height=Math.round(this.rect.width/s):(this.rect.height=Math.round(t.y-e.y),this.rect.height<2&&(this.rect.height=2)))},this.position=(e,t)=>{this.rect&&(void 0!==e&&(this.rect.x=e),void 0!==t&&(this.rect.y=t),this.bect&&(this.bect.x=this.rect.x-(this.bect.width-this.rect.width)/2,this.bect.y=this.rect.y-(this.bect.height-this.rect.height)/2))},this.scale=(e,t)=>{this.rect&&(this.rect.x=Math.round(this.rect.x*e),this.rect.y=Math.round(this.rect.y*t),this.rect.width=Math.round(this.rect.width*e),this.rect.height=Math.round(this.rect.height*t),this.rect.width<0&&(this.rect.width=1),this.rect.height<0&&(this.rect.height=1),this.shapeSettings.outlineSize>0&&(this.shapeSettings.outlineSize=Math.round(this.shapeSettings.outlineSize*e)),this.shapeSettings.shadow&&(this.shapeSettings.shadowDistance=Math.round(100*this.shapeSettings.shadowDistance*e)/100,this.shapeSettings.shadowBlur=Math.round(100*this.shapeSettings.shadowBlur*e)/100),this.render())},this.rotate=e=>{this.rect.rotation+=e?-90:90},this.rasterize=()=>{let e=this.baked?this.baked:this.canvas,t=this.bect?this.bect.clone():this.rect.clone();const s=new c.Z(i.M8(),this.settings.name,e,t,this.settings.locked);return s.settings=Object.assign({},this.settings),s.applyTransform(),s},this.clone=(e=!1)=>{let t=new p(e?this.id:i.M8(),this.settings.name,this.rect.clone(),this.shapeSettings.clone());return t.settings=Object.assign({},this.settings),t.animation=u.Z.clone(this.animation),t.prepare(),e&&(t.id=this.id),t},this.rect=s,this.settings.name=t,this.shapeSettings=g}}},4686:(e,t,s)=>{s.d(t,{Z:()=>i});class i{constructor(){this.radii=0,this.outlineSize=0,this.shadow=!1,this.shadowBlur=.3,this.shadowOpacity=.8,this.shadowColor="#000000",this.shadowDistance=.3,this.shadowDirection=180}clone(){const e=Object.create(i.prototype);return Object.assign(e,this)}equalTo(e){return!!e&&(this.variant===e.variant&&this.radii===e.radii&&this.content===e.content&&this.fillType===e.fillType&&this.fillValue===e.fillValue&&this.outlineSize===e.outlineSize&&this.outlineColor===e.outlineColor&&this.shadow===e.shadow&&this.shadowBlur===e.shadowBlur&&this.shadowColor===e.shadowColor&&this.shadowOpacity===e.shadowOpacity&&this.shadowDistance===e.shadowDistance&&this.shadowDirection===e.shadowDirection)}}},6792:(e,t,s)=>{s.d(t,{Z:()=>L});var i=s(6548),a=s(3947),n=s(3770),o=s(1030),r=s(4820),h=s(5934),l=s(8027),c=s(9064),d=s(7339),u=s(3655),p=s(9872),g=s(6817),m=s(3673),v=s(4170),f=s(4256),y=s(8685),w=s(1294),b=s(2282),x=s(7108),Z=s(7664),k=s(7758),P=s(4686),E=s(5453),S=s(4699),T=s(840);class C{constructor(e,t){this.zoom=1,this.zoomMode="fit",this.anchor=new m.Z(0,0),this.fresco=e,this.history=new E.N(e,t)}}class L{constructor(e){this.tabLimit=10,this.showTabs=!1,this.bounds=20,this.isHDPI=!1,this.canTouch=!1,this.syncDisabled=!1,this.supressRender=!1,this.zoom=1,this.zoomMode="fit",this.notify=e=>{document.dispatchEvent(new CustomEvent("notification",{detail:(0,i.Z)(e)}))},this.syncQueue=0,this.browseFrameImage=async()=>{await h.Q0(!1,!0).then((async e=>{document.dispatchEvent(new CustomEvent("loading",{detail:"start"}));for(let t=0;t<e.length;t++)await h.ZB(this,e[t],!1,"frame");document.dispatchEvent(new CustomEvent("loading",{detail:"stop"}))}))},this.setFrameContent=e=>{var t;const s=this.fresco.getSelected();let i,a;s.canvas&&(i=u.dN(s.canvas),a=null===(t=s.trim)||void 0===t?void 0:t.clone()),s.setContent(e),s.editMode=!1;const n=i?e?"replace":"delete":"add";this.history.add({type:"frameContent",kind:n,layer:s,canvas:i,trim:a}),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-list-render"))},this.fitFrameContent=()=>{var e;const t=this.fresco.getSelected();if(t instanceof w.Z){let s=null===(e=t.trim)||void 0===e?void 0:e.clone();t.fitContent(),this.history.add({type:"arrange",layer:t,kind:"fitContent",action:{type:"trim",rect:s}})}document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-list-render"))},this.addLayer=e=>{for(let t=0;t<e.length;t++)this.fresco.addLayer(e[t]),this.history.add({type:"addLayer",kind:"add"+e[t].type,layer:e[t]});this.fresco.selectLayerStack(e)},this.addCopiedLayer=async e=>{let t,s=new Array,a=new g.Z(0,0,this.fresco.width,this.fresco.height),n=this.fresco.getSelectedStackBounds(e);a.contains(n)||(t=new m.Z(Math.round((a.width-n.width)/2),Math.round((a.height-n.height)/2)));for(let o=0;o<e.length;o++){let a=e[o].clone();-1===a.settings.name.indexOf((0,i.Z)("copy"))&&(a.settings.name+=" "+(0,i.Z)("copy")),t&&(a.rect.x=a.rect.x-n.x+t.x,a.rect.y=a.rect.y-n.y+t.y),a instanceof x.Z||a instanceof y.Z||a instanceof w.Z?await a.prepare():a.render(),this.fresco.addLayer(a),this.history.add({type:"addLayer",kind:"paste"+a.type,layer:a}),s.push(a)}this.fresco.selectLayerStack(s),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render"))},this.duplicateLayer=async(e=!0)=>{let t=this.fresco.getSelectedStack();if(0===t.length)return;let s=new Array;for(let a=0;a<t.length;a++){let e=t[a].clone();-1===e.settings.name.indexOf((0,i.Z)("copy"))&&(e.settings.name+=" "+(0,i.Z)("copy")),e instanceof x.Z||e instanceof y.Z||e instanceof w.Z?await e.prepare():e.render(),this.fresco.addLayer(e),this.history.add({type:"addLayer",kind:"duplicate"+e.type,layer:e}),s.push(e)}this.fresco.selectLayerStack(s),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render")),e&&this.notify("duplicated")},this.deleteLayer=(e=!1)=>{let t=this.fresco.getSelectedStack();if(0!==t.length){if(1===t.length&&t[0]instanceof w.Z&&(e||t[0].editMode))this.setFrameContent(void 0);else{this.fresco.getSelectedId().forEach((e=>{const t=this.fresco.layerNr(e),s=this.fresco.deleteLayerById(e);this.history.add({type:"deleteLayer",layer:s,index:t})})),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render"))}this.notify("deleted")}},this.selectLayer=(e,t=!1,s=!1,i=!1)=>{this.selectLayerById(e?e.id:void 0,t,s,i)},this.selectLayerStack=(e,t=!1,s=!1)=>{this.fresco.selectLayerStack(e,t),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render"))},this.selectLayerById=(e,t=!1,s=!1,i=!1)=>{this.fresco.selectLayerById(e,t,s)&&(document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render")),i&&document.dispatchEvent(new CustomEvent("layer-marked")))},this.unselectLayerById=e=>{this.fresco.unselectLayerById(e)&&(document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render")))},this.isSelectedLayerShaderble=()=>{var e;const t=null===(e=this.fresco)||void 0===e?void 0:e.getSelected();return t&&(t.type===v.Z.TYPE_IMAGE||t.type===v.Z.TYPE_FRAME||t.type===v.Z.TYPE_ELEMENT)&&!!t.canvas},this.mergeDown=()=>{if(!this.fresco.getSelected())return;const e=this.fresco.getSelected(),t=this.fresco.layers.findIndex((t=>e.id===t.id)),s=this.fresco.layers.map((e=>e.id));if(t<1)return void this.notify("noMerger");const i=this.fresco.layers[t-1],a=e.rect?e.rect.getRotatedBounds():void 0,n=i.rect?i.rect.getRotatedBounds():void 0,o=a?a.union(n):n;let r;if(o){r=u.vL(o.width,o.height);const t=r.getContext("2d");this.renderLayer(t,i,!1,o.topLeft()),this.renderLayer(t,e,!1,o.topLeft())}const h=new b.Z(u.M8(),e.settings.name,r,o,i.settings.locked),l=this.fresco.layers.splice(t-1,2,h);this.fresco.selectLayerById(h.id),document.dispatchEvent(new CustomEvent("layer-list-render")),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render")),this.history.add({type:"merge",kind:"down",layers:l,order:s,target:h}),this.notify("layersMerged")},this.mergeVisible=()=>{const e=this.fresco.layers.findIndex((e=>e.settings.visible)),t=this.fresco.layers.map((e=>e.id));if(e<0)return void this.notify("noMerge");const s=this.fresco.layers[e];let i=this.getOutputCanvas();const a=new b.Z(u.M8(),s.settings.name,i,new g.Z(0,0,i.width,i.height),!0),n=this.fresco.layers.filter((e=>e.settings.visible));this.fresco.layers=this.fresco.layers.filter((e=>!e.settings.visible)),this.fresco.layers.splice(e,0,a),this.fresco.selectLayerById(a.id),document.dispatchEvent(new CustomEvent("layer-list-render")),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render")),this.history.add({type:"merge",kind:"visible",order:t,layers:n,target:a}),this.notify("layersMerged")},this.mergeFlatten=()=>{let e=this.getOutputCanvas();const t=new b.Z(u.M8(),(0,i.Z)("background"),e,new g.Z(0,0,e.width,e.height),!0),s=this.fresco.layers.slice(),a=this.fresco.layers.map((e=>e.id));this.fresco.layers=[t],this.fresco.selectLayerById(t.id),document.dispatchEvent(new CustomEvent("layer-list-render")),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render")),this.history.add({type:"merge",kind:"flatten",layers:s,order:a,target:t}),this.notify("imageFlattend")},this.moveUp=()=>{if(this.fresco.getSelected()){let e=this.fresco.selectedLayerNr(),t=e+1;(0!=e||!this.fresco.lockedBackground())&&t<this.fresco.numLayers()&&this.changeOrder(e,t)}},this.moveDown=()=>{if(this.fresco.getSelected()){let e=this.fresco.selectedLayerNr(),t=e-1;(t>0||!this.fresco.lockedBackground()&&1==e)&&this.changeOrder(e,t)}},this.changeOrder=(e,t)=>{this.fresco.changeLayerOrder(e,t),this.render(),this.history.add({type:"order",from:e,to:t})},this.changeVisible=(e,t)=>{if(!e)return;const s=Object.assign({},e.settings);e.settings.visible=t,this.history.add({type:"layerSettings",kind:"visible",layer:e,settings:s}),document.dispatchEvent(new CustomEvent("viewport-render"))},this.changeLocked=(e,t)=>{if(e||(e=this.fresco.getSelected()),!e)return;const s=Object.assign({},e.settings);e.settings.locked=t,this.history.add({type:"layerSettings",kind:"locked",layer:e,settings:s}),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-select"))},this.unblock=()=>{var e;this.fresco.unblock(),null===(e=(0,a.ZP)("premium-unlock-message"))||void 0===e||e.remove(),document.dispatchEvent(new CustomEvent("sync-document",{detail:this.fresco})),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-select"))},this.rasterize=()=>{let e=this.fresco.getSelectedStack();if(0===e.length)return;let t=new Array;for(let s=0;s<e.length;s++){let i=e[s];if(i instanceof b.Z||i instanceof w.Z&&!i.canvas){t.push(i);continue}const a=this.fresco.layers.findIndex((e=>e.id===i.id)),n=i.rasterize();this.fresco.layers.splice(a,1,n),this.history.add({type:"rasterize",kind:i.type,newId:n.id,layer:i}),t.push(n)}t.length>0?(this.fresco.selectLayerStack(t),this.notify("layerRasterized")):this.notify("noRasterization"),document.dispatchEvent(new CustomEvent("layer-list-render")),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render"))},this.cutLayer=()=>{let e=this.fresco.getSelectedStack();if(e.length>0){let t=new Array;e.forEach((e=>{t.push(e.clone())})),this.clipboard=t,this.clipboardSize=this.fresco.getSelectedStackBounds(t).size(),this.deleteLayer(),this.notify("cut")}},this.copyLayer=()=>{let e=this.fresco.getSelectedStack();if(e.length>0){let t=new Array;e.forEach((e=>{t.push(e.clone())})),this.clipboard=t,this.clipboardSize=this.fresco.getSelectedStackBounds(t).size(),this.notify("copy")}},this.pasteLayer=()=>{Array.isArray(this.clipboard)&&(this.addCopiedLayer(this.clipboard),this.notify("paste"))},this.cut=()=>{if(!this.fresco.hasSelection())return void this.cutLayer();let e=this.copy();return e?(this.clear("cut"),this.selectionDeselect(),e):void 0},this.copy=()=>{if(!this.fresco)return;if(!this.fresco.hasSelection()&&this.fresco.hasSelected())return void this.copyLayer();const e=this.fresco.getSelected();if(!e||!e.rect||!e.rect.isSet())return void this.notify("selectionEmpty");let t=this.fresco.selection.bounds.intersect(e.rect);if(t){let s=u.vL(t.width,t.height),i=s.getContext("2d");i.drawImage(e.baked?e.baked:e.canvas,e.rect.x-t.x,e.rect.y-t.y);const a=new m.Z(-t.x,-t.y);return i.save(),i.globalCompositeOperation="destination-in",i.drawImage(this.fresco.selection.mask,a.x,a.y),i.restore(),i=void 0,s}this.notify("selectionEmpty")},this.clear=(e="clear")=>{if(!this.fresco||!this.fresco.hasSelection())return!1;if(!this.fresco.isSelectedImageWithCanvas())return this.notify("notAImageLayer"),!1;const t=this.fresco.getSelected();let s=this.fresco.selection.bounds.intersect(t.rect);if(!s)return void this.notify("selectionEmpty");s=s.rebase(t.rect.x,t.rect.y);const i=u.$E(t.canvas,s),a=t.rect.clone();let n=t.canvas.getContext("2d");return n.save(),n.globalCompositeOperation="destination-out",n.drawImage(this.fresco.selection.mask,-t.rect.x,-t.rect.y),n.restore(),n=void 0,t.shrinkWrap(),t.render(),t.rect&&(s=s.rebase(t.rect.x-a.x,t.rect.y-a.y)),this.history.add({type:"bitmapChange",kind:e,layer:t,patchRect:s,rect:a,patch:i}),this.render(),!0},this.primeCut=(e=!0)=>{if(!this.fresco||!this.fresco.hasSelection())return[void 0,void 0];const t=this.fresco.getSelected();if(!t||!t.rect)return this.notify("noLayerSelected"),[void 0,void 0];const s=this.fresco.selection.bounds.intersect(t.rect);if(s){let i=u.vL(s.width,s.height),a=i.getContext("2d");a.drawImage(t.canvas,t.rect.x-s.x,t.rect.y-s.y);const n=new m.Z(-s.x,-s.y);return a.save(),a.globalCompositeOperation="destination-in",a.drawImage(this.fresco.selection.mask,n.x,n.y),a.restore(),a=void 0,e&&(a=t.canvas.getContext("2d"),a.save(),a.globalCompositeOperation="destination-out",a.drawImage(this.fresco.selection.mask,-t.rect.x,-t.rect.y),a.restore(),a=void 0,t.render()),[i,s]}return this.notify("selectionEmpty"),[void 0,void 0]},this.selectionSave=()=>{this.fresco&&this.fresco.selection&&((0,a.ZP)("edit-selection-restore").classList.remove("disabled"),this.selection=u.dN(this.fresco.selection.mask),this.notify("selectionSaved"))},this.selectionRestore=()=>{var e,t;this.selection&&(this.history.add({type:"selectionChange",kind:"restore",selection:u.dN(null===(t=null===(e=this.fresco)||void 0===e?void 0:e.selection)||void 0===t?void 0:t.mask)}),this.fresco.addSelection(),this.fresco.selection.drawOnMask(this.selection,0,!1,!1),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-select")))},this.selectionAll=()=>{var e,t;this.fresco&&(this.history.add({type:"selectionChange",kind:"all",selection:u.dN(null===(t=null===(e=this.fresco)||void 0===e?void 0:e.selection)||void 0===t?void 0:t.mask)}),this.fresco.addSelection(),this.fresco.selection.selectAll(),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-select")))},this.selectionDeselect=()=>{var e,t;this.fresco&&this.fresco.selection&&(this.history.add({type:"selectionChange",kind:"deselect",selection:u.dN(null===(t=null===(e=this.fresco)||void 0===e?void 0:e.selection)||void 0===t?void 0:t.mask)}),this.fresco.removeSelection(),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-select")))},this.selectionInvert=()=>{var e,t;this.fresco&&this.fresco.hasSelection()&&(this.history.add({type:"selectionChange",kind:"invert",selection:u.dN(null===(t=null===(e=this.fresco)||void 0===e?void 0:e.selection)||void 0===t?void 0:t.mask)}),this.fresco.selection.invert(),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-select")))},this.selectionPixels=()=>{var e,t;const s=this.fresco.getSelected();if(!s||!s.canvas)return;this.history.add({type:"selectionChange",kind:"pixels",selection:u.dN(null===(t=null===(e=this.fresco)||void 0===e?void 0:e.selection)||void 0===t?void 0:t.mask)}),this.fresco.addSelection();let i=new f.Z;i.addShader("alpha-mask",1),this.fresco.selection.drawOnMask(i.apply(s.canvas),0,!1,!1,s.rect.topLeft()),i.cleanUp(),i=void 0,document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-select"))},this.selectionConvert=()=>{if(!this.fresco.isSelectedImageWithCanvas())return;if(!this.fresco.hasSelection())return;const e=this.fresco.getSelected(),t=u.dN(this.fresco.selection.mask);e.addMask(),e.mask.getContext("2d").drawImage(this.fresco.selection.mask,-e.rect.x,-e.rect.y),this.fresco.removeSelection(),this.history.add({type:"convertSelectionToMask",layer:e,selection:t}),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-select"))},this.maskAdd=()=>{if(!this.fresco.isSelectedImageWithCanvas())return;const e=this.fresco.getSelected();this.history.add({type:"mask",layer:e,rect:e.rect.clone()}),e.addMask(),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-select"))},this.maskApply=()=>{if(!this.fresco.isSelectedImageWithCanvas())return void document.dispatchEvent(new CustomEvent("notification",{detail:(0,i.Z)("noCutout")}));const e=this.fresco.getSelected(),t=e.mask,s=e.canvas,a=e.rect.clone();e.render(),e.canvas=e.baked,e.removeMask(),e.shrinkWrap(),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("notification",{detail:(0,i.Z)("maskApplied")})),this.history.add({type:"applyMask",layer:e,canvas:s,mask:t,rect:a})},this.maskInvert=()=>{if(!this.fresco.isSelectedImageWithCanvas())return void document.dispatchEvent(new CustomEvent("notification",{detail:(0,i.Z)("noCutout")}));const e=this.fresco.getSelected();e.hasMask()?(e.invertMask(),e.render(),document.dispatchEvent(new CustomEvent("notification",{detail:(0,i.Z)("invert")})),document.dispatchEvent(new CustomEvent("layer-select")),this.history.add({type:"maskInvert",layer:e})):document.dispatchEvent(new CustomEvent("notification",{detail:(0,i.Z)("noCutout")}))},this.maskDelete=()=>{if(!this.fresco.getSelected())return;const e=this.fresco.getSelected();if(!e.hasMask())return;const t=u.$E(e.mask);e.removeMask(),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("notification",{detail:(0,i.Z)("reset")})),this.history.add({type:"mask",layer:e,rect:new g.Z(0,0,t.width,t.height),patch:t})},this.maskExtract=()=>{const e=this.fresco.getSelected();if(e&&e.mask){let t=u.dN(e.canvas),s=t.getContext("2d");s.save(),s.globalCompositeOperation="destination-in",s.drawImage(e.mask,0,0),s.restore(),s=void 0;let a=u.l(e.mask),n=u.vL(a.width,a.height);s=n.getContext("2d"),s.drawImage(t,-a.x,-a.y),this.addImage(n,"Cutout","extract"),document.dispatchEvent(new CustomEvent("notification",{detail:(0,i.Z)("layerCreated")}))}else document.dispatchEvent(new CustomEvent("notification",{detail:(0,i.Z)("noCutout")}))},this.maskConvert=()=>{const e=this.fresco.getSelected();if(!e||!e.hasMask())return;const t=e.mask;this.fresco.addSelection(),this.fresco.selection.drawOnMask(e.mask,0,!1,!1,e.rect.topLeft()),e.removeMask(),this.history.add({type:"convertMaskToSelection",layer:e,mask:t}),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-select"))},this.setZoomStep=(e,t=1)=>{this.fresco&&(1===t&&(this.zoom=Math.round(10*this.zoom)/10),this.zoom+=e?this.zoom>=5?1*t:.1*t:this.zoom>=6?-1*t:-.1*t,this.zoom=u.uZ(this.zoom,.1,50),this.zoomMode="free",this.updateViewport(),document.dispatchEvent(new CustomEvent("zoom-change")))},this.setFluidZoom=e=>{if(!this.fresco)return;const t=this.isHDPI?.1:.12;this.zoomMode="free",this.zoom+=e?this.zoom*t:-this.zoom*t,this.zoom=u.uZ(this.zoom,.1,50),this.zoom>.95&&this.zoom<1.05&&(this.zoom=1),this.updateViewport(),document.dispatchEvent(new CustomEvent("zoom-change"))},this.setZoom=e=>{this.fresco&&("fit"===e?(this.zoomMode="fit",this.zoom=u.q7(this.fresco.width,this.fresco.height,this.raster.width-2*this.bounds,this.raster.height-2*this.bounds),this.anchor.x=Math.round(this.fresco.width/2),this.anchor.y=Math.round(this.fresco.height/2)):"fill"===e?(this.zoomMode="fill",this.zoom=u.UF(this.fresco.width,this.fresco.height,this.raster.width,this.raster.height),this.anchor.x=Math.round(this.fresco.width/2),this.anchor.y=Math.round(this.fresco.height/2)):"free"!==e&&(this.zoomMode="free",this.zoom=Number.parseFloat(e),this.zoom=u.uZ(this.zoom,.1,50)),this.updateViewport(),document.dispatchEvent(new CustomEvent("zoom-change")))},this.setAnchor=e=>{e.equalTo(this.anchor)||(this.anchor.x=u.uZ(e.x,0,this.fresco.width),this.anchor.y=u.uZ(e.y,0,this.fresco.height))},this.resetAnchor=()=>{this.setAnchor(this.getViewPortCenter())},this.resize=(e,t,s,i)=>{this.raster.height=this.isHDPI?2*i:i,this.raster.width=this.isHDPI?2*s:s,this.raster.style.left=e+"px",this.raster.style.top=t+"px",this.raster.style.width=s+"px",this.raster.style.height=i+"px";let a=this.raster.getBoundingClientRect();this.rasterRect=new g.Z(a.x,a.y,a.width,a.height),this.setZoom(this.zoomMode)},this.updateViewport=()=>{if(this.fresco){if(this.fresco.width*this.zoom<this.raster.width)this.canvas.width!==~~(this.fresco.width*this.zoom)&&(this.canvas.width=~~(this.fresco.width*this.zoom)),this.isHDPI?(this.canvas.style.left=~~(.25*(this.raster.width-this.canvas.width)+this.raster.offsetLeft)+"px",this.offset.x=2*(this.canvas.offsetLeft-this.raster.offsetLeft)):(this.canvas.style.left=~~(.5*(this.raster.width-this.canvas.width)+this.raster.offsetLeft)+"px",this.offset.x=this.canvas.offsetLeft-this.raster.offsetLeft);else{this.canvas.style.left=this.raster.style.left,this.canvas.width=this.raster.width;let e=this.anchor.x*this.zoom-this.canvas.width/2,t=this.fresco.width*this.zoom-this.canvas.width;if(this.offset.x=-u.uZ(~~e,0,~~t),e<0){let t=u.uZ(-1*e,0,250);this.offset.x+=t,this.canvas.style.left=this.raster.offsetLeft+t+"px",this.canvas.width=this.raster.width-t}if(e>t){let s=u.uZ(e-t,0,250);this.canvas.width=this.raster.width-s,this.offset.x-=s}}if(this.fresco.height*this.zoom<this.raster.height)this.canvas.height!==~~(this.fresco.height*this.zoom)&&(this.canvas.height=~~(this.fresco.height*this.zoom)),this.isHDPI?(this.canvas.style.top=~~(.25*(this.raster.height-this.canvas.height)+this.raster.offsetTop)+"px",this.offset.y=2*(this.canvas.offsetTop-this.raster.offsetTop)):(this.canvas.style.top=~~(.5*(this.raster.height-this.canvas.height)+this.raster.offsetTop)+"px",this.offset.y=this.canvas.offsetTop-this.raster.offsetTop);else{this.canvas.style.top=this.raster.style.top,this.canvas.height=this.raster.height;let e=this.anchor.y*this.zoom-this.canvas.height/2,t=this.fresco.height*this.zoom-this.canvas.height;if(this.offset.y=-u.uZ(~~e,0,~~t),e<0){let t=u.uZ(-1*e,0,250);this.offset.y+=t,this.canvas.style.top=this.raster.offsetTop+t+"px",this.canvas.height=this.raster.height-t}if(e>t){let s=u.uZ(e-t,0,250);this.canvas.height=this.raster.height-s,this.offset.y-=s}}this.isHDPI&&(this.canvas.style.width=~~(.5*this.canvas.width)+"px",this.canvas.style.height=~~(.5*this.canvas.height)+"px"),this.supressRender||document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("viewport-update"))}},this.getViewPort=()=>new g.Z(this.offset.x>0?0:-1*~~(this.offset.x/this.zoom),this.offset.y>0?0:-1*~~(this.offset.y/this.zoom),Math.ceil(this.canvas.width/this.zoom),Math.ceil(this.canvas.height/this.zoom)),this.getViewPortCenter=()=>{let e=new m.Z;return e.x=(this.offset.x>0?-this.offset.x/this.zoom:this.offset.x/this.zoom*-1)+this.raster.width/this.zoom/2,e.y=(this.offset.y>0?-this.offset.y/this.zoom:this.offset.y/this.zoom*-1)+this.raster.height/this.zoom/2,e},this.getLayerLocationRect=e=>{if(!e.rect)return;const t=this.isHDPI?.5*this.zoom:this.zoom;return new g.Z(Math.round(e.rect.x*t+this.offset.x),Math.round(e.rect.y*t+this.offset.y),Math.round(e.rect.width*t),Math.round(e.rect.height*t),e.rect.rotation)},this.getLayerLocationTrim=e=>{if(!e.trim)return;const t=this.isHDPI?.5*this.zoom:this.zoom;let s=e.getGlobalTrim();return new g.Z(Math.round(s.x*t+this.offset.x),Math.round(s.y*t+this.offset.y),Math.round(s.width*t),Math.round(s.height*t),s.rotation)},this.isAnimating=!1,this.animationId=0,this.playAnimation=(e=24,t=new Array)=>{if(this.isAnimating)return;this.animators=t,0===this.animators.length&&(this.animators=d.Z.bakeAnimators(this.fresco));let s=0;for(const i of this.animators)s=Math.max(s,i.getDuration()),i.prepare(new p.Z(this.fresco.width,this.fresco.height));if(s>0){this.coating.hide(),this.isAnimating=!0,document.dispatchEvent(new CustomEvent("animation-play",{detail:s}));let t=0,i=performance.now(),a=performance.now();const n=1e3/e,o=Math.ceil((s+50)/1e3)*e,r=()=>{const e=performance.now(),s=e-i;s>n&&(t++,i=e-s%n,this.stepAnimation(i-a)),t>o?this.finnishAnimation():this.animationId=window.requestAnimationFrame(r)};r()}},this.stepAnimation=e=>{if(!this.animators)return;const t=new p.Z(this.fresco.width,this.fresco.height);for(const s of this.animators)s.step(e,t);document.dispatchEvent(new CustomEvent("animation-step",{detail:e})),this.render()},this.stopAnimation=()=>{window.cancelAnimationFrame(this.animationId),this.finnishAnimation()},this.finnishAnimation=()=>{if(this.isAnimating){if(this.animators)for(const e of this.animators)e.finish();this.isAnimating=!1,this.coating.show(),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("animation-stop"))}},this.render=()=>{if(!this.supressRender&&this.ctx&&this.fresco){if(this.fresco.color?(this.ctx.fillStyle=this.fresco.color,this.ctx.globalAlpha=1,this.ctx.globalCompositeOperation="source-over",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height)):this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.translate(this.offset.x<0?this.offset.x:0,this.offset.y<0?this.offset.y:0),this.ctx.scale(this.zoom,this.zoom),this.isAnimating)for(var e=0;e<this.fresco.layers.length;e++){const t=this.fresco.layers[e];t.settings.visible&&(t.transform?this.renderTransformedLayer(this.ctx,t):this.renderLayer(this.ctx,t,!1))}else for(let e=0;e<this.fresco.layers.length;e++){const t=this.fresco.layers[e];t.settings.visible&&(this.fresco.hasScratch()&&this.fresco.scratch.id===t.id?("over"===this.fresco.scratch.renderMode&&this.renderLayer(this.ctx,t,this.zoom<1),this.renderLayer(this.ctx,this.fresco.scratch,this.zoom<1)):this.renderLayer(this.ctx,t,this.zoom<1))}if(this.ctx.setTransform(1,0,0,1,0,0),this.fresco.block){this.ctx.globalAlpha=1,this.ctx.globalCompositeOperation="source-over";let e=this.canvas.width<this.canvas.height?this.canvas.height:this.canvas.width;this.ctx.drawImage(this.premiumGrid,0,this.canvas.height-e,e,e)}}},this.renderOutputFrame=(e,t)=>{e.clearRect(0,0,e.canvas.width,e.canvas.height),e.fillStyle=this.fresco.color?this.fresco.color:"#000000",e.fillRect(0,0,e.canvas.width,e.canvas.height),e.imageSmoothingEnabled=!0,e.imageSmoothingQuality="high";for(var s=0;s<this.fresco.layers.length;s++){const i=this.fresco.layers[s];(t||i.settings.visible)&&(i.transform?this.renderTransformedLayer(e,i):this.renderLayer(e,i,!1))}e.setTransform(1,0,0,1,0,0)},this.renderTransformedLayer=(e,t)=>{if((t.canvas||t.baked)&&t.rect){e.globalAlpha=t.settings.opacity*t.transform.opacity,e.globalCompositeOperation=""===t.settings.blendmode?"source-over":t.settings.blendmode;try{const s=t.bect?t.bect:t.rect,i=t.transient?t.transient:t.baked?t.baked:t.canvas;e.save(),e.imageSmoothingEnabled=!0,e.imageSmoothingQuality="high";let a=s.x+.5*s.width+t.transform.offset.x,n=s.y+.5*s.height+t.transform.offset.y;e.translate(a,n),a=-.5*s.width,n=-.5*s.height,1===t.transform.scale.x&&1===t.transform.scale.y||(e.translate(s.width*(t.transform.sAnchor.x-.5),s.height*(t.transform.sAnchor.y-.5)),e.scale(t.transform.scale.x,t.transform.scale.y),a=-s.width*t.transform.sAnchor.x,n=-s.height*t.transform.sAnchor.y),t.rect.rotation&&e.rotate(t.rect.rotation*Math.PI/180),t.transform.rotation&&(e.translate(s.width*(t.transform.rAnchor.x-.5),s.height*(t.transform.rAnchor.y-.5)),e.rotate(t.transform.rotation*Math.PI/180),a=-s.width*t.transform.rAnchor.x,n=-s.height*t.transform.rAnchor.y),e.drawImage(i,a,n,s.width,s.height),e.restore()}catch(s){console.log(s)}}},this.renderLayer=(e,t,s,i)=>{if((t.canvas||t.baked)&&t.rect){e.imageSmoothingQuality="high",e.globalAlpha=t.settings.opacity,e.imageSmoothingEnabled=s||0!==t.rect.rotation,e.globalCompositeOperation=""===t.settings.blendmode?"source-over":t.settings.blendmode;try{const s=t.bect?t.bect:t.rect,a=t.transient?t.transient:t.baked?t.baked:t.canvas;t.rect.rotation?(this.ix=s.x+.5*s.width,this.iy=s.y+.5*s.height,i&&(this.ix-=i.x,this.iy-=i.y),e.save(),e.translate(this.ix,this.iy),e.rotate(t.rect.rotation*Math.PI/180),e.drawImage(a,-.5*s.width,-.5*s.height,s.width,s.height),e.restore()):(this.ix=s.x,this.iy=s.y,i&&(this.ix-=i.x,this.iy-=i.y),e.drawImage(a,this.ix,this.iy,s.width,s.height))}catch(a){console.log(a)}}},this.renderPreview=e=>{this.ctx&&e&&(this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.drawImage(e,0,0,this.canvas.width,this.canvas.height))},this.getThumbnail=()=>{if(this.canvas)return this.getOutputCanvas(u.UF(this.fresco.width,this.fresco.height,200,180))},this.getSingleLayerOutputCanvas=()=>{const e=this.fresco.getSelected();if(!e||!e.canvas)return;let t=u.vL(this.fresco.width,this.fresco.height),s=t.getContext("2d");return this.renderLayer(s,e,!1),s=null,t},this.getOutputCanvas=(e=1,t)=>{e>1&&(e=1);let s=u.vL(Math.round(this.fresco.width*e),Math.round(this.fresco.height*e)),i=s.getContext("2d");(this.fresco.color||t)&&(i.fillStyle=this.fresco.color?this.fresco.color:t,i.fillRect(0,0,s.width,s.height)),i.scale(e,e);for(var a=0;a<this.fresco.layers.length;a++){const t=this.fresco.layers[a];t.settings.visible&&this.renderLayer(i,t,e<1)}return i=null,s},this.translateToRect=(e,t,s,i)=>{if(s){const s=e.x-t.x,i=e.y-t.y;let a=Math.sqrt(s*s+i*i)/Math.sqrt(2);t.x=e.x+(s>0?-a:a),t.y=e.y+(i>0?-a:a)}let a=e.x<t.x?e.x:t.x,n=e.y<t.y?e.y:t.y,o=e.x<t.x?t.x:e.x,r=e.y<t.y?t.y:e.y;return e=this.translateRasterToFresco(new m.Z(a,n),void 0,!0),(t=this.translateRasterToFresco(new m.Z(o,r),void 0,!1)).x=Math.ceil(t.x),t.y=Math.ceil(t.y),i&&(e=this.translateFrescoToRaster(e),t=this.translateFrescoToRaster(t)),new g.Z(e.x,e.y,t.x-e.x,t.y-e.y)},this.translateRasterToFresco=(e,t,s=!0)=>{const i=this.isHDPI?.5*this.zoom:this.zoom;let a=e.x/i-this.offset.x/this.zoom,n=e.y/i-this.offset.y/this.zoom;return t&&(a-=t.x,n-=t.y),s?new m.Z(Math.floor(a),Math.floor(n)):new m.Z(a,n)},this.translateFrescoToRaster=(e,t)=>{let s=e.x,i=e.y;const a=this.isHDPI?.5*this.zoom:this.zoom;return t&&(s+=t.x,i+=t.y),s=Math.round(s*a)+this.offset.x,i=Math.round(i*a)+this.offset.y,new m.Z(s,i)},this.togglePremiumMessage=()=>{var e;null===(e=(0,a.ZP)("premium-unlock-message"))||void 0===e||e.remove(),this.fresco.block&&this.fresco.templateMeta&&(0,a.ZP)("workspace").appendChild((0,a.T)("div",{id:"premium-unlock-message",onclick:()=>new T.Z(this)},(0,i.Z)("unlockPremiumMessage"),(0,a.T)("img",{className:"close",src:"/img/icon/close.svg",width:14,height:14,onclick:e=>(e.preventDefault(),e.stopImmediatePropagation(),(0,a.ZP)("premium-unlock-message").remove(),!1)})))},this.layerDragMove=()=>{this.layerDrag.fresco!==this.fresco.id&&this.coating.drawDropPreviewRect(this.layerDrag.position,this.layerDrag.layer)},this.layerDragDrop=()=>{const e=this.layerDrag;if(e.fresco===this.fresco.id)return;const t=this.layerDrag.layer.clone(),s=new m.Z(e.position.x-this.rasterRect.x,e.position.y-this.rasterRect.y),i=this.translateRasterToFresco(s);t.rect.x=i.x-e.layer.rect.width/2,t.rect.y=i.y-e.layer.rect.height/2,this.fresco.addLayer(t),this.coating.clear(),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-list-render")),this.history.add({type:"addLayer",kind:"duplicate"+t.type,layer:t})},this.closeAll=()=>{this.tabs=[],this.history=null,this.fresco=null,this.showTabs=!1,this.coating.clear(),this.render(),document.dispatchEvent(new CustomEvent("tool-apply")),document.dispatchEvent(new CustomEvent("layer-list-render"))},this.close=e=>{this.stopAnimation(),void 0===e&&this.fresco&&(e=this.fresco.id);const t=this.tabs.findIndex((t=>t.fresco.id===e)),s=this.fresco&&this.fresco.id===e;if(!(t<0)){if(this.tabs.splice(t,1),0===this.tabs.length)return this.history=null,this.fresco=null,this.showTabs=!1,this.coating.clear(),this.render(),document.dispatchEvent(new CustomEvent("tool-apply")),void document.dispatchEvent(new CustomEvent("layer-list-render"));if(s){const e=Math.min(t,this.tabs.length-1);this.select(this.tabs[e].fresco.id)}else document.dispatchEvent(new CustomEvent("fresco-select"))}},this.workspace=e,this.tabs=[];let t=this;document.addEventListener("touchstart",(function e(s){document.documentElement.classList.add("touch"),document.removeEventListener("touchstart",e,!1),t.canTouch=!0}),!1);this.isHDPI="m"===r.ZP.product&&matchMedia("(-webkit-min-device-pixel-ratio: 2), (min-device-pixel-ratio: 2), (min-resolution: 192dpi)").matches,this.canvas=this.workspace.querySelector(".canvas"),this.canvas||(this.canvas=document.createElement("canvas"),this.canvas.className="canvas",e.appendChild(this.canvas)),this.canvas.width=this.canvas.height=0,this.ctx=this.canvas.getContext("2d"),this.raster=this.workspace.querySelector(".raster"),this.raster||(this.raster=document.createElement("canvas"),this.raster.className="raster",e.appendChild(this.raster)),this.anchor=new m.Z(0,0),this.offset=new m.Z(0,0),this.coating=new c.Z(this),document.addEventListener("viewport-render",(()=>window.requestAnimationFrame(this.render)),!1),document.addEventListener("sync-document",(e=>{e instanceof CustomEvent&&this.syncDocument(e.detail)})),document.addEventListener("layer-drag-move",this.layerDragMove),document.addEventListener("layer-drag-drop",this.layerDragDrop),document.addEventListener("render-enabled",(e=>{e instanceof CustomEvent&&(this.supressRender=!1===e.detail)})),document.addEventListener("reset-viewport",(()=>{this.setZoom(this.zoomMode)})),r.ZP.user.subscription||(this.premiumGrid=(0,a.T)("img",{src:"/img/misc/premium-grid.svg"}))}async syncDocument(e){var t,s,i;if(!(!e||this.syncQueue>0||this.syncDisabled))try{this.syncQueue++;let a,o=new Date;e.id===(null===(t=this.fresco)||void 0===t?void 0:t.id)&&(a=await u._c(this.getThumbnail()));const r=e.layers.map((e=>e.id)),h=await u._c(null===(s=null==e?void 0:e.selection)||void 0===s?void 0:s.mask),l=await(0,n.X3)(),[c,d,p,g]=l.transaction("readwrite","document-meta","document-thumbnail","document-selection","layer-meta");let m=u.mS(S.q,await c.get(e.id));m||(m=new S.q(e.id,e.name,e.width,e.height,e.color,e.templateMeta,e.animation)),m.lastModified=o,m.width=e.width,m.color=e.color,m.height=e.height,m.selected=null===(i=null==e?void 0:e.getSelected())||void 0===i?void 0:i.id,m.templateMeta=e.templateMeta,m.animation=e.animation,m.order=r;const[v]=await Promise.all([g.index("document").getAllKeys(e.id),a?d.put(a,e.id):void 0,h?p.put(h,e.id):p.delete(e.id),c.put(m)]),f=v.filter((t=>!e.layers.some((e=>e.id===t)))),y=e.layers.filter((e=>!v.includes(e.id)));await Promise.all(y.map((t=>S.F.sync(t,e)))),await Promise.all(f.map((async e=>S.F.delete(e))));const w=e.layers.filter((e=>e.syncRequested&&(!e.syncLatest||e.syncRequested>e.syncLatest)));await Promise.all(w.map((t=>S.F.sync(t,e)))),document.cookie="has-history=true; path=/; SameSite=Strict; expires=Fri, 31 Dec 9999 23:59:59 GMT"}finally{this.syncQueue--}}createNew(e,t,s,i){document.dispatchEvent(new CustomEvent("navigate",{detail:"editor"})),this.addTab(new l.Z(u.M8(),e,t,s,i),"create"),this.addEmpty(),this.setZoom("fit"),document.dispatchEvent(new CustomEvent("navigate",{detail:"editor"}))}async openFromHistory(e,t){document.dispatchEvent(new CustomEvent("navigate",{detail:"editor"})),e.templateMeta&&e.templateMeta.premium&&r.ZP.user.subscription&&(e.templateMeta.locked=!1),this.addTab(new l.Z(e.id,e.name,e.width,e.height,e.transparent?void 0:e.color,e.animation,e.templateMeta),"document"),this.setZoom("fit"),this.renderPreview(t),this.supressRender=!0,document.dispatchEvent(new CustomEvent("loading",{detail:"start"}));try{await e.restore(this)}catch(s){console.log(s)}document.dispatchEvent(new CustomEvent("loading",{detail:"stop"})),this.supressRender=!1,document.dispatchEvent(new CustomEvent("fresco-select")),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("layer-list-render")),document.dispatchEvent(new CustomEvent("selection-update")),document.dispatchEvent(new CustomEvent("resize")),document.dispatchEvent(new CustomEvent("navigate",{detail:"editor"}))}addEmpty(){let e="Layer "+this.fresco.nextAddedLayerNumber(),t=new b.Z(u.M8(),e);return this.fresco.addLayer(t),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-list-render")),this.history.add({type:"addLayer",kind:"addemptyimage",layer:t}),t}addImage(e,t,s){if(document.dispatchEvent(new CustomEvent("navigate",{detail:"editor"})),this.fresco||this.addTab(new l.Z(u.M8(),t,e.width,e.height),"image"),"frame"===s&&this.fresco.getSelected()instanceof w.Z)return void this.setFrameContent(e);const a=0===this.fresco.layers.length;let n=this.fresco.addLayer(new b.Z(u.M8(),a?(0,i.Z)("background"):t,e,new g.Z(0,0,e.width,e.height),a));if(a)this.setZoom("fit"),this.syncDocument(this.fresco);else{let e=this.getViewPort().center();n.rect.x=Math.round(e.x-n.rect.width/2),n.rect.y=Math.round(e.y-n.rect.height/2),this.history.add({type:"addLayer",kind:s+"image",layer:n})}return document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-list-render")),document.dispatchEvent(new CustomEvent("navigate",{detail:"editor"})),n}async addSVGShape(e,t,s){document.dispatchEvent(new CustomEvent("navigate",{detail:"editor"}));let i=new P.Z;i.variant="svg",i.content=e;let a=new x.Z(u.M8(),t,void 0,i);if(await a.prepare(),this.fresco||this.addTab(new l.Z(u.M8(),a.settings.name,a.rect.width,a.rect.height),"shape"),this.fresco.addLayer(a),1===this.fresco.layers.length)this.setZoom("fit"),this.syncDocument(this.fresco);else{let e=this.getViewPort().center();a.rect.x=Math.round(e.x-a.rect.width/2),a.rect.y=Math.round(e.y-a.rect.height/2),this.history.add({type:"addLayer",kind:s+"shape",layer:a})}return document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-list-render")),document.dispatchEvent(new CustomEvent("navigate",{detail:"editor"})),a}async addShape(e,t,s="add"){e||(e=new g.Z(Math.round(this.fresco.width/4),Math.round(this.fresco.height/4),Math.round(this.fresco.width/2),Math.round(this.fresco.height/2))),t||((t=new P.Z).variant="rectangle",t.fillType="color",t.fillValue="#444444");let a=(0,i.Z)("shape")+" "+this.fresco.nextAddedLayerNumber(),n=new x.Z(u.M8(),a,e,t);return await n.prepare(),this.fresco.addLayer(n),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render")),this.history.add({type:"addLayer",kind:s+"shape",layer:n}),n}addElement(e,t,s,i,a){let n;if((0,o.Z)("add-element",s),a!==Z.Z.SCALE_METHOD_NONE)if((this.fresco.height>this.fresco.width&&e.height<e.width||this.fresco.width>this.fresco.height&&e.width<e.height)&&(e=u.Xj(e,90)),n=new Z.Z(u.M8(),t,e,s,"overlay",i,a),a==Z.Z.SCALE_METHOD_FILL){let t=g.Z.fillFit(e.width,e.height,this.fresco.width,this.fresco.height);n.calculate(new m.Z(t.x,t.y),new m.Z(t.right(),t.bottom()),0)}else n.calculate(new m.Z(0,0),new m.Z(this.fresco.width,this.fresco.height),0);else{let o=g.Z.bestFit(e.width,e.height,this.fresco.width,this.fresco.height);(e.height>this.fresco.height||e.width>this.fresco.width)&&(e=u.Ai(e,o.width,o.height)),n=new Z.Z(u.M8(),t,e,s,"sticker",i,a),n.rect.x=o.x,n.rect.y=o.y}return this.fresco.addLayer(n),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-list-render")),this.history.add({type:"addLayer",kind:"addelement",layer:n}),n}async addText(e,t,s,i="add"){if(!e||!t||!s){e="Lorem ipsum ..",(s=new k.Z("Verdana",40)).fillType="color",s.fillValue="#ffffff";let i=this.getViewPort();t=new g.Z(Math.round(i.x+(i.width-Math.round(i.width/1.2))/2),Math.round(i.y+i.height/2.5),Math.round(i.width/1.2),40)}const a=new y.Z(u.M8(),e,t,s);return await a.prepare(),this.fresco.addLayer(a),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render")),this.history.add({type:"addLayer",kind:i+"text",layer:a}),a}addFrame(e){e||(e=new g.Z(Math.round(this.fresco.width/4),Math.round(this.fresco.height/4),Math.round(this.fresco.width/2),Math.round(this.fresco.height/2)));let t=(0,i.Z)("frame")+" "+this.fresco.nextAddedLayerNumber();const s=new w.Z(u.M8(),t,e);return this.fresco.addLayer(s),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render")),this.history.add({type:"addLayer",kind:"addframe",layer:s}),s}crop(e){const t=new p.Z(this.fresco.width,this.fresco.height),s=new m.Z(-e.x,-e.y);this.fresco.crop(e),this.updateViewport(),this.history.add({type:"crop",offset:s,size:t})}flip(e){this.fresco.flip(e),this.render(),this.history.add({type:"flip",vertical:e})}rotate(e){this.fresco.rotate(e),this.updateViewport(),this.history.add({type:"rotate",counterClock:e})}rotateSelected(e){const t=this.fresco.getSelected();t?t.settings.locked?this.notify("layer locked"):(this.history.add({type:"rotateLayer",layer:t,counterClock:e}),t.rotate(e),document.dispatchEvent(new CustomEvent("viewport-render"))):this.notify("no layer selected")}flipSelected(e){if(!this.isSelectedLayerShaderble())return void this.notify("onlyImageLayer");const t=this.fresco.getSelected();t.settings.locked?this.notify("layerLocked"):(this.history.add({type:"flipLayer",layer:t,vertical:e}),t.flip(e),t.render(),this.render())}straighten(e){if(!this.fresco.lockedBackground())return;const t=this.fresco.layers[0].rect.rotatedSize(e);this.fresco.straighten(e,t.width,t.height),this.updateViewport()}addTab(e,t,s=!0){document.dispatchEvent(new CustomEvent("navigate",{detail:"editor"}));const i=new C(e,t);this.tabs.push(i),s&&(this.fresco=i.fresco,this.history=i.history,this.setZoom("fit"),i.zoom=this.zoom,i.zoomMode=this.zoomMode,i.anchor=this.anchor,document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("layer-list-render")),this.history.dispatchHistoryStatus(),this.togglePremiumMessage()),this.tabs.length>this.tabLimit&&this.close(this.tabs[0].fresco.id),this.tabs.length>1&&(this.showTabs=!0),document.dispatchEvent(new CustomEvent("fresco-select")),document.dispatchEvent(new CustomEvent("resize"))}select(e){this.stopAnimation();const t=this.tabs.find((t=>t.fresco.id===e));if(!t)return;const s=this.tabs.find((e=>{var t;return e.fresco.id===(null===(t=this.fresco)||void 0===t?void 0:t.id)}));s&&(s.zoom=this.zoom,s.zoomMode=this.zoomMode,s.anchor=this.anchor.clone()),this.fresco=t.fresco,this.history=t.history,this.zoom=t.zoom,this.zoomMode=t.zoomMode,this.anchor=t.anchor,this.updateViewport(),document.dispatchEvent(new CustomEvent("zoom-change")),document.dispatchEvent(new CustomEvent("layer-list-render")),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("fresco-select")),document.dispatchEvent(new CustomEvent("resize")),this.history.dispatchHistoryStatus(),this.togglePremiumMessage()}}},8685:(e,t,s)=>{s.d(t,{Z:()=>u});var i=s(3655),a=s(4170),n=s(9591),o=s(6817),r=s(8776),h=s(3673),l=s(2282),c=s(7758),d=s(2396);class u extends a.Z{constructor(e=i.M8(),t,s,p){super(a.Z.TYPE_TEXT),this.id=e,this.prepare=async(e=!1)=>{this.fill&&!e||(this.fill=await n.Z.fromString(this.textSettings.fillType,this.textSettings.fillValue),document.dispatchEvent(new CustomEvent("layer-select"))),this.setText()},this.setText=(e=this.text)=>{this.text=e,this.settings.name=e.substring(0,25)+"..",this.textSettings.uppercase?this.words=this.text.replace(/[\n]/g,"  ").toUpperCase().split(" "):this.words=this.text.replace(/[\n]/g,"  ").split(" "),this.render()},this.setTextSize=e=>{this.textSettings.setSize(e),this.render()},this.setLineSpace=e=>{this.textSettings.lineSpace=e,this.render()},this.setLetterSpace=e=>{this.textSettings.letterSpace=e,this.render()},this.setTextFill=(e,t=!1)=>{this.fill=e,t||(this.textSettings.fillType=e.getType(),this.textSettings.fillValue=e.getStringValue()),this.render()},this.setTextFont=(e,t=!1)=>{this.textSettings.setFont(e),this.render(t)},this.setTextUpperCase=e=>{this.textSettings.uppercase=e,this.setText(this.text)},this.setTextItalic=e=>{this.textSettings.italic=e,this.setText(this.text)},this.setTextBold=e=>{this.textSettings.bold=e,this.setText(this.text)},this.setTextAlign=e=>{this.textSettings.align=e,this.render()},this.setCurve=(e,t,s,i,a)=>{this.textSettings.curve=e,this.textSettings.curveType=t,this.textSettings.curveAmount=s,this.textSettings.curveSpread=i,this.textSettings.curveFlip=a,this.render()},this.setBackground=(e,t,s,i,a)=>{this.textSettings.background=e,this.textSettings.backgroundType=t,this.textSettings.backgroundColor=s,this.textSettings.backgroundPunch=i,this.textSettings.backgroundOffset=a,this.render()},this.setOutline=(e,t,s,i,a,n)=>{this.textSettings.outline=e,this.textSettings.outlineSize=t,this.textSettings.outlineColor=s,this.textSettings.outlinePunch=i,this.textSettings.outlineDistance=a,this.textSettings.outlineDirection=n,this.render()},this.setShadow=(e,t,s,i,a,n)=>{this.textSettings.shadow=e,this.textSettings.shadowBlur=t,this.textSettings.shadowAlpha=s,this.textSettings.shadowColor=i,this.textSettings.shadowDistance=a,this.textSettings.shadowDirection=n,this.render()},this.setTextSettings=e=>{this.textSettings=e,this.render()},this.setCanvasStyle=()=>{var e;this.ctx.textBaseline="top",this.ctx.font=this.textSettings.getCssFont(),this.ctx.strokeStyle=this.textSettings.outlineColor,this.ctx.lineWidth=Math.round(this.textSettings.outlineSize*this.textSettings.padding),this.ctx.lineJoin="miter",this.ctx.miterLimit=2,null===(e=this.fill)||void 0===e||e.addToCanvas(this.ctx)},this.render=(e=!1)=>{this.speeed=e;let t=this.textSettings.padding;this.canvas||(this.canvas=document.createElement("canvas")),this.ctx=this.canvas.getContext("2d"),this.setCanvasStyle();const s=new h.Z;if(this.textSettings.outline&&this.textSettings.outlineDistance>0){var i=(this.textSettings.outlineDirection-90)*Math.PI/180;s.x=Math.cos(i)*this.textSettings.outlineDistance*t,s.y=Math.sin(i)*this.textSettings.outlineDistance*t}const a=this.textSettings.getLineSpacing();let n=this.textSettings.height+t+a,l=this.textSettings.background?Math.round(this.textSettings.backgroundOffset*t):0;this.textSettings.background&&this.textSettings.backgroundType!=c.Z.BACKGROUND_FULL&&(n+=2*t);let d=!1,u=this.splitTextIntoLines(n);if(this.setCanvasSize(u.length,a,n),this.setCanvasStyle(),this.textSettings.curve&&"arc"===this.textSettings.curveType){if(d=!0,0!==this.textSettings.curveAmount){const e=this.textSettings.getLetterSpacing();let t=this.ctx.measureText(" ").width,[s,i]=this.calculateArcRadius();d=(t+e)/((s-this.textSettings.height/2)*Math.PI*2)*Math.PI*2<5e-4}this.textSettings.curveAmount<=0&&!d&&(u=u.reverse())}for(let o=0;o<u.length;o++){if(""===u[o])continue;const e=this.lineWidth(u[o]);this.textSettings.curve&&!d?this.drawCurveLine(u[o],t+o*n,e,l,s):this.drawLine(u[o],t+o*n,e,l,s,d)}if(this.textSettings.shadow&&!this.speeed){this.baked||(this.baked=document.createElement("canvas")),this.bect=new o.Z(this.rect.x-4*t,this.rect.y-4*t,this.rect.width+8*t,this.rect.height+8*t,this.rect.rotation),this.baked.width=this.bect.width,this.baked.height=this.bect.height;let e=this.baked.getContext("2d");e.save();i=(this.textSettings.shadowDirection-90)*Math.PI/180;var p=Math.cos(i)*this.textSettings.shadowDistance,g=Math.sin(i)*this.textSettings.shadowDistance;e.shadowBlur=this.textSettings.shadowBlur*this.textSettings.padding*2,e.shadowOffsetX=p*this.textSettings.padding*2,e.shadowOffsetY=g*this.textSettings.padding*2,e.shadowColor=r.Z.fromHEX(this.textSettings.shadowColor,Math.round(255*this.textSettings.shadowAlpha)).toRGBA(),e.drawImage(this.canvas,4*t,4*t),e.restore()}else this.resetBaked()},this.resetBaked=()=>{this.baked=void 0,this.bect=void 0},this.setCanvasSize=(e,t,s)=>{if(this.textSettings.background&&this.textSettings.backgroundType!=c.Z.BACKGROUND_FULL?this.rect.height=(this.textSettings.height+3*this.textSettings.padding)*e+t*(e-1)-this.textSettings.padding:this.rect.height=(this.textSettings.height+this.textSettings.padding)*e+t*(e-1)+this.textSettings.padding,this.textSettings.curve)switch(this.textSettings.curveType){case"arc":let e=this.calculateArcHeight();this.rect.height+=e;break;case"circle":this.rect.height=this.rect.width;break;case"half":this.rect.height=Math.round(this.rect.width/2)}this.canvas.width=this.rect.width,this.canvas.height=this.rect.height,this.textSettings.background&&this.textSettings.backgroundType===c.Z.BACKGROUND_FULL&&(this.ctx.fillStyle=this.textSettings.backgroundColor,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height))},this.splitTextIntoLines=e=>{let t="",s=new Array,i=this.textSettings.curve?this.curveMaxWidth(0,e):this.rect.width;for(var a=0;a<this.words.length;a++){let n=""!=t?t+" "+this.words[a]:this.words[a];if(""===this.words[a]||this.lineWidth(n)>i&&n!==this.words[a]){if(s.push(t),t=""===this.words[a]?"":this.words[a],this.textSettings.curve&&(i=this.curveMaxWidth(s.length,e),i<0))return s}else t=n}return s.push(t),s},this.lineWidth=e=>{let t=0,s=this.textSettings.getLineSpacing(),i=this.textSettings.getLetterSpacing();if(this.textSettings.background&&this.textSettings.backgroundType===c.Z.BACKGROUND_WORD){let a=e.split(" ");for(let e=0;e<a.length;e++)t+=this.measureTextWidth(a[e],i,!0)+2*this.textSettings.padding;t+=(this.textSettings.curve&&"circle"===this.textSettings.curveType?a.length:a.length-1)*(this.textSettings.padding+s)}else this.textSettings.curve&&"circle"===this.textSettings.curveType?(t=this.measureTextWidth(e,i,!1),t+=this.measureTextWidth(" ",i,!1)):(t=this.measureTextWidth(e,i,!0),t+=2*this.textSettings.padding);return t},this.curveMaxWidth=(e,t)=>{if("arc"===this.textSettings.curveType){if(0===this.textSettings.curveAmount)return this.rect.width;let[e,s]=this.calculateArcRadius();return this.textSettings.curveAmount<0&&(s+=-t/4),s}if("circle"===this.textSettings.curveType){let s=this.rect.width/2-this.textSettings.padding-e*t;return s<t?-1:s*Math.PI*2}{let s=this.rect.width/2-e*t;return s<t?-1:s*Math.PI}},this.calculateArcHeight=()=>Math.round(this.rect.width/5*Math.abs(this.textSettings.curveAmount)),this.calculateArcRadius=()=>{let e=this.calculateArcHeight(),t=new h.Z(0,e),s=new h.Z(this.canvas.width/2,0),i=new h.Z(this.canvas.width,e),a=(s.y-t.y)/(s.x-t.x),n=(i.y-s.y)/(i.x-s.x),o=-1*((a*n*(t.y-i.y)+n*(t.x+s.x)-a*(s.x+i.x))/(2*(n-a))-(t.x+s.x)/2)/a+(t.y+s.y)/2;return[o,Math.atan2(this.rect.width/2,o-e)*o*2]},this.drawHalfLine=(e,t,s,i,a)=>{const n=this.textSettings.curveFlip,o=this.textSettings.curveSpread,r=this.textSettings.getLineSpacing(),h=this.textSettings.getLetterSpacing();let l=!1,d=this.rect.width/2-t,u=d*Math.PI*2;if(this.textSettings.background)if(this.textSettings.backgroundType===c.Z.BACKGROUND_LINE){let e=d-this.textSettings.height/2;e>0&&(this.ctx.save(),this.ctx.strokeStyle=this.textSettings.backgroundColor,this.ctx.lineWidth=this.textSettings.height+2*this.textSettings.padding,this.ctx.beginPath(),this.ctx.ellipse(this.rect.width/2,n?0:this.rect.width/2,e,e,0,Math.PI,0,n),this.ctx.stroke(),this.ctx.restore())}else if(this.textSettings.backgroundType===c.Z.BACKGROUND_WORD){let t=o?-u/4:-s/2,i=(u/2-s)/e.replace(/\s/g,"").length;this.ctx.save(),this.ctx.strokeStyle=this.textSettings.backgroundColor,this.ctx.lineWidth=this.textSettings.height+2*this.textSettings.padding;let a=e.split(" ");for(var p=0;p<this.words.length;p++)if(a[p]&&""!==a[p]){let e=this.measureTextWidth(a[p],h,!0)+2*this.textSettings.padding;o&&(e+=i*a[p].length);let s=d-this.textSettings.height/2;if(s<0)continue;let l=e/u*360*(Math.PI/180),c=t/u*360*(Math.PI/180),g=n?90:270,m=g*(Math.PI/180)+(n?-c:c),v=g*(Math.PI/180)+(n?-(l+c):l+c);this.ctx.beginPath(),this.ctx.arc(this.rect.width/2,n?0:this.rect.width/2,s,m,v,n),this.ctx.stroke(),t+=Math.round(e+this.textSettings.padding+r)}this.ctx.restore(),l=!0}if(this.ctx.save(),e.length>0){this.ctx.translate(this.rect.width/2,n?0:this.rect.width/2);let t=n?d-this.textSettings.height-this.textSettings.ascent:-d-this.textSettings.ascent;this.ctx.textAlign="center";let c=n?-1:1,p=0;if(o){p=(u/2-s)/(l?e.replace(/\s/g,"").length:e.length+1)/2,s=l?u/2:u/2-2*p}let m=l?2*h+2*this.textSettings.padding:2*this.textSettings.padding+2*h;this.ctx.rotate((s-m)/u*Math.PI*-c),this.ctx.textAlign="center";for(var g=0;g<e.length;g++){if(l&&" "===e[g]){this.ctx.rotate((3*this.textSettings.padding+r+h)/u*(2*Math.PI)*c);continue}let s=this.ctx.measureText(e[g]).width/2;this.ctx.rotate((s+p)/u*Math.PI*2*c),this.drawChar(e[g],0,t+i,a),this.ctx.rotate((s+h+p)/u*Math.PI*2*c)}}this.ctx.restore()},this.drawCircleLine=(e,t,s,i,a)=>{const n=this.textSettings.curveFlip,o=this.textSettings.curveSpread,r=this.textSettings.getLineSpacing(),h=this.textSettings.getLetterSpacing();let l=!1,d=this.rect.width/2-t,u=d*Math.PI*2;if(this.textSettings.background)if(this.textSettings.backgroundType===c.Z.BACKGROUND_LINE){let e=d-this.textSettings.height/2;e>0&&(this.ctx.save(),this.ctx.strokeStyle=this.textSettings.backgroundColor,this.ctx.lineWidth=this.textSettings.height+2*this.textSettings.padding,this.ctx.beginPath(),this.ctx.ellipse(this.rect.width/2,this.rect.width/2,e,e,0,0,2*Math.PI),this.ctx.stroke(),this.ctx.restore())}else if(this.textSettings.backgroundType===c.Z.BACKGROUND_WORD){let t=o?this.textSettings.padding/2+r/2-u/2:this.textSettings.padding/2+r/2-s/2,i=(u-s)/e.replace(/\s/g,"").length;this.ctx.save(),this.ctx.strokeStyle=this.textSettings.backgroundColor,this.ctx.lineWidth=this.textSettings.height+2*this.textSettings.padding;let a=e.split(" ");for(var p=0;p<this.words.length;p++)if(a[p]&&""!==a[p]){let e=this.measureTextWidth(a[p],h,!0)+2*this.textSettings.padding;o&&(e+=i*a[p].length);let s=d-this.textSettings.height/2;if(s<0)continue;let l=e/u*360*(Math.PI/180),c=t/u*360*(Math.PI/180),g=n?90:270,m=g*(Math.PI/180)+(n?-c:c),v=g*(Math.PI/180)+(n?-(l+c):l+c);this.ctx.beginPath(),this.ctx.arc(this.rect.width/2,this.rect.width/2,s,m,v,n),this.ctx.stroke(),t+=Math.round(e+this.textSettings.padding+r)}this.ctx.restore(),l=!0}if(this.ctx.save(),e.length>0){this.ctx.translate(this.rect.width/2,this.rect.width/2);let t=n?d-this.textSettings.height-this.textSettings.ascent:-d-this.textSettings.ascent,c=n?-1:1,p=0;if(o){p=(u-s)/(l?e.replace(/\s/g,"").length:e.length+1)/2,s=l?u:u-2*p}let m=l?2*h+3*this.textSettings.padding+r:this.measureTextWidth(" ",h,!0);this.ctx.rotate((s-m)/u*Math.PI*-c),this.ctx.textAlign="center";for(var g=0;g<e.length;g++){if(l&&" "===e[g]){this.ctx.rotate((3*this.textSettings.padding+r+h)/u*(2*Math.PI)*c);continue}let s=this.ctx.measureText(e[g]).width/2;this.ctx.rotate((s+p)/u*Math.PI*2*c),this.drawChar(e[g],0,t+i,a),this.ctx.rotate((s+h+p)/u*Math.PI*2*c)}}this.ctx.restore()},this.drawArcLine=(e,t,s,i,a)=>{const n=this.textSettings.getLineSpacing(),o=this.textSettings.getLetterSpacing();let[r,h]=this.calculateArcRadius(),l=r-t,d=l*Math.PI*2,u=this.textSettings.curveAmount<0,p=!1;if(this.textSettings.background)if(this.textSettings.backgroundType===c.Z.BACKGROUND_LINE){let e=l-this.textSettings.height/2;if(e>0){let t=s/(l*Math.PI*2)*360*(Math.PI/180/2),i=u?this.canvas.height-r:r,a=u?90:270,n=a*(Math.PI/180)-t,o=a*(Math.PI/180)+t;this.ctx.save(),this.ctx.strokeStyle=this.textSettings.backgroundColor,this.ctx.lineWidth=this.textSettings.height+2*this.textSettings.padding,this.ctx.beginPath(),this.ctx.arc(this.rect.width/2,i,e,n,o),this.ctx.stroke(),this.ctx.restore()}}else if(this.textSettings.backgroundType===c.Z.BACKGROUND_WORD){let t=-s/2;this.ctx.save(),this.ctx.strokeStyle=this.textSettings.backgroundColor,this.ctx.lineWidth=this.textSettings.height+2*this.textSettings.padding;let i=e.split(" ");for(var g=0;g<this.words.length;g++)if(i[g]&&""!==i[g]){let e=this.measureTextWidth(i[g],o,!0)+2*this.textSettings.padding,s=l-this.textSettings.height/2;if(s<0)continue;let a=l*Math.PI*2,h=e/a*360*(Math.PI/180),c=t/a*360*(Math.PI/180),d=u?this.canvas.height-r:r,p=u?90:270,m=p*(Math.PI/180)+(u?-c:c),v=p*(Math.PI/180)+(u?-(h+c):h+c);this.ctx.beginPath(),u?this.ctx.arc(this.rect.width/2,d,s,v,m):this.ctx.arc(this.rect.width/2,d,s,m,v),this.ctx.stroke(),t+=Math.round(e+this.textSettings.padding+n)}this.ctx.restore(),p=!0}if(this.ctx.save(),e.length>0){let t=u?-1:1,h=u?l-this.textSettings.height-this.textSettings.ascent:-l-this.textSettings.ascent;this.ctx.textAlign="center",this.ctx.translate(this.ctx.canvas.width/2,u?this.canvas.height-r:r),this.ctx.rotate((s-2*o-2*this.textSettings.padding)/d*Math.PI*-t);for(var m=0;m<e.length;m++){if(p&&" "===e[m]){this.ctx.rotate((3*this.textSettings.padding+n+o)/d*(2*Math.PI)*t);continue}let s=this.ctx.measureText(e[m]).width;s/d*Math.PI*2>5e-4?(this.ctx.rotate(s/2/d*Math.PI*2*t),this.drawChar(e[m],0,h+i,a),this.ctx.rotate((s/2+o)/d*Math.PI*2*t)):(this.drawChar(e[m],s/2,h+i,a),this.ctx.rotate((s+o)/d*Math.PI*2*t))}}this.ctx.restore()},this.drawLine=(e,t,s,i,a,n=!1)=>{var o,r;let h=0;const l=this.textSettings.getLetterSpacing();if("center"==this.textSettings.align?h=Math.round((this.rect.width-s)/2):"right"==this.textSettings.align&&(h=Math.round(this.rect.width-s)),this.textSettings.background&&this.textSettings.backgroundType===c.Z.BACKGROUND_LINE&&(this.ctx.fillStyle=this.textSettings.backgroundColor,this.ctx.fillRect(h,t-this.textSettings.padding,Math.round(s),this.textSettings.height+2*this.textSettings.padding),null===(o=this.fill)||void 0===o||o.addToCanvas(this.ctx)),this.textSettings.background&&this.textSettings.backgroundType===c.Z.BACKGROUND_WORD){let n=this.textSettings.getLineSpacing(),o=e.split(" ");for(var d=0;d<this.words.length;d++)o[d]&&""!==o[d]&&(s=this.measureTextWidth(o[d],l,!0),this.ctx.fillStyle=this.textSettings.backgroundColor,this.ctx.fillRect(h,t-this.textSettings.padding,Math.round(s+2*this.textSettings.padding),this.textSettings.height+2*this.textSettings.padding),null===(r=this.fill)||void 0===r||r.addToCanvas(this.ctx),0===l?this.drawText(o[d],h+this.textSettings.padding+l,t-this.textSettings.ascent+i,a):this.drawSpacedText(o[d],h+this.textSettings.padding+l,t-this.textSettings.ascent+i,l,a),h+=Math.round(s+3*this.textSettings.padding+n))}else 0!==l||n?this.drawSpacedText(e,h+this.textSettings.padding+l,t-this.textSettings.ascent+i,l,a):this.drawText(e,h+this.textSettings.padding+l,t-this.textSettings.ascent+i,a)},this.drawSpacedText=(e,t,s,i,a)=>{let n=0,o="";for(;n<e.length;)o=e[n++],this.drawChar(o,t,s,a),t+=this.ctx.measureText(o).width+i},this.drawText=(e,t,s,i)=>{this.textSettings.outline&&0===i.x&&0===i.y&&!this.speeed&&this.ctx.strokeText(e,t,s),(!this.speeed&&void 0===this.fill||this.textSettings.background&&this.textSettings.backgroundPunch||this.textSettings.outline&&this.textSettings.outlinePunch)&&(this.ctx.globalCompositeOperation="destination-out"),this.ctx.fillText(e,t,s),this.ctx.globalCompositeOperation="source-over",!this.textSettings.outline||0===i.x&&0===i.y||this.speeed||this.ctx.strokeText(e,t+i.x,s+i.y)},this.drawChar=(e,t,s,i)=>{this.textSettings.outline&&0===i.x&&0===i.y&&!this.speeed&&this.ctx.strokeText(e,t,s),(!this.speeed&&void 0===this.fill||this.textSettings.background&&this.textSettings.backgroundPunch||this.textSettings.outline&&this.textSettings.outlinePunch)&&(this.ctx.globalCompositeOperation="destination-out"),this.ctx.fillText(e,t,s),this.ctx.globalCompositeOperation="source-over",!this.textSettings.outline||0===i.x&&0===i.y||this.speeed||this.ctx.strokeText(e,t+i.x,s+i.y)},this.measureTextWidth=(e,t,s)=>{if(!e)return;let i=0;if(0!==t)for(let a=0;a<e.length;a++)i+=this.ctx.measureText(e[a]).width;else i=this.ctx.measureText(e).width;return s&&(i+=t),i+e.length*t},this.position=(e,t)=>{this.rect&&(void 0!==e&&(this.rect.x=e),void 0!==t&&(this.rect.y=t),this.bect&&(this.bect.x=this.rect.x-4*this.textSettings.padding,this.bect.y=this.rect.y-4*this.textSettings.padding))},this.scale=(e,t)=>{this.textSettings.setSize(Math.round(this.textSettings.size*t)),this.rect.x=Math.round(this.rect.x*e),this.rect.y=Math.round(this.rect.y*t),this.rect.width=Math.round(this.rect.width*e),this.render()},this.calculate=(e,t)=>{this.rect.x=Math.round(e.x),this.rect.width=Math.round(t.x-e.x),this.rect.width<20&&(this.rect.width=20),this.render()},this.setWidth=e=>{this.rect.width=Math.round(e),this.rect.width<20&&(this.rect.width=20),this.render()},this.getHeight=()=>this.textSettings.height,this.setHeightScale=e=>{let t=Math.round(this.textSettings.size*e);this.setTextSize(t)},this.rotate=e=>{this.rect.rotation+=e?-90:90},this.rasterize=()=>{let e=this.baked?this.baked:this.canvas,t=this.bect?this.bect.clone():this.rect.clone();const s=new l.Z(i.M8(),this.settings.name,e,t,this.settings.locked);return s.settings=Object.assign({},this.settings),s.applyTransform(),s},this.clone=(e=!1)=>{let t=new u(e?this.id:i.M8(),this.text,this.rect.clone(),this.textSettings.clone());return t.settings=Object.assign({},this.settings),t.animation=d.Z.clone(this.animation),t.rect=this.rect.clone(),t.canvas=i.dN(this.canvas),t.prepare(),e&&(t.id=this.id),t},this.textSettings=p,this.text=t,this.rect=s}drawCurveLine(e,t,s,i,a){switch(this.textSettings.curveType){case"arc":this.drawArcLine(e,t,s,i,a);break;case"circle":this.drawCircleLine(e,t,s,i,a);break;case"half":this.drawHalfLine(e,t,s,i,a)}}}},7758:(e,t,s)=>{s.d(t,{Z:()=>n});var i=s(3947),a=s(3655);class n{constructor(e,t,s=!0){this.lineSpace=0,this.letterSpace=0,this.bold=!1,this.italic=!1,this.uppercase=!1,this.undeline=!1,this.align="center",this.curve=!1,this.curveAmount=0,this.curveType="arc",this.curveFlip=!1,this.curveSpread=!1,this.background=!1,this.backgroundOffset=0,this.backgroundPunch=!1,this.backgroundColor="#555555",this.backgroundType=n.BACKGROUND_FULL,this.outline=!1,this.outlinePunch=!1,this.outlineColor="#555555",this.outlineSize=.3,this.outlineDistance=0,this.outlineDirection=305,this.shadow=!1,this.shadowBlur=.3,this.shadowColor="#444444",this.shadowAlpha=.3,this.shadowDistance=.3,this.shadowDirection=160,this.font=e,this.size=t,s&&this.measureText()}setSize(e){this.size=e,this.measureText()}setFont(e){this.font=e,this.measureText()}measureText(){if(this.size<1)return;var e=document.createElement("canvas");e.width=20*this.size,e.height=Math.round(2*this.size);var t=e.getContext("2d");t.textBaseline="top",t.fillStyle="white",t.font=this.getCssFont(),t.fillText("SfTgMjkHpqLRnliIFIABCDEFGIJKNOPQSUVXYZabcdeghmnorstuvxyz",0,Math.round(.5*this.size)),t=void 0;const s=a.l(e);this.ascent=s.y-Math.round(.5*this.size),this.height=s.height,this.height<=0&&this.measureTextFallback(),this.padding=Math.round(.2*this.height)}measureTextFallback(){var e=document.createElement("span");e.innerHTML="ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz",e.style.fontFamily=this.font,e.style.fontSize=this.size+"px";var t=document.createElement("div");t.style.display="inline-block",t.style.width="1px",t.style.height="0px";var s=document.createElement("div");s.appendChild(e),s.appendChild(t),(0,i.ZP)("workspace").appendChild(s);try{t.style.verticalAlign="baseline",this.ascent=t.offsetTop-e.offsetTop+1,t.style.verticalAlign="bottom",this.height=t.offsetTop-e.offsetTop+1}finally{s.remove()}}getLineSpacing(){var e;return Math.ceil(this.height*Number(null!==(e=this.lineSpace)&&void 0!==e?e:0))}getLetterSpacing(){var e;return Math.ceil(this.height/2*Number(null!==(e=this.letterSpace)&&void 0!==e?e:0))}getCssFont(e=this.size){return(this.italic?"italic ":"")+(this.bold?"bold ":"")+e+"px "+this.font}clone(){const e=Object.create(n.prototype);return Object.assign(e,this)}equalTo(e){return!!e&&(this.font===e.font&&this.size===e.size&&this.lineSpace===e.lineSpace&&this.letterSpace===e.letterSpace&&this.bold===e.bold&&this.italic===e.italic&&this.uppercase===e.uppercase&&this.fillType===e.fillType&&this.fillValue===e.fillValue&&this.align===e.align&&this.curve===e.curve&&this.curveAmount===e.curveAmount&&this.curveType===e.curveType&&this.curveSpread===e.curveSpread&&this.curveFlip===e.curveFlip&&this.background===e.background&&this.backgroundPunch===e.backgroundPunch&&this.backgroundColor===e.backgroundColor&&this.backgroundType===e.backgroundType&&this.outline===e.outline&&this.outlinePunch===e.outlinePunch&&this.outlineSize===e.outlineSize&&this.outlineColor===e.outlineColor&&this.outlineDistance===e.outlineDistance&&this.outlineDirection===e.outlineDirection&&this.shadow===e.shadow&&this.shadowBlur===e.shadowBlur&&this.shadowColor===e.shadowColor&&this.shadowAlpha===e.shadowAlpha&&this.shadowDistance===e.shadowDistance&&this.shadowDirection===e.shadowDirection)}}n.BACKGROUND_FULL="full",n.BACKGROUND_LINE="line",n.BACKGROUND_WORD="word"},4820:(e,t,s)=>{s.d(t,{Lt:()=>o,ZP:()=>l,nS:()=>r});var i=s(3947),a=s(1030),n=s(3673);function o(e,t){(0,a.Z)("setting-"+e,t.toString());const s=window.localStorage.getItem("user-settings"),i=JSON.parse(s||"{}");h[e]=i[e]=t,window.localStorage.setItem("user-settings",JSON.stringify(i)),document.dispatchEvent(new CustomEvent("user-setting-updated",{detail:e}))}function r(e){let t=e.toHEX(),s=h.oldColor.findIndex((e=>e===t));s>-1?h.oldColor.splice(0,0,h.oldColor.splice(s,1)[0]):(h.oldColor.pop(),h.oldColor.unshift(t)),o("oldColor",h.oldColor)}const h=function(){const e={product:"",api:!1,debug:"",premium:"",locktarget:!1,cdnUrl:"",accent:"default",workspace:"default",allTooltip:!1,autoSelect:!0,showGuides:!0,snapToGuides:!0,smoothScaling:!0,askToAddLayer:!0,askToPreResize:!0,scrollMode:"zoom",maxHistoryUndos:25,boxBarXState:"maximized",panelFloating:!1,panelNavigator:!0,panelLayer:!0,panelHistory:!0,mainColor:"#ffffff",altColor:"#000000",oldColor:["#A8534B","#EC9D75","#F9D697","#DCE6A7","#9ADFB0","#57CBAB","#38A793","#5A5E5A"],gradients:[],dialogPos:new n.Z(0,0),user:void 0,adyenClientKey:"",eligibleFreeTrial:!1,lastNewsCheck:"1970-01-01T00:00:00Z"};return Object.assign(e,(()=>{const e=window.localStorage.getItem("user-settings");return JSON.parse(e||"{}")})()),Object.assign(e,(()=>{const e=new URL(window.location.href),t={};return e.searchParams.forEach(((e,s)=>{t[s]=e})),t})()),Object.assign(e,(()=>{const e=(0,i.ZP)("config_data");if(e&&e.innerText){let e=JSON.parse((0,i.ZP)("config_data").innerText);return(0,i.ZP)("config_data").remove(),e}return{}})()),e.api=e.locktarget=!!e.image&&!!e.referrer,"pixlr.com"!==location.hostname&&"true"===e.premium&&(e.user.subscription=!0,e.user.subscriptionType="premium"),e}(),l=h},5700:(e,t,s)=>{s.d(t,{Z:()=>r});var i=s(6548),a=s(3947),n=s(1030),o=s(1951);class r{constructor(e){this.showPremium=()=>{this.close(),new o.Z(this.stage,"")},this.close=()=>{this.pop.remove(),this.modal.remove(),this.pop=void 0,this.modal=void 0},(0,n.Z)("ads","pop"),this.modal=(0,a.T)("div",{id:"modal-pop",className:"modal dim centercenter"}),document.body.appendChild(this.modal);let t=(0,a.T)("div",{id:"pop-ad"}),s=(0,a.T)("div",{id:"pop-sales"},(0,i.Z)("premiumSkipAds"),(0,a.T)("span",{className:"anchor",style:"padding-left:6px",onclick:this.showPremium},(0,i.Z)("premiumTryFree")));this.pop=(0,a.T)("div",{id:"pop"},t,s,(0,a.T)("img",{id:"pop-close",src:"/img/icon/close.svg",style:"display:none",onclick:()=>this.close()})),this.modal.append(this.pop),t.appendChild((0,a.T)("iframe",{src:"/dad/pop/",frameBorder:"0",scrolling:"no",style:"width:300px;height:250px;overflow:hidden;"})),(0,n.Z)("ads","pop"),window.setTimeout((()=>{(0,a.ZP)("pop-close").style.display="block"}),3e3)}}},5402:(e,t,s)=>{s.d(t,{Z:()=>o});var i=s(3947),a=s(1030),n=s(4820);class o{constructor(){this.INTERVALL=11e4,this.timeToSneak=()=>{if(!(document.body.offsetWidth<750||n.ZP.user.subscription))if(this.stamp){if(this.stamp+this.INTERVALL<(new Date).getTime()&&(this.stamp=(new Date).getTime(),!(0,i.ZP)("sneaky"))){let e=(0,i.T)("div",{id:"sneaky-ad"}),t=(0,i.T)("div",{id:"sneaky"},e,(0,i.T)("img",{id:"sneaky-close",src:"/img/icon/close.svg",style:"display:none",onclick:()=>this.close()}));(0,i.ZP)("workspace").append(t),e.appendChild((0,i.T)("iframe",{src:"/dad/sneaky/",frameBorder:"0",scrolling:"no",style:"width:728px;height:90px;overflow:hidden;"})),(0,a.Z)("ads","sneaky"),window.setTimeout((()=>{(0,i.ZP)("sneaky-close").style.display="block"}),3e3)}}else this.stamp=(new Date).getTime()},this.close=()=>{var e;this.stamp=(new Date).getTime(),null===(e=(0,i.ZP)("sneaky"))||void 0===e||e.remove()}}}},7909:(e,t,s)=>{s.d(t,{Z:()=>n});var i=s(3655),a=s(3947);class n{constructor(e=!0){this.setContent=(...e)=>{e[0]instanceof HTMLElement?this.content.append(...e):this.content.innerHTML+=e[0]},this.position=()=>{this.dialog.style.left=Math.round((this.modal.offsetWidth-this.dialog.offsetWidth)/2)+"px",this.dialog.style.top=Math.round((this.modal.offsetHeight-this.dialog.offsetHeight)/2)+"px";let e=this.dialog.getBoundingClientRect(),t=this.modal.getBoundingClientRect();e.bottom>t.bottom&&(this.dialog.style.top=t.height-e.height<0?"0px":t.height-e.height+"px"),e.right>t.right&&(this.dialog.style.left=t.width-e.width<0?"0px":t.width-e.width+"px"),this.dialog.offsetTop<0&&(this.dialog.style.top="0px"),this.dialog.offsetLeft<0&&(this.dialog.style.left="0px")},this.keyDown=e=>{"Escape"!==e.key&&"Esc"!==e.key||this.cleanUp()},this.cleanUp=()=>{(0,a.ZP)("workspace")&&(0,a.ZP)("workspace").classList.remove("blur"),(0,a.ZP)("home")&&(0,a.ZP)("home").classList.remove("blur"),document.removeEventListener("keydown",this.keyDown,!1),this.dialog.remove(),this.dialog=null,this.modal.remove(),this.modal=null},this.mid=i.Zd(),(0,a.ZP)("workspace")&&(0,a.ZP)("workspace").classList.add("blur"),(0,a.ZP)("home")&&(0,a.ZP)("home").classList.add("blur"),this.modal=(0,a.T)("div",{id:"modal-"+this.mid,className:"modal"}),e&&this.modal.classList.add("dim"),document.body.appendChild(this.modal),this.dialog=(0,a.T)("div",{className:"announce"}),this.modal.appendChild(this.dialog),this.content=(0,a.T)("div",{className:"content"}),this.dialog.append((0,a.T)("img",{id:"announce-close"+this.mid,className:"close",src:"/img/icon/close.svg",onclick:()=>this.cleanUp()}),this.content),document.addEventListener("keydown",this.keyDown,!1)}}},4652:(e,t,s)=>{s.d(t,{Z:()=>h});var i=s(6548),a=s(3947),n=s(7909),o=s(1030),r=s(4820);class h extends n.Z{constructor(e,t=0){if(super(),this.selectedIndex=t,this.dialog.classList.add("news-dialog"),e.length>1){const s=e.map(((s,i)=>(0,a.T)("a",{id:`news-menu-item-${i}`,className:i===t?"item selected":"item",href:"javascript:;",onclick:()=>{(0,a.ZP)(`news-menu-item-${this.selectedIndex}`).classList.remove("selected"),(0,a.ZP)(`news-menu-item-${i}`).classList.add("selected"),(0,a.ZP)("news-current").replaceWith(l(e[i])),this.selectedIndex=i,(0,o.Z)("news-select")}},(0,a.T)("div",{className:"block"}),(0,a.T)("div",s.title))));this.setContent((0,a.T)("div",{className:"news-split"},(0,a.T)("div",{className:"news-menu"},(0,a.T)("div",{className:"headline"},(0,i.Z)("whatsNew")),...s),l(e[t],this.position)))}else this.setContent(l(e[0],this.position));this.position(),(0,r.Lt)("lastNewsCheck",(new Date).toISOString())}}function l(e,t){const s=new Date(e.publishDate);let n;if(e.video){const s=()=>{const t=Math.max(360,i.getBoundingClientRect().height),s=`https://www.youtube.com/embed/${e.video}?autoplay=1&modestbranding=1`;n.style.height=t+"px",i.style.filter="blur(6px)",(0,o.Z)("news-play"),n.append((0,a.T)("div",{className:"player-container"},(0,a.T)("iframe",{width:"640",height:"360",src:s,className:"player",allow:"autoplay"})))};let i=(0,a.T)("img",{className:"news-cover",src:e.cover,onload:t}),r=(0,a.T)("div",{className:"play-button",onclick:s},(0,a.T)("img",{src:"/img/icon/play-circle.svg"}));n=(0,a.T)("div",{className:"cover-stack"},i,r)}else n=(0,a.T)("img",{className:"news-cover",src:e.cover,onload:t});return(0,a.T)("div",{id:"news-current"},n,(0,a.T)("div",{className:"news-content"},(0,a.T)("div",{className:"news-title"},(0,a.T)("span",{className:"news-headline"},e.title),(0,a.T)("span",s.toLocaleDateString())),(0,a.T)("div",{className:"news-text"},e.text),e.learnMore?(0,a.T)("a",{className:"button positive",href:e.learnMore,target:"_blank",onmousedown:()=>{(0,o.Z)("news-learnmore")}},(0,i.Z)("learnMore")):null))}},1951:(e,t,s)=>{s.d(t,{Z:()=>d});var i=s(3947),a=s(6548),n=s(1030),o=s(7909),r=s(4820),h=s(6577),l=s(6854),c=s(2409);class d extends o.Z{constructor(e,t){super(!0),this.hasPlayBilling=!1,this.isPlayBilling=async()=>{this.hasPlayBilling=await(0,c.Ev)(),this.hasPlayBilling&&((0,i.ZP)("play-info").style.display="block")},this.showAuth=async()=>{(0,i.ZP)("bounce-content").style.display="none",(0,i.ZP)("bounce-entry").style.display="flex",new l.k("login",{method:"embed",holder:(0,i.ZP)("bounce-entry")})},this.stage=e,(0,n.Z)("premium-bounce","show"),this.content.style.minHeight="600px",this.isPlayBilling();let s="",o="premium.jpg";switch(t){case"FONT":s=(0,a.Z)("premiumFontSalesPitch"),o="premium-font.webp";break;case"CUTOUT":s=(0,a.Z)("premiumCutoutSalesPitch"),o="premium-cutout.webp";break;case"ELEMENT":s=(0,a.Z)("premiumElementSalesPitch"),o="premium-element.webp";break;case"STUDIO":s=(0,a.Z)("premiumStudioSalesPitch"),o="premium-studio.webp";break;case"BATCH":s=(0,a.Z)("premiumBatchSalesPitch"),o="premium-batch.webp";break;case"PHOTOMASH":s=(0,a.Z)("premiumPhotomashSalesPitch"),o="premium-studio.webp"}this.setContent(`\n            <div id="bounce-content" style="display:flex;flex-direction:column;width:50%;padding:30px;">\n\n                <div class="premium-tag" title="premium"><img src="/img/icon/premium.svg"></div>\n                   \n                <h1 class="pad-30">${(0,a.Z)("premiumBounceTitle")}</h1>\n\n                <p class="pad-20">${s}</p>\n\n                <p class="pad-30" style="text-align:left;font-weight:bold">${(0,a.Z)("premiumFeatureAlso")}</p>\n\n                <ul>\n                    <li>${(0,a.Z)("premiumFeaturePitchOne")}</li>\n                    <li>${(0,a.Z)("premiumFeaturePitchTwo")}</li>\n                    <li>${(0,a.Z)("premiumFeaturePitchThree")}</li>\n                    <li>${(0,a.Z)("premiumFeaturePitchFour")}</li>\n                    <li>${(0,a.Z)("premiumFeaturePitchFive")}</li>\n                </ul>\n\n                <button target="_blank" id="premium-go-now" style="margin-top:auto" class="button big green w-100">${(0,a.Z)("try30DayFreePremium")}</button>\n                <div id="play-info" class="pad-10" style="display:none;font-size:12px;font-style:italic">\n                    *30 day free trial is only eligible for new users and can only be claimed once per customer.\n                </div>\n                <p class="pad-20 center" id="one-of-us">${(0,a.Z)("alreadyMember")} <a id="premium-auth" class="link" style="cursor:pointer">${(0,a.Z)("logInNow")}</a></p>\n            </div>\n            <div id="bounce-entry" style="display:none;flex-direction:column;width:50%;"></div>\n            <div style="width:50%;background-image:url(/img/misc/${o});background-repeat:no-repeat;background-size:cover"></div>\n        `),"guest"!==r.ZP.user.name?((0,i.ZP)("one-of-us").style.display="none",(0,i.ZP)("premium-go-now").addEventListener("click",(async()=>{if(this.hasPlayBilling){await(0,c.V)(!1,null)&&(this.cleanUp(),setTimeout((()=>{e.unblock()}),2500))}else this.cleanUp(),new h.Z(this.stage,"subscription",{bounceSource:"premiumbounce",bounceType:t,plan:"premium-monthly"})}),!0)):((0,i.ZP)("premium-auth").addEventListener("click",this.showAuth,!0),(0,i.ZP)("premium-go-now").addEventListener("click",this.showAuth,!0)),this.position()}}},840:(e,t,s)=>{s.d(t,{Z:()=>d});var i=s(3947),a=s(6548),n=s(1030),o=s(7909),r=s(4820),h=s(6577),l=s(6854),c=s(2409);class d extends o.Z{constructor(e){super(!0),this.hasPlayBilling=!1,this.checkPlayBilling=async()=>{this.hasPlayBilling=await(0,c.Ev)(),this.hasPlayBilling&&((0,i.ZP)("gpay-info").style.display="block")},this.showAuth=async()=>{(0,i.ZP)("bounce-content").style.display="none",(0,i.ZP)("bounce-entry").style.display="flex",new l.k("login",{method:"embed",holder:(0,i.ZP)("bounce-entry")})},this.stage=e,(0,n.Z)("premium-bounce","template"),this.setContent(`\n            <div id="bounce-content" style="display:flex;width:50%;padding:30px;flex-direction:column;">\n\n                <div class="premium-tag" title="premium"><img src="/img/icon/premium.svg"></div> \n\n                <h1 class="pad-40">${(0,a.Z)("premiumTemplate")}</h1>\n\n                <p class="pad-10">${(0,a.Z)("premiumTemplateSalesPitch")}</p>\n\n                <div style="display:flex;flex-direction:column;flex-grow:1;padding-bottom:10px;">\n                    <a id="premium-one-time" class="button big green w-100" style="margin-top:auto">${(0,a.Z)("premiumOneTime")} ${"USD"===r.ZP.user.currency?"$":""}1</a>\n                    <a id="premium-go-now" class="button big green outline pad-15 w-100">${(0,a.Z)("try30DayFreePremium")}</a>\n                    <div id="gpay-info" class="pad-10 center" style="display:none;font-size:12px;font-style:italic">\n                        *30 day free trial is only eligible for new users and can only be claimed once per customer.\n                    </div>\n                    <p class="pad-30 center" id="one-of-us">${(0,a.Z)("alreadyMember")} <a id="premiumbounce-auth" class="link" style="cursor:pointer">${(0,a.Z)("logInNow")}</a></p>\n                </div>\n            </div>\n            <div id="bounce-entry" style="display:none;flex-direction:column;width:50%;"></div>\n            <div id="bounce-template-holder" class="left-panel">\n\n            </div>\n        `),(0,i.ZP)("bounce-template-holder").appendChild(this.stage.getOutputCanvas()),"guest"===r.ZP.user.name?((0,i.ZP)("premium-one-time").addEventListener("click",this.showAuth),(0,i.ZP)("premium-go-now").addEventListener("click",this.showAuth)):((0,i.ZP)("one-of-us").style.display="none",(0,i.ZP)("premium-one-time").addEventListener("click",(async()=>{var t,s,i;if(this.hasPlayBilling){await(0,c.V)(!0,null!==(i=null===(s=null===(t=this.stage.fresco)||void 0===t?void 0:t.templateMeta)||void 0===s?void 0:s.templateId)&&void 0!==i?i:null)&&(this.cleanUp(),setTimeout((()=>{e.unblock()}),2500))}else this.cleanUp(),new h.Z(this.stage,"template",{bounceSource:"premiumtemplatebounce"})})),(0,i.ZP)("premium-go-now").addEventListener("click",(async()=>{if(this.hasPlayBilling){await(0,c.V)(!1,null)&&(this.cleanUp(),setTimeout((()=>{e.unblock()}),2500))}else this.cleanUp(),new h.Z(this.stage,"subscription",{bounceSource:"premiumtemplatebounce"})}))),(0,i.ZP)("premiumbounce-auth").addEventListener("click",this.showAuth),this.checkPlayBilling(),this.position()}}},6995:(e,t,s)=>{s.d(t,{Z:()=>h});var i=s(3947),a=s(6548),n=s(5934),o=s(1030),r=s(7909);class h extends r.Z{constructor(e,t){super(!0),this.loadTemplate=async()=>{this.cleanUp(),await n.$k(this.stage,this.template)},(0,o.Z)("template-preview",t.id),this.stage=e,this.template=t;let s="";this.template.keywords.forEach((e=>{s+='<a href="#template&keyword='+e+'" class="tag">'+e+"</a> "})),this.setContent(`\n            <div style="width:500px;height:550px;padding:20px;background: linear-gradient(43deg, #282828 0%, #424242 100%);background-color: #333333;" class="centercenter">\n                <img src="${this.template.preview}" style="max-height:100%; max-width:100%; box-shadow: 6px 6px 12px rgb(0 0 0 / 30%);">\n            </div>\n            <div class="center" style="width:340px;display:flex;flex-direction:column;padding:20px;background-color:rgba(0,0,0,0.05);"> \n                <div style="flex-grow:2">\n                    <h2 class="pad-30">${this.template.name}</h2>\n                    <h3><a href="#template&category=${this.template.category}" style="color:#444;">${(0,a.Z)(this.template.category)}</a></h3>\n                    <h4>${this.template.ratio.width} x ${this.template.ratio.height} px</h4>\n                    <p class="pad-20">${s}</p>\n                </div>\n                <div id="load-template-preview" class="button big green pad-50">${(0,a.Z)("useTemplate")}</div>\n                <div class="pad-20"><a class="link" id="close-template-preview" style="font-weight:bold;"> ${(0,a.Z)("close")}</a></div>\n            </div>\n        `),t.premium?this.setContent('<div class="premium-tag" title="premium"><img src="/img/icon/premium.svg"></div>'):this.setContent('<div class="free-tag" title="free">'+(0,a.Z)("free")+"</div>"),(0,i.ZP)("load-template-preview").addEventListener("click",this.loadTemplate,!0),(0,i.ZP)("close-template-preview").addEventListener("click",this.cleanUp,!0),this.position()}}},1126:(e,t,s)=>{s.d(t,{Z:()=>g});var i=s(3655),a=s(3947),n=s(6817),o=s(6548),r=s(3673),h=s(4188),l=s(2257),c=s(1726),d=s(4178),u=s(972);class p{constructor(e,t){this.stage=e,this.angleChange=()=>{let e=Number(this.angle.value.replace("",""));e<0&&(e=0),e>360&&(e=360),this.brush.settings.angle=Math.round(e),this.updatePreview(!1)},this.updatePreview=e=>{this.brush.settings.softness=this.softness.getValue(),this.brush.settings.distance=this.distance.getValue(),this.brush.settings.size=this.size.getValue()>125&&e?125:this.size.getValue(),this.brush.generate();const t=this.preview.getContext("2d");t.clearRect(0,0,t.canvas.width,t.canvas.height);const s=n.Z.bestFit(this.brush.canvas.width,this.brush.canvas.height,t.canvas.width,t.canvas.height);t.drawImage(this.brush.canvas,s.x,s.y,s.width,s.height),this.renderStroke(),this.renderOutline()},this.renderOutline=()=>{const e=this.raster.getContext("2d");e.clearRect(0,0,120,120),e.save(),e.translate(60,60),e.rotate(-this.brush.settings.angle*Math.PI/180);const t=45,s=Math.round(90*this.brush.settings.aspect)/2;e.lineWidth=2,e.fillStyle="#999",e.strokeStyle="#444",e.beginPath(),e.moveTo(0,s),e.lineTo(0,-s),e.stroke(),e.beginPath(),e.moveTo(t,0),e.lineTo(-45,0),e.stroke(),e.lineWidth=2,e.strokeStyle="#999",e.beginPath(),e.ellipse(0,0,t,s,0,0,2*Math.PI),e.stroke(),e.beginPath(),e.ellipse(0,s,6,6,0,0,2*Math.PI),e.fill(),e.beginPath(),e.ellipse(0,-s,6,6,0,0,2*Math.PI),e.fill(),e.beginPath(),e.moveTo(50,-6),e.lineTo(50,6),e.lineTo(58,0),e.lineTo(50,-6),e.fill(),e.restore()},this.renderStroke=()=>{var e=this.stroke.getContext("2d");e.imageSmoothingQuality="high",e.imageSmoothingEnabled=!0;const t=n.Z.bestFit(this.brush.canvas.width,this.brush.canvas.height,30,30),s=Math.floor(this.brush.getStep()*(t.width/this.brush.canvas.width))||1;var i=0,a=2*Math.PI/((e.canvas.width-40)/s);let o=~~(t.width/2),r=~~(t.height/2);e.clearRect(0,0,e.canvas.width,e.canvas.height);for(let n=20;n<=e.canvas.width-20;n+=s)e.drawImage(this.brush.canvas,n-o,30-12*Math.sin(i)-r,t.width,t.height),i+=a},this.setUp=()=>{let e=this.brushpod.container.getBoundingClientRect(),t=this.stage.workspace.getBoundingClientRect();this.modal.addEventListener("click",(e=>{e.stopPropagation(),e.preventDefault(),e.target===e.currentTarget&&this.cleanUp()}),!1),this.container.style.top=e.bottom-3-t.y+"px",this.container.style.left=e.x-t.x+"px",this.container.style.height="450px",this.container.style.display="flex",this.size=new h.Z("brush-size",{label:(0,o.Z)("size"),range:[1,100,1e3],step:[1,10],stops:[0,.4,1],defaultValue:this.brush.settings.size,labelFormat:e=>e+"px",onChange:()=>{this.updatePreview(!0)},onEnd:()=>{this.updatePreview(!1)}}),this.softness=new h.Z("brush-softness",{label:(0,o.Z)("softness"),defaultValue:this.brush.settings.softness,labelFormat:e=>(100*e).toFixed(0)+"%",labelParse:e=>parseInt(e,10)/100,onChange:()=>{this.updatePreview(!0)},onEnd:()=>{this.updatePreview(!1)}}),this.distance=new h.Z("brush-step",{range:[0,3],label:(0,o.Z)("step"),defaultValue:this.brush.settings.distance,labelParse:e=>parseInt(e,1)/100,labelFormat:e=>(100*e).toFixed(0)+"%",onChange:()=>{this.updatePreview(!0)},onEnd:()=>{this.updatePreview(!1)}}),this.angle=(0,a.ZP)("brush-angle"),this.angle.value=this.brush.settings.angle+"",this.angle.addEventListener("input",this.angleChange,!0),this.raster.addEventListener("mousedown",this.rasterDown,!1),this.populatePresets(),this.updatePreview(!1)},this.rasterDown=e=>{const t=this.raster.getBoundingClientRect(),s=new r.Z(e.clientX-Math.round(t.x),e.clientY-Math.round(t.y));this.matrix=new c.Z,this.matrix.reset(),this.matrix.translate(new r.Z(60,60)),this.matrix.rotate(-this.brush.settings.angle*Math.PI/180),this.matrix.invert(),this.down=this.matrix.transformPoint(s),this.down.x>40&&this.down.y>-10&&this.down.y<10?this.target="rotate":this.down.x>-10&&this.down.x<10&&(this.target="size",this.down=s),void 0!==this.target&&(document.addEventListener("mousemove",this.rasterMove,!1),document.addEventListener("mouseup",this.rasterUp,!1))},this.rasterMove=e=>{const t=this.raster.getBoundingClientRect();let s=new r.Z(e.clientX-Math.round(t.x),e.clientY-Math.round(t.y));if("size"===this.target)this.matrix.reset(),this.matrix.translate(new r.Z(60,60)),this.matrix.rotate(-this.brush.settings.angle*Math.PI/180),this.matrix.invert(),s=this.matrix.transformPoint(s),this.brush.settings.aspect=i.uZ(Math.abs(s.y)/45,.1,1);else{let e=-180/Math.PI*Math.atan2(s.y-60,s.x-60);e>360?e-=360:e<0&&(e+=360),this.brush.settings.angle=e,this.angle.value=Math.round(this.brush.settings.angle)+""}this.updatePreview(!1)},this.rasterUp=e=>{this.down=void 0,this.target=void 0,this.matrix=void 0,document.removeEventListener("mousemove",this.rasterMove,!1),document.removeEventListener("mouseup",this.rasterUp,!1)},this.populatePresets=()=>{this.addPresetCollection("basic-circle",(0,o.Z)("basicCircular"),!1,[new u.Z("circle",1,.02),new u.Z("circle",5,.02),new u.Z("circle",10,.02),new u.Z("circle",15,.02),new u.Z("circle",20,.02),new u.Z("circle",30,.02),new u.Z("circle",50,.02),new u.Z("circle",70,.02),new u.Z("circle",100,.01),new u.Z("circle",200,.01),new u.Z("circle",400,.01),new u.Z("circle",500,.01),new u.Z("circle",5,.25),new u.Z("circle",10,.25),new u.Z("circle",20,.25),new u.Z("circle",30,.25),new u.Z("circle",40,.25),new u.Z("circle",50,.25),new u.Z("circle",70,.25),new u.Z("circle",100,.25),new u.Z("circle",150,.25),new u.Z("circle",200,.25),new u.Z("circle",400,.25),new u.Z("circle",500,.25),new u.Z("circle",5,.5),new u.Z("circle",10,.5),new u.Z("circle",20,.5),new u.Z("circle",30,.5),new u.Z("circle",40,.5),new u.Z("circle",50,.5),new u.Z("circle",70,.5),new u.Z("circle",100,.5),new u.Z("circle",150,.5),new u.Z("circle",200,.5),new u.Z("circle",400,.5),new u.Z("circle",500,.5)]),this.addPresetCollection("basic-shapes",(0,o.Z)("basicShapes"),!1,[new u.Z("square",4,0),new u.Z("square",6,0),new u.Z("square",10,0),new u.Z("square",20,0),new u.Z("square",30,0),new u.Z("square",50,0),new u.Z("square",70,0),new u.Z("square",100,0),new u.Z("square",200,0),new u.Z("square",300,0),new u.Z("square",400,0),new u.Z("square",500,0),new u.Z("diamond",50,.8),new u.Z("diamond",100,.8),new u.Z("diamond",100,.8,1,0,.5,5),new u.Z("diamond",100,.8,1,0,.25,7),new u.Z("diamond",100,.01,1,45,.25,4,1.5),new u.Z("diamond",100,.01,1,0,.25,5,1.5),new u.Z("diamond",100,.01,1,0,.25,6,1.5),new u.Z("diamond",100,.01,1,0,.25,7,1.5),new u.Z("circle",10,.1,1,60,.2,2,.07),new u.Z("circle",20,.1,1,60,.2,2,.07),new u.Z("circle",50,.1,1,60,.2,2,.07),new u.Z("circle",100,.1,1,60,.2,2,.07),new u.Z("square",100,.8,1,0,.5,5),new u.Z("square",100,.8,1,0,.25,7),new u.Z("square",100,.01,1,45,.25,4,1.5),new u.Z("square",100,.01,1,0,.25,5,1.5),new u.Z("square",100,.01,1,0,.25,6,1.5),new u.Z("square",100,.01,1,0,.25,7,1.5),new u.Z("square",100,.01,1,0,1,5,1.5),new u.Z("square",100,.01,1,0,1,6,1.5),new u.Z("square",100,.01,1,0,1,7,1.5),new u.Z("circle",100,.01,1,0,.25,5,1.5),new u.Z("circle",100,.01,1,0,.25,6,1.5),new u.Z("circle",100,.01,1,0,.25,7,1.5)])},this.addPresetCollection=(e,t,s,n)=>{const o=(0,a.T)("div"),r=(0,a.T)("div",{className:"toggle"}),h=(0,a.ZP)("brush-editor-presets-ss-content").hasChildNodes()?"subline pad-10":"subline";o.append((0,a.T)("input",{type:"checkbox",className:"toggle-check",checked:!0,id:"brush-pack-"+e}),(0,a.T)("label",{className:h,htmlFor:"brush-pack-"+e},t,(0,a.T)("span",{className:"arrow"})),r);const c=new l.Z(new u.Z);n.forEach((e=>{const t=(0,a.T)("div",{className:"brush-setting-pod"});t.setAttribute("data",JSON.stringify(e)),t.addEventListener("click",this.selectPreset,!0),t.appendChild((0,a.T)("span",{},e.size.toString())),e.size>30&&(e.size=30),c.settings=e,c.generate();const s=i.dN(c.canvas);s.classList.add("ic"),t.appendChild(s),r.append(t)})),(0,a.ZP)("brush-editor-presets-ss-content").append(o)},this.selectPreset=e=>{var t;null===(t=this.selected)||void 0===t||t.classList.remove("active"),this.selected=e.currentTarget,this.selected.classList.add("active"),this.brush.setSettingsString(this.selected.getAttribute("data")),this.size.setValue(this.brush.settings.size),this.softness.setValue(this.brush.settings.softness),this.distance.setValue(this.brush.settings.distance),this.angle.value=Math.round(this.brush.settings.angle)+"",this.updatePreview(!1)},this.resizeStart=e=>{this.down=new r.Z(this.container.clientHeight,e.y)},this.resizeMove=e=>{const t=this.down.x+(e.y-this.down.y);this.container.style.height=(t<320?320:t)+"px"},this.cleanUp=()=>{this.angle.removeEventListener("input",this.angleChange,!0),this.raster.removeEventListener("mousedown",this.rasterDown,!1),this.brushpod.update(),this.size.cleanUp(),this.softness.cleanUp(),this.distance.cleanUp(),this.container.remove(),this.modal.remove()},this.brushpod=t,this.brush=t.brush,this.modal=this.stage.workspace.appendChild((0,a.T)("div",{id:"brush-editor-modal",className:"modal"}));let s=(0,a.T)("div",{className:"tab-10"}),p=(0,a.T)("div",{style:"flex-grow:1"});this.presets=(0,a.T)("div",{id:"brush-editor-presets",className:"brush-editor-presets"}),this.container=(0,a.T)("div",{id:"brush-editor",className:"brush-editor"},(0,a.T)("div",{id:"brush-editor-top",className:"brush-editor-top"},s,p),this.presets),this.stage.workspace.appendChild(this.container),this.preview=(0,a.T)("canvas",{id:"brush-preview",className:"brush-preview ic",width:120,height:120}),this.raster=(0,a.T)("canvas",{id:"brush-raster",className:"brush-raster ic",width:120,height:120}),this.stroke=(0,a.T)("canvas",{id:"brush-stroke",className:"brush-stroke ic",width:252,height:60});const g=(0,a.T)("div",{className:"switch-icon-field stretch",style:"display:none"},(0,a.T)("input",{type:"radio",id:"brush-shape-circle",name:"brush-shape",value:"circle"}),(0,a.T)("label",{htmlFor:"brush-shape-circle"},(0,a.T)("img",{src:"/img/icon/type-circle.svg",className:"ic"})),(0,a.T)("input",{type:"radio",id:"brush-shape-square",name:"brush-shape",value:"square"}),(0,a.T)("label",{htmlFor:"brush-shape-square"},(0,a.T)("img",{src:"/img/icon/type-square.svg",className:"ic"})),(0,a.T)("input",{type:"radio",id:"brush-shape-diamond",name:"brush-shape",value:"diamond"}),(0,a.T)("label",{htmlFor:"brush-shape-diamond"},(0,a.T)("img",{src:"/img/icon/type-diamond.svg",className:"ic"})));s.append((0,a.T)("div",{style:"display:flex;width:"},(0,a.T)("div",{className:"brush-preview-holder"},this.preview),(0,a.T)("div",{className:"brush-raster-holder"},this.raster)),(0,a.T)("div",{className:"brush-stroke-holder"},this.stroke),g,(0,a.T)("input",{id:"brush-angle",type:"text",style:"padding:0px !important;width:30px !important;height:14px !important;font-size:10px;display:block;position:absolute;top:117px;right:12px;border:none !important;background:none !important;text-align:right;"})),p.append((0,a.T)("div",{style:"height:122px;",className:"brush-control-holder"},(0,a.T)("div",{id:"brush-size"}),(0,a.T)("div",{id:"brush-softness",className:"pad-4"}))),p.append((0,a.T)("div",{style:"height:62px;margin-top:10px",className:"brush-control-holder"},(0,a.T)("div",{id:"brush-step"}))),new d.Z(this.presets);const m=(0,a.T)("img",{id:"brush-resize",src:"/img/icon/three-dot.svg",className:"resize ic"});(0,a.Rg)(m,this.resizeStart,this.resizeMove),this.container.append(m),this.setUp()}}class g{constructor(e,t,s,o){this.stage=e,this.stepSoftness=e=>{this.brush.settings.softness=i.uZ(this.brush.settings.softness+e,0,1),this.brush.generate(),this.update()},this.stepSize=e=>{this.brush.settings.size=i.uZ(this.brush.settings.size+e,1,999),this.brush.generate(),this.update()},this.update=(e=!0)=>{let t=this.preview.getContext("2d");t.imageSmoothingQuality="high",t.imageSmoothingEnabled=!0,t.clearRect(0,0,t.canvas.width,t.canvas.height);const s=n.Z.bestFit(this.brush.canvas.width,this.brush.canvas.height,t.canvas.width,t.canvas.height);t.drawImage(this.brush.canvas,s.x,s.y,s.width,s.height),this.size.innerText=this.brush.settings.size.toString(),e&&this.callback&&this.callback(this.brush)},this.toggle=()=>{new p(this.stage,this)},this.cleanUp=()=>{this.container.setAttribute("data",this.brush.getSettingsString()),this.container.removeEventListener("click",this.toggle,!1)},this.name=t,this.brush=s,this.callback=o,this.container=(0,a.ZP)(t),this.container.hasChildNodes()?(this.preview=(0,a.ZP)(t+"-canvas"),this.size=(0,a.ZP)(t+"-size"),this.container.hasAttribute("data")&&this.brush.setSettingsString(this.container.getAttribute("data"))):(this.container.classList.add("brush-pod"),this.preview=(0,a.T)("canvas",{id:t+"-canvas",width:32,height:32,className:"ic"}),this.container.append(this.preview),this.size=(0,a.T)("div",{id:t+"-size"}),this.container.append((0,a.T)("div",{id:t+"-hold"},this.size,(0,a.T)("img",{id:t+"-more",src:"/img/icon/more.svg",className:"ic"})))),this.container.addEventListener("click",this.toggle,!1),this.update(!1)}}},8093:(e,t,s)=>{s.d(t,{Z:()=>n});var i=s(3947),a=s(3655);class n{constructor(e){if(this.numSections=0,this.outerWidth=0,this.contentWidth=0,this.bind=a.d4(50,(()=>{if(this.outerWidth=this.outer.clientWidth,this.contentWidth=this.content.scrollWidth,this.contentWidth>this.outerWidth&&(this.forward.style.display="block"),this.numSections=Math.floor(this.contentWidth/this.outerWidth),this.indicator.innerHTML="",this.numSections>0)for(let e=0;e<=this.numSections;e++){const t=(0,i.T)("li");t.setAttribute("data",e.toString()),t.addEventListener("click",this.sectionClick),0===e&&t.classList.add("active"),this.indicator.append(t)}this.scoll()})),this.sectionClick=e=>{const t=Number(e.currentTarget.getAttribute("data"));this.outer.scrollTo(this.outerWidth*t,0)},this.forwardClick=()=>{this.outer.scrollBy(this.outerWidth,0)},this.backClick=()=>{this.outer.scrollBy(-this.outerWidth,0)},this.scoll=a.d4(50,(()=>{const e=Math.ceil(this.outer.scrollLeft/this.outerWidth);if(this.forward.style.display=e===this.numSections?"none":"block",this.back.style.display=this.outer.scrollLeft>0?"block":"none",this.numSections>0)for(let t=0;t<=this.numSections;t++)t===e?this.indicator.children[t].classList.add("active"):this.indicator.children[t].classList.remove("active")})),this.numItems=()=>this.content.children.length,this.addItem=e=>{this.content.appendChild(e)},this.clearItem=()=>{this.content.innerHTML=""},this.container=(0,i.ZP)(e),this.container.classList.add("carousel"),this.content=(0,i.T)("div",{id:e+"-content",className:"content"}),this.container.hasChildNodes())for(;this.container.firstChild;)this.content.appendChild(this.container.firstChild);this.outer=(0,i.T)("div",{id:e+"-outer",className:"outer"},this.content),this.indicator=(0,i.T)("ul",{id:e+"-indicator"}),this.back=(0,i.T)("div",{id:e+"-back",className:"back ic"}),this.forward=(0,i.T)("div",{id:e+"-forward",className:"forward ic"}),this.container.append(this.outer,this.indicator,this.back,this.forward),this.forward.addEventListener("click",this.forwardClick,!0),this.back.addEventListener("click",this.backClick,!0),this.outer.addEventListener("scroll",this.scoll,!0),this.forward.style.display="none",this.back.style.display="none",new ResizeObserver(this.bind).observe(this.content)}}},4211:(e,t,s)=>{s.d(t,{Z:()=>o});var i=s(3947),a=s(8776),n=s(5181);class o{constructor(e,t,s,o){this.previewColor=e=>{this.setColor(e),this.preview&&this.preview(this.color)},this.callbackColor=e=>{this.setColor(e),this.callback&&this.callback(this.color)},this.setColor=e=>{e instanceof a.Z?this.color=e:this.color=a.Z.fromHEX(e),this.container.style.backgroundColor=this.color.toHEX()},this.getColor=()=>this.color,this.picker=()=>{new n.Z(this.color,this.callbackColor,this.previewColor)},this.cleanUp=()=>{this.container.removeEventListener("click",this.picker,!1)},this.preview=o,this.callback=s,this.container=(0,i.ZP)(e),this.container.classList.add("color-pod"),this.container.addEventListener("click",this.picker,!1),this.setColor(t)}}},2397:(e,t,s)=>{s.d(t,{Z:()=>r});var i=s(3655),a=s(3947),n=s(3673),o=s(8776);class r{constructor(e,t=["#ffffff","#eb7d46","#b4eb46","#46eb7d","#46b4eb","#7d46eb","#eb46b4"],s,r=!0,h=220,l=100,c=!1){var d;if(this.activeColorPick=e=>{if((0,a.ZP)("modal-color-select"))return;const t=document.createElement("div");t.classList.add("modal"),t.id="modal-color-select",t.style.cursor="crosshair",document.body.appendChild(t),this.preview=document.createElement("div"),this.preview.classList.add("color-selector-preview"),this.preview.style.display="none",t.appendChild(this.preview),this.stageC=document.getElementsByClassName("canvas")[0],this.stageCanvas=i.dN(this.stageC),this.stageCanvasCTX=this.stageCanvas.getContext("2d"),t.addEventListener("click",this.removeColorPicker,!0),t.addEventListener("mousemove",this.pickerPreviewColor,!0)},this.pickerPreviewColor=e=>{let t=new n.Z(e.clientX,e.clientY);if(this.preview.style.top=t.y-60+"px",this.preview.style.left=t.x+10+"px",this.preview.style.display="block",t.x-=this.stageC.offsetLeft,t.y-=this.stageC.offsetTop,t.x<0||t.y<0||t.x>this.stageC.width||t.y>this.stageC.height)return void(this.preview.style.display="none");let s=this.stageCanvasCTX.getImageData(t.x,t.y,1,1).data;this.preview.style.backgroundColor=new o.Z(s[0],s[1],s[2]).toHEX()},this.removeColorPicker=e=>{(0,a.ZP)("modal-color-select").remove(),this.preview=null;let t=new n.Z(e.clientX,e.clientY);if(t.x-=this.stageC.offsetLeft,t.y-=this.stageC.offsetTop,t.x<0||t.y<0||t.x>this.stageC.width||t.y>this.stageC.height)return;let s=this.stageCanvasCTX.getImageData(t.x,t.y,1,1).data,i=new o.Z(s[0],s[1],s[2]);this.setHex(i.toHEX(),!0),this.updateColor(!0)},this.satMouseDown=e=>{e.stopPropagation(),document.addEventListener("mousemove",this.satMouseMove,!0),document.addEventListener("mouseup",this.satMouseUp,!0);var t=this.satSlide.getBoundingClientRect(),s=e.pageX-t.left,i=e.pageY-t.top;this.selectSat(s,i)},this.satMouseMove=e=>{e.stopPropagation();var t=this.satSlide.getBoundingClientRect(),s=e.pageX-t.left,i=e.pageY-t.top;this.selectSat(s,i)},this.satMouseUp=e=>{e.stopPropagation(),document.removeEventListener("mousemove",this.satMouseMove,!0),document.removeEventListener("mouseup",this.satMouseUp,!0)},this.satTouchStart=e=>{e.stopPropagation(),document.addEventListener("touchmove",this.satTouchMove,{passive:!1}),document.addEventListener("touchend",this.satTouchEnd,{passive:!1});var t=this.satSlide.getBoundingClientRect(),s=e.targetTouches[0].pageX-t.left,i=e.targetTouches[0].pageY-t.top;this.selectSat(s,i)},this.satTouchMove=e=>{e.stopPropagation();var t=this.satSlide.getBoundingClientRect(),s=e.targetTouches[0].pageX-t.left,i=e.targetTouches[0].pageY-t.top;this.selectSat(s,i)},this.satTouchEnd=e=>{e.stopPropagation(),document.removeEventListener("touchmove",this.satTouchMove),document.removeEventListener("touchend",this.satTouchEnd)},this.selectSat=(e,t)=>{e=i.uZ(e,0,this.width),t=i.uZ(t,0,this.height),this.hsb.s=e/this.width,this.hsb.b=1-t/this.height,this.setSat(),this.updateColor()},this.setSat=()=>{this.satKnob.style.left=this.hsb.s*this.width-9+"px",this.satKnob.style.top=(1-this.hsb.b)*this.height-9+"px"},this.hueMouseDown=e=>{e.stopPropagation(),document.addEventListener("mousemove",this.hueMouseMove,!0),document.addEventListener("mouseup",this.hueMouseUp,!0);var t=this.hueSlide.getBoundingClientRect(),s=e.pageX-t.left;this.selectHue(s)},this.hueMouseMove=e=>{e.stopPropagation();var t=this.hueSlide.getBoundingClientRect(),s=e.pageX-t.left;this.selectHue(s)},this.hueMouseUp=e=>{e.stopPropagation(),document.removeEventListener("mousemove",this.hueMouseMove,!0),document.removeEventListener("mouseup",this.hueMouseUp,!0)},this.hueTouchStart=e=>{e.stopPropagation(),this.hueSlide.addEventListener("touchmove",this.hueTouchMove,{passive:!1}),document.addEventListener("touchend",this.hueTouchEnd,{passive:!1});var t=e.target.getBoundingClientRect(),s=e.targetTouches[0].pageX-t.left;this.selectHue(s)},this.hueTouchMove=e=>{e.stopPropagation();var t=e.target.getBoundingClientRect(),s=e.targetTouches[0].pageX-t.left;this.selectHue(s)},this.hueTouchEnd=e=>{e.stopPropagation(),this.hueSlide.removeEventListener("touchmove",this.hueTouchMove),document.removeEventListener("touchend",this.hueTouchEnd)},this.selectHue=e=>{e=i.uZ(e,0,this.width),this.hsb.h=Math.round(e/this.width*360),this.setHue(),this.updateColor()},this.setHue=()=>{this.hueKnob.style.left=this.hsb.h/360*this.width-2+"px";let e=this.satSlide.getContext("2d");e.fillStyle=o.Z.fromHSB(this.hsb.h,1,1).toHEX(),e.fillRect(0,0,this.satSlide.width,this.satSlide.height);var t=e.createLinearGradient(0,0,this.satSlide.width,0);t.addColorStop(0,"rgba(255,255,255,1)"),t.addColorStop(1,"rgba(255,255,255,0)"),e.fillStyle=t,e.fillRect(0,0,this.satSlide.width,this.satSlide.height);var s=e.createLinearGradient(0,0,0,this.satSlide.height);s.addColorStop(0,"rgba(0,0,0,0)"),s.addColorStop(1,"rgba(0,0,0,1)"),e.fillStyle=s,e.fillRect(0,0,this.satSlide.width,this.satSlide.height)},this.selectPod=e=>{var t;let s=e.currentTarget;if(s.classList.contains("selected")&&!this.extended)"block"==this.selector.style.display?this.selector.style.display="none":(this.selector.style.display="block",this.setHex(s.getAttribute("data")));else{if(null===(t=this.selected)||void 0===t||t.classList.remove("selected"),this.selected=s,this.selected.classList.add("selected"),this.selector.style.display="block","empty"===s.getAttribute("data"))return void(this.callback&&this.callback(void 0));this.setHex(s.getAttribute("data"),!0)}},this.updateColor=(e=!0,t=!0)=>{clearTimeout(this.setTimer),this.color=o.Z.fromHSB(this.hsb.h,this.hsb.s,this.hsb.b);const s=this.color.toHEX();this.hexInput.value=s,t&&this.selected&&(this.selected.classList.contains("empty")&&(this.selected.classList.remove("selected"),this.selected=this.selected.nextElementSibling,this.selected.classList.add("selected")),this.selected.setAttribute("data",s),this.selected.style.backgroundColor=s),this.setTimer=setTimeout((()=>{this.callback&&e&&this.callback(this.color)}),50)},this.hexInputInput=e=>{/^#[0-9A-F]{6}$/i.test(this.hexInput.value)&&this.setHex(this.hexInput.value,!1)},this.hexInputBlur=e=>{/^#[0-9A-F]{6}$/i.test(this.hexInput.value)?this.setHex(this.hexInput.value,!0):this.hexInput.value=this.getHex()},this.setColor=(e,t=!1)=>{this.hsb=e.toHSB(),this.setHue(),this.setSat(),this.updateColor(t,!0)},this.setHex=(e,t=!1)=>this.setColor(o.Z.fromHEX(e),t),this.getHex=()=>this.color.toHEX(),this.getColor=()=>this.color,this.holder=e,this.callback=s,this.width=h,this.height=l,this.extended=c,this.holder.innerHTML="",this.presets=(0,a.T)("div",{className:"color-selector-presets",style:"width:"+this.width+"px"}),c){this.presets.classList.add("extended");let e=(0,a.T)("div",{className:"color-pod square empty"});e.addEventListener("click",this.selectPod,!1),e.setAttribute("data","empty"),void 0===t[0]&&(e.classList.add("selected"),this.selected=e),this.presets.appendChild(e)}for(let i=0;i<t.length;++i)if(void 0!==t[i]){let e=document.createElement("div");e.addEventListener("click",this.selectPod,!1),e.style.backgroundColor=t[i],e.setAttribute("data",t[i]),e.className=c?"color-pod square":"color-selector-pod",this.presets.appendChild(e),i+1===t.length&&e.classList.add("last"),0!==i||c||(this.selected=e,e.classList.add("selected"))}this.selector=(0,a.T)("div",{className:"color-selector-selector",style:"width:"+this.width+"px"}),c?(this.selector.style.display="block",this.presets.classList.add("pad-10"),this.holder.append(this.selector,(0,a.T)("div",{className:"splitter pad-10"}),this.presets)):(this.selector.classList.add("pad-16"),this.holder.append(this.presets,this.selector));let u=document.createElement("div");u.classList.add("color-selector-sat"),u.style.width=this.width+"px",u.style.height=this.height+"px",this.selector.appendChild(u),this.satSlide=i.vL(this.width,this.height),this.satSlide.addEventListener("mousedown",this.satMouseDown,!1),this.satSlide.addEventListener("touchstart",this.satTouchStart,{passive:!1}),this.satSlide.classList.add("color-selector-sat-slide"),u.appendChild(this.satSlide),this.satKnob=document.createElement("div"),this.satKnob.classList.add("color-selector-sat-knob","ic"),u.appendChild(this.satKnob);let p=document.createElement("div");if(p.classList.add("color-selector-hue"),p.style.width=this.width+"px",this.selector.appendChild(p),this.hueSlide=document.createElement("div"),this.hueSlide.style.width=this.width+"px",this.hueSlide.addEventListener("mousedown",this.hueMouseDown,!1),this.hueSlide.addEventListener("touchstart",this.hueTouchStart,{passive:!1}),this.hueSlide.classList.add("color-selector-hue-slide"),p.appendChild(this.hueSlide),this.hueKnob=document.createElement("div"),this.hueKnob.classList.add("color-selector-hue-knob","ic"),p.appendChild(this.hueKnob),this.hexInput=document.createElement("input"),this.hexInput.type="text",this.hexInput.spellcheck=!1,this.hexInput.maxLength=7,this.hexInput.addEventListener("input",this.hexInputInput,!1),this.hexInput.addEventListener("blur",this.hexInputBlur,!1),this.hexInput.classList.add("color-selector-input"),this.selector.appendChild(this.hexInput),r){let e=document.createElement("a");e.classList.add("color-selector-pick"),e.classList.add("button","outline"),e.innerHTML='<img src="/img/tool/thick/picker.svg" class="ic" width="16" height="16" loading="lazy"/>',e.addEventListener("click",this.activeColorPick,!1),this.selector.appendChild(e)}this.hsb=o.Z.fromHEX(null!==(d=t[0])&&void 0!==d?d:"#ffffff").toHSB(),this.setHue(),this.setSat(),this.updateColor(!1,!!t[0])}}},9924:(e,t,s)=>{s.d(t,{C:()=>n,Z:()=>a});var i=s(3947);class a{constructor(e,t,s,i,a){this.name=e,this.callback=t,this.short=s,this.icon=i,this.sub=a}}class n{constructor(e,t,s=!1){this.addItem=(e,t)=>{if(e.name)if(e.sub){const s=(0,i.T)("ul"),a=(0,i.T)("li",{className:"more"},e.icon?(0,i.T)("img",{src:e.icon}):"",e.name,s);for(const t of e.sub)this.addItem(t,s);t.append(a)}else e.callback?t.appendChild((0,i.T)("li",{onclick:()=>{e.callback(),this.cleanUp()}},e.icon?(0,i.T)("img",{src:e.icon}):"",e.name,e.short?(0,i.T)("span",{},e.short):"")):t.appendChild((0,i.T)("li",{className:"disabled"},e.icon?(0,i.T)("img",{src:e.icon}):"",e.name,e.short?(0,i.T)("span",{},e.short):""));else t.appendChild((0,i.T)("li",{className:"split"}))},this.cleanUp=()=>{this.holder.removeEventListener("mouseleave",this.cleanUp),this.holder.remove(),this.holder=void 0,this.id=void 0},this.id=Math.round(99999999999999*Math.random()).toString(),this.holder=(0,i.T)("div",{id:this.id,className:"overflow-menu-holder"}),this.holder.addEventListener("contextmenu",(e=>(e.stopPropagation(),e.preventDefault(),!1))),this.holder.style.display="block",this.holder.style.left=s?e.x-235+"px":e.x-5+"px",this.list=(0,i.T)("ul",{className:"overflow-menu"}),this.holder.appendChild(this.list);for(const i of t)this.addItem(i,this.list);this.holder.addEventListener("mouseleave",this.cleanUp);const a="block"===(0,i.ZP)("workspace").style.display?(0,i.ZP)("workspace"):(0,i.ZP)("home");a.appendChild(this.holder),e.y+this.holder.clientHeight>a.scrollHeight?this.holder.style.top=e.y+5-this.holder.clientHeight+"px":this.holder.style.top=e.y-5+"px"}}},9868:(e,t,s)=>{s.d(t,{Z:()=>o});var i=s(3947),a=s(6548),n=s(3868);class o extends n.Z{constructor(){super((0,a.Z)("dialogChoiceTitle"),!0),this.init=()=>new Promise(((e,t)=>{const s=this.content.querySelector("#open-as-new"),i=this.content.querySelector("#open-in-current");this.cancel=()=>{this.cleanUp(),e("close")},s.onclick=()=>{this.cleanUp(),e("create")},i.onclick=()=>{this.cleanUp(),e("layer")}})),this.setContent(`    \n            ${(0,a.Z)("dialogChoiceHeadline")}\n            <ul class="push-buttons pad-20" style="text-align: center">\n                <li id="open-as-new">\n                    <img src="/img/icon/document-new.svg" class="ic" />\n                    <span>${(0,a.Z)("createNew")}</span>\n                </li>\n                <li id="open-in-current">\n                    <img src="/img/icon/document-add.svg" class="ic" />\n                    <span>${(0,a.Z)("addCurrent")}</span>\n                </li>\n            </ul>\n        `),(0,i.ZP)("dialog-buttons"+this.mid).style.display="none"}}},4754:(e,t,s)=>{s.d(t,{Z:()=>d});var i=s(3947),a=s(6548),n=s(3655),o=s(3868),r=s(6817),h=s(1030),l=s(4256),c=s(6222);class d extends o.Z{constructor(e){super((0,a.Z)("dialogAiCutoutTitle")),this.run=async()=>{try{let e=this.stage.fresco.getSelected();const t=n.$E(e.mask);await(0,c.Z)(e,this.shaders),this.stage.render(),this.stage.history.add({type:"mask",layer:e,rect:new r.Z(0,0,e.mask.width,e.mask.height),patch:t}),this.cleanUp()}catch(e){console.error(e),(0,i.ZP)("ai-icon").src="/img/icon/ai-err.svg",(0,i.ZP)("dialog-cancel"+this.mid).innerText=(0,a.Z)("close"),(0,i.ZP)("ai-load").style.display="none",(0,i.ZP)("ai-message").innerText=window.navigator.onLine?(0,a.Z)("genericError"):(0,a.Z)("genericOffline")}},this.stage=e,this.dialog.style.width="300px",this.dialog.style.maxWidth="300px",this.setContent('\n            <div class="premium-tag" tooltip="Premium" flow="down"><img src="/img/icon/premium.svg"></div>\n            <img src="/img/icon/ai.svg" id="ai-icon" class="ic">\n            <div id="ai-load" class="ai-load"><div class="dot-floating"></div></div> \n            <div id="ai-message" class="pad-20">Machines are doing their thing, please wait ..</div>\n        '),(0,i.ZP)("dialog-apply"+this.mid).style.display="none",this.shaders=new l.Z,this.shaders.addShader("alpha-shift-mask",!0),(0,h.Z)("run-ai-cutout"),this.run()}}},5181:(e,t,s)=>{s.d(t,{Z:()=>c});var i=s(6548),a=s(3655),n=s(3947),o=s(3868),r=s(8776),h=s(3673),l=s(4820);class c extends o.Z{constructor(e,t,s){var o;super((0,i.Z)("titleColorPicker"),!1),this.hue=0,this.sat=0,this.bri=1,this.setHistory=e=>{let t=r.Z.fromRGB(e.currentTarget.style.backgroundColor);this.setColor(t)},this.pickerPreviewColor=e=>{let t=new h.Z(e.clientX,e.clientY);if(this.colorPreview.style.top=t.y-50+"px",this.colorPreview.style.left=t.x+10+"px",this.colorPreview.style.display="block",t.x-=this.stageC.offsetLeft,t.y-=this.stageC.offsetTop,e.target!==this.modal||t.x<0||t.y<0||t.x>this.stageC.width||t.y>this.stageC.height)return void(this.colorPreview.style.display="none");let s=this.stageCanvasCTX.getImageData(t.x,t.y,1,1).data;this.colorPreview.style.backgroundColor=new r.Z(s[0],s[1],s[2]).toHEX()},this.pickerPreviewLeave=()=>{this.colorPreview.style.display="none"},this.pickerSetColor=e=>{let t=new h.Z(e.clientX-this.stageC.offsetLeft,e.clientY-this.stageC.offsetTop);if(e.target!==this.modal||t.x<0||t.y<0||t.x>this.stageC.width||t.y>this.stageC.height)return;let s=this.stageCanvasCTX.getImageData(t.x,t.y,1,1).data;this.setColor(new r.Z(s[0],s[1],s[2]))},this.satMouseDown=e=>{e.stopPropagation(),document.addEventListener("mousemove",this.satMouseMove,!0),document.addEventListener("mouseup",this.satMouseUp,!0);var t=this.satSlide.getBoundingClientRect(),s=e.pageX-t.left,i=e.pageY-t.top;this.selectSat(s,i)},this.satMouseMove=e=>{e.stopPropagation();var t=this.satSlide.getBoundingClientRect(),s=e.pageX-t.left,i=e.pageY-t.top;this.selectSat(s,i)},this.satMouseUp=e=>{e.stopPropagation(),document.removeEventListener("mousemove",this.satMouseMove,!0),document.removeEventListener("mouseup",this.satMouseUp,!0)},this.satTouchStart=e=>{e.stopPropagation(),document.addEventListener("touchmove",this.satTouchMove,!0),document.addEventListener("touchend",this.satTouchEnd,!0);var t=this.satSlide.getBoundingClientRect(),s=e.targetTouches[0].pageX-t.left,i=e.targetTouches[0].pageY-t.top;this.selectSat(s,i)},this.satTouchMove=e=>{e.stopPropagation();var t=this.satSlide.getBoundingClientRect(),s=e.targetTouches[0].pageX-t.left,i=e.targetTouches[0].pageY-t.top;this.selectSat(s,i)},this.satTouchEnd=e=>{e.stopPropagation(),document.removeEventListener("touchmove",this.satTouchMove,!0),document.removeEventListener("touchend",this.satTouchEnd,!0)},this.selectSat=(e,t)=>{e=a.uZ(e,0,256),t=a.uZ(t,0,256),this.sat=e/256,this.bri=1-t/256,this.setSatKnob(),this.calculateColor()},this.setSatKnob=()=>{this.satKnob.style.left=256*this.sat-9+"px",this.satKnob.style.top=256*(1-this.bri)-9+"px"},this.hueMouseDown=e=>{e.stopPropagation(),document.addEventListener("mousemove",this.hueMouseMove,!0),document.addEventListener("mouseup",this.hueMouseUp,!0);var t=this.hueSlide.getBoundingClientRect();this.selectHue(e.pageY-t.top)},this.hueMouseMove=e=>{e.stopPropagation();var t=this.hueSlide.getBoundingClientRect();this.selectHue(e.pageY-t.top)},this.hueMouseUp=e=>{e.stopPropagation(),document.removeEventListener("mousemove",this.hueMouseMove,!0),document.removeEventListener("mouseup",this.hueMouseUp,!0)},this.hueTouchStart=e=>{e.stopPropagation(),this.hueSlide.addEventListener("touchmove",this.hueTouchMove,!0),document.addEventListener("touchend",this.hueTouchEnd,!0);var t=e.target.getBoundingClientRect();this.selectHue(e.targetTouches[0].pageY-t.top)},this.hueTouchMove=e=>{e.stopPropagation();var t=e.target.getBoundingClientRect();this.selectHue(e.targetTouches[0].pageY-t.top)},this.hueTouchEnd=e=>{e.stopPropagation(),this.hueSlide.removeEventListener("touchmove",this.hueTouchMove,!0),document.removeEventListener("touchend",this.hueTouchEnd,!0)},this.selectHue=e=>{e=a.uZ(e,0,256),this.hue=Math.round(359-e/256*359),this.setHueKnob(),this.calculateColor()},this.setHueKnob=()=>{this.hueKnob.style.top=252-this.hue/359*254+"px";let e=this.satSlide.getContext("2d");e.fillStyle=r.Z.fromHSB(this.hue,1,1).toHEX(),e.fillRect(0,0,this.satSlide.width,this.satSlide.height);var t=e.createLinearGradient(0,0,this.satSlide.width,0);t.addColorStop(0,"rgba(255,255,255,1)"),t.addColorStop(1,"rgba(255,255,255,0)"),e.fillStyle=t,e.fillRect(0,0,this.satSlide.width,this.satSlide.height);var s=e.createLinearGradient(0,0,0,this.satSlide.height);s.addColorStop(0,"rgba(0,0,0,0)"),s.addColorStop(1,"rgba(0,0,0,1)"),e.fillStyle=s,e.fillRect(0,0,this.satSlide.width,this.satSlide.height)},this.calculateColor=()=>{this.color=r.Z.fromHSB(this.hue,this.sat,this.bri);var e=document.activeElement;this.hexInput.value=this.color.toHEX(),e!==this.hueInput&&(this.hueInput.value=Math.round(this.hue).toString()),e!==this.satInput&&(this.satInput.value=Math.round(100*this.sat).toString()),e!==this.briInput&&(this.briInput.value=Math.round(100*this.bri).toString()),e!==this.redInput&&(this.redInput.value=this.color.r.toString()),e!==this.greenInput&&(this.greenInput.value=this.color.g.toString()),e!==this.blueInput&&(this.blueInput.value=this.color.b.toString()),this.selected.style.backgroundColor=this.color.toRGBA(),this.preview&&a.Ds("preview",50,(()=>{this.preview(this.color)}))},this.hexInputChange=e=>{/^#[0-9A-F]{6}$/i.test(this.hexInput.value)&&this.setColor(r.Z.fromHEX(this.hexInput.value))},this.hueInputChange=e=>{this.hue=a.uZ(parseInt(this.hueInput.value),0,359),this.setHueKnob(),this.calculateColor()},this.satInputChange=e=>{this.sat=a.uZ(parseInt(this.satInput.value),0,100)/100,this.setSatKnob(),this.calculateColor()},this.briInputChange=e=>{this.bri=a.uZ(parseInt(this.briInput.value),0,100)/100,this.setSatKnob(),this.calculateColor()},this.redInputChange=e=>{this.color.r=a.uZ(parseInt(this.redInput.value),0,255),this.setColor(this.color)},this.greenInputChange=e=>{this.color.g=a.uZ(parseInt(this.greenInput.value),0,255),this.setColor(this.color)},this.blueInputChange=e=>{this.color.b=a.uZ(parseInt(this.blueInput.value),0,255),this.setColor(this.color)},this.setColor=e=>{this.color=e;let t=Math.min(e.r,e.g,e.b),s=Math.max(e.r,e.g,e.b);this.bri=s/255;var i=s-t;i?(this.sat=i/s,e.r==s?this.hue=(e.g-e.b)/i*60:e.g==s?this.hue=60*(2+(e.b-e.r)/i):this.hue=60*(4+(e.r-e.g)/i),this.hue>360?this.hue-=360:this.hue<0&&(this.hue+=360),360===this.hue&&(this.hue=0)):this.hue=this.sat=0,this.setHueKnob(),this.setSatKnob(),this.calculateColor()},this.getColor=()=>this.color,this.getHex=()=>this.color.toHEX(),this.cancel=()=>{this.preview&&this.preview(this.current),this.cleanUp()},this.apply=()=>{this.callback&&(this.preview&&this.preview(this.current),(0,l.nS)(this.color),this.callback(this.color)),this.cleanUp()},this.cleanUp=()=>{document.dispatchEvent(new CustomEvent("viewport-render")),(0,n.ZP)("color-picker-history").querySelectorAll(".color-pod").forEach((e=>e.removeEventListener("click",this.setHistory))),this.satSlide.removeEventListener("mousedown",this.satMouseDown,!1),this.satSlide.removeEventListener("touchstart",this.satTouchStart),this.hueSlide.removeEventListener("mousedown",this.hueMouseDown,!1),this.hueSlide.removeEventListener("touchstart",this.hueTouchStart),this.hexInput.removeEventListener("input",this.hexInputChange,!1),this.hueInput.removeEventListener("input",this.hueInputChange,!1),this.satInput.removeEventListener("input",this.satInputChange,!1),this.briInput.removeEventListener("input",this.briInputChange,!1),this.redInput.removeEventListener("input",this.redInputChange,!1),this.greenInput.removeEventListener("input",this.greenInputChange,!1),this.blueInput.removeEventListener("input",this.blueInputChange,!1),this.modal.removeEventListener("mousedown",this.pickerSetColor,!0),this.modal.removeEventListener("mousemove",this.pickerPreviewColor,!0),this.modal.removeEventListener("mouseleave",this.pickerPreviewLeave,!0),document.removeEventListener("keydown",this.keyDown,!1),this.stageCanvasCTX=void 0,this.stageCanvas=void 0,this.stageC=void 0,this.dialog.remove(),this.dialog=null,this.modal.remove(),this.modal=null},this.preview=s,this.callback=t,this.dialog.style.width="500px",this.content.style.paddingBottom="10px",(0,n.ZP)("dialog-apply"+this.mid).innerText="ok",this.setContent('\n            <div id="color-picker-selector">\n                <div id="color-picker-sat">\n                    <canvas id="color-picker-sat-slide"></canvas>\n                    <div id="color-picker-sat-knob" class="ic"></div>\n                </div>\n                <div id="color-picker-hue">\n                    <div id="color-picker-hue-slide"></div>\n                    <div id="color-picker-hue-knob" class="ic"></div>\n                </div>\n                <div id="color-picker-etc">\n                    <div id="color-picker-new"></div>\n                    <div id="color-picker-current"></div>\n\n                    <div id="color-picker-inputs">\n                        <div>\n                            <div>H:<input type="number"id="picker-input-hue"></div>\n                            <div>S:<input type="number"id="picker-input-sat"></div>\n                            <div>B:<input type="number"id="picker-input-bri"></div>\n                        </div>\n                        <div>\n                            <div>R:<input type="number"id="picker-input-red"></div>\n                            <div>G:<input type="number"id="picker-input-green"></div>\n                            <div>B:<input type="number"id="picker-input-blue"></div>\n                        </div>\n                    </div>\n                    <div id="color-picker-hex">\n                        HEX:<input type="text" spellcheck="false" maxlength="7" id="picker-input-hex">\n                    </div>\n                 </div>\n            </div>\n        ');let c=(0,n.T)("div",{id:"color-picker-history",className:"color-pod-list"});(0,n.ZP)("dialog-buttons"+this.mid).append(c),l.ZP.oldColor.forEach((e=>{let t=(0,n.T)("div",{className:"color-pod small"});t.style.backgroundColor=e,c.append(t)})),(0,n.ZP)("color-picker-history").querySelectorAll(".color-pod").forEach((e=>e.addEventListener("click",this.setHistory))),this.selected=(0,n.ZP)("color-picker-new"),this.selector=(0,n.ZP)("color-picker-selector"),this.satSlide=(0,n.ZP)("color-picker-sat-slide"),this.satKnob=(0,n.ZP)("color-picker-sat-knob"),this.hueSlide=(0,n.ZP)("color-picker-hue-slide"),this.hueKnob=(0,n.ZP)("color-picker-hue-knob"),this.satSlide.addEventListener("mousedown",this.satMouseDown,!1),this.satSlide.addEventListener("touchstart",this.satTouchStart,{passive:!1}),this.hueSlide.addEventListener("mousedown",this.hueMouseDown,!1),this.hueSlide.addEventListener("touchstart",this.hueTouchStart,{passive:!1}),this.hexInput=(0,n.ZP)("picker-input-hex"),this.hexInput.addEventListener("input",this.hexInputChange,!1),this.hueInput=(0,n.ZP)("picker-input-hue"),this.hueInput.addEventListener("input",this.hueInputChange,!1),this.satInput=(0,n.ZP)("picker-input-sat"),this.satInput.addEventListener("input",this.satInputChange,!1),this.briInput=(0,n.ZP)("picker-input-bri"),this.briInput.addEventListener("input",this.briInputChange,!1),this.redInput=(0,n.ZP)("picker-input-red"),this.redInput.addEventListener("input",this.redInputChange,!1),this.greenInput=(0,n.ZP)("picker-input-green"),this.greenInput.addEventListener("input",this.greenInputChange,!1),this.blueInput=(0,n.ZP)("picker-input-blue"),this.blueInput.addEventListener("input",this.blueInputChange,!1),"block"===(null===(o=(0,n.ZP)("workspace"))||void 0===o?void 0:o.style.display)&&(this.modal.style.cursor="crosshair",this.colorPreview=document.createElement("div"),this.colorPreview.id="color-picker-preview",this.colorPreview.style.display="none",this.modal.appendChild(this.colorPreview),this.modal.addEventListener("mousedown",this.pickerSetColor,!0),this.modal.addEventListener("mousemove",this.pickerPreviewColor,!0),this.modal.addEventListener("mouseleave",this.pickerPreviewLeave,!0),this.stageC=document.getElementsByClassName("canvas")[0],this.stageCanvas=a.dN(this.stageC),this.stageCanvasCTX=this.stageCanvas.getContext("2d")),(0,n.ZP)("color-picker-current").style.backgroundColor=e.toHEX(),this.current=e,this.setColor(e)}}},7976:(e,t,s)=>{s.d(t,{Z:()=>n});var i=s(3868),a=s(3947);class n extends i.Z{constructor(e,t,s,i,n){super(e,!0),this.init=()=>new Promise(((e,t)=>{this.cancel=()=>{this.cleanUp(),e(!1)},this.condition=()=>{this.cleanUp(),e(void 0)},this.apply=()=>{this.cleanUp(),e(!0)}})),this.setContent((0,a.T)("p",t)),s&&((0,a.ZP)("dialog-apply"+this.mid).innerText=s),i&&((0,a.ZP)("dialog-cancel"+this.mid).innerText=i),n&&(0,a.ZP)("dialog-cancel"+this.mid).before((0,a.T)("a",{id:"dialog-condition"+this.mid,className:"button negative",style:"position:absolute;left:10px;",onclick:()=>this.condition()},n))}}},3868:(e,t,s)=>{s.d(t,{Z:()=>h});var i=s(6548),a=s(3655),n=s(3673),o=s(4820),r=s(3947);class h{constructor(e,t=!0,s=!1){this.setContent=(...e)=>{e[0]instanceof HTMLElement?this.content.append(...e):this.content.innerHTML+=e[0],this.position()},this.disableApply=()=>{const e=(0,r.ZP)("dialog-apply"+this.mid);e.classList.add("disabled"),e.onclick=void 0},this.enableApply=()=>{const e=(0,r.ZP)("dialog-apply"+this.mid);e.classList.remove("disabled"),e.onclick=()=>this.apply()},this.position=()=>{this.dialog.style.left=Math.round((this.modal.offsetWidth-this.dialog.offsetWidth)/2+o.ZP.dialogPos.x)+"px",this.dialog.style.top=Math.round((this.modal.offsetHeight-this.dialog.offsetHeight)/2+o.ZP.dialogPos.y)+"px";let e=this.dialog.getBoundingClientRect(),t=this.modal.getBoundingClientRect();e.bottom>t.bottom&&(this.dialog.style.top=t.height-e.height<0?"0px":t.height-e.height+"px"),e.right>t.right&&(this.dialog.style.left=t.width-e.width<0?"0px":t.width-e.width+"px"),this.dialog.offsetTop<0&&(this.dialog.style.top="0px"),this.dialog.offsetLeft<0&&(this.dialog.style.left="0px")},this.dragStart=e=>{this.p=e,this.d=new n.Z(this.dialog.offsetLeft,this.dialog.offsetTop)},this.dragMove=e=>{this.dialog.style.left=Math.round(this.d.x+(e.x-this.p.x))+"px",this.dialog.style.top=Math.round(this.d.y+(e.y-this.p.y))+"px"},this.dragEnd=e=>{o.ZP.dialogPos.x=Math.round(this.dialog.offsetLeft-(this.modal.offsetWidth-this.dialog.offsetWidth)/2),o.ZP.dialogPos.y=Math.round(this.dialog.offsetTop-(this.modal.offsetHeight-this.dialog.offsetHeight)/2)},this.resizeStart=e=>{this.d=new n.Z(this.dialog.clientHeight,e.y)},this.resizeMove=e=>{const t=this.d.x+(e.y-this.d.y);this.dialog.style.height=(t<320?320:t)+"px"},this.keyDown=e=>{27!=e.keyCode||"none"===(0,r.ZP)("dialog-cancel"+this.mid).style.display?13!=e.keyCode||"none"===(0,r.ZP)("dialog-apply"+this.mid).style.display||this.apply():this.cancel()},this.condition=()=>{this.cleanUp()},this.cancel=()=>{this.cleanUp()},this.apply=()=>{this.cleanUp()},this.cleanUp=()=>{document.removeEventListener("keydown",this.keyDown,!1),this.dialog.remove(),this.dialog=null,this.modal.remove(),this.modal=null},this.mid=a.Zd(),this.modal=(0,r.T)("div",{id:"modal-"+this.mid,className:"modal"}),t&&this.modal.classList.add("dim"),document.body.appendChild(this.modal),this.dialog=(0,r.T)("div",{className:"dialog"}),this.modal.appendChild(this.dialog),this.content=(0,r.T)("div",{className:"content"});const h=(0,r.T)("div",{id:"dialog-title",className:"title"},e);if((0,r.Rg)(h,this.dragStart,this.dragMove,this.dragEnd),this.dialog.append(h,(0,r.T)("img",{id:"dialog-close"+this.mid,className:"close ic",src:"/img/icon/close.svg",onclick:()=>this.cancel()}),(0,r.T)("div",{id:"dialog-splitter"+this.mid,className:"splitter"}),this.content,(0,r.T)("div",{className:"buttons",id:"dialog-buttons"+this.mid},(0,r.T)("a",{id:"dialog-apply"+this.mid,className:"button positive",onclick:()=>this.apply()},(0,i.Z)("apply")),(0,r.T)("a",{id:"dialog-cancel"+this.mid,className:"button negative",onclick:()=>this.cancel()},(0,i.Z)("cancel")))),s){const e=(0,r.T)("img",{id:"resize-"+this.mid,src:"/img/icon/three-dot.svg",className:"resize ic"});(0,r.Rg)(e,this.resizeStart,this.resizeMove),this.dialog.append(e)}document.addEventListener("keydown",this.keyDown,!1)}}},5983:(e,t,s)=>{s.d(t,{Z:()=>l});var i=s(6548),a=s(3868),n=s(3947),o=s(3655),r=s(1030),h=s(7630);class l extends a.Z{constructor(e){super((0,i.Z)("titleExportTemplate"),!0),this.revision=0,this.currentRev=0,this.working=!1,this.apply=async()=>{if((0,r.Z)("export","template"),(0,n.ZP)("dialog-apply"+this.mid).classList.contains("disabled"))return;const e=(0,n.ZP)("export-id").value;let t;if((0,h.Zp)()&&(t=await(0,h.f1)(e,"pxz","Pixlr template","application/pxz"),!1===t))return;(0,n.ZP)("dialog-apply"+this.mid).innerText=(0,i.Z)("working")+"..",(0,n.ZP)("dialog-apply"+this.mid).classList.add("disabled"),(0,n.ZP)("dialog-cancel"+this.mid).style.display="none",await o.iF(),this.blob=await(0,h.iM)(this.stage,{id:e,name:(0,n.ZP)("export-name").value,quality:"90",nonDestructive:!1,type:document.querySelector('input[name="export-type"]:checked').value,unit:"pixel"});const s=new File([this.blob],e+".pxz");t?(await(0,h.BI)(t,s),document.dispatchEvent(new CustomEvent("notification",{detail:(0,i.Z)("fileSaved")}))):(0,h.vV)(s,e,"pxz"),this.cleanUp()},e.fresco.block&&this.cleanUp(),this.stage=e,(0,n.ZP)("dialog-apply"+this.mid).innerText=(0,i.Z)("titleExport"),(0,n.ZP)("dialog-buttons"+this.mid).style.marginTop="0px",this.setContent(`\n\n        <div id="export-settings">\n            <label>${(0,i.Z)("id")}</label>\n            <input type="text" style="width:100%" id="export-id" value="${this.stage.fresco.id}" />\n\n            <label class="pad-16">${(0,i.Z)("name")}</label>\n            <input type="text" style="width:100%" id="export-name" value="${this.stage.fresco.name}" />\n            \n            <label class="pad-16">${(0,i.Z)("type")}</label>\n            <div class="switch-field">\n                <input type="radio" id="export-type-template" name="export-type" value="template" checked/><label for="export-type-template">${(0,i.Z)("template")}</label>\n                <input type="radio" id="export-type-component" name="export-type" value="component" /><label for="export-type-component">${(0,i.Z)("component")}</label>\n            </div>        \n        </div>\n\n        `),this.position()}}},5772:(e,t,s)=>{s.d(t,{Z:()=>o});var i=s(6548),a=s(3868),n=s(3947);class o extends a.Z{constructor(e,t){super((0,i.Z)("name"),!0),this.init=()=>new Promise(((e,t)=>{this.apply=()=>{e((0,n.ZP)("file-name").value),this.cleanUp()}})),this.setContent(`\n            <label>${(0,i.Z)("name")}</label>\n            <div style="display:flex">\n                <input type="text" id="file-name" style="width:280px" value='${e}' />\n                <div style="padding-left:10px;line-height:32px;">.${t}</div>\n            </div>\n        `),(0,n.ZP)("dialog-cancel"+this.mid).style.display="none"}}},4375:(e,t,s)=>{s.d(t,{Z:()=>h});var i=s(1030),a=s(3868),n=s(5574),o=s(3947),r=s(6548);class h extends a.Z{constructor(e,t={}){super((0,r.Z)("dialogLoadTitle")),this.load=async e=>{(0,i.Z)("load-url");const t=(0,o.ZP)("load-message");try{this.cancel=()=>{throw h.CANCEL};const s=this.settings.title||(0,r.Z)("image"),i=this.settings.referrer||(0,r.Z)("source");t.innerText=(0,r.Z)("dialogLoadLoadingFrom",s.toLowerCase(),i.toLowerCase());const a=await(0,n.c6)(e,(e=>{const t=(0,o.ZP)("load-progress");-1==e?t.removeAttribute("value"):t.value=e})),l=new File([a],this.settings.title||e.substring(e.lastIndexOf("/")+1),{type:a.type});return this.cleanUp(),l}catch(s){if(console.log(s),s===h.CANCEL)return void this.cleanUp();(0,o.ZP)("load-progress")&&(t.innerText=(0,r.Z)("dialogLoadError"),(0,o.ZP)("load-progress").style.display="none",this.cancel=()=>{this.cleanUp()})}},this.stage=e,this.settings=t,this.setContent('\n            <p id="load-message"></p><br />\n\n            <progress id="load-progress" value="0" max="100" style="width: 100%;"></progress>\n            <br><br>\n        '),(0,o.ZP)("dialog-apply"+this.mid).style.display="none";(0,o.ZP)("load-message").innerText=(0,r.Z)("dialogLoadPrepare")}}h.CANCEL=new Error("CANCEL")},6969:(e,t,s)=>{s.d(t,{Z:()=>l});var i=s(6548),a=s(3868),n=s(3947),o=s(4820),r=s(4178),h=s(2397);class l extends a.Z{constructor(e){super((0,i.Z)("createNew"),!0,!0),this.selectType=e=>{let t=e.currentTarget;this.setType(t.id.replace("tab-",""))},this.setType=e=>{switch(this.type&&(this.holder.innerHTML="",(0,n.ZP)("tab-"+this.type).classList.remove("selected")),(0,n.ZP)("tab-"+e).classList.add("selected"),this.type=e,this.type){case"recommended":if(this.stage.clipboardSize){let e=this.stage.clipboardSize;this.addBox((0,i.Z)("clipboard"),e.width,e.height,"/img/icon/new-cutout.svg")}this.addBox((0,i.Z)("social-media-post"),1080,1080,"/img/icon/category/social.svg"),this.addBox((0,i.Z)("social-media-story"),1080,1920,"/img/icon/category/social.svg"),this.addBox("Web med",1600,900,"/img/icon/category/web.svg"),this.addBox("Thumb 720p",1280,720,"/img/icon/category/video.svg"),this.addBox("Wide 1080p",1920,1080,"/img/icon/category/video.svg"),this.addBox("Art grid",1e3,1e3,"/img/icon/category/art.svg"),this.addBox("12 mpx 4:3",4032,3024,"/img/icon/category/landscape.svg"),this.addBox("8 mpx 4:3",3264,2448,"/img/icon/category/landscape.svg");break;case"photo":this.addBox("12 mpx 4:3",4032,3024,"/img/icon/category/landscape.svg"),this.addBox("8 mpx 4:3",3264,2448,"/img/icon/category/landscape.svg"),this.addBox("Landscape 3x2 in",900,600,"/img/icon/category/landscape.svg"),this.addBox("Landscape 6x4 in",1800,1200,"/img/icon/category/landscape.svg"),this.addBox("Landscape 7x5 in",2100,1500,"/img/icon/category/landscape.svg"),this.addBox("Landscape 10x8 in",3e3,2400,"/img/icon/category/landscape.svg"),this.addBox("Portrait 2x3 in",600,900,"/img/icon/category/portrait.svg"),this.addBox("Portrait 4x6 in",1200,1800,"/img/icon/category/portrait.svg"),this.addBox("Portrait 5x7 in",1500,2100,"/img/icon/category/portrait.svg"),this.addBox("Portrait 8x10 in",2400,3e3,"/img/icon/category/portrait.svg");break;case"social":this.addBox((0,i.Z)("instagram-square"),1080,1080,"/img/icon/category/instagram.svg"),this.addBox((0,i.Z)("instagram-post"),1080,1350,"/img/icon/category/instagram.svg"),this.addBox((0,i.Z)("instagram-story"),1080,1920,"/img/icon/category/instagram.svg"),this.addBox((0,i.Z)("facebook-post"),1200,630,"/img/icon/category/facebook.svg"),this.addBox((0,i.Z)("facebook-story"),1080,1920,"/img/icon/category/facebook.svg"),this.addBox((0,i.Z)("facebook-cover"),851,315,"/img/icon/category/facebook.svg"),this.addBox((0,i.Z)("facebook-profile"),850,850,"/img/icon/category/facebook.svg"),this.addBox((0,i.Z)("twitter-post"),1600,900,"/img/icon/category/twitter.svg"),this.addBox((0,i.Z)("twitter-cover"),1500,500,"/img/icon/category/twitter.svg"),this.addBox((0,i.Z)("twitter-profile"),400,400,"/img/icon/category/twitter.svg"),this.addBox((0,i.Z)("youtube-profile"),800,800,"/img/icon/category/youtube.svg"),this.addBox((0,i.Z)("youtube-thumbnail"),1280,720,"/img/icon/category/youtube.svg"),this.addBox((0,i.Z)("youtube-channel-art"),2048,1152,"/img/icon/category/youtube.svg"),this.addBox((0,i.Z)("pinterest-pin"),1e3,1500,"/img/icon/category/pinterest.svg"),this.addBox((0,i.Z)("pinterest-square-pin"),1e3,1e3,"/img/icon/category/pinterest.svg"),this.addBox((0,i.Z)("pinterest-long-pin"),1e3,2100,"/img/icon/category/pinterest.svg");break;case"print":this.addBox("Letter 8 x 11 in",2400,3300,"/img/icon/category/paper.svg"),this.addBox("Legal 8 x 14 in",2400,4200,"/img/icon/category/paper.svg",!0),this.addBox("Tabloid 11 x 17 in",3300,5100,"/img/icon/category/paper.svg",!0),this.addBox("A3 297 x 420 mm",3508,4961,"/img/icon/category/paper.svg",!0),this.addBox("A4 210 x 297 mm",2480,3508,"/img/icon/category/paper.svg"),this.addBox("A5 148 x 210 mm",1748,2480,"/img/icon/category/paper.svg"),this.addBox("A6 105 x 148 mm",1240,1748,"/img/icon/category/paper.svg"),this.addBox((0,i.Z)("business-card"),1050,600,"/img/icon/category/business-card.svg"),this.addBox((0,i.Z)("flyer")+" 4.25 x 5.5 in",1275,1650,"/img/icon/category/flyer.svg"),this.addBox((0,i.Z)("flyer")+" 5.5 x 8.5 in",1650,2550,"/img/icon/category/flyer.svg"),this.addBox((0,i.Z)("flyer")+" 8.5 x 11 in",2550,3300,"/img/icon/category/flyer.svg"),this.addBox((0,i.Z)("brochure")+" 8.5 x 11 in",2550,3300,"/img/icon/category/flyer.svg"),this.addBox((0,i.Z)("brochure")+" 8.5 x 14 in",2550,4200,"/img/icon/category/flyer.svg",!0),this.addBox((0,i.Z)("brochure")+" 11 x 17 in",3300,5100,"/img/icon/category/flyer.svg",!0),this.addBox((0,i.Z)("invitation")+" 4 x 6 in",384,576,"/img/icon/category/invitation.svg"),this.addBox((0,i.Z)("invitation")+" 5 x 7 in",480,672,"/img/icon/category/invitation.svg");break;case"web":this.addBox("Web 1994",800,600,"/img/icon/category/web.svg"),this.addBox("Web 2004",1280,720,"/img/icon/category/web.svg"),this.addBox("Web 2012",1366,768,"/img/icon/category/web.svg"),this.addBox("Web 2016",1440,900,"/img/icon/category/web.svg"),this.addBox("Web 2020",1920,1200,"/img/icon/category/web.svg"),this.addBox("Icon 16",16,16,"/img/icon/category/icon.svg"),this.addBox("Icon 32",32,32,"/img/icon/category/icon.svg"),this.addBox("Icon 64",64,64,"/img/icon/category/icon.svg"),this.addBox("Icon 512",512,512,"/img/icon/category/icon.svg"),this.addBox("Icon 1024",1024,1024,"/img/icon/category/icon.svg");break;case"video":this.addBox("360p",640,360,"/img/icon/category/video.svg"),this.addBox("480p",854,480,"/img/icon/category/video.svg"),this.addBox("720p",1280,720,"/img/icon/category/video.svg"),this.addBox("1080p HD",1920,1080,"/img/icon/category/video.svg"),this.addBox("1440p 2K",2560,1440,"/img/icon/category/video.svg"),this.addBox("4K UHD",3840,2160,"/img/icon/category/video.svg")}},this.presetChange=e=>{let t=e.currentTarget,s=(0,n.ZP)("ceate-new-outer").getElementsByClassName("new-box");for(var i=0;i<s.length;i++)s[i].classList.remove("selected");t.classList.add("selected");let a=t.getAttribute("data").split(":");(0,n.ZP)("new-canvas-width").value=a[0],(0,n.ZP)("new-canvas-height").value=a[1]},this.addBox=(e,t,s,i,a=!1)=>{let o=(0,n.T)("div",{className:"new-box",style:"width:"+this.boxSize+"px"},(0,n.T)("div",{className:"holder"},(0,n.T)("img",{src:i})),(0,n.T)("span",{},e),(0,n.T)("small",{},t+"x"+s+" px"));a&&o.classList.add("premium"),o.addEventListener("click",this.presetChange,!1),o.setAttribute("data",t+":"+s),this.holder.appendChild(o)},this.apply=async()=>{let e=(0,n.ZP)("new-canvas-width").value,t=(0,n.ZP)("new-canvas-height").value,s=NaN!=Number(e)?Number(e):600,i=NaN!=Number(t)?Number(t):600,a=o.ZP.user.subscription?8192:4096;s>a&&(s=a),i>a&&(i=a);let r=(0,n.ZP)("new-canvas-name").value,h=!(0,n.ZP)("new-canvas-background").checked;this.stage.createNew(r,s,i,h?void 0:this.backgroundColor.getHex()),this.cleanUp()},this.stage=e,(0,n.ZP)("dialog-apply"+this.mid).innerText=(0,i.Z)("create"),(0,n.ZP)("dialog-buttons"+this.mid).style.marginTop="0px",this.dialog.style.width="90%",this.dialog.style.maxWidth="1200px",this.dialog.style.height=document.body.offsetHeight-300+"px",this.content.style.padding="0",this.content.style.height="1vh",this.content.style.display="flex",this.content.style.position="relative",this.content.style.flexDirection="column",this.setContent(`\n\n            <ul id="preset-type" class="tab-list pad-10" style="flex: 0 1 auto;padding-left:20px; margin-left:20px;margin-right:20px;margin-bottom:10px">\n                <li id="tab-recommended">${(0,i.Z)("recommended")}</li>\n                <li id="tab-photo">${(0,i.Z)("photo")}</li>\n                <li id="tab-social">${(0,i.Z)("social")}</li>\n                <li id="tab-web">${(0,i.Z)("web")}</li>\n                <li id="tab-print">${(0,i.Z)("print")}</li>\n                <li id="tab-video">${(0,i.Z)("video")}</li>\n            </ul>\n            <div class="flex" style="position:relative;height:calc(100% - 58px);margin:0px 20px;">\n\n                <div id="ceate-new-outer" style="flex-grow:2">\n                    <div id="create-new-content" class="new-holder">\n\n                    </div>\n                </div>\n                <div style="flex: 0 0 auto;flex-basis:220px;width:220px;min-width:220px;margin-left:10px;overflow:hidden;">\n                    <label for="new-canvas-name">${(0,i.Z)("name")}</label>\n                    <input type="text" style="width: 100%;" id="new-canvas-name" value="${(0,i.Z)("untitled")}" />\n\n                    <label class="split pad-20">${(0,i.Z)("width")} <input type="number" id="new-canvas-width" value="1920"/></label>\n                    <label class="split">${(0,i.Z)("height")} <input type="number" id="new-canvas-height" value="1080"/></label>\n                    <label class="pad-10" style="text-align:right;font-size:10px;float:none;clear: both;">${(0,i.Z)("max")}<span id="new-max-size">4096 x 4096 px</span></label>\n\n                    <input type="checkbox" class="toggle-check" id="new-canvas-background" />\n                    <label class="switch subline pad-20" for="new-canvas-background">${(0,i.Z)("background")}<span></span><span class="arrow"></span></label>\n                    <div class="toggle">\n                        <div id="new-canvas-background-color-picker" class="color-picker pad-0"></div>\n                    </div>\n                </div>\n            <div>\n            \n        `),this.holder=(0,n.ZP)("create-new-content"),o.ZP.user.subscription&&((0,n.ZP)("new-max-size").innerText="8192 x 8192 px"),this.backgroundColor=new h.Z((0,n.ZP)("new-canvas-background-color-picker"),void 0,void 0,!1);let t=(0,n.ZP)("preset-type").getElementsByTagName("li");for(var s=0;s<t.length;s++)t[s].addEventListener("click",this.selectType,!1);let a=this.holder.clientWidth,l=Math.floor(a/125);this.boxSize=Math.floor(125+(a-125*l)/l),new r.Z((0,n.ZP)("ceate-new-outer")),this.setType("recommended"),this.position()}}},3747:(e,t,s)=>{s.d(t,{Z:()=>h});var i=s(3947),a=s(6548),n=s(4375),o=s(3868),r=s(5934);class h extends o.Z{constructor(e,t=!0){super((0,a.Z)("dialogOpenURLTitle")),this.apply=async()=>{let e=(0,i.ZP)("image-url").value;if(this.cleanUp(),""!==e){const t=e.substring(e.lastIndexOf("/")+1);e="https://pixlr.com/proxy/?url="+encodeURIComponent(e);const s=new n.Z(this.stage,{title:t});let i=await s.load(e);r.ZB(this.stage,i,this.askToAdd)}},this.stage=e,this.askToAdd=t,this.setContent(`\n            <label>${(0,a.Z)("dialogOpenURLHeadline")}</label>\n            <input type="url" id="image-url" style="width: 100%" placeholder='https://example.com/this-image.jpg' />\n        `),(0,i.ZP)("dialog-apply"+this.mid).innerText=(0,a.Z)("load"),setTimeout((()=>{(0,i.ZP)("image-url").focus()}),300)}}},1971:(e,t,s)=>{s.d(t,{Z:()=>h});var i=s(6548),a=s(3868),n=s(8776),o=s(2397),r=s(4820);class h extends a.Z{constructor(e){super((0,i.Z)("titlePageColor"),!1),this.change=e=>{this.stage.fresco.color=e?e.toHEX():void 0,window.requestAnimationFrame((()=>{this.stage.render()}))},this.apply=()=>{this.stage.history.add({type:"background",color:this.current}),this.stage.fresco.color&&(0,r.nS)(n.Z.fromHEX(this.stage.fresco.color)),this.cleanUp()},this.cancel=()=>{this.stage.fresco.color=this.current,document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-select")),this.cleanUp()},this.dialog.style.width="340px",this.stage=e,this.current=this.stage.fresco.color,this.colorselector=new o.Z(this.content,[this.current,...r.ZP.oldColor.slice(),"#ffffff","#000000"],this.change,!0,300,120,!0),this.position()}}},9381:(e,t,s)=>{s.d(t,{Z:()=>l});var i=s(3868),a=s(9872),n=s(3655),o=s(3947),r=s(6548),h=s(4820);class l extends i.Z{constructor(e){super((0,r.Z)("dialogResizePageTitle")),this.pageSizeInputChange=e=>{let t,s,i,a=e.currentTarget;(0,o.ZP)("page-resize-constrain").checked&&("page-resize-width"==a.id?(t=n.uZ(Number(a.value),1,this.maxSize),i=t/this.stage.fresco.width,s=Math.round(i*this.stage.fresco.height),(0,o.ZP)("page-resize-height").value=s.toString()):(s=n.uZ(Number(a.value),1,this.maxSize),i=s/this.stage.fresco.height,t=Math.round(i*this.stage.fresco.width),(0,o.ZP)("page-resize-width").value=t.toString()),a!=document.activeElement&&((0,o.ZP)("page-resize-width").value=t.toString(),(0,o.ZP)("page-resize-height").value=s.toString()))},this.apply=()=>{setTimeout((()=>{const e=Number((0,o.ZP)("page-resize-width").value),t=Number((0,o.ZP)("page-resize-height").value),s=new a.Z(this.stage.fresco.width,this.stage.fresco.height),i=(0,o.ZP)("page-resize-smooth").checked,n=this.stage.fresco.layers.map((e=>e.clone(!0)));this.stage.fresco.resize(e,t,i),this.stage.history.add({type:"pageResize",size:s,layers:n}),this.stage.updateViewport(),document.dispatchEvent(new CustomEvent("layer-arrange")),this.cleanUp()}),500)},this.stage=e,this.maxSize=h.ZP.user.subscription?8192:4096,this.setContent(`\n            <label class="split">${(0,r.Z)("width")} <input type="number" id="page-resize-width"/></label>\n            <label class="split">${(0,r.Z)("height")} <input type="number" id="page-resize-height"/></label>\n        \n            <input type="checkbox" checked id="page-resize-constrain" />\n            <label class="switch pad-30" for="page-resize-constrain">${(0,r.Z)("dialogResizeContrain")}<span></span></label>\n            \n            <input type="checkbox" checked id="page-resize-smooth" />\n            <label class="switch pad-10" for="page-resize-smooth">${(0,r.Z)("dialogResizeSmoothing")}<span></span></label>\n        \n            <small class="pad-30" style="display: block;">${(0,r.Z)("dialogResizeApplyAll")}</small>\n        `);let t=(0,o.ZP)("page-resize-width");t.addEventListener("input",this.pageSizeInputChange,!1),t.addEventListener("change",this.pageSizeInputChange,!1),t.value=this.stage.fresco.width.toString();let s=(0,o.ZP)("page-resize-height");s.addEventListener("change",this.pageSizeInputChange,!1),s.addEventListener("input",this.pageSizeInputChange,!1),s.value=this.stage.fresco.height.toString()}}},4891:(e,t,s)=>{s.d(t,{Z:()=>l});var i=s(4820),a=s(3868),n=s(9872),o=s(3655),r=s(3947),h=s(6548);class l extends a.Z{constructor(e){super((0,h.Z)("dialogPageSizeTitle")),this.anchorChange=e=>{let t=e.currentTarget,s=(0,r.ZP)("anchor-grid").getElementsByClassName("box");for(var i=0;i<s.length;i++)s[i].classList.remove("selected");t.classList.add("selected"),this.anchor=t.getAttribute("data")},this.changepageRelative=()=>{let e=(0,r.ZP)("page-size-relative").checked,t=(0,r.ZP)("page-size-width"),s=(0,r.ZP)("page-size-height");e?(t.value="0",s.value="0"):(t.value=this.stage.fresco.width.toString(),s.value=this.stage.fresco.height.toString())},this.apply=()=>{let e=Number((0,r.ZP)("page-size-width").value),t=Number((0,r.ZP)("page-size-height").value),s=(0,r.ZP)("page-size-relative").checked;const i=new n.Z(this.stage.fresco.width,this.stage.fresco.height);e=o.uZ(Number(e),1,this.maxSize),t=o.uZ(Number(t),1,this.maxSize),this.stage.fresco.size(e,t,s,this.anchor),this.stage.history.add({type:"pageSize",anchor:this.anchor,size:i}),document.dispatchEvent(new CustomEvent("layer-arrange")),this.stage.updateViewport(),this.cleanUp()},this.stage=e,this.maxSize=i.ZP.user.subscription?8192:4096,this.setContent(`\n            <label class="split">${(0,h.Z)("width")} <input type="number" id="page-size-width"/></label>\n            <label class="split">${(0,h.Z)("height")} <input type="number" id="page-size-height"/></label>\n        \n            <input type="checkbox" id="page-size-relative" />\n            <label class="switch pad-10" for="page-size-relative">${(0,h.Z)("dialogSizeRelative")}<span></span></label>\n        \n            <label class="pad-30">${(0,h.Z)("dialogSizeAnchor")}</label>\n            <div id="anchor-grid" class="anchor-grid">\n                <div class="row">\n                    <div data="TL" class="box"><div class="inner"></div></div>\n                    <div data="TC" class="box"><div class="inner"></div></div>\n                    <div data="TR" class="box"><div class="inner"></div></div>\n                </div>\n                <div class="row">\n                    <div data="CL" class="box"><div class="inner"></div></div>\n                    <div data="CC" class="box selected"><div class="inner"></div></div>\n                    <div data="CR" class="box"><div class="inner"></div></div>\n                </div>\n                <div class="row">\n                    <div data="BL" class="box"><div class="inner"></div></div>\n                    <div data="BC" class="box"><div class="inner"></div></div>\n                    <div data="BR" class="box"><div class="inner"></div></div>\n                </div>\n            </div>\n        \n            <small class="pad-30" style="display: block;">${(0,h.Z)("dialogSizeCropWarning")}</small>\n        `),(0,r.ZP)("page-size-width").value=this.stage.fresco.width.toString(),(0,r.ZP)("page-size-height").value=this.stage.fresco.height.toString(),(0,r.ZP)("page-size-relative").addEventListener("input",this.changepageRelative,!1);let t=(0,r.ZP)("anchor-grid").getElementsByClassName("box");for(var s=0;s<t.length;s++)t[s].addEventListener("click",this.anchorChange,!1);this.anchor="CC"}}},6584:(e,t,s)=>{s.d(t,{Z:()=>l});var i=s(3947),a=s(6548),n=s(3655),o=s(3868),r=s(9872),h=s(4820);class l extends o.Z{constructor(e,t){if(super((0,a.Z)("dialogPreResizeTitle")),this.rotation=0,this.size=1920,this.init=()=>new Promise(((e,t)=>{this.apply=()=>{(0,i.ZP)("preresize-never-ask-again").checked&&(0,h.Lt)("askToPreResize",!1);const t=new r.Z(Number((0,i.ZP)("pre-resize-width").value),Number((0,i.ZP)("pre-resize-height").value)),s=(0,i.ZP)("pre-resize-auto-rotate").checked?this.rotation:0;this.cleanUp(),e([t,s])},this.cancel=()=>{this.cleanUp(),e([void 0,void 0])}})),this.presetChange=e=>{let t=e.currentTarget,s=(0,i.ZP)("pre-resize-preset").getElementsByTagName("li");for(var a=0;a<s.length;a++)s[a].classList.remove("selected");t.classList.add("selected"),this.size=Number(t.getAttribute("data")),this.setSize()},this.imageSizeInputChange=e=>{let t,s,a=e.currentTarget;"pre-resize-width"===a.id?(t=n.uZ(Number(a.value),1,this.width),s=Math.round(t/this.width*this.height)):(s=n.uZ(Number(a.value),1,this.height),t=Math.round(s/this.height*this.width)),(0,i.ZP)("pre-resize-height").value=s.toString(),(0,i.ZP)("pre-resize-width").value=t.toString()},this.setSize=()=>{let e=(0,i.ZP)("pre-resize-width"),t=(0,i.ZP)("pre-resize-height");this.width>this.height?(e.value=this.size.toString(),t.value=Math.round(this.size/this.width*this.height).toString()):(t.value=this.size.toString(),e.value=Math.round(this.size/this.height*this.width).toString())},h.ZP.user.subscription?this.dialog.style.width="560px":this.dialog.style.width="480px",this.image=e,90===t||-90===t?(this.height=e.width,this.width=e.height):(this.width=e.width,this.height=e.height),this.rotation=t,this.setContent(`\n            <span style="display: block;">${(0,a.Z)("dialogPreResizeInfo1")} (<span id="pre-resize-start"></span>) ${(0,a.Z)("dialogPreResizeInfo2")}</span>\n\n            <input type="checkbox" id="preresize-never-ask-again" />\n            <label class="switch pad-10" for="preresize-never-ask-again">${(0,a.Z)("neverAskMeAgain")}<span></span></label>\n\n            <span id="pre-resize-auto-rotate-setting" style="display:none;">\n                <input type="checkbox" checked id="pre-resize-auto-rotate" />\n                <label class="switch pad-20" for="pre-resize-auto-rotate">${(0,a.Z)("dialogPreResizeExif")}<span></span></label>\n            </span>\n        \n            <ul id="pre-resize-preset" class="push-buttons pad-20">\n                <li id="pre-resize-original" data="4096"><img src="/img/icon/layer-image.svg" class="ic"><span>${(0,a.Z)("original")}<br /><small id="pre-resize-uhd-size">Max 3840 px</small></span></li>\n                <li id="pre-resize-uhd" data="3840"><img src="/img/icon/size-uhd.svg" class="ic"><span>${(0,a.Z)("sizeUltraHD")}<br /><small>Max 3840 px</small></span></li>\n                <li id="pre-resize-fhd" data="1920" class="selected"><img src="/img/icon/size-fhd.svg" class="ic"><span>${(0,a.Z)("sizeFullHD")}<br /><small>Max 1920 px</small></span></li>\n                <li id="pre-resize-uhd" data="1280"><img src="/img/icon/size-web.svg" class="ic"><span>${(0,a.Z)("sizeWeb")}<br /><small>Max 1280 px</small></span></li>\n            </ul>\n\n            <div class="pad-20" style="text-align:right;line-height:32px;">${(0,a.Z)("newSize")}<input type="number" style="text-align:center;margin-left:16px" id="pre-resize-width"/> x <input type="number" style="text-align:center" id="pre-resize-height"/></div>\n        `),this.maxSize=h.ZP.user.subscription?8192:4096,h.ZP.user.subscription?(this.width<3840&&this.height<3840&&((0,i.ZP)("pre-resize-uhd").style.display="none"),(0,i.ZP)("pre-resize-original").setAttribute("data",Math.min(Math.max(this.width,this.height),this.maxSize).toString()),(0,i.ZP)("pre-resize-uhd-size").innerText=(0,a.Z)("dialogPreResizeMaxSize",Math.min(Math.max(this.width,this.height),this.maxSize))):this.width<3840&&this.height<3840?((0,i.ZP)("pre-resize-uhd").style.display="none",(0,i.ZP)("pre-resize-original").setAttribute("data",Math.max(this.width,this.height).toString()),(0,i.ZP)("pre-resize-uhd-size").innerText=(0,a.Z)("dialogPreResizeMaxSize",Math.max(this.width,this.height))):(0,i.ZP)("pre-resize-original").style.display="none",0!==t){let e=(0,i.ZP)("pre-resize-auto-rotate-setting");e.style.display="block",e.addEventListener("change",(()=>{let e=(0,i.ZP)("pre-resize-width"),t=(0,i.ZP)("pre-resize-height");const s=e.value;e.value=t.value,t.value=s}),!1)}(0,i.ZP)("pre-resize-start").innerText=this.width.toString()+" x "+this.height.toString();let s=(0,i.ZP)("pre-resize-preset").getElementsByTagName("li");for(var o=0;o<s.length;o++)s[o].addEventListener("click",this.presetChange,!1);this.setSize(),(0,i.ZP)("pre-resize-width").addEventListener("change",this.imageSizeInputChange,!1),(0,i.ZP)("pre-resize-height").addEventListener("change",this.imageSizeInputChange,!1)}}},9091:(e,t,s)=>{s.a(e,(async(e,i)=>{try{s.d(t,{Z:()=>f});var a=s(6548),n=s(3868),o=s(4188),r=s(3947),h=s(5772),l=s(5700),c=s(3655),d=s(1030),u=s(4820),p=s(3409),g=s(8132),m=s(7630),v=e([g]);g=(v.then?(await v)():v)[0];class f extends n.Z{constructor(e){if(super((0,a.Z)("dialogSaveTitle"),!0),this.setTab=e=>{const t=e.currentTarget.getAttribute("data");this.changeTab(t)},this.changeTab=e=>{this.tab&&(0,r.ZP)("tab-"+this.tab).classList.remove("selected"),(0,r.ZP)("tab-"+e).classList.add("selected"),this.tab=e,(0,r.ZP)("type-jpg").style.display="image"===this.tab?"flex":"none",(0,r.ZP)("type-png").style.display="image"===this.tab?"flex":"none",(0,r.ZP)("type-webp").style.display="image"===this.tab&&this.hasWebP?"flex":"none",(0,r.ZP)("type-gif").style.display="animation"===this.tab?"flex":"none",(0,r.ZP)("type-mp4").style.display="animation"===this.tab?"flex":"none",(0,r.ZP)("type-zip").style.display="animation"===this.tab?"flex":"none",(0,r.ZP)("type-pdf").style.display="document"===this.tab?"flex":"none",this.changeType(this.type,!0)},this.setType=e=>{const t=e.currentTarget.getAttribute("data");this.changeType(t)},this.changeType=(e,t=!1)=>{if(!t&&this.type===e)return;let s;switch(e){case"gif":s=Number(document.querySelector('input[name="gif-scale"]:checked').value);break;case"mp4":s=Number(document.querySelector('input[name="mp4-scale"]:checked').value);break;case"zip":s=Number(document.querySelector('input[name="zip-scale"]:checked').value);break;default:s=1}if("jpg"===e){s=Number((0,r.ZP)("jpg-width").value)/this.stage.fresco.width}this.type&&(0,r.ZP)("type-"+this.type).classList.remove("active"),(0,r.ZP)("type-"+e).classList.add("active"),this.type=e,this.canvas.remove();let i="jpg"===this.type||"pdf"===this.type||"png"===this.type&&!(0,r.ZP)("png-transparent").checked||"webp"===this.type&&!(0,r.ZP)("webp-transparent").checked;this.canvas=this.stage.getOutputCanvas(s,i?"#ffffff":void 0),(0,r.ZP)("save-file-prop").innerHTML=this.canvas.width+" x "+this.canvas.height+"px",(0,r.ZP)("save-preview").prepend(this.canvas),this.renderBlob()},this.jpgSizeChange=e=>{let t=e.currentTarget;if(""!==t.value){if("jpg-width"===t.id){const e=c.uZ(Number(t.value),1,this.canvas.width),s=Math.round(e/this.stage.fresco.width*this.stage.fresco.height);(0,r.ZP)("jpg-height").value=s.toString()}else{const e=c.uZ(Number(t.value),1,this.canvas.width),s=Math.round(e/this.stage.fresco.height*this.stage.fresco.width);(0,r.ZP)("jpg-width").value=s.toString()}c.Ds("save",500,(()=>this.changeType("jpg",!0)))}},this.renderBlob=async()=>{if((0,r.ZP)("save-file-size").innerText=(0,a.Z)("dialogSaveCalculate"),"pxz"===this.type||"gif"===this.type||"mp4"===this.type||"zip"===this.type)return this.blob=void 0,void((0,r.ZP)("save-file-size").innerText=`Format: ${this.type}`);if("pdf"===this.type)return void this.canvas.toBlob((e=>{this.blob=e,(0,r.ZP)("save-file-size").innerText=`Format: ${this.type}, size: ${c.jb(e.size+1024)}`}),"image/jpeg",.9);const e="image/"+this.type.replace("jpg","jpeg"),t="jpg"===this.type?this.jpgquality.getValue():"webp"===this.type?this.webpquality.getValue():1;this.canvas.toBlob((e=>{this.blob=e,(0,r.ZP)("save-file-size").innerText=`Format: ${this.type}, size: ${c.jb(e.size)}`}),e,t)},this.applyAPi=()=>{let e=this;setTimeout((()=>{(0,d.Z)("save-dropbox");var t=new FormData;t.append("imageFile",this.blob,this.name+"."+this.type);let s=new XMLHttpRequest;s.onerror=function(t){e.setMessage("Error","Failed to save to dropbox, please try again.")},s.onreadystatechange=()=>{if(1===s.readyState)e.setMessage("Saving","uploading image to dropbox, please wait...");else if(4===s.readyState)if(200===s.status&&1==s.response.status){let t='<p>The image was saved on dropbox</p> <div class="buttons center"><a class="button positive xlarge"  href="'+s.response.data.view_file_url+'">view on dropbox</a></div>';e.setMessage("Save completed",t),(0,r.ZP)("dialog-close"+this.mid).style.display="none"}else e.setMessage("Error","Failed to save to dropbox, please try again.")},s.open("post","/x/dropbox/upload_file?upload_key="+u.ZP.uploadkey),s.responseType="json",s.send(t)}),200)},this.apply=async()=>{const e=this.type;let t;if((0,d.Z)("save-file",e),this.stage.fresco.savedTimesCounterForUserEase>0&&(this.name+="("+this.stage.fresco.savedTimesCounterForUserEase+")"),this.stage.fresco.savedTimesCounterForUserEase++,(0,m.Zp)()){let s="image/jpeg",i="Jpg image";switch(e){case"mp4":s="video/mp4",i="Mp4 video";break;case"zip":s="application/zip",i="Zip achive";break;case"pxz":s="application/pxz",i="Pixlr document";break;case"pdf":s="application/pdf",i="PDF document";break;case"png":s="image/png",i="PNG image";break;case"gif":s="image/gif",i="GIF image";break;case"webp":s="image/webp",i="WebP image"}if(t=await(0,m.f1)(this.name,e,i,s),!1===t)return}if("gif"===e){this.setWorking();try{let e=(0,r.ZP)("save-gif-repeat").checked,t=(0,r.ZP)("save-gif-inclusive").checked,s=Number(document.querySelector('input[name="gif-speed"]:checked').value),i=Number(document.querySelector('input[name="gif-scale"]:checked').value);const a=(0,m.DD)(this.stage,6,i,s,e,t,(e=>{(0,r.ZP)("save-progress").style.width=100*e+"%"}));(0,r.ZP)("dialog-cancel"+this.mid).addEventListener("click",(()=>a.cancel())),this.blob=await a}catch(s){return void(s instanceof c.Mk||(console.error(s),this.setMessage("Error when creating GIF file")))}}if("zip"===e){this.setWorking();try{let e=(0,r.ZP)("save-zip-inclusive").checked,t=Number(document.querySelector('input[name="zip-scale"]:checked').value),s=Number(document.querySelector('input[name="zip-fps"]:checked').value),i=new p.Z(this.stage,s,t,e),a=await i.requestFrame();const n=new Array;let o=0;for(;a;){(0,r.ZP)("save-progress").style.width=i.currentFrame/i.totalFrames*100+"%";const e=await new Promise((e=>a.toBlob(e,"image/png",1)));n.push(new File([e],"frame-"+o+".png")),a=await i.requestFrame(),o++}let h=new g.ZipWriter;for(let r=0;r<n.length;r++){const e=n[r];let t=await e.arrayBuffer(),s=new Uint8Array(t);h.writeFile(e.name,s,!1)}const l=h.finish();this.blob=new Blob([l.buffer])}catch(s){return console.error(s),void this.setMessage("Error when creating GIF file")}}if("mp4"===e){this.setWorking();try{let e=(0,r.ZP)("save-mp4-inclusive").checked,t=Number(document.querySelector('input[name="mp4-scale"]:checked').value),s=Number(document.querySelector('input[name="mp4-fps"]:checked').value),i=(0,m.sj)(this.stage,s,t,e,(e=>{(0,r.ZP)("save-progress").style.width=100*e+"%"}));(0,r.ZP)("dialog-cancel"+this.mid).addEventListener("click",(()=>i.cancel())),this.blob=await i}catch(s){return void(s instanceof c.Mk||(console.error(s),this.setMessage("Error when creating mp4 file")))}}if("pxz"===e){this.setMessage("Creating your PXZ file","You've selected a large file format, please wait while we create the file for you.");try{this.blob=await(0,m.iM)(this.stage,{id:this.stage.fresco.id,name:this.name,quality:"100",nonDestructive:(0,r.ZP)("save-pxz-ndestuctive").checked,type:"document",unit:"pixel"})}catch(s){return console.error(s),void this.setMessage("Error when creating PXZ file")}}if("pdf"===e){this.setMessage("Creating your PDF file","You've selected a large file format, please wait while we create the file for you.");try{this.blob=await(0,m.b4)(this.stage,this.blob)}catch(s){return console.error(s),void this.setMessage("Error when creating PDF file")}}if(!this.blob)return;if(t){await(0,m.BI)(t,new File([this.blob],this.name+"."+this.type))||(0,m.vV)(new File([this.blob],this.name+"."+this.type),this.name,this.type)}else{const t=await new h.Z(this.name,e).init();(0,m.vV)(new File([this.blob],""!==t?t:this.name+"."+e),t,e)}document.dispatchEvent(new CustomEvent("notification",{detail:(0,a.Z)("fileSaved")})),this.cleanUp(),"localhost"===location.hostname||u.ZP.user.subscription||new l.Z(this.stage)},this.setWorking=()=>{(0,r.ZP)("dialog-apply"+this.mid).style.display="none",(0,r.ZP)("dialog-api-apply")&&((0,r.ZP)("dialog-api-apply").style.display="none"),(0,r.ZP)("save-settings").style.display="none",(0,r.ZP)("save-working").style.display="block"},this.setMessage=(e,t="")=>{(0,r.ZP)("dialog-apply"+this.mid).style.display="none",(0,r.ZP)("dialog-api-apply")&&((0,r.ZP)("dialog-api-apply").style.display="none"),(0,r.ZP)("save-working").style.display="none",(0,r.ZP)("save-settings").style.display="none",(0,r.ZP)("save-message").style.display="block",(0,r.ZP)("save-message-title").innerText=e,(0,r.ZP)("save-message-body").innerHTML=t,(0,r.ZP)("dialog-cancel"+this.mid).innerText=(0,a.Z)("close")},e.fresco.block)return void this.cleanUp();this.stage=e,this.dialog.style.width="700px",this.dialog.style.minHeight="440px",this.content.classList.add("flex"),(0,r.ZP)("dialog-apply"+this.mid).innerText=(0,a.Z)("saveAs"),(0,r.ZP)("dialog-buttons"+this.mid).style.marginTop="0px",this.setContent(`\n        <section id="save-preview">\n            <div id="save-file-size" class="pad-10"></div>\n            <div id="save-file-prop"></div>\n        </section>\n        <section id="save-section">\n            <div id="save-message" style="display:none;">\n                <h2 id="save-message-title"></h2>\n                <p id="save-message-body"></p>\n            </div>\n            <div id="save-working" style="display:none;">\n                <h2>${(0,a.Z)("working")}...</h2>\n                \n                <div class="progress-bar pad-20">\n                    <span id="save-progress" class="inner"></span>\n                </div>\n            </div>\n\n            <div id="save-settings">\n\n                <ul class="tab-list" style="flex: 0 1 auto;margin-bottom:15px;margin-top:-5px">\n                <li data="animation" id="tab-animation">${(0,a.Z)("animation")}</li>\n                    <li data="image" id="tab-image">${(0,a.Z)("image")}</li>\n                    <li data="document" id="tab-document">${(0,a.Z)("document")}</li>\n                </ul>\n\n                <div id="type-jpg" data="jpg" class="option-task">\n                    <img src="/img/icon/file-jpg.svg" class="type ic">\n                    <div class="name">JPG <span>${(0,a.Z)("smallFilesPerfect")}</span></div>\n                    <div class="settings">\n                        <div id="jpg-quality"></div>\n\n                        <div id="jpg-quality-switch" class="switch-field stretch pad-10">\n                            <input type="radio" id="jpg-quality-low" name="jpg-quality-preset" value="50"/><label for="jpg-quality-low">${(0,a.Z)("dialogSaveLow")}</label>\n                            <input type="radio" id="jpg-quality-med" name="jpg-quality-preset" value="70" /><label for="jpg-quality-med">${(0,a.Z)("dialogSaveMed")}</label>\n                            <input type="radio" id="jpg-quality-high" name="jpg-quality-preset" value="90" checked /><label for="jpg-quality-high">${(0,a.Z)("dialogSaveHigh")}</label>\n                        </div>\n\n                        <label class="split pad-20">${(0,a.Z)("width")} <input type="number" id="jpg-width" value="${e.fresco.width}"/></label>\n                        <label class="split">${(0,a.Z)("height")} <input type="number" id="jpg-height" value="${e.fresco.height}"/></label>\n                    </div>\n                </div>\n\n                <div id="type-png" data="png" class="option-task">\n                    <img src="/img/icon/file-png.svg" class="type ic">\n                    <div class="name">PNG<span>${(0,a.Z)("largeAndLossless")}</span></div>\n                    <div class="settings">\n                        <input type="checkbox" id="png-transparent" checked>\n                        <label class="switch" for="png-transparent">${(0,a.Z)("transparent")}<span></span></label>\n                    </div>\n                </div>\n\n                <div id="type-webp" data="webp" class="option-task">\n                    <img src="/img/icon/file-webp.svg" class="type ic">\n                    <div class="name">WebP<span>${(0,a.Z)("modrenFormatSuitable")}</span></div>\n                    <div class="settings">\n                        <div id="webp-quality"></div>\n\n                        <div id="webp-quality-switch" class="switch-field stretch pad-10">\n                            <input type="radio" id="webp-quality-low" name="webp-quality-preset" value="50"/><label for="webp-quality-low">${(0,a.Z)("dialogSaveLow")}</label>\n                            <input type="radio" id="webp-quality-med" name="webp-quality-preset" value="70" /><label for="webp-quality-med">${(0,a.Z)("dialogSaveMed")}</label>\n                            <input type="radio" id="webp-quality-high" name="webp-quality-preset" value="90" checked /><label for="webp-quality-high">${(0,a.Z)("dialogSaveHigh")}</label>\n                        </div>\n\n                        <input type="checkbox" id="webp-transparent" checked>\n                        <label class="switch pad-20" for="webp-transparent">${(0,a.Z)("transparent")}<span></span></label>\n                    </div>\n                </div>\n\n                <div id="type-mp4" data="mp4" class="option-task">\n                    <img src="/img/icon/file-mp4.svg" class="type ic">\n                    <div class="name">MP4 <span>${(0,a.Z)("popularHighQuality")}</span></div>\n                    <div class="settings">\n\n                        <input type="checkbox" id="save-mp4-inclusive" />\n                        <label class="switch" for="save-mp4-inclusive">${(0,a.Z)("inclusiveAnimation")}<span></span></label>\n\n                        <label class="pad-10">${(0,a.Z)("fps")}</label>\n                        <div id="mp4-fps-switch" class="switch-field stretch">\n                            <input type="radio" id="mp4-fps-24" name="mp4-fps" value="24" checked/><label for="mp4-fps-24">24</label>\n                            <input type="radio" id="mp4-fps-30" name="mp4-fps" value="30" /><label for="mp4-fps-30">30</label>\n                            <input type="radio" id="mp4-fps-48" name="mp4-fps" value="48" /><label for="mp4-fps-48">48</label>\n                            <input type="radio" id="mp4-fps-60" name="mp4-fps" value="60" /><label for="mp4-fps-60">60</label>\n                        </div>\n\n                        <label class="pad-10">${(0,a.Z)("size")}</label>\n                        <div id="mp4-scale-switch" class="switch-field stretch">\n                            <input type="radio" id="mp4-scale-full" name="mp4-scale" value="1" checked/><label for="mp4-scale-full">1x</label>\n                            <input type="radio" id="mp4-scale-half" name="mp4-scale" value="0.5" /><label for="mp4-scale-half">0.5x</label>\n                            <input type="radio" id="mp4-scale-quart" name="mp4-scale" value="0.25" /><label for="mp4-scale-quart">0.25x</label>\n                        </div>                        \n                    </div>\n                </div>\n\n                <div id="type-gif" data="gif" class="option-task">\n                    <img src="/img/icon/file-gif.svg" class="type ic">\n                    <div class="name">GIF <span>%${(0,a.Z)("funAndSimpleAnimated")}</span></div>\n                    <div class="settings">\n\n                        <input type="checkbox" id="save-gif-inclusive" />\n                        <label class="switch" for="save-gif-inclusive">${(0,a.Z)("inclusiveAnimation")}<span></span></label>\n\n                        <input type="checkbox" id="save-gif-repeat" />\n                        <label class="switch pad-10" for="save-gif-repeat">${(0,a.Z)("loopAnimation")}<span></span></label>\n\n                        <label class="pad-10">${(0,a.Z)("speed")}</label>\n                        <div id="gif-speed-switch" class="switch-field stretch">\n                            <input type="radio" id="gif-speed-normal" name="gif-speed" value="1" checked/><label for="gif-speed-normal">1x</label>\n                            <input type="radio" id="gif-speed-double" name="gif-speed" value="2" /><label for="gif-speed-double">2x</label>\n                            <input type="radio" id="gif-speed-triple" name="gif-speed" value="3" /><label for="gif-speed-triple">3x</label>\n                        </div>\n\n                        <label class="pad-10">${(0,a.Z)("size")}</label>\n                        <div id="gif-scale-switch" class="switch-field stretch">\n                            <input type="radio" id="gif-scale-full" name="gif-scale" value="1"/><label for="gif-scale-full">1x</label>\n                            <input type="radio" id="gif-scale-half" name="gif-scale" value="0.5" checked/><label for="gif-scale-half">0.5x</label>\n                            <input type="radio" id="gif-scale-quart" name="gif-scale" value="0.25" /><label for="gif-scale-quart">0.25x</label>\n                        </div>\n                    </div>\n                </div>\n\n                <div id="type-pdf" data="pdf" class="option-task">\n                    <img src="/img/icon/file-pdf.svg" class="type ic">\n                    <div class="name">PDF <span>${(0,a.Z)("bestForFlyersAndMarketing")}.</span></div>\n                </div>\n\n                <div id="type-zip" data="zip" class="option-task">\n                    <img src="/img/icon/file-zip.svg" class="type ic">\n                    <div class="name">ZIP <span>${(0,a.Z)("aZipOfAllTheIndividual")}</span></div>\n                    <div class="settings">\n\n                        <input type="checkbox" id="save-zip-inclusive" />\n                        <label class="switch" for="save-zip-inclusive">${(0,a.Z)("inclusiveAnimation")}<span></span></label>\n\n                        <label class="pad-10">${(0,a.Z)("fps")}</label>\n                        <div id="zip-fps-switch" class="switch-field stretch">\n                            <input type="radio" id="zip-fps-2" name="zip-fps" value="2" checked/><label for="zip-fps-2">2</label>\n                            <input type="radio" id="zip-fps-6" name="zip-fps" value="6" /><label for="zip-fps-6">6</label>\n                            <input type="radio" id="zip-fps-24" name="zip-fps" value="24" /><label for="zip-fps-24">24</label>\n                            <input type="radio" id="zip-fps-60" name="zip-fps" value="60" /><label for="zip-fps-60">60</label>\n                        </div>\n\n                        <label class="pad-10">${(0,a.Z)("size")}</label>\n                        <div id="zip-scale-switch" class="switch-field stretch">\n                            <input type="radio" id="zip-scale-full" name="zip-scale" value="1" checked/><label for="zip-scale-full">1x</label>\n                            <input type="radio" id="zip-scale-half" name="zip-scale" value="0.5" /><label for="zip-scale-half">0.5x</label>\n                            <input type="radio" id="zip-scale-quart" name="zip-scale" value="0.25" /><label for="zip-scale-quart">0.25x</label>\n                        </div>                        \n                    </div>\n                </div>\n\n                <div id="type-pxz" data="pxz" class="option-task">\n                    <img src="/img/icon/file-pxz.svg" class="type ic">\n                    <div class="name">PXZ <span>${(0,a.Z)("completePixlrDocument")}</span></div>\n                    <div class="settings">\n                        <input type="checkbox" id="save-pxz-ndestuctive" />\n                        <label class="switch pad-10" for="save-pxz-ndestuctive">${(0,a.Z)("dialogSaveNonDestructive")}<span></span></label>\n                        <p>${(0,a.Z)("dialogSavePXZDescription")}</p>\n                    </div>\n                </div>\n            </div>\n        </section>\n        `),this.canvas=this.stage.getOutputCanvas(),this.hasWebP=-1!==c.vL(5,5).toDataURL("image/webp").indexOf("webp"),this.stage.fresco.hasAnimation()?((0,r.ZP)("tab-animation").style.display="block",this.tab="animation",this.type="mp4"):((0,r.ZP)("tab-animation").style.display="none",this.type=c.EL(this.canvas)?"png":"jpg",this.tab="image"),(0,r.ZP)("type-"+this.type).append((0,r.T)("div",{className:"reko"},(0,a.Z)("recommend"))),(0,r.ZP)("tab-image").addEventListener("click",this.setTab),(0,r.ZP)("tab-animation").addEventListener("click",this.setTab),(0,r.ZP)("tab-document").addEventListener("click",this.setTab),(0,r.ZP)("type-jpg").addEventListener("click",this.setType),(0,r.ZP)("type-png").addEventListener("click",this.setType),(0,r.ZP)("type-webp").addEventListener("click",this.setType),(0,r.ZP)("type-pdf").addEventListener("click",this.setType),(0,r.ZP)("type-pxz").addEventListener("click",this.setType),(0,r.ZP)("type-mp4").addEventListener("click",this.setType),(0,r.ZP)("type-gif").addEventListener("click",this.setType),(0,r.ZP)("type-zip").addEventListener("click",this.setType),u.ZP.api&&"dropbox"===u.ZP.referrer&&(0,r.ZP)("dialog-apply"+this.mid).after((0,r.T)("a",{id:"dialog-api-apply",className:"button positive",onclick:()=>this.applyAPi()},(0,r.T)("img",{src:"/img/misc/dropbox-icon.svg"})," save"));let t=this.stage.fresco.name.lastIndexOf(".");this.name=-1!==t?this.stage.fresco.name.substring(0,t):this.stage.fresco.name,this.jpgquality=new o.Z("jpg-quality",{range:[.01,1],defaultValue:.9,step:.001,label:(0,a.Z)("quality"),labelFormat:e=>(100*e).toFixed(0)+"%",labelParse:e=>parseInt(e,10)/100,onEnd:e=>{e<.5?(0,r.ZP)("jpg-quality-low").checked=!0:e<.8?(0,r.ZP)("jpg-quality-med").checked=!0:(0,r.ZP)("jpg-quality-high").checked=!0,this.renderBlob()}});let s=(0,r.ZP)("jpg-quality-switch").getElementsByTagName("input");for(var i=0;i<s.length;i++)s[i].addEventListener("change",(e=>{let t=e.currentTarget;this.jpgquality.setValue(Number(t.value)/100),this.renderBlob()}),!1);let n=(0,r.ZP)("jpg-width");n.addEventListener("change",this.jpgSizeChange,!1),n.addEventListener("input",this.jpgSizeChange,!1);let v=(0,r.ZP)("jpg-height");v.addEventListener("change",this.jpgSizeChange,!1),v.addEventListener("input",this.jpgSizeChange,!1),this.webpquality=new o.Z("webp-quality",{range:[.01,1],defaultValue:.9,step:.001,label:(0,a.Z)("quality"),labelFormat:e=>(100*e).toFixed(0)+"%",labelParse:e=>parseInt(e,10)/100,onEnd:e=>{e<.5?(0,r.ZP)("webp-quality-low").checked=!0:e<.8?(0,r.ZP)("webp-quality-med").checked=!0:(0,r.ZP)("webp-quality-high").checked=!0,this.renderBlob()}}),s=(0,r.ZP)("webp-quality-switch").getElementsByTagName("input");for(i=0;i<s.length;i++)s[i].addEventListener("change",(e=>{let t=e.currentTarget;this.webpquality.setValue(Number(t.value)/100),this.renderBlob()}),!1);(0,r.ZP)("webp-transparent").addEventListener("change",(()=>this.changeType("webp",!0))),(0,r.ZP)("png-transparent").addEventListener("change",(()=>this.changeType("png",!0))),s=(0,r.ZP)("gif-scale-switch").getElementsByTagName("input");for(i=0;i<s.length;i++)s[i].addEventListener("change",(e=>{this.changeType("gif",!0)}),!1);s=(0,r.ZP)("gif-speed-switch").getElementsByTagName("input");for(i=0;i<s.length;i++)s[i].addEventListener("change",(e=>{this.changeType("gif",!0)}),!1);s=(0,r.ZP)("mp4-scale-switch").getElementsByTagName("input");for(i=0;i<s.length;i++)s[i].addEventListener("change",(e=>{this.changeType("mp4",!0)}),!1);s=(0,r.ZP)("zip-scale-switch").getElementsByTagName("input");for(i=0;i<s.length;i++)s[i].addEventListener("change",(e=>{this.changeType("zip",!0)}),!1);u.ZP.api&&u.ZP.locktarget&&"dropbox"===u.ZP.referrer&&((0,r.ZP)("dialog-apply"+this.mid).style.display="none"),u.ZP.api&&"dropbox"===u.ZP.referrer&&((0,r.ZP)("dialog-api-apply").style.display="inline-block"),this.changeTab(this.tab)}}i()}catch(f){i(f)}}))},670:(e,t,s)=>{s.d(t,{Z:()=>c});var i=s(6548),a=s(3655),n=s(3868),o=s(3947),r=s(4170),h=s(4256),l=s(1294);class c extends n.Z{constructor(e,t,s=!1){super(t,!1,s),this.isMasked=!1,this.createCombinationMask=(e=!0)=>{if(this.selected.type===r.Z.TYPE_FRAME||!this.stage.fresco.hasSelection()&&!e)return;let t=this.selected;if(!this.stage.fresco.hasSelection()&&!t.hasMask())return;let s=a.vL(t.canvas.width,t.canvas.height),i=s.getContext("2d");return this.stage.fresco.hasSelection()&&i.drawImage(this.stage.fresco.selection.mask,-t.rect.x,-t.rect.y),e&&t.hasMask()&&(i.save(),this.stage.fresco.hasSelection()&&(i.globalCompositeOperation="destination-in"),i.drawImage(this.selected.mask,0,0),i.restore()),i=void 0,s},this.compareDown=()=>{this.scratch.canvas=this.cache,window.requestAnimationFrame((()=>this.stage.render()))},this.compareUp=()=>{this.scratch.canvas=this.shaders.apply(this.cache),window.requestAnimationFrame((()=>this.stage.render()))},this.change=(e,t)=>{this.selected.canvas&&(this.kind||(this.kind=e),this.shaders.addShader(e,t),setTimeout((()=>{this.scratch.canvas=this.shaders.apply(this.cache),window.requestAnimationFrame((()=>this.stage.render()))}),0))},this.cancel=()=>{this.cleanUp()},this.apply=()=>{if(this.scratch&&this.shaders.chain.length>0){const t=this.selected.trim?this.selected.trim.clone():this.selected.rect.clone(),s=a.dN(this.selected.canvas);this.stage.history.add({type:"bitmapSwitch",kind:this.kind,layer:this.selected,rect:t,canvas:s});let i=this.createCombinationMask(!1);if(i){this.cache=a.dN(this.selected.canvas);var e=this.cache.getContext("2d");e.save(),e.globalCompositeOperation="destination-in",e.drawImage(i,0,0),e.restore(),e=null,this.isMasked=!0}else this.cache=this.selected.canvas,this.isMasked=!1;this.scratch.canvas=this.shaders.apply(this.cache),this.scratch.drawToLayer(this.selected,this.isMasked?"source-over":"copy",1),this.selected.render()}this.cleanUp()},this.cleanUp=()=>{this.stage.coating.freeze(!1),this.stage.fresco.removeScratch(),document.removeEventListener("keydown",this.keyDown,!1),this.compare.removeEventListener("mousedown",this.compareDown,!0),this.compare.removeEventListener("mouseup",this.compareUp,!0),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-select")),this.selected=void 0,this.shaders.cleanUp(),this.shaders=void 0,this.dialog.remove(),this.dialog=void 0,this.modal.remove(),this.modal=void 0},this.stage=e,this.stage.coating.freeze(!0),this.shaders=new h.Z,this.compare=(0,o.T)("div",{className:"icon-button compare"},(0,o.T)("img",{src:"/img/icon/compare.svg",className:"ic"})),this.compare.setAttribute("tooltip",(0,i.Z)("compare")),this.compare.setAttribute("flow","down"),this.compare.addEventListener("mousedown",this.compareDown,!0),this.compare.addEventListener("mouseup",this.compareUp,!0),(0,o.ZP)("dialog-buttons"+this.mid).append(this.compare),this.selected=this.stage.fresco.getSelected();let n=this.createCombinationMask();if(n){this.cache=a.dN(this.selected.canvas);var c=this.cache.getContext("2d");c.save(),c.globalCompositeOperation="destination-in",c.drawImage(n,0,0),c.restore(),c=null,this.isMasked=!0}else this.cache=this.selected.canvas;this.scratch=this.stage.fresco.addScratch(),this.scratch.setTarget(this.selected.id,this.selected.trim&&this.selected instanceof l.Z?this.selected.getGlobalTrim():this.selected.rect,this.isMasked?"over":"replace"),this.scratch.settings.blendmode=this.selected.settings.blendmode,this.scratch.settings.opacity=this.selected.settings.opacity,this.scratch.canvas=this.cache}}},7146:(e,t,s)=>{s.d(t,{Z:()=>h});var i=s(3947),a=s(7359),n=s(8776),o=s(9067),r=s(4977);class h{constructor(e,t,s,h){this.previewFill=e=>{this.setFill(e),this.preview&&this.preview(this.fill)},this.callbackFill=e=>{this.setFill(e),this.callback&&this.callback(this.fill)},this.setFill=e=>{this.fill=e,this.holder.classList.remove("empty"),this.holder.style.backgroundColor="unset",this.holder.style.backgroundImage="unset",this.fill&&this.fill.value?this.fill.value instanceof n.Z?this.holder.style.backgroundColor=this.fill.value.toHEX():(this.fill.value instanceof a.ZP||this.fill.value instanceof o.Z)&&(this.holder.style.backgroundImage=this.fill.value.toCSS()):this.holder.classList.add("empty")},this.getFill=()=>this.fill,this.picker=()=>{new r.Z(this.container,this.fill,this.callbackFill,this.previewFill)},this.cleanUp=()=>{this.container.removeEventListener("click",this.picker,!1)},this.fill=t,this.preview=h,this.callback=s,this.container=(0,i.ZP)(e),this.container.hasChildNodes()?this.holder=(0,i.ZP)(e+"-holder"):(this.holder=(0,i.T)("div",{id:e+"-holder"}),this.container.appendChild(this.holder)),this.container.classList.add("fill-pod"),this.container.addEventListener("click",this.picker,!1),this.setFill(t)}}},4977:(e,t,s)=>{s.d(t,{Z:()=>g});var i=s(6548),a=s(8829),n=s(3947),o=s(9591),r=s(7359),h=s(8776),l=s(4820),c=s(9067),d=s(6230),u=s(2397),p=s(276);class g extends a.Z{constructor(e,t,s,a){super(e,(0,i.Z)("fill"),!1),this.setSectionEvent=e=>{let t=e.target;this.setSection(t.value)},this.setSection=(e="color")=>{switch(this.holder.innerHTML="",this.patternselector=void 0,this.colorselector=void 0,this.gradselector=void 0,(0,n.ZP)("fill-type-"+e).checked=!0,e){case"color":this.colorselector=new u.Z(this.holder,[...l.ZP.oldColor.slice(),"#ffffff","#888888","#000000"],this.setFill,!0,300,120,!0);break;case"gradient":this.gradselector=new d.Z(void 0,this.holder,this.setFill,!0);break;case"pattern":this.patternselector=new p.Z(this.holder,this.setFill)}this.fill&&(this.patternselector&&this.fill.value instanceof c.Z&&this.patternselector.setPattern(this.fill.value),this.colorselector&&this.fill.value instanceof h.Z&&this.colorselector.setColor(this.fill.value),this.gradselector&&this.fill.value instanceof r.ZP&&this.gradselector.setGrad(this.fill.value))},this.setFill=e=>{this.fill=new o.Z(e),this.preview&&this.preview(this.fill)},this.cleanUp=()=>{this.callback&&this.fill.value instanceof h.Z&&(0,l.nS)(this.fill.value),this.callback(this.fill),this.superClean()},this.fill=t,this.preview=a,this.callback=s,this.float.style.width="320px",this.content.style.padding="10px";let g=(0,n.T)("div",{style:"position:relative"});this.holder=(0,n.T)("div",{id:"fill-selector-presets",className:"pad-10"}),this.setContent(g,(0,n.T)("div",{className:"splitter pad-10"}),this.holder),g.innerHTML+=`\n        <div id="fill-type" class="switch-field" style="display:flex;margin:0;">\n            <input type="radio" id="fill-type-color" name="fill-type" value="color"/><label for="fill-type-color">${(0,i.Z)("color")}</label>\n            <input type="radio" id="fill-type-gradient" name="fill-type" value="gradient" /><label for="fill-type-gradient">${(0,i.Z)("gradient")}</label>\n            <input type="radio" id="fill-type-pattern" name="fill-type" value="pattern" /><label for="fill-type-pattern">${(0,i.Z)("pattern")}</label>\n        </div>\n        `,(0,n.ZP)("fill-type-color").addEventListener("change",this.setSectionEvent,!0),(0,n.ZP)("fill-type-gradient").addEventListener("change",this.setSectionEvent,!0),(0,n.ZP)("fill-type-pattern").addEventListener("change",this.setSectionEvent,!0),this.setSection(null==t?void 0:t.getType())}}},8829:(e,t,s)=>{s.d(t,{Z:()=>r});var i=s(3655),a=s(3947),n=s(3673),o=s(4820);class r{constructor(e,t,s=!1){this.docked=!1,this.setTitle=(e,t=40)=>{e=e.length>t?`${e.substring(0,5)}...`:e,(0,a.ZP)("float-title-"+this.mid).innerHTML=e},this.position=()=>{if(this.parent)if("x"===o.ZP.product)this.float.style.left="20px",this.float.style.top=Math.round(((0,a.ZP)("workspace").clientHeight-this.float.clientHeight)/2)+"px";else{let e=this.parent.getBoundingClientRect();this.float.style.left=~~(e.right-this.float.clientWidth/2-e.width/2)+"px",this.float.style.top=e.top+30+"px"}else{const e=(0,a.ZP)("workspace").getBoundingClientRect();this.docked?(this.float.style.left="unset",this.float.style.right="0",this.float.style.top="77px",this.float.style.height=e.height-77+"px"):(this.float.style.left=e.width-~~(this.float.offsetWidth/2)-400+"px",this.float.style.height="600px",this.float.style.top="120px"),this.float.classList.toggle("docked",this.docked)}},this.setContent=(...e)=>{e[0]instanceof HTMLElement?this.content.append(...e):this.content.innerHTML+=e[0],this.position()},this.dragStart=e=>{this.docked||(this.p=e,this.d=new n.Z(this.float.offsetLeft,this.float.offsetTop))},this.dragMove=e=>{this.docked||(this.float.style.left=Math.round(this.d.x+(e.x-this.p.x))+"px",this.float.style.top=Math.round(this.d.y+(e.y-this.p.y))+"px")},this.dragEnd=e=>{if(this.docked)return;let t=Math.round(this.d.y+(e.y-this.p.y)),s=Math.round(this.d.x+(e.x-this.p.x)),i=this.float.offsetWidth;t<20&&(t=20),s<-i/2&&(s=0),s+i/2>(0,a.ZP)("workspace").offsetWidth&&(s=(0,a.ZP)("workspace").offsetWidth-i),this.float.style.left=s+"px",this.float.style.top=t+"px"},this.resizeStart=e=>{this.d=new n.Z(this.float.clientHeight,e.y)},this.resizeMove=e=>{const t=this.d.x+(e.y-this.d.y);this.float.style.height=(t<320?320:t)+"px"},this.keyDown=e=>{"Enter"!==e.key&&"Escape"!==e.key||this.cleanUp()},this.superClean=()=>{var e;document.removeEventListener("keydown",this.keyDown,!1),this.float.remove(),this.float=null,null===(e=this.modal)||void 0===e||e.remove(),this.modal=null},this.cleanUp=()=>{this.superClean()},this.parent=e,this.mid=i.Zd(),this.parent&&(document.addEventListener("keydown",this.keyDown,!1),this.modal=(0,a.T)("div",{id:"modal-"+this.mid,className:"modal"}),this.modal.addEventListener("click",(e=>{e.target===this.modal&&this.cleanUp()})),document.body.appendChild(this.modal)),this.float=(0,a.T)("div",{className:"float"}),this.modal?this.modal.appendChild(this.float):(0,a.ZP)("workspace").append(this.float),this.content=(0,a.T)("div",{className:"content"});const r=(0,a.T)("div",{id:"float-title-"+this.mid,className:"title"},t);if((0,a.Rg)(r,this.dragStart,this.dragMove,this.dragEnd),this.float.append(r,(0,a.T)("img",{id:"float-close"+this.mid,className:"close ic",src:"/img/icon/close.svg",onclick:()=>this.cleanUp()}),(0,a.T)("div",{className:"splitter small"}),this.content),s){const e=(0,a.T)("img",{id:"resize-"+this.mid,src:"/img/icon/three-dot.svg",className:"resize ic"});(0,a.Rg)(e,this.resizeStart,this.resizeMove),this.float.append(e)}this.position()}}},5131:(e,t,s)=>{s.d(t,{Z:()=>c});var i=s(3947),a=s(6230),n=s(6548),o=s(3655),r=s(4188),h=s(8776);class l{constructor(e){this.updatePreview=()=>{this.preview.style.backgroundImage=this.grad.toCSS(),this.callback&&this.callback(this.grad)},this.populateStops=()=>{this.stoplist.innerHTML="";for(let e=0;e<this.grad.stops.length;++e){const t=Math.round(300*this.grad.stops[e].position);this.stoplist.append((0,i.T)("div",{id:this.grad.stops[e].id,className:"knob",style:"left:"+t+"px"},(0,i.T)("div",{id:this.grad.stops[e].id+"-color",style:"background:"+this.grad.stops[e].color.toHEX()})))}this.setHandlers()},this.addStop=e=>{e.stopPropagation(),e.preventDefault();const t=this.grad.addStop(new h.Z(0,255,0),Math.round(e.clientX-this.container.offsetLeft-14)/300),s=Math.round(300*t.position),a=(0,i.T)("div",{id:t.id,className:"knob",style:"left:"+s+"px"},(0,i.T)("div",{id:t.id+"-color",style:"background:"+t.color.toHEX()}));a.addEventListener("mousedown",this.mouseDown,!0),a.addEventListener("touchstart",this.touchStart,{passive:!0}),this.stoplist.append(a),this.selectStop(t.id),this.updatePreview()},this.removeStop=()=>{if(this.grad.stops.length>2){(0,i.ZP)(this.selected.id)&&(0,i.ZP)(this.selected.id).remove();const e=this.grad.removeStop(this.selected.id);this.selected=void 0,this.selectStop(e),this.updatePreview()}},this.selectStop=e=>{this.selected&&this.selected.id===e||(this.selected&&(0,i.ZP)(this.selected.id)&&(0,i.ZP)(this.selected.id).classList.remove("selected"),this.selected=this.grad.getStop(e),(0,i.ZP)(this.selected.id).classList.add("selected"),this.opacity.setValue(this.selected.color.a/255),(0,i.ZP)("grad-editor-remove").classList.toggle("disabled",this.grad.stops.length<3))},this.down=(e,t,s)=>{this.selectStop(s.id),this.downX=e,this.target=s,this.start=s.offsetLeft+6},this.move=(e,t)=>{let s=o.uZ(this.start+(e-this.downX),0,300);this.target.style.left=s+"px",this.selected.position=s/300,this.grad.sort(),this.updatePreview()},this.setHandlers=()=>{const e=document.querySelectorAll("#grad-editor-stoplist > .knob");for(let t=0;t<e.length;t++)e[t].addEventListener("mousedown",this.mouseDown,!0),e[t].addEventListener("touchstart",this.touchStart,{passive:!0}),0===t&&this.selectStop(e[t].id)},this.removeHandlers=()=>{const e=document.querySelectorAll("#grad-editor-stoplist > .knob");for(let t=0;t<e.length;t++)e[t].removeEventListener("mousedown",this.mouseDown,!0),e[t].removeEventListener("touchstart",this.touchStart)},this.touchStart=e=>{e.preventDefault(),e.stopPropagation(),this.down(e.changedTouches[0].clientX,e.changedTouches[0].clientY,e.currentTarget),document.addEventListener("touchmove",this.touchMove,{passive:!0}),document.addEventListener("touchend",this.touchEnd,{passive:!0})},this.touchMove=e=>{e.preventDefault(),e.stopPropagation(),this.move(e.changedTouches[0].clientX,e.changedTouches[0].clientY)},this.touchEnd=e=>{e.preventDefault(),e.stopPropagation(),document.removeEventListener("touchmove",this.touchMove),document.removeEventListener("touchend",this.touchEnd)},this.mouseDown=e=>{e.preventDefault(),e.stopPropagation(),this.down(e.clientX,e.clientY,e.currentTarget),document.addEventListener("mousemove",this.mouseMove,!0),document.addEventListener("mouseup",this.mouseUp,!0)},this.mouseMove=e=>{e.stopPropagation(),this.move(e.clientX,e.clientY)},this.mouseUp=e=>{e.stopPropagation(),e.preventDefault(),document.removeEventListener("mousemove",this.mouseMove,!0),document.removeEventListener("mouseup",this.mouseUp,!0)},this.cleanUp=()=>{var e;this.removeHandlers(),this.addlist.removeEventListener("click",this.addStop,!0),(0,i.ZP)("grad-editor-remove").removeEventListener("click",this.removeStop,!0),this.gradpod.update(this.grad),this.container.remove(),null===(e=this.modal)||void 0===e||e.remove()},this.gradpod=e,this.grad=e.grad,this.modal=(0,i.ZP)("workspace").appendChild((0,i.T)("div",{id:"grad-editor-modal",className:"modal"}));let t=(0,i.T)("div",{style:"position:relative"}),s=(0,i.T)("div",{className:"option",style:"display:flex;position:relative"});this.container=(0,i.T)("div",{id:"grad-editor"},t,s),this.container.classList.add("grad-editor-float"),(0,i.ZP)("workspace").appendChild(this.container),this.preview=(0,i.T)("div",{id:"grad-editor-preview"}),this.stoplist=(0,i.T)("div",{id:"grad-editor-stoplist"}),this.addlist=(0,i.T)("div",{id:"grad-editor-addlist"}),t.append((0,i.T)("div",{id:"grad-editor-preview-holder"},this.preview),this.stoplist,this.addlist),s.append((0,i.T)("div",{id:"grad-editor-opacity"}),(0,i.T)("ul",{className:"icon-button-set",style:"margin-left:auto"},(0,i.T)("li",{id:"grad-editor-remove"},(0,i.T)("img",{src:"/img/icon/delete.svg",className:"ic"}))));const a=(0,i.ZP)("grad-editor-remove");a.setAttribute("tooltip",(0,n.Z)("removeStop")),a.setAttribute("flow","down"),a.addEventListener("click",this.removeStop,!0);let l=this.gradpod.container.getBoundingClientRect();this.modal.addEventListener("click",(e=>{e.stopPropagation(),e.preventDefault(),e.target===e.currentTarget&&this.cleanUp()}),!1),this.container.style.top=l.bottom+5+"px",this.container.style.left=l.left-5+"px",this.container.style.display="flex",this.preview=(0,i.ZP)("grad-editor-preview"),this.opacity=new r.Z("grad-editor-opacity",{label:(0,n.Z)("opacity")+":",compact:!0,defaultValue:1,labelFormat:e=>(100*e).toFixed(0)+"%",labelParse:e=>parseInt(e,10)/100,onChange:e=>{this.selected.color.a=Math.round(255*e),this.updatePreview()}}),this.addlist.addEventListener("click",this.addStop,!1),this.populateStops(),this.setHandlers(),this.updatePreview()}}class c{constructor(e,t,s=!1){this.update=e=>{this.grad=e,this.container.style.backgroundImage=this.grad.toCSS()},this.picker=()=>{this.mini?new l(this):new a.Z(this,void 0,this.update)},this.cleanUp=()=>{this.container.removeEventListener("click",this.picker,!1)},this.grad=t,this.mini=s,this.container=(0,i.ZP)(e),this.container.classList.add("grad-pod"),this.container.style.backgroundImage=this.grad.toCSS(),this.container.addEventListener("click",this.picker,!1)}}},6230:(e,t,s)=>{s.d(t,{Z:()=>p});var i=s(6548),a=s(3655),n=s(4188),o=s(3947),r=s(3673),h=s(4211),l=s(8776),c=s(4178),d=s(4820),u=s(7359);class p{constructor(e,t,s,p=!1){this.populatePresets=()=>{let e=[new u.Rt([d.ZP.mainColor+"FF",d.ZP.altColor+"FF"],[0,1]),new u.Rt(["#000000FF","#FFFFFFFF"],[0,1]),new u.Rt(["#999999FF","#03205AFF","#000000FF"],[0,.5,1]),new u.Rt(["#000000FF","#00000000"],[0,1]),new u.Rt(["#FFFFFFFF","#FFFFFF00"],[0,1]),new u.Rt(["#00A8DFFF","#323496FF","#CA1688FF","#EB2E2EFF","#FDE92DFF","#009E54FF"],[0,.2,.4,.6,.8,1]),new u.Rt(["#0B01B8FF","#DE9E31FF","#0B01B8FF"],[.25,.5,.75]),new u.Rt(["#000000FF","#FF0000FF"],[0,1]),new u.Rt(["#FFFFFFFF","#FF0000FF"],[0,1]),new u.Rt(["#FFFFFFFF","#00FF00FF"],[0,1]),new u.Rt(["#FFFFFFFF","#0000FFFF"],[0,1]),new u.Rt(["#00FFFFFF","#FF8000FF"],[0,1]),new u.Rt(["#c2e59cff","#64b3f4ff"],[0,1]),new u.Rt(["#8E0E00FF","#1F1C18FF"],[0,1]),new u.Rt(["#f46b45FF","#eea849FF"],[0,1]),new u.Rt(["#fc00ffff","#00dbdeff"],[0,1]),new u.Rt(["#CCCCB2ff","#757519ff"],[0,1]),new u.Rt(["#F1F2B5FF","#135058FF"],[0,1]),new u.Rt(["#7b4397FF","#dc2430FF"],[0,1]),new u.Rt(["#8e9eabFF","#eef2f3FF"],[0,1]),new u.Rt(["#00bf8fFF","#001510FF"],[0,1]),new u.Rt(["#ff0084FF","#33001bFF"],[0,1]),new u.Rt(["#833ab4FF","#fd1d1dFF","#fcb045FF"],[0,.5,1]),new u.Rt(["#FEAC5EFF","#C779D0FF","#fcb045FF"],[0,.5,1]),new u.Rt(["#6441A5FF","#2a0845FF"],[0,1]),new u.Rt(["#43cea2FF","#185a9dFF"],[0,1]),new u.Rt(["#FFA17FFF","#00223EFF"],[0,1]),new u.Rt(["#360033FF","#0b8793FF"],[0,1]),new u.Rt(["#948E99FF","#2E1437FF"],[0,1]),new u.Rt(["#1e130cFF","#9a8478FF"],[0,1]),new u.Rt(["#D38312FF","#A83279FF"],[0,1]),new u.Rt(["#70e1f5FF","#ffd194FF"],[0,1]),new u.Rt(["#556270FF","#ff6b6bFF"],[0,1]),new u.Rt(["#000000FF","#e74c3cFF"],[0,1]),new u.Rt(["#f0c27bff","#4b1248ff"],[0,1]),new u.Rt(["#fbd3e9ff","#bb377dff"],[0,1]),new u.Rt(["#649173ff","#dbd5a4ff"],[0,1]),new u.Rt(["#b993d6ff","#8ca6dbff"],[0,1]),new u.Rt(["#d3959bff","#bfe6baff"],[0,1]),new u.Rt(["#dad299ff","#b0dab9ff"],[0,1]),new u.Rt(["#f2709cff","#ff9472ff"],[0,1]),new u.Rt(["#5d4157ff","#a8cabaff"],[0,1]),new u.Rt(["#ddd6f3ff","#faaca8ff"],[0,1]),new u.Rt(["#fc354cff","#0abfbcff"],[0,1]),new u.Rt(["#414d0bff","#727a17ff"],[0,1]),new u.Rt(["#134e5eff","#71b280ff"],[0,1]),new u.Rt(["#2bc0e4ff","#eaecc6ff"],[0,1]),new u.Rt(["#603813ff","#b29f94ff"],[0,1]),new u.Rt(["#bbd2c5FF","#536976FF","#292e49FF"],[0,.5,1]),new u.Rt(["#1e9600FF","#fff200FF","#ff0000FF"],[0,.5,1]),new u.Rt(["#06beb6ff","#48b1bfff"],[0,1]),new u.Rt(["#eb3349ff","#f45c43ff"],[0,1]),new u.Rt(["#56ab2fff","#a8e063ff"],[0,1]),new u.Rt(["#614385ff","#516395ff"],[0,1]),new u.Rt(["#ddd6f3ff","#faaca8ff"],[0,1]),new u.Rt(["#3a1c71FF","#d76d77FF","#ffaf7bFF"],[0,.5,1]),new u.Rt(["#4ca1afff","#c4e0e5ff"],[0,1]),new u.Rt(["#dbdcd7ff","#b8235aff","#801357ff","#3d1635ff","#1c1a27ff"],[0,.59,.71,.84,1]),new u.Rt(["#f83600ff","#f9d423ff"],[0,1]),new u.Rt(["#71a192ff","#b7bb81ff","#f5b752ff","#db6549ff","#7b4163ff"],[0,.25,.5,.8,1]),new u.Rt(["#00737AFF","#DE5159FF","#7F3038ff","#150C14FF"],[0,.5,.75,1]),new u.Rt(["#8FB9A8FF","#FEFAD4FF","#FCD0BAff","#F1828DFF","#765D69FF"],[0,.4,.5,.75,1]),new u.Rt(["#F26627FF","#F9A26CFF","#EFEEEEff","#98D7D1FF","#325D79FF"],[0,.3,.5,.75,1]),new u.Rt(["#F18C8EFF","#F0B7A4FF","#F1D1B5ff","#568EA6FF","#305F72FF"],[0,.3,.5,.75,1]),new u.Rt(["#FCBB6DFF","#D8737FFF","#AB6CB2FF","#685D79FF","#475C7AFF"],[0,.3,.5,.75,1]),new u.Rt(["#CC2A49FF","#F99E4CFF","#F36F38FF","#EF4648FF","#582841FF"],[0,.3,.5,.75,1]),new u.Rt(["#092B38FF","#9C5773FF","##CDCDC5FF"],[0,.5,1]),new u.Rt(["#009e00FF","#ffff96FF"],[0,1]),new u.Rt(["#fcce78FF","#7e2d02FF"],[0,1]),new u.Rt(["#ffdb01FF","#0e197dFF"],[0,1]),new u.Rt(["#B4C6CCFF","#FE4929FF"],[0,1]),new u.Rt(["#B71970FF","#01416DFF"],[0,1]),new u.Rt(["#471B0DFF","#F0E867FF"],[0,1]),new u.Rt(["#1A2713FF","#E2EAB1FF"],[0,1]),new u.Rt(["#B03F2AFF","#FFEBB0FF"],[0,1])];const t=(0,o.ZP)("grad-selector-presets-ss-content");if(this.extended){const e=(0,o.T)("div",{className:"grad-pod square empty"});e.setAttribute("data","empty"),e.addEventListener("click",this.selectPreset,!0),t.append(e)}e.forEach((e=>{const s=(0,o.T)("div",{className:"grad-pod square",style:"background:"+e.toCSS()});s.setAttribute("data",JSON.stringify(e)),s.addEventListener("click",this.selectPreset,!0),t.append(s)}))},this.selectPreset=e=>{this.removeHandlers(),this.marked&&this.marked.classList.remove("selected"),this.marked=e.currentTarget,this.marked.classList.add("selected"),"empty"!==this.marked.getAttribute("data")?(this.grad=u.ZP.fromPreset(a.mS(u.Rt,JSON.parse(this.marked.getAttribute("data")))),this.extended&&(this.grad.direction=this.direction.getValue(),this.grad.type=(0,o.ZP)("grad-type-linear").checked?"linear":"radial"),this.populateStops(),this.updatePreview()):this.callback&&this.callback(void 0)},this.setGrad=e=>{this.grad=e,this.extended&&((0,o.ZP)("grad-type-linear").checked="linear"===this.grad.type,(0,o.ZP)("grad-type-radial").checked="radial"===this.grad.type,this.direction.setValue(this.grad.direction)),this.removeHandlers(),this.populateStops(),this.updatePreview(!1)},this.directionChange=()=>{this.grad.direction=this.direction.getValue(),this.updatePreview()},this.typeChange=e=>{let t=e.target;this.grad.type="linear"===t.value?"linear":"radial",(0,o.ZP)("grad-direction").style.display="linear"===this.grad.type?"flex":"none",this.updatePreview()},this.updatePreview=(e=!0)=>{this.preview.style.backgroundImage=this.grad.toCSS(),this.callback&&e&&this.callback(this.grad)},this.populateStops=()=>{this.stoplist.innerHTML="";for(let e=0;e<this.grad.stops.length;++e){const t=Math.round(300*this.grad.stops[e].position);this.stoplist.append((0,o.T)("div",{id:this.grad.stops[e].id,className:"knob",style:"left:"+t+"px"},(0,o.T)("div",{className:"bg ic"}),(0,o.T)("div",{className:"color",id:this.grad.stops[e].id+"-color",style:"background:"+this.grad.stops[e].color.toHEX()})))}this.setHandlers()},this.addStop=e=>{e.stopPropagation(),e.preventDefault();const t=this.grad.addStop(this.colorpod.getColor().clone(),Math.round(e.offsetX)/300),s=Math.round(300*t.position),i=(0,o.T)("div",{id:t.id,className:"knob",style:"left:"+s+"px"},(0,o.T)("div",{className:"bg ic"}),(0,o.T)("div",{className:"color",id:t.id+"-color",style:"background:"+t.color.toHEX()}));i.addEventListener("mousedown",this.mouseDown,!0),i.addEventListener("touchstart",this.touchStart,{passive:!0}),this.stoplist.append(i),this.selectStop(t.id),this.updatePreview()},this.removeStop=()=>{if(this.grad.stops.length>2){(0,o.ZP)(this.selected.id)&&(0,o.ZP)(this.selected.id).remove();const e=this.grad.removeStop(this.selected.id);this.selected=void 0,this.selectStop(e),this.updatePreview()}},this.selectStop=e=>{this.selected&&this.selected.id===e||(this.selected&&(0,o.ZP)(this.selected.id)&&(0,o.ZP)(this.selected.id).classList.remove("selected"),this.selected=this.grad.getStop(e),(0,o.ZP)(this.selected.id).classList.add("selected"),this.colorpod.setColor(this.selected.color),this.opacity.setValue(this.selected.color.a/255),(0,o.ZP)("grad-selector-remove").classList.toggle("disabled",this.grad.stops.length<3))},this.down=(e,t,s)=>{this.selectStop(s.id),this.downX=e,this.target=s,this.start=s.offsetLeft+6},this.move=(e,t,s=!0)=>{let i=a.uZ(this.start+(e-this.downX),0,300);this.target.style.left=i+"px",this.selected.position=i/300,this.grad.sort(),this.updatePreview(s)},this.setHandlers=()=>{const e=document.querySelectorAll("#grad-selector-stoplist > .knob");for(let t=0;t<e.length;t++)e[t].addEventListener("mousedown",this.mouseDown,!0),e[t].addEventListener("touchstart",this.touchStart,{passive:!0}),0===t&&this.selectStop(e[t].id)},this.removeHandlers=()=>{const e=document.querySelectorAll("#grad-selector-stoplist > .knob");for(let t=0;t<e.length;t++)e[t].removeEventListener("mousedown",this.mouseDown,!0),e[t].removeEventListener("touchstart",this.touchStart)},this.touchStart=e=>{e.preventDefault(),e.stopPropagation(),this.down(e.changedTouches[0].clientX,e.changedTouches[0].clientY,e.currentTarget),document.addEventListener("touchmove",this.touchMove,{passive:!0}),document.addEventListener("touchend",this.touchEnd,{passive:!0})},this.touchMove=e=>{e.preventDefault(),e.stopPropagation(),this.move(e.changedTouches[0].clientX,e.changedTouches[0].clientY,!1)},this.touchEnd=e=>{e.preventDefault(),e.stopPropagation(),this.move(e.changedTouches[0].clientX,e.changedTouches[0].clientY,!0),document.removeEventListener("touchmove",this.touchMove),document.removeEventListener("touchend",this.touchEnd)},this.mouseDown=e=>{e.preventDefault(),e.stopPropagation(),this.down(e.clientX,e.clientY,e.currentTarget),document.addEventListener("mousemove",this.mouseMove,!0),document.addEventListener("mouseup",this.mouseUp,!0)},this.mouseMove=e=>{e.stopPropagation(),this.move(e.clientX,e.clientY,!1)},this.mouseUp=e=>{e.stopPropagation(),e.preventDefault(),this.move(e.clientX,e.clientY,!0),document.removeEventListener("mousemove",this.mouseMove,!0),document.removeEventListener("mouseup",this.mouseUp,!0)},this.resizeStart=e=>{this.d=new r.Z(this.container.clientHeight,e.y)},this.resizeMove=e=>{const t=this.d.x+(e.y-this.d.y);this.container.style.height=(t<320?320:t)+"px"},this.cleanUp=()=>{var e;this.removeHandlers(),this.addlist.removeEventListener("click",this.addStop,!0),(0,o.ZP)("grad-selector-remove").removeEventListener("click",this.removeStop,!0),this.container.remove(),null===(e=this.modal)||void 0===e||e.remove()},this.extended=p,this.gradpod=e,this.grad=e?e.grad:u.ZP.fromColors(l.Z.fromHEX(d.ZP.mainColor),l.Z.fromHEX(d.ZP.altColor)),this.callback=s,this.asControl=!e,this.asControl||(this.modal=(0,o.ZP)("workspace").appendChild((0,o.T)("div",{id:"grad-selector-modal",className:"modal"})));let g=(0,o.T)("div",{style:"position:relative"}),m=(0,o.T)("div",{className:"option",style:"display:flex;justify-content: space-between"}),v=(0,o.T)("div",{id:"grad-selector-presets",className:"pad-10"});if(this.container=(0,o.T)("div",{id:"grad-selector"},g,m),t?t.appendChild(this.container):(this.container.classList.add("grad-selector-float"),(0,o.ZP)("workspace").appendChild(this.container)),this.preview=(0,o.T)("div",{id:"grad-selector-preview"}),this.stoplist=(0,o.T)("div",{id:"grad-selector-stoplist"}),this.addlist=(0,o.T)("div",{id:"grad-selector-addlist"}),g.append((0,o.T)("div",{id:"grad-selector-preview-holder"},this.preview),this.stoplist,this.addlist),m.append((0,o.T)("div",{id:"grad-selector-opacity"}),(0,o.T)("label",{className:"tab-30",style:"width:unset"},(0,i.Z)("color")+":"),(0,o.T)("div",{id:"grad-selector-color",className:"tab-5"}),(0,o.T)("ul",{className:"icon-button-set",style:"margin-left:auto"},(0,o.T)("li",{id:"grad-selector-remove"},(0,o.T)("img",{src:"/img/icon/delete.svg",className:"ic"})))),this.container.append((0,o.T)("div",{className:"splitter pad-8"})),p){let e=(0,o.T)("div",{className:"option pad-10",style:"display:flex;justify-content: space-between"});e.innerHTML+=`\n                    <div id="gradient-type" class="switch-field">\n                        <input type="radio" id="grad-type-linear" name="grad-type" value="linear" checked/><label for="grad-type-linear">${(0,i.Z)("linear")}</label>\n                        <input type="radio" id="grad-type-radial" name="grad-type" value="radial" /><label for="grad-type-radial">${(0,i.Z)("radial")}</label>\n                    </div>\n                    <div id="grad-direction"></div>\n                    `,this.container.append(e),(0,o.ZP)("grad-type-linear").addEventListener("click",this.typeChange,!0),(0,o.ZP)("grad-type-radial").addEventListener("click",this.typeChange,!0),this.direction=new n.Z("grad-direction",{label:(0,i.Z)("direction")+":",compact:!0,range:[0,360],defaultValue:0,labelFormat:e=>e.toFixed(1),labelParse:e=>parseInt(e,10),onChange:this.directionChange})}this.container.append(v);const f=(0,o.ZP)("grad-selector-remove");if(f.setAttribute("tooltip",(0,i.Z)("removeStop")),f.setAttribute("flow","down"),f.addEventListener("click",this.removeStop,!0),this.asControl)(0,o.ZP)("grad-selector-presets").style.height="180px";else{let e=this.gradpod.container.getBoundingClientRect();this.modal.addEventListener("click",(e=>{e.stopPropagation(),e.preventDefault(),e.target===e.currentTarget&&this.cleanUp()}),!1),this.container.style.top=e.bottom+5+"px",this.container.style.left=e.left-~~(this.container.offsetWidth/2)+40+"px",this.container.style.display="flex",this.container.style.height="360px";const t=(0,o.T)("img",{src:"/img/icon/three-dot.svg",className:"resize ic"});(0,o.Rg)(t,this.resizeStart,this.resizeMove),this.container.append(t)}this.preview=(0,o.ZP)("grad-selector-preview"),this.opacity=new n.Z("grad-selector-opacity",{label:(0,i.Z)("opacity")+":",compact:!0,defaultValue:1,labelFormat:e=>(100*e).toFixed(0)+"%",labelParse:e=>parseInt(e,10)/100,onChange:e=>{this.selected.color.a=Math.round(255*e),this.updatePreview()}}),this.colorpod=new h.Z("grad-selector-color",new l.Z,(e=>{e.a=this.selected.color.a,this.selected.color=e,(0,o.ZP)(this.selected.id+"-color").style.background=e.toHEX(),this.updatePreview()})),this.addlist.addEventListener("click",this.addStop,!1),this.populateStops(),this.setHandlers(),this.updatePreview(!1),new c.Z((0,o.ZP)("grad-selector-presets")),this.populatePresets()}}},276:(e,t,s)=>{s.d(t,{Z:()=>u});var i=s(6548),a=s(3655),n=s(4188),o=s(3947),r=s(8776),h=s(4178),l=s(9067),c=s(5574),d=s(5181);class u{constructor(e,t){this.populatePresets=async()=>{const e=await fetch("/pattern/index.json"),t=await e.json(),s=(0,o.ZP)("pattern-selector-presets-ss-content"),i=(0,o.T)("div",{className:"pattern-pod empty"});i.setAttribute("data","empty"),i.addEventListener("click",this.selectPreset,!0),s.append(i),t.packs.forEach((e=>{e.assets.forEach((t=>{const i="/pattern/"+e.name+"/"+t,a=(0,o.T)("div",{className:"pattern-pod"});a.setAttribute("data",i),a.addEventListener("click",this.selectPreset,!0),a.style.backgroundImage="url("+i+")",s.append(a)}))}))},this.populatePack=()=>{},this.selectPreset=async e=>{this.marked&&this.marked.classList.remove("selected"),this.marked=e.currentTarget,this.marked.classList.add("selected");let t=this.marked.getAttribute("data");if("empty"===t)this.pattern=void 0;else{if(!this.pattern){let e=this.scale.getValue();this.pattern=new l.Z(void 0,e<0?1+e/12.5:1+e,this.direction.getValue())}this.pattern.svg=await fetch(t+"?ref").then((e=>e.text()));let e=new Blob([this.pattern.svg],{type:"image/svg+xml"});this.pattern.image=await(0,c.s4)(e),this.extractColors()}this.updatePreview()},this.changeColor=e=>{this.colorPod=e.currentTarget,new d.Z(r.Z.fromHEX(this.colorPod.title),this.setColor)},this.extractColors=()=>{let e=[];this.pattern.svg.replace(/fill:?=?"?(#[abcdef0-9]{3,8})/gi,(function(t,s){return e.push(s),t})),this.pattern.svg.replace(/stroke:?=?"?(#[abcdef0-9]{3,8})/gi,(function(t,s){return e.push(s),t}));e=e.filter(((e,t,s)=>s.indexOf(e)===t)).slice(0,10);let t=(0,o.ZP)("pattern-color-list");t.innerHTML="",e.forEach((e=>{t.appendChild((0,o.T)("div",{onclick:this.changeColor,className:"color-pod small",title:e,style:"border:none;border-radius:3px;display:inline-block;margin:5px 5px 5px 0px;background-color:"+e}))}))},this.setColor=async e=>{let t=this.colorPod.title,s=e.toHEX();this.colorPod.title=s,this.colorPod.style.backgroundColor=s;var i=new RegExp(t,"g");this.pattern.svg=this.pattern.svg.replace(i,s);let a=new Blob([this.pattern.svg],{type:"image/svg+xml"});this.pattern.image=await(0,c.s4)(a),this.updatePreview()},this.setPattern=e=>{this.pattern=e;let t=this.pattern.scale;this.scale.setValue(t<1?-12.5*(1-t):t-1),this.direction.setValue(this.pattern.direction),this.extractColors(),this.updatePreview()},this.scaleChange=e=>{this.pattern&&(e=e<0?1+e/12.5:1+e,this.pattern.scale=e,this.updatePreview(!1))},this.directionChange=e=>{this.pattern&&(this.pattern.direction=e,this.updatePreview(!1))},this.updatePreview=(e=!0)=>{this.pattern?(this.ctx.save(),this.ctx.fillStyle=this.pattern.createCanvasPattern(this.ctx),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.restore()):this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.callback&&e&&this.callback(this.pattern)},this.callback=t,this.canvas=a.vL(300,120),this.canvas.classList.add("transparent"),this.canvas.style.borderRadius="2px",this.ctx=this.canvas.getContext("2d");let s=(0,o.T)("div",{className:"option",style:"display:flex;"},(0,o.T)("div",{id:"pattern-scale"}),(0,o.T)("div",{id:"pattern-direction",className:"tab-20"})),u=(0,o.T)("div",{id:"pattern-color-list",style:"display:block;"}),p=(0,o.T)("div",{id:"pattern-selector-top"},this.canvas,u,s),g=(0,o.T)("div",{id:"pattern-selector-presets",className:"pad-10"});this.container=(0,o.T)("div",{id:"pattern-selector"},p,(0,o.T)("div",{className:"splitter pad-8"}),g),e.appendChild(this.container),new h.Z((0,o.ZP)("pattern-selector-presets")),this.scale=new n.Z("pattern-scale",{label:(0,i.Z)("scale")+":",compact:!0,range:[-10,10],defaultValue:0,labelFormat:e=>e.toFixed(1),labelParse:e=>parseInt(e,10),onChange:this.scaleChange,onEnd:()=>this.updatePreview()}),this.direction=new n.Z("pattern-direction",{label:(0,i.Z)("direction")+":",compact:!0,range:[0,360],defaultValue:0,labelFormat:e=>e.toFixed(1),labelParse:e=>parseInt(e,10),onChange:this.directionChange,onEnd:()=>this.updatePreview()}),this.populatePresets()}}},4178:(e,t,s)=>{s.d(t,{Z:()=>a});var i=s(3947);class a{constructor(e){for(this.scrollTop=()=>{this.content.scrollTo(0,0)},this.moveBar=e=>{let t=this.content.scrollHeight,s=this.content.clientHeight;if(this.scrollRatio=s/t,this.scrollRatio>=1)this.bar.classList.add("ss-hidden");else{this.bar.classList.remove("ss-hidden");const e=Math.max(this.scrollRatio*s,20),i=this.content.scrollTop/(t-s)*(s-e);this.bar.style.cssText="height:"+e+"px; top:"+i+"px"}},e.classList.add("ss-wrapper"),this.content=(0,i.T)("div",{id:e.id+"-ss-content",className:"ss-content"});e.firstChild;)this.content.appendChild(e.firstChild);e.appendChild(this.content),this.bar=(0,i.T)("div",{className:"ss-scroll"}),e.append(this.bar);let t=e=>{e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();var t=e.pageY-this.lastPageY;this.lastPageY=e.pageY,this.content.scrollTop+=t/this.scrollRatio},s=e=>{e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),document.removeEventListener("mousemove",t,!0),document.removeEventListener("mouseup",s,!0)};this.bar.addEventListener("mousedown",(e=>{e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),this.lastPageY=e.pageY,document.addEventListener("mousemove",t,!0),document.addEventListener("mouseup",s,!0)}),!0),this.moveBar(null),window.addEventListener("resize",this.moveBar),this.content.addEventListener("click",this.moveBar),this.content.addEventListener("scroll",this.moveBar),this.content.addEventListener("mouseenter",this.moveBar)}}},8976:(e,t,s)=>{s.d(t,{Z:()=>r});var i=s(3655),a=s(4170),n=s(4256),o=s(6548);class r{constructor(e,t){this.apply=()=>{setTimeout((()=>{const e=this.selected.trim?this.selected.trim.clone():this.selected.rect.clone(),t=i.dN(this.selected.canvas);if(this.selected.type!==a.Z.TYPE_FRAME&&this.stage.fresco.hasSelection()){let e=i.vL(t.width,t.height),a=e.getContext("2d");a.drawImage(this.shaders.apply(this.selected.canvas),0,0),a.globalCompositeOperation="destination-in",a.drawImage(this.stage.fresco.selection.mask,-this.selected.rect.x,-this.selected.rect.y);var s=this.selected.canvas.getContext("2d");s.drawImage(e,0,0),s=void 0,a=void 0,e=void 0}else this.selected.replaceCanvas(this.shaders.apply(this.selected.canvas));this.selected.render(),this.stage.history.add({type:"bitmapSwitch",kind:this.kind,layer:this.selected,rect:e,canvas:t}),document.dispatchEvent(new CustomEvent("notification",{detail:(0,o.Z)(this.kind)})),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-select"))}))},this.kind=t,this.stage=e,this.shaders=new n.Z,this.selected=this.stage.fresco.getSelected()}}},8495:(e,t,s)=>{s.d(t,{Z:()=>n});var i=s(3947),a=s(1671);class n{constructor(e,t,s){this.path="M 0,0 H 100 V 100 H 0 Z",this.previewPath=e=>{this.setPath(e),this.preview&&this.preview(this.path)},this.callbackPath=e=>{this.setPath(e),this.callback&&this.callback(this.path)},this.setPath=e=>{this.path=e;let t=this.thumbnail.getContext("2d");t.clearRect(0,0,t.canvas.width,t.canvas.height);const s=new Path2D;s.addPath(new Path2D(this.path),(new DOMMatrix).scale((t.canvas.width-2)/100,(t.canvas.height-2)/100)),t.save(),t.lineWidth=1,t.translate(1,1),t.strokeStyle="rgba(255, 255, 255, 0.4)",t.fillStyle="rgba(0, 0, 0, 0.3)",t.fill(s),t.stroke(s),t.restore()},this.getPath=()=>this.path,this.toggle=()=>{new a.Z(this.container,this.path,this.callbackPath,this.previewPath)},this.cleanUp=()=>{this.container.setAttribute("data",this.path),this.container.removeEventListener("click",this.toggle,!1)},this.preview=s,this.callback=t,this.container=(0,i.ZP)(e),this.container.hasChildNodes()?(this.thumbnail=(0,i.ZP)(e+"-canvas"),this.container.hasAttribute("data")&&(this.path=this.container.getAttribute("data"))):(this.container.classList.add("shape-pod"),this.thumbnail=(0,i.T)("canvas",{id:e+"-canvas",width:30,height:30}),this.container.append(this.thumbnail)),this.container.addEventListener("click",this.toggle,!1),this.setPath(this.path)}}},1671:(e,t,s)=>{s.d(t,{Z:()=>h});var i=s(3655),a=s(3947),n=s(4178),o=s(4820),r=s(3673);class h{constructor(e,t,s,h){this.resizeStart=e=>{this.d=new r.Z(this.container.clientHeight,e.y)},this.resizeMove=e=>{const t=this.d.x+(e.y-this.d.y);this.container.style.height=(t<200?200:t)+"px"},this.populatePresets=()=>{const e=(0,a.ZP)("shape-selector-presets-ss-content");e.style.paddingTop="6px",["M 0,0 H 100 V 100 H 0 Z","m3 0h94c1.66 0 3 1.34 3 3v94c0 1.66-1.34 3-3 3h-94c-1.66 0-3-1.34-3-3v-94c0-1.66 1.34-3 3-3z","m 6,0 h 88 c 3.324,0 6,2.676 6,6 v 88 c 0,3.324 -2.676,6 -6,6 H 6 C 2.676,100 0,97.324 0,94 V 6 C 0,2.676 2.676,0 6,0 Z","m 10,0 h 80 c 5.54,0 10,4.46 10,10 v 80 c 0,5.54 -4.46,10 -10,10 H 10 C 4.46,100 0,95.54 0,90 V 10 C 0,4.46 4.46,0 10,0 Z","m 20,0 h 60 c 11.08,0 20,8.92 20,20 v 60 c 0,11.08 -8.92,20 -20,20 H 20 C 8.92,100 0,91.08 0,80 V 20 C 0,8.92 8.92,0 20,0 Z","M 0,50 C 0,0 0,0 50,0 c 50,0 50,0 50,50 0,50 0,50 -50,50 C 0,100 0,100 0,50","m80 0c11.1 0 20 8.92 20 20v80h-80c-11.1 0-20-8.92-20-20v-80h80z","m80 100c11.1 0 20-8.92 20-20v-80h-80c-11.1 0-20 8.92-20 20v80h80z","m 100,50.000001 c 0,0 -3.52,6.8 -3.52,22.281 0,15.078 -5.18,18.578 -5.446,18.75 -0.144,0.228 -3.604,5.451 -18.753,5.451 C 56.8,96.482001 50,100 50,100 c 0,0 -6.801,-3.517999 -22.282,-3.517999 -15.131,0 -18.603,-5.217 -18.752,-5.45 -0.256,-0.164 -5.448,-3.65 -5.448,-18.751 C 3.518,56.8 0,50 0,50 0,50 3.518,43.200001 3.518,27.718001 3.518,12.594 8.729,9.118 8.968,8.966 8.971,8.961 8.975,8.955 8.982,8.945 9.293,8.48 12.96,3.518 27.719,3.518 43.199,3.518 50,0 50,0 c 0,0 6.828,3.518 22.309,3.518 14.756,0 18.425,4.962 18.736,5.427 v 0 0 c 0,0 5.435,3.892001 5.435,18.773 0,15.483 3.52,22.282 3.52,22.282001 z","m 11.538461,11.538461 c 15.384615,-15.3846148 61.538462,-15.3846148 76.923076,0 15.384613,15.384615 15.384613,61.538464 0,76.923079 -15.384614,15.38461 -61.538461,15.38461 -76.923076,0 -15.3846147,-15.384615 -15.3846147,-61.538464 0,-76.923079","M 0,50 C 0,14.5 14.500003,0 50,0 85.5,0 100,14.5 100,50 100,85.5 85.5,100 50,100 14.500003,100 0,85.5 0,50","m100 50a50 50 0 0 1-50 50 50 50 0 0 1-50-50 50 50 0 0 1 50-50 50 50 0 0 1 50 50z","m7.58 76.5 8.5-5.3c1.6 2.5 3.4 4.9 5.6 7.1 2.2 2.2 4.6 4.1 7.1 5.6l-5.3 8.5c16.2 10.1 36.8 10.1 53 0l-5.3-8.5c2.5-1.6 4.9-3.4 7.1-5.6 2.2-2.2 4.1-4.6 5.6-7.1l8.5 5.3c10.1-16.2 10.1-36.8 0-53l-8.5 5.3c-1.6-2.5-3.4-4.9-5.6-7.1-2.2-2.2-4.6-4.1-7.1-5.6l5.3-8.5c-16.2-10.1-36.8-10.1-53 0l5.3 8.5c-2.5 1.6-4.9 3.4-7.1 5.6-2.2 2.2-4.1 4.6-5.6 7.1l-8.5-5.3c-10.1 16.2-10.1 36.8 0 53z","m 80.100004,19.9 c -6.2,-6.2 -13.8,-9.9999998 -21.7,-11.5999998 L 50.000004,0 l -8.3,8.3000002 c -8,1.6 -15.6,5.4999998 -21.7,11.5999998 -6.1,6.1 -10.1,13.8 -11.7,21.8 L 0,50 8.300004,58.3 c 1.6,8 5.5,15.6 11.6,21.7 6.2,6.2 13.8,10 21.7,11.6 l 8.4,8.4 8.3,-8.3 c 8,-1.6 15.6,-5.5 21.7,-11.6 6.2,-6.2 10,-13.8 11.6,-21.7 L 100,50 91.700004,41.7 c -1.6,-8 -5.5,-15.6 -11.6,-21.8 z","M 31.278462,0.01959957 C 23.186769,-0.27097901 15.000275,2.6696037 8.8346993,8.8330525 -2.1173026,19.781307 -2.8922296,37.108219 6.5404597,48.953281 c 0.2422598,0.315753 0.3671413,0.681873 0.3705912,1.047372 -0.00343,0.3655 -0.1283314,0.73162 -0.3705912,1.047373 -9.4326893,11.845059 -8.6577623,29.171972 2.2942396,40.120231 10.9610277,10.957253 28.3079167,11.724463 40.1575537,2.269882 0.309131,-0.23713 0.666341,-0.332857 1.024148,-0.330053 0.366744,0.0034 0.734111,0.110187 1.051116,0.353625 11.847133,9.426729 29.131837,8.654389 40.083427,-2.293454 10.943446,-10.939723 11.751726,-28.273568 2.341393,-40.120231 -0.242377,-0.315753 -0.367656,-0.681856 -0.370591,-1.047373 0.0034,-0.365516 0.12816,-0.731619 0.370591,-1.047372 C 102.90267,37.106616 102.09439,19.772771 91.150944,8.8330525 80.199354,-2.1147875 62.91465,-2.8871348 51.067517,6.5395994 50.750512,6.7830358 50.383145,6.8897696 50.016401,6.8932183 49.658594,6.8966464 49.301384,6.8002786 48.992253,6.5631705 43.808027,2.4268049 37.571993,0.24560339 31.278462,0.01959957 Z","m87.074 36.937h-5.1102l3.6072-3.6036c5.1102-5.1051 5.1102-13.413 0-18.619-5.1102-5.2052-13.427-5.1051-18.637 0l-3.6072 3.6036v-5.1051c-0.1002-7.3073-5.9118-13.213-13.226-13.213s-13.126 5.9059-13.126 13.113v5.1051l-3.6072-3.6036c-5.1102-5.1051-13.427-5.1051-18.637 0-5.2104 5.1051-5.1102 13.413 0 18.619l3.6072 3.6036h-5.1102c-7.3146 0.1001-13.226 5.9059-13.226 13.213s5.9118 13.113 13.126 13.113h5.1102l-3.6072 3.6036c-5.1102 5.1051-5.1102 13.413 0 18.619 5.1102 5.1051 13.427 5.1051 18.637 0l3.6072-3.6036v5.1051c0 7.3073 5.9118 13.113 13.126 13.113 7.2144 0 13.126-5.9059 13.126-13.113v-5.1051l3.6072 3.6036c5.1102 5.1051 13.427 5.1051 18.637 0 5.1102-5.1051 5.1102-13.413 0-18.619l-3.6072-3.6036h5.1102c7.3146 0 13.126-5.9059 13.126-13.113s-5.7114-13.113-12.926-13.113z","m86.987 36.903h-0.4004c-1.7017 0-2.6026-2.1009-1.4014-3.3014 4.9049-4.9021 5.5055-12.806 1.1011-18.008-5.005-6.0026-14.014-6.3027-19.419-0.90039l-0.3003 0.30013c-1.2012 1.2005-3.3033 0.40017-3.3033-1.4006v-0.10004c0-6.8029-4.9049-12.706-11.712-13.406-7.9079-0.90039-14.615 5.3023-14.615 13.106v0.40017c0 1.7007-2.1021 2.6011-3.3033 1.4006-4.9049-4.9021-12.813-5.5024-18.018-1.1005-6.006 5.0022-6.3063 14.006-0.9009 19.408l0.3003 0.30013c1.2012 1.2005 0.4004 3.3014-1.4014 3.3014h-0.4004c-7.3073 0-13.213 5.8025-13.213 13.106s5.9059 13.106 13.113 13.106h0.4004c1.7017 0 2.6026 2.1009 1.4014 3.3014l-0.3003 0.30013c-5.4054 5.4023-5.1051 14.306 0.9009 19.408 5.3053 4.4019 13.213 3.8016 18.018-1.1005 1.2012-1.2005 3.3033-0.40017 3.3033 1.4006v0.40017c0 7.7033 6.7067 13.906 14.615 13.106 6.7067-0.7003 11.712-6.7029 11.712-13.406v-0.10004c0-1.7007 2.1021-2.6011 3.3033-1.4006l0.3003 0.30013c5.4054 5.4023 14.314 5.1022 19.419-0.90039 4.4044-5.3023 3.8038-13.206-1.1011-18.008-1.2012-1.2005-0.4004-3.3014 1.4014-3.3014h0.4004c7.3073 0 13.113-5.9026 13.113-13.106 0-7.2031-5.8058-13.106-13.013-13.106z","m 50.094148,0 c -2.77536,0 -5.553405,0.64778966 -8.038073,1.9436751 -4.969341,2.5917545 -8.12526,7.3889096 -8.12526,12.5724349 v 7.453361 c 0,0.578822 -0.337936,1.109289 -0.889248,1.398692 -0.551335,0.289419 -1.220173,0.289419 -1.771503,0 L 24.103777,19.55012 C 19.134436,16.958365 13.003954,16.956091 8.034594,19.546895 3.0652529,22.138666 0,26.935805 0,32.11933 c 0,5.183526 3.0652529,9.980681 8.034594,12.572435 l 7.372024,3.909398 c 0.551335,0.289402 0.889252,0.819867 0.889252,1.398693 0,0.578822 -0.34142,1.109269 -0.892736,1.398689 L 8.017166,55.27643 C 3.047806,57.868183 0,62.696853 0,67.88038 c 0,5.183523 3.0687318,9.980663 8.0380919,12.572433 4.9693411,2.591774 11.0963441,2.591757 16.0656851,0 l 7.270897,-3.821188 c 0.551331,-0.28942 1.223686,-0.28942 1.775002,0 0.551349,0.289402 0.781158,0.816711 0.781139,1.395533 v 7.4566 c 0,5.183527 3.159398,9.98068 8.128739,12.572437 2.464461,1.285337 5.187223,1.933208 7.940444,1.943659 2.798399,0.01131 5.627343,-0.637226 8.132242,-1.943659 4.969341,-2.591757 8.031091,-7.38891 8.031091,-12.572437 L 66.069191,78.0304 c -0.0071,-0.578792 0.233307,-1.109291 0.784623,-1.398693 0.55133,-0.28942 1.220187,-0.28942 1.771518,0 l 7.270897,3.814881 c 4.969341,2.59177 11.099823,2.59177 16.069183,0 C 96.934748,77.854835 100,73.057677 100,67.874155 c 0,-5.183527 -3.065252,-9.97752 -8.034593,-12.56929 l -7.372024,-3.909398 c -0.551335,-0.289403 -0.889252,-0.816712 -0.889252,-1.395533 0,-0.578822 0.34142,-1.109274 0.892736,-1.398689 L 91.986314,44.72336 C 96.955712,42.131607 100,37.302935 100,32.11941 c 0,-5.183526 -3.065252,-9.980665 -8.034593,-12.572436 -4.96936,-2.59177 -11.099842,-2.589496 -16.069183,0.0032 l -7.166287,3.818043 c -0.55133,0.289419 -1.220168,0.289419 -1.771504,0 -0.553971,-0.290258 -0.889247,-0.819951 -0.889247,-1.398772 v -7.45336 c 0,-5.1835253 -2.971084,-9.9806804 -7.940444,-12.5724349 C 55.644069,0.64778966 52.869527,0 50.094148,0 Z","m91.1 35c-5.89-2.87-9.49-9.71-8.79-16.8 1.4-14.2-13.1-23.5-23.5-15-5.2 4.19-12.3 4.19-17.6 0-10.4-8.39-25 0.883-23.6 15 0.699 7.06-2.9 13.9-8.79 16.8-11.8 5.74-11.8 24.3 0.0999 30 5.89 2.87 9.49 9.71 8.79 16.8-1.4 14.1 13.1 23.4 23.6 15 5.2-4.19 12.3-4.19 17.6 0 10.4 8.39 25-0.883 23.6-15-0.699-7.06 2.9-13.9 8.79-16.8 11.7-5.74 11.7-24.3-0.2-30z","m3.17 48.6 11.9 12.1c2.5 2.5 3.6 6.04 3 9.57l-2.8 17.1c-1.5 8.85 7.5 15.6 15.1 11.4l14.8-8.12c3-1.67 6.7-1.67 9.7 0l14.8 8.12c7.6 4.16 16.6-2.6 15.1-11.4l-2.8-17.1c-0.6-3.54 0.5-7.08 3-9.57l11.9-12.1c6.2-6.24 2.8-17.2-5.8-18.5l-16.5-2.5c-3.4-0.52-6.3-2.71-7.8-5.93l-7.4-15.6c-3.9-8.01-14.9-8.01-18.7 0l-7.4 15.6c-1.5 3.23-4.4 5.41-7.8 5.93l-16.6 2.5c-8.5 1.25-11.9 12.2-5.7 18.5z","m32 0v32h-32v36h32v32h36v-32h32v-36h-32v-32h-36z","m34 0v34h-34v32h34v34h32v-34h34v-32h-34v-34h-32z","m36 0v36h-36v28h36v36h28v-36h36v-28h-36v-36h-28z","m38 0v38h-38v24h38v38h24v-38h38v-24h-38v-38h-24z","m100 99.9-50-35.8-49.9 35.9 35.8-50-35.9-49.9 50 35.8 49.9-35.9-35.8 50z","m100 100-50-28.8-50 28.8 28.8-50-28.8-50 50 28.8 50-28.8-28.8 50z","M 49.999984,0 C 45.722878,0 41.617373,1.6978034 38.592988,4.7221408 35.56864,7.7464783 33.8708,11.851959 33.8708,16.129017 v 10.817782 c 0,0.536631 -0.264632,1.034533 -0.708796,1.335693 C 32.71784,28.583556 32.157866,28.64491 31.659343,28.4463 28.200473,27.227976 25.094977,26.165382 21.110455,24.796091 16.086103,23.159917 10.543614,24.078997 6.3094312,27.327976 1.7398721,30.834282 -0.61368155,36.514793 0.13813101,42.225271 0.88981729,47.934817 4.6342391,52.819843 9.9542542,55.02452 l 12.8340388,4.624495 c 0.454071,0.188081 0.796007,0.570582 0.932461,1.042725 0.136616,0.47213 0.05049,0.975225 -0.233116,1.376628 l -9.469586,11.983363 c -0.0016,0.0032 -0.0032,0.0064 -0.0064,0.0097 l -0.01292,0.01612 c -3.490018,4.566738 -4.2856042,10.656816 -2.085454,15.968359 2.204181,5.32135 7.082548,9.064235 12.793085,9.816024 5.700862,0.750526 11.377026,-1.594919 14.884848,-6.149189 0.0013,-0.0016 0.0016,-0.0048 0.0032,-0.0064 l 0.01612,-0.01612 9.110474,-11.532877 C 49.02707,81.758415 49.49722,81.527221 50,81.527253 c 0.50278,-3.2e-5 0.972926,0.231162 1.278995,0.630033 l 9.110471,11.532877 0.01612,0.01612 c 0.0016,0.0016 0.0016,0.0048 0.0032,0.0064 3.507825,4.55427 9.18399,6.899717 14.884849,6.149189 5.710536,-0.751789 10.588906,-4.494674 12.793088,-9.816024 2.20015,-5.311543 1.40456,-11.401621 -2.085454,-15.968359 l -0.01292,-0.01612 c -0.0032,-0.0032 -0.0048,-0.0064 -0.0064,-0.0097 L 76.51236,62.068368 c -0.283599,-0.401403 -0.369729,-0.904498 -0.233117,-1.376628 0.136454,-0.472143 0.478394,-0.854644 0.932462,-1.042725 L 90.045743,55.02452 c 5.320019,-2.204677 9.06444,-7.089703 9.816127,-12.799249 0.75181,-5.710478 -1.601741,-11.390989 -6.171301,-14.897295 -4.191331,-3.216093 -9.664607,-4.149222 -14.648313,-2.580787 -3.387709,1.174531 -7.124923,2.472013 -10.701602,3.699111 -0.498519,0.19861 -1.058493,0.137256 -1.502657,-0.163808 -0.4442,-0.30116 -0.708832,-0.799062 -0.708832,-1.335693 V 16.129017 c 0,-4.277058 -1.697837,-8.3825387 -4.722188,-11.4068762 C 58.382588,1.6978034 54.277082,0 49.999977,0 Z","m 95.097846,4.9018824 c -6.5362,-6.5358435 -17.184353,-6.5358426 -23.720548,-1.2e-6 L 50.028804,26.249213 c -0.425617,0.425594 -1.040135,0.586638 -1.621513,0.430837 L 21.08856,19.627522 c -5.785619,-1.55016 -11.9599597,0.09643 -16.1897377,4.310702 -2.1146391,2.107408 -3.5852443,4.695818 -4.33177648,7.481767 -0.74652914,2.785944 -0.76864986,5.766964 0.009252,8.649189 0.75867638,2.810944 2.22358978,5.323667 4.19641438,7.340366 2.0728318,2.11897 4.7064751,3.690254 7.6708358,4.484488 l 28.056935,6.416262 c 0.28639,0.0767 0.547033,0.231845 0.750533,0.435477 0.209661,0.209842 0.356755,0.473669 0.435495,0.769013 l 6.418482,28.038807 c 0.78666,2.935694 2.306363,5.484426 4.3105,7.49614 4.090458,4.10683 10.194583,5.980987 16.162376,4.38201 2.921791,-0.782839 5.455367,-2.303208 7.455498,-4.308661 4.086164,-4.097795 5.946157,-10.219785 4.339911,-16.214049 l -7.0571,-27.321448 c -0.155477,-0.581682 0.0075,-1.193522 0.433183,-1.619113 L 95.097852,28.621141 c 6.536198,-6.535842 6.536198,-17.183416 3e-6,-23.7192562 z","m 66.400001,0 -16.4,16.4 L 33.600001,0 0,33.6 16.400001,50 0,66.4 33.600001,100 l 16.4,-16.4 16.4,16.4 L 100,66.4 83.600001,50 100,33.6 Z","m 19.630485,54.1 -7.3903,7.8 v 0 L 0,75 30.715935,70.7 c 3.464203,-0.5 6.928406,1.2 8.083141,4.1 l 2.309469,5.2 1.847575,4.2 v 0 l 6.928406,15.8 6.928406,-15.8 v 0 l 1.847576,-4.2 2.309468,-5.2 c 1.270208,-2.9 4.618938,-4.6 8.083141,-4.1 L 99.999999,75 87.644341,61.9 v 0 l -7.3903,-7.8 c -2.193996,-2.4 -2.193996,-5.8 0,-8.1 l 5.889145,-6.3 1.385682,-1.5 v 0 L 99.999999,25 80.715935,27.7 v 0 L 69.168591,29.3 C 65.704387,29.8 62.240184,28.1 61.08545,25.2 L 58.775981,20 56.928406,15.8 v 0 L 50,0 43.071593,15.8 v 0 l -1.847575,4.2 -2.309469,5.2 c -1.270208,2.9 -4.618937,4.6 -8.083141,4.1 L 19.284064,27.7 v 0 L 0,25 12.355658,38.1 v 0 l 1.385681,1.5 5.889146,6.3 c 2.309469,2.4 2.309469,5.8 0,8.2 z","M 50,0 30.1,30.1 0,50 30.1,69.9 50,100.00001 69.9,69.9 100,50 69.9,30.1 Z","m73 64.6c-8.69 12.7-19.4 23.3-29.9 29.5-10.4 6.23-19.7 7.55-25.8 3.68-6.09-3.87-8.48-12.6-6.64-24.3 1.84-11.7 7.75-25.4 16.4-38.1 8.69-12.7 19.4-23.3 29.9-29.5 10.4-6.23 19.7-7.55 25.8-3.68 12.7 8.07 8.3 36-9.79 62.4z","M 33.606558,75.300005 50,100 66.393446,75.300005 H 100 L 83.255273,50 100,24.7 H 66.393446 L 50.000001,0 33.606558,24.7 H 0 L 16.744731,50 0,75.300005 Z","M 85.4,14.6 62.7,19.3 50,0 37.3,19.3 14.6,14.6 19.3,37.3 0,50 19.3,62.7 14.6,85.4 37.3,80.7 50,100 62.7,80.7 85.4,85.4 80.7,62.7 99.999999,50 80.7,37.3 Z","M 93.3,25 78.3,21.7 75,6.7 60.4,11.4 50,0 39.6,11.4 25,6.7 21.7,21.7 6.7,25 11.4,39.6 0,50 11.4,60.4 6.7,75 21.7,78.3 25,93.3 39.6,88.6 50,99.999997 60.4,88.6 75,93.3 78.3,78.3 93.3,75 88.6,60.4 100,50 88.6,39.6 Z","m 93.300004,25 -21.8,3.5 3.5,-21.8 -17.1,13.9 -7.9,-20.6 -7.9,20.6 L 25,6.7 28.5,28.5 6.7,25 20.6,42.1 0,50 20.6,57.9 6.7,75 28.5,71.5 25,93.3 42.100004,79.4 l 7.9,20.6 7.9,-20.6 17.1,13.9 -3.5,-21.8 21.8,3.5 -13.9,-17.1 L 100,50 79.400004,42.1 Z","m97.5 66.2-8.94 2.39 3.67 8.47-9.25 0.188 1.53 9.1-9.03-2.02-0.701 9.2-8.28-4.12-2.89 8.76-7.05-5.97-4.91 7.82-5.41-7.48-6.64 6.42-3.46-8.56-7.99 4.65-1.3-9.13-8.88 2.6 0.927-9.18-9.24 0.419 3.1-8.69-9.08-1.8 5.1-7.7-8.38-3.91 6.8-6.26-7.2-5.79 8.1-4.45-5.6-7.35 8.94-2.39-3.67-8.47 9.25-0.189-1.53-9.1 9.03 2.02 0.7-9.2 8.28 4.12 2.89-8.76 7.05 5.97 4.91-7.82 5.41 7.48 6.64-6.42 3.46 8.56 7.99-4.65 1.3 9.13 8.88-2.61-0.926 9.18 9.24-0.418-3.1 8.69 9.08 1.8-5.1 7.69 8.38 3.91-6.8 6.26 7.2 5.79-8.1 4.45z","m 0,43.5 v 0 C 0,67.5 22.413793,87 50.000001,87 v 13 C 77.586208,100 100,80.5 100,56.5 v 0 C 100,32.5 77.586208,13 50.000001,13 V 0 C 22.413793,0 0,19.5 0,43.5 Z","M 89.108383,36.593295 C 84.406622,31.890944 78.804523,28.789393 72.902312,27.088543 L 89.108383,10.88044 c -14.505434,-14.5072533 -38.01424,-14.5072533 -52.619712,0 v 0 c -4.701762,4.702351 -7.702886,10.305152 -9.403523,16.208103 L 10.879076,10.88044 c -14.5054345,14.507253 -14.5054345,38.019007 0,52.62631 v 0 c 4.701762,4.702351 10.30386,7.803902 16.206072,9.504752 L 10.879076,89.119555 c 14.505435,14.507255 38.014242,14.507255 52.619712,0 v 0 C 68.20055,84.417204 71.301712,78.814403 73.002349,72.911452 L 89.208421,89.119555 C 103.61382,74.612302 103.61382,51.100548 89.108383,36.593295 Z","m 86.783481,22.786394 c -1.602002,-1.6008 -3.30413,-3.101551 -5.106383,-4.402201 l 5.106383,-5.102552 c -17.722153,-17.7088548 -46.357948,-17.7088548 -63.979976,0 v 0 c -1.602002,1.600801 -3.10388,3.301651 -4.405507,5.102552 l -5.106383,-5.102552 c -17.7221533,17.708856 -17.7221533,46.323164 0,63.93197 v 0 c 1.602003,1.6008 3.30413,3.101551 5.106383,4.402201 l -5.106383,5.102552 c 17.722153,17.708856 46.357949,17.708856 63.979976,0 1.602003,-1.600801 3.10388,-3.301651 4.405507,-5.102552 l 5.106383,5.102552 c 17.622029,-17.608806 17.622029,-46.223114 0,-63.93197 z","m 80.419581,19.480519 4.895104,-4.895104 C 75.724276,5.0949053 61.838162,2.4975027 49.95005,6.8931071 V 0 C 36.463537,0 24.775225,7.9920082 19.480519,19.480519 L 14.585415,14.585415 C 5.0949051,24.175824 2.4975025,38.061938 6.8931069,49.95005 H 0 c 0,13.486513 7.992008,25.174825 19.480519,30.469531 l -4.895104,4.895104 c 9.590409,9.59041 23.376623,12.087912 35.364635,7.792208 V 100 c 13.486513,0 25.174825,-7.992008 30.469531,-19.480519 l 4.895104,4.895105 C 94.905099,75.824176 97.402601,62.037962 93.106897,50.04995 H 100 C 99.9001,36.463537 91.908096,24.775225 80.419581,19.480519 Z","m 50,83.6 16.4,16.4 H 100 V 66.4 L 83.600005,50 100.00001,33.6 V 0 H 66.400005 l -16.4,16.4 -16.4,-16.4 H 0 V 33.6 L 16.4,50 0,66.4 V 100 h 33.600005 z","m 84.915847,65.690376 c -23.436956,26.022959 -34.915933,34.30962 -34.915933,34.30962 0,0 -11.478977,-8.289949 -34.915929,-34.30962 C -8.3509667,39.671797 -2.4009791,6.9318151 18.693978,1.0456555 39.788935,-4.840504 49.999914,16.043854 49.999914,16.043854 c 0,0 10.210979,-20.884358 31.306936,-14.9981985 21.09296,5.8861596 27.04495,38.6261415 3.608997,64.6447205 z","M 100,61.688 C 100,82.848 77.615954,99.999996 50.000003,99.999996 22.385351,99.999996 0,82.848 0,61.687 0,40.526 50.000003,0 50.000003,0 50.000003,0 100,40.526 100,61.688 Z","m 100,25.001 v 50 L 50,100 0,75 V 25 L 50,0 Z","M 100,0 50,10.2 1e-5,0 10.2,50 0,100 50,90 100,100 90,50 Z","m0 100 50-100 50 100z","m0 100 100-100v100z","M 100,0 0,100 V 0 Z","m0 0 5 50-5 50h100l-5-50 5-50z","m0 0 10 50-10 50h100l-10-50 10-50z","m0 0 15 50-15 50h100l-15-50 15-50z","m0 0 20 50-20 50h100l-20-50 20-50z","m0 0v100h100l-20-50 20-50z","m0 0c23.7 41.8 16.7 58.2 0 100h100l-20-50 20-50z","m26.5 13.9c14.6-16 35-18.1 52.7-6.76 4.84 3.1 9 7.46 12.6 12.3 3.26 4.33 6.16 9.19 7.45 14.7 3.35 14.4-5.42 38.7-15.3 48.4-23.5 23-53.7 19.6-84 10.8 3.13-26.4 9.79-61.1 26.5-79.4","m3.19 53.1c-8.19-17-0.2-34.3 19.3-45.1 5.34-2.95 11.5-4.95 17.9-6.35 5.74-1.27 11.8-2.08 17.7-1.36 15.4 1.85 34.4 16.8 38.8 27.9 10.6 26.5-7.45 50-30.7 71.8-23.8-11-53.7-27.5-63-46.9","m0 100c4.57-4.05 6.77-9.47 8.71-14.7 5.19-14.1 9.48-28.4 16.3-42 6.85-13.6 16.5-26.6 30.6-35.8 8.59-5.6 20.3-9.73 30.5-6.23 7.58 2.62 12.4 9.11 13.6 15.8 1.15 6.64-0.866 13.4-3.84 19.6-7.45 15.6-20.9 29.1-37.1 39.5-16.2 10.4-35.1 17.7-54.6 23","m3.91 51.1c3.56-5.47 9.6-10.5 16-15.4 16.1-12.4 34.6-24 53.1-35.7 1.52 8.55 3.05 17.1 7.16 25.5 5.33 10.8 14.9 21.1 18.6 32.1 3.66 11 0.223 23.3-16.8 31-12.8 5.82-60.8 15-66.9 9.84-13.8-11.7-19.3-34.7-11-47.4","m94 10.3s-10.9-17.6-49.1-6.77c-38.2 10.9-44.8 57.2-44.8 57.2s-3.19 40.3 25.9 39.3c29.1-1.06 51.1 1.34 62-9.8 9.64-9.85 12.1-53 12-61.2-0.261-11.8-5.98-18.7-5.98-18.7z","m81.1 15.9c-8.87-9.29-9.11-15.9-34.4-15.9-17.6-0.034-31.7 4.09-40.8 22.7-3.29 6.69-8.52 26.1-4.19 36.8 3.17 7.83 15.3 6.46 17.9 14.4 3.78 11.4-4.65 26.3 6.27 25.9 29-1.06 56.6 3.72 67.5-7.4 9.62-9.83 5.88-47.2 6.37-55.5 0.684-11.8-9.7-11.7-18.6-21z","m40 0.0297c15.9-0.0929 60-0.797 60 15.4 0 17.3-22.3 21.8-21.9 34.5 0.344 12.7 21.8 8.37 21.7 30.3-0.134 22.1-40.2 19.6-59.7 19.7-19.5 0.0859-40.1-9.01-40-50 0.113-41 24.1-49.9 40-50z","m0 25c57.3 15.3 79.9 1.05 100-25v100h-99.9z","m0 25c29.5 13.7 38.7 2.17 48.5-5.79 16.2-13.2 20.5-17.7 51.5-19.2v100h-99.9z","m0 33c24.3 1.75 24.6-9.81 40.1-9.4 13 0.345 20.7-13.5 31.6-13.4 18.6 0.219 16.5-9.65 28.2-10.2v100h-99.9z","m0 21.4c24.3 1.75 25.5 20.3 33.9 20.3 6.34-1.17e-4 6.07-16.9 17-16.8 9.18 0.0074 13.4 12 25 5.09 8.44-5 19.1-29.7 24.1-29.9v100h-99.9z","m90 40v-10l-3.6-3.6v-12.8h-12.8l-3.6-3.6h-10l-10-10-10 10h-10l-3.6 3.6h-12.8v12.8l-3.6 3.6v10l-10 10 10 10v10l3.6 3.6v12.8h12.8l3.6 3.6h10l10 10 10-10h10l3.6-3.6h12.8v-12.8l3.6-3.6v-10l10-10z","M 80.8,12 100,32.6 79.9,85.1 H 74.2 L 50,100 25.8,85.1 H 20.1 L 0,32.6 19.2,12 V 5.2 L 50,0 80.8,5.2 Z","m0.425 69.8c-0.3-0.501-0.499-1-0.399-1.6l7.59-56.4c0.2-1.2 1.3-2.1 2.6-1.9 3.2 0.3 6.19 0.501 9.09 0.501 20 0 27.3-7.51 28.6-9.01 0.2-0.4 0.499-0.701 0.899-1 0.499-0.4 1.2-0.501 1.9-0.3s1.2 0.701 1.5 1.2c1.3 1.6 8.59 9.01 28.6 9.01 2.9 0 5.99-0.2 9.09-0.501 1.3-0.1 2.4 0.701 2.6 1.9l7.59 56.4c0.0998 0.601-0.0998 1.1-0.399 1.6-0.2 0.2-4.49 5.21-12.6 11.8-7.49 6.11-19.8 14.2-36 18.4-0.2 0.1-0.499 0.1-0.799 0.1h-0.0998c-0.3 0-0.599-0.1-0.899-0.2-16.2-4.2-28.6-12.3-35.9-18.4-8.29-6.51-12.6-11.4-12.8-11.6z","m100 50c0 7.08-2.1 13.6-5.6 18.7 0.2 0.674 0.4 1.46 0.6 2.13 0 0-15 15.7-45 29.2-30.1-13.5-45-29.2-45-29.2 0.2-0.674 0.4-1.46 0.6-2.13-3.5-5.06-5.6-11.6-5.6-18.7 0-9.21 3.5-17.3 9.1-22.8-1.1-6.07-2.9-10.4-4.3-13.3-1.1-2.25-0.2-4.94 2.1-5.96 16-7.08 35-7.98 43.1-7.98s27.1 0.899 43.2 8.09c2.3 1.01 3.2 3.71 2.1 5.96-1.4 2.81-3.2 7.19-4.3 13.3 5.5 5.39 9 13.5 9 22.7z","m100 50c-2.3 4.3-5.3 8.2-8.8 11.7 1.7 2.3 2.9 4.6 3.8 6.9-2.2 1-4.8 1.7-7.6 2.2 0.1 5-0.6 9.9-2 14.6-4.6 1.4-9.6 2.1-14.6 2-0.5 2.8-1.2 5.4-2.2 7.6-2.3-0.9-4.6-2.2-6.9-3.8-3.5 3.6-7.4 6.6-11.7 8.8-4.3-2.3-8.2-5.3-11.7-8.8-2.3 1.7-4.6 2.9-6.9 3.8-1-2.2-1.7-4.8-2.2-7.6-5 0.1-9.9-0.6-14.6-2-1.4-4.6-2.1-9.6-2-14.6-2.8-0.5-5.4-1.2-7.6-2.2 0.9-2.3 2.2-4.6 3.8-6.9-3.5-3.5-6.5-7.4-8.8-11.7 2.3-4.3 5.3-8.2 8.8-11.7-1.7-2.3-2.9-4.6-3.8-6.9 2.2-1 4.8-1.7 7.6-2.2-0.1-5 0.6-9.9 2-14.6 4.6-1.4 9.6-2.1 14.6-2 0.5-2.8 1.2-5.4 2.2-7.6 2.3 0.9 4.6 2.2 6.9 3.8 3.5-3.5 7.4-6.5 11.7-8.8 4.3 2.3 8.2 5.3 11.7 8.8 2.3-1.7 4.6-2.9 6.9-3.8 1 2.2 1.7 4.8 2.2 7.6 5-0.1 9.9 0.6 14.6 2 1.4 4.6 2.1 9.6 2 14.6 2.8 0.5 5.4 1.2 7.6 2.2-0.9 2.3-2.2 4.6-3.8 6.9 3.5 3.5 6.5 7.4 8.8 11.7z","m100 50c-0.1 6.4-3.8 11.4-8.2 13.8l0.1 18.9c0 6.5-5.1 6.9-5.1 6.9-24.5 0.1-36.8 10.4-36.8 10.4s-12.3-10.3-36.8-10.4c0 0-5.1-0.4-5.1-6.9l0.1-18.9c-4.4-2.4-8.1-7.4-8.2-13.8 0.1-6.4 3.8-11.4 8.2-13.8l-0.1-18.9c0-6.5 5.1-6.9 5.1-6.9 24.5-0.1 36.8-10.4 36.8-10.4s12.3 10.3 36.8 10.4c0 0 5.1 0.4 5.1 6.9l-0.1 18.9c4.4 2.4 8.1 7.4 8.2 13.8z","m100 50c-2.6 2.8-6.3 5.3-10.7 7.5l9.2 3.8c-2 0.2-3.9 0.7-5.7 1.5 1.5 2.2 2.6 4.3 3.5 6.4-2.1 0.9-4.4 1.6-7 2.1 0.7 1.8 1.7 3.5 3 5.1l-9.2-3.8c1.6 4.6 2.4 9 2.3 12.8-3.8 0.1-8.2-0.7-12.8-2.3l3.8 9.2c-1.6-1.3-3.3-2.3-5.1-3-0.5 2.6-1.2 4.9-2.1 7-2.1-0.8-4.3-2-6.4-3.5-0.8 1.8-1.3 3.7-1.5 5.7l-3.8-9.2c-2.2 4.4-4.7 8.1-7.5 10.7-2.8-2.6-5.3-6.3-7.5-10.7l-3.8 9.2c-0.2-2-0.7-3.9-1.5-5.7-2.2 1.5-4.3 2.6-6.4 3.5-0.9-2.1-1.6-4.4-2.1-7-1.8 0.7-3.5 1.7-5.1 3l3.8-9.2c-4.6 1.6-9 2.4-12.8 2.3-0.1-3.8 0.7-8.2 2.3-12.8l-9.2 3.8c1.3-1.6 2.3-3.3 3-5.1-2.6-0.5-4.9-1.2-7-2.1 0.8-2.1 2-4.3 3.5-6.4-1.8-0.8-3.7-1.3-5.7-1.5l9.2-3.8c-4.4-2.2-8.1-4.7-10.7-7.5 2.6-2.8 6.3-5.3 10.7-7.5l-9.2-3.8c2-0.2 3.9-0.7 5.7-1.5-1.5-2.2-2.6-4.3-3.5-6.4 2.1-0.9 4.4-1.6 7-2.1-0.7-1.8-1.7-3.5-3-5.1l9.2 3.8c-1.6-4.6-2.4-9-2.3-12.8 3.8-0.1 8.2 0.7 12.8 2.3l-3.8-9.2c1.6 1.3 3.3 2.3 5.1 3 0.5-2.6 1.2-4.9 2.1-7 2.1 0.8 4.3 2 6.4 3.5 0.8-1.8 1.3-3.7 1.5-5.7l3.8 9.2c2.2-4.4 4.7-8.1 7.5-10.7 2.8 2.6 5.3 6.3 7.5 10.7l3.8-9.2c0.2 2 0.7 3.9 1.5 5.7 2.2-1.5 4.3-2.6 6.4-3.5 0.9 2.1 1.6 4.4 2.1 7 1.8-0.7 3.5-1.7 5.1-3l-3.8 9.2c4.6-1.6 9-2.4 12.8-2.3 0.1 3.8-0.7 8.2-2.3 12.8l9.2-3.8c-1.3 1.6-2.3 3.3-3 5.1 2.6 0.5 4.9 1.2 7 2.1-0.8 2.1-2 4.3-3.5 6.4 1.8 0.8 3.7 1.3 5.7 1.5l-9.2 3.8c4.4 2.2 8.1 4.7 10.7 7.5z","m91.2 25.1c5.4 6.4 8.8 15.2 8.8 24.9s-3.4 18.5-8.8 24.9v5.1c0 4-3.6 7.2-8 7.2h0.8v2.2c0 4-4.1 4.2-4.1 4.2-20 0.1-30 6.4-30 6.4s-10-6.3-30-6.4c0 0-4.1-0.3-4.1-4.2v-2.2h0.8c-4.4 0-8-3.2-8-7.2v-5.1c-5.2-6.4-8.6-15.2-8.6-24.9s3.4-18.5 8.8-24.9v-5.1c0-4 3.6-7.2 8-7.2h-0.8v-2.2c0-4 4.1-4.2 4.1-4.2 19.9-0.1 29.9-6.4 29.9-6.4s10 6.3 30 6.4c0 0 4.1 0.3 4.1 4.2v2.2h-0.8c4.4 0 8 3.2 8 7.2v5.1z","m94.6 18.3c1.8 0.1 3.6 0.2 5.4 0.2v57.4c-3.5 0.8-15.3 4.2-15.9 15.3h-7.6c-2.3 1.3-5.4 2.4-9.1 3.3-0.9 0.2-1.9 0.4-2.9 0.6 0 0-2.2 0.5-3.3 0.8-3.6 0.9-8.9 2.5-11.2 4.1-2.2-1.6-7.6-3.2-11.2-4.1-1.1-0.3-3.3-0.8-3.3-0.8-1-0.2-1.9-0.4-2.9-0.6-3.7-0.9-6.8-2-9.1-3.3h-7.6c-0.6-11.1-12.4-14.5-15.9-15.3v-57.4c1.8 0 3.6-0.1 5.4-0.2 2.9-5.3 11.8-9.2 22.4-9.2h0.4c0.1-0.3 0.2-0.6 0.2-1 0.1-1.9 1.1-2.9 2.2-2.9h8.1c2-5.2 11.3-5.2 11.3-5.2s9.3 0 11.2 5.2h8.1c1.1 0 2.2 1 2.2 2.9 0 0.3 0.1 0.6 0.2 1h0.4c10.7 0 19.6 3.9 22.5 9.2z","m100 25.5v53.9s-0.3 3.7-4 4.8l-42.4 15s-2.6 0.8-3.6 0.8-3.6-0.8-3.6-0.8l-42.4-15c-3.6-1.1-4-4.8-4-4.8v-53.9c0-1.4 1.2-2.6 2.9-2.6h4.1v-5.2c10.3-0.4 12.2-8.8 12.2-8.8h4.5c0-2.2 1.3-3.3 2.7-3.3h9.9c2.4-5.6 13.7-5.6 13.7-5.6s11.3 0 13.7 5.5h9.9c1.4 0 2.7 1.1 2.7 3.3h4.5s1.9 8.5 12.2 8.8v5.2h4.1c1.7 0.1 2.9 1.3 2.9 2.7z","m93.3 30.5c2.3 0 4.61 0.3 6.71 1v41.8c-2.1 0.6-4.41 1-6.71 1v0.1c0 3-2.61 5.4-5.71 5.4h-3.31v0.2c0 3.7-3.91 6.6-8.72 6.6-1 0-2-0.2-2.91-0.4-2.2 2.9-5.51 5.4-9.72 7.2-0.802 0.4-1.7 0.7-2.61 1 0 0-2.1 0.9-3.11 1.4-2.1 1-5.01 2.6-7.21 4.2-2.3-1.7-5.11-3.2-7.21-4.2-1-0.5-3.11-1.4-3.11-1.4-0.902-0.3-1.8-0.6-2.61-1-4.21-1.8-7.62-4.3-9.72-7.2-0.902 0.2-1.9 0.4-2.91 0.4-4.81 0-8.72-3-8.72-6.6v-0.2h-3.31c-3.11 0-5.71-2.4-5.71-5.4v-0.1c-2.3 0-4.61-0.3-6.71-1v-41.8c2.1-0.6 4.41-1 6.71-1v-0.1c0-3 2.61-5.4 5.71-5.4 0.902-13.9 17.3-25 37.5-25 20.1 0 36.6 11.1 37.7 25 3.11 0 5.71 2.4 5.71 5.4z","m95.7 52c1.1 4.6 3.2 8.8 4.3 13.4-4.9 6-14.3 5.1-21.3 8.6-3.1 1.6-5.9 4.1-9.3 4.6-1.3 0.2-2.6 0-3.8 0.3-2.2 0.5-3.9 2.3-5.5 3.9-8.1 7.9-18.1 13.8-28.9 17.2v-7.7c-1.4 1.2-2.9 2.1-4.5 2.8-0.3-3 0.1-6.1 1-8.9 0.5-1.5 1.1-2.9 1.3-4.4 0.2-2.9-1.6-5.6-3.7-7.5s-4.7-3.4-6.8-5.3c-5.5-5-8-13.4-14.8-16.5 1.2-1.8 2.2-3.8 2.8-5.9-1.6 0.3-3.2 0.8-4.7 1.6 0.9-6.2 0.3-12.5-1.8-18.3 2.4-0.4 4.8-1.4 6.8-2.8l1.6-0.3c4.9-4.9 10.2-9.4 15.8-13.5 2.4-1.7 4.9-3.4 7.6-4.5 1.9-0.8 4-1.3 6-1.9 4.8-1.5 9.3-3.9 13.4-6.9 0.4 1.3 0.7 2.5 1.1 3.8 3.7-0.6 7.4 1.4 11.1 0.9 4.1-0.5 7.9-4 11.8-2.8 0.1 1.1 0.2 2.2 0.2 3.3 2-0.3 3 2.2 3.6 4.1 2.5 7.1 9.4 11.5 14.7 16.7 1.6 1.5 3.1 3.3 3.4 5.4 0.5 2.7-1.3 5.7-4 6.5 1.4 0.2 2.8 0.4 4.2 0.6-2.7 3.7-2.7 8.9-1.6 13.5z","m96.8 69.2c0.5 4.5 0.6 9.3 3.2 12.8-2.2 1.6-4.1 3.6-5.6 5.9-0.2-0.8-0.5-1.5-0.7-2.3-0.1 1.8-1.6 3.1-3.1 3.6-1.6 0.5-3.2 0.4-4.8 0.5-2.5 0.2-5 1-7.2 2.3-2 1.2-3.8 2.9-5.8 4-2 1.2-4.4 1.9-6.6 1.1 0.1-1.3 0.1-2.5 0.2-3.8-0.9 2-3.6 2.8-5.3 1.6-0.3 0.6-0.7 1.3-1 1.9-11.4 1.9-23.1 2.2-34.5 0.8 0.2-0.7 0.5-1.3 0.7-2-4.3 3.8-10.2 4.2-15.8 4.4 1.7-1.8 2.7-4.4 2.7-7 0-3.1-1.3-6-2.4-8.9-1.9-4.4-3.2-9.1-4.2-13.8-0.8-0.7-1.8-1-2.9-1 0.6-0.6 1.2-1.2 1.8-1.7-0.7-0.5-1.2-1.2-1.5-2 1.6-5 1.6-10.4 0-15.2-0.7-2.1-1.7-4.1-2.2-6.2-1.1-4.8 0.2-9.8 1.4-14.6 0.5 0 1 0.1 1.4 0.1-0.8-1.3-1.1-3-1.5-4.5-1-5.5-2-10.9-3.1-16.3 3.5 0.2 6.9-0.1 10.3-0.7 0.5 0.6 0.9 1.2 1.4 1.7l0.2-3.2c2.7-0.9 5.3-1.8 8-2.7 2.9-1 5.9-2 9-2.3 2.5-0.2 5.2 0 7.1-1.7 0 0.4-0.1 0.7-0.1 1.1 5-1.1 10.3-0.5 15.1 1.6 0 0.6 0.1 1.1 0.1 1.7 0.9-1.3 2.6-1.5 4-1.2 1.4 0.4 2.7 1.2 4 1.9 6.3 2.8 13.5 0.2 19.9-2.2 0.5-0.2 1.1-0.4 1.6-0.2s0.9 0.9 0.6 1.4c0.9-0.2 1.8-0.4 2.8-0.7-0.1 0.4-0.2 0.9-0.3 1.3 2.3 3.3 4.5 6.7 6.7 10.2 1.3 2 2.5 4.1 3.2 6.4 0.6 2 0.9 4.2 1.1 6.3l1.2 11.1c0.3 3 0.1 6.9-2.5 7.8 0.5 0.2 1.1 0.4 1.6 0.7-1.4 0.2-2.3 1.7-2.3 3.2-0.1 1.5 0.4 2.9 0.9 4.3 1.6 4.6 2.7 9.5 3.2 14.5z","m96.3 27.7c1.2 0.1 2.4 0.1 3.7 0.2-1.2 0.9-1.6 2.6-1.9 4.2-0.599 3.1-1.1 6.2-1.7 9.3-0.599 3.3-1.2 6.6-0.999 9.9 0.2 3 0.899 5.9 1.2 8.8 0.3 3 0 6.1-1.6 8.5 0.799 0.1 1.5 0.3 2.3 0.4-0.699 1.4-1.7 2.6-2.8 3.5 2.5 1.3 2.6 4.9 2.7 7.9 0.0999 5.2 1.1 10.5 2.8 15.4-1.7-0.1-3.1 1-4.7 1.6-1.3 0.5-3.2 0.5-4-0.6-2.1 0.7-4.1 2-6.29 1.8-1.4-0.1-2.7-0.8-4.1-1.2-1.9-0.7-4-0.9-5.99-0.6-1.4 0.2-2.9 0.6-4.3 0.2-1.4-0.4-2.5-2.1-1.9-3.5-0.599 0.7-0.899 1.7-0.699 2.6-3.4-0.4-6.89 0.2-9.99 1.9-0.2-0.8-0.3-1.6-0.5-2.4-0.4 0.7-0.799 1.3-1.2 2-0.699-1.2-1.4-2.4-2.1-3.6-0.2 1.1-0.4 2.1-0.599 3.2-4.3-1.8-8.89 1.7-13.6 2-2.7 0.2-5.39-0.7-8.09-0.7-2.5 0-4.9 0.9-7.39 1.3-2.5 0.4-5.19 0.2-7.19-1.5-0.3-0.9-0.599-1.7-0.899-2.6-0.999 0.7-1.8 1.7-2.3 2.8-3.7-0.3-7.39 0-11 0.8 0.4-6 0.4-12 0-18-0.2-2.5-0.5-5.2-2.2-6.9 1.1-0.2 2.2-1 2.7-2.1-1.2-0.1-2.4-0.1-3.7-0.2 1.2-0.9 1.6-2.6 1.9-4.2 0.599-3.1 1.1-6.2 1.7-9.3 0.599-3.3 1.2-6.6 0.999-9.9-0.2-3-0.899-5.9-1.2-8.8-0.3-3 0-6.1 1.6-8.5-0.799-0.1-1.5-0.3-2.3-0.4 0.699-1.4 1.7-2.6 2.8-3.5-2.5-1.3-2.6-4.9-2.7-7.9 0.0999-5.4-0.899-10.6-2.6-15.5 1.7 0.1 3.1-1 4.7-1.6 1.3-0.5 3.1-0.5 4 0.6 2.1-0.7 4.1-2 6.29-1.8 1.4 0.1 2.7 0.8 4.1 1.2 1.9 0.7 4 0.9 5.99 0.6 1.3-0.1 2.8-0.5 4.2-0.1 1.4 0.4 2.5 2.1 1.9 3.5 0.599-0.7 0.899-1.7 0.699-2.6 3.4 0.4 6.89-0.2 9.99-1.9 0.2 0.8 0.3 1.6 0.5 2.4 0.4-0.7 0.799-1.3 1.2-2 0.599 1.2 1.3 2.4 2 3.6 0.2-1.1 0.4-2.1 0.599-3.2 4.3 1.8 8.89-1.7 13.6-2 2.7-0.2 5.39 0.7 8.09 0.7 2.5 0 4.9-0.9 7.39-1.3 2.5-0.4 5.19-0.2 7.19 1.5 0.3 0.9 0.599 1.7 0.899 2.6 0.999-0.7 1.8-1.7 2.3-2.8 3.7 0.3 7.39 0 11-0.8-0.4 6-0.4 12 0 18.1 0.2 2.5 0.5 5.2 2.2 6.9-1.1 0.1-2.1 0.9-2.7 2z","m0.0122 12.5c-0.2-2.4 2.1-4.3 4.5-4.8 0.5 0 0.901-0.0999 1.4-0.0999v-1.1c2.7-0.999 5.4-2.1 8.11-3.3 0.6 0.699 1.1 1.5 1.7 2.2-0.1-0.899-0.2-1.8-0.3-2.7 3.7-0.899 7.51-1.8 11.2-2.7 0.5 0.799 1 1.7 1.5 2.5 0-1.6 2.4-1.8 4.1-1.6 8.51 1.1 17.1 0.999 25.5-0.3 0.701 0.799 1.2 1.7 1.5 2.7 1.7-2.8 6-2.8 9.51-2.5 9.71 0.899 19.3 1.8 28.9 2.7-0.6 5.49-0.5 11.2 0.4 16.8-1 0.4-1.9 0.899-2.9 1.3 0.801 0.3 1.6 0.699 2.4 0.999-0.6 7.09-1.1 14.1-1.7 21.2-0.1 0.999-0.1 2 0.2 2.9 0.2 0.599 0.6 1.1 0.801 1.7 0.2 0.599 0.2 1.3 0.1 1.9-0.1 2.3-0.2 4.5-0.4 6.79-0.701 0.799-1.3 1.7-2 2.5 0.901 0 1.6 0.999 1.7 1.9 0 0.899-0.3 1.7-0.5 2.5-0.2 0.999-0.1 2 0 2.9 0.3 4.3 0.701 8.49 1 12.8 0.2 2.9 0.701 6.19 3.2 7.99 0.2 2.3-2.1 4.2-4.5 4.7-0.5 0.0999-0.901 0.0999-1.4 0.0999v1.1c-2.7 0.999-5.4 2.1-8.11 3.3-0.6-0.699-1.1-1.5-1.7-2.2 0.1 0.899 0.2 1.8 0.3 2.7-3.7 0.899-7.51 1.8-11.2 2.7-0.5-0.799-1-1.7-1.5-2.5 0 1.6-2.4 1.8-4.1 1.6-8.51-1.1-17.1-0.999-25.5 0.3-0.701-0.799-1.2-1.7-1.5-2.7-1.7 2.8-6 2.8-9.51 2.5-9.61-0.899-19.2-1.7-28.8-2.6 0.6-5.49 0.5-11.2-0.4-16.8 1-0.4 1.9-0.899 2.9-1.3-0.801-0.3-1.6-0.699-2.4-0.999 0.5-7.09 1.1-14.2 1.7-21.2 0.1-0.999 0.1-2-0.2-2.9-0.2-0.599-0.6-1.1-0.801-1.7-0.2-0.599-0.2-1.3-0.1-1.9 0.1-2.3 0.2-4.5 0.4-6.79 0.701-0.799 1.3-1.7 2-2.5-0.901 0-1.6-0.999-1.7-1.9 0-0.899 0.3-1.7 0.5-2.5 0.2-0.999 0.1-2 0-2.9-0.3-4.3-0.701-8.49-1-12.8-0.3-3-0.801-6.29-3.3-7.99z","m0.0295 73.1c-0.3-5.51 1.7-11 5.5-15 0.8-0.801 1.6-1.6 2.1-2.5 0.5-0.901 0.6-2 0.7-3 0.4-4 0.7-8.11 1.1-12.1 0.1-0.601 0.1-1.2 0.5-1.6 0.4-0.4 1.2-0.4 1.4 0.1-0.6-0.801-0.2-2 0.2-3 3.5-7.61 7.7-14.8 12.4-21.7 0.3 0 0.7 0 1 0.1 3.3-3.9 5-9.21 4.5-14.3 4.2 2.6 9.2 4 14.2 3.9 1.5 0 3.4 0.2 3.7 1.6 3.1 0.4 6.3 0.4 9.3 1 10.2 1.9 18.6 8.71 26.6 15.2 1.1 0.901 2.3 2.2 1.7 3.5 0.4-0.4 1-0.5 1.5-0.2v3.3c4.7-0.1 9.4 1 13.6 3.2-8.1 9.61-12.3 22.4-11.6 34.9-2.1-0.4-4.3-0.801-6.4-1.2 1.3 1.4 2.6 2.8 3.9 4.2-3 1.8-3.5 5.91-4.2 9.31-0.7 3.4-2.9 7.51-6.4 7.21-0.1 0.701 0.3 1.5 0.9 1.8-0.6 0.2-1.2 0.5-1.8 0.701 0.5 1.1 1.1 2.2 1.6 3.3-3.1 1.9-5.4 4.8-6.6 8.21-4.2-4.4-10.2-7.01-16.3-7.11 0.2-0.801 0.4-1.6 0.6-2.4l-1.7 0.801c-4.9-1.5-10-2.5-15.1-3-0.1-0.601-0.2-1.2-0.4-1.8-1.2-0.3-2.1-1-3.2-1.6-4.3-2.4-9.8-1.9-14.1-4.4-0.1-0.4-0.1-0.801-0.2-1.2-0.4 0.3-0.8 0.701-1.2 1-0.7-1.7-2.9-1.9-4.7-2.4-2.3-0.701-4.2-2.3-6.3-3.5-2-1.3-4.5-2.2-6.8-1.3z","m1.43 45.4c-0.3-0.5-0.7-0.9-1.2-1 1.6-0.9 0.9-3.5 0.999-5.4 0-1.6 0.7-3.1 1.4-4.5 2.1-4.6 4.3-9.2 6.4-13.7 0-0.6-0.0999-1.1-0.0999-1.7 0.999 0.9 2.4-0.4 3.2-1.5 4.6-6.4 12.5-9.4 17.4-15.5 0.7 0.1 1.3 0.5 1.7 1.1 0.4-1.1 1.6-1.7 2.7-1.8 1.1 0 2.3 0.4 3.4 0.6 5.7 1.2 11.9-1.9 17.2 0.7 2.9-1.8 6.4-3.4 9.6-2.4 0.7 0.2 1.4 0.5 2 0.9 5 2.5 10.1 5 14 9.1 0.9 0.9 1.7 2.2 1.4 3.4 0 0.1-0.1 0.2-0.1 0.3 1.2 0.9 2.7 1.3 4.2 1.1 0.1 0.5 0.2 1 0.2 1.6l1.1-0.5s0.6 1.1 1.2 2.1c2.3 1.4 4.3 3.2 5.9 5.3-0.2 0.4-0.4 0.9-0.7 1.3 1.1-0.4 1.9 1 2.2 2.1 1.1 4.4 1.7 9 1.7 13.5 0 2-0.1 4.1 0.6 6 0.5 1.4 1.5 2.6 2 4.1 0.5 1.5 0.2 3.4-1.2 4 0.3 0.5 0.7 0.9 1.2 1-1.6 0.9-0.9 3.5-0.999 5.4 0 1.6-0.7 3.1-1.4 4.5-2.1 4.6-4.3 9.2-6.4 13.7 0 0.6 0.1 1.1 0.1 1.7-0.999-0.9-2.4 0.4-3.2 1.5-4.6 6.4-12.5 9.4-17.4 15.5-0.7-0.1-1.3-0.5-1.7-1.1-0.4 1.1-1.6 1.7-2.7 1.8-1.1 0-2.3-0.4-3.4-0.6-5.7-1.2-11.9 1.9-17.2-0.7-2.9 1.8-6.4 3.4-9.6 2.4-0.7-0.2-1.4-0.5-2-0.9-5-2.5-10.1-5-14-9.1-0.9-0.9-1.7-2.2-1.4-3.4 0-0.1 0.1-0.2 0.1-0.3-1.2-0.9-2.7-1.3-4.2-1.1-0.1-0.5-0.2-1-0.2-1.6l-1.1 0.5s-0.6-1.1-1.2-2.1c-2.3-1.4-4.3-3.2-5.9-5.3 0.2-0.4 0.4-0.9 0.7-1.3-1.1 0.4-1.9-1-2.2-2.1-1.1-4.4-1.7-9-1.7-13.5 0-2 0.0999-4.1-0.6-6-0.5-1.4-1.5-2.6-2-4.1-0.5-1.4-0.2-3.4 1.2-4z","m95.4 51c2.1 2.9 3.7 6.4 4.6 10-1 1.1-2 2.1-3 3.2 0.3 0.6 0.5 1.2 0.8 1.8-1.4 3-4.2 3.9-6.8 4.9-5.8 2.3-11 6.3-15.2 11.8l0.3-2.4c-7.5 4.1-15.3 7.4-23.4 9.8-0.1-0.7 0.1-1.3 0.4-1.7-4.1 1.5-8.2 3-12.2 4.5-3.7 1.4-7.6 2.9-10.3 6.2 0.4-0.8 0.6-2 0.4-3.2-2.1-0.2-4-3-5.5-5.7-3.3-6-5.9-12.6-8.4-19.1-1.1-2.8-2.1-5.6-3.2-8.4-1.8-4.8-3.7-9.6-4.7-14.5-0.7-4.2-1.5-9.5-4.5-11.6l0.9-4.2-1.7 2 0.3-2.2s-0.4-1-1.7-2.3c-1.3-1.4-2.5-3.3-2.5-3.3s5.2-2.7 7.9-3.8 4.5-3.5 4.5-3.5c4.7-3.5 9.4-6.9 14.1-10.4 0.4 0.9 0.8 1.8 1.2 2.8 1.6-1.9 4-2 6.3-2.3 6.3-0.9 12.1-3.7 16.9-8.3 1.6 2.5 3.9 1.1 5.3-0.5 0.2 0.6 0.5 1.2 0.7 1.8 4.9-0.8 9.7-1.6 14.6-2.4-1.4 0.3-2.5 1.7-2.8 3.6 2.1-1.6 4.7-2.5 7.4-2.6 1.3 2.7 2.4 5.7 3 8.7 0.8 0 1.5 0.1 2.3 0.1 0 2.4 0.8 5 1.6 7.4l1.5 4.5c1.6 4.7 3.1 9.4 5.3 13.7 1.6 3.2 3.7 6.6 3.8 10 0 0.9-0.1 1.8 0.1 2.8 0.4 1.1 1.1 2 1.7 2.8z","m99.9 48.4c0.1 1.6 0.2 3.1-0.1 4.7-0.3 1.4-1.1 2.8-1.5 4.2-0.4 1.4-0.5 3.1 0.5 4.2-1.1 0.699-2.2 1.4-3.3 2.1-0.3 0.2-0.7 0.4-0.9 0.799-0.3 0.5-0.2 0.999-0.2 1.5 0.1 1.4-0.2 2.8-0.8 4.1-1.1 2.6-2.3 5.19-3.4 7.79-0.2 0.5-0.6 1.1-1.2 1.1-0.3 0.999-0.7 2-1 3h-1.3c0.1 0.999-0.8 1.9-1.8 2.4-1 0.4-2.1 0.599-3.1 0.999-3.1 1.1-5 4.2-7.4 6.49-0.4 0.4-0.9 0.799-1.4 0.699-0.4 0-0.8-0.3-1.2-0.4-1-0.3-2 0.5-2.5 1.3-0.5 0.899-0.7 1.9-1.2 2.7-2.3 3.4-8.2 1.5-11.6 3.9-0.4-0.4-0.9-0.899-1.3-1.3-2.1 0.799-4.4 1.3-6.7 1.4-0.9 0-2.3-0.4-2.1-1.3-5.1 0-10.2 0.0999-15.2 0.599-0.8 0.0999-1.6 0.0999-2.2-0.3-0.5-0.3-0.8-0.799-1.3-1.2-1.1-0.799-2.8-0.3-3.9-1.1-1-0.699-1.2-2.2-2.3-2.6-1.4-0.4-3.1 1.3-4.1 0.3-0.1-0.5-0.2-0.999-0.3-1.5-2.2-2.8-4.4-5.49-6.5-8.29-1.2-1.5-2.3-3-3.3-4.6-1.2-2.1-2-4.4-3.3-6.39-0.6-0.999-1.4-2-1.8-3.1s-0.2-2.5 0.7-3.3c-0.6-0.0999-1.2-0.3-1.5-0.799-0.2-0.3-0.2-0.599-0.2-0.899-0.2-2-0.3-4-0.5-5.99-0.1-0.899-0.1-1.7-0.2-2.6-0.1-1.8-0.3-3.7-0.4-5.49-0.1-1.4-0.2-3 0.1-4.5 0.3-1.4 1.1-2.8 1.5-4.2 0.4-1.4 0.5-3.1-0.5-4.2 1.1-0.699 2.2-1.4 3.3-2.1 0.3-0.2 0.7-0.4 0.9-0.799 0.3-0.5 0.2-0.999 0.2-1.5-0.1-1.4 0.2-2.8 0.8-4.1 1.1-2.6 2.3-5.19 3.4-7.79 0.2-0.5 0.6-1.1 1.2-1.1 0.3-0.999 0.7-2 1-3h1.3c-0.1-0.999 0.8-1.9 1.8-2.4 1-0.4 2.1-0.599 3.1-0.999 3.1-1.1 5-4.2 7.4-6.49 0.4-0.4 0.9-0.799 1.4-0.699 0.4 0 0.8 0.3 1.2 0.4 1 0.3 2-0.5 2.5-1.3 0.5-0.899 0.7-1.9 1.2-2.7 2.3-3.4 8.2-1.5 11.6-3.9l1.3 1.3c2.2-0.799 4.4-1.3 6.7-1.4 0.9 0 2.3 0.4 2.1 1.3 5.1 0 10.2-0.0999 15.2-0.599 0.8-0.0999 1.6-0.0999 2.2 0.3 0.5 0.3 0.8 0.799 1.3 1.2 1.1 0.799 2.8 0.3 3.9 1.1 1 0.699 1.2 2.2 2.3 2.6 1.4 0.4 3.1-1.3 4.1-0.3l0.3 1.5c2.2 2.8 4.4 5.49 6.5 8.29 1.2 1.5 2.3 3 3.3 4.6 1.2 2.1 2 4.4 3.3 6.39 0.6 0.999 1.4 2 1.8 3.1 0.4 1.1 0.2 2.5-0.7 3.3 0.6 0.0999 1.2 0.3 1.5 0.799 0.2 0.3 0.2 0.599 0.2 0.899 0.2 2 0.3 4 0.5 5.99 0.1 0.899 0.1 1.7 0.2 2.6 0.1 1.6 0.2 3.4 0.4 5.29z","m0.00116 75.7c0.794 0.0537 1.95-0.858 2.66 0.148 0.617 0.87 0.424 1.62 1.12 1.62 0.181 4.22 2.61-1.6 2.98 1.98 0.0294 0.286-0.998 2.08-1.07 2.24 0.239-0.53 1.7-0.122 2.03-0.13 0.695-0.0188 1.27 0.938 1.46 2.15 0.0106 0.0685 0.727 0.909 0.851 1.12 0.555 0.948-0.436 0.907 0.914 1.4 0.245-0.0013 0.491-0.0027 0.736-0.0027 0.0642-0.0362 0.0963-0.23 0.0966-0.58 1.86-0.46 3.67-0.393 5.4 0.58 2.51 1.41 4.86 2.46 7.33 4.1 6.07 4.04 12.2 4.33 18.7 5.85 3.57 0.834 8.17-0.4 12-1.11 4.13-0.76 8.34-3.88 12.5-2.25 3.08 1.2 6.23 3.67 9.46 4.56 3.03 0.84 6 4.31 9.1 1.7 0.714-0.6 1.55-1.83 2.24-2.3 0.449-0.303 1.13 0.205 1.56-0.608 0.456-0.852 0.654-2.3 1.07-3.53 0.34-1.01 1.14-0.795 1.36-1.74 0.372-1.62 0.0865-3.46 0.194-4.99-0.0355 0.503 0.221-3.28 0.191-2.69 0.061-1.2 0.481-1.82 0.412-3.21-0.112-2.27-2.02-3.95-1.85-6.65-0.22 0 0.752 0.248 0.602-0.98-0.24-1.96-1.63-2.75-2.1-3.11 0.088-2.07 0.393-0.599 0.756-1.4-0.782-3.91 2.58-2.79 2.91-2.69 0.167 0.0497 2.63-0.0752 2.55-0.957-0.0659-0.732-0.698-0.514-0.605-1.97 0.502 0 2.29 0.677 2.62-0.856-0.157-1.3-1.83-1.7-1.58-3.4 0.405-2.75 2.6 1.68 3.04-1.59 0.261-1.96-0.338-3.61-0.693-4.99-0.148-0.579-0.412-1.43-0.568-2.02-0.188-0.715-0.688-0.506-0.802-1.4 0.329-3.24 2.08 0.768 2.34-2.43-0.22-1.15-1.79-1.06-2.19-1.43-0.831-0.756-1.34-1.51-2.11-2.43-0.853-1-1.71-2.74-2.61-4.01-2.94-4.15-5.83-6.53-8.97-8.18-1.19-0.623-3.29-0.0564-4.26-4.09-0.52-2.17-0.603-5.55-1.23-7.51-0.556-1.76-1.19-2.3-1.78-3.06-2.06-2.66-4.28-2.91-6.46-3.37-2.25-0.474-4.36-1.86-6.45-2.39-5.64-1.42-10.6-4.15-16.3-4.15 0-2.92 0.419-2.48-0.315-4.09-0.344-0.756-0.747-0.444-1.18-0.584-0.465-0.15-0.624-0.474-1.12 0-0.332 0.314-0.611 0.468-0.952 0.584-0.438 0.149-0.843 0.768-1.46 0.591-0.691-0.197-1.14-0.0537-2.03-0.00537-2.05 0.11-3.94-0.699-6.17-0.585-1.36 0.0711-2.58 1.75-3.87 3.24-0.536 0.626-0.966 1.54-1.51 2.02-0.656 0.577-1.01 1.28-1.51 2.19-2.16 3.91-5.25 0.153-7.65 0.153-2.13 0-4.15 0.0738-6.17 1.17-1.44 0.777-2.75 1.93-4.13 3.21-0.51 0.471-1.11 0.98-1.58 2.05-0.12 0.274-0.503 0.129-0.591 0.881-0.324 2.74 0.255 1.98 0.562 2.93-2.86e-4 1.58-2 4.52-2.18 4.96-0.445 1.06-1.32 3.54-1.81 5.47 0.0436 1.82 1.06 0.149 1.37 0.76 0.614 1.2-0.197 2.12-0.113 2.81 0.113 0.929 0.445-0.132 0.606 0.66-0.434 2.04-1.49 1.28-1.72 3.36-0.0386 0.357 0.957 0.949 0.961 0.969 0.46 2.4-0.261 2.01-0.266 2.93-0.0151 2.49-0.298 1.17 0.405 1.17 0.353 0 3.5-1.66 3.68-0.0564 0.379 3.24-1.06 4.04-1.52 4.45-0.824 0.74-1.27 1.01-1.97 1.97-0.541 0.74-0.69 1.63-1.07 2.79-0.399 1.21-1.3 1.84-1.6 3.29-0.191 0.94 1.23-0.168 1.35-0.168 0 2.7-1.61 3.82-1.6 3.9 0.152 1.15 0.18 2.76-0.0223 4.6-0.384 3.48-0.785 1.83-1.47 3.78-0.915 2.6 0.0226 2.84-0.0274 5.46-0.0194 1.01-0.813 3.89-0.915 3.88 0.33 0.0215-0.0241-0.0013 0 0","m100 7.43c-0.651-5.63-2.08-5.19-3.24-5.89-2.07-1.25-4.59-1.75-6.56-1.01-2.2 0.822-5.24 1.38-7.41 0.999-3.69-0.639-7.04 1.32-10.9 1.38-3.25 0.0474-6.06-1.07-9.76-2.14-8.09-2.34-16.4 1.23-24.6 3.52-9.76 2.72-19.7 7.64-29.6 9.64-1.23 0.25-5.05-2.64-5.32 5.82-0.184 5.87 0.561 0.52 1.16 4.5 0.662 4.42-0.517 4.54-0.962 5.53-1.76 3.9 0.133 11.4-1.42 14.8-0.612 1.32-1.42 0.566-1.39 5.69 0.021 3.28 0.782 2.97 0.782 5.67-0.291-0.757-0.502-0.624-0.635 0.402 0.251 1.36 0.511 1.32 0.787 1.95 0.243 0.55 0.655 0.493 0.892 1.09 0.373 0.945 0.466 2.51 0.844 3.41 1.07 2.54 2.22 1.6 3.19 4.85 0.154 0.517 0.402 0.446 0.53 1.05 0.298 1.4 0.195 3.11 0.602 4.42 0.621 2 1.68-0.432 2.26 1.43 0.316 1.01 0.331 3.82 0.528 5.24 0.262 1.89 0.629 3.64 1.02 5.09 1.41 5.25 3.3 7.68 5.04 7.59 0.756-0.0395 1.9-0.139 2.68 1.36 0.384 0.74 0.793 1.99 1.23 2.74 1.85 3.17 3.87 3.46 6.01 3.46 1.94-0.0032 3.84-0.588 5.62-3.17 1.17-1.71 2.49-3.92 3.8-4.4 3.83-1.39 7.85-2.01 11.7-0.694 1.23 0.422 2.51-0.463 3.67 0.678 0.641 0.629 1.18 1.73 1.85 2.15 1.84 1.18 3.59 0.267 5.27-1.45 2.87-2.95 6.19-3.79 9.05-5.47 1.51-0.885 3.27 1.87 4.96 1.27 1.62-0.575 3.61-1.58 5.33-2.68 1.39-0.888 2.64-2.79 3.99-4.13 0.787-0.783 2.88-2.24 3.24-6.43-0.024 0.283-0.611-0.939-0.618-2.33-0.044 0.098 0.846-1.58 0.844-1.58 0.888-0.727 1.28-0.636 1.84-2.74 0.628-2.37 0.484-3.14 1.35-4.13 0.286-0.326 2.23-0.977 2.33-1.86 0.301-2.7-1.03-2.65-1.16-3.29 0.258-2.1 2.48-1.7 0.91-3.81-0.39-0.52-1.03-0.648-1.5-0.675-0.13-0.0079-1.17 1.37-1.3 0.667-0.629-3.22 0.665-3.06 0.774-4.13 0.323-3.15-0.292-4.5-0.0602-6.19 0.192-1.4 1.39-0.498 1.74-0.689 0.723-0.383 3.74 1.08 4.23-2.98 0.0784-0.65-2.48-1.74-2.78-1.84-1.32-0.446-2.83-0.953-4.11-2.06 0.0563-0.759 0.477-2.36 0.583-2.76 0.921-3.48 0.296-0.0237 1.16-0.715 0.218-0.174 0.645-1.27 0.865-1.48 0.0739-0.0711 0.637 0.0016 0.58 0.0427 0.664-0.47 1.25-0.688 1.45-3.33 0.192-2.56-0.386-4.71 0.318-6.92 0.197-0.62 0.795-0.413 0.875-0.683 0.226-0.771 0.311-2.67 0.445-3.19 0.434-1.68 0.948-4.87 1.61-5.76 1.06-1.42 5.42 1.08 5.42-5.81-0.0482-0.419 0 0.161 0 0","m99.8 53.3c-0.222-0.982-0.895-2-1.24-2.87-0.525-1.31-1.29-0.933-1.64-2.44 0.694-2.46 0.261-4.17-0.359-5.33-0.468-0.879-1.03-0.394-1.51-1.15-0.357-0.564-0.291-1.79-0.667-2.33-0.409-0.58-2.02-0.415-2.14-2.28-0.153-2.47 1.58-0.537 1.8-1.87 0.458-2.77-2.47-4.29-2.74-4.49-0.839-0.633-1.81-0.889-2.65-1.69-0.266-0.254-0.474-3.08-0.84-1.47 0.0506 0.58 0.521 1.49 0.0823 2.03-0.119 0.148-1.45-0.529-1.55-1.14-0.658-3.83 1.4-2.91 1.59-3.72-0.515-1.76-0.969-0.0568-1.32-0.542-0.525-0.727-1.07-2.89-1.6-3.8-1.33-2.31-2.82-2.93-4.34-4.73-1.07-1.26-2.92-3.32-4.08-3.61-0.178-0.0449-0.744 0.978-0.846 0.923-0.155-0.0872-0.399-1.6-0.502-1.69-0.91-0.842-1.98-0.533-2.74-0.57-3.36-0.165-7.59-3.2-10.8-4.7-1.4-0.645-2.38-2.73-3.94-2.74-0.945-0.00793-1.42-1.72-2.51-1.29 0.137-0.0529-0.391 0.595-0.261 0.576-0.581 0.0846-1.03-0.905-1.64-1.18-0.539-0.247-1.66-1.45-2.22-1.08-0.463 0.299-0.293 2.06-0.969 2.27-0.198 0.0608-0.0637-1.16-0.231-1.29-0.277-0.213-0.676-0.345-1.03-0.337-0.202 0.00529-1.18 0.0806-1.37 0.234-6e-3 0.00529-0.523 1.1-0.463 1.09-0.504 0.131-1.43-0.387-2.21 0.221-0.276 0.217-0.447 1.2-0.76 1.22-0.267 0.0172-0.371-1.42-1.11-1.14-0.446 0.173-1.61 0.597-2.02 1.15-0.53 0.708-0.251 1.85-0.845 2.3 0.163-0.124-1.07-1.08-1.11-1.08-1.11-0.156-2.29 1.98-3.45 1.94-3.43-0.13-7.31-1.43-11-1.43-3.81-0.00529-7.57-0.776-11.1 4.62-1.58 2.42-2.7 7.8-3.59 14.1-0.674 4.77-1.51 6.14-2.69 8.35-1.21 2.29-2.44 4.54-3.43 8.04-0.237 0.833-0.178 2.94-0.391 3.45-0.342 0.831-0.921-0.0753-1.25 1.19-0.9 3.49 0.334 4.96 0.334 8.6-1.23 0-2.06 4.43-2.35 8.95-0.348 5.51 0.0015 7.11 0.391 11.8 0.48 5.75 0.197 10.7 1.99 9.21 0.259-0.211 0.577-1.04 0.75-1.15 1.03-0.645 1.28 1.5 2.19 1.39 1.67-0.21 3.55 1.13 5.29 0.866 0.465-0.07 1.01-0.152 1.59-0.529 0.935-0.604 1.04-0.0476 1.95-0.0013 1.01 0.0502 2.05-0.703 3.12-1.15 0.525-0.219 0.377-1.12 1.07 1.85 0.312 1.35 0.795 4.22 1.13 4.95 1.28 2.83 3.7 0.615 4.95 0.601 2.27-0.0251 4.41-0.519 6.6-1.07 4.14-1.05 7.82 2.27 11.7 5.16 7.2 5.42 15.2 6.73 22.2 4.62 2.2-0.662 4.52-0.765 6.68-1.73 0.374-0.168 0.922 0.176 1.17-0.555 0.285-0.83 0.0248-2.91 0.483-3.36 0.237-0.234 0.38 2.55 0.34 2.49 0.289 0.386 0.559 0.531 0.906 0.843 0.439 0.395 1.52 0.533 1.82-0.575 0.295-1.07 0.0634-4.08 0.274-4.94 0.723-2.96 0.749 1.29 0.899 2.06 0.231 1.19-0.717 6.43 1.24 3.45-0.0542 0.0833 0.936-1 0.586-1-0.102 0.0013 0.0368-1.3 0.194-1.24 0.0703 0.0238 0.626 1.96 0.804 2.19 0.32 0.414 1.43 0.514 1.74-0.225 0.641-1.55 0.382-3.17-0.261-3.17 0-7 0.472 1.02 0.652-3.17 0.122-2.85-0.465-1.27-0.261-4.18 0.275-3.93 1.14-3.1 1.3 0.447 0.0431 0.956-0.688 8.19-0.315 9.78 0.245 1.05 2.91 0.379 3.2-0.806 0.519-2.11-0.047-4.61 0.434-6.15-0.191 0.608 0.924 1.41 0.952 1.4 0.323-0.141 0.514-1.34 0.855-1.83 0.163-0.233 0.644-0.233 0.863-0.406 0.0838-0.0661 0.111-1.22 0.201-1.39 0.328 1.31 1.56-0.0952 1.95-1.17 0.394-1.09 0.311-3.01 0.782-4.6 0.317-1.07 0.976-0.829 1.37-1.17 0.387-0.33 1.48-1.45 1.69-2.57 0.902-4.65-1.65-1.13-0.458-6.64 0.539-2.49 1.11-1.13 1.55-1.46 0.102-0.074 0.737-1.9 0.987-1.99 0.349-0.115 1.65 1.93 1.3-2.06-0.447-5.15-5.27-0.843-4.06-11.4 0.0844-0.732-0.581-1.11-0.626-1.24 0.0087-0.0793 0.53-2.4 0.518-2.37 1.12-2.61 0.42-0.43 0.782 1.77 0.223 1.36-0.268 2.09 0.391 2.31 0.0583 0.0198 0.622 0.141 0.759-1.05 0.0464-0.403-0.513-1.73-0.0634-3.17 0.0906-0.289 0.308 0.572 0.477 0.48 0.239-0.13 0.742 0.634 0.977 1.44 0.351 1.2 0.488 2.54 0.912 3.17 0.327 0.48 1.43 0.552 0.849-2.03","m100 70.7c-2.05 0-4.47 0.583-6.74 0.583 0-1.06 0.507-2.47 0.691-3.05 0.278-0.868 0.751-0.65 1.1-3.23 0.106-0.793-0.298-1.88 6.31e-4 -3.3 0.178-0.848 0.477-1.02 0.616-1.51 0.178-0.619 1.88-4.67 0.484-4.67 0.0935-2.19 1.85-1 1.79-3.05-0.0199-0.669-4.63-1.03-5.09-1.03 0-2.4 1.23 0.0067 1.38-1.17 0.198-1.55-1.84-1.14-2.06-1.95 0.197-2.48 0.21 0.257-0.149-2.51 1.22-4.87 2.85-2.24 4.26-5.72-0.437-1.63-1.96 0.699-2.52 0.844-1.01 0.263-3.25 1.45-3.93-1.45 0.341-1.51 2.38-0.835 2.45-1.67 0.173-1.94-2.49 0.438-2.59-2.13 0.214 0.276 0.347-1.78 0.195-2.33 0.187 0.677-1.11 0.0415-1.02-1.17 0.222 0.415 0.361 0.224 0.417-0.575 0.0032-1.22-1.49-1.76-1.65-1.76 0-3.02 3.1-4.72 3.56-4.96 0.847-0.457 1.96-1.24 2.76-1.46 0.385-0.103 0.961-0.513 1.24-0.583 0.507-0.129 0.96 0.197 1.39-0.462 0.238-0.363-0.0464-1.29-0.154-1.29 0-0.69 1.19-3.27 1.38-3.5 0.583-0.717 1.61 0.536 2.05-1.42-0.231-1.12-2.6-0.844-2.98-0.915-1.03-0.198-1.96-0.0737-2.9-0.584-1.78-0.958-3.47-1.18-5.24-2.33-2.94-1.91-5.92-4.57-9.01-5.84-3.49-1.43-7.1-2.5-10.6-3.36-3.93-0.955-8.13-2.83-12.2-3.06-5.69-0.319-11.1 0.304-16.6 0.581-3.54 0.18-7.63-0.19-11.1 1.75-6.74 3.72-13.8 3.03-20.6 8.16-1.03 0.785-6.54 6.35-4.41 12.3 0.323 0.894 0.957 0.67 1.18 1.46 0.164 0.592 0.653 4.39 0.622 5.54-0.0515 1.88 0.235 0.908-0.162 2.92-0.104 0.527-0.92-0.596-1.01 0-0.355 2.33 1.09 1.17 1.38 1.17 0 2.75-1.41 0.604-1.63 2.54-0.0281 0.253 3.11-1.18 2.81 2.48-0.174 2.15-1.44-1.28-1.71 1.01-0.042 0.351 1.37 1.12 1.49 0.974-0.0164 0.435-2.6 1.17-2.89 1.17-0.0591 0.839 0.425 1.5 0.553 1.95-0.0733 3.26-1.97-1.13-1.35 3.89 0.429 3.44 1.44 1.54 2.03 3.22-0.466 2.72-0.449 0.758-0.358 4.36 0.0426 1.68 0.826 0.379 0.131 2.93-0.331 1.21-1.79 1.21-2.32 1.16-0.837-0.0831-1.74-1.01-2.41 0.86-0.0983 0.275-0.437 1.73-0.478 2.06-0.0822 0.683-0.0551 4.04 0.136 4.66 0.265 0.87 0.81-0.186 1.03 0.583 0.541 1.88-0.039 3.51 0.213 5.25 0.131 0.906 0.861 3.81 1.02 4.67 0.125 0.651 0.453 1.91 0.626 2.97 0.238 1.46 0.149 2.49 0.453 3.64 0.538 2.03 1.36 2.26 1.95 4.22 0.445 1.48 0.55 2.45 1.08 4.05 0.662 2-0.197 2.02 1.07 2.53-6e-3 -0.0027 0.195-1.08 0.231-1.06 0.559 0.212 3.32 2.34 3.26 2.61 0.155 0.892 0.545 0.0603 0.545-0.868 0.676 0 1.29 1.43 1.99 1.75 0.307 0.142 0.547-0.367 0.973 0.591 0.194-0.938 1.37 0.549 1.71 0.573 0.666 0.0469 2.56 1.51 3.07-0.482-0.758 2.95 1.86 1.32 1.74 1.35 0.549-0.161 2.53-1.01 2.67 0.311 0.365-1.47 2.73-1.46 3.31-1.76 0.889-0.457 1.8-0.135 2.48-0.587 1.19-0.792 2.3 0.0335 3.3 0.583 0.626 0.346 2.18 0.36 2.63-0.683 0.648-1.48 0.0287-0.238 0.737 0.1 0.689 0.328 0.977 0.0188 1.55-0.106 1.88-0.407 4.11-0.421 5.81-0.478 2.13-0.071 4.71 0.647 6.88 0.584 1.07-0.0322 1.83-0.41 2.81 0 1.04 0.433 2.14-0.644 3.13-0.584 5.39 0.33 10.9 0.381 16.8-0.587 2.62-0.427 6.2-0.0094 8.72-0.0107 0.85 0 8.17 1.09 8.17 0.0147 0-0.486-1.84-1.2-1.95-1.17-0.326 0.0804-0.779 0.439-1.41 0.0871-0.554-0.312-1.19-0.411-1.74-0.382-0.263 0.0147-0.815 0.494-1.16 0.296-0.233-0.135-0.509-0.922-0.673-1.07-0.243-0.221-0.278 1.36-0.504 1.07 0.0322-0.528-0.0136-0.916-0.138-1.17 0.103-2.21 5.93-0.615 6.33-0.583 0.311 0.0241 0.637-0.506 1.01-0.513 0.649-0.0121 0.9-0.0027 1.6 0.21 1.37 0.417 2.85 0.0322 4.46-0.281 0.237-0.0456 4.69-4.83 3.85-7.59h-1.03c0-1.62 1.2-14.6 1.1-14.6","m99.8 27.2c-0.424-0.0797-0.901-1.76-1.28-1.76-0.0254-0.33 0.808-0.982 0.404-2.11-0.397-1.11-1.84-0.423-2.35-0.769-0.287-0.195-2.4-1.19-2.38-2.05 0.119-4.51 4.61 0.485 5.05-1.76-0.514-2.13-1.48-1.4-2.22-1.4 0-2.22-0.403-0.361-0.741-1.46 0.108-0.187 0.156-0.47 0.143-0.849-2.96 0-5.81-0.985-8.67-2.31-1.33-0.613-1.89-5.22-3.39-6.39-3.09-2.42-6.15-4.62-8.99-5.32-1.56-0.383-3.24-1.37-4.67-0.994-1.83 0.485-4.04 1.03-6.09 0.575-1.37-0.306-2.96 0.595-4.48 0.692-1.35 0.0849-3.17 0.0782-4.62 1.57-0.657-2.53-1.6-0.296-2.15-0.236-1.02 0.111-1.63-0.305-2.63 0.245-1.36 0.752-3.14-0.602-4.48 0.0265-2.85 1.33-5.73-0.886-8.82 0.172-0.96 0.327-2.28 1.17-3.65 1.57-0.969 0.286-1.54 0.786-2.34 1.18-0.906 0.448-1.86 0.774-2.76 1.42-6.35 4.57-12.9 0.22-19.3 2.04-1.44 0.407-2.84 0.504-4.23 1.13-0.909 0.408-2.44 0.445-3.27 2.03-1.68 3.19 0.00137 6.81 0.649 10.4-0.0999 0.356-0.431 1.02-0.45 1.5-0.127 3.19 0.348 0.693-0.247 2.84-0.813 2.94-1.29 0.578-0.799 6.14 0.057 0.644 0.623 4.2 0.568 5-0.0522 0.753-0.505 1.81-0.488 1.57-0.0302 0.448-0.346 0.577-0.379 0.847-0.221 1.82 0.364 2.24 0.443 3.53 0.163 2.64 0.143 2.63 0.304 4.58 0.0288 0.353 0.521 5.02 0.47 4.67 0.123 0.836 0.735 3.34 0.73 4.02-0.0203 2.57 0.0831 0.391-0.542 0.79-0.572 0.365-1.49-2.76-1.98-0.338-0.417 2.06 0.251 3.04 0.422 4.38 0.247 1.94 0.716 4.08 0.749 6.3 0.0079 0.501-0.509 3.08-0.445 4.13 0.113 1.86 0.653 2.33 0.957 3.38 1.27 4.37 2.27 6.22 3.94 7.01 0.985 0.467 2.03 0.865 2.98 1.8 0.335 0.33 0.0755 1.96 0.419 2.24 0.185 0.155 1.84 0.0529 1.96 0 0.973-0.473 1.68-0.429 3.02 0 0.721 0.23 1.76 1.53 2.52 1.74 1.07 0.286 2.79-0.28 4.1-0.0066 0.216 0.0451 0.91-0.214 1.09 0-0.0436-0.0528 0.766 1.35 0.56 1.45-0.232 0.112 1.25 0.115 0.593-0.831 0.443 0.642 0.0642-0.735 0.666 2.29 0.268-0.352 0.396-0.936 0.384-1.75 0.223-0.0663 0.658 2.37 1.01 2.31 0.663-0.111 1.17-6.31 2.14-2.55-0.36 1.22-0.833 1.77-0.453 3.71 0.117 0.601 1.43-0.676 1.64-0.576 1.24 0.585 1.59 5.08 1.72-0.383 0.0199-0.836-0.982-0.239-0.272-2.02 0.525-1.32 0.395-0.719 0.799 1.12 0.569 2.59 0.118 2.87 0.848 3.49 0.0663 0.057 0.949-0.649 1.25-0.472-0.0052-0.0025 0.26 2.24 0.413 2.31 0.188 0.0918 0.629-1.18 0.783-1.73 0.286-1.02-0.0464-4.08 0.449-2.6 0.0965 0.289-0.0481 2.58-0.125 2.22 0.0797 0.38 0.0563 2.5 0.125 2.69h0.965c0.232-1.6 0.458-1.5 0.678 0.298 0.405 0.108 0.552 1.13 1.05-0.559-0.147-1.06-0.854-3.78 0.148-3.78 0.136 2.1-0.369 1.94 0.338 4.04 0.393 1.17 0.889 2.45 1.37 0.66 0.498 1.41 0.217 1.33 0.801 0.727 0.142-0.147 0.75-2.14 0.931-1.97 0 4.1 2.17 2.04 2.54 2.01 0.249-0.0162 1.56 0.803 2.32 0.874 2.12 0.195 4.63-1.38 6.58-1.76 4.35-0.857 8.64-4.07 12.7-8.08 2.22-2.2 4.46-2.95 6.75-4.69 0.975-0.738 2.14-1.78 3.19-2.22 1.01-0.425 2.19-0.238 3.16-1.46 0.674-0.85 1.01-2.23 1.63-2.59 0.341-0.196 0.247-0.028 0.559-0.578 0.325-0.573 0.145 1.83 0.712 0.569 0.217-0.484-0.0793-2.04 0.186-2.38 1.11-1.43 2.27-2.56 3.33-3.39 1.89-1.47 3.37-1.6 4.87-3.95 0.511-0.795 1.15 0.0663 1.88-0.682 0.08-0.0807 0.778-1.77 0.794-1.83 0.236-0.955-0.325-1.44-0.19-2.05 0.323-1.46 0.823-1.7 1.16 0.121-0.147 0.336-0.196 0.819-0.146 1.45 1.8 0 0.349-0.581 0.475-1.54 0.399-3.04 1.5 2.23 0.921-3.07-0.0776-0.707-0.819 0.336-0.798-1.16 0.023-1.57 0.87-1.57 0.875-1.52-3.43e-4 -0.0016-0.379-0.86-0.426-0.789-0.0367 0.0554 0.6-0.859 0.748-1.15-0.0295 0.0597 0.538 0.578 0.509 0.578 0.531-1.15-0.379-1.15-0.359-1.15 0-5.03 0.0604-0.135 0.443-2.61-1.07-4.54 2.74-1.35 2.55-3.74 0.0384-0.735-1.46-1.12-1.58-1.17-0.464-0.222-1.29 0.0766-1.71-0.561-0.331-0.501-0.167-2.18-0.434-2.89-0.167-0.444-0.764-0.573-0.912-0.573-0.0494-0.639 3.26-3.61 3.74-6.35 0.528-3.01-0.161-1.63-0.0978-2.89 0.133-2.63 0.383-0.765 0.981-3.13-0.197-0.795-0.733 0.349-0.733-1.49 0.699 0 0.584-2.56 1.02-3.23 0.346-0.529 1.93 0.978 2.11 0.028-0.07-0.271-0.14-0.542-0.21-0.814-0.0488-0.0082 0.07 0.272 0 0","m56.2 0.033c-6.56 0.319-13 1.11-19.5 2.25-5.03 0.299-9.75 2.39-14.7 3.09-4.09 0.76-8.61 0.178-13 1.04-1.22-2.13-2.78-8.81-5.88-3.41-0.677 4.57-2.49 8.64-2.05 13.3-0.451 9.45-1.52 18.9-1.1 28.4 0.228 7.65 0.318 15.3 0.623 22.9 0.363 4.12 0.337 8.49 1.06 12.4-0.0369 4.8 0.938 9.31 1.75 13.9 0.288 2.65 2.83 8.99 4.56 3.44 2.76-1.65 1.7-5.79 4.37-7.23 0.56-4.09 3.84-0.429 6.06-2.14 2.53 2.05 2.02-5.08 3.28-0.435 2.17-1.26 5.36-3.26 7.12-3.59 1.78-0.77 1.23 0.454 1.6-0.802 0.711 1.66 3.54 1.4 3.93 3.88-0.111-6.19 3.06 3.77 6.73 0.248 3.28 3.78 3.05-3.14 3.7-2.48 3.85-1.51 1.84-6.81 4.16-8.85 0.721 2.38 3.3 3 4.14 0.157 0.731 6.1 3.22-5.43 4.25 0.361 1.78-0.333 2.99 3.12 4.79 0.705 1.9 2.58 5.1 0.637 6.91 2.42 0.591-2.83 0.996 2.83 1.58 0.163-0.0621 3.73 3.64 3.93 3.73-0.178 0.303 1.65 0.703 4.36 1.63 1.21 1.47 3.36 3.43-1.4 3.28 3 1.25 1.4 1.13 2.21 2.44 1.29 1.48 0.725 0.975 1.98 1.91 0.0674 0.336 0.999 0.806-1.03 1.94 0.968 1.41-1.29 1.98 0.987 3.4-1.59 1.13 1.5 2.08 3.72 2.1 2.14 2.22 2.55 2.52-4.81 3.06-6.76 2.32-2.21 0.624-5.66 0.466-8.57 0.17-1.77 1.25-3.32 1.08-5.19 0.619-0.635 1.08 1.06 1.04-1.83 0.513-1.47-0.667-3.65 1.21-5.57-0.537-2.93-0.601-7.87 0.796-7.23-0.682-1.42-1.9-2.1-0.372-3.44 0.642-1.35-0.373-3.97 1.42-3.17-0.289-4.17 0.257-7.83 0.167-12-0.456-4.06-0.163-7.74-0.734-12.1-0.691-3.19 2.33-8.31-1.81-10.1-2.59-1.64-7.45-4.76-8.93-4.68-4.01-0.18-9.63-4.07-12.9-2.21-2-3.23-7.51-1.74-10.9-3.1-2.82-0.278-5.66-0.531-8.49-0.64","m99.9 59.9c-0.429-4.47-0.0208-8.78-1.82-12.8-3.51-4.83 4.14-9.21 0.0086-14.4-2-3.02 3.77-5.44 0.34-7.9 0.494-0.405 0.665-4.2-1.1-3.48-0.446-2.97-4.58-1.1-3.65-5.85-0.691-3.24-2.44-6.98-4.15-7.98-2.1-1.3-2.98-0.0809-5.09 0.394-1.55 1.89-3.26 2.22-5.16 1.69-1.63-0.518-3.75 0.667-4.78 0.566-2.67-0.49-4.87-0.175-7.08 2.25-3.03-0.327-2.67-8.46-6.19-9.93-1.97-3.78-5.31-2.72-7.74-0.973-2.85 0.63-4.4 4.33-6.57 5.6 0.531 2.94-2.6 2.41-1.63 5.27-0.697 1.57-1.07 3.8-2.57 4.01-0.43 0.445-2.1 2.7-2.5 3.19-1.28 0.245-3.51 1.67-3.47 0.213 1.15-1.07-2.13-0.0342-1.28 0.685-1.64-2.25-2.77-3.92-3.85-4.75-0.204 1.99-3.21-1.12-2.73-3.03-0.394-2.08-1.98-0.629-2.93-2.09-1.85 0.617-2.35-2.39-4.13-2.2-2.29-2.49-0.997 2.36-2.6 0.848-3.69-1.58 3.2-0.901-0.826-1.9-1.39-0.0212-2.12-2.89-2.41-1.48 1.28 1.14 0.165 2 1.64 2.31 0.995 3.29-2.34-0.449-3.55-1.63-0.874-0.598 2.09-0.28-0.0556-1.22-2.17 0.249-5.21-2.49-6.77-1.79-0.53-0.149-1.73 2.25-2.9 2.83-1.8 0.753-2.27 4.57-2.74 6.74 1.07 0.208-2.14 2.69-0.139 3.32-1.68 0.0341-1.04 6.3-1.46 8.25 0.00219 2.17-0.114 4.42 0.225 6.19 0.677 2.54 1.3 3.07 2.59 5.42 1.55 3.05 5.97 1.74 8.6 2.5 0.0223-1.58-3.25-0.0475-4.74-2.5-0.0458-0.298 0.105-1.68-0.224-2.45 1.45 0.536 4.37 0.187 0.951-0.121-1.61-0.444 0.726-1.06 0.343-2.19 2.84 0.364-1.46-3.11 1.41-1.01 0.239-0.745 2.54 0.93 2.45-0.0821-1.93-3.05 2.42 2.4 1.49 0.0405 0.337-1.54 2.62-0.292 3.67-0.272 1.85 0.0829 2.43 0.202 3.98 0.76-0.0615 0.618 4.33 1.47 0.663 3.43-3.07 1.17-5.25 3.19-8.23 5.11-2.81 2.09-5.65 5.13-6.71 9.26-1.05 4.27-3.19 8.41-2.01 12.5-0.482 2.44 1.32 4.39-0.938 5.97-2.67 3.49 3.93 6.97 1.12 8.63-0.752-0.662-2.34 4.31-3.1 6.72-0.875 0.844-0.966 4.32-1.08 6.66-0.522 3.04 1.13 6.87 1.43 6.14-0.344 2.44 1.89 3.56 2.78 4.37 2.95 0.334 5.14-0.012 7.96-0.3 1.02-0.116 7.99-0.679 4.58-1.12-1.9 0.568-2.99 0.0635-5.06 0.801-1.98-0.0719-4.46 0.428-6.1-0.464-0.796 0.74-1.37-4.01-0.198-2.79 2.25 1.83-1.25-2.48 1.87-1.7 2.83-1.14 4.91 0.361 7.29-1.18 1.92-0.779 1.23 2.38 3.34 1.57 1.86-1.03 4.08-0.352 5.76-1.37 1.4 1.48-2.71 1.81-1.91 2.31-0.927 1.28 1.61-0.304 1.95-0.506 1.23-0.0631 3.46 0.0403 1.56 1.08-1.62-0.0129-2.25 0.632-3 1.03 2.68 0.946 7.52-1.75 10.8-3.01 2.65-1.18 5.1-3.02 7.15-5.06 2.36-5.25 5.56-0.448 8.86-0.121 1.37-1.21 2.66-1.1 4.4-1.55 0.0892-2.14 2.74-0.396 2.11-0.787-0.0946-1.83 0.691-1.11 1.92-1.52 2.09-0.0898 4.48 1.08 6.41 2.77 0.362-1.34 0.846 2.11 1.13-0.268 0.968 1.25 3.49 3.2 3.65 5.21 1.01-1.45 3.64 1.9 4.08-0.694-0.271-2.53 0.909-6.22 1.15-8.6-0.134-3.46-0.858-9.05-2.99-11.5 0.199-4.15-5.82-5.99-4.68-8.3 1.36 0.976 6.53 3.06 6.34 2.09-2.25-1.37 2.82 0.187 3.62-0.395 2.17 0.514 2.34-0.687 4.81 0.371 2.47-0.21 3.34 0.831 5.7-0.0719 1.08 0.698 2.23-0.448 3.18 1.26 3.06 0.249 2.31 4.17 5.36 0.16 1.82 0.597 1-1.72 2.12-2.56 0.35-0.647 1.28-2.82 1.43-2.46 0.562-0.194 0.836-1.5 0.614-2.24","m99.8 79.3c-1.23 1.28-2.8 1.6-2.71-2.33-0.874 2.34-1.77-2.61-0.384-1.35-0.913-2.54-2.97-0.585-1.54 1.35-0.496-1.88-4.34-1.08-1.8-3.3-0.392-2.5 2.06-5.51 0.458-7.36 2.23 0.0233-1.16-3.53 1.66-3.13 0.976-4.27 1.61-7.65 2.54-10.9-0.918-1.03 0.492-4.21-0.889-3.83 1.26-2.54-1.66-1.5-0.197-4.16-0.239-4.15-0.939-7.77-1.87-11.8-1.58-7.17-5.22-10.5-8.2-15.2-1.74-2.23-5.4-4.65-6.26-5.48-0.845-1.88-2.96-1.74-4.16-3.92-0.963-1.67 1.65 3.7-0.523 0.815-1.12-2.24-2.85 1.85-2.98-2.14-1.31-1.61-4.23-3.32-5.55-1.8-1.35-3.46-3.65-0.563-5.08-2.75-1.37 0.15-1.43 0.812-3.27 0.0912-0.8-0.479-3.38-4.46-3.03 0.259-1.56 0.0992-2.49-3.03-3.33 0.506-1.32-0.386-2.76-2.34-3.8-2.61 1.48-0.779-3.9 0.356-0.338 0.951-1.41 0.994-2.97-2.17-1.86 1.46-1.74 0.622-5.09-1.66-2.91-1.2-1.4-2.06-1.98 1.32-3.26-1.26-0.679-0.164 0.482 2.12-1.26-0.0521-0.111 2.63 3.46 2.95 1.05 3.72-0.366 2.68-2.17-7.37-2.62-1.92 3.35 5.38-5.4 2.82-0.71 2.85 1.03-0.871-0.364-0.422 0.205-1.98-1.71 1.42-3.3 1.78-3.02-0.928-0.314 0.993-2.58-0.631-3.25 1.06-1.36-1.31-3.83-0.359-4.09 1.87 0.109 2.08-4.2 1.16-1.38 1.87-0.768 3.09-2.3 0.448-2.59 1.81-0.0473-3.64-2.18-2.31-0.257-0.0301-0.4 2.61 0.264 4.08-1.29 1.17-1.11 1.41-3.49-1.06-3.28 2.56-1.32 0.226-2.8-2.86-3.12 2.33-0.132-5.07-1.49 0.898-3.15-1.67-1.97 1.34-0.959 5.64-2.79 3.3-1.45 1.59-2.56 2.9-0.0603 1.39 0.498 3.59 3.38-2.18 1.75 1.61-1.73 0.89-3.63-0.669-4.79-0.0128-0.534 1.76 0.746 0.52-1.52 2.29-1.55 2.33-0.801 3.98-2.57 5.16 1.49 2.66 0.664 1.18 1.96 0.066 0.434 2.2-0.976 5.15-0.955 2.48-3.51-4.16 1.35 4.45-2.06 2.94-0.618 1.66 1.58-0.0786 0.436 2.27-1.8 4.07-1.17 9.35-0.621 14 0.402 2.92-0.0393 3.11 0.497 3.64-0.331 2.66 0.431 3.91 0.22 6.05 0.719 0.111-1.02 2.41 0.871 4.3-0.0436 3.58 0.613 6.96 2.21 9.59 2.35 1.7 3.41 4.1 5.51 4.43 1.39 5.72 5.4 7.3 8.07 10.4 2.82 3.17 6.86 4.01 9.36 6.34 1.84 0.142 3.4 1.4 4.74 1.79 1.58 0.552 2.87-0.366 2.07 1.17 2.6-0.306 3.43 1.66 6.02 1.37 2.78 1.87 6.31 1.85 9.12 1.73 2.8 2.46 4.38-1.47 6.07 0.698 3.54-0.298 7.35-0.155 11-1.52 2.47-0.667 5.1-1.55 7.58-1.95 1.75-0.981 3.32-0.539 5.03-0.831 2.11-0.536 3.45-1.66 4.62-1.14 1.99-2.58 4.23-0.53 6.26-3.67 0.324 2.76 3.77-2.67 4.44-1.66 0.644-1.53 1.18-3.73 1.15-1.54 1.53 8.08e-4 -0.0866-2.07 2.03-2.28 0.463 1.49 3.36-3.95 2.43-5.98","m64.2 0.539c-3.04 1.13-4.28 1.48-7.29 2.16-2.93 0.926-5.25-0.384-6.34 3.44-0.19 2.45-1.8 3.55-3.03 6.32 0.108 3.53-5.56 3.56-2.35 1.79-2.19-2.65-6.04-3.21-9.46-3.61-3.18 0.962-5.72 1.02-7.97 2.44-2.01 1.05 1.32 1.78-1.55 2.46 0.234 4.66-4.92 2.17-7.55 4.76-2.35-0.93-5.47 1.08-4.9 1.17-1.32-0.158 1.23 3.18-1.62 2.75-1.76 1.03-4.26 2.49-2.67 3.79-2.22 1.65-3.12 5.44-4.02 9.36-1.42 3.27 0.484 7.57-1.55 9.1-0.778 3.13 0.0511 6.82-0.816 8.38 0.33 1.07-0.709 2.21-0.265 3.18-2.15 0.906 0.318 3.89-0.247 4.91-1.03 3.9-0.923 5.95-1.73 8.36 0.35 1.94 0.102 5.22-0.347 6.91-1.12 2.26 1.43 6.21-0.447 6.94 0.0358 3.06 2.24 1.14 1.15 3.73 1.52 2.36 2.73 3.76 5.62 6.23 0.927 0.525 4.32 4.39 7 4.89 1.62-1.38 3.94-3.44 5.19-6.32 2.59-0.889 5.01 2.84 6.32 1.6-0.752 1.86 3.63 0.13 4.68 2.69 0.384 0.0568 1.7-1.95 1.51-0.607-2.51 2.91 3.17 1.17 2.3 0.963-0.257 2.72 3-0.793 3.03 0.11 1.77-0.129 0.96-2.42 2.31-0.695-0.726-0.685 1.65-3.56 1.86-1.19-0.799-3.27 2.71-5.48 3.01-8.76-1.44-0.786-8.22 1.44-2.83-0.345 2.9-0.209 4.13-0.42 5-2.82 2.54 1.85 4.65 3.55 6.86 4.37 1.83-1.33 1.82 0.143 1.01 1.35 3.12-2.09-1.13 1.54 2.65 0.572 2.27 2.39 4.95 1.27 7.51 0.842 1.54-1.6 3.05-0.883 3.72-3.58-0.856-0.757 2.88 0.329 2.85-2.42 0.71-2.56 4.67-2.24 3.75-3.73 1.09-0.163 2.86-4 4.19-1.51-0.912 1.37-3.02-1.52-2.18 1.38 2.59 0.157 2.94-3.7 5.31-3.46 0.195-0.817 1.5 2.01 0.332-0.81-3.65 0.277-0.695-3.85 0.926-1.84 1.51-1.34-0.182-2.91-1.26-1.47-3.11-0.966 2.58-1.69 3.22-2.65 0.724-0.837-3.99-0.537-1.15-1.43 0.207-0.0239 2.33-2.25 0.396-2.21 1.75-1.03 0.404-2.77 3.06-1.65-2.13-1.35 4.25-1.89 0.951-3.16 2.05 0.115 0.407-1.17 1.51-2.55-1.23-1.97-0.913-2.48 0.164-3.68-3.58-1.14 3.32-3.83 0.162-0.809 1.43 1.04 2.96-3.68-0.242-2.09-0.637-0.992 4.45-0.246 0.689-1.5 2.7-2.59-2.1-0.753 0.177-3.6 1.07-1.15 2.59-1.79 2.61-3.95-0.219-1.26 0.806-4.08 0.025-4.69 1.09-0.882 1.92-1.99 2.06-3.32 0.889-0.326-0.453-2.78 1.45-1.56-1.42-2.04 0.433-2.61-0.0815-4.94 2.65-1.48-2.48-2.36 1.4-2.28 1.12-1.01 2.32-4.78 1.59-5.76 1.2-1.01-3.05-1.28-0.352-2.6-0.95-0.331-2.6-0.781-0.343-1.39-1.22-3.04-2.16 1.36-2.79-1.89 0.717-0.51-2.24 0.659-1.16-0.68-1.36 1.93-4.2-1.53-2.41 1.45-1.39-1.07-3.78 0.856-1.96-2.22-1 0.261-2.11 1.78-4.01 1.33-2.63 1.47-3.27 0.8-6.2 1.05-1.86-0.919-0.729 1.95-3.33 0.295-4.17 1.08-1.6-5.9-2.7-8.54 0.219-2.95-1.7-5.27-4.39-5.74 0.0318-1.12-0.108-0.55 0.847-2.61-0.53-2.2-3.05 2.19-4.21-0.651-0.985 1.5-1.5-1.46-2.61 0.229z","m97.3 57.2c-3.41 0-4.74-6.08-8.05-6.1-1.29-0.795-3.87-0.991-2.73-2.24-0.461 0.105 4.07-1.76 2.58-2.95-0.276 0.0469-1.66-4.4-1.88-1.47-1.36-0.391-1.07-2.36-1.27-1.62-1.62 0.0399 8.03-1.15 6.51-0.797-1.78 0.597-1.31-1.57-2.35-2.4-0.458 0.327-4.94-0.923-1.01-0.854-0.831-1.1-0.472-1.75 0.0586-4.04 0.533-1.89-2.5 0.207-0.825-1.39-0.89-1.75-1.09-0.904-1.57-3.06-1.16-0.951-1.78-1.03-2.84-1.14 2.11 0.151-0.32-2.08 1.08-1.45 0.421-0.661 8.25-3.23 7.96-4.94-1.57-1.95-1.71-0.0456-3.1-3.81 0.665 3.54-0.192 0.654-0.944-0.899-0.654-1.49-1.36-3.11-2.92-4.35-1.19-2.92-0.257 2.7-1.65-0.177-0.363-2.09-3.08 0.626-1.6-1.95 0.915-1.38 5.96-7.76 6.92-5.41-1.84-0.314 0.0411-0.555-1.4-2.01-2.65-0.62-0.587-2.27-2.83-1.94-0.891-1.13-0.313-0.513-0.368-1.36-1.07-1.02-1.2-1.36-1.13 0.396-1.83-0.483-2.44-0.812-3.45-0.308-2.32-0.0102-9.13-0.462-12-0.359-0.581 0.361-2.24 4.17-3.12 3.74-0.345 0.803-29-4.16-30.3-2.87 0.426-0.902-5.43-0.656-2.95-0.38-2.09 0.429-2.98 0.345-3.78 0.739-1.76 0.0938-2.27 3.72-3.7 3.74-0.875 1.71-1.59-0.443-2.57 0.925-1.59-0.0625-4.02-0.262-3.68-0.529-1.73 0.25-2.36-0.259-2.95-0.822-1.27 0.255-1.65-3.16-3.36-3.25-1.77-0.478-3.08 0.112-4.51-0.279-0.795-1.08-2.01-0.597-2.79-0.309-1.29 0.673-2.41-1.64-3.25-0.36 0.269 3.8-0.413 9.13-1.18 9.65-0.958 3.77 6.29 8.17 4.95 11.7 0.33 2.17-5.9 4.99-5.18 7.06-0.151 3 2.7 2.24 4.34 1.83 1.55 1.14 3.65-0.928 4.48 1.08 0.844 4.55-4.57 7.76-2.15 12.5 0.93 4.55 5.67 2.93 8.52 4.87 2.87 0.757 9.05 1.51 3.39 4.16-3.63 3.38-20 9.73-18.1 14.2 2.82 2.46 6.51 1.82 9.54 2.71 2.8 0.982 5.74 0.786 8.6 2.07 3.35 1.2-2.94 2.88-3.3 5.45-2.42 3.72-3.78 8.59-3.09 13.1-0.57 4.75 4.49 3.18 7.13 4.2 8.46 2.12 33.1 4.16 41.8 4.31 5.06 0.0968 10.1 0.248 15.2 0.179 2.56-1.15 5.94 0.664 9.04-0.886 3.42-0.389 7.19-1.46 10.3-3.45 2.26-1.65 5.26-6.01 3.7-9.75-1.99-2.48-3.9-6.12-4.74-8.06-1.1-2.55-3.59-3.99-5.43-5.01-1.16-0.584-3.28-0.481-4.21-0.804 1.7-2.1 14.6-5.56 14-9.31 0.303-2.06-0.0416-5.48-1.94-5.48z","m86.9 0.416c-2.65 0.408-5.71-0.589-8.11 0.475-3.02-1.44-6.37 0.199-9.03-0.782-1.92 1.65-4.94 0.317-7.17 0.0679-3.2 0.55-7-0.879-10.1 0.314-2.97-0.426-6.34-0.492-9.57 0.108-2.95 0.128-6.34-0.391-8.93 0.331-2.24 0.0952-4.71-0.758-6.98 0.496-3.21-0.616-6.48-0.693-9.53 0.357-2.98 0.795-5.03 3.75-7.08 7.64-2.73 2.45-6.1 3.3-7.82 8.86-0.445 0.677-3.29-2.09-2.51 1.37 3.26-1.21-0.803 8.33 2.38 10.4 0.42 6.11 3.88 6.35 6.25 6.63 2.29 1.75 5.76-1.33 7.03 3.1-1.79 2.08-4.22 2.77-6.05 4.95-3.39 4.3-4.2 11.5-2.08 17.9 1.85 5.04 0.776 12.6 2.91 17.4 1.53 2.54 3.71 2.13 5.02 3.42 3.52-1.88 2.62 7.15 5.18 8.6 2.6 2.27 5.67 1.43 8.43 2.78 2.92 0.673 5.36-0.13 8.13 0.67 2.73-0.475 5.51 1.53 8.19 0.136 2.71 1.99 5.7 0.76 8.48 1.13 1.47 0.551 3.01-0.468 4.52 0.174 2.15 1.32 4.49 0.423 6.78 0.366 2.48 1.8 5.74 1.69 8.46 1.47 2.86-1.03 5.56 1.22 8.36 0.503 2.47 1.6 5.08 0.104 7.27-0.656 0.0273-4.47 3.15-5.73 2.5-11.4 2.59-4.28 1.77-10.5 0.635-15.5-2.25-5.73-7.91-4.13-7.78-12.2-0.15-5.61 5.39-0.0295 7.76-2.7 2.57 1.77 5.55 0.341 6.09-4.8 3.49-3.55-0.732-9.66 0.471-13.6-1.53-2.77-3.79-5.59-6.39-4.86-1.83-0.569-3.35-0.944-2.87-5.04-3.26-3.66 2.44-4.1 2.02-8.61 3.91-6 0.769-13.5-2.16-17.9-0.935-0.187-1.76-1.25-2.72-1.66z","m0 97.2v-97.2h100s-1.64 4.67-2.14 7.16c-0.493 2.49 1.85e-4 0.623-1.07 2.18-1.07 1.56-1.97 2.18-2.47 4.05s-0.658 3.11-1.4 3.11c-0.74 0-1.32-0.622-2.14 2.18-0.822 2.8-0.904 3.43-1.81 4.36-0.905 0.934-1.07 3.43-1.64 5.3-0.576 1.87-1.07 2.18-1.97 4.05-0.904 1.87-2.38 3.12-3.04 4.98-0.658 1.87-1.48 4.67-1.73 6.54s-1.81 6.23-3.45 7.79c-1.64 1.56-3.37 2.49-4.03 4.05-0.658 1.56-1.07 3.43-2.06 3.74-0.987 0.312-6.09 9.35-7.98 9.03-1.89-0.311-4.19-0.312-4.44 2.18-0.247 2.49-1.89 2.18-3.95 0.623-2.06-1.56-3.37-0.623-5.51 2.8-2.14 3.43-2.88 0.311-3.62-0.623-0.74-0.934-4.11 1.25-5.35 2.49-1.23 1.25-2.06 1.56-3.37 1.56-1.32 0-3.21 5.3-4.19 5.61-0.37 0.117-0.821 0.102-1.27 0.0869-0.757-0.0243-1.52-0.0486-1.93 0.535-0.658 0.934-1.56 3.74-2.22 4.67-0.658 0.934-2.47 0.934-2.96 0.934-0.494 0-2.14-2.49-3.54 0-1.4 2.49-3.04 4.98-4.36 4.05-1.32-0.934-2.63-4.05-3.7-1.56-1.07 2.49-3.45 8.41-4.19 8.1-0.74-0.312-4.19-1.87-5.02-2.18-0.822-0.311-3.45-0.622-3.45-0.622","m0 100v-100s2.5 1.73 2.92 3.47c0.417 1.73 1.04 3.18 2.08 3.47 1.04 0.29 1.87 0.00176 2.81-0.288 0.937-0.29 1.98 2.02 3.02 2.6 1.04 0.577 3.44 1.15 4.17-0.29 0.729-1.44 1.46-1.16 2.29 0 0.833 1.16 2.19-0.867 4.48-1.73 2.29-0.867 3.54-4.34 4.69-2.6 1.15 1.73 2.71 4.62 3.33 5.2 0.625 0.577 0.729 1.73 2.08 4.05 1.35 2.31 3.75 1.16 4.9 0.867 1.15-0.288 3.65-0.867 4.06 0.867 0.417 1.73 3.54 11 5.83 11.3 1.15 0.146 1.98 0.0728 2.63 8.46e-4 0.65-0.072 1.12-0.145 1.54-8.46e-4 0.833 0.29 1.15 2.31 2.08 3.18 0.937 0.867 1.04 2.02 2.6 2.89 1.56 0.867 2.6-0.29 4.06-1.44 1.46-1.16 3.65-3.47 5.1-2.6 1.46 0.867 1.35-0.577 3.85 2.02 2.5 2.6 3.54 3.18 5.52 3.76 0.729 0.213 0.978 0.152 1.21 0.0902 0.397-0.106 0.743-0.211 3.37 1.07 4.17 2.02 4.9 0.867 6.77 0.867 1.88 0 6.04-0.867 7.4 0.29 1.35 1.15 3.96 1.16 4.9 0 0.937-1.16 2.29-1.73 2.29-1.73v43.9s-2.5-2.89-3.85-1.45c-1.35 1.45-2.81 2.89-3.75 3.76-0.937 0.867-2.71 2.02-4.17 2.02-1.46 0-2.08 2.02-4.06 2.02-1.98 0-4.58 0.869-5.83-0.577-1.25-1.44-2.19-1.44-3.85-2.6-1.67-1.16-2.92-1.15-3.85 0-0.938 1.16-5.21 2.89-6.25 4.34-1.04 1.44-3.02 2.02-3.85 2.02-0.834 0-3.85-2.6-4.48-2.02-0.625 0.577-4.58 2.89-6.04 5.49-1.46 2.6-3.33 2.89-4.9 2.89-1.56 0-3.13-0.29-5.1-1.16-1.98-0.867-7.71-3.18-8.33-2.89-0.625 0.29-1.77 2.89-3.85 4.62-2.08 1.73-4.17 2.6-5 2.6h-6.25c-0.312 0-2.92-0.577-4.06-1.16-1.15-0.577-1.77-2.31-2.71-2.89-0.937-0.579-0.938-2.31-2.6-1.16-1.67 1.16-1.56 0.867-3.33 2.31-1.77 1.45-3.85 4.62-3.85 4.62","m0 70.8v-70.8h100v97.9s-3.74-2.93-6.23 0c-2.49 2.93-2.74 2.56-5.24 0-2.49-2.57-4.24-1.83-7.23-2.57-2.99-0.732-6.98-1.46-7.48-3.66-0.498-2.2-2.24-2.93-3.74-2.2-1.5 0.733-6.73 0.366-8.23-0.733-1.5-1.1-1.5-3.66-5.24-5.49-2.08-1.02-2.69-0.34-3.49 0.339-0.64 0.543-1.4 1.09-3.11 0.76-3.87-0.733-5.36-3.3-7.11-3.3-1.75 0-4.24 2.56-7.48 0.733-3.24-1.83-2.49-3.16-7.23-3.41-1.67-0.0891-3.06 0.414-4.32 0.919-2.33 0.929-4.23 1.86-6.65-0.919-3.74-4.28-4.24-5.75-8.23-5.02-3.99 0.733-4.99 3.3-6.98 0.367l-2-2.93","m100 19.6v80.4h-100v-97.8s2.29-4.97 4.38 0c2.08 4.97 5.42 5.62 6.46 4.97 1.04-0.654 4.79-0.654 5.62-0.654 0.833 0 4.38 3.79 5 3.86 0.625 0.0667 1.88 0.585 3.54 0 1.67-0.586 3.96-1.38 4.58 0 0.625 1.37 2.08 3.99 3.13 4.64 1.04 0.654 1.67 0.654 3.54 0.654 1.88 0 4.58 1.99 6.04 3.94 1.46 1.95 1.25 0.64 3.75 5.87 2.5 5.23 1.46 11.1 3.96 8.82 2.5-2.29 2.71-0.327 5.21-4.25 2.5-3.92 2.29-3.92 4.79-5.88 2.5-1.96 5.83-6.51 6.56-4.56 0.729 1.95 3.65 2.6 5.31 3.25 1.67 0.654 1.67 3.27 3.96 1.31 2.29-1.96 1.04-4.55 4.79-4.56 1.26-0.0049 2.21 0.216 3.16 0.437 1.88 0.437 3.73 0.875 7.88-0.436 6.25-1.97 8.33 0 8.33 0","m0 0v100h100v-45.4s-4.66-9.87-7.4-4.61c-2.74 5.26-5.48 1.97-8.22 0-2.74-1.97-9.04-8.55-11.2-7.89-1.04 0.312-2.57-0.705-4.12-1.72-1.73-1.13-3.49-2.26-4.64-1.57-2.19 1.32-3.56 2.63-7.12 0-3.56-2.63-2.47-6.58-7.26-5.26-4.8 1.32-8.08 0-11.9-3.29-3.84-3.29-4.11-7.89-9.32-7.24-5.21 0.658-7.75 2.16-9.04-1.32-2.19-5.92-1.1-7.89-4.66-9.87-3.56-1.97-2.74-5.26-5.75-6.58-3.01-1.32-9.32-5.26-9.32-5.26","m100 0.435v98.2s-2.49 0.722-4.98 0c-1.01-0.293-2.02 0.175-2.98 0.643-1.41 0.684-2.71 1.37-3.77-0.323-1.78-2.85-1.78-3.57-5.69-3.57-3.91 0-6.4-0.361-7.46-1.08-1.07-0.722-3.55-3.25-5.33-3.25s-3.55-0.722-7.82 0c-4.26 0.721-11.4 2.89-14.9 1.44-3.55-1.44-6.4-3.25-8.17-3.25s-6.75 1.08-8.53-1.08c-1.78-2.17-0.711-4.33-4.62-4.33-3.91 0-3.2-0.361-7.11-0.722-3.91-0.361-7.46-2.53-8.88-3.61-1.42-1.08-3.91-2.17-6.4-3.61-2.49-1.44-4.26-3.61-2.84-5.41 1.42-1.81 2.13-5.05 2.84-6.86 0.711-1.8-1.07-7.51 0-8.08 1.07-0.58 2.13-4.62 2.13-5.3 0-0.69 0.711-6.1 0.711-6.1s1.42-4.69 1.42-6.32c0-1.62 1.07-3.79 1.78-6.32 0.711-2.53 0.355-2.89 1.07-6.14 0.71-3.25 1.07-6.14 2.13-9.02 1.07-2.89 0.711-4.33 2.13-6.86 1.42-2.53 3.2-2.37 6.4-2.63 1.24-0.101 2.64 0.078 3.97 0.257 2.11 0.283 4.04 0.566 4.91-0.257 1.42-1.34 9.59-2.79 11.4-3.51 1.78-0.722 5.54-0.722 8.63-0.361 3.1 0.361 7.36 0.722 9.49-0.361 2.13-1.08 4.97-3.61 7.46-2.17 2.49 1.44 7.11 1.81 9.95 1.81 2.84 0 8.17-0.361 9.59-0.361 1.42 0 13.5-1.44 13.5-1.44","m0 100h100v-98.1s-2.26 2.58-3.06 6.45c-0.799 3.87-1.86-3.87-2.53-6.45-0.666-2.58-2-2.58-2.66 0-0.666 2.58-2.93 5.16-3.59 10.3-0.666 5.16-2 1.29-3.33 5.16-1.33 3.87-2.8 3.87-3.6 5.16-0.799 1.29-1.86-1.29-2.53-3.87-0.666-2.58-0.932-9.03-1.86-7.74-0.359 0.498-0.835 0.0392-1.33-0.418-0.794-0.735-1.64-1.47-2.13 1.71-0.799 5.16-2.13 1.29-2.93 5.16-0.349 1.69-0.546 1.66-0.802 1.62-0.329-0.0434-0.754-0.0898-1.73 3.54-1.73 6.45-1.73 7.74-3.59 14.2-1.86 6.45-3.99 6.45-4.66 6.45-0.666 0-2.13-3.87-3.2-5.16-1.06-1.29-3.86-9.03-4.26-7.74-0.16 0.516-0.383 0.207-0.658-0.103-0.412-0.465-0.94-0.93-1.54 1.39-0.999 3.87-0.999 5.16-2.73 9.03-1.73 3.87-3.73 1.29-4.39 1.29-0.666 0-1.86-9.03-3.06-6.45-1.2 2.58-2 2.58-3.06 6.45-1.07 3.87-0.133-0.645-3.06 8.06-2.93 8.71-4.53 11.3-5.86 8.71-1.33-2.58-0.266-8.39-2.53-8.71-2.26-0.323-0.133-4.19-2.26-0.323-0.926 1.68-1.48 0.318-1.93-1.05-0.592-1.77-1.03-3.55-1.93 1.37-1.6 8.71-1.86 3.55-3.46 10-0.888 3.58-1.73 3.19-2.59 2.79-0.681-0.318-1.36-0.635-2.07 1.08-1.6 3.87-2.93 9.03-3.73 12.9-0.799 3.87-1.73 5.16-2.8 6.45-1.07 1.29-3.06 7.74-3.06 7.74l-1.46 9.03","m0.642 91.6c2.18-0.834 1.23 0.646 2.08 5.01 1.15 5.89 2.04-0.393 3.53-1.92 0.997-1.02 1.1-0.0486 1.34 0.919 0.167 0.677 0.401 1.35 1.05 1.35 0.673-0.0028 1.21-2.06 1.94-2.16 0.618-0.0861 1.53 1.26 2.16 1.6 0.978 0.537 2.32 1.11 3.25-0.214 1.12-1.6 1.06-5.87 1.91-7.36 0.49-0.854 1.61-0.912 2.23-1.08-0.0448 3.49 1.27 7.03 2.23 2.97-0.228 3.71 0.481 3.62 1.48 5.18 0.689 1.07 2.22 1.88 3.09 2.98 2.56 3.23 3.88-1.12 6.34-2.31 1.83-0.88 2.74-0.315 4.27 1.94 1.62 2.39 1.83 1.85 3.39-0.883 2.19-3.85 4.81-0.0486 6.84-5.73 1.17-3.28 0.699-3.87 2.54-4.2 0.763-0.135 2.62-0.893 3.33-0.516 1.6 0.843 1.1 5.2 2.63 6.59 0.307 0.282 0.625 0.0555 0.928-0.171 0.274-0.205 0.537-0.41 0.77-0.239 0.545 0.403 0.557 1.66 1.03 2.34 1.35 1.98 2.47 2.41 4.01 2.77 0.848 0.193 1.74-0.0541 2.63-0.301 1.06-0.296 2.12-0.591 3.09-0.132 0.718 0.339 1.3 2.06 2.05 1.66 0.934-0.498 1.31-4.57 1.87-6.2 0.859-2.48 1.25-4.16 3.04-3.21-0.524 6.14 3.33 4.11 4.71 3.39 0.848-0.446 1.36-0.7 2.04-2.01 0.888-1.71 1.56-7.51 2.84-7.75 1.02-0.192 4.02 7.53 5.11 9.04 1.52 2.12 2.79 3.41 4.23 0.0153 0.722-1.7 2.48-6.64 1.64-8.7 0.507-2.05 1.15-2.65 2.49-2.7 0.44-0.0167 0.848 0.0333 1.24 0.107v-81.6c-0.445 0.429-0.885 0.876-1.32 1.37-0.33 0.378-1.05 0.343-1.33 0.957-0.295 0.639-0.319 2.69-0.593 3.12-1.62 2.53-1.55 0.0208-3.15-1.53-0.362-0.351-0.409-1.3-0.906-1.61-0.242-0.149-0.558 0.107-0.892 0.362-0.337 0.257-0.691 0.515-1.01 0.358 0.0703-6.64-4.2 2.67-5.42 3.23-1.38 0.637-2.65-0.368-3.9-1.37-1.68-1.36-3.33-2.72-5.16-0.0236-2.46 3.62-3.81 10.4-7.44 10.5-0.598 0.0125-1.15-0.317-1.7-0.646-0.552-0.329-1.1-0.658-1.68-0.646-1.25 0.0264-2.54 2.7-3.82 1.58-1.11-0.979-1.29-4.91-2.23-5.75-0.609-0.541-1.21 0.146-1.81 0.832-0.576 0.659-1.16 1.32-1.76 0.894-1.14-0.802-1.5-4.69-2.45-6.31-1.24-2.12-2.71-1.89-4.11-1.23-1.89 0.883-3.13 3.74-4.83 5.04-0.567 0.432-1.31 0.0986-2.06-0.235-1.04-0.465-2.1-0.93-2.71 0.677-0.65 1.7 0.652 7.88-0.753 9.93-1.3 1.9-0.737-0.33-1.75-1.81-0.856-1.25-0.647 0.13-1.34-1.47 0.523-2.12 1.3-4.75 0.92-7.43-0.264-0.0514-0.611-0.018-0.991 0.0153-1.09 0.0944-2.45 0.189-2.96-1.65-0.319-1.14 0.104-5.07-0.0232-6.59-0.958 0.0236-10.5 11.6-9.23 1.89-0.96 4.56-3.26 9.14-5.33 7.57-0.658-0.497-1.2-2.3-1.84-2.73-0.614-0.419-1.21-0.204-1.82 0.0111-0.399 0.14-0.803 0.282-1.22 0.244-0.86-0.0764-1.94-1.51-2.72-1.16-1.38 0.628-2.42 4.97-3.89 5.08-2.16 0.172-2.31-5.77-4.01-7.49-0.809-0.822-1.8-0.18-2.79 0.99v86.8c0.206-0.0403 0.418-0.0958 0.642-0.18","m89.3 0h-89.3v94.5c0.542 1.3 1.03 2.47 1.34 2.65 1.24 0.722 1.8-3.48 2.81-4.09 1.45-0.875 0.831 1.28 2 2.99 1.64 2.4 2.1-1.09 3.84-1.12 0.421-0.0071 0.747 0.258 1.04 0.524 0.65 0.593 1.12 1.19 2.09-1.25-0.447-1.41-1.17-2.01-1.74-3.04 0.802-1.44 1.52-2.38 2.16-4.14 0.692-1.9 0.15-4.06 1.52-4.07 0.985 4.63-0.761 7.72 1.38 9.28 0.3 0.219 0.6 0.0435 0.906-0.131 0.334-0.191 0.674-0.382 1.03-0.059 0.792 0.725 1.15 4.18 1.89 4.91 1.78 1.76 6.06-6.96 4.09-12.7 1.24-2.15 2.73-3.02 3.98-5.06 0.969-1.58 1.69-4.6 2.79-5.47 0.38 5 1.7 8.26 3.69 10-0.615 1.29-1.16 2.77-1.36 4.72 0.938 2.73 2.26 0.706 3.42 0.376 2.77-0.789 1.47 2.79 3.45 4.97 0.963 1.06 1.94-0.59 2.96-2.24 1.11-1.79 2.26-3.58 3.49-1.91 0.604 0.819 0.825 3.53 1.52 4.56 0.557 0.829 0.962 0.787 1.41 0.746 0.269-0.0239 0.554-0.0492 0.897 0.118 0.897 0.437 1.79 1.55 2.72 1.91 0.591 0.223 1.14 0.0056 1.65-0.211 0.63-0.264 1.22-0.528 1.8 0.0014 0.474 0.434 0.482 2.86 1.25 3.21 0.891 0.416 1.58-2.12 2.33-2.78 1.33-1.17 2.89-0.27 3.82-3.51-0.602 0.574-1.3 0.93-1.9 0.949 0.283-3.84 1.86-5.23 3.06-6.95-0.181-1.04-0.013-2-0.12-2.98 0.539 1.01 1.17 1.33 1.77 0.697-0.922-4.21 0.292-5.18 1.53-7.87-0.427 2.09 0.193 5.48 0.213 7.66 0.0284 3.21-0.28 2.65 0.266 5.81 0.337 1.95 1.17 0.185 0.604 3.3 1.39 2.93 7.69 4.26 5.58-4.16 0.871-0.0885 1.21 1.17 1.56 2.43 0.444 1.63 0.89 3.26 2.49 1.96 0.744-0.6 1.44-3.09 2.16-3.37 1.76-0.671 1.24 3.23 2.81 3.75 1.31 0.438 2.66-4.45 3.85-5.48 0.512-0.442 0.951-0.358 1.44-0.274 0.267 0.0464 0.548 0.0927 0.864 0.052 2.22-0.284 3.09-4.96 1.35-9.59 1.11-1.21 1.7-2.88 2.47-4.96 1.5-4.03 0.88-3.53 2.82-0.896 1.06 1.44 2.01 3.27 3.03 0.126v-73.9h-10.7","m0 51.2c3.3-2.88 6.4-5.95 9.3-9.33-0.9-1.59-2.1-3.08-3.9-3.57-0.8-1.49 0.2-3.47 1.7-4.46 0.3-0.198 0.6-0.298 0.9-0.496-0.1-0.198-0.2-0.496-0.3-0.694 1.6-1.49 3.1-2.98 4.6-4.46 0.6 0.298 1.2 0.694 1.8 0.992-0.3-0.595-0.6-1.19-0.9-1.69 0.7-0.496 1.4-1.09 2.2-1.59-0.3-1.39-0.8-2.78-2.1-3.67-0.1-1.69 1.5-3.08 3.3-3.47 0.3-0.0992 0.7-0.0992 1-0.0992v-0.794l6-2.38c0.4 0.496 0.8 1.09 1.3 1.59-0.1-0.694-0.1-1.29-0.2-1.98 0.8-0.198 1.6-0.397 2.5-0.595 1.1-3.17 1.7-6.45 1.9-9.82 1.1 0.595 2.4 0.198 3.6 0.198 1.1 0 2.3 0.496 2.6 1.49 1.6 0.0992 3.4-0.198 4.8 0.496 0.8 0.397 1.5 1.09 2.2 1.79 2.3-2.58 4.3-5.46 5.8-8.63 0.8 0.893 2.1 1.09 3.3 1.59 0.7 0.694 1.7 1.69 1.6 2.68 1.4 0.694 3.2 1.09 4.2 2.28 0.5 0.496 0.8 1.19 1.1 1.88 3.6-1.09 7.3-2.28 10.9-3.37 1 3.37 2.4 6.55 4.1 9.62 3.9 0.397 7.8 0.694 11.8 1.09-0.4 3.17-0.4 6.35-0.1 9.52 0.3 0.298 0.6 0.694 0.8 1.09 0 0.694-0.1 1.39-0.1 2.08 0.9-0.198 1.7-0.694 2.4-1.19 2.4 1.29 5 2.08 7.7 2.58-1.6 3.27-3 6.55-4.3 10 0.4 0.595 0.6 1.29 0.6 1.98-0.3 0.595-0.6 1.19-0.9 1.88 0.9 0.0992 1.8 0 2.7-0.198 1.7 2.08 3.8 3.87 6.1 5.26-3.3 2.88-6.4 5.95-9.3 9.33 0.9 1.59 2.1 3.08 3.9 3.57 0.8 1.49-0.2 3.47-1.7 4.46-0.3 0.198-0.6 0.298-0.9 0.496 0.1 0.198 0.2 0.496 0.3 0.694-1.6 1.49-3.1 2.98-4.6 4.46-0.6-0.298-1.2-0.694-1.8-0.992 0.3 0.595 0.6 1.19 0.9 1.69-0.7 0.496-1.4 1.09-2.2 1.59 0.3 1.39 0.8 2.78 2.1 3.67 0.1 1.69-1.5 3.08-3.3 3.47-0.3 0.0992-0.7 0.0992-1 0.0992v0.794c-2 0.794-4 1.59-6 2.38-0.4-0.496-0.8-1.09-1.3-1.59 0.1 0.694 0.1 1.29 0.2 1.98-0.8 0.198-1.6 0.397-2.5 0.595-1.1 3.17-1.7 6.45-1.9 9.82-1.1-0.595-2.4-0.198-3.6-0.198-1.1 0-2.3-0.496-2.6-1.49-1.6-0.0992-3.4 0.198-4.8-0.496-0.8-0.397-1.5-1.09-2.2-1.79-2.3 2.58-4.3 5.46-5.8 8.63-0.8-0.893-2.1-1.09-3.3-1.59-0.7-0.893-1.7-1.88-1.6-2.88-1.4-0.694-3.2-1.09-4.2-2.28-0.5-0.496-0.8-1.19-1.1-1.88-3.6 1.09-7.3 2.28-10.9 3.37-1-3.37-2.4-6.55-4.1-9.62-3.9-0.397-7.8-0.694-11.8-1.09 0.4-3.17 0.4-6.35 0.1-9.52-0.3-0.298-0.6-0.694-0.8-1.09 0-0.694 0.1-1.39 0.1-2.08-0.9 0.198-1.7 0.694-2.4 1.19-2.4-1.29-5-2.08-7.7-2.58 1.6-3.27 3-6.55 4.3-10-0.4-0.595-0.6-1.29-0.6-1.98 0.3-0.595 0.6-1.19 0.9-1.88-0.9-0.0992-1.8 0-2.7 0.198-1.7-1.79-3.8-3.57-6.1-5.06z","m100 48.7c-3.3 2.89-6.49 6.08-9.39 9.36-1.2 1.39-2.4 2.99-2.4 4.78-0.699-0.498-1.6-0.598-2.5-0.299 0.599 0.697 1.2 1.29 1.8 1.99-1.1-0.199-2.2 0.498-3.2 1.2-0.0999 0.0996-0.3 0.199-0.4 0.299 0.2 1.99 0.3 3.98 0.5 5.88 0.2 2.09 0.5 4.48 2.3 5.88 0.0999 1.69-1.5 3.09-3.3 3.49-0.3 0.0996-0.699 0.0996-0.999 0.0996v0.797c-2 0.797-4 1.59-5.99 2.39-0.4-0.498-0.799-1.1-1.3-1.59 0.0999 0.697 0.0999 1.29 0.2 1.99-2.7 0.697-5.49 1.29-8.19 1.99-0.4-0.598-0.699-1.2-1.1-1.79 0 1.2-1.8 1.39-3 1.2-0.5-0.0996-1.1-0.0996-1.6-0.199-0.2 1.59-1.6 3.09-2.8 4.38-2.7 2.79-4.9 5.98-6.49 9.46-0.799-0.896-2.1-1.1-3.3-1.59-0.899-0.598-1.9-1.59-1.8-2.59-1.4-0.697-3.2-1.1-4.2-2.29-0.699-0.797-0.999-1.79-1.5-2.79-0.699-1.29-1.6-2.49-2.8-3.49-0.4-0.299-0.899-0.697-1.3-0.996-0.4 0-0.699 0-1.1-0.0996-6.99-0.598-14.1-1.2-21.1-1.89 0.5-4.08 0.4-8.27-0.3-12.4 0.699-0.299 1.4-0.598 2.1-0.996-0.599-0.199-1.2-0.498-1.8-0.697 0.0999-1.39 0.2-2.89 0.3-4.28-1.3-1.29-3-2.09-4.5-3.19-1.5-1.1-2.8-2.59-3-4.48 0.3-0.598 0.599-1.2 0.899-1.89-0.899-0.0996-1.8 0-2.7 0.199-1.7-2.09-3.8-3.88-6.09-5.28 3.3-2.89 6.49-6.08 9.39-9.36 1.2-1.39 2.4-2.99 2.4-4.78 0.699 0.498 1.6 0.598 2.5 0.299-0.599-0.697-1.2-1.29-1.8-1.99 1.1 0.199 2.2-0.498 3.2-1.2 0.0999-0.0996 0.3-0.199 0.4-0.299-0.2-1.99-0.3-3.98-0.5-5.88-0.2-2.09-0.5-4.48-2.3-5.88-0.0999-1.69 1.5-3.09 3.3-3.49 0.3-0.0996 0.699-0.0996 0.999-0.0996v-0.797c2-0.797 4-1.59 5.99-2.39 0.4 0.498 0.799 1.1 1.3 1.59-0.0999-0.697-0.0999-1.29-0.2-1.99 2.7-0.697 5.49-1.29 8.19-1.99 0.4 0.598 0.699 1.2 1.1 1.79 0-1.2 1.8-1.39 3-1.2 0.5 0.0996 1.1 0.0996 1.6 0.199 0.2-1.59 1.6-3.09 2.8-4.38 2.7-2.79 4.9-5.98 6.49-9.46 0.799 0.896 2.1 1.1 3.3 1.59 0.999 0.598 2 1.59 1.9 2.59 1.4 0.697 3.2 1.1 4.2 2.29 0.699 0.797 0.999 1.79 1.5 2.79 0.699 1.29 1.6 2.49 2.8 3.49 0.4 0.299 0.899 0.697 1.3 0.996 0.4 0 0.699 0 1.1 0.0996 7.09 0.598 14.1 1.29 21.2 1.89-0.5 4.08-0.4 8.27 0.3 12.4-0.699 0.299-1.4 0.598-2.1 0.996 0.599 0.199 1.2 0.498 1.8 0.697-0.0999 1.39-0.2 2.89-0.3 4.28 1.3 1.29 3 2.09 4.5 3.19 1.5 1.1 2.8 2.59 3 4.48-0.3 0.598-0.599 1.2-0.899 1.89 0.899 0.0996 1.8 0 2.7-0.199 1.5 1.99 3.6 3.78 5.89 5.28z","m100 61.9c0 10.9-8 19.9-18.4 21.1-1.9 9.7-10.3 17-20.3 17-4.2 0-8-1.3-11.3-3.4-3.2 2.1-7.1 3.4-11.3 3.4-10.1 0-18.5-7.3-20.4-17.1-10.3-1.2-18.3-10.2-18.3-21 0-10.4 7.3-19 16.9-20.8 0-0.8 0.1-1.6 0.2-2.4 0.6-4.2 3-7 3-7s0 3.5 1.7 2.7c2.1-1 1.5-5.1 3.4-8.8 4.3-8.1 11.6-11.1 11.6-11.1s-2.9 7.2 1.6 6.3c2.9-0.6 2.6-7.5 7.5-13 7.5-8.6 16.1-7.8 16.1-7.8s-6.6 5.7-7.2 12.5c-0.4 4 1.5 8.5 5 9.2 5.1 1 4.1-2.4 4.1-2.4s3.4-0.1 6.8 3.9c2.3 2.6 1.9 6.4 4.6 6.9 1.4 0.3 1.3-2.5 1.3-2.5s2.9 1.4 4.6 5.9c1 2.6 1.3 5.1 1.4 7.4 9.9 1.7 17.4 10.4 17.4 21z","m94.3 56.2c0.4 6 2 13 5.7 21.2 0 0-16.6 12.2-50 22.6-33.4-10.4-50-22.6-50-22.6 3.7-8.1 5.3-15.1 5.7-21.1-0.5-0.9-3.9-7.7-2.5-14.8 0.9-4.5 4.3-7.5 4.3-7.5s0 3.8 2.5 2.9c3-1.1 2.1-5.5 4.9-9.4 6.1-8.7 16.7-12 16.7-12s-4.1 7.8 2.3 6.7c4.2-0.7 3.8-8.1 10.8-14 10.7-9 23.1-8.2 23.1-8.2s-9.5 6.2-10.4 13.4c-0.6 4.3 2.2 9.2 7.3 9.9 7.4 1 5.9-2.6 5.9-2.6s4.9-0.1 9.8 4.2c3.3 2.8 2.8 6.9 6.7 7.5 2 0.3 1.9-2.7 1.9-2.7s4.2 1.6 6.6 6.4c4.7 9.7-0.3 18.6-1.3 20.1z","m100 56.2v0.1c0 24.1-22.4 43.7-50 43.7-27.6 0-50-19.6-50-43.7v-0.1c0-1.6 0.1-3.3 0.4-5.1 1-5.6 4.5-9.3 4.5-9.3s0 4.7 2.6 3.6c3.1-1.3 2.2-6.8 5.1-11.6 6.5-10.7 17.6-14.8 17.6-14.8s-4.4 9.6 2.4 8.3c4.4-0.8 4-9.9 11.4-17.2 11.5-11.1 24.6-10.1 24.6-10.1s-10 7.6-11 16.5c-0.6 5.4 2.3 11.3 7.7 12.2 7.8 1.3 6.3-3.2 6.3-3.2s5.1-0.1 10.3 5.1c3.5 3.5 2.9 8.4 7.1 9.2 2.1 0.4 2-3.3 2-3.3s4.4 1.9 7 7.9c1.6 4.2 2.1 8.3 2 11.8z","m100 41.1v34.5c-2 0-3.7 0.3-5.2 0.8v0.7c0 5-4.1 9.1-9.1 9.1h-0.1c-0.6 2-0.6 3.6-0.6 3.6-12.4 7-30 10.2-35 10.2s-22.6-3.2-35-10.2c0 0-0.1-1.6-0.7-3.7h-0.1c-5 0-9.1-4.1-9.1-9.1v-0.7c-1.4-0.4-3.1-0.7-5.1-0.7v-34.5c0-0.9 0.1-1.8 0.3-2.8 1-4.2 4.5-7 4.5-7s0 3.5 2.6 2.7c3.1-1 2.2-5.1 5.1-8.7 6.5-8 17.6-11.1 17.6-11.1s-4.4 7.2 2.4 6.2c4.5-0.6 4.1-7.4 11.5-12.8 11.5-8.4 24.6-7.6 24.6-7.6s-10 5.7-11 12.4c-0.6 4 2.3 8.5 7.7 9.2 7.8 1 6.3-2.4 6.3-2.4s5.1-0.1 10.3 3.8c3.5 2.6 2.9 6.3 7.1 6.9 2.1 0.3 2-2.5 2-2.5s4.4 1.4 7 5.9c1.4 2.8 2 5.4 2 7.8z","m91.7 37.2c2.6-0.4 5.4-1 8.3-1.7 0 0-5.2 44-50 64.5-44.8-20.5-50-64.5-50-64.5 2.9 0.7 5.6 1.3 8.3 1.7-0.1-1.3-0.1-2.7 0.2-4.1 0.8-3.6 3.8-6 3.8-6s0 3 2.2 2.3c2.6-0.9 1.9-4.4 4.3-7.5 5.4-6.9 14.7-9.6 14.7-9.6s-3.7 6.2 2 5.4c3.7-0.5 3.3-6.4 9.6-11.1 9.5-7.3 20.5-6.6 20.5-6.6s-8.4 4.9-9.2 10.7c-0.5 3.5 1.9 7.3 6.4 7.9 6.5 0.8 5.2-2 5.2-2s4.3-0.1 8.6 3.3c2.9 2.3 2.5 5.5 5.9 6 1.8 0.3 1.6-2.1 1.6-2.1s3.7 1.2 5.8 5.1c1.7 2.9 2.1 5.8 1.8 8.3z","m97.2 50.9v34.9s-0.3 2.6-3.8 3.3l-40.2 10.3s-2.5 0.6-3.4 0.6-3.4-0.6-3.4-0.6l-40.3-10.3c-3.4-0.8-3.8-3.3-3.8-3.3v-34.9c-1.2-2.3-3.2-7.3-2-12.5 0.999-4.2 4.49-7 4.49-7s0 3.5 2.6 2.7c3.1-1 2.2-5.1 5.09-8.7 6.49-8 17.6-11.1 17.6-11.1s-4.39 7.2 2.4 6.2c4.49-0.6 4.1-7.5 11.5-12.9 11.5-8.4 24.6-7.6 24.6-7.6s-9.99 5.7-11 12.4c-0.599 4 2.3 8.5 7.69 9.2 7.79 1 6.29-2.4 6.29-2.4s5.09-0.1 10.3 3.8c3.5 2.6 2.9 6.3 7.09 6.9 2.1 0.3 2-2.5 2-2.5s4.39 1.4 6.99 5.9c4.2 7.7 0.899 14.8-0.799 17.6z","m100 35.6v51.8h-10.4c-3.4 1.9-8 3.5-13.6 4.7-1.4 0.3-2.8 0.6-4.3 0.8 0 0-3.4 0.8-5 1.2-5.3 1.3-13.4 3.6-16.7 5.9-3.3-2.3-11.4-4.5-16.7-5.9-1.6-0.4-5-1.2-5-1.2-1.5-0.3-2.9-0.5-4.3-0.8-5.6-1.2-10.2-2.8-13.6-4.7h-10.4v-51.8c0-0.9 0.1-1.8 0.4-2.7 1-3.6 4.5-6 4.5-6s0 3 2.6 2.3c3.1-0.9 2.2-4.4 5.1-7.5 6.5-6.9 17.6-9.5 17.6-9.5s-4.4 6.2 2.4 5.3c4.4-0.5 4-6.3 11.4-11 11.5-7.2 24.6-6.5 24.6-6.5s-10 4.9-11 10.6c-0.6 3.4 2.3 7.3 7.7 7.9 7.8 0.8 6.3-2 6.3-2s5.1-0.1 10.3 3.3c3.5 2.2 2.9 5.4 7.1 5.9 2.1 0.2 2-2.1 2-2.1s4.4 1.2 7 5.1c1.5 2.4 2 4.8 2 6.9z","m100 35.9-4.1 42.7v0.2c0 4.1-5.2 7.5-11.7 7.5-1.4 0-2.6-0.2-3.9-0.5-2.9 3.3-7.4 6.1-13 8.1-1.1 0.4-2.3 0.8-3.5 1.1 0 0-3.3 0.7-4.6 1.3-2.9 1.2-5.8 2.6-9.2 3.7-3.4-1.1-6.3-2.5-9.2-3.7-1.3-0.6-4.6-1.3-4.6-1.3-1.2-0.3-2.4-0.7-3.5-1.1-5.7-2-10.1-4.8-13-8.1-1.2 0.3-2.5 0.5-3.9 0.5-6.5 0-11.7-3.4-11.7-7.5v-0.2l-4.1-42.7c0-0.9 0.1-1.8 0.4-2.8 1-3.6 4.5-6 4.5-6s0 3 2.6 2.3c3.1-0.9 2.2-4.4 5.1-7.5 6.5-6.9 17.6-9.6 17.6-9.6s-4.4 6.2 2.4 5.4c4.4-0.5 4-6.4 11.4-11.1 11.5-7.3 24.6-6.6 24.6-6.6s-10 4.9-11 10.7c-0.6 3.5 2.3 7.3 7.7 7.9 7.8 0.8 6.3-2 6.3-2s5.1-0.1 10.3 3.3c3.5 2.3 2.9 5.5 7.1 6 2.1 0.3 2-2.1 2-2.1s4.4 1.2 7 5.1c1.5 2.4 2 4.8 2 7z","m96.4 38.7c0.4 9.69 3.6 14.6 3.6 14.6s-3.6 5.39-3.7 16.2c0 0-0.1 2.2-2.4 2.2h-5.8v9.69c0 4.2-3.3 7.69-7.4 7.69h-6.6c0 3-0.9 5.39-2.6 6.79-1.2 0.999-2.7 1.4-4.5 1.3-1-0.0999-2.4-0.3-3.8-0.499-3.2-0.499-7.1-0.999-8.9-0.599-2.6 0.499-3.8 2.9-3.8 3l-0.5 0.999-0.5-0.999s-1.2-2.4-3.8-3c-1.8-0.4-5.8 0.2-8.9 0.599-1.4 0.2-2.8 0.4-3.8 0.499-1.8 0.0999-3.3-0.3-4.5-1.3-1.7-1.4-2.6-3.8-2.6-6.79h-6.6c-4.1 0-7.4-3.4-7.4-7.69v-9.69h-5.8c-2.3 0-2.4-2.2-2.4-2.2-0.1-10.7-3.7-16.1-3.7-16.1s3.3-4.89 3.6-14.6c0-0.999 0.1-2 0.3-3 0.9-3.9 4.2-6.49 4.2-6.49s0 3.3 2.4 2.5c2.9-0.899 2.1-4.79 4.8-8.09 6-7.49 16.3-10.3 16.3-10.3s-4.1 6.69 2.2 5.79c4.1-0.599 3.7-6.89 10.6-12 10.7-7.89 22.9-7.19 22.9-7.19s-9.3 5.29-10.2 11.6c-0.5 3.7 2.1 7.89 7.1 8.49 7.2 0.899 5.8-2.2 5.8-2.2s4.8-0.0999 9.6 3.6c3.2 2.4 2.7 5.89 6.5 6.39 2 0.3 1.8-2.3 1.8-2.3s4.1 1.3 6.5 5.49c1.5 2.7 2 5.29 2 7.59z","m100 65s-2.7 1.4-5.6 2.2c-1.2 2.5-2.1 5.1-2.8 7.9-0.4 1.8-2.6 3-5.4 3.1v2.5c0 2.9-1.4 5.6-3.9 7.6-5.4 4.4-16.8 11.7-32.3 11.7s-26.9-7.3-32.3-11.7c-2.4-2-3.9-4.7-3.9-7.6v-2.5c-2.8-0.1-5-1.3-5.4-3.1-0.7-2.8-1.6-5.4-2.8-7.9-2.9-0.9-5.6-2.2-5.6-2.2l4.3-5-3.2-9.2s2.6 1 5.5 1.8c1.7 0.5 4.9 1.1 7.3 1.5v-15.4c0-1 0.1-2 0.3-3 0.7-3.9 3.3-6.5 3.3-6.5s0 3.3 1.9 2.5c2.3-0.9 1.6-4.8 3.7-8.1 4.7-7.5 12.7-10.3 12.7-10.3s-3.2 6.7 1.8 5.8c3.2-0.6 2.9-6.9 8.3-12 8.1-7.8 17.6-7.1 17.6-7.1s-7.2 5.3-8 11.6c-0.4 3.7 1.6 7.9 5.6 8.5 5.6 0.9 4.5-2.2 4.5-2.2s3.7-0.1 7.5 3.6c2.5 2.4 2.1 5.9 5.1 6.4 1.5 0.3 1.4-2.3 1.4-2.3s3.2 1.3 5.1 5.5c1.2 2.7 1.6 5.3 1.5 7.6v15.4c2.4-0.4 5.6-1 7.3-1.5 2.8-0.9 5.5-1.8 5.5-1.8l-3.3 9.2z","m67.5-0.0611c-2.04-0.0186-4 0.25-5.85 0.688-7.3 1.73-18 6.14-22.2 8.41-8.72 4.7-22.6 1.06-32.2 0.194l2.92 23.1c-0.447 0.377-0.915 0.682-1.35 1.1-4.44 4.28-7.79 10.5-8.4 18.1-0.372 4.67 0.385 9.17 1.97 13.2 1.58 3.99 3.91 7.31 6.65 9.9 2.54 2.39 5.32 4.01 8.19 5.11-0.976 0.748-2.05 1.3-2.99 2.11l10.7 17.4c8.64-7.49 20-11.1 30.6-9.7 5.12 0.661 11.7 3.06 20 2.57 4.16-0.25 8.67-1.34 12.9-4.21 4.37-2.93 8.22-7.55 10.1-14 1.34-4.53 1.46-9.24 0.594-13.7-0.859-4.41-1.65-8.96-4.02-12.2-4.14-5.63-6.67-8.38-12.2-9.55 1.09-1.79 3.6-3.7 4.32-5.88 1.11-3.4 1.64-7.11 1.37-11-0.268-3.87-1.32-7.67-3.26-11.1-2.93-5.11-7.17-8.16-11.6-9.6-2.15-0.706-4.26-1.01-6.3-1.03z","m51.7 3.39s-7.76 0.243-9.75 0.416c-1.86 0.162-4.01 0.213-6.44 0.266-7.55 0.164-15.1 0.372-22.6 0.623-6.68 0.222-11.9 5.82-11.7 12.5 0.325 3.66 2.3 6.98 5.36 9.01-1 0.664-2 1.45-2.91 2.55-1.2 1.44-2.19 3.2-2.73 5.38-0.542 2.21-0.561 4.6 0.238 7.11 0.814 2.56 2.34 4.86 4.81 6.62 1.65 1.18 3.17 1.73 4.57 2.05-1.09 1.09-2.92 2.93-4.24 6.62-0.764 2.13-1.22 4.7-0.748 7.67 0.488 3.08 1.88 6.16 4.76 8.69 0.904 0.794 1.76 1.38 2.55 1.84-5.83 3.14-8.06 10.4-4.99 16.3 3.11 5.91 8.02 7.85 15.7 6.6 4.5-0.588 8.83-1.4 13.3-2.01 7.35 0.434 14-0.585 18.2-0.808 5.45-0.243 8.88-1.26 10.5-1.35 1.49-0.0776 4.49 0.386 9.04 0.439 2.28 0.027 5.83-1.53 8.46-2.8 2.77-1.35 6.19-2.06 9.15-4.48 1.96-1.6 3.81-3.67 5.18-6.37 1.02-2 2.24-5.05 1.69-9.26-0.205-1.55-0.793-3.16-1.62-4.75 0.928-2.51 1.45-5.39 0.799-8.69-0.553-2.81-2-5.19-3.88-7.28 0.927-1.06 1.81-2.26 2.51-3.82 0.998-2.25 1.55-4.87 1.18-7.85-0.348-2.77-1.46-5.95-4.54-8.68-0.251-0.222-0.499-0.356-0.75-0.551 0.483-0.438 0.981-0.809 1.44-1.34 1.69-1.96 2.98-4.4 3.47-7.37 0.502-3.03 0.128-6.19-1.51-9.26-1.96-3.66-4.77-5.52-7.19-6.6-2.29-1.02-4-1.25-4.9-1.39-8.02-1.28-14 0.0821-17.6-0.483zm-28.5 49.5c-0.38-0.0969-0.159-0.137 0.438 0.102-0.2-0.0513-0.231-0.0488-0.438-0.102z","m84.8 0.869c-5.02 0.251-10.1-0.442-15 0.896-5.22 0.146-10.4 1.2-15.6 1.48-4.05 0.815-8.31 0.0499-12.3 1.33 1.43-0.679-4.41 0.385-6.32 0.408-6.76 0.17-13.5 0.457-20.3 0.322-3.41 0.185-6.94-0.433-10.3 0.444-5.37 1.74-3.41 9.51 0.453 10.4-5.31 1.74-4.09 10.6 1.42 11-4.21 2.27-3.18 9.11 1.41 10.2-2.18 2.33-3.93 5.84-1.44 8.69 4.6 2.01-2.5 3.66-0.256 7.42 1.9 5.4 8.45 2.04 12.6 2.94 3.14 0.0137 3.8 1.32 0.371 1.76-4.1 1.73-8.77 3.41-11.6 6.95-3.14 4.08 3.82 6.8 0.532 9.93-0.47 2.53 1.56 4.79-2.37 4.05-5.74-0.1-7.69 8.76-2.68 11.3 4 1.75 7.9 2.31 10.3 6.04 3.21 1.25 6.69 0.132 10-0.203 6.22-1.23 12.5 0.58 18.8 0.443 11.7 0.511 23.5-0.0068 35-2.2 4.33-1.02 8.72-1.8 12.9-3.21 3.99-1.56 7.68-5.21 6.84-9.71-0.012-4.4-5.85-6.18-7.77-5.45-2.68 0.632-4.09-1.24-5.94-2.5 4.27-2.03 9.39-3.35 12.3-7.29 2.62-4.3-2.09-9.97-6.78-8.22-1.1 0.327-2.97 1.72-0.838 0.416-4.37 3.51-4.82-4.46-9.72-3.11 1.87-1.46 8.91-4.78 2.99-2.35-4.86 1.67 4.88-1.29 6.79-2.34 1.62-0.784-3.68-5.75 1.25-4.09 2.81 2.24 2.16-1.46 2.43-2.63 3.38-2.45 0.6-6.82-0.0624-8.94 2.44-1.51 1.21-4.08 1.14-6.33-0.477-4.67-5.18 4.82-4.53 1.09-0.0838-2.09 5.2-3.33 3.62-7.9-3.1-3.56 3.49-7.52-0.873-11.2-2.29-1.88 1.11-7.41-3.46-9.04-0.97-0.535-2.1-0.82-3.21-0.768zm5.24 9.12c0.0118-0.00178 0.0507 0.0433 0 0zm-1.22 40.2c-0.331 0.34-1.93 0.69 0 0zm-74.3 46.1c2.4 0.856 1.33 0.876 0 0z","m72.8 1.64c-5.3 0.108-12.7 0.345-15.7 0.501-14.9 0.773-29.5-0.736-41.1 0.0102-11.6 0.747-14.5 7.19-15.7 16.7-1.21 9.55 3.18 15.6 10.6 17.4 4.59 1.1 9.22 1.9 13.9 2.42l-5.24 1.78 0.604-0.188c-5.22 1.45-9.7 5.05-13 10.4-3.27 5.36-4.9 11.8-4.7 18.5 0.226 7.85 2.83 14.9 7.43 20.2 4.6 5.26 10.4 7.81 16.6 7.28l-2.05-0.0203c10.1 1.07 20.3 1.8 30.5 2.19 9.78 0.375 19.6 0.436 29.3 0.181 7.56-0.196 13.6-8.12 13.4-17.7-0.156-9.58-6.41-17.2-14-17-1.78 0.0465-3.57-0.0584-5.35-0.0339 4.95-3.39 9.51-7.67 13.4-12.9 1.75-2.31 3.9-5.39 5.68-9.8 1.83-4.54 2.47-7.45 1.81-14.2-0.785-7.99-4.04-14.1-8.21-18.4-4.04-4.15-8.5-6.1-12.6-6.88-2.02-0.384-3.91-0.515-5.68-0.479z","m16.4 0.00257a6.4 6.35 0 0 0-6.58 6.17 6.4 6.35 0 0 0 6.22 6.52c5.1 0.143 10.4 0.305 19.4 0.795-7.6 1.3-13.5 2.56-16.8 3.57-1.11 0.343-1.97 0.534-3.44 1.35-0.732 0.409-2.08 0.675-3.22 3.57-0.572 1.45-0.529 3.74 0.203 5.25 0.732 1.5 1.67 2.21 2.34 2.66 2.65 1.78 3.38 1.38 4.93 1.62 1.55 0.239 3.45 0.44 5.97 0.653 5.03 0.425 13.4 0.791 21.2 1.22-1.71 0.318-3.67 0.688-5.16 0.972-6.36 1.22-10.4 2.08-13 2.75-1.32 0.339-2.29 0.613-3.24 0.98-0.478 0.184-0.951 0.371-1.62 0.779-0.67 0.408-1.85 0.867-2.82 3.27-0.483 1.2-0.629 3.1-0.0735 4.61 0.555 1.51 1.5 2.43 2.19 2.95 1.38 1.05 2.09 1.1 2.64 1.24 1.12 0.276 1.72 0.286 2.43 0.327 1.42 0.0823 2.96 0.0728 4.6 0.0728h6.99c-0.382 0.111-1.17 0.293-1.52 0.398-2.22 0.668-3.57 1.05-5.24 1.91-0.416 0.216-0.872 0.454-1.53 0.996s-1.85 1.42-2.33 3.86c-0.481 2.44 1.16 5.38 2.35 6.33 1.19 0.95 1.93 1.11 2.49 1.27 1.8 0.528 2.79 0.52 3.96 0.52-9.64 2.52-18.7 4.99-24.4 6.58-4.53 1.27-6.68 1.76-8.81 2.63-0.533 0.217-1.05 0.279-2.32 1.38-0.633 0.55-1.72 1.54-2.14 3.66-0.421 2.12 0.675 4.63 1.64 5.66 1.94 2.05 2.69 1.77 3.26 1.93 0.571 0.166 0.958 0.239 1.35 0.315 2.75 0.527 8.63 1.11 18.6 1.55 0.0405 0.681 0.0582 1.39 0.286 1.93 0.643 1.54 1.51 2.25 2.09 2.68 1.15 0.866 1.66 0.932 2.09 1.07 0.866 0.281 1.35 0.344 1.98 0.443 1.26 0.198 2.85 0.364 5.17 0.559 9.29 0.78 29.8 1.87 50.5 2.98a6.4 6.35 0 0 0 6.74-6 6.4 6.35 0 0 0-0.584-2.82c0.36-0.184 0.751-0.398 1.46-1.05 0.861-0.794 2.37-3 1.98-5.6-0.391-2.6-1.95-3.79-2.71-4.31-1.53-1.04-1.88-0.893-2.23-0.974-1.39-0.324-1.36-0.204-1.75-0.234-1.58-0.123-4.34-0.277-15.8-0.425-7.69-0.0991-19.2-0.304-30-0.49 4.65-1.2 9.29-2.44 13.8-3.48 14.9-3.42 27.2-5.34 32.7-6.73 0.686-0.174 1.27-0.33 1.99-0.604 0.359-0.137 0.748-0.289 1.34-0.644 0.594-0.355 1.63-0.725 2.65-2.88 0.51-1.08 0.801-2.79 0.429-4.28s-1.21-2.55-1.86-3.16c-1.31-1.22-2.06-1.34-2.6-1.52-1.09-0.355-1.61-0.376-2.24-0.445-2.51-0.274-5.82-0.28-10.7-0.317-0.0931-7.01e-4 -0.236 6.87e-4 -0.33 0 0.21-0.0548 0.585-0.154 0.786-0.207 2.45-0.643 4.24-1.13 5.58-1.53 1.34-0.399 1.87-0.413 3.5-1.32 0.406-0.228 0.94-0.439 1.86-1.51 0.461-0.534 1.08-1.36 1.4-2.74 0.322-1.38 0.0653-3.29-0.639-4.55-1.41-2.52-2.88-2.73-3.58-2.98-0.702-0.245-1.08-0.29-1.39-0.337-0.341-0.0498-0.404-0.0151-0.649-0.0354 0.542-0.114 1.67-0.301 2.16-0.407 2.52-0.551 4.28-0.988 5.73-1.46 0.723-0.234 1.35-0.442 2.2-0.901 0.428-0.23 0.93-0.504 1.62-1.15 0.688-0.641 1.8-1.83 2.07-4.01 0.272-2.17-0.911-4.44-1.88-5.41-0.967-0.962-1.68-1.25-2.21-1.47-1.06-0.452-1.62-0.519-2.18-0.618-1.13-0.199-2.12-0.274-3.15-0.356-4.16-0.33-9.38-0.547-22-1.15-0.0481-0.0023-0.113-0.0076-0.161-0.0099 5.35-0.609 12-1.36 15.3-1.84 2.08-0.301 3.56-0.556 4.86-0.886 0.649-0.165 1.24-0.319 2.08-0.709 0.845-0.39 2.78-0.677 3.81-4.31 0.517-1.82-0.0388-4.13-0.822-5.32-0.783-1.19-1.52-1.67-2.05-2-1.06-0.672-1.6-0.794-2.11-0.955-1.03-0.32-1.82-0.464-2.64-0.626-3.3-0.65-7.81-1.36-17.1-2.16-9.24-0.804-23.3-1.72-33-2.26-9.71-0.537-15.1-0.687-20.3-0.834zm-7.83 76.3c0.0849 0.0247 0.264-0.0317 0.59 0.0807-0.0708-0.0128-0.349-0.0373-0.411-0.0492-0.23-0.0442-0.359-0.0841-0.179-0.0315z","m15 0.00104a6.81 8.11 0 0 0-6.91 7.98 6.81 8.11 0 0 0 6.7 8.23c3.08 0.0583 5.73 0.128 8.76 0.187-0.375 0.129-0.886 0.258-1.24 0.388-1.88 0.696-3.23 0.987-5.39 2.9-1.08 0.959-3.37 3.18-3.15 7.71 0.219 4.53 2.88 6.58 4.13 7.37 1.6 1.01 2.86 1.36 4.15 1.61-0.141 1.66-0.0734 3.37 0.453 4.62 0.889 2.1 1.89 2.8 2.5 3.26 2.45 1.82 2.42 1.15 2.89 1.24 0.473 0.0921 0.87 0.142 1.34 0.195 0.936 0.107 2.11 0.203 3.72 0.313 2.47 0.169 7.02 0.368 10.8 0.57-2.7 0.642-5.02 1.15-7.5 1.75-15.4 3.77-24.7 6.36-29.6 8.36-1.21 0.499-2.02 0.651-3.7 2.14-0.841 0.746-2.73 2.15-2.96 6.33-0.115 2.09 0.607 4.33 1.43 5.61 0.819 1.28 1.59 1.86 2.18 2.26 2.34 1.59 2.96 1.25 3.93 1.39 0.968 0.146 1.94 0.225 3 0.299 2.53 0.177 7.62 0.237 11.8 0.331-0.0236 0.0284-0.0312 0.0225-0.0552 0.0518-0.776 0.949-1.88 2.87-1.96 5.46-0.0726 2.58 1.01 4.78 1.82 5.83 1.63 2.11 2.4 2.06 2.96 2.29 1.71 0.718 2.52 0.777 3.49 0.855a6.81 8.11 0 0 0-0.821 2.9 6.81 8.11 0 0 0 7.25 7.55c18.1-1.45 36.3-2.91 45.2-3.65 4.47-0.373 6.19-0.461 7.94-0.787 0.219-0.0407 0.446-0.0803 0.851-0.203 0.405-0.123 0.782 0.275 2.74-1.63 0.977-0.954 2.88-3.94 2.43-7.51-0.29-2.28-1.06-3.49-1.81-4.35 0.426-0.121 0.962 0.242 2.9-2.09 0.996-1.2 2.44-4.65 1.76-7.77-0.68-3.12-2.16-4.22-2.9-4.79-0.201-0.156-0.252-0.147-0.415-0.259 2.91e-4 -0.0022 0.0086-0.0677 0.0086-0.0677-5.1e-5 -5.82e-4 -0.401-2.04-0.401-2.04-1.8e-4 -5.79e-4 -0.432-1.15-0.677-1.59-0.49-0.891-0.986-1.45-1.39-1.84-1.63-1.59-2.14-1.43-2.55-1.56-0.405-0.131-0.617-0.167-0.792-0.199-0.351-0.0646-0.527-0.078-0.699-0.0936-0.344-0.0313-0.615-0.0415-0.94-0.0538-0.65-0.0245-1.46-0.0395-2.47-0.0538-4.06-0.0573-11.4-0.0936-21.4-0.149-0.704-4e-3 -1.52-0.0138-2.25-0.0179 9.3-2.15 19.7-4.61 25.4-5.92 5.17-1.21 7.46-1.75 9.07-2.27 0.402-0.13 0.656-0.146 1.61-0.683 0.478-0.268 1.29 0.0431 2.94-3.09 0.824-1.56 1.39-5.17 0.431-7.69-0.962-2.52-2.28-3.35-3.01-3.82-2.93-1.86-2.63-0.956-2.99-0.986-0.361-0.0296-0.579-0.0305-0.776-0.0359-1.18-0.032-4.54-0.0306-8.24-0.0319 0.504-2.45 0.311-5.91-0.685-7.55-1.3-2.14-2.24-2.4-2.8-2.7-2.26-1.2-2.15-0.724-2.71-0.795-2.2-0.283-5.44-0.377-11.3-0.592-0.898-0.0328-2.36-0.103-3.36-0.139 0.966-0.213 2.26-0.514 3.15-0.707 9.85-2.16 14.1-3.04 16.6-3.52 0.638-0.119 1.2-0.218 1.71-0.317 0.511-0.0982 0.134 0.367 2.33-0.701 0.549-0.267 1.92 0.456 3.69-4.23 0.882-2.34 0.325-6.49-0.794-8.25-1.12-1.75-1.98-2.13-2.53-2.44-2.18-1.23-2.06-0.742-2.43-0.791-0.73-0.0972-1.25-0.114-2.08-0.153-3.34-0.158-10.7-0.339-17.8-0.562-7.12-0.223-14-0.485-22.4-0.709-8.4-0.224-18.3-0.411-28.1-0.598zm68.4 18.1c0.147 0.0109 0.537 0.038 0.477 0.0299-0.0416-0.0055-0.126 0.0615-0.477-0.0299zm-8.05 6.25c-0.0726 0.0123-0.115 0.0254-0.187 0.0359 0.092-0.0441 0.11-0.0186 0.187-0.0359zm16.6 26.6c0.0692 0.0015 0.482 2.94e-4 0.545 2e-3 0.155 0.0042 0.258 0.0128 0.15 4e-3 -0.0653-0.0053-0.187 0.129-0.696-6e-3z","m8.55 0c-3.58 0-6.49 3.34-6.49 7.47 0 4.12 2.9 7.47 6.49 7.47 6.65 0 11.1 0.0284 17.4 0.0331-3.94 1.03-8.41 2.2-10.6 2.79-0.819 0.227-1.51 0.402-2.44 0.766-0.465 0.182-0.882 0.156-2.23 1.3-0.672 0.573-2.07 1.59-2.59 4.7-0.519 3.1 1.3 6.39 2.4 7.38 0.545 0.494 0.751 0.517 1.11 0.755-0.851 0.793-1.7 2.04-1.92 4.9-0.182 2.34 0.842 4.76 1.76 5.9 0.918 1.14 1.65 1.54 2.21 1.84 0.944 0.509 1.56 0.69 2.17 0.838-1.84 0.486-3.3 0.907-4.29 1.22-0.573 0.181-1.06 0.264-2.19 0.815-0.564 0.276-1.61-0.521-3.49 3.62-0.943 2.07-0.548 6.47 0.701 8.25 1.25 1.79 2.16 2.06 2.75 2.33 2.35 1.09 2.65 0.734 3.96 0.84 1.3 0.106 2.99 0.184 5.33 0.249 0.967 0.0271 3.08 0.0164 4.25 0.0389-0.03 0.453 0.0463 0.927 0.098 1.4-2.79 0.294-7.31 0.716-8.76 0.912-0.7 0.0953-1.23 0.142-2.14 0.362-0.228 0.0549-0.477 0.109-0.958 0.298-0.481 0.188-1.27-0.522-3.31 2.84-1.02 1.68-1.39 5.87-0.314 8.03 0.158 0.316 0.293 0.383 0.448 0.63-0.508 0.0914-1.46 0.14-1.89 0.241-0.532 0.124-0.976 0.17-2.04 0.712-0.53 0.271-1.32 0.478-2.56 2.24-0.618 0.881-1.34 2.39-1.45 4.26s0.508 3.71 1.15 4.78c1.29 2.14 2.23 2.37 2.81 2.67 0.579 0.299 0.942 0.411 1.27 0.51 0.65 0.198 1.13 0.285 1.67 0.375 1.54 0.258 4.31 0.452 6.99 0.661 0.0178 0.111 0.098 0.609 0.098 0.609 1.18e-4 1.99e-4 1.89 2.09 1.89 2.09 2.8e-4 2.02e-4 0.772 0.486 1.02 0.601 0.245 0.114 0.421 0.179 0.566 0.229 0.29 0.101 0.458 0.142 0.591 0.173 1.07 0.25 0.834 0.133 0.97 0.144 1.08 0.0833 2.67 0.123 7.18 0.268 9.02 0.291 28.2 0.873 47.3 1.45 3.58 0.109 6.56-3.15 6.66-7.27-2e-3 -1.13-0.225-2.24-0.652-3.25 0.701-0.0264 2.38-0.0732 2.76-0.0953 0.271-0.0158 0.336 0.0035 0.939-0.0894 0.151-0.0232 0.305-0.0279 0.838-0.191 0.266-0.0814 0.597-0.129 1.45-0.665 0.214-0.134 0.77-0.57 0.77-0.57 3.18e-4 -2.72e-4 1.07-1.16 1.07-1.16 1.82e-4 -2.48e-4 0.923-1.85 1.08-2.17 1.29-0.0298 2.68-0.0594 3.47-0.0894 0.577-0.0219 1.03-0.0442 1.44-0.0739 0.41-0.0297 0.296 0.157 1.8-0.299 0.375-0.114 0.824 0.0351 2.36-1.34 0.384-0.343 0.855-0.825 1.34-1.62 0.242-0.398 0.484-0.879 0.686-1.44 0.202-0.566 0.437-1.91 0.438-1.91 8e-5 -7.61e-4 -0.0253-2.08-0.0253-2.08-1.04e-4 -7.63e-4 -0.259-1.29-0.459-1.82-0.4-1.06-0.901-1.77-1.32-2.26-1.67-1.96-2.22-1.73-2.63-1.88-0.408-0.156-0.616-0.203-0.792-0.245-0.704-0.168-0.9-0.164-1.25-0.204-0.693-0.0796-1.51-0.147-2.49-0.233-0.837-0.0735-2.51-0.187-3.65-0.28 0.199-0.404 0.481-1.07 0.481-1.07 2.07e-4 -5.98e-4 0.387-1.59 0.387-1.59 1.21e-4 -8.51e-4 -0.0995-1.5-0.167-2.52 0.137-0.0616 0.22-0.0839 0.427-0.202 0.205-0.117 0.453-0.269 0.782-0.527 0.329-0.258 1.25-1.29 1.26-1.29 4.23e-4 -5.67e-4 1.44-3.33 1.44-3.34 5.2e-5 -2.7e-4 0.0828-2.54 0.0828-2.54-2.6e-5 -2.64e-4 -0.616-2.32-0.617-2.32-2.17e-4 -5.13e-4 -1.79-2.54-1.79-2.54s-0.924-0.716-1.24-0.889c-1.26-0.692-1.52-0.587-1.79-0.636-1.09-0.198-0.941-0.0984-1.11-0.101-0.166-0.0027-0.293-2e-3 -0.414-2e-3 -0.963 0-2.41 0.0013-5.46-0.0525-0.439-0.0078-2.35-0.0252-2.88-0.035 0.639-0.112 3.1-0.579 3.52-0.648 0.421-0.0691 0.0365 0.255 1.99-0.453 0.244-0.0885 0.55-0.178 1.2-0.583 0.646-0.406 2.4-0.87 3.22-4.84 0.412-1.99-0.123-4.51-0.9-5.86-0.778-1.35-1.52-1.9-2.03-2.26-1.02-0.72-1.44-0.769-1.77-0.869-1.33-0.402-1.33-0.264-1.71-0.292-0.0603-0.0045-0.318-0.0055-0.382-0.0098 0.192-0.174 0.26-0.164 0.502-0.416 0.797-0.833 2.35-3 2.11-6.18-0.231-3.18-2-4.93-2.86-5.6-1.73-1.34-2.11-1.09-2.51-1.17-0.788-0.175-1.06-0.161-1.41-0.183-0.717-0.044-1.42-0.051-2.23-0.0603-1.68-0.0194-6.55-0.0346-9.66-0.0467 1.96-0.633 4.16-1.3 5.6-1.87 1.19-0.466 2.18-0.884 3.22-1.49 0.522-0.302 1.06-0.62 1.79-1.3 0.736-0.679 2.14-1.72 2.6-5.03 0.229-1.66-0.138-3.76-0.855-5.15-0.716-1.39-1.55-2.14-2.19-2.61-1.27-0.948-2-1.08-2.66-1.25-1.31-0.35-2.34-0.43-3.71-0.527-2.75-0.195-6.6-0.254-12.2-0.299-11.1-0.0915-29-0.0914-46.9-0.0914z","M 0,100 V 0 H 100 V 100 H 99 A 49,-98 0 0 0 50,2 49,-98 0 0 0 1,100 Z","M 0,0 V 100 H 100 V 0 H 99 A 49,98 0 0 1 50,98 49,98 0 0 1 1,0 Z","M 0,100 V 0 H 100 V 100 H 95 A 45,-90 0 0 0 50,10 45,-90 0 0 0 5,100 Z","m0 0v100h100v-100h-5a45 90 0 0 1-45 90 45 90 0 0 1-45-90z","M 0,100 V 0 H 100 V 100 H 90 A 40,-80 0 0 0 50,20 40,-80 0 0 0 10,100 Z","M 0,0 V 100 H 100 V 0 H 90 A 40,80 0 0 1 50,80 40,80 0 0 1 10,0 Z","m 0,0 v 100 h 10.035156 c 1.705045,-6.54927 3.941587,-12.742544 6.720703,-18.300782 l 20.09375,-40.1875 C 50.561077,14.088757 71.945169,12.702882 84.796875,38.40625 92.993332,54.799136 95.671807,78.132046 92.986328,100 H 100 V 0 Z","M 0,0 V 100 H 100 V 0 H 92.986328 C 91.461087,12.420096 88.21082,24.367414 83.244141,34.300782 L 63.150391,74.48828 C 49.438924,101.91124 28.054831,103.29712 15.203125,77.59375 4.9562739,57.10008 3.3279352,25.763198 10.035156,0 Z","M 100,0 C 98.542915,3.142831 97.022904,6.152491 95.425781,8.973086 L 62.601562,66.942421 C 40.203879,106.49781 13.008645,96.967171 1.625,45.571361 1.0225932,42.851581 0.48998452,40.055281 0,37.221491 V 100 h 100 z","M 0,0 V 10 C -1.5552177e-6,6.609576 0.10489712,3.277196 0.28515625,0 Z m 0,10 v 90 H 100 V 10 c 1e-5,44.31998 -15.860419,79.99998 -35.5625,80 H 35.5625 C 15.860418,90.00002 0,54.31999 0,10 Z m 100,0 V 0 H 99.714844 C 99.895106,3.277194 99.999998,6.609576 100,10 Z","M 0,0 V 99.999998 H 100 V 26.237487 A 61.723576,126.74566 7.430995 0 1 82.216797,52.190278 61.723576,126.74566 7.430995 0 1 1.3339844,8.692257 61.723576,126.74566 7.430995 0 1 0,0 Z"].forEach((t=>{const s=(0,a.T)("div",{className:"shape-setting-pod"});s.setAttribute("data",t),s.addEventListener("click",this.selectPreset,!0),s.appendChild(this.createPreview(t)),t===this.path&&(this.selected=s,this.selected.classList.add("active")),e.append(s)}));let t=e.querySelector(".active");t&&t.scrollIntoView({behavior:"auto",block:"center",inline:"nearest"})},this.createPreview=e=>{const t=i.vL(50,50),s=t.getContext("2d"),a=new Path2D;return a.addPath(new Path2D(e),(new DOMMatrix).scale(.48,.48)),s.translate(1,1),s.lineWidth=2,s.strokeStyle="rgba(255, 255, 255, .5)",s.fillStyle="rgba(0, 0, 0, 0.6)",s.fill(a),s.stroke(a),t},this.selectPreset=e=>{var t;null===(t=this.selected)||void 0===t||t.classList.remove("active"),this.selected=e.currentTarget,this.selected.classList.add("active"),this.path=this.selected.getAttribute("data"),this.preview&&this.preview(this.path),"x"===o.ZP.product&&this.cleanUp()},this.cleanUp=()=>{this.callback&&this.callback(this.path),this.container.remove(),this.modal.remove()},this.path=t,this.preview=h,this.callback=s,this.modal=(0,a.ZP)("workspace").appendChild((0,a.T)("div",{id:"shape-selector-modal",className:"modal"}));let l=(0,a.T)("div",{id:"shape-selector-presets"});this.container=(0,a.T)("div",{id:"shape-selector",className:"shape-float"},l),(0,a.ZP)("workspace").appendChild(this.container),this.modal.addEventListener("click",(e=>{e.stopPropagation(),e.preventDefault(),e.target===e.currentTarget&&this.cleanUp()}),!1);let c=e.getBoundingClientRect();if("x"===o.ZP.product)this.container.style.width="260px",this.container.style.top=c.bottom-15+"px",this.container.style.left="46px",this.container.offsetTop+this.container.offsetHeight>(0,a.ZP)("workspace").offsetHeight&&(this.container.style.top=(0,a.ZP)("workspace").offsetHeight-this.container.offsetHeight+"px");else{this.container.style.top=c.bottom-5+"px",this.container.style.left=c.left-~~(this.container.offsetWidth/2)+40+"px";const e=(0,a.T)("img",{src:"/img/icon/three-dot.svg",className:"resize ic"});(0,a.Rg)(e,this.resizeStart,this.resizeMove),this.container.append(e)}new n.Z((0,a.ZP)("shape-selector-presets")),this.populatePresets()}}},4188:(e,t,s)=>{s.d(t,{Z:()=>r});var i=s(6548),a=s(3655),n=s(3947);const o={step:[.01],range:[0,1],stops:[0,1],compact:!1,force:!1,defaultValue:0,labelFormat:e=>String(e),labelParse:e=>parseInt(e,10)};class r{constructor(e,t={}){if(this.findElements=()=>{this.outlet=this.container.querySelector("input"),this.slider=this.container.querySelector(".slider"),this.knob=this.container.querySelector(".slider .knob"),this.diff=this.container.querySelector(".slider .diff"),this.bounds=this.container.querySelector(".slider .bounds"),this.label=this.container.querySelector(".info label"),this.hold=this.container.querySelector(".slider-holder")},this.buildElements=()=>{this.container.classList.add("range-box"),this.label=document.createElement("label"),this.label.innerText=(this.options.label||this.name)+" ",this.outlet=document.createElement("input"),this.outlet.type="text",this.outlet.autocomplete="off",this.outlet.value=this.options.labelFormat(this.options.defaultValue);const e=document.createElement("div");e.className="info",e.appendChild(this.label),e.appendChild(this.outlet),this.knob=document.createElement("div"),this.knob.innerHTML="<div></div>",this.knob.className="knob",this.bounds=(0,n.T)("div",{className:"bounds"},this.knob),this.diff=(0,n.T)("div",{className:"diff"},this.bounds),this.slider=(0,n.T)("div",{className:"slider"},this.diff),this.hold=(0,n.T)("div",{className:"slider-holder"},this.slider),this.container.appendChild(e),this.container.appendChild(this.hold)},this.labelOver=()=>{this.value!==this.options.defaultValue&&(this.label.innerText=(0,i.Z)("reset")+" ")},this.labelOut=()=>{this.label.innerText=(this.options.label||this.name)+" "},this.labelClick=()=>{if(this.value===this.options.defaultValue)return;const e=this.value;this.options.onStart&&this.options.onStart(this.value,this.name),this.reset(),this.options.onChange&&this.options.onChange(this.value,this.name),this.options.onEnd&&this.options.onEnd(this.value,e,this.name)},this.sliderMouseDown=e=>{e.preventDefault(),e.stopPropagation(),this.knobDown(e),this.move(e.clientX)},this.knobDown=e=>{document.addEventListener("mousemove",this.knobMouseMove,!1),document.addEventListener("touchmove",this.knobTouchMove,{passive:!1}),document.addEventListener("mouseup",this.knobUp,!0),document.addEventListener("touchend",this.knobUp,{passive:!1}),this.knob.classList.add("grabbed"),e.preventDefault(),e.stopPropagation(),this.downValue=this.value,this.options.onStart&&setTimeout((()=>this.options.onStart(this.downValue,this.name)),0)},this.move=e=>{const t=this.bounds.getBoundingClientRect();if(e<=t.left)return void this.setAmount(0);if(e>=t.right)return void this.setAmount(1);const s=(e-t.left)/t.width;this.setAmount(s)},this.knobMouseMove=e=>{e.preventDefault(),e.stopPropagation(),this.move(e.clientX)},this.knobTouchMove=e=>{e.preventDefault(),e.stopPropagation(),this.move(e.touches[0].clientX)},this.knobUp=()=>{if(document.removeEventListener("mousemove",this.knobMouseMove,!1),document.removeEventListener("touchmove",this.knobTouchMove),document.removeEventListener("mouseup",this.knobUp,!0),document.removeEventListener("touchend",this.knobUp),this.knob.classList.remove("grabbed"),this.options.onEnd&&(this.options.force||this.downValue!==this.value)){const e=this.downValue;this.downValue=this.value,setTimeout((()=>this.options.onEnd(this.value,e,this.name)),0)}},this.outletKeyUp=e=>{const t=this.options.labelParse(this.outlet.value);if(isNaN(t))return;const s=this.options.range[0],i=this.options.range[this.options.range.length-1],a=Math.max(Math.min(t,i),s);this.value=a,this.slider.classList.toggle("changed",this.value!==this.options.defaultValue),this.diff.style.backgroundImage=this.generateDiff(this.options.defaultValue,this.value);const n=this.calculateAmount(this.value);this.setKnob(100*n),this.options.onChange&&void 0!==e&&setTimeout((()=>this.options.onChange(this.value,this.name)),0)},this.outletFocus=e=>{if(this.options.onStart&&(this.downValue=this.value,this.options.onStart(this.value,this.name)),this.options.compact){this.hold.style.display="block";const e=a.HS(this.container);this.hold.style.left=e.x+this.container.offsetWidth-this.hold.offsetWidth+10+"px",this.hold.style.top=e.y+34+"px"}},this.outletBlur=e=>{this.options.compact&&(this.hold.style.display="none");const t=this.options.labelParse(this.outlet.value);isNaN(t)||(this.outlet.value=this.options.labelFormat(this.value),this.options.onEnd&&(this.options.force||this.downValue!==this.value)&&void 0!==e&&this.options.onEnd(this.value,this.downValue,this.name))},this.calculateAmount=e=>{for(let t=1;t<this.options.range.length;t++){const s=this.options.range[t-1],i=this.options.range[t];if(e>=s&&e<=i){const a=this.options.stops[t-1];return a+(e-s)/(i-s)*(this.options.stops[t]-a)}}if(e==this.options.defaultValue)throw new Error("Cant recurse on default value with calculateAmount, this is a bug");return this.calculateAmount(this.options.defaultValue)},this.setKnob=e=>{const t=100*this.calculateAmount(this.options.defaultValue),s=this.generateDiff(t,e);requestAnimationFrame((()=>{this.knob.style.marginLeft=`${e}%`,this.diff.style.backgroundImage=s}))},this.roundToStep=(e,t,s,i)=>{const a=e%t;return 0===a||e===s||e===i?e:e-a},this.generateDiff=(e,t)=>{if(e===t)return"none";const s="var(--accent-color)",i=this.knob.clientWidth-3;return(t*=this.bounds.clientWidth/this.diff.clientWidth)>e?`linear-gradient(to right, transparent 0%, transparent ${e}%, ${s} ${e}%, ${s} calc(${t}%), transparent calc(${t}%), transparent 100%)`:`linear-gradient(to right, transparent 0%, transparent calc(${t}% + ${i}px), ${s} calc(${t}% + ${i}px), ${s} ${e}%, transparent ${e}%, transparent 100%)`},this.setAmount=(e,t=!1)=>{const[s,i]=this.bucket(e),a=this.options.range[s],n=this.options.range[s+1],o=this.options.step[s];this.setKnob(100*e),this.value=this.roundToStep(i*(n-a)+a,o,a,n),this.slider.classList.toggle("changed",this.value!==this.options.defaultValue),this.outlet.value=this.options.labelFormat(this.value),this.options.onChange&&!t&&setTimeout((()=>this.options.onChange(this.value,this.name)),0)},this.bucket=e=>{for(let t=1;t<this.options.stops.length;t++){const s=this.options.stops[t-1],i=this.options.stops[t];if(e>=s&&e<=i)return[t-1,(e-s)/(i-s)]}throw new Error(`Could not assign ${e} to a bucket, this is a bug`)},this.setValue=(e,t=!1)=>{const s=this.value;void 0===e&&(e=this.options.defaultValue);const i=this.options.range[0],a=this.options.range[this.options.range.length-1];this.value=Math.max(Math.min(e,a),i),this.slider.classList.toggle("changed",this.isChanged()),this.outlet.value=this.options.labelFormat(this.value);const n=this.calculateAmount(this.value);this.setKnob(100*n),(this.options.onChange||this.options.onEnd)&&t&&setTimeout((()=>{this.options.onChange&&this.options.onChange(this.value,this.name),this.options.onEnd&&this.options.onEnd(this.value,s,this.name)}),0)},this.isChanged=()=>this.value!==this.options.defaultValue,this.getValue=()=>{var e;return null!==(e=this.value)&&void 0!==e?e:0},this.reset=()=>{this.value=this.options.defaultValue,this.setKnob(100*this.calculateAmount(this.value)),this.slider.classList.remove("changed"),this.outlet.value=this.options.labelFormat(this.value),this.label.innerText=(this.options.label||this.name)+" "},this.cleanUp=()=>{document.removeEventListener("mousemove",this.knobMouseMove,!1),document.removeEventListener("touchmove",this.knobTouchMove),document.removeEventListener("mouseup",this.knobUp,!0),document.removeEventListener("touchend",this.knobUp),this.knob.removeEventListener("mousedown",this.knobDown,!1),this.knob.removeEventListener("touchstart",this.knobDown),this.slider.removeEventListener("mousedown",this.sliderMouseDown,!1),this.outlet.removeEventListener("focus",this.outletFocus,!1),this.outlet.removeEventListener("keyup",this.outletKeyUp,!1),this.outlet.removeEventListener("blur",this.outletBlur,!1),this.options.compact||(this.label.removeEventListener("mouseover",this.labelOver,!1),this.label.removeEventListener("mouseleave",this.labelOut,!1),this.label.removeEventListener("click",this.labelClick,!1))},this.name=e,this.container=(0,n.ZP)(e),this.options=Object.assign(Object.assign({},o),t),this.value=this.options.defaultValue,Array.isArray(this.options.step)||(this.options=Object.assign(Object.assign({},this.options),{step:[this.options.step]})),this.options.stops.length<2)throw new Error("Slider need to have atleast two stops, default is [0,1]");if(this.options.range.length!=this.options.stops.length)throw new Error("Slider range option and slide stops option, needs to be the same length");if(this.options.step.length!=this.options.stops.length-1)throw new Error("Step array must be the same length as the number of ranges (slider options range - 1)");this.options.compact&&this.container.classList.add("compact");!!this.container.querySelector(".slider")?this.findElements():this.buildElements(),this.knob.addEventListener("mousedown",this.knobDown,!1),this.knob.addEventListener("touchstart",this.knobDown,{passive:!1}),this.slider.addEventListener("mousedown",this.sliderMouseDown,!1),this.outlet.addEventListener("focus",this.outletFocus,!1),this.outlet.addEventListener("keyup",this.outletKeyUp,!1),this.outlet.addEventListener("blur",this.outletBlur,!1),this.options.compact||(this.label.addEventListener("mouseover",this.labelOver,!1),this.label.addEventListener("mouseleave",this.labelOut,!1),this.label.addEventListener("click",this.labelClick,!1)),this.outlet.value!==this.options.labelFormat(this.options.defaultValue)?(this.outletKeyUp(void 0),this.outletBlur(void 0)):this.reset()}hide(){this.container.style.display="none"}show(){this.container.style.display="block"}disable(){this.container.style.pointerEvents="none",this.container.style.opacity="0.4"}enable(){this.container.style.pointerEvents="auto",this.container.style.opacity="1.0"}}},7549:(e,t,s)=>{s.d(t,{Z:()=>n});var i=s(3947),a=s(3673);class n{constructor(e){this.verticalDrag=e=>{e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();let t=(e.clientY-this.downPoint.y)/this.spaceHeightRatio/this.stage.zoom;this.stage.setAnchor(this.downPos.add(new a.Z(0,t))),this.stage.updateViewport()},this.verticalStop=e=>{e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),document.removeEventListener("pointermove",this.verticalDrag,!0),document.removeEventListener("pointerup",this.verticalStop,!0)},this.horizontalDrag=e=>{e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();let t=(e.clientX-this.downPoint.x)/this.spaceWidthRatio/this.stage.zoom;this.stage.setAnchor(this.downPos.add(new a.Z(t,0))),this.stage.updateViewport()},this.horizontalStop=e=>{e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),document.removeEventListener("pointermove",this.horizontalDrag,!0),document.removeEventListener("pointerup",this.horizontalStop,!0)},this.resize=()=>{this.verticalHolder.style.top=this.stage.raster.offsetTop+"px",this.verticalHolder.style.left=this.stage.raster.offsetLeft+this.stage.raster.offsetWidth-16+"px",this.verticalHolder.style.height=this.stage.raster.offsetHeight-16+"px",this.horizontalHolder.style.top=this.stage.raster.offsetTop+this.stage.raster.offsetHeight-16+"px",this.horizontalHolder.style.left=this.stage.raster.offsetLeft+"px",this.horizontalHolder.style.width=this.stage.raster.offsetWidth+"px",this.spaceHeight=this.stage.raster.offsetHeight-20,this.spaceWidth=this.stage.raster.offsetWidth-181,this.render()},this.render=()=>{if(!this.stage.fresco)return;this.imageInfo.innerText=this.stage.fresco?this.stage.fresco.width+" x "+this.stage.fresco.height+" px @ "+Math.round(100*this.stage.zoom)+"%":"";let e=this.stage.fresco.width*this.stage.zoom,t=this.stage.fresco.height*this.stage.zoom;this.horizontalSlider.style.display=this.stage.raster.width<=e?"block":"none",this.verticalSlider.style.display=this.stage.raster.height<=t?"block":"none",this.spaceHeightRatio=this.spaceHeight/(t+500),this.spaceWidthRatio=this.spaceWidth/(e+500);const s=Math.round(this.spaceWidth*(this.stage.raster.width/(e+500))),i=Math.round(this.spaceHeight*(this.stage.raster.height/(t+500))),a=-1*(this.stage.offset.x-250)/(e+500),n=-1*(this.stage.offset.y-250)/(t+500),o=Math.round((this.spaceWidth-(s<30?30-s:0))*a),r=Math.round((this.spaceHeight-(i<30?30-i:0))*n);this.horizontalSlider.style.width=Math.max(s,30)+"px",this.horizontalSlider.style.left=162+o+"px",this.verticalSlider.style.height=Math.max(i,30)+"px",this.verticalSlider.style.top=2+r+"px"},this.stage=e,this.verticalSlider=(0,i.T)("div",{id:"vertical-scroll-slider"}),this.verticalHolder=(0,i.T)("div",{id:"vertical-scroll-holder"},this.verticalSlider),(0,i.ZP)("workspace").appendChild(this.verticalHolder),this.imageInfo=(0,i.T)("div",{id:"horizontal-image-info"}),this.horizontalSlider=(0,i.T)("div",{id:"horizontal-scroll-slider"}),this.horizontalHolder=(0,i.T)("div",{id:"horizontal-scroll-holder"},this.imageInfo,this.horizontalSlider),(0,i.ZP)("workspace").appendChild(this.horizontalHolder),document.addEventListener("viewport-update",this.render),this.verticalHolder.addEventListener("click",(e=>{e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();let t=(e.offsetY-2)/this.spaceHeightRatio/this.stage.zoom,s=this.stage.anchor.clone();s.y=t,this.stage.setAnchor(s),this.stage.updateViewport()}),!1),this.verticalSlider.addEventListener("click",(e=>(e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),!1)),!0),this.verticalSlider.addEventListener("pointerdown",(e=>{e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),this.stage.resetAnchor(),this.downPoint=new a.Z(e.clientX,e.clientY),this.downPos=this.stage.anchor.clone(),document.addEventListener("pointermove",this.verticalDrag,!0),document.addEventListener("pointerup",this.verticalStop,!0)}),!0),this.horizontalHolder.addEventListener("click",(e=>{if(e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),e.offsetX-160>this.spaceWidth)this.stage.setZoom("fit");else if(e.offsetX>160){let t=(e.offsetX-160)/this.spaceWidthRatio/this.stage.zoom,s=this.stage.anchor.clone();s.x=t,this.stage.setAnchor(s),this.stage.updateViewport()}}),!1),this.horizontalSlider.addEventListener("click",(e=>(e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),!1)),!0),this.horizontalSlider.addEventListener("pointerdown",(e=>{e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),this.stage.resetAnchor(),this.downPoint=new a.Z(e.clientX,e.clientY),this.downPos=this.stage.anchor.clone(),document.addEventListener("pointermove",this.horizontalDrag,!0),document.addEventListener("pointerup",this.horizontalStop,!0)}),!0)}}},3655:(e,t,s)=>{s.d(t,{$E:()=>Z,$n:()=>u,Ai:()=>T,Bs:()=>g,CD:()=>q,CE:()=>d,Dc:()=>K,Ds:()=>W,EL:()=>V,HS:()=>se,L5:()=>ie,M$:()=>J,M8:()=>O,Mk:()=>ae,PP:()=>te,ST:()=>A,Sy:()=>$,TA:()=>c,Td:()=>b,UF:()=>f,WL:()=>R,XE:()=>o,XI:()=>p,Xj:()=>D,ZE:()=>S,Zd:()=>U,_c:()=>k,aG:()=>y,d4:()=>Y,dN:()=>I,eY:()=>L,fg:()=>M,fu:()=>X,gr:()=>G,iF:()=>Q,jb:()=>B,k3:()=>ne,kD:()=>h,l:()=>z,lI:()=>P,lU:()=>x,ly:()=>ee,mS:()=>m,q7:()=>v,qT:()=>E,uZ:()=>H,vJ:()=>C,vL:()=>w,vO:()=>N,wf:()=>r,x2:()=>_,xZ:()=>l,zs:()=>F});var i=s(6548),a=s(6817),n=s(3673);const o="rgba(255,255,255, 0.7)",r="rgb(255,255,255)",h="rgb(32,209,139)",l="rgb(0,163,218)",c="rgb(209,72,14)",d="rgb(255,0,255)",u="rgb(67,201,143)",p="rgb(75,75,75)",g="rgb(148,148,148)";function m(e,t){if(void 0===t)return;if(t instanceof e)return t;const s=Object.create(e.prototype);return Object.assign(s,t)}function v(e,t,s,i){let a;return a=e/t>s/i?s/e:i/t,a>1?1:a}function f(e,t,s,i){return e/t<s/i?s/e:i/t}function y(e,t,s,i,a,n){return n>=t&&n<t+i&&a>=e&&a<e+s}function w(e,t){e<0&&(e=1),t<0&&(t=1);let s=document.createElement("canvas");return s.width=e,s.height=t,s}async function b(e){if(!e)return;const t=URL.createObjectURL(e),s=await x(t);return URL.revokeObjectURL(t),s}function x(e){if(void 0!==e)return new Promise(((t,s)=>{if(!e)return console.log("Invalid URL in dataURLToCanvas"),void t(void 0);const i=document.createElement("canvas"),a=i.getContext("2d"),n=new Image;n.onerror=e=>s(e),n.onload=()=>{i.width=n.width,i.height=n.height,a.drawImage(n,0,0),t(i)},n.src=e}))}function Z(e,t){if(!e)return;const s=t||new a.Z(0,0,e.width,e.height);return e.getContext("2d").getImageData(s.x,s.y,s.width,s.height)}function k(e,t){if(!e)return;const s=t||new a.Z(0,0,e.width,e.height),i=w(s.width,s.height);return i.getContext("2d").drawImage(e,-s.x,-s.y),new Promise(((e,t)=>i.toBlob(e)))}function P(e,t,s){if(!e||!t)return;let i=e.getContext("2d");i.save(),i.globalCompositeOperation="copy",i.drawImage(t,s.x,s.y),i.restore(),i=void 0}function E(e,t,s=0){let i=w(e.width,e.height),n=i.getContext("2d");if(n.drawImage(e,0,0,e.width,e.height),n=void 0,i.width>t||i.height>t){let s=a.Z.bestFit(e.width,e.height,t,t);i=T(i,s.width,s.height)}return 0!==s&&(i=D(i,s)),i}function S(e,t,s){if(!e)return;let i=w(t,s);var a=e.getContext("2d").getImageData(0,0,e.width,e.height),n=new Int32Array(a.data.buffer),o=e.width,r=e.height,h=i.width,l=i.height,c=i.getContext("2d").getImageData(0,0,i.width,i.height),d=new Int32Array(c.data.buffer);const u=h/o,p=l/r;for(let g=0;g<l;){const e=o*~~(g/p),t=h*g++;for(let s=0;s<h;)d[t+s++]=n[e+~~(s/u)]}return i.getContext("2d").putImageData(c,0,0),i}function T(e,t,s,i){var a;if(!e)return;if(t>e.width||s>e.width)return L(e,t,s);let n=null!==(a=i)&&void 0!==a?a:w(t,s);for(var o=e.getContext("2d").getImageData(0,0,e.width,e.height).data,r=e.width,h=e.height,l=n.width,c=n.height,d=n.getContext("2d").getImageData(0,0,n.width,n.height),u=d.data,p=r/l,g=h/c,m=Math.ceil(p/2),v=Math.ceil(g/2),f=0;f<c;f++)for(var y=0;y<l;y++){for(var b=4*(y+f*l),x=0,Z=0,k=0,P=0,E=0,S=0,T=(f+.5)*g,C=Math.floor(f*g);C<(f+1)*g;C++)for(var M=Math.abs(T-(C+.5))/v,A=(y+.5)*p,R=M*M,I=Math.floor(y*p);I<(y+1)*p;I++){var D=Math.abs(A-(I+.5))/m,F=Math.sqrt(R+D*D);F>=-1&&F<=1&&(x=2*F*F*F-3*F*F+1)>0&&(k+=x*o[D=4*(I+C*r)],P+=x*o[D+1],E+=x*o[D+2],S+=x*o[D+3],Z+=x)}u[b]=k/Z,u[b+1]=P/Z,u[b+2]=E/Z,u[b+3]=S/Z}return n.getContext("2d").putImageData(d,0,0),n}async function C(e,t,s,i){var a;if(!e)return;if(t>e.width||s>e.width)return L(e,t,s);let n=null!==(a=i)&&void 0!==a?a:w(t,s);var o=e.getContext("2d").getImageData(0,0,e.width,e.height).data,r=e.width,h=e.height,l=n.width,c=n.height;for(var d=n.getContext("2d").getImageData(0,0,n.width,n.height),u=d.data,p=r/l,g=h/c,m=Math.ceil(p/2),v=Math.ceil(g/2),f=0;f<c;f++)for(var y=0;y<l;y++){for(var b=4*(y+f*l),x=0,Z=0,k=0,P=0,E=0,S=0,T=(f+.5)*g,C=Math.floor(f*g);C<(f+1)*g;C++)for(var M=Math.abs(T-(C+.5))/v,A=(y+.5)*p,R=M*M,I=Math.floor(y*p);I<(y+1)*p;I++){var D=Math.abs(A-(I+.5))/m,F=Math.sqrt(R+D*D);F>=-1&&F<=1&&(x=2*F*F*F-3*F*F+1)>0&&(k+=x*o[D=4*(I+C*r)],P+=x*o[D+1],E+=x*o[D+2],S+=x*o[D+3],Z+=x)}u[b]=k/Z,u[b+1]=P/Z,u[b+2]=E/Z,u[b+3]=S/Z}return n.getContext("2d").putImageData(d,0,0),n}function L(e,t,s,i=!0,a){if(!e)return;t<1&&(t=1),s<1&&(s=1);let n=null!=a?a:w(t,s);var o=n.getContext("2d");return o.imageSmoothingQuality="high",o.imageSmoothingEnabled=i,o.drawImage(e,0,0,n.width,n.height),o=void 0,n}function M(e,t){let s=w(t.width,t.height),i=s.getContext("2d");return i.drawImage(e,-t.x,-t.y),i=void 0,s}function A(e,t,s){let i=w(s.width,s.height),a=i.getContext("2d");return a.imageSmoothingQuality="high",a.imageSmoothingEnabled=!0,a.drawImage(e,t.x-s.x,t.y-s.y,t.width,t.height),a=void 0,i}function R(e,t){if(e){var s=document.createElement("canvas"),i=s.getContext("2d");return s.width=t.width,s.height=t.height,i.drawImage(e,-t.x,-t.y),i=void 0,s}}function I(e){if(e){var t=document.createElement("canvas"),s=t.getContext("2d");return t.width=e.width,t.height=e.height,s.drawImage(e,0,0),s=void 0,t}}function D(e,t){if(e){var s=w(e.width,e.height),i=s.getContext("2d");return 180!==t&&(s.width=e.height,s.height=e.width),i.translate(s.width/2,s.height/2),i.rotate(t*Math.PI/180),i.drawImage(e,-e.width/2,-e.height/2),i.setTransform(1,0,0,1,0,0),i=void 0,s}}function F(e,t,s){let i=w(s.width,s.height),a=i.getContext("2d");return a.save(),a.translate(s.width/2,s.height/2),a.rotate(t*Math.PI/180),a.drawImage(e,-e.width/2,-e.height/2),a.restore(),a=null,i}function _(e,t){if(e){var s=w(e.width,e.height),i=s.getContext("2d");return i.save(),t?(i.scale(1,-1),i.drawImage(e,0,-e.height,e.width,e.height)):(i.scale(-1,1),i.drawImage(e,-e.width,0,e.width,e.height)),i.restore(),i=void 0,s}}function z(e){if(!e)return;const t=e.width,s=e.height;return N(e.getContext("2d").getImageData(0,0,t,s))}function N(e){if(!e)return;const t=e.width,s=e.height;let i,n,o=new Uint32Array(e.data.buffer),r=-1,h=-1,l=-1,c=-1;for(n=0;n<s;++n){for(i=0;i<t;++i)if(o[i+n*t]>0){h=n;break}if(-1!==h)break}if(-1!==h){for(n=s-1;n>=h;--n){for(i=0;i<t;++i)if(o[i+n*t]>0){c=n+1;break}if(-1!==c)break}for(i=0;i<t;++i){for(n=h;n<=c;++n)if(o[i+n*t]>0){r=i;break}if(-1!==r)break}for(i=t-1;i>=r;--i){for(n=h;n<=c;++n)if(o[i+n*t]>0){l=i+1;break}if(-1!==l)break}return new a.Z(r,h,l-r,c-h)}}function B(e){let t=e/1024;return t>1024?(t/1024).toFixed(1)+"mb":t>100?Math.round(t)+"kb":Math.round(10*t)/10+"kb"}function O(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))}function U(){return"xxxxyxxx4xxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))}function H(e,t,s){return isNaN(e)?t:Math.min(Math.max(e,t),s)}const q=(e,t,s)=>t*s+e*(1-s);function $(e){for(let t=e.length-1;t>0;t--){const s=Math.floor(Math.random()*(t+1));[e[t],e[s]]=[e[s],e[t]]}return e}function V(e){let t=!1,s=e.getContext("2d").getImageData(0,0,e.width,e.height).data;for(var i=0;i<s.length;i+=4)if(s[i+3]<255){t=!0;break}return t}function G(e){let t=new n.Z(0,255);var s=Array(256);s.fill(0);var i=e.getContext("2d").getImageData(0,0,e.width,e.height).data;for(let n=0;n<i.length;n+=4)s[i[n]]+=1,s[i[n+1]]+=1,s[i[n+2]]+=1;var a=Math.round(e.width*e.height/1e3);let o;for(o=0;o<256;++o)if(s[o]>a){t.x=o;break}for(o=255;o>=0;--o)if(s[o]>a){t.y=o;break}return t.x>100&&(t.x=100),t.y<155&&(t.y=155),t}function X(e){let t=1,s=1,i=e.width<500&&e.height<500?e:L(e,500,500);const a=i.width,n=i.height;let o,r,h,l,c,d,u,p,g,m=i.getContext("2d").getImageData(0,0,a,n).data;for(c=n;c--;)for(l=a;l--;)d=4*(c*a+l),o=m[d],r=m[d+1],h=m[d+2],u=Math.min(o,r,h),p=Math.max(o,r,h),s+=p/255,g=p-u,g&&(t+=g/p);return t=(t+s)/(i.width*i.height*2),t}const j={};function W(e,t,s){window.clearTimeout(j[e]),j[e]=window.setTimeout((()=>{delete j[e],s()}),t)}const Y=(e,t)=>{let s;return(...i)=>{clearTimeout(s),s=window.setTimeout((()=>t(...i)),e)}};function K(e){return new Promise(((t,s)=>{setTimeout((()=>t()),e)}))}function Q(){return new Promise(((e,t)=>{window.requestAnimationFrame((()=>{window.requestAnimationFrame((()=>{e()}))}))}))}function J(e){return(e/1e3).toFixed(1)+"s"}function ee(e){const t=((new Date).getTime()-e.getTime())/1e3;if(t<0)return"It's the future man";const s=Math.floor(t/86400);if(s>=1)return s>1?(0,i.Z)("sinceDays",s):(0,i.Z)("sinceDay");const a=Math.floor(t/3600);if(a>=1)return a>1?(0,i.Z)("sinceHours",a):(0,i.Z)("sinceHour");const n=Math.floor(t/60);return n>=1?n>1?(0,i.Z)("sinceMinutes",n):(0,i.Z)("sinceMinute"):(0,i.Z)("sinceNow")}function te(e){if(!e)return!1;if("TEXTAREA"===e.nodeName)return!0;if("INPUT"===e.nodeName){const t=e,s=t.type.toLowerCase();return"text"===s||"number"===s||"url"===s||!!t.contentEditable}return!1}function se(e){let t=new n.Z(e.offsetLeft,e.offsetTop);for(;e.offsetParent&&(t.x=t.x+e.offsetParent.offsetLeft,t.y=t.y+e.offsetParent.offsetTop,e!=document.getElementsByTagName("body")[0]);)e=e.offsetParent;return t}class ie{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}then(e,t){return this.promise.then(e,t)}catch(e){return this.promise.catch(e)}finally(e){return this.promise.finally(e)}}Symbol.toStringTag;class ae extends Error{constructor(){super("Promise canceled")}}class ne extends ie{constructor(e,t){super(),this.canceled=!1,this.isCanceled=()=>this.canceled,this.cancel=()=>{this.canceled||(this.canceled=!0,this.cancelCallback(),this.reject(new ae))},this.cancelCallback=t,(async()=>{try{this.resolve(await e())}catch(t){this.reject(t)}})()}}},5182:(e,t,s)=>{s.a(e,(async(e,i)=>{try{s.d(t,{Z:()=>k});var a=s(6548),n=s(3607),o=s(3947),r=s(3655),h=s(4375),l=s(9091),c=s(9872),d=s(6817),u=s(1030),p=s(3673),g=s(6792),m=s(4820),v=s(7163),f=s(7758),y=s(5934),w=s(840),b=s(7630),x=e([n,l]);[n,l]=x.then?(await x)():x;var Z=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,s=e[Symbol.asyncIterator];return s?s.call(e):(e="function"==typeof __values?__values(e):e[Symbol.iterator](),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(s){t[s]=e[s]&&function(t){return new Promise((function(i,a){(function(e,t,s,i){Promise.resolve(i).then((function(t){e({value:t,done:s})}),t)})(i,a,(t=e[s](t)).done,t.value)}))}}};class k{constructor(){let e;if(this.optimizeForPWA=()=>{if((0,o.ZP)("language")&&((0,o.ZP)("language").style.display="none"),(0,o.ZP)("app-selector")){const e=(0,o.ZP)("app-selector").getElementsByTagName("a");for(let t=0;t<e.length;t++)e[t].setAttribute("target","_blank")}(0,o.ZP)("logo")&&(0,o.ZP)("logo").setAttribute("target","_blank")},this.navigateBack=e=>{e.preventDefault(),e.stopPropagation();let t=location.hash?location.hash.replace("#",""):void 0;"editor"!==t||this.stage.fresco||(t="home"),this.navigate(null==t?void 0:t.split("&")[0],!1),e.returnValue=void 0},this.navigate=(e,t=!0)=>{if(!e||this.section!==e){if("editor"===e){if(this.section=e,(0,o.ZP)("home").style.display="none",(0,o.ZP)("workspace").style.display="block","e"===m.ZP.product||"x"===m.ZP.product)if("localhost"!==location.hostname&&!m.ZP.user.subscription&&!(0,o.ZP)("right-space")&&document.body.clientWidth>1024){const e=(0,o.T)("div",{id:"right-space"});document.body.appendChild(e);try{document.body.clientWidth>1600?((0,u.Z)("ads","cut"),e.style.width="300px",(0,o.ZP)("workspace").style.right="304px",e.appendChild((0,o.T)("iframe",{id:"iasriiigh",src:"/dad/cut/",frameBorder:"0",scrolling:"no",style:"width:300px;height:100%;overflow:hidden;"}))):((0,u.Z)("ads","slot"),e.style.width="160px",(0,o.ZP)("workspace").style.right="164px",e.appendChild((0,o.T)("iframe",{id:"iasriiigh",src:"/dad/slot/",frameBorder:"0",scrolling:"no",style:"width:160px;height:100%;overflow:hidden;"})))}catch(s){console.log(s)}const t=()=>{(0,o.ZP)("iasriiigh").src=(0,o.ZP)("iasriiigh").src};window.setInterval(t,18e4)}else(0,o.ZP)("right-space")&&((0,o.ZP)("right-space").style.display="block");document.dispatchEvent(new CustomEvent("resize"))}else(0,o.ZP)("home").style.display="block",(0,o.ZP)("workspace").style.display="none",(0,o.ZP)("right-space")&&((0,o.ZP)("right-space").style.display="none"),this.section=e||(this.home.section?this.home.section:"home"),this.home.activate(this.section);t&&this.section&&history.pushState(null,null,"#"+this.section),"e"===m.ZP.product&&(0,o.ZP)("title-bar")&&((0,o.ZP)("title-bar").style.display=this.isHome()?"flex":"none"),this.home.showOrHideBackToEditor()}},this.selectTool=e=>{},this.i18nReplace=(e,...t)=>{const[s]=t;return(0,a.Z)(s)},this.CDNUrlReplace=(e,t)=>e.replace(t,`${m.ZP.cdnUrl}${t}`),this.isHome=()=>"none"===(0,o.ZP)("workspace").style.display,this.tabSelect=e=>{this.stage.select(e)},this.tabClose=e=>{this.stage.close(e),0===this.stage.tabs.length&&this.navigate()},this.center=e=>{const t=this.stage.canvas.getBoundingClientRect();return new p.Z(this.isHome()?Math.round(document.body.clientWidth/2-e.clientWidth/2):Math.round(t.width/2+t.left-e.clientWidth/2),this.isHome()?Math.round(document.body.clientHeight/2-e.clientHeight/2):Math.round(t.height/2+t.top-e.clientHeight/2))},this.notification=e=>{const t=(0,o.ZP)("notification");t&&(this.notiId&&(clearTimeout(this.notiId),t.innerHTML="",t.style.display="none"),requestAnimationFrame((()=>{t.style.display="block",t.innerHTML='<div class="message">'+e.detail+"</div>";const s=this.center(t);t.style.top=s.y+"px",t.style.left=s.x+"px"})),this.notiId=setTimeout((function(){t.innerHTML="",t.style.top="-999px",t.style.left="-999px",t.style.display="none"}),800))},this.legend=e=>{const t=(0,o.ZP)("notification");if(!t)return;if("stop"===e.detail)return t.innerHTML="",t.style.top="-999px",t.style.left="-999px",void(t.style.display="none");t.style.display="block",""===t.innerHTML?t.innerHTML='<div id="legend" class="legend">'+e.detail+"</div>":(0,o.ZP)("legend")&&((0,o.ZP)("legend").innerText=e.detail);const s=this.center(t);t.style.top=Math.round(s.y/3)+"px",t.style.left=s.x+"px"},this.loading=e=>{const t=(0,o.ZP)("notification");if(!t)return;if("stop"===e.detail)return void(this.keepLoading?this.keepLoading=!1:(t.innerHTML="",t.style.display="none"));this.notiId&&(clearTimeout(this.notiId),t.innerHTML="",t.style.display="none"),this.notiId=setTimeout((()=>{this.keepLoading?this.keepLoading=!1:(t.innerHTML="",t.style.top="-999px",t.style.left="-999px",t.style.display="none")}),400),t.style.display="block",t.innerHTML=`\n            <div class="spinner">\n                ${"start"===e.detail?"Loading":e.detail}<span>.</span><span>.</span><span>.</span>\n            </div>\n        `;const s=this.center(t);t.style.top=s.y+"px",t.style.left=s.x+"px",this.keepLoading=!0},this.loadView=(e,t,s)=>{const i=/([a-zA-Z]{1}[a-zA-Z0-9]*)/g,a=/<img src="([^'"]+.(?:svg|jpg))"/g;return new Promise(((n,r)=>{let h=new XMLHttpRequest;h.open("GET","/view/"+m.ZP.product+"/"+e+".html",!0),h.onreadystatechange=()=>{if(4!==h.readyState)return;if(200!==h.status)return void r("Non 200 status code");let l=h.responseText.replace(a,this.CDNUrlReplace);l=l.replace(i,this.i18nReplace);const c=document.createElement("section");c.id=e,c.innerHTML=l,s&&(c.className=s),(t?(0,o.ZP)(t):(0,o.ZP)("workspace")).appendChild(c),n(c)},h.send()}))},this.dragOver=e=>{if(e.preventDefault(),e.stopPropagation(),!(0,o.ZP)("modal-drop")){const e=document.createElement("div");e.id="modal-drop",e.classList.add("modal","dim","vertical-align"),e.innerHTML=`<div id="dim-message">${(0,a.Z)("dropFile")}</div>`,document.body.appendChild(e)}},this.dragOut=e=>{e.preventDefault(),e.stopPropagation(),e.clientX<=0&&(0,o.ZP)("modal-drop")&&(0,o.ZP)("modal-drop").remove()},this.drop=async e=>{e.stopPropagation(),e.preventDefault(),(0,o.ZP)("modal-drop")&&(0,o.ZP)("modal-drop").remove(),document.body.style.pointerEvents="auto";const t=e.dataTransfer.files;for(var s,i=0;s=t[i];i++)await(0,y.ZB)(this.stage,s,!0,"drop")},this.cut=async e=>{var t;if(this.isModal())return;if(r.PP(document.activeElement))return;if(null===(t=this.stage.fresco)||void 0===t?void 0:t.block)return void document.dispatchEvent(new CustomEvent("notification",{detail:(0,a.Z)("notAllowed")}));e.stopPropagation(),e.preventDefault();let s=this.stage.cut();s instanceof HTMLCanvasElement?(this.writeClipboard(e,s),document.dispatchEvent(new CustomEvent("notification",{detail:(0,a.Z)("cut")}))):navigator.clipboard.writeText("")},this.copy=async e=>{var t;if(this.isModal())return;if(r.PP(document.activeElement))return;if(null===(t=this.stage.fresco)||void 0===t?void 0:t.block)return void document.dispatchEvent(new CustomEvent("notification",{detail:(0,a.Z)("notAllowed")}));e.stopPropagation(),e.preventDefault();let s=this.stage.copy();s instanceof HTMLCanvasElement?(this.writeClipboard(e,s),document.dispatchEvent(new CustomEvent("notification",{detail:(0,a.Z)("copy")}))):navigator.clipboard.writeText("")},this.clear=async()=>{this.stage.clear()&&document.dispatchEvent(new CustomEvent("notification",{detail:"clear"}))},this.writeClipboard=async(e,t)=>{const s=await r._c(t);if(s){this.stage.clipboard=t,this.stage.clipboardSize=new c.Z(t.width,t.height);try{const e={name:"clipboard-write"};await navigator.permissions.query(e)}catch(i){console.log(i)}try{const e=new ClipboardItem({"image/png":s});await navigator.clipboard.write([e]),this.stage.clipboard=void 0}catch(i){console.log(i);try{let e=new DataTransfer;e.items.add("image/png",t.toDataURL()),await navigator.clipboard.write(e),this.stage.clipboard=void 0}catch(a){console.log(a);try{e.clipboardData.setData("image/png",t.toDataURL()),this.stage.clipboard=void 0}catch(n){console.log(n)}}}}},this.pasteActivatedFromMenu=async()=>{try{const e={name:"clipboard-read"};await navigator.permissions.query(e)}catch(e){console.log(e)}try{const e=await navigator.clipboard.read(),t=await e[0].getType("image/png");if(t)(0,y.ZB)(this.stage,new File([t],"clipboard"),!1,"paste"),this.stage.selectionDeselect(),document.dispatchEvent(new CustomEvent("notification",{detail:(0,a.Z)("paste")}));else{if(this.stage.clipboard)return void this.pasteLocal();document.dispatchEvent(new CustomEvent("notification",{detail:(0,a.Z)("noPaste")}))}}catch(e){if(console.log(e),this.stage.clipboard)return void this.pasteLocal();document.dispatchEvent(new CustomEvent("notification",{detail:(0,a.Z)("emptyPaste")}))}},this.paste=async e=>{if(this.isModal())return;const t=document.activeElement;if(!r.PP(t)){if(e.clipboardData.items.length>0){const t=e.clipboardData.items;let n;for(var s,i=0;s=t[i];i++)if("file"===s.kind){n=s;break}if(n||(n=t[0]),"string"===n.kind)return void n.getAsString((async t=>{if(r.PP(document.activeElement))return;e.preventDefault(),e.stopPropagation();let s=/<img\s[^>]*?src\s*=\s*['\"]([^'\"]*?)['\"][^>]*?>/gi.exec(t);if(s&&s.length>1){let e=await new h.Z(this.stage).load(s[1]);return(0,y.ZB)(this.stage,e,this.isHome()),this.navigate("editor"),void document.dispatchEvent(new CustomEvent("notification",{detail:(0,a.Z)("paste")}))}if(this.stage.fresco){t.length>200&&(t=t.substring(0,200));let e=Math.max(16,Math.round(this.stage.fresco.height/20)),s=Math.round(this.stage.fresco.width/1.5),i=Math.round(this.stage.fresco.height/2.5),n=Math.round((this.stage.fresco.width-s)/2),o=new f.Z("verdana",e);this.stage.addText(t,new d.Z(n,i,s,e),o,"paste"),this.navigate("editor"),this.stage.selectionDeselect(),document.dispatchEvent(new CustomEvent("notification",{detail:(0,a.Z)("paste")}))}}));if("file"===n.kind){if(-1==n.type.indexOf("image"))return;e.preventDefault(),e.stopPropagation();const t=n.getAsFile();return(0,y.ZB)(this.stage,t,this.isHome(),"paste"),this.stage.selectionDeselect(),this.navigate("editor"),void document.dispatchEvent(new CustomEvent("notification",{detail:(0,a.Z)("paste")}))}}else if(this.stage.clipboard)return void this.pasteLocal();document.dispatchEvent(new CustomEvent("notification",{detail:(0,a.Z)("emptyPasteGlobal")}))}},this.pasteLocal=()=>{Array.isArray(this.stage.clipboard)?this.stage.pasteLayer():this.stage.clipboard instanceof HTMLCanvasElement&&(this.stage.addImage(r.dN(this.stage.clipboard),(this.stage.fresco,this.stage.fresco.nextAddedLayerNumber()),"paste"),document.dispatchEvent(new CustomEvent("notification",{detail:(0,a.Z)("paste")})),this.stage.selectionDeselect())},this.isModal=()=>document.getElementsByClassName("modal").length>0,this.quickExport=async(e=!1)=>{var t,s,i,n;if(this.stage.fresco.block)return;let o,r,h;if(e){if(r=null===(s=null===(t=this.stage.fresco)||void 0===t?void 0:t.getSelected())||void 0===s?void 0:s.canvas,!r)return;o=null===(n=null===(i=this.stage.fresco)||void 0===i?void 0:i.getSelected())||void 0===n?void 0:n.settings.name}else r=this.stage.getOutputCanvas(),o=this.stage.fresco.name,this.stage.fresco.savedTimesCounterForUserEase>0&&(o+="("+this.stage.fresco.savedTimesCounterForUserEase+")"),this.stage.fresco.savedTimesCounterForUserEase++;o=o.replace(".png",""),(0,b.Zp)()&&(h=await(0,b.f1)(o,"png","PNG image","image/png"),!1===h)||(r.toBlob((async e=>{const t=new File([e],o+".png",{type:"image/png"});h?(await(0,b.BI)(h,t),document.dispatchEvent(new CustomEvent("notification",{detail:(0,a.Z)("fileSaved")}))):(0,b.vV)(t,o,"png")}),"image/png","100"),(0,u.Z)("quick-export",e?"layer":"page"))},this.closeClick=()=>{(0,u.Z)("close"),this.selectTool(),this.tabClose()},this.saveClick=()=>{(0,u.Z)("save"),this.selectTool(),this.stage.fresco.block?new w.Z(this.stage):new l.Z(this.stage)},document.documentElement.classList.add(m.ZP.workspace,m.ZP.accent),(window.matchMedia("(display-mode: standalone)").matches||document.referrer.includes("android-app://"))&&(document.documentElement.classList.add("standalone"),this.optimizeForPWA()),document.addEventListener("cut",this.cut,!0),document.addEventListener("copy",this.copy,!0),document.addEventListener("paste",this.paste,!0),document.addEventListener("dragover",this.dragOver,!0),document.addEventListener("dragleave",this.dragOut,!0),document.addEventListener("drop",this.drop,!0),document.addEventListener("legend",(e=>this.legend(e)),!0),document.addEventListener("loading",(e=>this.loading(e)),!0),document.addEventListener("notification",(e=>this.notification(e)),!0),window.addEventListener("popstate",(e=>this.navigateBack(e))),document.addEventListener("navigate",(e=>this.navigate(e.detail,!0))),this.stage=new g.Z((0,o.ZP)("workspace")),location.hash&&(e=location.hash.replace("#",""),"editor"===e&&(history.replaceState(null,null," "),e=void 0)),"m"!==m.ZP.product&&(this.home=new n.Z(this,null==e?void 0:e.split("&")[0])),m.ZP.template&&(0,y.Hi)(this.stage,m.ZP.template),m.ZP.image){const e="https://pixlr.com/proxy/?url=";new h.Z(this.stage,{title:m.ZP.title,referrer:m.ZP.referrer}).load(e+encodeURIComponent(m.ZP.image)).then((e=>{(0,y.ZB)(this.stage,e)}))}!async function(){var e,t;const s=await v.Z.loadSaved();try{for(var i,a=Z(s);!(i=await a.next()).done;){const e=i.value;v.Z.fontList.unshift(e)}}catch(n){e={error:n}}finally{try{i&&!i.done&&(t=a.return)&&await t.call(a)}finally{if(e)throw e.error}}}()}}i()}catch(k){i(k)}}))},7282:(e,t,s)=>{s.d(t,{$p:()=>a,Bm:()=>n,Y3:()=>o});class i{constructor(e){this.internal=e}send(e,t){this.internal.postMessage(e,t)}async receive(){return await new Promise(((e,t)=>{this.internal.onmessage=t=>{this.internal.onerror=void 0,this.internal.onmessage=void 0,e(t.data)},this.internal.onerror=t}))}terminate(){var e;null===(e=this.internal)||void 0===e||e.terminate(),this.internal=null}}class a extends i{constructor(){super(new Worker(new URL(s.p+s.u(346),s.b)))}}class n extends i{constructor(){super(new Worker(new URL(s.p+s.u(200),s.b)))}}class o extends i{constructor(){super(new Worker(new URL(s.p+s.u(155),s.b)))}}},7794:(e,t,s)=>{s.d(t,{Z:()=>m});var i=s(6548),a=s(3947),n=s(9872),o=s(3655),r=s(4170),h=s(4820),l=s(4178),c=s(3868),d=s(7664),u=s(1951),p=s(5574);async function g(e){const t=await fetch(`https://pixlr.com/api/assets/${e}/download/`),s=await t.json();if(!s.status)throw new Error(s.message);return s.data.url}class m extends c.Z{constructor(e){super((0,i.Z)("titleAddElement"),!1,!0),this.cache=new Map,this.SERVER_URL="https://pixlr.com/api/assets/collections/keyword/",this.layerSelect=()=>{let e=!0;if(this.stage.fresco.isSelectedType(r.Z.TYPE_ELEMENT)?(this.layer=this.stage.fresco.getSelected(),e=this.layer.settings.name!==this.selected,this.selected=this.layer.settings.name,(0,a.ZP)("add-element-list").classList.add("element-layer-selected")):(this.layer=null,this.selected="",(0,a.ZP)("add-element-list").classList.remove("element-layer-selected")),this.subcategory&&e){(0,a.ZP)("element-settings").style.display="none";const e=(0,a.ZP)("add-element-list").querySelectorAll(".element-box");for(let t=0;t<e.length;t++){const s=e[t];this.layer&&this.layer.settings.name===s.id?(s.classList.add("selected"),setTimeout((()=>{this.positionSettings(s,!0)}),200)):s.classList.remove("selected")}}},this.back=()=>{this.subcategory?this.fetchCategory():this.showCategoryList()},this.showCategoryList=()=>{(0,a.ZP)("add-element-back").style.display="none",(0,a.ZP)("add-element-category-list").style.display="block",(0,a.ZP)("add-element-category").style.display="none",(0,a.ZP)("element-settings").style.display="none"},this.selectCategory=e=>{(0,a.ZP)("add-element-category-list").style.display="none",(0,a.ZP)("add-element-category").style.display="block",(0,a.ZP)("add-element-loading").style.display="block",(0,a.ZP)("element-settings").style.display="none",(0,a.ZP)("add-element-back").style.display="block",(0,a.ZP)("add-element-list").innerHTML="",this.category=e.currentTarget.getAttribute("data"),this.fetchCategory()},this.fetchCategory=async()=>{if((0,a.ZP)("add-element-list").innerHTML="",(0,a.ZP)("add-element-loading").style.display="block",(0,a.ZP)("element-settings").style.display="none",this.cache.has(this.category))this.renderCategory(this.category,this.cache.get(this.category));else try{const e=await fetch(this.SERVER_URL+this.category),t=await e.json();if(!t.status)throw new Error("server_error");let s=t.data;this.cache.set(this.category,s),this.renderCategory(this.category,s)}catch(e){console.log(e),(0,a.ZP)("add-element-loading").style.display="none",window.navigator.onLine?(0,a.ZP)("add-element-error").style.display="block":(0,a.ZP)("add-element-offline").style.display="block"}},this.renderCategory=(e,t)=>{(0,a.ZP)("add-element-loading").style.display="none";let s=(0,a.ZP)("add-element-list");this.subcategory="",t.forEach((t=>{let n=document.createElement("div");n.classList.add("element-group"),n.addEventListener("click",(()=>{this.renderSubCategory(this.category,t.name,t.assets)}),!1);let o=document.createElement("div");o.classList.add("wrap",e),n.appendChild(o);let r=document.createElement("img");if(t.assets.length>0&&(r.src=t.assets[0].thumbnailSmall,r.style.objectFit="cover",r.style.overflow="hidden"),o.appendChild(r),"premium"===t.type){let e=(0,a.T)("div",{className:"premium-tag"},(0,a.T)("img",{src:"/img/icon/premium.svg"}));e.setAttribute("tooltip",(0,i.Z)("premium")),e.setAttribute("flow","up-right"),o.append(e)}let h=document.createElement("span");h.innerText=t.name.replace("_"," "),n.appendChild(h),s.appendChild(n)})),(0,a.ZP)("add-element-content").getElementsByClassName("ss-content")[0].scrollTo(0,0)},this.renderSubCategory=(e,t,s)=>{let n=(0,a.ZP)("add-element-list");n.innerHTML="",this.subcategory=t;let o=e==d.Z.VARIANT_OVERLAY;s.forEach((t=>{let s=document.createElement("div");if(s.classList.add("element-box"),s.id=t.id,o){let a=document.createElement("a");a.classList.add("add","button","negative"),a.innerHTML="<img src='/img/icon/duplicate.svg'/> "+(0,i.Z)("add"),a.addEventListener("click",(i=>{var a,n,o;"premium"!==t.type||h.ZP.user.subscription?this.addElement(s.id,!1,e,t.id,g(t.id),null===(a=null==t?void 0:t.metaData)||void 0===a?void 0:a.blendmode,null===(n=null==t?void 0:t.metaData)||void 0===n?void 0:n.opacity,null===(o=null==t?void 0:t.metaData)||void 0===o?void 0:o.scalemode):new u.Z(this.stage,"ELEMENT")}),!1),s.appendChild(a)}s.addEventListener("click",(i=>{var a,n,r;"premium"!==t.type||h.ZP.user.subscription?this.addElement(s.id,o,e,t.id,g(t.id),null===(a=null==t?void 0:t.metaData)||void 0===a?void 0:a.blendmode,null===(n=null==t?void 0:t.metaData)||void 0===n?void 0:n.opacity,null===(r=null==t?void 0:t.metaData)||void 0===r?void 0:r.scalemode):new u.Z(this.stage,"ELEMENT")}),!1);let r=document.createElement("div");r.classList.add("wrap",e),s.appendChild(r);let l=document.createElement("img");if(l.src=t.thumbnailSmall,r.appendChild(l),"premium"===t.type){let e=(0,a.T)("div",{className:"premium-tag"},(0,a.T)("img",{src:"/img/icon/premium.svg"}));e.setAttribute("tooltip",(0,i.Z)("premium")),e.setAttribute("flow","right"),r.append(e)}let c=document.createElement("span");s.appendChild(c),this.layer&&this.layer.settings.name==s.id&&setTimeout((()=>{s.classList.add("selected"),this.positionSettings(s,!0)}),200),n.appendChild(s)})),(0,a.ZP)("add-element-content").getElementsByClassName("ss-content")[0].scrollTo(0,0)},this.select=e=>{(0,a.ZP)("element-settings").style.display="none";let t=(0,a.ZP)(e),s=(0,a.ZP)("add-element-list").getElementsByTagName("div");for(var i=0;i<s.length;i++)s[i].classList.remove("selected");t.classList.add("selected"),this.selected=t.id,setTimeout((()=>{this.positionSettings(t)}),200)},this.positionSettings=(e,t=!1)=>{(0,a.ZP)("element-opacity").value=(0,a.ZP)("element_opacity_out").innerHTML=this.layer?Math.round(100*this.layer.settings.opacity).toString():"100",t&&((0,a.ZP)("element-progress").style.display="none"),(0,a.ZP)("element-rotate-flip").style.display="overlay"===this.category||"border"===this.category?"block":"none";let s=(0,a.ZP)("element-settings");s.style.display="block",s.style.top=e.offsetTop+"px",s.style.left=e.offsetLeft+"px"},this.addElement=async(e,t,s,i,n,r="",h=1,l=d.Z.SCALE_METHOD_NONE)=>{t=t&&this.layer&&this.layer.variant===s,this.select(e),this.canceled=!1,this.loading=!0;const c=(0,a.ZP)("element-progress");c.style.display="block",c.value=0;try{const e=await n,t=await(0,p.c6)(e,(e=>{this.canceled||(-1==e?c.removeAttribute("value"):c.value=e)}));if(c.style.display="none",this.canceled)return;const s=await(0,p.s4)(t);if(this.canceled)return;this.loading=!1;let a=o.qT(s,4096);this.layer=this.stage.addElement(a,i,e,r,l)}catch(u){console.log("Error",u),c.style.display="none"}},this.delete=()=>{this.loading?(this.loading=!1,this.canceled=!0,this.layerSelect()):(this.layer=null,this.selected="",this.stage.deleteLayer())},this.opacityDown=e=>{this.layer&&(this.opacityStart=this.layer.settings.opacity)},this.opacityUp=e=>{this.layer&&this.stage.history.add({type:"layerSettings",kind:"opacity",layer:this.layer,settings:Object.assign(Object.assign({},this.layer.settings),{opacity:this.opacityStart})})},this.opacity=e=>{this.layer&&(this.layer.settings.opacity=Number((0,a.ZP)("element-opacity").value)/100,document.dispatchEvent(new CustomEvent("viewport-render")))},this.rotateOrFlip=e=>{let t=this.stage.fresco.getSelected();if(!t||!t.rect)return;switch(e.currentTarget.getAttribute("id")){case"element-flip-vertical":t.flip(!0);break;case"element-flip-horizontal":t.flip(!1);break;case"element-rotate-left":t.rotateAndFit(!0,new n.Z(this.stage.fresco.width,this.stage.fresco.width));break;case"element-rotate-right":t.rotateAndFit(!1,new n.Z(this.stage.fresco.width,this.stage.fresco.width))}document.dispatchEvent(new CustomEvent("viewport-render"))},this.cleanUp=()=>{(0,a.ZP)("add-element-list").innerHTML="",document.removeEventListener("layer-select",this.layerSelect,!1),(0,a.ZP)("element-rotate-left").removeEventListener("click",this.rotateOrFlip,!1),(0,a.ZP)("element-rotate-right").removeEventListener("click",this.rotateOrFlip,!1),(0,a.ZP)("element-flip-horizontal").removeEventListener("click",this.rotateOrFlip,!1),(0,a.ZP)("element-flip-vertical").removeEventListener("click",this.rotateOrFlip,!1),(0,a.ZP)("add-element-back").removeEventListener("click",this.back,!1),(0,a.ZP)("element-delete").removeEventListener("click",this.delete,!1);const e=(0,a.ZP)("element-opacity");e.removeEventListener("input",this.opacity,!1),e.removeEventListener("mousedown",this.opacityDown,!1),e.removeEventListener("mouseup",this.opacityUp,!1),e.removeEventListener("touchstart",this.opacityDown,!1),e.removeEventListener("touchend",this.opacityUp,!1);let t=(0,a.ZP)("add-element-category-list").getElementsByTagName("li");for(var s=0;s<t.length;s++)t[s].removeEventListener("click",this.selectCategory,!1);document.removeEventListener("keydown",this.keyDown,!1),this.dialog.remove(),this.dialog=null,this.modal.remove(),this.modal=null},this.stage=e,this.dialog.style.width="500px",this.dialog.style.height="400px",this.dialog.style.maxWidth="500px",this.content.style.padding="0px 0px 0px 20px",this.content.id="add-element-content",document.addEventListener("layer-select",this.layerSelect,!1),this.setContent(`\n            <div id="element-settings">\n                <progress id="element-progress" value="0" max="100"></progress>\n                <img class="close" id="element-delete" src="/img/icon/close.svg" title="Delete">\n                <div class="range-white" id="element-settings-amount">\n                    <label>${(0,i.Z)("transparency")}</label>\n                    <input type="range" value="100" min="0" max="100" step="1" id="element-opacity" name="element_opacity" oninput="element_opacity_out.value=this.value" />\n                    <output name="element_opacity_out" id="element_opacity_out" for="element_opacity">100</output>\n                </div>\n                <ul id="element-rotate-flip" class="small-icon-button-set">\n                    <li id="element-rotate-left"><img src="/img/icon/rotate-left.svg" alt="Rotate Left"></li>\n                    <li id="element-rotate-right"><img src="/img/icon/rotate-right.svg"  alt="Rotate Right"></li>\n                    <li id="element-flip-horizontal"><img src="/img/icon/flip-horizontal.svg"  alt="Flip Horizontal"></li>\n                    <li id="element-flip-vertical"><img src="/img/icon/flip-vertical.svg"  alt="Flip Vertical"></li>\n                </ul>\n            </div>\n\n            <ul id="add-element-category-list" class="section-list pad-20">\n                <li data="overlay" id="add-element-overlay"><span>${(0,i.Z)("overlay")}</span>\n                </li><li data="border" id="add-element-border"><span>${(0,i.Z)("border")}</span>\n                </li><li data="shape" id="add-element-shape"><span>${(0,i.Z)("shape")}</span>\n                </li><li data="sticker" id="add-element-sticker"><span>${(0,i.Z)("sticker")}</span></li>\n            </ul>\n\n            <div id="add-element-category" style="display:none;" >\n                \n                <div id="add-element-loading" class="pad-20" style="display:none;">${(0,i.Z)("loading")} .. </div>\n                <div id="add-element-list" class="pad-20">\n\n                </div>\n                <div id="add-element-error" class="pad-20" style="display: none">\n                    <h3>${(0,i.Z)("error")}</h3>\n                    <p>\n                        ${(0,i.Z)("genericError")}\n                    </p>\n                </div>\n                <div id="add-element-offline" class="pad-20" style="display: none">\n                    <h3>${(0,i.Z)("offline")}</h3>\n                    <p>\n                        ${(0,i.Z)("genericOffline")}\n                    </p>\n                </div>\n            </div>\n        `),(0,a.ZP)("dialog-buttons"+this.mid).insertBefore((0,a.T)("a",{className:"button negative",id:"add-element-back",style:"position:absolute;left:10px;min-width:140px;"},(0,a.T)("img",{src:"/img/icon/back-small.svg"}),(0,i.Z)("back")),(0,a.ZP)("dialog-apply")),(0,a.ZP)("dialog-apply"+this.mid).style.display="none",(0,a.ZP)("dialog-cancel"+this.mid).innerText=(0,i.Z)("close"),(0,a.ZP)("add-element-back").addEventListener("click",this.back,!1),(0,a.ZP)("element-delete").addEventListener("click",this.delete,!1);const t=(0,a.ZP)("element-opacity");t.addEventListener("input",this.opacity,!1),t.addEventListener("mousedown",this.opacityDown,!1),t.addEventListener("mouseup",this.opacityUp,!1),t.addEventListener("touchstart",this.opacityDown,{passive:!0}),t.addEventListener("touchend",this.opacityUp,{passive:!0}),(0,a.ZP)("element-rotate-left").addEventListener("click",this.rotateOrFlip,!1),(0,a.ZP)("element-rotate-right").addEventListener("click",this.rotateOrFlip,!1),(0,a.ZP)("element-flip-horizontal").addEventListener("click",this.rotateOrFlip,!1),(0,a.ZP)("element-flip-vertical").addEventListener("click",this.rotateOrFlip,!1);let s=(0,a.ZP)("add-element-category-list").getElementsByTagName("li");for(var c=0;c<s.length;c++)s[c].addEventListener("click",this.selectCategory,!1);this.showCategoryList(),this.layerSelect(),new l.Z(this.content)}}},8275:(e,t,s)=>{s.d(t,{Z:()=>h});var i=s(670);class a{constructor(e=0,t=0,s=0,i=0,a=0,n=0,o=0,r=0,h=0,l=!0){this.shadowRed=e,this.shadowGreen=t,this.shadowBlue=s,this.midtoneRed=i,this.midtoneGreen=a,this.midtoneBlue=n,this.highlightRed=o,this.highlightGreen=r,this.highlightBlue=h,this.preserve=l}}var n=s(4188),o=s(6548),r=s(3947);class h extends i.Z{constructor(e){super(e,(0,o.Z)("titleColorBalance")),this.colorset=new a,this.range="midtone",this.preserveChange=()=>{this.colorset.preserve=(0,r.ZP)("balance-preserve-luminosity").checked,this.change()},this.rangeChange=()=>{switch(this.range=document.querySelector('input[name="balance-range"]:checked').value,this.range){case"shadow":this.red.setValue(this.colorset.shadowRed),this.green.setValue(this.colorset.shadowGreen),this.blue.setValue(this.colorset.shadowBlue);break;case"midtone":this.red.setValue(this.colorset.midtoneRed),this.green.setValue(this.colorset.midtoneGreen),this.blue.setValue(this.colorset.midtoneBlue);break;case"highlight":this.red.setValue(this.colorset.highlightRed),this.green.setValue(this.colorset.highlightGreen),this.blue.setValue(this.colorset.highlightBlue)}},this.change=(e="",t=0)=>{switch(this.range){case"shadow":this.colorset.shadowRed=this.red.getValue(),this.colorset.shadowGreen=this.green.getValue(),this.colorset.shadowBlue=this.blue.getValue();break;case"midtone":this.colorset.midtoneRed=this.red.getValue(),this.colorset.midtoneGreen=this.green.getValue(),this.colorset.midtoneBlue=this.blue.getValue();break;case"highlight":this.colorset.highlightRed=this.red.getValue(),this.colorset.highlightGreen=this.green.getValue(),this.colorset.highlightBlue=this.blue.getValue()}this.shaders.addShader("balance",this.colorset),setTimeout((()=>{this.scratch.canvas=this.shaders.apply(this.cache),window.requestAnimationFrame((()=>this.stage.render()))}),0)},this.kind="balance",this.setContent(`\n                <label>Range</label>\n                <div class="switch-field pad-5">\n                    <input type="radio" id="balance-range-shadow" name="balance-range" value="shadow"/><label for="balance-range-shadow">${(0,o.Z)("shadows")}</label>\n                    <input type="radio" id="balance-range-midtone" name="balance-range" value="midtone" checked/><label for="balance-range-midtone">${(0,o.Z)("midtones")}</label>\n                    <input type="radio" id="balance-range-highlight" name="balance-range" value="highlight"/><label for="balance-range-highlight">${(0,o.Z)("highlights")}</label>\n                </div>\n\n                <div id='balance-red' class='pad-20'></div>\n                <div id='balance-green' class='pad-5'></div>\n                <div id='balance-blue' class='pad-5'></div>\n\n                <input type="checkbox" id="balance-preserve-luminosity" checked>\n                <label class="pad-20 switch" for="balance-preserve-luminosity"><span></span>${(0,o.Z)("preserveLuminosity")}</label>\n                `),this.red=new n.Z("balance-red",{label:(0,o.Z)("red"),step:.01,range:[-1,1],labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,onChange:e=>this.change("balance",e)}),this.green=new n.Z("balance-green",{label:"Green",step:.01,range:[-1,1],labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,onChange:e=>this.change("balance",e)}),this.blue=new n.Z("balance-blue",{label:"Blue",step:.01,range:[-1,1],labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,onChange:e=>this.change("balance",e)}),(0,r.ZP)("balance-range-shadow").addEventListener("click",this.rangeChange,!1),(0,r.ZP)("balance-range-midtone").addEventListener("click",this.rangeChange,!1),(0,r.ZP)("balance-range-highlight").addEventListener("click",this.rangeChange,!1),(0,r.ZP)("balance-preserve-luminosity").addEventListener("change",this.preserveChange,!1)}}},855:(e,t,s)=>{s.d(t,{Z:()=>p});var i=s(6548),a=s(3655),n=s(3947),o=s(1030),r=s(4188),h=s(8776),l=s(4256),c=s(4211);class d{constructor(e,t,s,i){this.update=i,this.maxElevation=Math.PI/2,this.getAngle=()=>this.angle,this.getElevation=()=>this.elevation,this.setAngle=e=>{this.angle=e,this.angle<0&&(this.angle=2*Math.PI-Math.abs(this.angle)),this.render()},this.setElevation=e=>{this.elevation=e,this.render()},this.start=e=>{document.addEventListener("mousemove",this.move),document.addEventListener("mouseup",this.end),this.handle.classList.add("grabbed")},this.move=e=>{e.preventDefault(),e.stopPropagation();const t=this.outerCircle.getBoundingClientRect(),s=t.width/2-2,i=t.width/2+t.x,a=t.height/2+t.y,n=e.clientX-i,o=e.clientY-a,r=Math.sqrt(n*n+o*o);if(this.angle=Math.atan2(o,n),this.angle<0&&(this.angle=2*Math.PI-Math.abs(this.angle)),r>s)this.elevation=0,this.render();else{const e=r/s;this.elevation=(1-e)*this.maxElevation,this.render()}this.container.dataset.angle=this.angle.toFixed(5),this.container.dataset.elevation=this.elevation.toFixed(5),this.update&&this.update(this.angle,this.elevation)},this.end=e=>{document.removeEventListener("mousemove",this.move),document.removeEventListener("mouseup",this.end),this.handle.classList.remove("grabbed")},this.buildElements=()=>{this.outerCircle=(0,n.T)("div",{className:"outer-circle"}),this.handle=(0,n.T)("div",{className:"handle"},(0,n.T)("div")),this.container.append(this.outerCircle,this.handle)},this.rebindElements=()=>{this.outerCircle=this.container.querySelector(".outer-circle"),this.handle=this.container.querySelector(".handle")},this.render=()=>{const e=this.outerCircle.getBoundingClientRect(),t=this.handle.getBoundingClientRect(),s=(1-this.elevation/this.maxElevation)*(e.width/2-2),i=Math.round(s*Math.cos(this.angle)),a=Math.round(s*Math.sin(this.angle));window.requestAnimationFrame((()=>{this.handle.style.top=a+(e.height/2-t.height/2)+"px",this.handle.style.left=i+(e.width/2-t.width/2)+"px"}))},this.cleanUp=()=>{},this.container=(0,n.ZP)(e);!!this.container.querySelector(".outer-circle")?this.rebindElements():this.buildElements(),this.angle=parseFloat(this.container.dataset.angle)||t,this.angle<0&&(this.angle=2*Math.PI-Math.abs(this.angle)),this.elevation=parseFloat(this.container.dataset.elevation)||s,this.handle.addEventListener("mousedown",this.start),this.render()}}var u=s(670);class p extends u.Z{constructor(e){super(e,(0,i.Z)("titleBevel")),this.load=async()=>{const e=Promise.resolve().then(s.bind(s,8132)),t=a.iF();await t;const{distanceTransformInv:i}=await e,r=this.shaders.ctx,h=this.cache.getContext("2d").getImageData(0,0,this.cache.width,this.cache.height),l=i(this.cache.width,this.cache.height,h.data);if(!r.getSupportedExtensions().includes("OES_texture_float"))return alert("sorry, this filter requires float textures"),void(0,o.Z)("OES_texture_float");r.getExtension("OES_texture_float");const c=r.createTexture();r.bindTexture(r.TEXTURE_2D,c),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texImage2D(r.TEXTURE_2D,0,r.ALPHA,this.cache.width,this.cache.height,0,r.ALPHA,r.FLOAT,l),r.bindTexture(r.TEXTURE_2D,null),(0,n.ZP)("bevel-loading").style.display="none",(0,n.ZP)("bevel-controls").style.visibility="visible",this.enableApply(),this.map=c,this.update()},this.update=()=>{const e={depth:this.depth.getValue(),size:this.size.getValue(),lightAngle:this.angle.getAngle(),lightElevation:this.angle.getElevation(),lowLightColor:this.lowLightColor.getColor(),highLightColor:this.highLightColor.getColor(),lowOpacity:this.lowOpacity.getValue(),highOpacity:this.highOpacity.getValue(),distanceMap:this.map};this.change("bevel",e.size?e:null)},this.disableApply(),this.kind="bevel",this.shaders=new l.Z,this.setContent((0,n.T)("div",{className:"dialog-loading"},(0,n.T)("div",{id:"bevel-controls",className:"controls"},(0,n.T)("div",{className:"bevel-angle"},(0,n.T)("div",{className:"angle-box-holder"},(0,n.T)("div",{id:"bevel-angle",className:"angle-box pad-10s"})),(0,n.T)("div",{className:"angle-box-sliders"},(0,n.T)("div",{id:"bevel-angle-slider",className:"range-box pad-10"}),(0,n.T)("div",{id:"bevel-elevation-slider",className:"range-box pad-10"}))),(0,n.T)("div",{id:"bevel-size",className:"range-box pad-20"}),(0,n.T)("div",{id:"bevel-depth",className:"range-box pad-10"}),(0,n.T)("label",{className:"split"},(0,i.Z)("dialogBevelHighColor"),(0,n.T)("div",{id:"bevel-highlight-color",className:"colod-pod square pad-4"})),(0,n.T)("div",{id:"bevel-high-opacity",className:"range-box pad-10"}),(0,n.T)("label",{className:"split",style:{marginTop:"5px"}},(0,i.Z)("dialogBevelShadowColor"),(0,n.T)("div",{id:"bevel-lowlight-color",className:"colod-pod square pad-4"})),(0,n.T)("div",{id:"bevel-low-opacity",className:"range-box pad-10"})),(0,n.T)("div",{id:"bevel-loading",className:"message"},(0,i.Z)("loading"),(0,n.T)("span","."),(0,n.T)("span","."),(0,n.T)("span",".")))),this.highLightColor=new c.Z("bevel-highlight-color",h.Z.fromHEX("#ffffff"),this.update),this.lowLightColor=new c.Z("bevel-lowlight-color",h.Z.fromHEX("#000000"),this.update),this.size=new r.Z("bevel-size",{label:(0,i.Z)("size"),range:[0,150],defaultValue:10,step:1,labelFormat:e=>`${e}px`,onChange:()=>this.update()});const t=-Math.PI/4;this.angle=new d("bevel-angle",t,0,((e,t)=>{let s=(e*(180/Math.PI)+90)%360;this.angleSlider.setValue(s),this.elevationSlider.setValue(t*(180/Math.PI)),this.update()})),this.angleSlider=new r.Z("bevel-angle-slider",{label:(0,i.Z)("angle"),range:[0,360],step:1,defaultValue:45,labelFormat:e=>e.toFixed(0)+"",labelParse:e=>parseInt(e,10),onChange:e=>{this.angle.setAngle((e-90)*(Math.PI/180)),this.update()}}),this.elevationSlider=new r.Z("bevel-elevation-slider",{label:(0,i.Z)("elevation"),range:[0,90],defaultValue:180*this.angle.getElevation()/Math.PI,step:1,labelFormat:e=>e.toFixed(0)+"",labelParse:e=>parseInt(e,10),onChange:e=>{this.angle.setElevation(e*(Math.PI/180)),this.update()}}),this.depth=new r.Z("bevel-depth",{label:(0,i.Z)("depth"),range:[.001,1],defaultValue:1,step:.001,labelFormat:e=>`${Math.round(100*e)}%`,labelParse:e=>parseInt(e,10)/100,onChange:()=>this.update()}),this.highOpacity=new r.Z("bevel-high-opacity",{label:(0,i.Z)("dialogBevelHighOpacity"),range:[0,1],defaultValue:.9,step:.01,labelFormat:e=>`${Math.round(100*e)}%`,labelParse:e=>parseInt(e,10)/100,onChange:()=>this.update()}),this.lowOpacity=new r.Z("bevel-low-opacity",{label:(0,i.Z)("dialogBevelShadowOpacity"),range:[0,1],defaultValue:.75,step:.01,labelFormat:e=>`${Math.round(100*e)}%`,labelParse:e=>parseInt(e,10)/100,onChange:()=>this.update()}),this.position(),this.load()}}},7103:(e,t,s)=>{s.d(t,{Z:()=>r});var i=s(670),a=s(4188),n=s(3947),o=s(6548);class r extends i.Z{constructor(e){super(e,(0,o.Z)("titleBloom")),this.setContent((0,n.T)("div",{id:"bloom-slider"})),new a.Z("bloom-slider",{label:(0,o.Z)("amount"),range:[0,1],step:.01,labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,onChange:e=>this.change("bloom",e)})}}},7099:(e,t,s)=>{s.d(t,{Z:()=>r});var i=s(670),a=s(4188),n=s(3947),o=s(6548);class r extends i.Z{constructor(e){super(e,(0,o.Z)("titleBlur")),this.setContent((0,n.T)("div",{id:"blur-slider"})),new a.Z("blur-slider",{label:(0,o.Z)("amount"),range:[0,1],step:.01,labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,onChange:e=>this.change("blur",e)})}}},6781:(e,t,s)=>{s.d(t,{Z:()=>r});var i=s(670),a=s(4188),n=s(3947),o=s(6548);class r extends i.Z{constructor(e){super(e,(0,o.Z)("titleBrightnessContrast")),this.kind="brightnessContrast",this.setContent((0,n.T)("div",{id:"brightness"}),(0,n.T)("div",{id:"contrast",className:"pad-16"})),new a.Z("brightness",{label:(0,o.Z)("brightness"),step:.01,range:[-1,1],labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,onChange:e=>this.change("brightness",e)}),new a.Z("contrast",{label:(0,o.Z)("contrast"),step:.01,range:[-1,1],labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,onChange:e=>this.change("contrast",e)})}}},7371:(e,t,s)=>{s.d(t,{Z:()=>h});var i=s(670),a=s(4188),n=s(3947),o=s(6548),r=s(3655);class h extends i.Z{constructor(e){super(e,(0,o.Z)("titleClarity")),this.update=r.d4(50,(e=>{this.change("clarity",e)})),this.setContent((0,n.T)("div",{id:"clarity-slider"})),new a.Z("clarity-slider",{label:(0,o.Z)("amount"),step:.01,range:[-1,1],labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,onChange:e=>this.update(e)})}}},6114:(e,t,s)=>{s.d(t,{Z:()=>r});var i=s(670),a=s(6230),n=s(3655),o=s(6548);class r extends i.Z{constructor(e){super(e,(0,o.Z)("titleColorLookup")),this.update=n.d4(50,(e=>{let t=this.mctx.createLinearGradient(0,0,255,0);e.addStopToCanvasGradient(t),this.mctx.fillStyle=t,this.mctx.fillRect(0,0,this.map.width,this.map.height),this.change("lookup",this.mctx.getImageData(0,0,255,1))})),this.content.style.paddingBottom="0px",this.dialog.style.width="340px",this.dialog.style.maxWidth="340px",this.map=n.vL(255,1),this.mctx=this.map.getContext("2d"),this.editor=new a.Z(void 0,this.content,this.update),this.position()}}},3002:(e,t,s)=>{s.d(t,{Z:()=>d});var i=s(3947),a=s(6548),n=s(134),o=s(670),r=s(3673);class h{constructor(){this.points=[]}add(e){for(var t=0;t<this.points.length;t++)if(e.x==this.points[t].x&&e.y==this.points[t].y)return null;return this.points.push(e),this.sortPoints(),this.points.indexOf(e)}sortPoints(){this.points.sort((function(e,t){return e.x-t.x}))}remove(e){var t=null;return e>0&&e<this.points.length-1&&(t=this.points.splice(e,1)[0]),t}removeAll(){this.points=[]}getClosestFrom(e,t){if(!this.points.length)return null;for(var s=1/0,i=null,a=0;a<this.points.length;a++){var n=Math.sqrt(Math.pow(e.x-this.points[a].x,2)+Math.pow(e.y-this.points[a].y,2));n<s&&(s=n,i=a)}return{index:i,distance:s*t}}getPoint(e){return e>=0&&e<this.points.length?this.points[e]:null}getNumberOfPoints(){return this.points.length}getPoints(){return this.points}updatePoint(e,t){let s=e;if(e>=0&&e<this.points.length){this.points[e].x=t.x,this.points[e].y=t.y;var i=this.points[e];this.sortPoints(),s=this.points.indexOf(i)}return s}}var l=s(2468);class c{constructor(e,t,s,i,a){this.move=e=>{e.preventDefault(),e.stopPropagation();var t=this.canvas.getBoundingClientRect();this.mouseMoved=!0,this.mouse.x=(e.clientX-t.left)/this.width,this.mouse.y=(this.height-(e.clientY-t.top))/this.height;var s=this.pointSet.getClosestFrom(this.mouse,this.width);s&&(-1==this.pointGrabbedIndex?s.distance<=this.controlPointRadius?this.pointHoveredIndex=s.index:-1!=this.pointHoveredIndex&&(this.pointHoveredIndex=-1,this.draw()):(this.pointGrabbedIndex=this.pointSet.updatePoint(this.pointGrabbedIndex,this.mouse),this.pointHoveredIndex=this.pointGrabbedIndex),-1==this.pointHoveredIndex&&-1==this.pointGrabbedIndex||this.draw(),-1!=this.pointGrabbedIndex&&this.callback&&this.callback(this,"change"))},this.down=e=>{e.preventDefault(),e.stopPropagation(),this.mouseDown=!0,this.mouseMoved=!1,document.addEventListener("mouseup",this.up,!1),-1!=this.pointHoveredIndex&&(this.pointGrabbedIndex=this.pointHoveredIndex,this.callback(this,"down"))},this.up=e=>{e.preventDefault(),e.stopPropagation();const t=-1!=this.pointGrabbedIndex,s=this.mouseMoved;this.mouseDown=!1,this.mouseMoved=!1,this.pointGrabbedIndex=-1,document.removeEventListener("mouseup",this.up,!1),t&&s&&this.draw(),t&&this.callback&&s&&this.callback(this,"up")},this.dblClick=e=>{if(e.preventDefault(),e.stopPropagation(),this.canvas.focus(),-1==this.pointHoveredIndex){let e=this.add(new r.Z(this.mouse.x,this.mouse.y));this.pointHoveredIndex=e}else this.remove(this.pointHoveredIndex),this.pointHoveredIndex=-1,this.pointGrabbedIndex=-1;this.callback&&this.callback(this,"dblclick")},this.add=(e,t=!0,s=!1)=>{let i=this.pointSet.add(e);return t&&this.draw(),s&&this.callback&&this.callback(this,"change"),i},this.addAll=e=>{this.pointSet.removeAll();for(var t=0;t<e.length;t++)this.pointSet.add(e[t]);this.draw()},this.remove=e=>{this.pointSet.remove(e);this.draw(),this.callback&&this.callback(this,"change")},this.removeAll=()=>{this.pointSet.removeAll(),this.draw(),this.callback&&this.callback(this,"change")},this.reset=()=>{this.pointSet.removeAll(),this.add(new r.Z(0,0),!1,!1),this.add(new r.Z(1,1),!1,!1),this.draw()},this.draw=()=>{if(!this.pointSet.points.length)return;let e,t=this.width,s=this.height,i=[],a=[],n=this.pointSet.getPoints();for(var o=0;o<n.length;o++)i.push(n[o].x*t),a.push(n[o].y*s);this.ctx.clearRect(0,0,this.width,this.height),this.ctx.beginPath(),this.ctx.moveTo(i[0]/this.screenRatio,(s-a[0])/this.screenRatio);let r=new l.Z(i,a);for(var h=0;h<Math.ceil(i[0]);h++)e=a[0],e=e<0?.5:e>s?s-.5:e,this.ctx.lineTo(h/this.screenRatio,(s-e)/this.screenRatio);for(h=Math.ceil(i[0]);h<Math.ceil(i[i.length-1]);h++)e=r.interpolate(h),e=e<0?.5:e>s?s-.5:e,this.ctx.lineTo(h/this.screenRatio,(s-e)/this.screenRatio);for(h=Math.ceil(i[i.length-1]);h<t;h++)e=a[a.length-1],e=e<0?.5:e>s?s-.5:e,this.ctx.lineTo(h/this.screenRatio,(s-e)/this.screenRatio);this.ctx.strokeStyle=-1==this.pointHoveredIndex?this.idleColor:this.hoverColor,this.ctx.lineWidth=this.curveThickness/this.screenRatio,this.ctx.stroke(),this.ctx.closePath();for(o=0;o<i.length;o++)this.ctx.beginPath(),this.ctx.arc(i[o]/this.screenRatio,(s-a[o])/this.screenRatio,this.controlPointRadius/this.screenRatio,0,2*Math.PI),-1!=this.pointHoveredIndex&&o==this.pointHoveredIndex?this.ctx.fillStyle=this.hoverColor:this.ctx.fillStyle=this.idleColor,this.ctx.fill(),this.ctx.closePath()},this.getPoints=()=>this.pointSet.getPoints(),this.cleanUp=()=>{this.canvas.removeEventListener("mousemove",this.move,!0),this.canvas.removeEventListener("mousedown",this.down,!0),this.canvas.removeEventListener("dblclick",this.dblClick,!0)},this.callback=s,this.controlPointRadius=5,this.idleColor=i,this.hoverColor=a,this.mouse=new r.Z,this.curveThickness=2,this.pointHoveredIndex=-1,this.pointGrabbedIndex=-1,this.screenRatio=window.devicePixelRatio,this.canvas=e,this.canvas.width=this.width=t,this.canvas.height=this.height=t,this.ctx=this.canvas.getContext("2d"),this.ctx.scale(this.screenRatio,this.screenRatio),this.canvas.addEventListener("mousemove",this.move,!0),this.canvas.addEventListener("mousedown",this.down,!0),this.canvas.addEventListener("dblclick",this.dblClick,!0),this.pointSet=new h,this.add(new r.Z(0,0),!1,!1),this.add(new r.Z(1,1),!1,!1),this.draw()}}class d extends o.Z{constructor(e){super(e,(0,a.Z)("titleCurves")),this.setUp=()=>{let e=(0,i.ZP)("curves-swatches").getElementsByTagName("div");for(var t=0;t<e.length;t++)e[t].addEventListener("click",(function(){for(var t=0;t<e.length;t++)e[t].classList.remove("active"),(0,i.ZP)("curves-graph-"+e[t].getAttribute("data-name")).classList.remove("active");this.classList.add("active"),(0,i.ZP)("curves-graph-"+this.getAttribute("data-name")).classList.add("active")}),!1);let s=(0,i.ZP)("curves-grid").getContext("2d");s.lineWidth=2,s.strokeStyle="rgb(68,68,68)",s.strokeRect(1,1,254,254),s.lineWidth=1,s.translate(.5,.5),s.beginPath(),s.moveTo(0,63),s.lineTo(255,63),s.moveTo(0,191),s.lineTo(255,191),s.moveTo(63,0),s.lineTo(63,255),s.moveTo(191,0),s.lineTo(191,255),s.closePath(),s.stroke(),s.setTransform(1,0,0,1,0,0),s.beginPath(),s.lineWidth=2,s.moveTo(0,128),s.lineTo(256,128),s.moveTo(128,0),s.lineTo(128,256),s.closePath(),s.stroke(),s.beginPath(),s.lineWidth=1.5,s.moveTo(0,256),s.lineTo(256,0),s.closePath(),s.stroke(),this.all=new c((0,i.ZP)("curves-graph-all"),256,this.curvesChange,"rgba(100, 100, 100, 1)","rgba(125, 125, 125, 1)"),this.red=new c((0,i.ZP)("curves-graph-red"),256,this.curvesChange,"rgba(209, 72, 14, 1)","rgba(232, 82, 16, 1)"),this.green=new c((0,i.ZP)("curves-graph-green"),256,this.curvesChange,"rgba(146, 156, 31, 1)","rgba(169, 181, 36, 1)"),this.blue=new c((0,i.ZP)("curves-graph-blue"),256,this.curvesChange,"rgba(58, 110, 154, 1)","rgba(68, 129, 179, 1)")},this.curvesChange=(e,t)=>{this.change("curves",new n.Z(255,this.all.getPoints(),this.red.getPoints(),this.green.getPoints(),this.blue.getPoints()))},this.dialog.style.width="380px",this.dialog.style.maxWidth="380px",this.setContent(`\n            <div id="curves-holder">      \n                <div id="curves-swatches" class="swatches">\n                    <div class="active" data-name="all"><span class="ic" style="background-color: #ccc"></span></div>\n                    <div data-name="red"><span style="background-color: #d1480e;"></span></div>\n                    <div data-name="green"><span style="background-color:#929C1F;"></span></div>\n                    <div data-name="blue"><span style="background-color: #3a6e9a"></span></div>\n                </div>\n                <div id="curves-overlay">\n                    <canvas id="curves-grid" unselectable="on" width="256" height="256"></canvas>\n                    <canvas class="curves-graph active" unselectable="on" id="curves-graph-all"></canvas>\n                    <canvas class="curves-graph" unselectable="on" id="curves-graph-red"></canvas>\n                    <canvas class="curves-graph" unselectable="on" id="curves-graph-green"></canvas>\n                    <canvas class="curves-graph" unselectable="on" id="curves-graph-blue"></canvas>\n                </div>\n            </div>\n            <div class="tip pad-20"><small>${(0,a.Z)("addCurvesControlDesc")}</small></div>\n        `),this.setUp()}}},9812:(e,t,s)=>{s.d(t,{Z:()=>r});var i=s(670),a=s(4188),n=s(3947),o=s(6548);class r extends i.Z{constructor(e){super(e,(0,o.Z)("titleDehaze")),this.setContent((0,n.T)("div",{id:"dehaze-slider"})),new a.Z("dehaze-slider",{label:(0,o.Z)("amount"),range:[0,1],step:.01,labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,onChange:e=>this.change("dehaze",e)})}}},3440:(e,t,s)=>{s.d(t,{Z:()=>h});var i=s(670),a=s(4188),n=s(3947),o=s(3655),r=s(6548);class h extends i.Z{constructor(e){super(e,(0,r.Z)("titleDenoise")),this.valueChange=o.d4(50,(()=>{this.shaders.addShader("denoise",this.radius.getValue()<.02?0:[this.radius.getValue(),this.threshold.getValue()]),setTimeout((()=>{this.scratch.canvas=this.shaders.apply(this.cache),window.requestAnimationFrame((()=>this.stage.render()))}),0)})),this.kind="denoise",this.setContent((0,n.T)("div",{id:"denoise-radius"}),(0,n.T)("div",{id:"denoise-threshold",className:"pad-16"})),this.radius=new a.Z("denoise-radius",{label:(0,r.Z)("radius"),step:.01,range:[0,1],defaultValue:.4,labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,onChange:e=>this.valueChange()}),this.threshold=new a.Z("denoise-threshold",{label:(0,r.Z)("threshold"),step:.01,range:[.01,1],defaultValue:.12,labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,onChange:e=>this.valueChange()}),this.valueChange()}}},5039:(e,t,s)=>{s.d(t,{Z:()=>c});var i=s(6548),a=s(3655),n=s(6817),o=s(3868),r=s(8776),h=s(4188),l=s(4211);class c extends o.Z{constructor(e){super((0,i.Z)("titleDropShadow"),!1),this.stage=e,this.apply=()=>{const e=this.stage.fresco.getSelected(),t=a.l(this.scratch.canvas),s=a.$E(e.canvas,t.rebase(e.rect.x,e.rect.y)),i=a.dN(e.mask),n=e.rect.clone();e.extendCanvas(t),this.scratch.drawToLayer(e),this.stage.fresco.removeScratch(),this.stage.history.add({type:"bitmapChange",kind:"DropShadow",layer:e,rect:n,patchRect:t.rebase(e.rect.x,e.rect.y),patch:s,mask:i}),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-select")),this.cleanUp()},this.cancel=()=>{this.stage.fresco.removeScratch(),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-select")),this.cleanUp()},this.change=()=>{const e=this.stage.fresco.getSelected(),t=this.scratch.ctx;if(e.canvas){this.scratch.clear(),t.save();try{const s=this.color.getColor();t.shadowColor=s.toRGBA(255*this.opacitySlider.getValue()),t.shadowOffsetX=this.offsetXSlider.getValue(),t.shadowOffsetY=this.offsetYSlider.getValue(),t.shadowBlur=this.blurSlider.getValue(),t.drawImage(e.canvas,e.rect.x,e.rect.y),window.requestAnimationFrame((()=>this.stage.render()))}finally{t.restore()}}},this.dialog.style.width="300px",this.dialog.style.maxWidth="300px",this.setContent('\n            <label class="split">Color<div id="drop-shadow-color" class="pad-4"></div></label>\n            <div id="drop-shadow-opacity" class="range-box pad-10"></div>\n            <div id="drop-shadow-blur" class="range-box pad-10"></div>\n            <div id="drop-shadow-offset-x" class="range-box pad-10"></div>\n            <div id="drop-shadow-offset-y" class="range-box pad-10"></div>\n        '),this.color=new l.Z("drop-shadow-color",r.Z.fromHEX("#000000"),this.change),this.opacitySlider=new h.Z("drop-shadow-opacity",{label:(0,i.Z)("opacity"),defaultValue:.5,labelFormat:e=>(100*e).toFixed(0)+"%",labelParse:e=>parseInt(e,10)/100,onChange:()=>this.change()}),this.blurSlider=new h.Z("drop-shadow-blur",{label:(0,i.Z)("blur"),defaultValue:5,range:[0,150],step:1,labelFormat:e=>`${e}px`,onChange:()=>this.change()}),this.offsetXSlider=new h.Z("drop-shadow-offset-x",{label:(0,i.Z)("offsetX"),defaultValue:20,range:[-100,100],step:1,labelFormat:e=>`${e}px`,onChange:()=>this.change()}),this.offsetYSlider=new h.Z("drop-shadow-offset-y",{label:(0,i.Z)("offsetY"),defaultValue:20,range:[-100,100],step:1,labelFormat:e=>`${e}px`,onChange:()=>this.change()});const t=this.stage.fresco.getSelected();this.scratch=this.stage.fresco.addScratch(),this.scratch.setTarget(t.id,new n.Z(0,0,this.stage.fresco.width,this.stage.fresco.height),"replace"),this.position(),this.change()}}},3982:(e,t,s)=>{s.d(t,{Z:()=>u});var i=s(6548),a=s(3655),n=s(3947),o=s(6817),r=s(2634),h=s(4256),l=s(9679),c=s(4178),d=s(670);class u extends d.Z{constructor(e){super(e,(0,i.Z)("titleEffectLibrary"),!0),this.setUp=()=>{let e=o.Z.fillFit(this.selected.canvas.width,this.selected.canvas.height,220,220);this.thumbnail=a.eY(this.selected.canvas,e.width,e.height),this.marked=void 0,this.renderGroups(),new c.Z((0,n.ZP)("effect-content"))},this.renderGroups=()=>{(0,n.ZP)("effect-back").style.display="none";let e=(0,n.ZP)("effect-presets");e.innerHTML="",r.Z.groups().forEach((t=>{const s=document.createElement("div");s.classList.add("effect-group"),s.id=t,s.addEventListener("click",(()=>this.renderEffects(t)),!1);const i=document.createElement("img");i.src="/img/effect/"+t+".jpg",s.appendChild(i);let a=document.createElement("span");a.innerText=t,s.appendChild(a),e.appendChild(s)}))},this.renderEffects=e=>{(0,n.ZP)("effect-back").style.display="block",(0,n.ZP)("effect-settings").style.display="none";let t=(0,n.ZP)("effect-presets");t.innerHTML="";const s=-(this.thumbnail.width-220)/2,i=-(this.thumbnail.height-120)/2,a=new h.Z([]);r.Z.names(e).forEach((e=>{const n=document.createElement("div");n.classList.add("effect-preset"),n.id=e,n.addEventListener("click",this.select,!1);const o=document.createElement("canvas");o.width=220,o.height=120,n.appendChild(o);const r=o.getContext("2d");r.drawImage(this.thumbnail,s,i,this.thumbnail.width,this.thumbnail.height);let h=document.createElement("span");h.innerText=e,n.appendChild(h),t.appendChild(n);setTimeout((()=>{a.reset(),a.addPreset(e),r.drawImage(a.apply(this.thumbnail),s,i,this.thumbnail.width,this.thumbnail.height),this.marked&&this.marked.name==e&&setTimeout((()=>{n.classList.add("selected"),this.positionSettings(n)}),200)}),10)}))},this.amount=e=>{a.Ds("effect-amount",50,(()=>{this.shaders.reset();const e=parseInt((0,n.ZP)("effect-amount").value,10)/100;this.shaders.addPreset(this.marked.name,e),this.scratch.canvas=this.shaders.apply(this.cache),window.requestAnimationFrame((()=>this.stage.render()))}))},this.back=()=>{(0,n.ZP)("effect-settings").style.display="none",this.renderGroups()},this.select=e=>{let t=e.currentTarget,s=(0,n.ZP)("effect-presets").getElementsByTagName("div");for(var i=0;i<s.length;i++)s[i].classList.remove("selected");t.classList.add("selected"),this.effect(t.id),(0,n.ZP)("effect-settings").style.display="none",setTimeout((()=>{this.positionSettings(t)}),200)},this.positionSettings=e=>{(0,n.ZP)("effect-amount").value=(0,n.ZP)("effect_amount_out").innerHTML=(100*this.marked.value).toString();let t=(0,n.ZP)("effect-settings");t.style.display="block",t.style.top=e.offsetTop+"px",t.style.left=e.offsetLeft+"px"},this.effect=e=>{this.selected&&(this.kind="effect - "+e,this.shaders.reset(),this.marked=new l.Z(e,1),this.shaders.addPreset(e,1),this.scratch.canvas=this.shaders.apply(this.cache),window.requestAnimationFrame((()=>this.stage.render())))},this.reset=()=>{if(!this.selected)return;let e=(0,n.ZP)("effect-presets").getElementsByTagName("div");for(var t=0;t<e.length;t++)e[t].classList.remove("selected");this.marked=null,(0,n.ZP)("effect-settings").style.display="none",this.scratch.setTarget(this.selected.id,this.selected.rect,"replace",this.cache),this.stage.render()},this.dialog.style.width="500px",this.dialog.style.height="400px",this.dialog.style.maxWidth="500px",this.content.style.padding="0px 0px 0px 20px",this.content.id="effect-content",this.compare.remove(),this.setContent('\n            <div id="effect-settings">\n                <img class="close" id="effect-remove" src="/img/icon/close.svg" title="Remove effect">\n                <div class="range-white" id="effect-settings-amount">\n                    <input type="range" value="100" min="0" max="100" step="1" id="effect-amount" name="effect_amount" oninput="effect_amount_out.value=this.value" />\n                    <output name="effect_amount_out" id="effect_amount_out" for="effect_amount">100</output>\n                </div>\n            </div>\n        \n            <section id="effect-presets" class="pad-20">\n            </section>\n        '),(0,n.ZP)("dialog-buttons"+this.mid).insertBefore((0,n.T)("a",{className:"button negative",id:"effect-back",style:"position:absolute;left:10px;min-width:140px;"},(0,n.T)("img",{src:"/img/icon/back-small.svg"}),(0,i.Z)("back")),(0,n.ZP)("dialog-apply"+this.mid)),(0,n.ZP)("effect-back").addEventListener("click",this.back,!1),(0,n.ZP)("effect-remove").addEventListener("click",this.reset,!1),(0,n.ZP)("effect-amount").addEventListener("input",this.amount,!1),(0,n.ZP)("effect-settings").style.display="none",(0,n.ZP)("effect-back").style.display="none",this.setUp()}}},3099:(e,t,s)=>{s.d(t,{Z:()=>r});var i=s(670),a=s(4188),n=s(3947),o=s(6548);class r extends i.Z{constructor(e){super(e,(0,o.Z)("titleExposure")),this.setContent((0,n.T)("div",{id:"exposure"})),new a.Z("exposure",{label:(0,o.Z)("amount"),step:.01,range:[-1,1],labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,onChange:e=>this.change("exposure",e)})}}},2180:(e,t,s)=>{s.d(t,{Z:()=>g});var i=s(3947),a=s(6548),n=s(3655),o=s(9591),r=s(6817),h=s(4188),l=s(3868),c=s(8776),d=s(4820),u=s(7146),p=s(1294);class g extends l.Z{constructor(e){super((0,a.Z)("titleFill"),!1),this.cancel=()=>{this.cleanUp()},this.updatePreserve=()=>{(0,i.ZP)("filler-preserve").checked&&this.selected.rect&&this.selected.canvas?this.scratch.setTarget(this.selected.id,this.selected.rect,"over"):this.scratch.setTarget(this.selected.id,new r.Z(0,0,this.stage.fresco.width,this.stage.fresco.height),"over"),this.update()},this.update=()=>{var e,t;this.selected instanceof p.Z||(this.scratch||(this.scratch=this.stage.fresco.addScratch(),(0,i.ZP)("filler-preserve").checked&&this.selected.rect&&this.selected.canvas?this.scratch.setTarget(this.selected.id,this.selected.rect,"over"):this.scratch.setTarget(this.selected.id,new r.Z(0,0,this.stage.fresco.width,this.stage.fresco.height),"over")),this.scratch.clear(),this.scratch.settings.blendmode=(0,i.ZP)("filler-blend-mode").value,this.selected.rect&&this.selected.canvas&&(0,i.ZP)("filler-preserve").checked?(this.scratch.ctx.save(),null===(t=this.fillPod.getFill())||void 0===t||t.addToCanvas(this.scratch.ctx),this.scratch.ctx.fillRect(0,0,this.scratch.canvas.width,this.scratch.canvas.height),this.scratch.ctx.globalCompositeOperation="destination-in",this.scratch.ctx.drawImage(this.selected.canvas,0,0),this.scratch.ctx.restore()):(null===(e=this.fillPod.getFill())||void 0===e||e.addToCanvas(this.scratch.ctx),this.scratch.ctx.fillRect(0,0,this.scratch.canvas.width,this.scratch.canvas.height)),this.scratch.applySelection(this.stage),window.requestAnimationFrame((()=>this.stage.render())))},this.apply=()=>{var e;if(this.selected instanceof p.Z){const t=this.selected.trim.clone(),s=n.dN(this.selected.canvas);let a=this.selected.canvas.getContext("2d");a.save(),a.globalAlpha=this.opacity.getValue(),a.globalCompositeOperation=(0,i.ZP)("filler-blend-mode").value,null===(e=this.fillPod.getFill())||void 0===e||e.addToCanvas(this.scratch.ctx),a.fillRect(0,0,this.selected.canvas.width,this.selected.canvas.height),a.restore(),this.stage.history.add({type:"bitmapSwitch",kind:"fill",layer:this.selected,rect:t,canvas:s}),this.selected.render()}else{let e=n.l(this.scratch.getCanvas());if(e&&e.width>0&&e.height>0){const t=this.selected.rect.clone(),s=n.dN(this.selected.canvas);this.selected.extendCanvas(e),this.scratch.drawToLayer(this.selected,(0,i.ZP)("filler-blend-mode").value,this.opacity.getValue()),this.scratch.clear(),this.selected.render(),this.stage.history.add({type:"bitmapSwitch",kind:"fill",layer:this.selected,rect:t,canvas:s})}}window.requestAnimationFrame((()=>this.stage.render())),this.cleanUp()},this.cleanUp=()=>{this.fillPod.cleanUp(),this.stage.coating.freeze(!1),this.stage.fresco.removeScratch(),(0,i.ZP)("filler-preserve").removeEventListener("change",this.updatePreserve),(0,i.ZP)("filler-blend-mode").removeEventListener("change",this.update),document.removeEventListener("keydown",this.keyDown,!1),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-select")),this.selected=void 0,this.dialog.remove(),this.dialog=null,this.modal.remove(),this.modal=null},this.stage=e,this.stage.coating.freeze(!0),this.selected=this.stage.fresco.getSelected(),this.setContent(`\n\n            <label class="split">${(0,a.Z)("fill")}\n                <div id="filler-fill"></div>\n            </label>\n            <label id="filler-blend-mode-holder" class="split pad-10">${(0,a.Z)("blendMode")}\n                <div class="select pad-0" style="width:auto">\n                    <select id="filler-blend-mode">\n                        <option value="source-over" selected>${(0,a.Z)("blendModeNone")}</option>\n                        <option value="multiply">${(0,a.Z)("blendModeMultiply")}</option>\n                        <option value="screen">${(0,a.Z)("blendModeScreen")}</option>\n                        <option value="overlay">${(0,a.Z)("blendModeOverlay")}</option>\n                        <option value="darken">${(0,a.Z)("blendModeDarken")}</option>\n                        <option value="lighten">${(0,a.Z)("blendModeLighten")}</option>\n                        <option value="color-dodge">${(0,a.Z)("blendModeColorDodge")}</option>\n                        <option value="color-burn">${(0,a.Z)("blendModeColorBurn")}</option>\n                        <option value="hard-light">${(0,a.Z)("blendModeHardLight")}</option>\n                        <option value="soft-light">${(0,a.Z)("blendModeSoftLight")}</option>\n                        <option value="difference">${(0,a.Z)("blendModeDifference")}</option>\n                        <option value="exclusion">${(0,a.Z)("blendModeExclusion")}</option>\n                        <option value="hue">${(0,a.Z)("blendModeHue")}</option>\n                        <option value="saturation">${(0,a.Z)("blendModeSaturation")}</option>\n                        <option value="color">${(0,a.Z)("blendModeColor")}</option>\n                        <option value="luminosity">${(0,a.Z)("blendModeLuminosity")}</option>\n                    </select>\n                </div>\n            </label>\n\n            <div id="filler-opacity" class="range-box pad-20"></div>\n\n            <div id="filler-preserve-holder">\n                <input type="checkbox" checked id="filler-preserve" />\n                <label class="switch pad-16" for="filler-preserve">${(0,a.Z)("preserveTransparency")}<span></span></label>\n            </div>\n        `),this.fillPod=new u.Z("filler-fill",new o.Z(c.Z.fromHEX(d.ZP.mainColor)),this.update,this.update),(0,i.ZP)("filler-preserve").addEventListener("change",this.updatePreserve),(0,i.ZP)("filler-blend-mode").addEventListener("change",this.update),this.opacity=new h.Z("filler-opacity",{label:(0,a.Z)("opacity"),defaultValue:1,labelFormat:e=>(100*e).toFixed(0)+"%",labelParse:e=>parseInt(e,10)/100,onChange:e=>{this.scratch.settings.opacity=e,window.requestAnimationFrame((()=>this.stage.render()))}}),this.selected.rect&&this.selected.canvas||((0,i.ZP)("filler-blend-mode-holder").style.display="none",(0,i.ZP)("filler-preserve-holder").style.display="none"),this.update()}}},6671:(e,t,s)=>{s.d(t,{Z:()=>h});var i=s(670),a=s(4188),n=s(3947),o=s(6548),r=s(3655);class h extends i.Z{constructor(e){super(e,(0,o.Z)("titleFishEye")),this.update=r.d4(50,(()=>{const e=Number(document.querySelector('input[name="edge-fill"]:checked').value),t={amount:this.amount.getValue(),aperture:this.aperture.getValue()*(Math.PI/1.8),x:this.x.getValue(),y:this.y.getValue(),edgeFill:e};this.change("fisheye",t)})),this.setContent(`\n             <div id="fish-eye-aperture"></div>\n             <div id="fish-eye-x" class="pad-16"></div>\n             <div id="fish-eye-y" class="pad-16"></div>\n             <div id="fish-eye-amount" class="pad-10"></div>\n             <label class="split pad-35">${(0,o.Z)("edgeFill")}</label>\n             <div class="switch-field pad-5" id="fish-eye-edge-fill">\n                 <input type="radio" id="edge-fill-none" name="edge-fill" value="0" checked/><label for="edge-fill-none">${(0,o.Z)("none")}</label>\n                 <input type="radio" id="edge-fill-reflect" name="edge-fill" value="1"/><label for="edge-fill-reflect">${(0,o.Z)("reflect")}</label>\n                 <input type="radio" id="edge-fill-repeat" name="edge-fill" value="2"/><label for="edge-fill-repeat">${(0,o.Z)("repeat")}</label>\n             </div>\n            `),this.amount=new a.Z("fish-eye-amount",{label:(0,o.Z)("stretch"),range:[0,1],defaultValue:0,step:.01,labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,onChange:()=>this.update()}),this.aperture=new a.Z("fish-eye-aperture",{label:(0,o.Z)("buldge"),step:.01,range:[-Math.PI/2,Math.PI/2],defaultValue:0,labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,onChange:e=>this.update()}),this.x=new a.Z("fish-eye-x",{label:"X",range:[0,1],defaultValue:.5,step:.01,labelFormat:e=>`${Math.round(100*e)}%`,labelParse:e=>parseInt(e,10)/100,onChange:()=>this.update()}),this.y=new a.Z("fish-eye-y",{label:"Y",range:[0,1],defaultValue:.5,step:.01,labelFormat:e=>`${Math.round(100*e)}%`,labelParse:e=>parseInt(e,10)/100,onChange:()=>this.update()}),(0,n.ZP)("edge-fill-none").addEventListener("change",this.update,!1),(0,n.ZP)("edge-fill-reflect").addEventListener("change",this.update,!1),(0,n.ZP)("edge-fill-repeat").addEventListener("change",this.update,!1),this.update()}}},3146:(e,t,s)=>{s.d(t,{Z:()=>r});var i=s(670),a=s(4188),n=s(3947),o=s(6548);class r extends i.Z{constructor(e){super(e,(0,o.Z)("titleFringe")),this.setContent((0,n.T)("div",{id:"fringe-slider"})),new a.Z("fringe-slider",{label:(0,o.Z)("amount"),step:.01,range:[-1,1],labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,onChange:e=>this.change("fringe",e)})}}},2084:(e,t,s)=>{s.d(t,{Z:()=>r});var i=s(670),a=s(4188),n=s(3947),o=s(6548);class r extends i.Z{constructor(e){super(e,(0,o.Z)("titleGaussianBlur")),this.setContent((0,n.T)("div",{id:"gaussian-slider"})),new a.Z("gaussian-slider",{label:(0,o.Z)("amount"),range:[0,1],step:.01,labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,onChange:e=>this.change("gaussian",e)})}}},7534:(e,t,s)=>{s.d(t,{Z:()=>r});var i=s(670),a=s(4188),n=s(3947),o=s(6548);class r extends i.Z{constructor(e){super(e,(0,o.Z)("titleGlamour")),this.setContent((0,n.T)("div",{id:"glamour-slider"})),new a.Z("glamour-slider",{label:(0,o.Z)("amount"),range:[0,1],step:.01,labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,onChange:e=>this.change("glamour",e)})}}},9447:(e,t,s)=>{s.d(t,{Z:()=>r});var i=s(670),a=s(4188),n=s(3947),o=s(6548);class r extends i.Z{constructor(e){super(e,(0,o.Z)("titleGrain")),this.setContent((0,n.T)("div",{id:"grain-slider"})),new a.Z("grain-slider",{label:(0,o.Z)("amount"),range:[0,1],step:.01,labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,onChange:e=>this.change("grain",e)})}}},273:(e,t,s)=>{s.d(t,{Z:()=>r});var i=s(670),a=s(3947),n=s(4188),o=s(6548);class r extends i.Z{constructor(e){super(e,(0,o.Z)("titleHalftone")),this.setContent((0,a.T)("div",{id:"halftone-slider"}));const t=new n.Z("halftone-slider",{label:(0,o.Z)("frequency"),range:[.01,2],step:.01,defaultValue:.4,labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,onChange:e=>this.change("halftone",e)});setTimeout((()=>this.change("halftone",t.getValue())))}}},4550:(e,t,s)=>{s.d(t,{Z:()=>r});var i=s(670),a=s(4188),n=s(3947),o=s(6548);class r extends i.Z{constructor(e){super(e,(0,o.Z)("titleHighlightsShadows")),this.kind="highlightsShadows",this.setContent((0,n.T)("div",{id:"highlight-slider"}),(0,n.T)("div",{id:"shadows-slider",className:"pad-16"})),new a.Z("highlight-slider",{label:(0,o.Z)("highlights"),step:.01,range:[-2,2],labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,onChange:e=>this.change("highlights",e)}),new a.Z("shadows-slider",{label:(0,o.Z)("shadows"),step:.01,range:[-2,2],labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,onChange:e=>this.change("shadows",e)})}}},8997:(e,t,s)=>{s.d(t,{Z:()=>r});var i=s(670),a=s(4188),n=s(3947),o=s(6548);class r extends i.Z{constructor(e){super(e,(0,o.Z)("titleHueSaturation")),this.kind="hueSaturation",this.setContent((0,n.T)("div",{id:"hue"}),(0,n.T)("div",{id:"saturation",className:"pad-16"}),(0,n.T)("div",{id:"lightness",className:"pad-16"}),(0,n.T)("input",{type:"checkbox",id:"colorize"}),(0,n.T)("label",{className:"pad-20 switch",htmlFor:"colorize"},(0,n.T)("span"),(0,o.Z)("colorize"))),this.hue=new a.Z("hue",{label:(0,o.Z)("hue"),range:[-180,180],step:1,labelFormat:e=>String(e),labelParse:e=>parseInt(e,10),onChange:e=>{this.isColorize?this.change("colorize",e+181):this.change("hue",e)}}),this.sat=new a.Z("saturation",{label:(0,o.Z)("saturation"),step:.01,range:[-1,1],labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,onChange:e=>this.change("saturation",e)}),this.lig=new a.Z("lightness",{label:(0,o.Z)("lightness"),step:.01,range:[-1,1],labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,onChange:e=>this.change("lightness",e)}),(0,n.ZP)("colorize").addEventListener("click",(()=>{this.isColorize=(0,n.ZP)("colorize").checked,this.shaders.addShader("hue",0),this.shaders.addShader("saturation",0),this.shaders.addShader("lightness",0),this.hue.setValue(0),this.sat.setValue(0),this.lig.setValue(0),this.change("colorize",this.isColorize?181:0)}))}}},7012:(e,t,s)=>{s.d(t,{Z:()=>u});var i=s(6548),a=s(3947),n=s(3655),o=s(1030),r=s(4188),h=s(8776),l=s(4256),c=s(4211),d=s(670);class u extends d.Z{constructor(e){super(e,(0,i.Z)("titleInnerGlow")),this.load=async()=>{const e=Promise.resolve().then(s.bind(s,8132)),t=n.iF();await t;const{distanceTransformInv:i}=await e,r=this.shaders.ctx,h=this.cache.getContext("2d").getImageData(0,0,this.cache.width,this.cache.height),l=i(this.cache.width,this.cache.height,h.data);if(!r.getSupportedExtensions().includes("OES_texture_float"))return alert("sorry, this filter requires float textures"),void(0,o.Z)("OES_texture_float");r.getExtension("OES_texture_float");const c=r.createTexture();r.bindTexture(r.TEXTURE_2D,c),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texImage2D(r.TEXTURE_2D,0,r.ALPHA,this.cache.width,this.cache.height,0,r.ALPHA,r.FLOAT,l),r.bindTexture(r.TEXTURE_2D,null),this.map=c,(0,a.ZP)("innerglow-loading").style.display="none",(0,a.ZP)("innerglow-controls").style.visibility="visible",this.enableApply(),this.update()},this.update=()=>{const e={size:this.size.getValue(),feather:this.feather.getValue(),opacity:this.opacity.getValue(),color:this.color.getColor(),distanceMap:this.map};this.change("inner-glow",e.size?e:null)},this.disableApply(),this.kind="innerGlow",this.shaders=new l.Z,this.setContent((0,a.T)("div",{className:"dialog-loading"},(0,a.T)("div",{id:"innerglow-controls",className:"controls"},(0,a.T)("label",{className:"split"},(0,i.Z)("color"),(0,a.T)("div",{id:"glow-color",className:"colod-pod pad-4"})),(0,a.T)("div",{id:"glow-size",className:"range-box pad-16"}),(0,a.T)("div",{id:"glow-feather",className:"range-box pad-10"}),(0,a.T)("div",{id:"glow-opacity",className:"range-box pad-10"})),(0,a.T)("div",{id:"innerglow-loading",className:"message"},(0,i.Z)("loading"),(0,a.T)("span","."),(0,a.T)("span","."),(0,a.T)("span",".")))),this.color=new c.Z("glow-color",h.Z.fromHEX("#ffffff"),this.update),this.opacity=new r.Z("glow-opacity",{label:(0,i.Z)("opacity"),range:[0,1],defaultValue:1,step:.01,labelFormat:e=>`${Math.round(100*e)}%`,labelParse:e=>parseInt(e,10)/100,onChange:()=>this.update()}),this.size=new r.Z("glow-size",{label:(0,i.Z)("size"),range:[0,150],defaultValue:10,step:1,labelFormat:e=>`${e}px`,onChange:()=>this.update()}),this.feather=new r.Z("glow-feather",{label:(0,i.Z)("feather"),range:[0,1],defaultValue:.5,step:.01,labelFormat:e=>`${Math.round(100*e)}%`,labelParse:e=>parseInt(e,10)/100,onChange:()=>this.update()}),this.position(),this.load()}}},889:(e,t,s)=>{s.d(t,{Z:()=>r});var i=s(670),a=s(4188),n=s(3947),o=s(6548);class r extends i.Z{constructor(e){super(e,(0,o.Z)("titleInterference")),this.update=()=>{this.change("interference",{seed:this.seed.getValue(),amount:this.amount.getValue(),direction:(0,n.ZP)("interfer-direction").checked})},this.kind="interference",this.setContent((0,n.T)("div",{id:"interfer-seed"}),(0,n.T)("div",{id:"interfer-amount",className:"range-box pad-16"}),(0,n.T)("input",{type:"checkbox",id:"interfer-direction"}),(0,n.T)("label",{className:"pad-20 switch",htmlFor:"interfer-direction"},(0,n.T)("span"),(0,o.Z)("vertical"))),this.seed=new a.Z("interfer-seed",{label:(0,o.Z)("seed"),range:[0,100],step:1,defaultValue:23,labelFormat:e=>String(e),onChange:e=>this.update()}),this.amount=new a.Z("interfer-amount",{label:(0,o.Z)("amount"),step:.01,range:[-1,1],defaultValue:.2,labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,onChange:e=>this.update()}),(0,n.ZP)("interfer-direction").addEventListener("click",(()=>{this.update()})),this.update()}}},8679:(e,t,s)=>{s.d(t,{Z:()=>r});var i=s(6548),a=s(3655),n=s(4188),o=s(670);class r extends o.Z{constructor(e){super(e,(0,i.Z)("titleKaleidoscope")),this.update=()=>{a.Ds("kaleidoscope",50,(()=>{const e={amount:this.amount.getValue(),stretch:this.stretch.getValue(),position:this.pos.getValue()};this.change("kaleidoscope",e)}))},this.setContent('\n             <div id="kaleidoscope-amount"></div>\n             <div id="kaleidoscope-stretch" class="pad-16"></div>\n             <div id="kaleidoscope-position" class="pad-16"></div>\n            '),this.amount=new n.Z("kaleidoscope-amount",{label:(0,i.Z)("amount"),range:[2,20],defaultValue:5,step:1,onChange:()=>this.update()}),this.stretch=new n.Z("kaleidoscope-stretch",{label:"Stretch",range:[0,1],defaultValue:0,step:.01,labelFormat:e=>`${Math.round(100*e)}%`,labelParse:e=>parseInt(e,10)/100,onChange:()=>this.update()}),this.pos=new n.Z("kaleidoscope-position",{label:"Position",range:[0,1],defaultValue:0,step:.01,labelFormat:e=>`${Math.round(100*e)}%`,labelParse:e=>parseInt(e,10)/100,onChange:()=>this.update()}),this.update()}}},7878:(e,t,s)=>{s.d(t,{Z:()=>r});var i=s(3947),a=s(6548),n=s(1662),o=s(670);class r extends o.Z{constructor(e){super(e,(0,a.Z)("titleLevels")),this.selectChannelEvent=e=>{this.selectChannel(e.currentTarget.getAttribute("data-name"))},this.channel="",this.selectChannel=e=>{switch(this.channel&&((0,i.ZP)("channel-"+this.channel).classList.remove("active"),(0,i.ZP)("levels-graph-"+this.channel).classList.remove("active")),this.channel=e,(0,i.ZP)("channel-"+this.channel).classList.add("active"),(0,i.ZP)("levels-graph-"+this.channel).classList.add("active"),this.channel){case"all":this.aCM=this.all;break;case"red":this.aCM=this.red;break;case"green":this.aCM=this.green;break;case"blue":this.aCM=this.blue}this.setKnobs(),this.setInputs()},this.setKnobs=()=>{this.ikMin.style.left=this.aCM.minin+"px",this.ikMax.style.left=this.aCM.maxin+"px",this.ikMid.style.left=Math.floor((this.aCM.maxin-this.aCM.minin)*this.aCM.mid)+this.aCM.minin+"px",this.okMin.style.left=this.aCM.minout+"px",this.okMax.style.left=this.aCM.maxout+"px"},this.setInputs=()=>{this.ivMin.value=this.aCM.minin.toString(),this.ivMid.value=this.aCM.midin.toFixed(1),this.ivMax.value=this.aCM.maxin.toString(),this.ovMin.value=this.aCM.minout.toString(),this.ovMax.value=this.aCM.maxout.toString()},this.inputInput=e=>{let t=e.currentTarget.getAttribute("id"),s=Number(e.currentTarget.value);if(!isNaN(s)){switch(t){case"input-value-min":this.aCM.minin=Math.min(Math.max(s,0),this.aCM.maxin-10);break;case"input-value-mid":break;case"input-value-max":this.aCM.maxin=Math.min(Math.max(s,this.aCM.minin+10),255);break;case"output-value-min":this.aCM.minout=Math.min(Math.max(s,0),this.aCM.maxout-10);break;case"output-value-max":this.aCM.maxout=Math.min(Math.max(s,this.aCM.minout+10),255)}this.setKnobs(),this.levelChange()}},this.analyzeImage=()=>{let e,t,s,a=this.cache.width,n=this.cache.height,o=this.cache.getContext("2d").getImageData(0,0,a,n).data,r=new Uint32Array(256),h=new Uint32Array(256),l=new Uint32Array(256),c=new Uint32Array(256);for(let i=0,d=o.length;i<d;i+=4)o[i+3]>0&&(e=o[i],t=o[i+1],s=o[i+2],c[e]+=1,c[t]+=1,c[s]+=1,r[e]+=1,h[t]+=1,l[s]+=1);this.drawChannel(c,(0,i.ZP)("levels-graph-all"),"rgba(180, 180, 180, 1)"),this.drawChannel(r,(0,i.ZP)("levels-graph-red"),"rgba(209, 72, 14, 1)"),this.drawChannel(h,(0,i.ZP)("levels-graph-green"),"rgba(146, 156, 31, 1)"),this.drawChannel(l,(0,i.ZP)("levels-graph-blue"),"rgba(58, 110, 154, 1)")},this.drawChannel=(e,t,s)=>{for(var i=new Array(0,0,0,0),a=0;a<e.length;++a)i[0]<e[a]?i[0]=e[a]:i[1]<e[a]?i[1]=e[a]:i[2]<e[a]?i[2]=e[a]:i[3]<e[a]&&(i[3]=e[a]);let n=i.sort((function(e,t){return e-t}))[0],o=t.getContext("2d");o.save(),o.lineWidth=2,o.strokeStyle=s,o.fillStyle=s,o.beginPath(),o.moveTo(0,128),o.lineTo(0,128);for(var r=0;r<256;++r){let t=Math.min(Math.round(e[r]/n*128),128);o.lineTo(r,128-t)}o.lineTo(256,128),o.closePath(),o.stroke(),o.globalAlpha=.7,o.fill(),o.restore()},this.touchStart=e=>{e.preventDefault(),e.stopPropagation(),this.down(e.changedTouches[0].clientX,e.changedTouches[0].clientY,e.currentTarget),document.addEventListener("touchmove",this.touchMove,{passive:!0}),document.addEventListener("touchend",this.touchEnd,{passive:!0})},this.touchMove=e=>{e.preventDefault(),e.stopPropagation(),this.move(e.changedTouches[0].clientX,e.changedTouches[0].clientY)},this.touchEnd=e=>{e.preventDefault(),e.stopPropagation(),document.removeEventListener("touchmove",this.touchMove),document.removeEventListener("touchend",this.touchEnd)},this.mouseDown=e=>{e.stopPropagation(),this.down(e.clientX,e.clientY,e.currentTarget),document.addEventListener("mousemove",this.mouseMove,!0),document.addEventListener("mouseup",this.mouseUp,!0)},this.mouseMove=e=>{e.stopPropagation(),this.move(e.clientX,e.clientY)},this.mouseUp=e=>{e.stopPropagation(),document.removeEventListener("mousemove",this.mouseMove,!0),document.removeEventListener("mouseup",this.mouseUp,!0)},this.down=(e,t,s)=>{switch(this.downX=e,this.target=s.getAttribute("id"),this.target){case"input-knob-min":this.start=this.aCM.minin;break;case"input-knob-mid":this.start=s.offsetLeft;break;case"input-knob-max":this.start=this.aCM.maxin;break;case"output-knob-min":this.start=this.aCM.minout;break;case"output-knob-max":this.start=this.aCM.maxout}},this.move=(e,t)=>{let s=this.start+(e-this.downX);switch(this.target){case"input-knob-min":this.aCM.minin=Math.min(Math.max(s,0),this.aCM.maxin-10);break;case"input-knob-mid":this.aCM.setMid(Math.min(Math.max(s,this.aCM.minin+5),this.aCM.maxin-5));break;case"input-knob-max":this.aCM.maxin=Math.min(Math.max(s,this.aCM.minin+10),255);break;case"output-knob-min":this.aCM.minout=Math.min(Math.max(s,0),this.aCM.maxout-10);break;case"output-knob-max":this.aCM.maxout=Math.min(Math.max(s,this.aCM.minout+10),255)}this.setKnobs(),this.setInputs(),this.levelChange()},this.levelChange=()=>{this.shaders.addShader("levels",this.all),this.shaders.addShader("multilevels",this.red.isFlat()&&this.green.isFlat()&&this.blue.isFlat()?null:[this.red,this.green,this.blue]),setTimeout((()=>{this.scratch.canvas=this.shaders.apply(this.cache),window.requestAnimationFrame((()=>this.stage.render()))}),0)},this.cleanUp=()=>{(0,i.ZP)("levels-swatches").querySelectorAll("div").forEach((e=>{e.removeEventListener("click",this.selectChannelEvent,!1)})),(0,i.ZP)("levels-overlay").querySelectorAll("input").forEach((e=>{e.removeEventListener("input",this.inputInput,!1),e.removeEventListener("blur",this.setInputs,!1)})),this.stage.fresco.removeScratch(),document.removeEventListener("keydown",this.keyDown,!1),this.stage.coating.freeze(!1),this.stage.render(),this.shaders.cleanUp(),this.dialog.remove(),this.dialog=null,this.modal.remove(),this.modal=null},this.kind="levels",this.dialog.style.width="380px",this.dialog.style.maxWidth="380px",this.content.style.paddingBottom="4px",this.setContent('\n            <div id="levels-holder">      \n                <div id="levels-swatches" class="swatches">\n                    <div data-name="all" id="channel-all"><span class="ic" style="background-color: #ccc"></span></div>\n                    <div data-name="red" id="channel-red"><span style="background-color: #d1480e;"></span></div>\n                    <div data-name="green" id="channel-green"><span style="background-color:#929C1F;"></span></div>\n                    <div data-name="blue" id="channel-blue"><span style="background-color: #3a6e9a"></span></div>\n                </div>\n                <div id="levels-overlay">\n                    <div id="levels-input">\n                        <canvas class="levels-graph" width="256" height="128" unselectable="on" id="levels-graph-all"></canvas>\n                        <canvas class="levels-graph" width="256" height="128" unselectable="on" id="levels-graph-red"></canvas>\n                        <canvas class="levels-graph" width="256" height="128" unselectable="on" id="levels-graph-green"></canvas>\n                        <canvas class="levels-graph" width="256" height="128" unselectable="on" id="levels-graph-blue"></canvas>\n                        <div class="knob" id="input-knob-min"><div class="bg ic"></div></div>\n                        <div class="knob" id="input-knob-mid"><div class="bg ic"></div></div>\n                        <div class="knob" id="input-knob-max"><div class="bg ic"></div></div>\n                    </div>\n                    <div id="levels-input-values">\n                        <input type="number" id="input-value-min" value="0">\n                        <input type="number" id="input-value-mid" value="1.0">\n                        <input type="number" id="input-value-max" value="255">\n                    </div>\n                    <div id="levels-output" class="pad-10">\n                        <div id="slide"></div>\n                        <div class="knob" id="output-knob-min"><div class="bg ic"></div></div>\n                        <div class="knob" id="output-knob-max"><div class="bg ic"></div></div>\n                    </div>\n                    <div id="levels-output-values">\n                        <input type="number" id="output-value-min" value="0">\n                        <input type="number" id="output-value-max" value="255">\n                    </div>\n                </div>\n            </div>\n        '),(0,i.ZP)("levels-swatches").querySelectorAll("div").forEach((e=>{e.addEventListener("click",this.selectChannelEvent,!1)})),(0,i.ZP)("levels-overlay").querySelectorAll("input").forEach((e=>{e.addEventListener("input",this.inputInput,!1),e.addEventListener("blur",this.setInputs,!1)})),this.ivMin=(0,i.ZP)("input-value-min"),this.ivMid=(0,i.ZP)("input-value-mid"),this.ivMax=(0,i.ZP)("input-value-max"),this.ovMin=(0,i.ZP)("output-value-min"),this.ovMax=(0,i.ZP)("output-value-max"),this.ikMin=(0,i.ZP)("input-knob-min"),this.ikMid=(0,i.ZP)("input-knob-mid"),this.ikMax=(0,i.ZP)("input-knob-max"),this.okMin=(0,i.ZP)("output-knob-min"),this.okMax=(0,i.ZP)("output-knob-max"),this.ikMin.addEventListener("mousedown",this.mouseDown,!0),this.ikMid.addEventListener("mousedown",this.mouseDown,!0),this.ikMax.addEventListener("mousedown",this.mouseDown,!0),this.okMin.addEventListener("mousedown",this.mouseDown,!0),this.okMax.addEventListener("mousedown",this.mouseDown,!0),this.ikMin.addEventListener("touchstart",this.touchStart,{passive:!0}),this.ikMid.addEventListener("touchstart",this.touchStart,{passive:!0}),this.ikMax.addEventListener("touchstart",this.touchStart,{passive:!0}),this.okMin.addEventListener("touchstart",this.touchStart,{passive:!0}),this.okMax.addEventListener("touchstart",this.touchStart,{passive:!0}),this.all=new n.Z,this.red=new n.Z,this.green=new n.Z,this.blue=new n.Z,this.analyzeImage(),this.selectChannel("all")}}},556:(e,t,s)=>{s.d(t,{Z:()=>h});var i=s(670),a=s(4188),n=s(3947),o=s(3655),r=s(6548);class h extends i.Z{constructor(e){super(e,(0,r.Z)("titleMimicHDR")),this.createBlurMap=()=>{this.shaders.addShader("blur",1),this.shaders.addShader("invert",1),this.shaders.addShader("desaturate",1),this.blurmap=o.dN(this.shaders.apply(this.cache)),this.shaders.reset()},this.update=o.d4(10,(()=>{this.change("mimichdr",0===this.amount.getValue()?0:{amount:this.amount.getValue(),contra:this.contra.getValue(),blurMap:this.blurmap})})),this.kind="mimicHDR",this.setContent((0,n.T)("div",{id:"mimichdr-amount"}),(0,n.T)("div",{id:"mimichdr-contra"})),this.amount=new a.Z("mimichdr-amount",{label:(0,r.Z)("amount"),range:[0,1],step:.01,defaultValue:.5,labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,onChange:e=>this.update()}),this.contra=new a.Z("mimichdr-contra",{label:(0,r.Z)("contrast"),range:[0,1],step:.01,defaultValue:.2,labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,onChange:e=>this.update()}),this.createBlurMap(),this.update()}}},1769:(e,t,s)=>{s.d(t,{Z:()=>o});var i=s(670),a=s(3947),n=s(6548);class o extends i.Z{constructor(e){super(e,(0,n.Z)("titleMonochrome")),this.setValue=(e,t,s)=>{this.mRed.style.height=Math.round(24+100*e)+"px",this.mGreen.style.height=Math.round(24+100*t)+"px",this.mBlue.style.height=Math.round(24+100*s)+"px",(0,a.ZP)("monochrome-red").innerText="R: "+(100*e).toFixed(1)+"%",(0,a.ZP)("monochrome-green").innerText="G: "+(100*t).toFixed(1)+"%",(0,a.ZP)("monochrome-blue").innerText="B: "+(100*s).toFixed(1)+"%",this.update(e,t,s)},this.update=(e,t,s)=>{this.change("monochrome",{r:e,g:t,b:s})},this.dialog.style.width="440px",this.dialog.style.maxWidth="440px",this.mRed=(0,a.T)("div",{style:"background-color:#d1480e;"}),this.mGreen=(0,a.T)("div",{style:"background-color:#929C1F;"}),this.mBlue=(0,a.T)("div",{style:"background-color:#3a6e9a;"}),this.content.classList.add("flex");var t=(0,a.T)("div",{style:"margin-top:2px",className:"select"});t.innerHTML='\n            <select id="monochrome-preset">\n                <option value="0.299:0.587:0.114" selected>Rec601 Luma (Vision)</option>\n                <option value="0.2126:0.7152:0.0722">sRGB ITU-R BT.709</option>\n                <option value="0.2627:0.6780:0.0593">HDR ITU-R BT.2100</option>\n                <option value="0.3333333:0.3333334:0.3333333">Unweighted</option>\n                <option value="1:0:0">Red</option>\n                <option value="0:1:0">Green</option>\n                <option value="0:0:1">Blue</option>\n                <option value="0.18:0.41:0.41">Agfa 200X</option>\n                <option value="0.25:0.39:0.36">Agfapan 25</option>\n                <option value="0.21:0.40:0.39">Agfapan 100</option>\n                <option value="0.20:0.41:0.39">Agfapan 400</option>\n                <option value="0.21:0.42:0.37">Ilford Delta 100 & XP2 Super</option>\n                <option value="0.22:0.42:0.36">Ilford Delta 400</option>\n                <option value="0.31:0.36:0.33">Ilford Delta 400 Pro & 3200</option>\n                <option value="0.28:0.41:0.31">Ilford FP4</option>\n                <option value="0.23:0.37:0.40">Ilford HP5</option>\n                <option value="0.33:0.36:0.31">Ilford Pan F</option>\n                <option value="0.36:0.31:0.33">Ilford SFX</option>\n                <option value="0.21:0.42:0.37">Ilford</option>\n                <option value="0.24:0.37:0.39">Kodak Tmax 100</option>\n                <option value="0.27:0.36:0.37">Kodak Tmax 400</option>\n                <option value="0.25:0.35:0.40">Kodak Tri-X</option>\n                <option value="0.5:0.5:0">Red Green</option>\n                <option value="0:0.5:0.5:">Green Blue</option>\n                <option value="0.5:0:0.5:">Blue Red</option>\n            </select>\n        ';let s=(0,a.T)("div",{style:"margin:10px 20px;opacity:0.7",className:"flex"});s.innerHTML='\n            <div id="monochrome-red">R: </div>\n            <div id="monochrome-green">G: </div>\n            <div id="monochrome-blue">B: </div>\n        ',this.setContent((0,a.T)("div",{style:"position:relative;margin-top:20px;margin-bottom:30px;margin-left:10px;margin-right:5px;"},(0,a.T)("div",{className:"swatch-slider"},this.mRed),(0,a.T)("div",{className:"swatch-slider"},this.mGreen),(0,a.T)("div",{className:"swatch-slider"},this.mBlue)),(0,a.T)("div",{style:"flex-grow:1;margin:20px"},(0,a.T)("label",{},(0,n.Z)("preset")),t,s)),(0,a.ZP)("monochrome-preset").addEventListener("change",(()=>{let e=(0,a.ZP)("monochrome-preset").value.split(":");this.setValue(Number(e[0]),Number(e[1]),Number(e[2]))})),this.setValue(.299,.587,.114)}}},1983:(e,t,s)=>{s.d(t,{Z:()=>r});var i=s(670),a=s(4188),n=s(3947),o=s(6548);class r extends i.Z{constructor(e){super(e,(0,o.Z)("titleMosaic")),this.setContent((0,n.T)("div",{id:"mosaic-slider"})),new a.Z("mosaic-slider",{label:(0,o.Z)("amount"),range:[0,1],step:.01,labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,onChange:e=>this.change("mosaic",e)})}}},9977:(e,t,s)=>{s.d(t,{Z:()=>h});var i=s(670),a=s(4188),n=s(3947),o=s(3655),r=s(6548);class h extends i.Z{constructor(e){super(e,(0,r.Z)("titleMotionBlur")),this.update=()=>{o.Ds("motion-blur",50,(()=>{const e={amount:this.amount.getValue(),angle:this.angle.getValue()*(Math.PI/1.8)};this.change("motion",e.amount?e:void 0)}))},this.setContent((0,n.T)("div",{id:"motion-amount"}),(0,n.T)("div",{id:"motion-angle"})),this.amount=new a.Z("motion-amount",{label:(0,r.Z)("amount"),range:[0,1],step:.05,labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,onChange:()=>this.update()}),this.angle=new a.Z("motion-angle",{label:(0,r.Z)("angle"),step:.01,range:[0,3.6],defaultValue:0,labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,onChange:e=>this.update()}),this.update()}}},6353:(e,t,s)=>{s.d(t,{Z:()=>r});var i=s(670),a=s(4188),n=s(3947),o=s(6548);class r extends i.Z{constructor(e){super(e,(0,o.Z)("titleNoise")),this.setContent((0,n.T)("div",{id:"noise-slider"})),new a.Z("noise-slider",{label:(0,o.Z)("amount"),range:[0,1],step:.01,labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,onChange:e=>this.change("noise",e)})}}},255:(e,t,s)=>{s.d(t,{Z:()=>u});var i=s(6548),a=s(3655),n=s(3947),o=s(1030),r=s(3868),h=s(4188),l=s(8776),c=s(4256),d=s(4211);class u extends r.Z{constructor(e){super((0,i.Z)("titleOuterGlow"),!1),this.stage=e,this.load=async()=>{const e=Promise.resolve().then(s.bind(s,8132)),t=a.iF();await t;const{distanceTransform:i}=await e,r=this.stage.fresco.getSelected(),h=r.rect.pad(150);this.cache=a.vL(h.width,h.height),this.cache.getContext("2d").drawImage(r.canvas,150,150),this.scratch=this.stage.fresco.addScratch(),this.scratch.setTarget(r.id,h,"replace"),this.scratch.canvas=this.cache;const l=this.shaders.ctx,c=this.cache.getContext("2d").getImageData(0,0,this.cache.width,this.cache.height),d=i(this.cache.width,this.cache.height,c.data);if(!l.getSupportedExtensions().includes("OES_texture_float"))return alert("sorry, this filter requires float textures"),void(0,o.Z)("OES_texture_float");l.getExtension("OES_texture_float");const u=l.createTexture();l.bindTexture(l.TEXTURE_2D,u),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,l.NEAREST),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,l.NEAREST),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE),l.texImage2D(l.TEXTURE_2D,0,l.ALPHA,this.cache.width,this.cache.height,0,l.ALPHA,l.FLOAT,d),l.bindTexture(l.TEXTURE_2D,null),this.map=u,(0,n.ZP)("outerglow-loading").style.display="none",(0,n.ZP)("outerglow-controls").style.visibility="visible",this.enableApply(),this.update()},this.update=()=>{const e={size:this.size.getValue(),feather:this.feather.getValue(),opacity:this.opacity.getValue(),color:this.color.getColor(),distanceMap:this.map};this.shaders.addShader("outer-glow",e.size?e:null),window.requestAnimationFrame((()=>{this.scratch.canvas=this.shaders.apply(this.cache),this.stage.render()}))},this.apply=()=>{const e=this.stage.fresco.getSelected(),t=a.l(a.dN(this.scratch.canvas)).rebase(-this.scratch.rect.x,-this.scratch.rect.y),s=a.$E(e.canvas,t.rebase(e.rect.x,e.rect.y)),i=a.dN(e.mask),n=e.rect.clone();e.extendCanvas(t),this.scratch.drawToLayer(e,"copy"),e.render(),this.stage.fresco.removeScratch(),this.stage.history.add({type:"bitmapChange",kind:"outerGlow",layer:e,rect:n,patchRect:t.rebase(e.rect.x,e.rect.y),patch:s,mask:i}),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-select")),this.cleanUp()},this.cancel=()=>{this.stage.fresco.removeScratch(),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-select")),this.cleanUp()},this.disableApply(),this.shaders=new c.Z,this.setContent((0,n.T)("div",{className:"dialog-loading"},(0,n.T)("div",{id:"outerglow-controls",className:"controls"},(0,n.T)("label",{className:"split"},(0,i.Z)("color"),(0,n.T)("div",{id:"glow-color",className:"pad-4"})),(0,n.T)("div",{id:"glow-size",className:"range-box pad-16"}),(0,n.T)("div",{id:"glow-feather",className:"range-box pad-10"}),(0,n.T)("div",{id:"glow-opacity",className:"range-box pad-10"})),(0,n.T)("div",{id:"outerglow-loading",className:"message"},(0,i.Z)("loading"),(0,n.T)("span","."),(0,n.T)("span","."),(0,n.T)("span",".")))),this.color=new d.Z("glow-color",l.Z.fromHEX("#ffffff"),this.update),this.opacity=new h.Z("glow-opacity",{label:(0,i.Z)("opacity"),range:[0,1],defaultValue:1,step:.01,labelFormat:e=>`${Math.round(100*e)}%`,labelParse:e=>parseInt(e,10)/100,onChange:()=>this.update()}),this.size=new h.Z("glow-size",{label:(0,i.Z)("size"),range:[0,150],defaultValue:15,step:1,labelFormat:e=>`${e}px`,onChange:()=>this.update()}),this.feather=new h.Z("glow-feather",{label:(0,i.Z)("feather"),range:[0,1],defaultValue:.5,step:.01,labelFormat:e=>`${Math.round(100*e)}%`,labelParse:e=>parseInt(e,10)/100,onChange:()=>this.update()}),this.position(),this.load()}}},323:(e,t,s)=>{s.d(t,{Z:()=>r});var i=s(670),a=s(4188),n=s(3947),o=s(6548);class r extends i.Z{constructor(e){super(e,(0,o.Z)("titlePixelate")),this.setContent((0,n.T)("div",{id:"pixelate-slider"})),new a.Z("pixelate-slider",{label:(0,o.Z)("amount"),range:[0,1],step:.01,labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,onChange:e=>this.change("pixelate",e)})}}},6479:(e,t,s)=>{s.d(t,{Z:()=>r});var i=s(670),a=s(4188),n=s(3947),o=s(6548);class r extends i.Z{constructor(e){super(e,(0,o.Z)("titlePolarCoordinates")),this.update=()=>{this.change("polarcoordinates",{rotate:this.rotate.getValue()*(Math.PI/1.8),overlap:this.overlap.getValue()*(Math.PI/2),flip:(0,n.ZP)("polarcoordinates-flip").checked,symmetry:(0,n.ZP)("polarcoordinates-symmetry").checked})},this.setContent((0,n.T)("div",{id:"polarcoordinates-rotate"}),(0,n.T)("div",{id:"polarcoordinates-overlap",className:"range-box pad-16"}),(0,n.T)("input",{type:"checkbox",id:"polarcoordinates-flip"}),(0,n.T)("label",{className:"pad-20 switch",htmlFor:"polarcoordinates-flip"},(0,n.T)("span"),(0,o.Z)("flip")),(0,n.T)("input",{type:"checkbox",id:"polarcoordinates-symmetry"}),(0,n.T)("label",{className:"pad-20 switch",htmlFor:"polarcoordinates-symmetry"},(0,n.T)("span"),(0,o.Z)("symmetry"))),this.rotate=new a.Z("polarcoordinates-rotate",{label:(0,o.Z)("rotate"),step:.01,range:[0,3.6],defaultValue:0,labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,onChange:e=>this.update()}),this.overlap=new a.Z("polarcoordinates-overlap",{label:(0,o.Z)("overlap"),step:.01,range:[0,1],defaultValue:0,labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,onChange:e=>this.update()}),(0,n.ZP)("polarcoordinates-flip").addEventListener("click",(()=>{this.update()})),(0,n.ZP)("polarcoordinates-symmetry").addEventListener("click",(()=>{this.update()})),this.update()}}},7132:(e,t,s)=>{s.d(t,{Z:()=>r});var i=s(670),a=s(4188),n=s(3947),o=s(6548);class r extends i.Z{constructor(e){super(e,(0,o.Z)("titlePosterize")),this.setContent((0,n.T)("div",{id:"posterize-slider"})),new a.Z("posterize-slider",{label:(0,o.Z)("colors"),range:[0,.3],step:.01,labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,onChange:e=>this.change("posterize",e)})}}},18:(e,t,s)=>{s.d(t,{Z:()=>r});var i=s(6548),a=s(3868),n=s(3947),o=s(4820);class r extends a.Z{constructor(){super((0,i.Z)("titlePreferences"),!1),this.dialog.style.width="440px",this.dialog.style.maxWidth="440px",this.setContent(`\n            <label>${(0,i.Z)("viewOBarAccent")}</label>\n            <div id="preference-accent" class="pad-4 color-pod-list" style="display:flex">\n                <div class="color-pod small" data="ash" style="background-color:#383E42"></div>\n                <div class="color-pod small" data="brown" style="background-color:#715649"></div>\n                <div class="color-pod small" data="coral" style="background-color:#F3764C"></div>\n                <div class="color-pod small" data="pink" style="background-color:#F17686"></div>\n                <div class="color-pod small" data="rose" style="background-color:#FE5151"></div>\n                <div class="color-pod small" data="red" style="background-color:#BA2B46"></div>\n                <div class="color-pod small" data="plum" style="background-color:#5A354F"></div>\n                <div class="color-pod small" data="maroon" style="background-color:#A82068"></div>\n                <div class="color-pod small" data="purple" style="background-color:#7D4199"></div>\n                <div class="color-pod small" data="lavender" style="background-color:#6D5DD2"></div>\n                <div class="color-pod small" data="denim" style="background-color:#496171"></div>\n                <div class="color-pod small" data="blue" style="background-color:#0099CC"></div>\n                <div class="color-pod small" data="teal" style="background-color:#00A5A5"></div>\n                <div class="color-pod small" data="green" style="background-color:#48B07B"></div>\n                <div class="color-pod small" data="lime" style="background-color:#95C20F"></div>\n                <div class="color-pod small" data="mustard" style="background-color:#F5BB00"></div>\n            </div>\n\n            <label class="pad-16">${(0,i.Z)("viewOBarWorkspace")}</label>\n            <div id="preference-workspace" class="color-selector-presets extended pad-4" style="width:200px">\n                <div data="dark" class="color-pod square" style="background-color: #232529"></div>\n                <div data="iron" class="color-pod square" style="background-color: #606060"></div>\n                <div data="steel" class="color-pod square" style="background-color: #999999"></div>\n                <div data="light" class="color-pod square" style="background-color: #cccccc"></div>\n            </div>\n\n            <a id="preference-theme-reset" class="link pad-20" style="display:inline-block;">${(0,i.Z)("reset")}</a>\n\n            <div class="splitter small pad-16"></div>\n            <input type="checkbox" id="setting-ask-preresize" />\n            <label class="switch pad-16" for="setting-ask-preresize">${(0,i.Z)("viewOBarAskPrerezise")}<span></span></label>\n            <input type="checkbox" id="setting-ask-layertyp" />\n            <label class="switch pad-10" for="setting-ask-layertyp">${(0,i.Z)("viewOBarAskLayertype")}<span></span></label>\n            <input type="checkbox" id="setting-guides" />\n            <label class="switch pad-10" for="setting-guides">${(0,i.Z)("viewOBarShowGu")}<span></span></label>\n            <input type="checkbox" id="settings-snap-to" />\n            <label class="switch pad-10" for="settings-snap-to">${(0,i.Z)("viewOBarSnap")}<span></span></label>\n\n            <label class="split pad-10" for="settings-scroll-mode">${(0,i.Z)("viewOBarScollMode")}\n                <div class="select pad-0" style="width:auto">\n                    <select id="settings-scroll-mode">\n                        <option value="zoom">${(0,i.Z)("zoom")}</option>\n                        <option value="move">${(0,i.Z)("move")}</option>\n                        <option value="none">${(0,i.Z)("none")}</option>\n                    </select> \n                </div>\n            </label>\n        `);let e=o.ZP.accent,t=(0,n.ZP)("preference-accent").getElementsByTagName("div");for(var s=0;s<t.length;s+=1)t[s].addEventListener("click",(t=>{document.documentElement.classList.remove(e),e=t.currentTarget.getAttribute("data"),document.documentElement.classList.add(e),document.dispatchEvent(new CustomEvent("layer-list-render")),(0,o.Lt)("accent",e)}));let a=o.ZP.workspace,r=(0,n.ZP)("preference-workspace").getElementsByTagName("div");for(s=0;s<r.length;s+=1)r[s].addEventListener("click",(e=>{document.documentElement.classList.remove(a),a=e.currentTarget.getAttribute("data"),document.documentElement.classList.add(a),(0,o.Lt)("workspace",a)}));(0,n.ZP)("preference-theme-reset").addEventListener("click",(()=>{(0,o.Lt)("workspace","default"),(0,o.Lt)("accent","default"),document.documentElement.className=""}));const h=(0,n.ZP)("setting-ask-preresize");h.checked=o.ZP.askToPreResize,h.onchange=()=>(0,o.Lt)("askToPreResize",h.checked);const l=(0,n.ZP)("setting-ask-layertyp");l.checked=o.ZP.askToAddLayer,l.onchange=()=>(0,o.Lt)("askToAddLayer",l.checked);const c=(0,n.ZP)("setting-guides");c.checked=o.ZP.showGuides,c.onchange=()=>(0,o.Lt)("showGuides",c.checked);const d=(0,n.ZP)("settings-snap-to");d.checked=o.ZP.snapToGuides,d.onchange=()=>(0,o.Lt)("snapToGuides",d.checked);const u=(0,n.ZP)("settings-scroll-mode");u.value=o.ZP.scrollMode,u.onchange=()=>(0,o.Lt)("scrollMode",u.value),(0,n.ZP)("dialog-apply"+this.mid).style.display="none",(0,n.ZP)("dialog-cancel"+this.mid).innerText=(0,i.Z)("close")}}},1015:(e,t,s)=>{s.d(t,{Z:()=>h});var i=s(670),a=s(4188),n=s(3947),o=s(6548),r=s(3655);class h extends i.Z{constructor(e){super(e,(0,o.Z)("titleRadialBlur")),this.update=r.d4(50,(()=>{const e=Number(document.querySelector('input[name="direction"]:checked').value),t={amount:this.amount.getValue(),x:this.x.getValue(),y:this.y.getValue(),direction:e,symmetry:(0,n.ZP)("radial-symmetry").checked};this.change("radial",t.amount?t:void 0)})),this.setContent(`\n             <label>Direction</label>\n             <div class="switch-field pad-5">\n                 <input type="radio" id="direction-cw" name="direction" value="0" checked/><label for="direction-cw">${(0,o.Z)("right")}</label>\n                 <input type="radio" id="direction-ccw" name="direction" value="1"/><label for="direction-ccw">${(0,o.Z)("left")}</label>\n                 <input type="radio" id="direction-bi" name="direction" value="2"/><label for="direction-bi">${(0,o.Z)("both")}</label>\n             </div>\n             <div id="radial-amount" class="pad-20"></div>\n             <div id="radial-x" class="pad-16"></div>\n             <div id="radial-y" class="pad-16"></div>\n             <input type="checkbox" id="radial-symmetry">\n             <label class="pad-20 switch" for="radial-symmetry"><span></span>${(0,o.Z)("symmetry")}</label>\n             `),this.amount=new a.Z("radial-amount",{label:(0,o.Z)("amount"),range:[0,1],step:.01,labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,onChange:()=>this.update()}),this.x=new a.Z("radial-x",{label:"X",range:[0,1],defaultValue:.5,step:.01,labelFormat:e=>`${Math.round(100*e)}%`,labelParse:e=>parseInt(e,10)/100,onChange:()=>this.update()}),this.y=new a.Z("radial-y",{label:"Y",range:[0,1],defaultValue:.5,step:.01,labelFormat:e=>`${Math.round(100*e)}%`,labelParse:e=>parseInt(e,10)/100,onChange:()=>this.update()}),(0,n.ZP)("direction-cw").addEventListener("change",this.update,!1),(0,n.ZP)("direction-ccw").addEventListener("change",this.update,!1),(0,n.ZP)("direction-bi").addEventListener("change",this.update,!1),(0,n.ZP)("radial-symmetry").addEventListener("click",(()=>{this.update()})),this.update()}}},5613:(e,t,s)=>{s.d(t,{Z:()=>o});var i=s(6548),a=s(4188),n=s(670);class o extends n.Z{constructor(e){super(e,(0,i.Z)("titleReflect")),this.changeX=()=>{const e=Number(document.querySelector('input[name="reflect-type"]:checked').value);10!=e&&11!=e||this.y.setValue(1-this.x.getValue()),9!=e&&12!=e||this.y.setValue(this.x.getValue()),this.update()},this.changeY=()=>{const e=Number(document.querySelector('input[name="reflect-type"]:checked').value);9!=e&&12!=e||this.x.setValue(this.y.getValue()),10!=e&&11!=e||this.x.setValue(1-this.y.getValue()),this.update()},this.changeType=()=>{const e=Number(document.querySelector('input[name="reflect-type"]:checked').value);1==e||3==e?(this.x.show(),this.y.hide()):2==e||4==e?(this.x.hide(),this.y.show()):(this.x.show(),this.y.show()),this.changeX(),this.update()},this.update=()=>{const e=Number(document.querySelector('input[name="reflect-type"]:checked').value);this.change("reflect",{type:e,x:this.x.getValue(),y:this.y.getValue()})},this.setContent(`\n                <label>${(0,i.Z)("type")}</label>\n                <div class="switch-icon-field" style="display:flex">\n                    <input type="radio" id="reflect-type-minus-x" name="reflect-type" value="1" checked /><label for="reflect-type-minus-x"><img src="/img/icon/reflect-t1.svg" class="ic" width="20" height="20"/></label>\n                    <input type="radio" id="reflect-type-plus-y" name="reflect-type" value="4" /><label for="reflect-type-plus-y"><img src="/img/icon/reflect-t2.svg" class="ic" width="20" height="20"/></label>\n                    <input type="radio" id="reflect-type-plus-x" name="reflect-type" value="3" /><label for="reflect-type-plus-x"><img src="/img/icon/reflect-t3.svg" class="ic" width="20" height="20"/></label>\n                    <input type="radio" id="reflect-type-minus-y" name="reflect-type" value="2" /><label for="reflect-type-minus-y"><img src="/img/icon/reflect-t4.svg" class="ic" width="20" height="20"/></label>\n                    <input type="radio" id="reflect-type-minus-x-minus-y" name="reflect-type" value="5" /><label for="reflect-type-minus-x-minus-y"><img src="/img/icon/reflect-t5.svg" class="ic" width="20" height="20"/></label>\n                    <input type="radio" id="reflect-type-minus-x-plus-y" name="reflect-type" value="6" /><label for="reflect-type-minus-x-plus-y"><img src="/img/icon/reflect-t6.svg" class="ic" width="20" height="20"/></label>\n                </div>\n                <div class="switch-icon-field" style="display:flex;margin-top:2px">\n                    <input type="radio" id="reflect-type-plus-x-plus-y" name="reflect-type" value="7" /><label for="reflect-type-plus-x-plus-y"><img src="/img/icon/reflect-t7.svg" class="ic" width="20" height="20"/></label>\n                    <input type="radio" id="reflect-type-plus-x-minus-y" name="reflect-type" value="8" /><label for="reflect-type-plus-x-minus-y"><img src="/img/icon/reflect-t8.svg" class="ic" width="20" height="20"/></label>\n                    <input type="radio" id="reflect-type-above-x-equalto-y" name="reflect-type" value="9" /><label for="reflect-type-above-x-equalto-y"><img src="/img/icon/reflect-t9.svg" class="ic" width="20" height="20"/></label>\n                    <input type="radio" id="reflect-type-below-x-equalto-minus-y" name="reflect-type" value="10" /><label for="reflect-type-below-x-equalto-minus-y"><img src="/img/icon/reflect-t10.svg" class="ic" width="20" height="20"/></label>\n                    <input type="radio" id="reflect-type-above-x-equalto-minus-y" name="reflect-type" value="11" /><label for="reflect-type-above-x-equalto-minus-y"><img src="/img/icon/reflect-t11.svg" class="ic" width="20" height="20"/></label>\n                    <input type="radio" id="reflect-type-below-x-equalto-y" name="reflect-type" value="12" /><label for="reflect-type-below-x-equalto-y"><img src="/img/icon/reflect-t12.svg" class="ic" width="20" height="20"/></label>\n                </div>\n                <div id="reflect-x" class="pad-16"></div>\n                <div id="reflect-y" class="pad-16"></div>\n            `),this.x=new a.Z("reflect-x",{label:(0,i.Z)("horizontal"),range:[0,1],defaultValue:.5,step:.01,labelFormat:e=>`${Math.round(100*e)}%`,labelParse:e=>parseInt(e,10)/100,onChange:()=>this.changeX()}),this.y=new a.Z("reflect-y",{label:(0,i.Z)("vertical"),range:[0,1],defaultValue:.5,step:.01,labelFormat:e=>`${Math.round(100*e)}%`,labelParse:e=>parseInt(e,10)/100,onChange:()=>this.changeY()}),document.querySelectorAll('input[name="reflect-type"]').forEach((e=>e.addEventListener("change",this.changeType))),this.changeType()}}},2144:(e,t,s)=>{s.d(t,{Z:()=>r});var i=s(670),a=s(4188),n=s(3947),o=s(6548);class r extends i.Z{constructor(e){super(e,(0,o.Z)("titleRGBSplit")),this.type="red-blue",this.selectSwatch=e=>{(0,n.ZP)("split-"+this.type).classList.remove("active");let t=e.currentTarget;this.type=t.getAttribute("data"),t.classList.add("active"),this.update()},this.update=()=>{this.change("rgb-split",{distance:this.distance.getValue()/20,amount:this.amount.getValue(),direction:this.direction.getValue(),type:this.type})},this.kind="rgbSplit",this.setContent((0,n.T)("div",{id:"split-distance"}),(0,n.T)("div",{id:"split-direction",className:"range-box pad-16"}),(0,n.T)("div",{id:"split-amount",className:"range-box pad-16"})),this.setContent(`\n            <label class="pad-16">${(0,o.Z)("color")}</label>\n            <div id="split-swatches" class="swatches pad-4">\n                <div data="red-blue" id="split-red-blue" class="twin active"><span style="background-color: #d1480e;"></span><span style="background-color: #3a6e9a;"></span></div>\n                <div data="green-red" id="split-green-red" class="twin"><span style="background-color: #929C1F;"></span><span style="background-color: #d1480e;"></span></div>\n                <div data="blue-green" id="split-blue-green" class="twin"><span style="background-color: #3a6e9a;"></span><span style="background-color: #929C1F;"></span></div>\n\n                <div data="red" id="split-red"><span style="background-color: #d1480e;"></span></div>\n                <div data="green" id="split-green"><span style="background-color:#929C1F;"></span></div>\n                <div data="blue" id="split-blue"><span style="background-color: #3a6e9a"></span></div>\n            </div>\n        `),this.distance=new a.Z("split-distance",{label:(0,o.Z)("distance"),step:.01,range:[0,1],defaultValue:.2,labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,onChange:e=>this.update()}),this.direction=new a.Z("split-direction",{label:(0,o.Z)("direction"),step:1,range:[0,360],defaultValue:180,labelFormat:e=>`${Math.round(e)}`,labelParse:e=>parseInt(e,10),onChange:e=>this.update()}),this.amount=new a.Z("split-amount",{label:(0,o.Z)("amount"),step:.01,range:[0,1],defaultValue:1,labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,onChange:e=>this.update()}),document.querySelector("#split-swatches").querySelectorAll("div").forEach((e=>e.addEventListener("click",this.selectSwatch))),this.update()}}},7481:(e,t,s)=>{s.d(t,{Z:()=>r});var i=s(670),a=s(4188),n=s(3947),o=s(6548);class r extends i.Z{constructor(e){super(e,(0,o.Z)("titleScanlines")),this.update=()=>{this.change("scanlines",{size:this.size.getValue()/4,amount:this.amount.getValue()/4,colorize:(0,n.ZP)("scanline-colorize").checked,direction:(0,n.ZP)("scanline-direction").checked})},this.kind="scanlines",this.setContent((0,n.T)("div",{id:"scanline-size"}),(0,n.T)("div",{id:"scanline-amount",className:"range-box pad-16"}),(0,n.T)("input",{type:"checkbox",checked:!0,id:"scanline-colorize"}),(0,n.T)("label",{className:"pad-20 switch",htmlFor:"scanline-colorize"},(0,n.T)("span"),(0,o.Z)("colorize")),(0,n.T)("input",{type:"checkbox",id:"scanline-direction"}),(0,n.T)("label",{className:"pad-20 switch",htmlFor:"scanline-direction"},(0,n.T)("span"),(0,o.Z)("vertical"))),this.size=new a.Z("scanline-size",{label:(0,o.Z)("size"),range:[1,10],step:1,defaultValue:2,labelFormat:e=>String(e),onChange:e=>this.update()}),this.amount=new a.Z("scanline-amount",{label:(0,o.Z)("amount"),step:.01,range:[0,1],defaultValue:.2,labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,onChange:e=>this.update()}),(0,n.ZP)("scanline-colorize").addEventListener("click",(()=>{this.update()})),(0,n.ZP)("scanline-direction").addEventListener("click",(()=>{this.update()})),this.update()}}},3297:(e,t,s)=>{s.d(t,{Z:()=>r});var i=s(670),a=s(4188),n=s(3947),o=s(6548);class r extends i.Z{constructor(e){super(e,(0,o.Z)("titleSharpen")),this.setContent((0,n.T)("div",{id:"sharpen-slider"})),new a.Z("sharpen-slider",{label:(0,o.Z)("amount"),range:[0,1],step:.01,labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,onChange:e=>this.change("sharpen",e)})}}},1362:(e,t,s)=>{s.d(t,{Z:()=>n});var i=s(3947),a=s(3868);class n extends a.Z{constructor(){super("Keybord Shortcuts",!0),this.dialog.style.width="800px",this.dialog.style.maxWidth="800px",this.content.style.paddingBottom="0px",this.setContent('\n            <div id="keyboard-shortcuts" class="flex">\n            \n            <div class="third" style="margin-right:20px;">\n                <label>New <span>Ctrl+E</span></label>\n                <label>Open <span>Ctrl+O</span></label>\n                <label>Save <span>Ctrl+S</span></label>\n                <label>Stock search <span>Ctrl+F</span></label>\n                <label>Print <span>Ctrl+P</span></label>\n                <label>Close <span>Ctrl+Q</span></label>\n\n                <label>Delete / Clear <span>DEL</span></label>\n\n                <div class="splitter small pad-20"></div>\n\n                <label>Zoom In <span>Ctrl++</span></label>\n                <label>Zoom Out <span>Ctrl+-</span></label>\n                <label>Zoom Fit <span>Ctrl+0</span></label>\n                <label>Zoom 1X <span>Ctrl+1</span></label>\n                <label>Zoom Fill <span>Ctrl+2</span></label>\n                <label>Zoom 3X <span>Ctrl+3</span></label>\n                <label>Pan / Move<span>Spacebar</span></label>\n                <div class="splitter small pad-20"></div>\n                <label>Brush size up <span>.</span></label>\n                <label>Brush size down <span>,</span></label>\n                <label>Brush softness less <span>Shift+.</span></label>\n                <label>Brush softness more <span>Shift+,</span></label>\n\n            </div>\n            <div class="third" style="margin-left:20px;">\n\n                <label>Arrange <span>V</span></label>\n                <label>Marquee <span>M</span></label>\n                <label>Lasso <span>L</span></label>\n                <label>Wand <span>W</span></label>\n                <label>Crop <span>C</span></label>\n                <label>Cutout <span>K</span></label>\n                <label>Liquify <span>Q</span></label>\n                <label>Heal <span>H</span></label>\n                <label>Clone <span>S</span></label>\n                <label>Blur / Sharpen <span>D</span></label>\n                <label>Dodge / Burn <span>O</span></label>\n                <label>Sponge/ Color <span>R</span></label>\n                <label>Pen <span>P</span></label>\n                <label>Draw <span>B</span></label>\n                <label>Eraser <span>E</span></label>\n                <label>Fill <span>F</span></label>\n                <label>Color replace <span>A</span></label>\n                <label>Shape <span>U</span></label>\n                <label>Text <span>T</span></label>\n                <label>Switch colors <span>X</span></label>\n            </div>\n            <div class="third" style="margin-left:20px;">\n\n                <label>Undo <span>Ctrl+Z</span></label>\n                <label>Redo <span>Ctrl+Y</span></label>\n                <label>Cut <span>Ctrl+X</span></label>\n                <label>Copy <span>Ctrl+C</span></label>\n                <label>Paste <span>Ctrl+V</span></label>\n                \n                <div class="splitter small pad-20"></div>\n                <label>Free transform <span>Ctrl+R</span></label>\n                <label>Free distort <span>Ctrl+K</span></label>\n                <label>Select all <span>Ctrl+A</span></label>\n                <label>Deselect <span>Ctrl+D</span></label>\n                <label>Invert selction <span>Ctrl+I</span></label>\n\n                <div class="splitter small pad-20"></div>\n\n                <label>Move \n                    <span>&#8593;</span>\n                    <span>&#8595;</span>\n                    <span>&#8592;</span>\n                    <span>&#8594;</span>\n                \n                </label>\n                <br />\n                <small>Hold down Shift to step 10px</small>\n                <div class="splitter small pad-20"></div>\n\n            </div>\n        </div>\n        '),(0,i.ZP)("dialog-apply"+this.mid).style.display="none",(0,i.ZP)("dialog-cancel"+this.mid).innerText="close"}}},6038:(e,t,s)=>{s.d(t,{Z:()=>r});var i=s(6548),a=s(3947),n=s(4188),o=s(670);class r extends o.Z{constructor(e){super(e,(0,i.Z)("titleSlice")),this.update=()=>{this.change("slice",{seed:this.seed.getValue(),amount:this.amount.getValue(),distance:this.distance.getValue(),line:(0,a.ZP)("slice-line").checked})},this.setContent((0,a.T)("div",{id:"slice-seed"}),(0,a.T)("div",{id:"slice-amount",className:"pad-16"}),(0,a.T)("div",{id:"slice-distance",className:"pad-16"}),(0,a.T)("input",{type:"checkbox",id:"slice-line"}),(0,a.T)("label",{className:"pad-20 switch",htmlFor:"slice-line"},(0,a.T)("span"),(0,i.Z)("line"))),this.seed=new n.Z("slice-seed",{label:(0,i.Z)("seed"),range:[0,200],step:1,defaultValue:100,labelFormat:e=>String(e),onChange:e=>this.update()}),this.amount=new n.Z("slice-amount",{label:(0,i.Z)("amount"),step:1,range:[0,25],defaultValue:4,labelFormat:e=>`${Math.round(e)}`,labelParse:e=>parseInt(e,10),onChange:e=>this.update()}),this.distance=new n.Z("slice-distance",{label:(0,i.Z)("distance"),step:.01,range:[-1,1],defaultValue:.2,labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,onChange:e=>this.update()}),(0,a.ZP)("slice-line").addEventListener("click",this.update),this.update()}}},8222:(e,t,s)=>{s.d(t,{Z:()=>r});var i=s(670),a=s(4188),n=s(3947),o=s(6548);class r extends i.Z{constructor(e){super(e,(0,o.Z)("titleSmooth")),this.setContent((0,n.T)("div",{id:"smooth-slider"})),new a.Z("smooth-slider",{label:(0,o.Z)("amount"),range:[0,1],step:.01,labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,onChange:e=>this.change("smooth",e)})}}},5104:(e,t,s)=>{s.d(t,{Z:()=>p});var i=s(6548),a=s(3655),n=s(3868),o=s(4188),r=s(8776),h=s(4820),l=s(4256),c=s(4211),d=s(1030),u=s(3947);class p extends n.Z{constructor(e){super((0,i.Z)("titleStrokeOutline"),!1),this.load=async()=>{const e=Promise.resolve().then(s.bind(s,8132)),t=a.iF();await t;const{distanceTransform:i}=await e,n=this.stage.fresco.getSelected(),o=n.rect.pad(150);this.cache=a.vL(o.width,o.height),this.cache.getContext("2d").drawImage(n.canvas,150,150),this.scratch=this.stage.fresco.addScratch(),this.scratch.setTarget(n.id,o,"replace"),this.scratch.canvas=this.cache;const r=this.shaders.ctx,h=this.cache.getContext("2d").getImageData(0,0,this.cache.width,this.cache.height),l=i(this.cache.width,this.cache.height,h.data);if(!r.getSupportedExtensions().includes("OES_texture_float"))return alert("sorry, this filter requires float textures"),void(0,d.Z)("OES_texture_float");r.getExtension("OES_texture_float");const c=r.createTexture();r.bindTexture(r.TEXTURE_2D,c),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texImage2D(r.TEXTURE_2D,0,r.ALPHA,this.cache.width,this.cache.height,0,r.ALPHA,r.FLOAT,l),r.bindTexture(r.TEXTURE_2D,null),this.map=c,(0,u.ZP)("stroke-loading").style.display="none",(0,u.ZP)("stroke-controls").style.visibility="visible",this.enableApply(),this.update()},this.update=()=>{const e={size:this.size.getValue(),opacity:this.opacity.getValue(),color:this.color.getColor(),distanceMap:this.map,cutout:this.cutout.checked};this.shaders.addShader("stroke",e.size?e:null),window.requestAnimationFrame((()=>{this.scratch.canvas=this.shaders.apply(this.cache),this.stage.render()}))},this.apply=()=>{const e=this.stage.fresco.getSelected(),t=a.l(a.dN(this.scratch.canvas)).rebase(-this.scratch.rect.x,-this.scratch.rect.y),s=a.$E(e.canvas,t.rebase(e.rect.x,e.rect.y)),i=a.dN(e.mask),n=e.rect.clone();e.extendCanvas(t),this.scratch.drawToLayer(e,"copy"),e.render(),this.stage.fresco.removeScratch(),this.stage.history.add({type:"bitmapChange",kind:"stroke",layer:e,rect:n,patchRect:t.rebase(e.rect.x,e.rect.y),patch:s,mask:i}),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-select")),this.cleanUp()},this.cancel=()=>{this.stage.fresco.removeScratch(),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-select")),this.cleanUp()},this.disableApply(),this.shaders=new l.Z,this.stage=e,this.stage.coating.freeze(!0),this.stage.coating.clear(!0),this.setContent((0,u.T)("div",{className:"dialog-loading"},(0,u.T)("div",{id:"stroke-controls",className:"controls"},(0,u.T)("label",{className:"split"},(0,i.Z)("color"),(0,u.T)("div",{id:"stroke-color",className:"pad-4"})),(0,u.T)("div",{id:"stroke-size",className:"range-box pad-16"}),(0,u.T)("div",{id:"stroke-opacity",className:"range-box pad-10"}),(0,u.T)("input",{id:"stroke-cutout",type:"checkbox"}),(0,u.T)("label",{className:"pad-20 switch",htmlFor:"stroke-cutout"},(0,u.T)("span"),(0,i.Z)("strokeOutlineOnly"))),(0,u.T)("div",{id:"stroke-loading",className:"message"},(0,i.Z)("loading"),(0,u.T)("span","."),(0,u.T)("span","."),(0,u.T)("span",".")))),this.cutout=(0,u.ZP)("stroke-cutout"),this.cutout.onchange=this.update,this.color=new c.Z("stroke-color",r.Z.fromHEX(h.ZP.mainColor),this.update),this.size=new o.Z("stroke-size",{label:(0,i.Z)("size"),range:[1,150],defaultValue:10,step:1,labelParse:e=>parseInt(e,10),onChange:()=>this.update()}),this.opacity=new o.Z("stroke-opacity",{label:(0,i.Z)("opacity"),defaultValue:1,labelFormat:e=>(100*e).toFixed(0)+"%",labelParse:e=>parseInt(e,10)/100,onChange:()=>this.update()}),this.position(),this.load()}}},6987:(e,t,s)=>{s.d(t,{Z:()=>r});var i=s(670),a=s(4188),n=s(3947),o=s(6548);class r extends i.Z{constructor(e){super(e,(0,o.Z)("titleTemperatureTint")),this.kind="temperatureTint",this.setContent((0,n.T)("div",{id:"temperature"}),(0,n.T)("div",{id:"tint",className:"pad-16"})),new a.Z("temperature",{label:(0,o.Z)("temperature"),step:.01,range:[-1,1],labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,onChange:e=>this.change("temperature",e)}),new a.Z("tint",{label:(0,o.Z)("tint"),step:.01,range:[-1,1],labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,onChange:e=>this.change("tint",e)})}}},9453:(e,t,s)=>{s.d(t,{Z:()=>r});var i=s(670),a=s(4188),n=s(3947),o=s(6548);class r extends i.Z{constructor(e){super(e,(0,o.Z)("titleThreshold")),this.setContent((0,n.T)("div",{id:"threshold"})),new a.Z("threshold",{label:(0,o.Z)("level"),step:.01,defaultValue:.5,range:[0,1],labelFormat:e=>`${Math.round(255*e)}`,labelParse:e=>parseInt(e,10)/255,onChange:e=>this.change("threshold",e+1e-13)}),this.change("threshold",.5)}}},9955:(e,t,s)=>{s.d(t,{Z:()=>r});var i=s(670),a=s(4188),n=s(3947),o=s(6548);class r extends i.Z{constructor(e){super(e,(0,o.Z)("titleVibrance")),this.setContent((0,n.T)("div",{id:"vibrance"})),new a.Z("vibrance",{label:(0,o.Z)("amount"),step:.01,range:[-1,1],labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,onChange:e=>this.change("vibrance",e)})}}},5666:(e,t,s)=>{s.d(t,{Z:()=>r});var i=s(670),a=s(4188),n=s(3947),o=s(6548);class r extends i.Z{constructor(e){super(e,(0,o.Z)("titleVignette")),this.setContent((0,n.T)("div",{id:"vignette-slider"})),new a.Z("vignette-slider",{label:(0,o.Z)("amount"),step:.01,range:[-1,1],labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,onChange:e=>this.change("vignette",e)})}}},9322:(e,t,s)=>{s.d(t,{Z:()=>h});var i=s(670),a=s(4188),n=s(3947),o=s(6548),r=s(3655);class h extends i.Z{constructor(e){super(e,(0,o.Z)("titleWave")),this.update=()=>{r.Ds("wave",50,(()=>{const e=Number(document.querySelector('input[name="type"]:checked').value),t=Number(document.querySelector('input[name="edge-approx"]:checked').value),s={type:e,amplitude:this.amplitude.getValue(),scale:Math.max(.01,this.scale.getValue()),rotate:this.rotate.getValue()*(Math.PI/1.8),edgeApprox:t};this.change("wave",s.amplitude?s:void 0)}))},this.setContent(`\n            <label>${(0,o.Z)("type")}</label>\n            <div class="switch-field pad-5">\n                <input type="radio" id="type-sine" name="type" value="0" checked/><label for="type-sine">${(0,o.Z)("round")}</label>\n                <input type="radio" id="type-triangle" name="type" value="1"/><label for="type-triangle">${(0,o.Z)("triangle")}</label>\n                <input type="radio" id="type-square" name="type" value="2"/><label for="type-square">${(0,o.Z)("square")}</label>\n            </div>\n\n            <div id="wave-amplitude" class="range-box pad-20"></div>\n            <div id="wave-scale" class="range-box"></div>\n            <div id="wave-rotate" class="range-box"></div>\n\n            <label class="split pad-35">${(0,o.Z)("edgeFill")}</label>\n            <div class="switch-field pad-5" id="wave-edge-approx">\n                <input type="radio" id="edge-approx-none" name="edge-approx" value="0" checked/><label for="edge-approx-none">${(0,o.Z)("none")}</label>\n                <input type="radio" id="edge-approx-reflect" name="edge-approx" value="1"/><label for="edge-approx-reflect">${(0,o.Z)("reflect")}</label>\n                <input type="radio" id="edge-approx-repeat" name="edge-approx" value="2"/><label for="edge-approx-repeat">${(0,o.Z)("repeat")}</label>\n            </div>\n        `),this.amplitude=new a.Z("wave-amplitude",{label:(0,o.Z)("amplitude"),range:[-.5,.5],step:.01,defaultValue:.05,labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,onChange:()=>this.update()}),this.scale=new a.Z("wave-scale",{label:(0,o.Z)("scale"),range:[1,30],step:1,defaultValue:1,labelFormat:e=>String(e),onChange:e=>this.update()}),this.rotate=new a.Z("wave-rotate",{label:(0,o.Z)("rotate"),step:.01,range:[-.9,.9],defaultValue:0,labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,onChange:e=>this.update()}),(0,n.ZP)("type-sine").addEventListener("change",this.update,!1),(0,n.ZP)("type-triangle").addEventListener("change",this.update,!1),(0,n.ZP)("type-square").addEventListener("change",this.update,!1),(0,n.ZP)("edge-approx-none").addEventListener("change",this.update,!1),(0,n.ZP)("edge-approx-reflect").addEventListener("change",this.update,!1),(0,n.ZP)("edge-approx-repeat").addEventListener("change",this.update,!1),this.update()}}},3842:(e,t,s)=>{s.d(t,{Z:()=>h});var i=s(6548),a=s(3947),n=s(4188),o=s(670),r=s(3655);class h extends o.Z{constructor(e){super(e,(0,i.Z)("titleZoomBlur")),this.update=r.d4(50,(()=>{const e={x:this.x.getValue(),y:1-this.y.getValue(),amount:this.amount.getValue()};this.change("zoom",e.amount?e:void 0)})),this.kind="zoom",this.setContent((0,a.T)("div",{id:"zoom-amount"}),(0,a.T)("div",{id:"zoom-x",className:"pad-10"}),(0,a.T)("div",{id:"zoom-y",className:"pad-10"})),this.amount=new n.Z("zoom-amount",{label:(0,i.Z)("amount"),range:[0,1],defaultValue:.2,step:.01,labelFormat:e=>`${Math.round(100*e)}%`,labelParse:e=>parseInt(e,10)/100,onChange:()=>this.update()}),this.x=new n.Z("zoom-x",{label:"X",range:[0,1],defaultValue:.5,step:.01,labelFormat:e=>`${Math.round(100*e)}%`,labelParse:e=>parseInt(e,10)/100,onChange:()=>this.update()}),this.y=new n.Z("zoom-y",{label:"Y",range:[0,1],defaultValue:.5,step:.01,labelFormat:e=>`${Math.round(100*e)}%`,labelParse:e=>parseInt(e,10)/100,onChange:()=>this.update()}),this.update()}}},7657:(e,t,s)=>{s.a(e,(async(e,i)=>{try{s.d(t,{Z:()=>rt});var a=s(5182),n=s(6817),o=s(1030),r=s(4170),h=s(3947),l=s(8198),c=s(9575),d=s(3799),u=s(9250),p=s(6822),g=s(5402),m=s(7549),v=s(3655),f=s(8776),y=s(4754),w=s(3747),b=s(1971),x=s(4891),Z=s(9381),k=s(2282),P=s(5181),E=s(5983),S=s(4820),T=s(6781),C=s(4550),L=s(6987),M=s(8997),A=s(1769),R=s(9955),I=s(3099),D=s(8275),F=s(3002),_=s(7878),z=s(3982),N=s(3297),B=s(7371),O=s(7099),U=s(3842),H=s(2084),q=s(9977),$=s(1015),V=s(7794),G=s(7132),X=s(1322),j=s(8222),W=s(3440),Y=s(7103),K=s(7534),Q=s(9447),J=s(6353),ee=s(9812),te=s(5666),se=s(3146),ie=s(323),ae=s(1983),ne=s(1362),oe=s(5104),re=s(2180),he=s(9453),le=s(6114),ce=s(5039),de=s(255),ue=s(7012),pe=s(273),ge=s(855),me=s(6038),ve=s(9322),fe=s(6671),ye=s(556),we=s(5613),be=s(2144),xe=s(7481),Ze=s(18),ke=s(889),Pe=s(8679),Ee=s(6479),Se=s(9200),Te=s(2932),Ce=s(6117),Le=s(3921),Me=s(4332),Ae=s(7375),Re=s(9457),Ie=s(4230),De=s(810),Fe=s(167),_e=s(5752),ze=s(108),Ne=s(3232),Be=s(718),Oe=s(7764),Ue=s(2285),He=s(3200),qe=s(8822),$e=s(2553),Ve=s(2112),Ge=s(2385),Xe=s(8565),je=s(4445),We=s(6258),Ye=s(709),Ke=s(7647),Qe=s(7241),Je=s(1487),et=s(5264),tt=s(4800),st=s(7352),it=s(8105),at=s(3673),nt=s(5934),ot=e([a]);a=(ot.then?(await ot)():ot)[0];class rt extends a.Z{constructor(){super(),this.hasDock=!1,this.isKeyDown=!1,this.isPreviewMode=!1,this.initial=!0,this.resize=()=>{if(this.stage&&(0,h.ZP)("menu-bar")){if(this.isPreviewMode)this.stage.resize(0,0,this.stage.workspace.offsetWidth,this.stage.workspace.offsetHeight-1);else{let e=0;this.hasDock&&this.animationPanel&&this.animationPanel.docked&&(e=this.animationPanel.float.clientWidth+1,this.animationPanel.float.style.height=this.stage.workspace.offsetHeight-77+"px");let t=S.ZP.panelFloating?0:(0,h.ZP)("menu-bar").offsetWidth+1,s=this.hasDock?e:S.ZP.panelFloating?0:(0,h.ZP)("panel-bar").offsetWidth+1,i="none"===(0,h.ZP)("tab-bar").style.display?0:33;this.stage.resize(t,77+i,this.stage.workspace.offsetWidth-t-s,this.stage.workspace.offsetHeight-77-i)}this.tabBar&&this.tabBar.resize(),this.scrollbar&&this.scrollbar.resize(),this.tool&&"crop"===this.tool.name&&this.tool.refit(),this.initial&&(this.positionFloatingPanels(),this.initial=!1)}},this.togglePreviewMode=()=>{var e,t;this.isHome()||this.isModal()||(this.isPreviewMode=!this.isPreviewMode,this.isPreviewMode?((0,h.ZP)("top-bar").style.display="none",(0,h.ZP)("panel-bar").style.display="none",(0,h.ZP)("menu-bar").style.display="none",(0,h.ZP)("tab-bar").style.display="none",this.tool instanceof Ge.Z&&(null===(e=this.tool.reform)||void 0===e||e.supress(!0))):((0,h.ZP)("panel-bar").style.display="flex",(0,h.ZP)("top-bar").style.display="block",(0,h.ZP)("menu-bar").style.display="block",this.tabBar.render(),this.tool instanceof Ge.Z&&(null===(t=this.tool.reform)||void 0===t||t.supress(!1))),this.resize())},this.keyDown=async e=>{var t;if(this.isHome())return;"Control"!==e.key&&"Shift"!==e.key&&" "!==e.key&&this.tool instanceof Ge.Z&&(null===(t=this.tool.selectron)||void 0===t||t.cleanCut());const s=document.activeElement;if(v.PP(s))"Enter"===e.key&&"TEXTAREA"!==s.nodeName&&document.activeElement.blur();else if(this.isModal())e.preventDefault();else if(e.ctrlKey||e.metaKey)switch(e.key.toLowerCase()){case"a":return e.preventDefault(),void this.stage.selectionAll();case"b":return e.preventDefault(),void new V.Z(this.stage);case"d":return e.preventDefault(),void(this.stage.fresco.hasSelection()?this.stage.selectionDeselect():await this.stage.duplicateLayer());case"e":return e.preventDefault(),void this.home.newClick();case"f":return e.preventDefault(),void this.navigate("search");case"i":return e.preventDefault(),void this.stage.selectionInvert();case"m":return e.preventDefault(),void(this.stage.fresco&&this.stage.fresco.isSelectedShaderbleWithCanvas()&&new F.Z(this.stage));case"l":return e.preventDefault(),void(this.stage.fresco&&this.stage.fresco.isSelectedShaderbleWithCanvas()&&new _.Z(this.stage));case"o":return e.preventDefault(),void this.home.openClick();case"s":return e.preventDefault(),void this.saveClick();case"p":return e.preventDefault(),void this.print();case"u":return e.preventDefault(),void(this.stage.fresco&&this.stage.fresco.isSelectedShaderbleWithCanvas()&&new M.Z(this.stage));case"w":case"q":return e.preventDefault(),void this.closeClick();case"r":return e.preventDefault(),void this.setTool("arrange",!0,"TRANSFORM");case"k":return e.preventDefault(),void this.setTool("arrange",!0,"DISTORT");case"z":return e.preventDefault(),void(e.shiftKey?this.stage.history.redo():this.stage.history.undo());case"y":return e.preventDefault(),void this.stage.history.redo();case"0":return e.preventDefault(),void this.stage.setZoom("fit");case"1":return e.preventDefault(),void this.stage.setZoom("1");case"2":return e.preventDefault(),void this.stage.setZoom("fill");case"3":return e.preventDefault(),void this.stage.setZoom("3");case"6":return e.preventDefault(),void this.stage.mergeDown();case"7":return e.preventDefault(),void this.stage.mergeVisible();case"8":return e.preventDefault(),void this.stage.mergeFlatten();case"4":return e.preventDefault(),void this.stage.moveUp();case"5":return e.preventDefault(),void this.stage.moveDown();case"-":return e.preventDefault(),void this.stage.setZoomStep(!1);case"+":case"=":return e.preventDefault(),void this.stage.setZoomStep(!0);case"enter":return void this.stage.playAnimation()}else{if(" "===e.key&&(!this.tool||"hand"!==this.tool.name))return this.stage.coating.setPan(),void e.preventDefault();if("Tab"===e.key)return e.preventDefault(),void this.togglePreviewMode();if("Escape"===e.key)return this.isPreviewMode&&this.togglePreviewMode(),void(this.tool&&this.tool.cancel());if("Enter"!==e.key)if("Delete"!==e.key&&"Backspace"!==e.key)switch(e.key.toLowerCase()){case"c":this.setTool("crop");break;case"k":this.setTool("cutout");break;case"v":this.setTool("arrange");break;case"m":this.setTool("marquee");break;case"n":this.setTool("frame");break;case"l":this.setTool("lasso");break;case"w":this.setTool("wand");break;case"q":this.setTool("liquify");break;case"h":this.setTool("heal");break;case"s":this.setTool("clone");break;case"d":this.setTool("detail");break;case"o":this.setTool("toning");break;case"r":this.setTool("temper");break;case"b":this.setTool("draw");break;case"p":this.setTool("pen");break;case"e":this.setTool("eraser");break;case"f":this.setTool("fill");break;case"g":this.setTool("gradient");break;case"a":this.setTool("replace");break;case"u":this.setTool("shape");break;case"t":this.setTool("text");break;case"i":this.setTool("picker");break;case"j":this.setTool("focus");break;case"z":this.setTool("zoom");break;case"x":this.switchColor();break;case"y":this.setTool("disperse");break;case"d":this.resetColor()}else this.stage.fresco&&(this.stage.fresco.hasSelection()?this.clear():this.stage.deleteLayer(),e.preventDefault());else this.tool&&this.tool.apply()}},this.keyUp=e=>{this.isModal()?e.preventDefault():" "!=e.key||this.tool&&"hand"===this.tool.name||this.stage.coating.removePan()},this.setUpTopBar=()=>{(0,h.ZP)("toggle-home").addEventListener("click",(()=>{var e;null===(e=this.tool)||void 0===e||e.apply(),this.navigate()}),!1);let e=(0,h.ZP)("menu").querySelectorAll("#menu>li>label");for(var t=0;t<e.length;t++)e[t].addEventListener("click",(e=>{e.stopPropagation(),e.preventDefault(),(0,h.ZP)("menu").classList.toggle("active");const t=e=>{e.target.classList.contains("more")||((0,h.ZP)("menu").classList.remove("active"),document.removeEventListener("click",t,!1))};document.addEventListener("click",t,!1)}),!0);const s=(e,t)=>{(0,h.ZP)(e).addEventListener("click",(()=>{var s;null===(s=this.stage)||void 0===s||s.stopAnimation(),"edit-undo"!==e&&"edit-redo"!==e&&this.tool&&(this.stage.history.commitTransaction(),this.tool.apply()),(e=>!(0,h.ZP)(e).classList.contains("disabled"))(e)&&t()}),!0)},i=()=>{var e,t,s;let i=null===(e=this.stage.fresco)||void 0===e?void 0:e.getSelected(),a=this.stage.isSelectedLayerShaderble(),n=a&&i.type===r.Z.TYPE_FRAME;const o=null===(t=this.stage.fresco)||void 0===t?void 0:t.hasSelection(),l=i&&i instanceof k.Z&&i.hasMask(),c=null===(s=this.stage.fresco)||void 0===s?void 0:s.hasAnimation();(0,h.ZP)("menu").querySelectorAll(".image").forEach((e=>{e.classList.toggle("disabled",!a),n&&e.classList.contains("noframe")&&e.classList.add("disabled")})),(0,h.ZP)("menu").querySelectorAll(".selection").forEach((e=>{e.classList.toggle("disabled",!o)})),(0,h.ZP)("menu").querySelectorAll(".mask").forEach((e=>{e.classList.toggle("disabled",!l)})),(0,h.ZP)("animation-play").classList.toggle("disabled",!c),(0,h.ZP)("animator").classList.toggle("enabled",c),(0,h.ZP)("layer-merge-down").classList.toggle("disabled",!i),this.stage.fresco&&((0,h.ZP)("file-print").classList.toggle("disabled",this.stage.fresco.block),(0,h.ZP)("export-page").classList.toggle("disabled",this.stage.fresco.block),(0,h.ZP)("export-layer").classList.toggle("disabled",this.stage.fresco.block),(0,h.ZP)("export-template").classList.toggle("disabled",!!this.stage.fresco.templateMeta))};document.addEventListener("layer-select",i),document.addEventListener("history-update",(async e=>{(0,h.ZP)("edit-undo").classList.toggle("disabled",e.detail.atStart),(0,h.ZP)("edit-redo").classList.toggle("disabled",e.detail.atEnd),i()})),s("file-new",this.home.newClick),s("file-search",(()=>this.navigate("search"))),s("file-save",this.saveClick),s("export-template",(()=>new E.Z(this.stage))),s("export-page",(()=>this.quickExport())),s("export-layer",(()=>this.quickExport(!0))),s("file-print",(()=>this.print())),s("file-close",this.closeClick),s("file-open",this.home.openClick),s("file-open-url",(()=>new w.Z(this.stage))),s("file-add-element",(()=>new V.Z(this.stage))),s("edit-undo",(()=>this.stage.history.undo())),s("edit-redo",(()=>this.stage.history.redo())),s("edit-cut",(()=>document.execCommand("cut"))),s("edit-copy",(()=>document.execCommand("copy"))),s("edit-paste",(()=>this.pasteActivatedFromMenu())),s("edit-clear",(()=>this.clear())),s("edit-stroke",(()=>new oe.Z(this.stage))),s("edit-fill",(()=>new re.Z(this.stage))),s("edit-free-transform",(()=>this.setTool("arrange",!0,"TRANSFORM"))),s("edit-free-distort",(()=>this.setTool("arrange",!0,"DISTORT"))),s("edit-rotate-left",(()=>this.stage.rotateSelected(!0))),s("edit-rotate-right",(()=>this.stage.rotateSelected(!1))),s("edit-flip-horizontal",(()=>this.stage.flipSelected(!1))),s("edit-flip-vertical",(()=>this.stage.flipSelected(!0))),s("edit-selection-all",(()=>this.stage.selectionAll())),s("edit-selection-deselect",(()=>this.stage.selectionDeselect())),s("edit-selection-invert",(()=>this.stage.selectionInvert())),s("edit-selection-pixels",(()=>this.stage.selectionPixels())),s("edit-selection-save",(()=>this.stage.selectionSave())),s("edit-selection-restore",(()=>this.stage.selectionRestore())),s("edit-selection-convert",(()=>{this.stage.selectionConvert(),this.setTool("cutout")})),s("edit-preferences",(()=>new Ze.Z)),s("page-resize",(()=>new Z.Z(this.stage))),s("page-size",(()=>new x.Z(this.stage))),s("page-color",(()=>new b.Z(this.stage))),s("page-flip-vertical",(()=>this.stage.flip(!0))),s("page-flip-horizontal",(()=>this.stage.flip(!1))),s("page-rotate-left",(()=>this.stage.rotate(!0))),s("page-rotate-right",(()=>this.stage.rotate(!1))),s("page-crop",(()=>{if(this.stage.fresco.hasSelection()){const e=new n.Z(this.stage.fresco.selection.bounds.x,this.stage.fresco.selection.bounds.y,this.stage.fresco.selection.bounds.width,this.stage.fresco.selection.bounds.height);this.stage.selectionDeselect(),this.stage.crop(e)}})),s("page-trim",(()=>{let e=this.stage.getOutputCanvas(1),t=v.l(e);t.width>0&&t.height>0&&this.stage.crop(t)})),s("layer-new",(()=>this.stage.addEmpty())),s("layer-open",(async()=>{(0,o.Z)("open-browse"),await(0,nt.Q0)(!0).then((async e=>{document.dispatchEvent(new CustomEvent("loading",{detail:"start"}));for(let t=0;t<e.length;t++)await(0,nt.ZB)(this.stage,e[t],!1);document.dispatchEvent(new CustomEvent("loading",{detail:"stop"}))}))})),s("layer-url",(()=>new w.Z(this.stage,!1))),s("layer-add-element",(()=>new V.Z(this.stage))),s("layer-duplicate",(async()=>await this.stage.duplicateLayer())),s("layer-delete",(()=>this.stage.deleteLayer())),s("layer-merge-down",(()=>this.stage.mergeDown())),s("layer-merge-visible",(()=>this.stage.mergeVisible())),s("layer-merge-flatten",(()=>this.stage.mergeFlatten())),s("layer-move-up",(()=>this.stage.moveUp())),s("layer-move-down",(()=>this.stage.moveDown())),s("layer-rasterize",(()=>this.stage.rasterize())),s("layer-ai-mask",(()=>new y.Z(this.stage))),s("layer-add-mask",(()=>{this.stage.maskAdd(),this.setTool("cutout")})),s("layer-convert-mask",(()=>{this.stage.maskConvert(),this.setTool("arrange")})),s("layer-extract-mask",(()=>this.stage.maskExtract())),s("layer-invert-mask",(()=>this.stage.maskInvert())),s("layer-delete-mask",(()=>this.stage.maskDelete())),s("layer-apply-mask",(()=>this.stage.maskApply())),s("adjust-auto",(()=>new et.Z(this.stage))),s("adjust-pop",(()=>new Je.Z(this.stage))),s("adjust-bw",(()=>new Qe.Z(this.stage))),s("adjust-brightness-contrast",(()=>new T.Z(this.stage))),s("adjust-temperature-tint",(()=>new L.Z(this.stage))),s("adjust-hue-saturation",(()=>new M.Z(this.stage))),s("adjust-vibrance",(()=>new R.Z(this.stage))),s("adjust-balance",(()=>new D.Z(this.stage))),s("adjust-highlights-shadows",(()=>new C.Z(this.stage))),s("adjust-exposure",(()=>new I.Z(this.stage))),s("adjust-monochrome",(()=>new A.Z(this.stage))),s("adjust-curves",(()=>new F.Z(this.stage))),s("adjust-levels",(()=>new _.Z(this.stage))),s("adjust-threshold",(()=>new he.Z(this.stage))),s("adjust-posterize",(()=>new G.Z(this.stage))),s("adjust-desaturate",(()=>new X.Z(this.stage))),s("adjust-invert",(()=>new tt.Z(this.stage))),s("adjust-solarize",(()=>new it.Z(this.stage))),s("adjust-mimichdr",(()=>new ye.Z(this.stage))),s("adjust-lookup",(()=>new le.Z(this.stage))),s("filter-effect",(()=>new z.Z(this.stage))),s("filter-drop-shadow",(()=>new ce.Z(this.stage))),s("filter-outline",(()=>new oe.Z(this.stage))),s("filter-outer-glow",(()=>new de.Z(this.stage))),s("filter-inner-glow",(()=>new ue.Z(this.stage))),s("filter-bevel",(()=>new ge.Z(this.stage))),s("filter-sharpen",(()=>new N.Z(this.stage))),s("filter-clarity",(()=>new B.Z(this.stage))),s("filter-blur",(()=>new O.Z(this.stage))),s("filter-zoom-blur",(()=>new U.Z(this.stage))),s("filter-gaussian-blur",(()=>new H.Z(this.stage))),s("filter-motion-blur",(()=>new q.Z(this.stage))),s("filter-radial-blur",(()=>new $.Z(this.stage))),s("filter-smooth",(()=>new j.Z(this.stage))),s("filter-denoise",(()=>new W.Z(this.stage))),s("filter-bloom",(()=>new Y.Z(this.stage))),s("filter-glamour",(()=>new K.Z(this.stage))),s("filter-fringe",(()=>new se.Z(this.stage))),s("filter-rgb-split",(()=>new be.Z(this.stage))),s("filter-scanlines",(()=>new xe.Z(this.stage))),s("filter-interference",(()=>new ke.Z(this.stage))),s("filter-slice",(()=>new me.Z(this.stage))),s("filter-grain",(()=>new Q.Z(this.stage))),s("filter-noise",(()=>new J.Z(this.stage))),s("filter-dehaze",(()=>new ee.Z(this.stage))),s("filter-vignette",(()=>new te.Z(this.stage))),s("filter-pixelate",(()=>new ie.Z(this.stage))),s("filter-mosaic",(()=>new ae.Z(this.stage))),s("filter-halftone",(()=>new pe.Z(this.stage))),s("filter-sobel",(()=>new st.Z(this.stage))),s("filter-polarcoordinates",(()=>new Ee.Z(this.stage))),s("filter-fish-eye",(()=>new fe.Z(this.stage))),s("filter-reflect",(()=>new we.Z(this.stage))),s("filter-wave",(()=>new ve.Z(this.stage))),s("filter-kaleidoscope",(()=>new Pe.Z(this.stage))),s("animation-panel",(()=>this.showAnimationPanel())),s("view-animation",(()=>this.showAnimationPanel())),s("animation-play",(()=>this.stage.playAnimation())),s("animation-stop",(()=>this.stage.stopAnimation())),s("view-restore",(()=>this.restorePanel())),s("view-floating",(()=>this.toggleFloatingPanel())),s("view-navigator",(()=>this.togglePanel("navigator-panel"))),s("view-layer",(()=>this.togglePanel("layer-panel"))),s("view-history",(()=>this.togglePanel("history-panel"))),s("view-zoom-in",(()=>this.stage.setZoomStep(!0))),s("view-zoom-out",(()=>this.stage.setZoomStep(!1))),s("view-zoom-fit",(()=>this.stage.setZoom("fit"))),s("view-zoom-fill",(()=>this.stage.setZoom("fill"))),s("view-zoom-1x",(()=>this.stage.setZoom("1"))),s("view-zoom-2x",(()=>this.stage.setZoom("2"))),s("view-zoom-3x",(()=>this.stage.setZoom("3"))),s("view-preview",(()=>this.togglePreviewMode())),s("view-full-screen",(()=>document.documentElement.requestFullscreen())),s("view-theme",(()=>new Ze.Z)),s("help-shortcuts",(()=>new ne.Z))},this.setUpMenuBar=()=>{const e=(0,h.ZP)("tool-menu").getElementsByTagName("li");for(var t=0;t<e.length;t++)e[t].addEventListener("click",(e=>this.setTool(e.currentTarget.getAttribute("data"))),!1),e[t].addEventListener("pointerenter",(e=>this.showToolTip(e.currentTarget.getAttribute("data"),e)),!1),e[t].addEventListener("pointerleave",(e=>this.hideToolTip(e.currentTarget.getAttribute("data"),e)),!1);(0,h.ZP)("color-main").style.backgroundColor=S.ZP.mainColor,(0,h.ZP)("color-main").addEventListener("click",(()=>new P.Z(f.Z.fromHEX(S.ZP.mainColor),(e=>{this.setColor(e,!0)}))),!1),(0,h.ZP)("color-alt").style.backgroundColor=S.ZP.altColor,(0,h.ZP)("color-alt").addEventListener("click",(()=>new P.Z(f.Z.fromHEX(S.ZP.altColor),(e=>{this.setColor(e,!1)}))),!1),(0,h.ZP)("color-switch").addEventListener("click",this.switchColor,!1),(0,h.ZP)("tool-zoom").addEventListener("dblclick",(()=>this.stage.setZoom("1")),!1),(0,h.ZP)("animator-play").addEventListener("click",(()=>{this.stage.fresco.hasAnimation()?this.stage.playAnimation():this.showAnimationPanel()})),(0,h.ZP)("animator-stop").addEventListener("click",(()=>this.stage.stopAnimation())),(0,h.ZP)("menu-bar").classList.toggle("floating",S.ZP.panelFloating),(0,h.Rg)((0,h.ZP)("menu-handle"),this.dragMenuStart,this.dragMenuMove,this.dragMenuUp),this.setTool("arrange")},this.showAnimationPanel=()=>{this.animationPanel||(this.animationPanel=new p.Z(this.stage,(()=>{this.hasDock=!1,this.animationPanel=void 0,this.stage.history.commitTransaction(),this.resize()}))),this.animationPanel.position()},this.dragMenuStart=e=>{this.p=e,this.d=new at.Z((0,h.ZP)("menu-bar").offsetLeft,(0,h.ZP)("menu-bar").offsetTop)},this.dragMenuMove=e=>{(0,h.ZP)("menu-bar").style.left=Math.round(this.d.x+(e.x-this.p.x))+"px",(0,h.ZP)("menu-bar").style.top=Math.round(this.d.y+(e.y-this.p.y))+"px"},this.dragMenuUp=e=>{let t=Math.round(this.d.y+(e.y-this.p.y)),s=Math.round(this.d.x+(e.x-this.p.x));t<76&&(t=76),s<0&&(s=0),s+72>(0,h.ZP)("workspace").offsetWidth&&(s=(0,h.ZP)("workspace").offsetWidth-72),(0,h.ZP)("menu-bar").style.left=s+"px",(0,h.ZP)("menu-bar").style.top=t+"px"},this.animationPlayEvent=e=>{(0,h.ZP)("animator").classList.add("playing"),(0,h.ZP)("animator").setAttribute("time",e.detail);const t=(0,h.ZP)("animator-ring-circle");if(t instanceof SVGCircleElement){const e=2*t.r.baseVal.value*Math.PI;t.style.strokeDashoffset=e.toString(),t.style.strokeDasharray=`${e} ${e}`}(0,h.ZP)("animation-play").classList.add("disabled"),(0,h.ZP)("animation-stop").classList.remove("disabled")},this.animationStepEvent=e=>{const t=Number(e.detail),s=Number((0,h.ZP)("animator").getAttribute("time"));(0,h.ZP)("animator-time").innerText=(Math.min(t,s)/1e3).toFixed(1);const i=Math.min(t/s,1),a=(0,h.ZP)("animator-ring-circle");if(a instanceof SVGCircleElement){const e=2*a.r.baseVal.value*Math.PI,t=e-i*e;a.style.strokeDashoffset=t.toString()}},this.animationStopEvent=e=>{(0,h.ZP)("animator").classList.remove("playing"),(0,h.ZP)("animation-play").classList.remove("disabled"),(0,h.ZP)("animation-stop").classList.add("disabled")},this.setColorEvent=e=>{const t=e.detail;(0,S.nS)(t),this.setColor(t,!0)},this.setColor=(e,t)=>{let s=e.toHEX();t?((0,S.Lt)("mainColor",s),(0,h.ZP)("color-main").style.backgroundColor=s):((0,S.Lt)("altColor",s),(0,h.ZP)("color-alt").style.backgroundColor=s)},this.switchColor=()=>{let e=S.ZP.mainColor,t=S.ZP.altColor;(0,S.Lt)("altColor",e),(0,S.Lt)("mainColor",t),(0,h.ZP)("color-main").style.backgroundColor=t,(0,h.ZP)("color-alt").style.backgroundColor=e},this.resetColor=()=>{(0,S.Lt)("altColor","#FFFFFF"),(0,S.Lt)("mainColor","#000000"),(0,h.ZP)("color-main").style.backgroundColor="#000000",(0,h.ZP)("color-alt").style.backgroundColor="#FFFFFF"},this.setUpPanelBar=()=>{this.tabBar=new l.Z(this),this.layerPanel=new c.Z(this.stage,S.ZP.panelLayer),this.historyPanel=new d.Z(this.stage,S.ZP.panelHistory),this.navigatorPanel=new u.Z(this.stage,S.ZP.panelNavigator),this.scrollbar=new m.Z(this.stage),!S.ZP.user.subscription&&document.body.clientWidth<1025&&(this.sneaky=new g.Z),(S.ZP.panelLayer||S.ZP.panelHistory||S.ZP.panelNavigator)&&(0,h.ZP)("panel-bar").classList.add("active"),(0,h.ZP)("panel-bar").classList.toggle("floating",S.ZP.panelFloating)},this.dockPanel=e=>{"animation"==e&&this.animationPanel&&(this.hasDock=this.animationPanel.docked=!this.animationPanel.docked,this.animationPanel.position()),this.resize()},this.togglePanel=e=>{const t=!(0,h.ZP)(e).classList.contains("active");switch(e){case"navigator-panel":(0,S.Lt)("panelNavigator",t),this.navigatorPanel.activate(t);break;case"layer-panel":(0,S.Lt)("panelLayer",t),this.layerPanel.activate(t);break;case"history-panel":(0,S.Lt)("panelHistory",t),this.historyPanel.activate(t)}let s=!1;const i=(0,h.ZP)("panel-bar").getElementsByClassName("panel");for(let a=0;a<i.length;a++)if(i[a].classList.contains("active")){s=!0;break}(0,h.ZP)("panel-bar").classList.toggle("active",s),S.ZP.panelFloating?t&&((0,h.ZP)(e).style.left=~~(((0,h.ZP)("workspace").clientWidth-240)/2)+"px",(0,h.ZP)(e).style.top=~~(((0,h.ZP)("workspace").clientHeight-70)/2)+"px"):this.resize()},this.restorePanel=()=>{(0,h.ZP)("panel-bar").classList.remove("floating"),(0,h.ZP)("menu-bar").classList.remove("floating"),(0,h.ZP)("panel-bar").classList.add("active"),this.navigatorPanel.activate(!0),this.layerPanel.activate(!0),this.historyPanel.activate(!0),(0,S.Lt)("panelNavigator",!0),(0,S.Lt)("panelLayer",!0),(0,S.Lt)("panelHistory",!0),(0,S.Lt)("panelFloating",!1),this.positionFloatingPanels(),this.resize()},this.toggleFloatingPanel=()=>{const e=!S.ZP.panelFloating;(0,S.Lt)("panelFloating",e),(0,h.ZP)("panel-bar").classList.toggle("floating"),(0,h.ZP)("menu-bar").classList.toggle("floating"),this.resize()},this.positionFloatingPanels=()=>{const e=(0,h.ZP)("menu-bar");e.style.top="100px",e.style.left="20px";const t=(0,h.ZP)("workspace").offsetWidth,s=(0,h.ZP)("workspace").offsetHeight;let i=100;if(this.navigatorPanel.active){const e=(0,h.ZP)("navigator-panel");e.style.top=i+"px",e.style.left=t-260+"px",i+=e.offsetHeight+20}let a=Math.min(~~(s-i)/2-20,300);if(this.layerPanel.active&&this.historyPanel.active||(a*=2),this.layerPanel.active){const e=(0,h.ZP)("layer-panel");e.style.top=i+"px",e.style.left=t-260+"px",e.style.height=a+"px",i+=a+20}if(this.historyPanel.active){const e=(0,h.ZP)("history-panel");e.style.top=i+"px",e.style.left=t-260+"px",e.style.height=a+"px"}},this.hovering=!1,this.selectToolEvent=e=>{window.clearTimeout(this.onit),window.clearTimeout(this.offit),e&&e.detail?this.setTool(e.detail,!0):this.setTool("arrange")},this.setTool=async(e,t=!1,s)=>{var i,a;if(null===(i=this.sneaky)||void 0===i||i.timeToSneak(),null===(a=this.stage)||void 0===a||a.stopAnimation(),(t||!this.tool||this.tool.name!==e)&&(this.tool&&((0,h.ZP)("tool-"+this.tool.name).classList.remove("active"),(0,h.ZP)(this.tool.name).classList.remove("active"),this.tool.cleanUp(),this.tool=void 0,this.stage.coating.removeCursorImage()),(0,h.ZP)(e)||(await this.loadView(e,"option-content","option"),!this.tool))){switch(e){case"crop":this.tool=new Ce.Z(this.stage);break;case"cutout":this.tool=new Oe.Z(this.stage);break;case"frame":this.tool=new Fe.Z(this.stage);break;case"arrange":this.tool=new Ge.Z(this.stage,s||"ARRANGE");break;case"marquee":this.tool=new je.Z(this.stage);break;case"lasso":this.tool=new Ne.Z(this.stage);break;case"wand":this.tool=new Le.Z(this.stage);break;case"clone":this.tool=new _e.Z(this.stage);break;case"heal":this.tool=new Ie.Z(this.stage);break;case"detail":this.tool=new Ue.Z(this.stage);break;case"toning":this.tool=new He.Z(this.stage);break;case"temper":this.tool=new qe.Z(this.stage);break;case"focus":this.tool=new Be.Z(this.stage);break;case"disperse":this.tool=new Ke.Z(this.stage);break;case"liquify":this.tool=new Xe.Z(this.stage);break;case"pen":this.tool=new Se.Z(this.stage);break;case"fill":this.tool=new Re.Z(this.stage);break;case"draw":this.tool=new De.Z(this.stage);break;case"shape":this.tool=new ze.Z(this.stage);break;case"eraser":this.tool=new $e.Z(this.stage);break;case"replace":this.tool=new We.Z(this.stage);break;case"gradient":this.tool=new Ye.Z(this.stage);break;case"text":this.tool=new Te.Z(this.stage);break;case"zoom":this.tool=new Me.Z(this.stage);break;case"hand":this.tool=new Ae.Z(this.stage);break;case"picker":this.tool=new Ve.Z(this.stage,((e,t)=>{(0,S.nS)(e),this.setColor(e,t)}))}this.tool&&((0,h.ZP)("tooltip-"+this.tool.name).classList.remove("active"),(0,h.ZP)("tool-"+this.tool.name).classList.add("active"),(0,h.ZP)(this.tool.name).classList.add("active"))}},this.print=async()=>{let e=this.stage.getOutputCanvas(1).toDataURL();var t=window.open("about:blank","_new");t.document.open(),t.document.write("<html><head><script>function step1(){\nsetTimeout('step2()', 10);}\nfunction step2(){window.print();window.close()}\n<\/script></head><body onload='step1()'>\n<img src='"+e+"' /></body></html>"),t.document.close()},window.onresize=()=>this.resize(),document.body.onkeydown=e=>this.keyDown(e),document.body.onkeyup=e=>this.keyUp(e),this.loadView("top-bar","workspace").then(this.setUpTopBar),this.loadView("menu-bar","workspace").then(this.setUpMenuBar),this.loadView("panel-bar","workspace").then(this.setUpPanelBar),document.addEventListener("resize",(()=>this.resize())),document.addEventListener("select-tool",this.selectToolEvent,!0),document.addEventListener("set-color",this.setColorEvent,!0),document.addEventListener("animation-play",this.animationPlayEvent,!0),document.addEventListener("animation-step",this.animationStepEvent,!0),document.addEventListener("animation-stop",this.animationStopEvent,!0),document.addEventListener("panel-state",(e=>this.togglePanel(e.detail))),document.addEventListener("panel-dock",(e=>this.dockPanel(e.detail))),document.addEventListener("panel-animation",(e=>this.showAnimationPanel()))}showToolTip(e,t){"mouse"===t.pointerType&&(window.clearTimeout(this.offit),this.onit=window.setTimeout((()=>{let t=(0,h.ZP)("tooltip-"+e);t.style.top=(0,h.ZP)("tool-"+e).offsetTop-10+"px",t.style.left=(0,h.ZP)("tool-"+e).offsetLeft+40+"px",t.offsetTop+t.offsetHeight>(0,h.ZP)("menu-bar").offsetHeight-10&&(t.style.top=(0,h.ZP)("menu-bar").offsetHeight-t.offsetHeight-10+"px"),t.classList.add("active"),this.hovering=!0}),this.hovering?0:666))}hideToolTip(e,t){"mouse"===t.pointerType&&(window.clearTimeout(this.onit),window.clearTimeout(this.offit),(0,h.ZP)("tooltip-"+e).classList.remove("active"),this.offit=window.setTimeout((()=>{this.hovering=!1}),1e3))}}i()}catch(rt){i(rt)}}))},2360:(e,t,s)=>{s.a(e,(async(e,t)=>{try{var i=s(7657),a=s(3947),n=s(4820),o=s(1030),r=e([i]);i=(r.then?(await r)():r)[0],"serviceWorker"in navigator&&window.addEventListener("load",(async()=>{try{const e=await navigator.serviceWorker.register("/service-worker-e.js",{scope:"/e"});console.log("SW registered: ",e)}catch(e){console.log("SW registration failed: ",e)}})),n.ZP.product="e",function(){var e=document.createElement("canvas").getContext("webgl");if(!(e instanceof WebGLRenderingContext&&"undefined"!=typeof Promise)){if(!("WebGLRenderingContext"in window)||"undefined"==typeof Promise)throw(0,a.ZP)("home-box").innerHTML='\n            <div id="old-browser">\n                <h1>Old browser!</h1> \n                To be able to use the pixlr photo editor you need a modern browser, \n                just download a fresh one, such as <a href="https://www.google.com/chrome/">Chrome</a>, \n                <a href="https://www.microsoft.com/en-us/windows/microsoft-edge">Edge</a>, \n                <a href="https://support.apple.com/downloads/safari">Safari</a> or \n                <a href="https://www.mozilla.org/en-US/firefox/new/">Firefox</a>!<br /><br/> \n                <small>(Error: Could not create webgl context or use promise)</small>\n            </div>',e||(0,o.Z)("no-gl","nonexistent"),"undefined"==typeof Promise&&(0,o.Z)("no-promise"),new Error("Browser not supported");if("WebGLRenderingContext"in window)throw(0,a.ZP)("home-box").innerHTML='\n            <div id="old-browser">\n                <h1>WebGL disabled</h1> \n                To be able to use the pixlr photo editor you need webgl. <br />\n                Your browser seems the support it but it\'s disabled for some reason, this can sometimes be due to old videocard drivers. <br />\n                Check the links below for browser support:<br />\n                <ul>\n                    <li><a href="https://support.mozilla.com/en-US/kb/how-do-i-upgrade-my-graphics-drivers">Firefox</a></li>\n                    <li><a href="https://support.google.com/chrome/?hl=en#topic=7438008">Chrome</a>\n                    <li><a href="http://www.opera.com/support/">Opera</a></li>                    \n                </ul>\n                <small>(Error: Could not create webgl context)</small>\n            </div>',(0,o.Z)("no-gl","disabled"),new Error("Browser not supported")}}();new i.Z;t()}catch(h){t(h)}}))},5264:(e,t,s)=>{s.d(t,{Z:()=>n});var i=s(3655),a=s(8976);class n extends a.Z{constructor(e){super(e,"auto");let t=i.gr(this.selected.canvas);this.shaders.addShader("bwpoint",{black:t.x,white:t.y});let s=i.fu(this.selected.canvas);s<.7&&this.shaders.addShader("vibrance",.7-s),this.apply()}}},7241:(e,t,s)=>{s.d(t,{Z:()=>a});var i=s(8976);class a extends i.Z{constructor(e){super(e,"bw"),this.shaders.addShader("saturation",-1),this.shaders.addShader("contrast",.2),this.shaders.addShader("exposure",.1),this.shaders.addShader("clarity",.1),this.apply()}}},1322:(e,t,s)=>{s.d(t,{Z:()=>a});var i=s(8976);class a extends i.Z{constructor(e){super(e,"desaturate"),this.shaders.addShader("desaturate",1),this.apply()}}},4800:(e,t,s)=>{s.d(t,{Z:()=>a});var i=s(8976);class a extends i.Z{constructor(e){super(e,"invert"),this.shaders.addShader("invert",1),this.apply()}}},1487:(e,t,s)=>{s.d(t,{Z:()=>a});var i=s(8976);class a extends i.Z{constructor(e){super(e,"pop"),this.shaders.addShader("highlights",.5),this.shaders.addShader("shadows",-.5),this.shaders.addShader("vibrance",.5),this.shaders.addShader("saturation",.2),this.shaders.addShader("exposure",.2),this.shaders.addShader("clarity",.2),this.apply()}}},7352:(e,t,s)=>{s.d(t,{Z:()=>a});var i=s(8976);class a extends i.Z{constructor(e){super(e,"sobel"),this.shaders.addShader("sobel",1),this.apply()}}},8105:(e,t,s)=>{s.d(t,{Z:()=>a});var i=s(8976);class a extends i.Z{constructor(e){super(e,"solarize"),this.shaders.addShader("solarize",1),this.apply()}}},2385:(e,t,s)=>{s.d(t,{Z:()=>P});var i=s(3947),a=s(8203),n=s(4170),o=s(2817),r=s(3655),h=s(6817),l=s(3673);class c{constructor(e,t,s,i,a,n){this.p0=e,this.p1=t,this.p2=s,this.t0=i,this.t1=a,this.t2=n}}var d=s(7976);class u{constructor(e,t){if(this.keyDown=e=>{if(27!==e.keyCode){if(13!==e.keyCode)return 32===e.keyCode?(this.stage.coating.setPan(this.modal),void e.preventDefault()):void 0;this.apply()}else this.cancel()},this.keyUp=e=>{if(32===e.keyCode)return this.stage.coating.removePan(this.modal),this.split=28,void this.render()},this.inputPosition=e=>{this.TL.x=Number((0,i.ZP)("distort-x1").value),this.TL.y=Number((0,i.ZP)("distort-y1").value),this.TR.x=Number((0,i.ZP)("distort-x2").value),this.TR.y=Number((0,i.ZP)("distort-y2").value),this.BL.x=Number((0,i.ZP)("distort-x3").value),this.BL.y=Number((0,i.ZP)("distort-y3").value),this.BR.x=Number((0,i.ZP)("distort-x4").value),this.BR.y=Number((0,i.ZP)("distort-y4").value),window.requestAnimationFrame(this.render)},this.updateInputs=()=>{(0,i.ZP)("distort-x1").value=Math.round(this.TL.x).toString(),(0,i.ZP)("distort-y1").value=Math.round(this.TL.y).toString(),(0,i.ZP)("distort-x2").value=Math.round(this.TR.x).toString(),(0,i.ZP)("distort-y2").value=Math.round(this.TR.y).toString(),(0,i.ZP)("distort-x3").value=Math.round(this.BL.x).toString(),(0,i.ZP)("distort-y3").value=Math.round(this.BL.y).toString(),(0,i.ZP)("distort-x4").value=Math.round(this.BR.x).toString(),(0,i.ZP)("distort-y4").value=Math.round(this.BR.y).toString()},this.touchStart=e=>{e.stopPropagation(),e.targetTouches.length>1||this.down(new l.Z(e.changedTouches[0].clientX-this.stage.raster.offsetLeft,e.changedTouches[0].clientY-this.stage.raster.offsetTop))},this.touchMove=e=>{e.stopPropagation(),e.targetTouches.length>1||this.move(new l.Z(e.changedTouches[0].clientX,e.changedTouches[0].clientY))},this.touchEnd=e=>{e.stopPropagation(),this.up(new l.Z(e.changedTouches[0].clientX-this.raster.offsetLeft,e.changedTouches[0].clientY-this.raster.offsetTop))},this.mouseDown=e=>{e.stopPropagation(),this.stage.coating.override||this.down(new l.Z(e.clientX-this.raster.offsetLeft,e.clientY-this.raster.offsetTop))},this.mouseMove=e=>{e.stopPropagation(),this.stage.coating.override||this.move(new l.Z(e.clientX-this.raster.offsetLeft,e.clientY-this.raster.offsetTop))},this.mouseLeave=e=>{e.stopPropagation(),this.up(new l.Z(e.clientX-this.raster.offsetLeft,e.clientY-this.raster.offsetTop))},this.mouseUp=e=>{e.stopPropagation(),this.up(new l.Z(e.clientX-this.raster.offsetLeft,e.clientY-this.raster.offsetTop))},this.down=async e=>{this.downPoint=this.stage.translateRasterToFresco(e),this.isControl(this.downPoint)?(this.split=8,this.isDown=!0,this.downPosition=this.ss.clone(),window.requestAnimationFrame(this.render)):this.isInside(this.downPoint)?(this.split=5,this.isMove=!0,this.isDown=!0,this.offset=new l.Z,window.requestAnimationFrame(this.render)):this.choice()},this.move=e=>{e=this.stage.translateRasterToFresco(e),this.isDown?(this.isMove?(this.offset.x=this.downPoint.x-e.x,this.offset.y=this.downPoint.y-e.y):(this.ss.x=this.downPosition.x+(e.x-this.downPoint.x),this.ss.y=this.downPosition.y+(e.y-this.downPoint.y),this.updateInputs()),window.requestAnimationFrame(this.render)):this.isControl(e)?this.modal.style.cursor="pointer":this.isInside(e)?this.modal.style.cursor="move":this.modal.style.cursor="unset"},this.up=e=>{this.isDown&&(this.isMove&&(this.TL=this.TL.neg(this.offset),this.TR=this.TR.neg(this.offset),this.BL=this.BL.neg(this.offset),this.BR=this.BR.neg(this.offset)),this.split=28,this.ss=void 0,this.isDown=!1,this.isMove=!1,this.offset=void 0,this.downPoint=void 0,this.downPosition=void 0,window.requestAnimationFrame(this.render),this.updateInputs())},this.renderLow=()=>{this.split=5,this.renderControls(),this.renderPreview()},this.render=()=>{this.renderControls(),this.renderPreview(),this.stage.render()},this.renderPreview=()=>{let e=this.scratch.ctx;e.clearRect(0,0,e.canvas.width,e.canvas.height),e.imageSmoothingEnabled=!0,e.imageSmoothingQuality="high";const t=this.calculateGeometry();t.forEach((t=>{this.drawTriangle(e,t.p0.x,t.p0.y,t.p1.x,t.p1.y,t.p2.x,t.p2.y,t.t0.x,t.t0.y,t.t1.x,t.t1.y,t.t2.x,t.t2.y)})),this.split>=20&&(t.forEach((t=>{this.drawTriangle(e,t.p0.x,t.p0.y,t.p1.x,t.p1.y,t.p2.x,t.p2.y,t.t0.x,t.t0.y,t.t1.x,t.t1.y,t.t2.x,t.t2.y)})),t.forEach((t=>{this.drawTriangle(e,t.p0.x,t.p0.y,t.p1.x,t.p1.y,t.p2.x,t.p2.y,t.t0.x,t.t0.y,t.t1.x,t.t1.y,t.t2.x,t.t2.y)})),e.imageSmoothingEnabled=!0,t.forEach((t=>{this.drawTriangle(e,t.p0.x,t.p0.y,t.p1.x,t.p1.y,t.p2.x,t.p2.y,t.t0.x,t.t0.y,t.t1.x,t.t1.y,t.t2.x,t.t2.y)})))},this.calculateGeometry=()=>{let e=[];for(var t=this.split,s=this.split,i=this.offset?this.TL.neg(this.offset):this.TL,a=this.offset?this.TR.neg(this.offset):this.TR,n=this.offset?this.BR.neg(this.offset):this.BR,o=this.offset?this.BL.neg(this.offset):this.BL,r=o.x-i.x,h=o.y-i.y,d=n.x-a.x,u=n.y-a.y,p=this.patch.width,g=this.patch.height,m=0;m<t;++m)for(var v=m/t,f=(m+1)/t,y=i.x+r*v,w=i.y+h*v,b=a.x+d*v,x=a.y+u*v,Z=i.x+r*f,k=i.y+h*f,P=a.x+d*f,E=a.y+u*f,S=0;S<s;++S){var T=S/s,C=(S+1)/s,L=P-Z,M=E-k,A=y+(b-y)*T,R=w+(x-w)*T,I=y+(b-y)*C,D=w+(x-w)*C,F=Z+L*C,_=k+M*C,z=Z+L*T,N=k+M*T,B=T*p,O=C*p,U=v*g,H=f*g;e.push(new c(new l.Z(A,R),new l.Z(F,_),new l.Z(z,N),new l.Z(B,U),new l.Z(O,H),new l.Z(B,H))),e.push(new c(new l.Z(A,R),new l.Z(I,D),new l.Z(F,_),new l.Z(B,U),new l.Z(O,U),new l.Z(O,H)))}return e},this.drawTriangle=(e,t,s,i,a,n,o,r,h,l,c,d,u)=>{e.save(),e.beginPath(),e.moveTo(t,s),e.lineTo(i,a),e.lineTo(n,o),e.closePath(),e.clip();var p=r*(u-c)-l*u+d*c+(l-d)*h;if(0!==p){var g=-(h*(n-i)-c*n+u*i+(c-u)*t)/p,m=(c*o+h*(a-o)-u*a+(u-c)*s)/p,v=(r*(n-i)-l*n+d*i+(l-d)*t)/p,f=-(l*o+r*(a-o)-d*a+(d-l)*s)/p,y=(r*(u*i-c*n)+h*(l*n-d*i)+(d*c-l*u)*t)/p,w=(r*(u*a-c*o)+h*(l*o-d*a)+(d*c-l*u)*s)/p;e.transform(g,m,v,f,y,w),e.drawImage(this.patch,0,0),e.restore()}},this.renderControls=()=>{if(!this.stage||!this.stage.fresco||this.stage.supressRender)return;this.ctx.clearRect(0,0,this.raster.width,this.raster.height),this.ctx.lineWidth=1,this.ctx.translate(.5,.5),this.ctx.strokeStyle=r.wf,this.ctx.fillStyle=r.wf;const e=this.stage.translateFrescoToRaster(this.offset?this.TL.neg(this.offset):this.TL),t=this.stage.translateFrescoToRaster(this.offset?this.TR.neg(this.offset):this.TR),s=this.stage.translateFrescoToRaster(this.offset?this.BL.neg(this.offset):this.BL),i=this.stage.translateFrescoToRaster(this.offset?this.BR.neg(this.offset):this.BR);this.ctx.beginPath(),this.ctx.moveTo(e.x,e.y),this.ctx.lineTo(t.x-1,t.y),this.ctx.lineTo(i.x-1,i.y-1),this.ctx.lineTo(s.x,s.y-1),this.ctx.lineTo(e.x,e.y),this.ctx.closePath(),this.ctx.stroke(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.fillStyle=r.xZ,this.ctx.lineWidth=1.5,this.isDown&&this.ss&&this.ss!==this.TL||(this.ctx.beginPath(),this.ctx.arc(e.x,e.y,8,0,2*Math.PI,!1),this.ctx.closePath(),this.ctx.fill(),this.ctx.stroke()),this.isDown&&this.ss&&this.ss!==this.BL||(this.ctx.beginPath(),this.ctx.arc(s.x,s.y,8,0,2*Math.PI,!1),this.ctx.closePath(),this.ctx.fill(),this.ctx.stroke()),this.isDown&&this.ss&&this.ss!==this.TR||(this.ctx.beginPath(),this.ctx.arc(t.x,t.y,8,0,2*Math.PI,!1),this.ctx.closePath(),this.ctx.fill(),this.ctx.stroke()),this.isDown&&this.ss&&this.ss!==this.BR||(this.ctx.beginPath(),this.ctx.arc(i.x,i.y,8,0,2*Math.PI,!1),this.ctx.closePath(),this.ctx.fill(),this.ctx.stroke())},this.isControl=e=>{let t=32/this.stage.zoom,s=t/2;return r.aG(this.TL.x-s,this.TL.y-s,t,t,e.x,e.y)?(this.ss=this.TL,!0):r.aG(this.TR.x-s,this.TR.y-s,t,t,e.x,e.y)?(this.ss=this.TR,!0):r.aG(this.BL.x-s,this.BL.y-s,t,t,e.x,e.y)?(this.ss=this.BL,!0):r.aG(this.BR.x-s,this.BR.y-s,t,t,e.x,e.y)?(this.ss=this.BR,!0):(this.ss=void 0,!1)},this.isInside=e=>this.scratch.ctx.getImageData(e.x,e.y,1,1).data[3]>0,this.choice=async()=>{const e=await new d.Z("Apply","Do you want to apply the distort?","Yes","No","Cancel").init();void 0!==e&&(e?this.apply():this.cancel())},this.apply=async()=>{if(!(this.oTL.equalTo(this.TL)&&this.oTR.equalTo(this.TR)&&this.oBL.equalTo(this.BL)&&this.oBR.equalTo(this.BR))){let e=h.Z.fromPoints([this.TL,this.TR,this.BL,this.BR]);this.split=64,this.offset=e.topLeft(),this.scratch.setTarget(this.selected.id,this.clone?e:new h.Z(0,0,e.width,e.height),this.clone?"over":"replace"),this.renderPreview();const t=this.selected.rect.clone(),s=r.dN(this.clone?this.clone:this.selected.canvas);return this.clone?(this.selected.extendCanvas(e),this.scratch.drawToLayer(this.selected)):this.selected.switchCanvas(this.scratch.canvas,e),this.selected.render(),this.stage.history.add({type:"bitmapSwitch",kind:"distort",layer:this.selected,rect:t,canvas:s}),void this.callback(!!this.clone)}this.cancel()},this.cancel=()=>{this.clone&&(this.selected.canvas=this.clone),this.callback()},this.cleanUp=()=>{var e,t;this.modal&&(this.ctx.clearRect(0,0,this.raster.width,this.raster.width),this.stage&&this.stage.fresco&&(this.stage.fresco.removeScratch(),window.requestAnimationFrame(this.stage.render)),this.stage.coating.wake(),this.modal.removeEventListener("touchstart",this.touchStart),this.modal.removeEventListener("mousedown",this.mouseDown,!1),this.modal.removeEventListener("touchmove",this.touchMove),this.modal.removeEventListener("mousemove",this.mouseMove,!1),this.modal.removeEventListener("touchend",this.touchEnd),this.modal.removeEventListener("mouseup",this.mouseUp,!1),this.modal.removeEventListener("mouseleave",this.mouseUp,!1),this.modal.removeEventListener("dblclick",this.choice,!1),this.modal.removeEventListener("wheel",this.stage.coating.mouseWheel),this.modal.removeEventListener("contextmenu",(e=>{e.preventDefault()}),!1),document.removeEventListener("keydown",this.keyDown,!1),document.removeEventListener("keyup",this.keyUp,!1),document.removeEventListener("viewport-render",this.renderLow),(0,i.ZP)("distort-apply").removeEventListener("click",this.apply,!1),(0,i.ZP)("distort-cancel").removeEventListener("click",this.cancel,!1),(0,i.ZP)("distort-x1").removeEventListener("input",this.inputPosition,!1),(0,i.ZP)("distort-y1").removeEventListener("input",this.inputPosition,!1),(0,i.ZP)("distort-x2").removeEventListener("input",this.inputPosition,!1),(0,i.ZP)("distort-y2").removeEventListener("input",this.inputPosition,!1),(0,i.ZP)("distort-x3").removeEventListener("input",this.inputPosition,!1),(0,i.ZP)("distort-y3").removeEventListener("input",this.inputPosition,!1),(0,i.ZP)("distort-x4").removeEventListener("input",this.inputPosition,!1),(0,i.ZP)("distort-y4").removeEventListener("input",this.inputPosition,!1),null===(e=this.modal)||void 0===e||e.remove(),this.modal=void 0,null===(t=this.options)||void 0===t||t.remove(),this.options=void 0,this.scratch=void 0,this.raster=void 0,this.stage=void 0,this.ctx=void 0)},this.stage=e,this.callback=t,this.ctx=e.coating.ctx,this.raster=e.coating.raster,this.stage.fresco&&this.stage.fresco.isSelectedImageWithCanvas()){if(this.selected=this.stage.fresco.getSelected(),this.stage.fresco.hasSelection()){this.clone=r.dN(this.selected.canvas);const[e,t]=this.stage.primeCut();if(!e)return void this.callback();this.patch=e,this.oTL=t.topLeft(),this.oTR=t.topRight(),this.oBL=t.bottomLeft(),this.oBR=t.bottomRight()}else this.patch=this.selected.canvas,this.oTL=this.selected.rect.topLeft(),this.oTR=this.selected.rect.topRight(),this.oBL=this.selected.rect.bottomLeft(),this.oBR=this.selected.rect.bottomRight();this.stage.coating.sleep(),this.offset=new l.Z,this.TL=this.oTL.clone(),this.TR=this.oTR.clone(),this.BL=this.oBL.clone(),this.BR=this.oBR.clone(),this.scratch=this.stage.fresco.addScratch(),this.scratch.setTarget(this.selected.id,new h.Z(0,0,this.stage.fresco.width,this.stage.fresco.height),this.clone?"over":"replace"),this.mid=Math.round(99999999999999*Math.random()).toString(),this.modal=(0,i.T)("div",{id:"modal-"+this.mid,className:"modal"}),(0,i.ZP)("workspace").appendChild(this.modal),this.options=(0,i.T)("div",{id:"distort",className:"option-float option active"},(0,i.T)("div",{className:"option-icon"},(0,i.T)("img",{src:"/img/tool/distort.svg",className:"ic"})),(0,i.T)("div",{id:"distort-settings"},(0,i.T)("label",{className:"tab-10"},"Left top:"),(0,i.T)("input",{type:"number",id:"distort-x1"}),(0,i.T)("label",{className:"tab-5"},"x"),(0,i.T)("input",{type:"number",id:"distort-y1"}),(0,i.T)("label",{className:"tab-20"},"Right top:"),(0,i.T)("input",{type:"number",id:"distort-x2"}),(0,i.T)("label",{className:"tab-5"},"x"),(0,i.T)("input",{type:"number",id:"distort-y2"}),(0,i.T)("label",{className:"tab-20"},"Left bottom:"),(0,i.T)("input",{type:"number",id:"distort-x3"}),(0,i.T)("label",{className:"tab-5"},"x"),(0,i.T)("input",{type:"number",id:"distort-y3"}),(0,i.T)("label",{className:"tab-20"},"Right bottom:"),(0,i.T)("input",{type:"number",id:"distort-x4"}),(0,i.T)("label",{className:"tab-5"},"x"),(0,i.T)("input",{type:"number",id:"distort-y4"}),(0,i.T)("a",{className:"button outline tab-30",id:"distort-cancel"},"Cancel"),(0,i.T)("a",{className:"button outline tab-10",id:"distort-apply"},"Apply"))),(0,i.ZP)("workspace").appendChild(this.options),(0,i.ZP)("distort-apply").addEventListener("click",this.apply,!1),(0,i.ZP)("distort-cancel").addEventListener("click",this.cancel,!1),(0,i.ZP)("distort-x1").addEventListener("input",this.inputPosition,!1),(0,i.ZP)("distort-y1").addEventListener("input",this.inputPosition,!1),(0,i.ZP)("distort-x2").addEventListener("input",this.inputPosition,!1),(0,i.ZP)("distort-y2").addEventListener("input",this.inputPosition,!1),(0,i.ZP)("distort-x3").addEventListener("input",this.inputPosition,!1),(0,i.ZP)("distort-y3").addEventListener("input",this.inputPosition,!1),(0,i.ZP)("distort-x4").addEventListener("input",this.inputPosition,!1),(0,i.ZP)("distort-y4").addEventListener("input",this.inputPosition,!1),this.split=28,this.modal.addEventListener("touchstart",this.touchStart,{passive:!1}),this.modal.addEventListener("mousedown",this.mouseDown,!1),this.modal.addEventListener("touchmove",this.touchMove,{passive:!1}),this.modal.addEventListener("mousemove",this.mouseMove,!1),this.modal.addEventListener("touchend",this.touchEnd,{passive:!1}),this.modal.addEventListener("mouseup",this.mouseUp,!1),this.modal.addEventListener("mouseleave",this.mouseUp,!1),this.modal.addEventListener("dblclick",this.choice,!1),this.modal.addEventListener("wheel",this.stage.coating.mouseWheel,{passive:!1}),this.modal.addEventListener("contextmenu",(e=>{e.preventDefault()}),!1),document.addEventListener("keydown",this.keyDown,!1),document.addEventListener("keyup",this.keyUp,!1),document.addEventListener("viewport-render",this.renderLow),window.requestAnimationFrame(this.render),this.updateInputs()}else this.callback()}}var p=s(4188),g=s(3646),m=s(4820),v=s(1726);class f{constructor(e,t){if(this.inputPosition=e=>{let t=(0,i.ZP)("transform-top").value,s=(0,i.ZP)("transform-left").value,a=new l.Z;a.x=Math.round(Number(s)),a.y=Math.round(Number(t)),this.layer.rect.x=a.x,this.layer.rect.y=a.y,this.renderAll()},this.inputSize=e=>{if("transform-width"==e.currentTarget.id){let e=(0,i.ZP)("transform-width").value,t=NaN!=Number(e)?Math.round(Number(e)):50;this.layer.setWidth(t,this.orgRect.getAspect()),(0,i.ZP)("transform-height").value=Math.round(this.layer.rect.height).toString()}else{let e=(0,i.ZP)("transform-height").value,t=NaN!=Number(e)?Math.round(Number(e)):50;this.layer.setHeight(t,this.orgRect.getAspect()),(0,i.ZP)("transform-width").value=Math.round(this.layer.rect.width).toString()}this.renderAll()},this.updateInputs=()=>{(0,i.ZP)("transform-width").value=Math.round(this.layer.rect.width).toString(),(0,i.ZP)("transform-height").value=Math.round(this.layer.rect.height).toString(),(0,i.ZP)("transform-top").value=Math.round(this.layer.rect.y).toString(),(0,i.ZP)("transform-left").value=Math.round(this.layer.rect.x).toString(),this.rotation.setValue(this.layer.rect.rotation)},this.keyDown=e=>{if("ArrowUp"===e.key||"ArrowDown"===e.key||"ArrowLeft"===e.key||"ArrowRight"===e.key){let t=e.shiftKey?10:1,s="ArrowLeft"===e.key||"ArrowRight"===e.key?"ArrowLeft"===e.key?-t:t:0,i="ArrowUp"===e.key||"ArrowDown"===e.key?"ArrowUp"===e.key?-t:t:0;this.step(s,i)}if("Escape"!==e.key){if("Enter"!==e.key)return" "===e.key?(this.stage.coating.setPan(this.modal),void e.preventDefault()):void 0;this.apply()}else this.cancel()},this.keyUp=e=>{" "!==e.key||this.stage.coating.removePan(this.modal)},this.touchStart=e=>{e.stopPropagation(),e.targetTouches.length>1||this.down(new l.Z(e.changedTouches[0].clientX-this.stage.raster.offsetLeft,e.changedTouches[0].clientY-this.stage.raster.offsetTop))},this.touchMove=e=>{e.stopPropagation(),e.targetTouches.length>1||this.move(new l.Z(e.changedTouches[0].clientX-this.raster.offsetLeft,e.changedTouches[0].clientY-this.raster.offsetTop))},this.touchEnd=e=>{e.stopPropagation(),this.up(new l.Z(e.changedTouches[0].clientX-this.raster.offsetLeft,e.changedTouches[0].clientY-this.raster.offsetTop))},this.mouseDown=e=>{e.stopPropagation(),this.stage.coating.override||(this.isShiftDown=e.shiftKey,this.down(new l.Z(e.clientX-this.raster.offsetLeft,e.clientY-this.raster.offsetTop)))},this.mouseMove=e=>{e.stopPropagation(),this.stage.coating.override||(this.isShiftDown=e.shiftKey,this.move(new l.Z(e.clientX-this.raster.offsetLeft,e.clientY-this.raster.offsetTop)))},this.mouseLeave=e=>{e.stopPropagation(),this.isShiftDown=e.shiftKey,this.up(new l.Z(e.clientX-this.raster.offsetLeft,e.clientY-this.raster.offsetTop))},this.mouseUp=e=>{e.stopPropagation(),this.up(new l.Z(e.clientX-this.raster.offsetLeft,e.clientY-this.raster.offsetTop))},this.down=async e=>{if(r.aG(0,0,this.raster.offsetWidth,this.raster.offsetHeight,e.x,e.y))if(this.isControl(e)){if(this.isDown=!0,this.downControl=this.layer.rect.topLeft(),this.downPoint=this.stage.translateRasterToFresco(e),"rotate"===this.method){let e=this.layer.rect.center();this.downRotation=180/Math.PI*Math.atan2(this.downPoint.y-e.y,this.downPoint.x-e.x)-this.layer.rect.rotation}else if("move"!==this.method){const e=this.layer.rect,t=e.center();let s,i;switch(this.matrix.reset(),this.matrix.translate(t),this.matrix.rotateDegree(360-this.layer.rect.rotation),this.matrix.invert(),this.method){case"nw-resize":i=e.topLeft(),s=e.bottomRight();break;case"n-resize":i=new l.Z(t.x,e.y),s=new l.Z(t.x,e.bottom());break;case"ne-resize":i=e.topRight(),s=e.bottomLeft();break;case"e-resize":i=new l.Z(e.right(),t.y),s=new l.Z(e.x,t.y);break;case"se-resize":i=e.bottomRight(),s=e.topLeft();break;case"s-resize":i=new l.Z(t.x,e.bottom()),s=new l.Z(t.x,e.y);break;case"sw-resize":i=e.bottomLeft(),s=e.topRight();break;case"w-resize":i=new l.Z(e.x,t.y),s=new l.Z(e.right(),t.y)}this.downControl=this.matrix.transformPoint(i).add(t),this.downAnchor=this.matrix.transformPoint(s).add(t)}}else this.choice();else this.choice()},this.getAnchor=()=>{const e=this.layer.rect,t=e.center();let s;switch(this.matrix.reset(),this.matrix.translate(t),this.matrix.rotateDegree(360-this.layer.rect.rotation),this.matrix.invert(),this.method){case"nw-resize":s=e.bottomRight();break;case"n-resize":s=new l.Z(t.x,e.bottom());break;case"ne-resize":s=e.bottomLeft();break;case"e-resize":s=new l.Z(e.x,t.y);break;case"se-resize":s=e.topLeft();break;case"s-resize":s=new l.Z(t.x,e.y);break;case"sw-resize":s=e.topRight();break;case"w-resize":s=new l.Z(e.right(),t.y)}return this.matrix.transformPoint(s).add(t)},this.move=e=>{if(!this.isDown)return void this.isControl(e);let t=this.stage.translateRasterToFresco(e);if("move"===this.method){if(this.isShiftDown){const e=Math.abs(this.downPoint.x-t.x),s=Math.abs(this.downPoint.y-t.y);(e>4||s>4)&&(e<s?(t.x=this.downPoint.x,this.method="vertical"):(t.y=this.downPoint.y,this.method="horizontal"))}this.layer.rect.x=Math.round(this.downControl.x+(t.x-this.downPoint.x)),this.layer.rect.y=Math.round(this.downControl.y+(t.y-this.downPoint.y)),this.checkGuides(this.layer)}else if("vertical"===this.method)this.isShiftDown||(this.method="move"),this.layer.rect.y=Math.round(this.downControl.y+(t.y-this.downPoint.y)),this.checkGuides(this.layer);else if("horizontal"===this.method)this.isShiftDown||(this.method="move"),this.layer.rect.x=Math.round(this.downControl.x+(t.x-this.downPoint.x)),this.checkGuides(this.layer);else if("rotate"===this.method){const s=this.layer.rect.center();let i=180/Math.PI*Math.atan2(t.y-s.y,t.x-s.x)-this.downRotation;this.isShiftDown&&(i=11.25*Math.round(i/11.25)),i<0?i+=360:i>=360&&(i-=360),this.layer.rect.rotation=i,this.updateRotatingCursor(e)}else{let e=t.neg(this.downPoint),s=this.downAnchor,i=this.downControl.add(e);if(0!==this.layer.rect.rotation){const e=new l.Z((s.x+i.x)/2,(s.y+i.y)/2);this.matrix.reset(),this.matrix.translate(e),this.matrix.rotateDegree(this.layer.rect.rotation),this.matrix.invert(),i=this.matrix.transformPoint(i).add(e),s=this.matrix.transformPoint(s).add(e)}switch(this.method){case"nw-resize":this.layer.calculate(i,s,this.isShiftDown?0:this.orgRect.getAspect());break;case"ne-resize":this.layer.calculate(new l.Z(s.x,i.y),new l.Z(i.x,s.y),this.isShiftDown?0:this.orgRect.getAspect());break;case"sw-resize":this.layer.calculate(new l.Z(i.x,s.y),new l.Z(s.x,i.y),this.isShiftDown?0:this.orgRect.getAspect());break;case"se-resize":this.layer.calculate(s,i,this.isShiftDown?0:this.orgRect.getAspect());break;case"n-resize":this.layer.rect.y=i.y,this.layer.rect.height=s.y-i.y,this.layer.rect.height<10&&(this.layer.rect.height=10);break;case"s-resize":this.layer.rect.y=s.y,this.layer.rect.height=i.y-s.y,this.layer.rect.height<10&&(this.layer.rect.height=10);break;case"w-resize":this.layer.rect.x=i.x,this.layer.rect.width=s.x-i.x,this.layer.rect.width<10&&(this.layer.rect.width=10);break;case"e-resize":this.layer.rect.x=s.x,this.layer.rect.width=i.x-s.x,this.layer.rect.width<10&&(this.layer.rect.width=10)}let a=this.downAnchor.neg(this.getAnchor());this.layer.rect.x+=a.x,this.layer.rect.y+=a.y}this.updateInputs(),this.renderAll()},this.up=e=>{this.isDown&&(this.guides=void 0,this.isDown=!1,window.requestAnimationFrame(this.render))},this.step=(e,t)=>{this.layer.rect.x+=e,this.layer.rect.y+=t,this.updateInputs(),this.renderAll()},this.renderAll=()=>{window.requestAnimationFrame((()=>{this.stage.render(),this.render()}))},this.render=()=>{if(!this.ctx)return;this.ctx.clearRect(0,0,this.raster.width,this.raster.height),this.ctx.lineWidth=1,this.ctx.translate(.5,.5),this.ctx.strokeStyle=r.wf,this.ctx.fillStyle=r.wf;let e=this.stage.getLayerLocationRect(this.layer);if(e){if(0!==this.layer.rect.rotation){let t=e.center();this.ctx.translate(t.x,t.y),this.ctx.rotate(this.layer.rect.rotation*Math.PI/180),e.x-=t.x,e.y-=t.y}if(this.ctx.beginPath(),this.ctx.moveTo(e.x,e.y),this.ctx.lineTo(e.right()-1,e.y),this.ctx.lineTo(e.right()-1,e.bottom()-1),this.ctx.lineTo(e.x,e.bottom()-1),this.ctx.lineTo(e.x,e.y),this.ctx.closePath(),this.ctx.stroke(),!this.isDown){0===this.layer.rect.rotation&&this.ctx.setTransform(1,0,0,1,0,0);var t=e.center();t.x=Math.round(t.x),t.y=Math.round(t.y),this.ctx.fillRect(e.x-6,e.y-6,12,12),this.ctx.fillRect(e.x-6,e.y+e.height-6,12,12),this.ctx.fillRect(e.x+e.width-6,e.y-6,12,12),this.ctx.fillRect(e.x+e.width-6,e.y+e.height-6,12,12),e.width>100&&(this.ctx.fillRect(t.x-12,e.y-5,24,8),this.ctx.fillRect(t.x-12,e.y+e.height-3,24,8)),e.height>100&&(this.ctx.fillRect(e.x-5,t.y-12,8,24),this.ctx.fillRect(e.x+e.width-3,t.y-12,8,24)),this.ctx.fillStyle=r.xZ,this.ctx.fillRect(e.x-5,e.y-5,10,10),this.ctx.fillRect(e.x-5,e.y+e.height-5,10,10),this.ctx.fillRect(e.x+e.width-5,e.y-5,10,10),this.ctx.fillRect(e.x+e.width-5,e.y+e.height-5,10,10),e.width>100&&(this.ctx.fillRect(t.x-11,e.y-4,22,6),this.ctx.fillRect(t.x-11,e.y+e.height-2,22,6)),e.height>100&&(this.ctx.fillRect(e.x-4,t.y-11,6,22),this.ctx.fillRect(e.x+e.width-2,t.y-11,6,22))}this.ctx.setTransform(1,0,0,1,0,0),m.ZP.showGuides&&this.guides&&this.guides.length>0&&(this.ctx.translate(.5,.5),this.ctx.strokeStyle=r.CE,this.guides.forEach((e=>{this.ctx.beginPath(),this.ctx.moveTo(e.start.x,e.start.y),this.ctx.lineTo(e.end.x,e.end.y),this.ctx.closePath(),this.ctx.stroke()})),this.ctx.setTransform(1,0,0,1,0,0))}},this.isControl=e=>{const t=2*this.hitSize,s=this.stage.getLayerLocationRect(this.layer);if(!s)return;if(0!==this.layer.rect.rotation){let t=s.center();this.matrix.reset(),this.matrix.translate(t),this.matrix.rotateDegree(this.layer.rect.rotation),this.matrix.invert(),e=this.matrix.transformPoint(e).add(t)}if(r.aG(s.x+this.hitSize-10,s.y+this.hitSize-10,s.width-t+20,s.height-t+20,e.x,e.y))return this.modal.style.cursor="move",this.method="move",!0;if(r.aG(s.x-this.hitSize,s.y-this.hitSize,t,t,e.x,e.y))return this.modal.style.cursor=this.getRotatedCursor(315),this.method="nw-resize",!0;if(r.aG(s.x+s.width-this.hitSize,s.y-this.hitSize,t,t,e.x,e.y))return this.modal.style.cursor=this.getRotatedCursor(45),this.method="ne-resize",!0;if(r.aG(s.x-this.hitSize,s.y+s.height-this.hitSize,t,t,e.x,e.y))return this.modal.style.cursor=this.getRotatedCursor(225),this.method="sw-resize",!0;if(r.aG(s.x+s.width-this.hitSize,s.y+s.height-this.hitSize,t,t,e.x,e.y))return this.modal.style.cursor=this.getRotatedCursor(135),this.method="se-resize",!0;const i=s.width/2,a=s.height/2;return r.aG(s.x+i-30,s.y-this.hitSize,60,t,e.x,e.y)?(this.modal.style.cursor=this.getRotatedCursor(0),this.method="n-resize",!0):r.aG(s.x+i-30,s.y+s.height-this.hitSize,60,t,e.x,e.y)?(this.modal.style.cursor=this.getRotatedCursor(180),this.method="s-resize",!0):r.aG(s.x-this.hitSize,s.y+a-30,t,60,e.x,e.y)?(this.modal.style.cursor=this.getRotatedCursor(90),this.method="w-resize",!0):r.aG(s.x+s.width-this.hitSize,s.y+a-30,t,60,e.x,e.y)?(this.modal.style.cursor=this.getRotatedCursor(270),this.method="e-resize",!0):r.aG(s.x+s.width-100,s.y-100,200,200,e.x,e.y)?(this.modal.style.cursor=this.getRotatedCursor(45,!1),this.method="rotate",!0):r.aG(s.x+s.width-100,s.y+s.height-100,200,200,e.x,e.y)?(this.modal.style.cursor=this.getRotatedCursor(135,!1),this.method="rotate",!0):r.aG(s.x-100,s.y+s.height-100,200,200,e.x,e.y)?(this.modal.style.cursor=this.getRotatedCursor(225,!1),this.method="rotate",!0):r.aG(s.x-100,s.y-100,200,200,e.x,e.y)?(this.modal.style.cursor=this.getRotatedCursor(315,!1),this.method="rotate",!0):(this.modal.style.cursor=this.method="unset",!1)},this.updateRotatingCursor=e=>{const t=this.stage.getLayerLocationRect(this.layer);if(!t)return;let s=t.center();this.matrix.reset(),this.matrix.translate(s),this.matrix.rotate(this.layer.rect.rotation*Math.PI/180),this.matrix.invert(),e=this.matrix.transformPoint(e).add(s),r.aG(t.x+t.width-100,t.y-100,200,200,e.x,e.y)?this.modal.style.cursor=this.getRotatedCursor(45,!1):r.aG(t.x+t.width-100,t.y+t.height-100,200,200,e.x,e.y)?this.modal.style.cursor=this.getRotatedCursor(135,!1):r.aG(t.x-100,t.y+t.height-100,200,200,e.x,e.y)?this.modal.style.cursor=this.getRotatedCursor(225,!1):r.aG(t.x-100,t.y-100,200,200,e.x,e.y)&&(this.modal.style.cursor=this.getRotatedCursor(315,!1))},this.getRotatedCursor=(e,t=!0)=>{const s=["n","ne","e","se","s","sw","w","nw"];let i=e+this.layer.rect.rotation;i<0&&(i+=360),i>360&&(i-=360),i+=22.5;let a=7;for(;a>0&&!(i>45*a&&i<360);)a--;return t?s[a]+"-resize":"url('/img/cursor/rotate-"+s[a]+".svg') 16 16, auto"},this.checkGuides=e=>{if(m.ZP.showGuides||m.ZP.snapToGuides){this.guides=[];let t=m.ZP.snapToGuides,s=5/this.stage.zoom,i=this.stage.fresco.width/2,a=this.stage.fresco.height/2,n=e.rect,o=n.center(),r=new h.Z(this.stage.offset.x,this.stage.offset.y,Math.round(this.stage.fresco.width*this.stage.zoom),Math.round(this.stage.fresco.height*this.stage.zoom));o.x<i+s&&o.x>i-s&&(t&&(n.x=Math.round(i-n.width/2)),this.guides.push(new g.Z(new l.Z(Math.round(r.center().x),r.y),new l.Z(Math.round(r.center().x),r.bottom()-1)))),o.y<a+s&&o.y>a-s&&(t&&(n.y=Math.round(a-n.height/2)),this.guides.push(new g.Z(new l.Z(r.x,Math.round(r.center().y)),new l.Z(r.right()-1,Math.round(r.center().y))))),n.x<0+s&&n.x>0-s&&(t&&(n.x=0),this.guides.push(new g.Z(new l.Z(r.x,r.y),new l.Z(r.x,r.bottom()-1)))),n.right()<this.stage.fresco.width+s&&n.right()>this.stage.fresco.width-s&&(t&&n.moveRight(this.stage.fresco.width),this.guides.push(new g.Z(new l.Z(r.right()-1,r.y),new l.Z(r.right()-1,r.bottom()-1)))),n.y<0+s&&n.y>0-s&&(t&&(n.y=0),this.guides.push(new g.Z(new l.Z(r.x,r.y),new l.Z(r.right()-1,r.y)))),n.bottom()<this.stage.fresco.height+s&&n.bottom()>this.stage.fresco.height-s&&(t&&n.moveBottom(this.stage.fresco.height),this.guides.push(new g.Z(new l.Z(r.x,r.bottom()-1),new l.Z(r.right()-1,r.bottom()-1))))}},this.choice=async()=>{const e=await new d.Z("Apply","Do you want to apply the transform?","Yes","No","Cancel").init();void 0!==e&&(e?this.apply():this.cancel())},this.apply=()=>{if(this.clone){if(!this.orgRect.equalTo(this.layer.rect)){const e=this.stage.fresco.getSelected(),t=r.dN(this.clone),s=e.rect.clone();return 0!==this.layer.rect.rotation&&(this.layer.rect=this.layer.rect.getRotatedBounds(),this.layer.canvas=r.zs(this.layer.canvas,this.layer.rect.rotation,this.layer.rect)),e.extendCanvas(this.layer.rect),this.layer.drawToLayer(e),this.stage.history.add({type:"bitmapSwitch",kind:"transform",layer:e,rect:s,canvas:t}),this.layer.render(),void this.callback(!0)}this.stage.fresco.getSelected().canvas=this.clone}else{if(this.layer.wouldApplyTransform()){const e=r.dN(this.layer.canvas),t=r.dN(this.layer.mask);this.layer.applyTransform(),this.stage.history.add({type:"arrange",kind:"transform",layer:this.layer,action:{type:"trans",data:e,mask:t,rect:this.orgRect}})}else this.layer.rect.x===this.orgRect.x&&this.layer.rect.y===this.orgRect.y||this.stage.history.add({type:"arrange",kind:"arrange",layer:this.layer,action:{type:"rect",rect:this.orgRect}})}this.callback()},this.cancel=()=>{this.clone&&(this.stage.fresco.getSelected().canvas=this.clone),this.layer.rect=this.orgRect,this.callback()},this.cleanUp=()=>{this.modal&&(this.ctx.clearRect(0,0,this.raster.width,this.raster.width),this.stage&&this.stage.fresco&&(this.stage.fresco.removeScratch(),window.requestAnimationFrame(this.stage.render)),this.stage.coating.wake(),this.modal.removeEventListener("touchstart",this.touchStart),this.modal.removeEventListener("mousedown",this.mouseDown,!1),this.modal.removeEventListener("touchmove",this.touchMove),this.modal.removeEventListener("mousemove",this.mouseMove,!1),this.modal.removeEventListener("touchend",this.touchEnd),this.modal.removeEventListener("mouseup",this.mouseUp,!1),this.modal.removeEventListener("mouseleave",this.mouseUp,!1),this.modal.removeEventListener("dblclick",this.choice,!1),this.modal.removeEventListener("wheel",this.stage.coating.mouseWheel),this.modal.removeEventListener("contextmenu",(e=>{e.preventDefault()}),!1),document.removeEventListener("keydown",this.keyDown,!1),document.removeEventListener("keyup",this.keyUp,!1),document.removeEventListener("viewport-render",this.render),(0,i.ZP)("transform-apply").removeEventListener("click",this.apply,!1),(0,i.ZP)("transform-cancel").removeEventListener("click",this.cancel,!1),(0,i.ZP)("transform-width").removeEventListener("input",this.inputSize,!1),(0,i.ZP)("transform-height").removeEventListener("input",this.inputSize,!1),(0,i.ZP)("transform-top").removeEventListener("input",this.inputPosition,!1),(0,i.ZP)("transform-left").removeEventListener("input",this.inputPosition,!1),this.rotation.cleanUp(),this.rotation=void 0,this.modal&&(this.modal.remove(),this.modal=void 0),this.options&&(this.options.remove(),this.options=void 0),this.layer=void 0,this.raster=void 0,this.stage=void 0,this.clone=void 0,this.ctx=void 0)},this.stage=e,this.callback=t,this.ctx=e.coating.ctx,this.raster=e.coating.raster,!this.stage.fresco.isSelectedImageWithCanvas())return void this.callback();const s=this.stage.fresco.getSelected();if(this.stage.fresco.hasSelection()){this.clone=r.dN(s.canvas);const[e,t]=this.stage.primeCut();if(!e)return void this.callback();this.stage.coating.sleep(),this.layer=this.stage.fresco.addScratch(),this.layer.setTarget(s.id,t,"over",e),this.orgRect=t.clone()}else this.layer=s,this.orgRect=this.layer.rect.clone();this.mid=Math.round(99999999999999*Math.random()).toString(),this.modal=(0,i.T)("div",{id:"modal-"+this.mid,className:"modal"}),(0,i.ZP)("workspace").appendChild(this.modal),this.options=(0,i.T)("div",{id:"transform",className:"option-float option active"},(0,i.T)("div",{className:"option-icon"},(0,i.T)("img",{src:"/img/tool/transform.svg",className:"ic"})),(0,i.T)("div",{id:"transform-settings"},(0,i.T)("label",{className:"tab-10"},"Left:"),(0,i.T)("input",{type:"number",id:"transform-left"}),(0,i.T)("label",{className:"tab-10"},"Top:"),(0,i.T)("input",{type:"number",id:"transform-top"}),(0,i.T)("label",{className:"tab-10"},"Width:"),(0,i.T)("input",{type:"number",id:"transform-width"}),(0,i.T)("label",{className:"tab-10"},"Height:"),(0,i.T)("input",{type:"number",id:"transform-height"}),(0,i.T)("div",{className:"tab-20 range-box",id:"transform-rotation"}),(0,i.T)("a",{className:"button outline tab-30",id:"transform-cancel"},"Cancel"),(0,i.T)("a",{className:"button outline tab-10",id:"transform-apply"},"Apply"))),(0,i.ZP)("workspace").appendChild(this.options),this.rotation=new p.Z("transform-rotation",{compact:!0,label:"Rotation:",step:.1,range:[0,360],labelFormat:e=>e.toFixed(1)+"",labelParse:e=>parseFloat(e),onChange:e=>{this.layer.rect.rotation=e,this.renderAll()},onEnd:e=>{this.updateInputs()}}),(0,i.ZP)("transform-apply").addEventListener("click",this.apply,!1),(0,i.ZP)("transform-cancel").addEventListener("click",this.cancel,!1),(0,i.ZP)("transform-width").addEventListener("input",this.inputSize,!1),(0,i.ZP)("transform-height").addEventListener("input",this.inputSize,!1),(0,i.ZP)("transform-top").addEventListener("input",this.inputPosition,!1),(0,i.ZP)("transform-left").addEventListener("input",this.inputPosition,!1),this.matrix=new v.Z,this.hitSize=this.stage.canTouch?32:16,this.modal.addEventListener("touchstart",this.touchStart,{passive:!1}),this.modal.addEventListener("mousedown",this.mouseDown,!1),this.modal.addEventListener("touchmove",this.touchMove,{passive:!1}),this.modal.addEventListener("mousemove",this.mouseMove,!1),this.modal.addEventListener("touchend",this.touchEnd,{passive:!1}),this.modal.addEventListener("mouseup",this.mouseUp,!1),this.modal.addEventListener("mouseleave",this.mouseUp,!1),this.modal.addEventListener("dblclick",this.choice,!1),this.modal.addEventListener("wheel",this.stage.coating.mouseWheel,{passive:!1}),this.modal.addEventListener("contextmenu",(e=>{e.preventDefault()}),!1),document.addEventListener("keydown",this.keyDown,!1),document.addEventListener("keyup",this.keyUp,!1),document.addEventListener("viewport-render",this.render),window.requestAnimationFrame(this.render),this.updateInputs()}}var y=s(6548),w=s(9924);class b{constructor(e){this.mode=void 0,this.moveLock="none",this.proxy=e=>{if("cut"===this.mode&&e.target!==this.stage.raster)return e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),void this.cleanCut()},this.contextMenu=e=>{e.preventDefault(),e.stopPropagation(),new w.C(new l.Z(e.clientX,e.clientY),[new w.Z((0,y.Z)("titleSelectAll"),(()=>{this.cleanCut(),this.stage.selectionAll()}),"Ctrl + A"),new w.Z((0,y.Z)("titleSelectPixels"),(()=>{this.cleanCut(),this.stage.selectionPixels()})),new w.Z((0,y.Z)("titleSelectDeselect"),(()=>{this.cleanCut(),this.stage.selectionDeselect()}),"Ctrl + D"),new w.Z((0,y.Z)("titleSelectInvert"),(()=>{this.cleanCut(),this.stage.selectionInvert()}),"Ctrl + I")])},this.keyDown=e=>{if(!this.isDown){if("cut"===this.mode){if(27===e.keyCode)return this.stage.fresco.selection.offset=new l.Z,this.stage.fresco.getSelected().canvas=this.clone,this.stage.fresco.removeScratch(),this.mode=void 0,void window.requestAnimationFrame((()=>{this.stage.coating.render(),this.stage.render()}));if(13===e.keyCode)return void this.cleanCut()}if(e.keyCode>=37&&e.keyCode<=40){if("cut"!==this.mode){this.mode=e.ctrlKey?"copy":"cut",this.clone="cut"===this.mode?r.dN(this.stage.fresco.getSelected().canvas):void 0;let[t,s]=this.stage.primeCut("cut"===this.mode);if(!t||!s)return void(this.mode=void 0);this.scratch=this.stage.fresco.addScratch(),this.scratch.setTarget(this.stage.fresco.getSelected().id,s,"over",t)}if(!this.scratch)return;let t=e.shiftKey?10:1,s=37===e.keyCode||39===e.keyCode?37===e.keyCode?-t:t:0,i=38===e.keyCode||40===e.keyCode?38===e.keyCode?-t:t:0;return this.stage.fresco.selection.offset.x+=s,this.scratch.rect.x+=s,this.stage.fresco.selection.offset.y+=i,this.scratch.rect.y+=i,void this.up()}"Shift"!==e.key?"Control"!==e.key||this.isCtrlDown||(this.isCtrlDown=!0,"move"!==this.stage.raster.style.cursor&&(this.stage.raster.style.cursor='url("/img/cursor/move-copy.svg") 2 2, auto')):this.isShiftDown=!0}},this.keyUp=e=>{"Shift"===e.key&&this.isShiftDown&&(this.isShiftDown=!1),"Control"===e.key&&this.isCtrlDown&&(this.isCtrlDown=!1,'url("/img/cursor/move-copy.svg") 2 2, auto'===this.stage.raster.style.cursor?this.stage.raster.style.cursor="url('/img/cursor/move-cut.svg') 2 2, auto":this.stage.raster.style.cursor="move")},this.touchStart=e=>{e.stopPropagation(),e.targetTouches.length>1||this.down(new l.Z(e.changedTouches[0].clientX-this.stage.raster.offsetLeft,e.changedTouches[0].clientY-this.stage.raster.offsetTop))},this.touchMove=e=>{e.stopPropagation(),e.targetTouches.length>1||this.move(new l.Z(e.changedTouches[0].clientX-this.stage.raster.offsetLeft,e.changedTouches[0].clientY-this.stage.raster.offsetTop))},this.touchEnd=e=>{e.stopPropagation(),e.targetTouches.length>1||this.up(new l.Z(e.changedTouches[0].clientX-this.stage.raster.offsetLeft,e.changedTouches[0].clientY-this.stage.raster.offsetTop))},this.mouseDown=e=>{e.stopPropagation(),this.stage.coating.override||(e.button>0?e.preventDefault():this.down(new l.Z(e.clientX-this.stage.raster.offsetLeft,e.clientY-this.stage.raster.offsetTop)))},this.mouseMove=e=>{e.stopPropagation();let t=new l.Z(e.clientX-this.stage.raster.offsetLeft,e.clientY-this.stage.raster.offsetTop);if(e.buttons||!this.isDown){if(!this.isDown){let e=this.stage.translateRasterToFresco(t).neg(this.stage.fresco.selection.offset);return this.stage.fresco.selection.isSelected(e)?void(this.isCtrlDown?this.stage.raster.style.cursor="url('/img/cursor/move-copy.svg') 2 2, auto":this.stage.raster.style.cursor="url('/img/cursor/move-cut.svg') 2 2, auto"):void(this.stage.raster.style.cursor="move")}this.move(t)}else this.mouseUp(e)},this.mouseUp=e=>{e.stopPropagation(),this.up(new l.Z(e.clientX-this.stage.raster.offsetLeft,e.clientY-this.stage.raster.offsetTop))},this.cleanCut=()=>{"cut"===this.mode&&(this.mode="copy",this.up())},this.cleanUp=()=>{var e;this.cleanCut(),null===(e=this.stage.fresco)||void 0===e||e.removeScratch(),this.stage.raster.style.cursor="unset",document.removeEventListener("keydown",this.keyDown,!1),document.removeEventListener("keyup",this.keyUp,!1),document.removeEventListener("mousedown",this.proxy,!0),this.stage.raster.removeEventListener("touchstart",this.touchStart,!1),this.stage.raster.removeEventListener("mousedown",this.mouseDown,!1),this.stage.raster.removeEventListener("mousemove",this.mouseMove,!1),this.stage.raster.removeEventListener("contextmenu",this.contextMenu,!0)},this.stage=e,document.addEventListener("keydown",this.keyDown,!1),document.addEventListener("keyup",this.keyUp,!1),document.addEventListener("mousedown",this.proxy,!0),this.stage.raster.addEventListener("touchstart",this.touchStart,{passive:!1}),this.stage.raster.addEventListener("mousedown",this.mouseDown,!1),this.stage.raster.addEventListener("mousemove",this.mouseMove,!1),this.stage.raster.addEventListener("contextmenu",this.contextMenu,!0),this.stage.raster.style.cursor="move"}down(e){if(!this.stage.fresco||!this.stage.fresco.selection)return;this.isDown=!0;let t=this.stage.translateRasterToFresco(e);if("cut"!==this.mode)if(this.stage.fresco.isSelectedImageWithCanvas()&&this.stage.fresco.selection.isSelected(t)){this.mode=this.isCtrlDown?"copy":"cut",this.clone="cut"===this.mode?r.dN(this.stage.fresco.getSelected().canvas):void 0;let[e,t]=this.stage.primeCut("cut"===this.mode);e&&t?(this.scratch=this.stage.fresco.addScratch(),this.scratch.setTarget(this.stage.fresco.getSelected().id,t,"over",e)):this.mode="move"}else this.mode="move";else if(!this.stage.fresco.selection.isSelected(t.neg(this.stage.fresco.selection.offset))||this.isCtrlDown)return this.cleanCut(),void this.down(e);this.downPoint=t,this.downOffset=this.stage.fresco.selection.offset.clone(),this.scratch&&(this.downPos=this.scratch.rect.topLeft()),this.stage.coating.freeze(!0),this.stage.raster.addEventListener("touchmove",this.touchMove,{passive:!1}),this.stage.raster.addEventListener("touchend",this.touchEnd,{passive:!1}),this.stage.raster.addEventListener("mouseup",this.mouseUp,!1)}move(e){if(e=this.stage.translateRasterToFresco(e),this.isShiftDown&&"none"===this.moveLock){const t=Math.abs(this.downPoint.x-e.x),s=Math.abs(this.downPoint.y-e.y);(t>4||s>4)&&(t<s?(e.x=this.downPoint.x,this.moveLock="vertical"):(e.y=this.downPoint.y,this.moveLock="horizontal"))}this.isShiftDown||(this.moveLock="none"),"vertical"!==this.moveLock&&(this.stage.fresco.selection.offset.x=this.downOffset.x+Math.round(e.x-this.downPoint.x),this.scratch&&(this.scratch.rect.x=this.downPos.x+Math.round(e.x-this.downPoint.x))),"horizontal"!==this.moveLock&&(this.stage.fresco.selection.offset.y=this.downOffset.y+Math.round(e.y-this.downPoint.y),this.scratch&&(this.scratch.rect.y=this.downPos.y+Math.round(e.y-this.downPoint.y))),window.requestAnimationFrame((()=>{this.stage.coating.render(),this.stage.render()}))}up(e){var t,s,i,a,n,o;if(this.isDown=!1,this.moveLock="none",this.stage.coating.freeze(!1),this.stage.raster.removeEventListener("touchmove",this.touchMove),this.stage.raster.removeEventListener("touchend",this.touchEnd),this.stage.raster.removeEventListener("mouseup",this.mouseUp,!1),"copy"===this.mode){if(0!==this.stage.fresco.selection.offset.x||0!==this.stage.fresco.selection.offset.y){const e=this.stage.fresco.getSelected(),a=e.rect.clone(),n=this.clone||r.dN(e.canvas);e.extendCanvas(this.scratch.rect),this.scratch.drawToLayer(e);let o=r.dN(null===(i=null===(s=null===(t=this.stage)||void 0===t?void 0:t.fresco)||void 0===s?void 0:s.selection)||void 0===i?void 0:i.mask);this.stage.fresco.selection.applyOffset(),e.render(),this.stage.history.add({type:"selectionAndBitmapSwitch",kind:this.clone?"cut":"copy",selection:o,layer:e,canvas:n,rect:a}),this.stage.fresco.selection.bounds||(this.stage.fresco.removeSelection(),document.dispatchEvent(new CustomEvent("select-tool",{detail:"arrange"}))),this.scratch.clear(),this.clone=void 0,this.mode=void 0}}else if("move"===this.mode){if(0!==this.stage.fresco.selection.offset.x||0!==this.stage.fresco.selection.offset.y){let e=r.dN(null===(o=null===(n=null===(a=this.stage)||void 0===a?void 0:a.fresco)||void 0===n?void 0:n.selection)||void 0===o?void 0:o.mask);this.stage.fresco.selection.applyOffset(),this.stage.fresco.selection.bounds?this.stage.history.add({type:"selectionChange",kind:"move",selection:e}):(this.stage.history.add({type:"selectionChange",kind:"deselect",selection:e}),this.stage.fresco.removeSelection(),document.dispatchEvent(new CustomEvent("select-tool",{detail:"arrange"})))}this.mode=void 0}window.requestAnimationFrame((()=>{this.stage.coating.render(),this.stage.render()}))}}var x=s(2282),Z=s(8829);class k extends Z.Z{constructor(e,t){super(t,(0,y.Z)("titleToolSettings")),this.cleanUp=()=>{this.superClean()},this.stage=e,this.setContent(`\n            <section>\n                <input type="checkbox" id="arrange-setting-auto-select" checked />\n                <label class="pad-10 switch" for="arrange-setting-auto-select">${(0,y.Z)("autoSelectLayer")}<span></span></label>\n                <input type="checkbox" id="arrange-setting-guides" checked />\n                <label class="pad-30 switch" for="arrange-setting-guides">${(0,y.Z)("showGuides")}<span></span></label>\n                <input type="checkbox" id="arrange-settings-snap-to" checked />\n                <label class="pad-10 switch" for="arrange-settings-snap-to">${(0,y.Z)("snapToGuides")}<span></span></label>\n                <input type="checkbox" id="settings-smooth" checked />\n                <label class="pad-10 switch" for="settings-smooth">${(0,y.Z)("viewOBarSmooth")}<span></span></label>\n            </section>\n        `);const s=(0,i.ZP)("arrange-setting-auto-select");s.checked=m.ZP.autoSelect,s.onchange=()=>(0,m.Lt)("autoSelect",s.checked);const a=(0,i.ZP)("arrange-setting-guides");a.checked=m.ZP.showGuides,a.onchange=()=>(0,m.Lt)("showGuides",a.checked);const n=(0,i.ZP)("arrange-settings-snap-to");n.checked=m.ZP.snapToGuides,n.onchange=()=>(0,m.Lt)("snapToGuides",n.checked);const o=(0,i.ZP)("settings-smooth");o.checked=m.ZP.smoothScaling,o.onchange=()=>(0,m.Lt)("smoothScaling",o.checked)}}class P extends a.Z{constructor(e,t){super("arrange",e),this.isShiftDown=!1,this.rasterize=()=>{this.stage.rasterize()},this.selectionTransform=()=>{this.mode="TRANSFORM",this.layerSelect()},this.selectionDistort=()=>{this.mode="DISTORT",this.layerSelect()},this.transformChange=e=>{var t;this.mode="ARRANGE",null===(t=this.transform)||void 0===t||t.cleanUp(),this.transform=void 0,e?this.stage.selectionDeselect():this.layerSelect()},this.distortChange=e=>{var t;this.mode="ARRANGE",null===(t=this.distort)||void 0===t||t.cleanUp(),this.distort=void 0,e?this.stage.selectionDeselect():this.layerSelect()},this.showSettings=()=>{new k(this.stage,(0,i.ZP)("arrange-tool-settings"))},this.showAnimation=()=>{document.dispatchEvent(new CustomEvent("panel-animation"))},this.toggleAspectMode=()=>{this.setAspectMode(!(0,i.ZP)("arrange-aspect-fixed").checked)},this.selectAspectMode=e=>{void 0!==e&&e.currentTarget.blur(),this.setAspectMode((0,i.ZP)("arrange-aspect-fixed").checked)},this.setAspectMode=e=>{this.reform&&(this.reform.constrain=e),(0,i.ZP)("arrange-aspect-fixed").checked=e,(0,i.ZP)("arrange-aspect-free").checked=!e,(0,i.ZP)("arrange-size-lock").style.display=e?"block":"none",(0,i.ZP)("arrange-size-vs").style.display=e?"none":"block"},this.shiftDown=e=>{"Shift"!==e.key||this.isShiftDown||(this.isShiftDown=!0,this.toggleAspectMode())},this.shiftUp=e=>{"Shift"===e.key&&(this.isShiftDown=!1,this.toggleAspectMode())},this.layerSelect=()=>{var e,t;if(!this.stage||!this.stage.fresco)return;let s=this.stage.fresco.getSelectedStackId();if(s!==this.currentId&&this.stage.history.commitTransaction(),this.currentId=s,null===(e=this.selectron)||void 0===e||e.cleanUp(),this.selectron=void 0,this.stage.fresco.hasSelection()&&"ARRANGE"===this.mode)return(0,i.ZP)("arrange-selection-locked").style.display="none",(0,i.ZP)("arrange-layer-locked").style.display="none",(0,i.ZP)("arrange-selection").style.display="none",(0,i.ZP)("arrange-settings").style.display="none",(0,i.ZP)("arrange-no-layer").style.display="none",null===(t=this.reform)||void 0===t||t.cleanUp(),this.reform=void 0,void(this.stage.fresco.isSelectedType(n.Z.TYPE_IMAGE)?((0,i.ZP)("arrange-selection").style.display="flex",this.selectron=new b(this.stage)):(0,i.ZP)("arrange-selection-locked").style.display="flex");if("DISTORT"===this.mode)return void(this.distort=new u(this.stage,this.distortChange));if("TRANSFORM"===this.mode)return void(this.transform=new f(this.stage,this.transformChange));this.reform||(this.reform=new o.Z(this.stage,"ARRANGE"));let a=this.stage.fresco.getSelectedStack();(0,i.ZP)("arrange-settings").style.display="none",(0,i.ZP)("arrange-layer-locked").style.display="none",(0,i.ZP)("arrange-no-layer").style.display="none",(0,i.ZP)("arrange-selection").style.display="none",(0,i.ZP)("arrange-selection-locked").style.display="none",(0,i.ZP)("arrange-rotate-left").style.display="inline-block",(0,i.ZP)("arrange-rotate-right").style.display="inline-block",(0,i.ZP)("arrange-flip-horizontal").style.display="inline-block",(0,i.ZP)("arrange-flip-vertical").style.display="inline-block",1===a.length&&a[0].rect&&a[0].rect.isSet()?(a[0].settings.locked?(0,i.ZP)("arrange-layer-locked").style.display="flex":(0,i.ZP)("arrange-settings").style.display="flex",a[0].type===n.Z.TYPE_TEXT?((0,i.ZP)("arrange-flip-horizontal").style.display="none",(0,i.ZP)("arrange-flip-vertical").style.display="none"):a[0].type===n.Z.TYPE_FRAME?((0,i.ZP)("arrange-rotate-left").style.display=a[0].editMode?"none":"inline-block",(0,i.ZP)("arrange-rotate-right").style.display=a[0].editMode?"none":"inline-block",(0,i.ZP)("arrange-flip-horizontal").style.display=a[0].editMode?"inline-block":"none",(0,i.ZP)("arrange-flip-vertical").style.display=a[0].editMode?"inline-block":"none"):a[0].type===n.Z.TYPE_SHAPE&&((0,i.ZP)("arrange-flip-horizontal").style.display="none",(0,i.ZP)("arrange-flip-vertical").style.display="none"),(0,i.ZP)("arrange-apect-holder").style.display=a[0].type===n.Z.TYPE_TEXT||a[0].editMode?"none":"flex",this.updateInputs()):a.length>1?((0,i.ZP)("arrange-settings").style.display="flex",(0,i.ZP)("arrange-layer-locked").style.display="none",(0,i.ZP)("arrange-apect-holder").style.display="none",(0,i.ZP)("arrange-rotate-left").style.display="none",(0,i.ZP)("arrange-rotate-right").style.display="none",(0,i.ZP)("arrange-flip-vertical").style.display="none",(0,i.ZP)("arrange-flip-horizontal").style.display="none",this.updateInputs()):((0,i.ZP)("arrange-layer-locked").style.display="none",(0,i.ZP)("arrange-settings").style.display="none",(0,i.ZP)("arrange-no-layer").style.display="flex"),this.reform&&(this.reform.constrain=(0,i.ZP)("arrange-aspect-fixed").checked)},this.unlock=()=>this.stage.changeLocked(void 0,!1),this.deleteLayer=()=>this.stage.deleteLayer(),this.duplicateLayer=()=>this.stage.duplicateLayer(),this.inputBegin=()=>{this.reform.beginHistory()},this.inputEnd=e=>{let t=e.target.id;const s="arrange-width"===t||"arrange-height"===t?"resize":"move";this.reform.commitHistory(s)},this.inputPosition=e=>{let t=Math.round(Number((0,i.ZP)("arrange-top").value)),s=Math.round(Number((0,i.ZP)("arrange-left").value));this.reform.inputPosition(s,t)},this.inputSize=e=>{if("arrange-width"==e.currentTarget.id){let e=(0,i.ZP)("arrange-width").value,t=NaN!=Number(e)?Math.round(Number(e)):50,s=this.reform.inputSize(t,void 0);(0,i.ZP)("arrange-height").value=Math.round(s.height).toString()}else{let e=(0,i.ZP)("arrange-height").value,t=NaN!=Number(e)?Math.round(Number(e)):50,s=this.reform.inputSize(void 0,t);(0,i.ZP)("arrange-width").value=Math.round(s.width).toString()}},this.updateInputs=()=>{let e=this.stage.fresco.getSelectedStackBounds();e&&((0,i.ZP)("arrange-width").value=Math.round(e.width).toString(),(0,i.ZP)("arrange-height").value=Math.round(e.height).toString(),(0,i.ZP)("arrange-top").value=Math.round(e.y).toString(),(0,i.ZP)("arrange-left").value=Math.round(e.x).toString())},this.rotateOrFlip=e=>{let t=this.stage.fresco.getSelected();if(!t)return;switch(e.currentTarget.getAttribute("id")){case"arrange-flip-vertical":this.stage.flipSelected(!0);break;case"arrange-flip-horizontal":this.stage.flipSelected(!1);break;case"arrange-rotate-left":if(t instanceof x.Z)this.stage.rotateSelected(!0);else{let e=t.rect.clone();t.rect.rotation+=-90,this.stage.history.add({type:"arrange",kind:"rotate",layer:t,action:{type:"rect",rect:e}})}break;case"arrange-rotate-right":if(t instanceof x.Z)this.stage.rotateSelected(!0);else{let e=t.rect.clone();t.rect.rotation+=90,this.stage.history.add({type:"arrange",kind:"rotate",layer:t,action:{type:"rect",rect:e}})}}document.dispatchEvent(new CustomEvent("viewport-render"))},this.cleanUp=()=>{var e,t,s;this.stage.history.commitTransaction(),null===(e=this.reform)||void 0===e||e.cleanUp(),this.reform=void 0,null===(t=this.selectron)||void 0===t||t.cleanUp(),this.selectron=void 0,null===(s=this.stage)||void 0===s||s.coating.wake(),document.removeEventListener("keydown",this.shiftDown,!1),document.removeEventListener("keyup",this.shiftUp,!1),document.removeEventListener("layer-select",this.layerSelect,!1),document.removeEventListener("layer-arrange",this.updateInputs,!1),(0,i.ZP)("arrange-tool-settings").removeEventListener("click",this.showSettings,!1),(0,i.ZP)("arrange-selection-transform").removeEventListener("click",this.selectionTransform,!1),(0,i.ZP)("arrange-selection-distort").removeEventListener("click",this.selectionDistort,!1),(0,i.ZP)("arrange-rasterize").removeEventListener("click",this.rasterize,!1),(0,i.ZP)("arrange-delete").removeEventListener("click",this.deleteLayer,!1),(0,i.ZP)("arrange-duplicate").removeEventListener("click",this.duplicateLayer,!1),(0,i.ZP)("arrange-duplicate-button").removeEventListener("click",this.duplicateLayer,!1),(0,i.ZP)("arrange-convert").removeEventListener("click",this.unlock,!1),(0,i.ZP)("arrange-animation").removeEventListener("click",this.showAnimation,!1),(0,i.ZP)("arrange-width").removeEventListener("input",this.inputSize,!1),(0,i.ZP)("arrange-height").removeEventListener("input",this.inputSize,!1),(0,i.ZP)("arrange-top").removeEventListener("input",this.inputPosition,!1),(0,i.ZP)("arrange-left").removeEventListener("input",this.inputPosition,!1),(0,i.ZP)("arrange-width").removeEventListener("focus",this.inputBegin,!1),(0,i.ZP)("arrange-height").removeEventListener("focus",this.inputBegin,!1),(0,i.ZP)("arrange-top").removeEventListener("focus",this.inputBegin,!1),(0,i.ZP)("arrange-left").removeEventListener("focus",this.inputBegin,!1),(0,i.ZP)("arrange-width").removeEventListener("blur",this.inputEnd,!1),(0,i.ZP)("arrange-height").removeEventListener("blur",this.inputEnd,!1),(0,i.ZP)("arrange-top").removeEventListener("blur",this.inputEnd,!1),(0,i.ZP)("arrange-left").removeEventListener("blur",this.inputEnd,!1),(0,i.ZP)("arrange-aspect-fixed").removeEventListener("click",this.selectAspectMode,!1),(0,i.ZP)("arrange-aspect-free").removeEventListener("click",this.selectAspectMode,!1),(0,i.ZP)("arrange-aspect-icon").removeEventListener("click",this.toggleAspectMode,!1);let a=(0,i.ZP)("arrange-rotate").getElementsByTagName("li");for(var n=0;n<a.length;n++)a[n].removeEventListener("click",this.rotateOrFlip,!1)},this.mode=t,document.addEventListener("keydown",this.shiftDown,!1),document.addEventListener("keyup",this.shiftUp,!1),document.addEventListener("layer-select",this.layerSelect,!1),document.addEventListener("layer-arrange",this.updateInputs,!1),(0,i.ZP)("arrange-convert").addEventListener("click",this.unlock,!1),(0,i.ZP)("arrange-width").addEventListener("input",this.inputSize,!1),(0,i.ZP)("arrange-height").addEventListener("input",this.inputSize,!1),(0,i.ZP)("arrange-top").addEventListener("input",this.inputPosition,!1),(0,i.ZP)("arrange-left").addEventListener("input",this.inputPosition,!1),(0,i.ZP)("arrange-width").addEventListener("focus",this.inputBegin,!1),(0,i.ZP)("arrange-height").addEventListener("focus",this.inputBegin,!1),(0,i.ZP)("arrange-top").addEventListener("focus",this.inputBegin,!1),(0,i.ZP)("arrange-left").addEventListener("focus",this.inputBegin,!1),(0,i.ZP)("arrange-width").addEventListener("blur",this.inputEnd,!1),(0,i.ZP)("arrange-height").addEventListener("blur",this.inputEnd,!1),(0,i.ZP)("arrange-top").addEventListener("blur",this.inputEnd,!1),(0,i.ZP)("arrange-left").addEventListener("blur",this.inputEnd,!1),(0,i.ZP)("arrange-delete").addEventListener("click",this.deleteLayer,!1),(0,i.ZP)("arrange-duplicate").addEventListener("click",this.duplicateLayer,!1),(0,i.ZP)("arrange-duplicate-button").addEventListener("click",this.duplicateLayer,!1),(0,i.ZP)("arrange-animation").addEventListener("click",this.showAnimation,!1),(0,i.ZP)("arrange-tool-settings").addEventListener("click",this.showSettings,!1),(0,i.ZP)("arrange-selection-transform").addEventListener("click",this.selectionTransform,!1),(0,i.ZP)("arrange-selection-distort").addEventListener("click",this.selectionDistort,!1),(0,i.ZP)("arrange-rasterize").addEventListener("click",this.rasterize,!1),(0,i.ZP)("arrange-aspect-fixed").addEventListener("click",this.selectAspectMode,!1),(0,i.ZP)("arrange-aspect-free").addEventListener("click",this.selectAspectMode,!1),(0,i.ZP)("arrange-aspect-icon").addEventListener("click",this.toggleAspectMode,!1);let s=(0,i.ZP)("arrange-rotate").getElementsByTagName("li");for(var a=0;a<s.length;a++)s[a].addEventListener("click",this.rotateOrFlip,!1);this.layerSelect(),this.selectAspectMode()}}},5752:(e,t,s)=>{s.d(t,{Z:()=>p});var i=s(3947),a=s(6548),n=s(3655),o=s(6817),r=s(8203),h=s(4188),l=s(2257),c=s(4170),d=s(1126),u=s(972);class p extends r.Z{constructor(e){super("clone",e),this.mode="source",this.layerSelect=()=>{const e=this.selected===this.stage.fresco.getSelected();if(!this.stage.fresco.isSelectedType(c.Z.TYPE_IMAGE))return(0,i.ZP)("clone-no-layer").style.display="flex",(0,i.ZP)("clone-settings").style.display="none",this.selected=null,void this.updateBrush();(0,i.ZP)("clone-settings").style.display="flex",(0,i.ZP)("clone-no-layer").style.display="none",this.selected=this.stage.fresco.getSelected(),this.scratch=this.stage.fresco.addScratch(),this.scratch.setTarget(this.selected.id,new o.Z(0,0,this.stage.fresco.width,this.stage.fresco.height),"over"),this.flat=this.stage.getOutputCanvas(),this.stage.fresco.hasSelection()&&this.scratch.addBake(),e||(this.alignChange(),this.updateBrush())},this.alignChange=()=>{this.source=void 0,this.setMode("source")},this.toggleMode=()=>{this.setMode("paint"===this.mode?"source":"paint")},this.selectMode=e=>{this.setMode(e.currentTarget===(0,i.ZP)("clone-mode-paint")?"paint":"source")},this.setMode=e=>{this.mode=e,(0,i.ZP)("clone-mode-paint").checked="paint"===this.mode,(0,i.ZP)("clone-mode-source").checked="source"===this.mode,this.updateBrush()},this.isShiftDown=!1,this.keyDown=e=>{if("Shift"===e.key&&!this.isShiftDown)return this.isShiftDown=!0,void this.toggleMode();switch(e.key){case",":e.shiftKey?this.brushPod.stepSoftness(.1):this.brushPod.stepSize(-10);break;case".":e.shiftKey?this.brushPod.stepSoftness(-.1):this.brushPod.stepSize(10)}},this.keyUp=e=>{"Shift"===e.key&&(this.isShiftDown=!1,this.toggleMode())},this.updateBrush=()=>{this.selected?this.stage.coating.setCursorImage("source"===this.mode?null:this.brush.getCursorImage(this.stage.zoom)):this.stage.coating.removeCursorImage()},this.down=(e,t)=>{if(this.selected)return"source"==this.mode?(this.source=this.stage.translateRasterToFresco(e),this.offset=void 0,void(this.isShiftDown||this.toggleMode())):void(this.source?(this.stage.coating.freeze(!0),(0,i.ZP)("workspace").appendChild(this.sourceMarker),(0,i.ZP)("clone-aligned").checked&&this.offset||(this.offset=this.stage.translateRasterToFresco(e),this.offset.x=this.offset.x-this.source.x,this.offset.y=this.offset.y-this.source.y),this.x=this.y=-1,this.scratch.settings.opacity=this.opacity.getValue(),this.useFlat=(0,i.ZP)("clone-sample-all").checked,"touch"!==t&&this.move(e),this.addMoveListeners()):document.dispatchEvent(new CustomEvent("notification",{detail:(0,a.Z)("selectSource")})))},this.x=-1,this.y=-1,this.move=e=>{let t=this.brush.getStep(),s=!1;if(this.sourceMarker.style.top=e.y-Math.round(this.offset.y*this.stage.zoom)+(this.stage.raster.offsetTop-16)+"px",this.sourceMarker.style.left=e.x-Math.round(this.offset.x*this.stage.zoom)+(this.stage.raster.offsetLeft-16)+"px",e=this.stage.translateRasterToFresco(e),-1==this.x&&(this.lx=e.x,this.ly=e.y,this.x=e.x,this.y=e.y,this.drawShape(this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),s=!0),e.x!==this.x||e.y!==this.y){let i=e.x-this.x,a=e.y-this.y,n=i>0?1:-1,o=a>0?1:-1;if(i=i<0?-i:i,a=a<0?-a:a,i>a){let e=.5*i;for(let r=1;r<=i;r++)this.x+=n,e+=a,e>=i&&(e-=i,this.y+=o),(this.x>this.lx+t||this.x<this.lx-t||this.y>this.ly+t||this.y<this.ly-t)&&(this.lx=this.x,this.ly=this.y,this.drawShape(this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),s=!0)}else{let e=.5*a;for(let r=1;r<=a;r++)this.y+=o,e+=i,e>=a&&(e-=a,this.x+=n),(this.x>this.lx+t||this.x<this.lx-t||this.y>this.ly+t||this.y<this.ly-t)&&(this.lx=this.x,this.ly=this.y,this.drawShape(this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),s=!0)}}s&&(this.scratch.applySelection(this.stage),window.requestAnimationFrame((()=>this.stage.render())))},this.drawShape=(e,t)=>{let s=this.getPatchContext(this.brush.canvas.width,this.brush.canvas.height);s.save();const i=this.selected.rect&&!this.useFlat?this.selected.rect.x:0,a=this.selected.rect&&!this.useFlat?this.selected.rect.y:0;s.drawImage(this.useFlat||!this.selected.canvas?this.flat:this.selected.canvas,-(e-this.offset.x-i),-(t-this.offset.y-a)),s.globalCompositeOperation="destination-in",s.drawImage(this.brush.canvas,0,0),s.restore(),this.scratch.ctx.drawImage(this.patch,e,t)},this.getPatchContext=(e,t)=>this.patch?(this.patch.width!==e||this.patch.height!==t?(this.patch.width=e,this.patch.height=t):this.ptx.clearRect(0,0,e,t),this.ptx):(this.patch=n.vL(e,t),this.ptx=this.patch.getContext("2d"),this.ptx),this.up=e=>{this.sourceMarker.remove(),this.stage.coating.freeze(!1),this.removeMoveListeners();let t=n.l(this.scratch.canvas);if(t&&t.width>0&&t.height>0){let e=this.selected.rect?n.$E(this.selected.canvas,t.rebase(this.selected.rect.x,this.selected.rect.y)):void 0;const s=n.dN(this.selected.mask),i=this.selected.rect?this.selected.rect.clone():void 0;this.selected.extendCanvas(t),this.scratch.drawToLayer(this.selected,"source-over",this.opacity.getValue()),this.scratch.clear(),this.selected.render(),this.stage.history.add({type:"bitmapChange",kind:"clone",layer:this.selected,patchRect:t.rebase(this.selected.rect.x,this.selected.rect.y),patch:e,rect:i,mask:s})}window.requestAnimationFrame((()=>this.stage.render()))},this.cleanUp=()=>{var e;null===(e=this.stage.fresco)||void 0===e||e.removeScratch(),this.sourceMarker.remove(),this.stage.coating.freeze(!1),this.removeMoveListeners(),this.removeDownListeners(),this.brushPod.cleanUp(),this.opacity.cleanUp(),document.removeEventListener("zoom-change",this.updateBrush,!1),document.removeEventListener("layer-select",this.layerSelect,!1),document.removeEventListener("keydown",this.keyDown,!1),document.removeEventListener("keyup",this.keyUp,!1),(0,i.ZP)("clone-mode-source").removeEventListener("click",this.selectMode,!1),(0,i.ZP)("clone-mode-paint").removeEventListener("click",this.selectMode,!1),(0,i.ZP)("clone-aligned").removeEventListener("change",this.alignChange,!1),this.selected=void 0,this.patch=void 0,this.flat=void 0,this.ptx=void 0},document.addEventListener("keydown",this.keyDown,!1),document.addEventListener("keyup",this.keyUp,!1),(0,i.ZP)("clone-mode-source").addEventListener("click",this.selectMode,!1),(0,i.ZP)("clone-mode-paint").addEventListener("click",this.selectMode,!1),document.addEventListener("layer-select",this.layerSelect,!1),document.addEventListener("zoom-change",this.updateBrush,!1),this.brush=new l.Z(new u.Z),this.brushPod=new d.Z(e,"clone-brush",this.brush,this.updateBrush),this.opacity=new h.Z("clone-opacity",{compact:!0,label:(0,a.Z)("opacity")+":",defaultValue:1,labelFormat:e=>(100*e).toFixed(0)+"%"}),(0,i.ZP)("clone-aligned").addEventListener("change",this.alignChange,!1),this.sourceMarker=document.createElement("img"),this.sourceMarker.src="/img/cursor/source.svg",this.sourceMarker.id="source-marker",this.addDownListeners(),this.setMode("source"),this.layerSelect()}}},6117:(e,t,s)=>{s.d(t,{Z:()=>d});var i=s(3947),a=s(6548),n=s(3655),o=s(9872),r=s(6817),h=s(8203),l=s(4188),c=s(3673);class d extends h.Z{constructor(e){super("crop",e),this.aspectX=0,this.aspectY=0,this.inputBlur=e=>{(0,i.ZP)("crop-width").value=Math.round(this.crop.width).toString(),(0,i.ZP)("crop-height").value=Math.round(this.crop.height).toString()},this.updateCrop=e=>{var t;this.applying||(this.crop=new r.Z(0,0,this.stage.fresco.width,this.stage.fresco.height),this.viewport=new r.Z(this.stage.offset.x,this.stage.offset.y,this.stage.canvas.width,this.stage.canvas.height),this.stage.fresco.lockedBackground()&&this.crop.equalTo(this.stage.fresco.layers[0].rect)?(this.stage.fresco.layers[0].rect.rotation=0,(0,i.ZP)("crop-straighten").style.display="block"):(0,i.ZP)("crop-straighten").style.display="none",(0,i.ZP)("crop-constraint-free").checked=!0,null===(t=this.straighten)||void 0===t||t.reset(),this.setConstraintMode(0,0),this.updateSizeInput(),this.render())},this.viewportChange=()=>{this.viewport=new r.Z(this.stage.offset.x,this.stage.offset.y,this.stage.canvas.width,this.stage.canvas.height),this.render()},this.reset=e=>{var t;null===(t=this.straighten)||void 0===t||t.reset(),this.stage.straighten(0),this.setConstraintMode(0,0),this.setAspect(0,0),this.refit(),document.dispatchEvent(new CustomEvent("notification",{detail:(0,a.Z)("reset")}))},this.setConstraintMode=(e,t)=>{if(0==e&&0==t)return(0,i.ZP)("crop-constraint-free").checked=!0,void((0,i.ZP)("crop-constraint-settings").style.display="none");if((0,i.ZP)("crop-constraint-ratio").checked=!0,0!==e){let e=(t,s)=>0==s?t:e(s,t%s),t=e(this.crop.width,this.crop.height);(0,i.ZP)("crop-constraint-width").value=(this.crop.width/t).toString(),(0,i.ZP)("crop-constraint-height").value=(this.crop.height/t).toString()}(0,i.ZP)("crop-constraint-preset").value="0:0"},this.constraintModeChange=e=>{let t=document.querySelector('input[name="crop-constraint-mode"]:checked').value;if("free"===t)return(0,i.ZP)("crop-constraint-settings").style.display="none",void this.setAspect(0,0);(0,i.ZP)("crop-constraint-settings").style.display="inline-flex";let s=Number((0,i.ZP)("crop-constraint-width").value),a=Number((0,i.ZP)("crop-constraint-height").value);"ratio"===t?((0,i.ZP)("crop-constraint-width").value="1",(0,i.ZP)("crop-constraint-height").value="1"):((0,i.ZP)("crop-constraint-width").value=(0,i.ZP)("crop-width").value,(0,i.ZP)("crop-constraint-height").value=(0,i.ZP)("crop-height").value),s=Number((0,i.ZP)("crop-constraint-width").value),a=Number((0,i.ZP)("crop-constraint-height").value),this.setAspect(s,a),(0,i.ZP)("crop-constraint-preset").value="0:0"},this.constraintPresetChange=e=>{let t=(0,i.ZP)("crop-constraint-preset").value.split(":");if("0"===t[0])return;if("x"===t[0]&&"y"===t[1]){let e=(t,s)=>0==s?t:e(s,t%s),s=e(this.stage.fresco.width,this.stage.fresco.height);t[0]=(this.stage.fresco.width/s).toString(),t[1]=(this.stage.fresco.height/s).toString()}let s=Number(t[0]),a=Number(t[1]);this.setAspect(s,a);let n="x"!==t[0]&&s>50;(0,i.ZP)("crop-constraint-size").checked=n,(0,i.ZP)("crop-constraint-ratio").checked=!n,(0,i.ZP)("crop-constraint-width").value=t[0],(0,i.ZP)("crop-constraint-height").value=t[1]},this.constraintWidthHeightInputChange=e=>{let t=(0,i.ZP)("crop-constraint-width").value,s=(0,i.ZP)("crop-constraint-height").value,a=NaN!=Number(t)?Number(t):1,n=NaN!=Number(s)?Number(s):1;this.setAspect(a,n)},this.setAspect=(e,t)=>{this.aspectX=e,this.aspectY=t,this.calculate(new c.Z(0,0),new c.Z(this.stage.fresco.width,this.stage.fresco.height)),this.crop.width<30&&(this.crop.width=30),this.crop.height<30&&(this.crop.height=30),this.crop.x+=Math.round((this.stage.fresco.width-this.crop.width)/2),this.crop.y+=Math.round((this.stage.fresco.height-this.crop.height)/2),this.updateSizeInput(),window.requestAnimationFrame(this.render)},this.widthHeightInputChange=e=>{let t=(0,i.ZP)("crop-width").value,s=(0,i.ZP)("crop-height").value,a=NaN!=Number(t)?Number(t):this.stage.fresco.width,n=NaN!=Number(s)?Number(s):this.stage.fresco.height,o=Math.round(30/this.stage.zoom);if(a<o?a=o:a>this.stage.fresco.width&&(a=this.stage.fresco.width),n<o?n=o:n>this.stage.fresco.height&&(n=this.stage.fresco.height),this.crop.width=a,this.crop.height=n,0!=this.aspectX){let t=e.currentTarget.getAttribute("id");"crop-width"==t?this.crop.height=this.stage.fresco.height:this.crop.width=this.stage.fresco.width,this.calculate(new c.Z(this.crop.x,this.crop.y),new c.Z(this.crop.right(),this.crop.bottom())),this.updateSizeInput("crop-width"==t,"crop-height"==t)}this.crop.right()>this.stage.fresco.width&&(this.crop.x=this.stage.fresco.width-this.crop.width),this.crop.bottom()>this.stage.fresco.height&&(this.crop.y=this.stage.fresco.height-this.crop.height),window.requestAnimationFrame(this.render)},this.updateSizeInput=(e,t)=>{e||((0,i.ZP)("crop-width").value=this.crop.width.toString()),t||((0,i.ZP)("crop-height").value=this.crop.height.toString())},this.down=e=>{this.p=this.stage.translateRasterToFresco(e),this.setCursor(this.p),this.updateSizeInput(),this.downTopLeft=this.crop.topLeft(),this.downBottomRight=this.crop.bottomRight(),this.raster.addEventListener("pointerup",this.pointerUp,!1),window.requestAnimationFrame(this.render)},this.move=e=>{e=this.stage.translateRasterToFresco(e),this.isDown?this.reform(this.p.x-e.x,this.p.y-e.y):this.setCursor(e)},this.up=e=>{this.raster.removeEventListener("pointerup",this.pointerUp,!1),window.requestAnimationFrame(this.render)},this.setCursor=e=>{let t=this.crop.width/6,s=this.crop.height/6;e.x<=this.crop.x+t?e.y<this.crop.y+s?this.method="nw-resize":e.y<this.crop.y+this.crop.height-s?this.method="w-resize":this.method="sw-resize":e.x>this.crop.x+t&&e.x<this.crop.x+this.crop.width-t?e.y<this.crop.y+s?this.method="n-resize":e.y<this.crop.y+this.crop.height-s?this.method="move":this.method="s-resize":e.y<this.crop.y+s?this.method="ne-resize":e.y<this.crop.y+this.crop.height-s?this.method="e-resize":this.method="se-resize",this.raster.style.cursor=this.method},this.refit=()=>{this.viewport=new r.Z(this.stage.offset.x,this.stage.offset.y,this.stage.canvas.width,this.stage.canvas.height);let e=Math.round(16/this.stage.zoom),t=new c.Z(this.crop.x,this.crop.y),s=new c.Z(this.crop.right(),this.crop.bottom());t.x<0&&(t.x=0),t.y<0&&(t.y=0),s.x>this.stage.fresco.width&&(s.x=this.stage.fresco.width),s.y>this.stage.fresco.height&&(s.y=this.stage.fresco.height),s.x<t.x+e&&(s.x=t.x+e),s.y<t.y+e&&(s.y=t.y+e),t.x>s.x-e&&(t.x=s.x-e),t.y>s.y-e&&(t.y=s.y-e),this.calculate(t,s),this.updateSizeInput(),this.render()},this.reform=(e,t)=>{if("move"==this.method)this.crop.x=this.downTopLeft.x-e,this.crop.y=this.downTopLeft.y-t,this.crop.x<0?this.crop.x=0:this.crop.right()>this.stage.fresco.width&&(this.crop.x=this.stage.fresco.width-this.crop.width),this.crop.y<0?this.crop.y=0:this.crop.bottom()>this.stage.fresco.height&&(this.crop.y=this.stage.fresco.height-this.crop.height);else{let s=this.downTopLeft.clone(),i=this.downBottomRight.clone();switch(this.method){case"w-resize":0!==this.aspectX&&(i.y=this.stage.fresco.height),s.x=this.downTopLeft.x-e;break;case"e-resize":0!==this.aspectX&&(i.y=this.stage.fresco.height),i.x=this.downBottomRight.x-e;break;case"n-resize":0!==this.aspectX&&(i.x=this.stage.fresco.width),s.y=this.downTopLeft.y-t;break;case"s-resize":0!==this.aspectX&&(i.x=this.stage.fresco.width),i.y=this.downBottomRight.y-t;break;case"nw-resize":s.x=this.downTopLeft.x-e,s.y=this.downTopLeft.y-t;break;case"ne-resize":s.y=this.downTopLeft.y-t,i.x=this.downBottomRight.x-e;break;case"sw-resize":s.x=this.downTopLeft.x-e,i.y=this.downBottomRight.y-t;break;case"se-resize":i.x=this.downBottomRight.x-e,i.y=this.downBottomRight.y-t}let a=Math.round(30/this.stage.zoom);s.x!=this.downTopLeft.x&&(s.x<0?s.x=0:s.x>i.x-a&&(s.x=i.x-a)),s.y!=this.downTopLeft.y&&(s.y<0?s.y=0:s.y>i.y-a&&(s.y=i.y-a)),i.x!=this.downBottomRight.x&&(i.x>this.stage.fresco.width?i.x=this.stage.fresco.width:i.x<s.x+a&&(i.x=s.x+a)),i.y!=this.downBottomRight.y&&(i.y>this.stage.fresco.height?i.y=this.stage.fresco.height:i.y<s.y+a&&(i.y=s.y+a)),this.calculate(s,i,this.downTopLeft),this.updateSizeInput()}window.requestAnimationFrame(this.render)},this.render=()=>{let e=this.crop.scale(this.stage.zoom);e.x+=this.viewport.x,e.y+=this.viewport.y;let t=e.width<200||e.height<200?15:30;if(this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.straightenIsDown){this.ctx.lineWidth=1,this.ctx.fillStyle=n.wf,this.ctx.translate(.5,.5),this.ctx.beginPath();let e=new c.Z(Math.round(this.raster.width/2),Math.round(this.raster.height/2));this.ctx.moveTo(this.viewport.x,e.y),this.ctx.lineTo(this.viewport.right()-1,e.y),this.ctx.moveTo(e.x,this.viewport.y),this.ctx.lineTo(e.x,this.viewport.bottom()-1),this.ctx.strokeStyle="rgba(255,255,255,.5)";let t=0,s=e.x;for(;s>this.viewport.x;)t%5==0?(this.ctx.moveTo(s,this.viewport.y),this.ctx.lineTo(s,this.viewport.bottom()-1),this.ctx.moveTo(e.x+e.x-s,this.viewport.y),this.ctx.lineTo(e.x+e.x-s,this.viewport.bottom()-1)):(this.ctx.moveTo(s,e.y-3),this.ctx.lineTo(s,e.y+3),this.ctx.moveTo(e.x+e.x-s,e.y-3),this.ctx.lineTo(e.x+e.x-s,e.y+3)),s-=30,t++;t=0;let i=e.y;for(;i>this.viewport.y;)t%5==0?(this.ctx.moveTo(this.viewport.x,i),this.ctx.lineTo(this.viewport.right()-1,i),this.ctx.moveTo(this.viewport.x,e.y+e.y-i),this.ctx.lineTo(this.viewport.right()-1,e.y+e.y-i)):(this.ctx.moveTo(e.x-3,i),this.ctx.lineTo(e.x+3,i),this.ctx.moveTo(e.x-3,e.y+e.y-i),this.ctx.lineTo(e.x+3,e.y+e.y-i)),i-=30,t++;this.ctx.stroke(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.beginPath(),this.ctx.arc(e.x,e.y,50,0,2*Math.PI),this.ctx.arc(e.x,e.y,300,0,2*Math.PI),this.ctx.stroke()}else{if(this.ctx.fillStyle="rgba(0,0,0,0.5)",this.ctx.fillRect(this.viewport.x<0?0:this.viewport.x,this.viewport.y<0?0:this.viewport.y,this.viewport.width,this.viewport.height),this.ctx.clearRect(e.x,e.y,e.width,e.height),this.ctx.lineWidth=1,this.ctx.fillStyle=n.wf,this.ctx.translate(.5,.5),this.ctx.strokeStyle="rgb(0,0,0)",this.ctx.strokeRect(e.x,e.y,e.width-1,e.height-1),this.ctx.strokeStyle=n.wf,this.ctx.strokeRect(e.x-1,e.y-1,e.width+1,e.height+1),this.isDown){let t=Math.round(e.width/3),s=Math.round(e.height/3);this.ctx.strokeStyle="rgba(255,255,255,.5)",this.ctx.beginPath(),this.ctx.moveTo(e.x+t,e.y),this.ctx.lineTo(e.x+t,e.bottom()),this.ctx.moveTo(e.x+2*t,e.y),this.ctx.lineTo(e.x+2*t,e.bottom()),this.ctx.moveTo(e.x,e.y+s),this.ctx.lineTo(e.right(),e.y+s),this.ctx.moveTo(e.x,e.y+2*s),this.ctx.lineTo(e.right(),e.y+2*s),this.ctx.stroke()}this.ctx.setTransform(1,0,0,1,0,0),this.ctx.fillRect(e.x-3,e.y-3,t,3),this.ctx.fillRect(e.x-3,e.y,3,t-3),this.ctx.fillRect(e.x-3,e.y+e.height,t,3),this.ctx.fillRect(e.x-3,e.y+e.height-t+3,3,t-3),this.ctx.fillRect(e.x+e.width-t+3,e.y-3,t,3),this.ctx.fillRect(e.x+e.width,e.y,3,t-3),this.ctx.fillRect(e.x+e.width-t+3,e.y+e.height,t,3),this.ctx.fillRect(e.x+e.width,e.y+e.height-t+3,3,t-3),this.ctx.fillRect(Math.floor(e.x+e.width/2-t),e.y-3,2*t,3),this.ctx.fillRect(Math.floor(e.x+e.width/2-t),e.y+e.height,2*t,3),this.ctx.fillRect(e.x-3,e.y+e.height/2-t,3,2*t),this.ctx.fillRect(e.x+e.width,e.y+e.height/2-t,3,2*t)}},this.dblClick=()=>{this.setAspect(this.aspectY,this.aspectX)},this.apply=()=>{document.dispatchEvent(new CustomEvent("select-tool"))},this.cleanUp=()=>{var e;this.removeDownListeners(),this.applying=!0;const t=this.stage.fresco.lockedBackground()&&0!==this.stage.fresco.layers[0].rect.rotation;if(!this.crop.equalTo(new r.Z(0,0,this.stage.fresco.width,this.stage.fresco.height))||t){let e,s=new o.Z(this.stage.fresco.width,this.stage.fresco.height),i=new c.Z(-this.crop.x,-this.crop.y);if(t){const t=this.stage.fresco.layers[0];e=n.dN(t.canvas),s=new o.Z(t.canvas.width,t.canvas.height),i.x+=-t.rect.x,i.y+=-t.rect.y,t.applyStraighten(new r.Z(0,0,this.stage.fresco.width,this.stage.fresco.height))}this.stage.fresco.crop(this.crop),this.stage.history.add({type:"crop",offset:i,size:s,straighten:e})}if("size"===document.querySelector('input[name="crop-constraint-mode"]:checked').value){const e=Number((0,i.ZP)("crop-constraint-width").value),t=Number((0,i.ZP)("crop-constraint-height").value),s=new o.Z(this.stage.fresco.width,this.stage.fresco.height);if(s.width!==e||s.height!==t){const i=this.stage.fresco.layers.map((e=>e.clone()));this.stage.fresco.resize(e,t,!0),this.stage.history.add({type:"pageResize",size:s,layers:i})}}document.removeEventListener("history-update",this.updateCrop,!1),document.removeEventListener("viewport-render",this.viewportChange,!1),this.raster.removeEventListener("pointermove",this.pointerMove,!1),this.raster.removeEventListener("dblclick",this.dblClick,!1);const s=(0,i.ZP)("crop-width");s.removeEventListener("input",this.widthHeightInputChange,!1),s.removeEventListener("blur",this.inputBlur,!1);const a=(0,i.ZP)("crop-height");a.removeEventListener("input",this.widthHeightInputChange,!1),a.removeEventListener("blur",this.inputBlur,!1);const h=(0,i.ZP)("crop-constraint-width");h.removeEventListener("input",this.constraintWidthHeightInputChange,!1),h.removeEventListener("blur",this.inputBlur,!1);const l=(0,i.ZP)("crop-constraint-height");l.removeEventListener("input",this.constraintWidthHeightInputChange,!1),l.removeEventListener("blur",this.inputBlur,!1),null===(e=this.straighten)||void 0===e||e.cleanUp(),(0,i.ZP)("crop-constraint-preset").removeEventListener("change",this.constraintPresetChange,!1),(0,i.ZP)("crop-constraint-free").removeEventListener("click",this.constraintModeChange,!1),(0,i.ZP)("crop-constraint-size").removeEventListener("click",this.constraintModeChange,!1),(0,i.ZP)("crop-constraint-ratio").removeEventListener("click",this.constraintModeChange,!1),(0,i.ZP)("crop-reset").removeEventListener("click",this.reset,!1),(0,i.ZP)("crop-apply").removeEventListener("click",this.apply,!1),this.ctx.clearRect(0,0,this.raster.width,this.raster.height),this.viewport=null,this.ctx=null,this.stage.updateViewport(),this.stage.coating.wake()},this.raster=e.raster,this.stage.selectionDeselect(),this.stage.coating.sleep(),this.ctx=this.raster.getContext("2d"),this.ctx.imageSmoothingEnabled=!1,document.addEventListener("history-update",this.updateCrop,!1),document.addEventListener("viewport-render",this.viewportChange,!1),this.raster.addEventListener("pointermove",this.pointerMove,!1),this.raster.addEventListener("dblclick",this.dblClick,!1);const t=(0,i.ZP)("crop-width");t.addEventListener("input",this.widthHeightInputChange,!1),t.addEventListener("blur",this.inputBlur,!1);const s=(0,i.ZP)("crop-height");s.addEventListener("input",this.widthHeightInputChange,!1),s.addEventListener("blur",this.inputBlur,!1);const h=(0,i.ZP)("crop-constraint-width");h.addEventListener("input",this.constraintWidthHeightInputChange,!1),h.addEventListener("blur",this.inputBlur,!1);const d=(0,i.ZP)("crop-constraint-height");d.addEventListener("input",this.constraintWidthHeightInputChange,!1),d.addEventListener("blur",this.inputBlur,!1),this.straighten=new l.Z("crop-straighten",{range:[-25,25],step:.25,label:(0,a.Z)("straighten")+":",compact:!0,force:!0,labelFormat:e=>e.toFixed(1)+"",labelParse:e=>parseFloat(e),onChange:e=>{this.stage.straighten(e),this.calculate(new c.Z(0,0),new c.Z(this.stage.fresco.width,this.stage.fresco.height)),this.refit()},onStart:()=>{this.straightenIsDown=!0,this.render()},onEnd:(e,t)=>{this.straightenIsDown=!1,this.refit(),this.render()}}),(0,i.ZP)("crop-constraint-preset").addEventListener("change",this.constraintPresetChange,!1),(0,i.ZP)("crop-constraint-free").addEventListener("click",this.constraintModeChange,!1),(0,i.ZP)("crop-constraint-size").addEventListener("click",this.constraintModeChange,!1),(0,i.ZP)("crop-constraint-ratio").addEventListener("click",this.constraintModeChange,!1),(0,i.ZP)("crop-reset").addEventListener("click",this.reset,!1),(0,i.ZP)("crop-apply").addEventListener("click",this.apply,!1),this.addDownListeners(),this.updateCrop()}calculate(e,t,s){if(this.crop.x=Math.round(e.x<t.x?e.x:t.x),this.crop.y=Math.round(e.y<t.y?e.y:t.y),this.crop.width=Math.round(e.x<t.x?t.x-this.crop.x:e.x-this.crop.x),this.crop.height=Math.round(e.y<t.y?t.y-this.crop.y:e.y-this.crop.y),0!=this.aspectX&&0!=this.aspectY){let t=this.crop.height,i=this.crop.width;this.aspectY/this.aspectX*(this.crop.width/this.crop.height)<this.aspectX/this.aspectY*(this.crop.height/this.crop.width)?this.crop.height=Math.round(this.crop.width*(this.aspectY/this.aspectX)):this.crop.width=Math.round(this.crop.height*(this.aspectX/this.aspectY)),s&&(s.x!=e.x&&(this.crop.x+=Math.round(i-this.crop.width)),s.y!=e.y&&(this.crop.y+=Math.round(t-this.crop.height)))}}}},7764:(e,t,s)=>{s.d(t,{Z:()=>Z});var i=s(3947),a=s(6548),n=s(3655),o=s(3347),r=s(7359),h=s(8203),l=s(4188),c=s(8776),d=s(3673),u=s(2257),p=s(4820),g=s(5131),m=s(4256),v=s(7175),f=s(1126),y=s(4754),w=s(972),b=s(1951),x=s(9924);class Z extends h.Z{constructor(e){super("cutout",e),this.type="",this.mode="remove",this.isShiftDown=!1,this.more=e=>{e.preventDefault(),e.stopPropagation(),this.showContextMenu(new d.Z(e.clientX,e.clientY),!0)},this.contextMenu=e=>{e.preventDefault(),e.stopPropagation(),this.showContextMenu(new d.Z(e.clientX,e.clientY),!1)},this.showContextMenu=(e,t)=>{if(!this.selected)return;const s=this.selected.hasMask();new x.C(e,[new x.Z((0,a.Z)("titleLayerInvertMask"),s?()=>this.stage.maskInvert():void 0),new x.Z((0,a.Z)("titleLayerExtractMask"),s?()=>this.stage.maskExtract():void 0),new x.Z((0,a.Z)("titleLayerConvertMask"),s?()=>this.stage.maskConvert():void 0),new x.Z,new x.Z((0,a.Z)("titleLayerApplyMask"),s?()=>this.stage.maskApply():void 0),new x.Z((0,a.Z)("titleLayerResetMask"),s?()=>this.stage.maskDelete():void 0)],t)},this.layerSelect=()=>{if(!this.stage.fresco.isSelectedImageWithCanvas())return(0,i.ZP)("cutout-no-layer").style.display="flex",(0,i.ZP)("cutout-sub-tools").style.display="none",void(this.selected=null);(0,i.ZP)("cutout-sub-tools").style.display="flex",(0,i.ZP)("cutout-no-layer").style.display="none",this.selected=this.stage.fresco.getSelected(),this.scratch=this.stage.fresco.addScratch(),this.scratch.setTarget(this.selected.id,this.selected.rect,"over"),"draw"===this.type&&this.updateBrush(),this.renderMask()},this.selectType=e=>{this.setType(e.currentTarget.value)},this.setType=e=>{e!==this.type&&(""!==this.type&&((0,i.ZP)("cutout-"+this.type+"-settings").style.display="none"),(0,i.ZP)("cutout-"+e+"-settings").style.display="inline-flex",this.type=e,this.selected&&!this.selected.hasMask()&&("shape"===this.type?this.setMode("keep"):this.setMode("remove")),this.selected?"draw"===this.type?this.updateBrush():(this.stage.coating.removeCursorImage(),this.stage.raster.style.cursor="crosshair"):this.stage.raster.style.cursor="auto")},this.toggleMode=()=>{this.setMode("keep"===this.mode?"remove":"keep")},this.selectMode=e=>{this.setMode(e.currentTarget===(0,i.ZP)("cutout-mode-remove")?"remove":"keep")},this.setMode=e=>{if(this.mode=e,(0,i.ZP)("cutout-mode-remove").checked="remove"===this.mode,(0,i.ZP)("cutout-mode-keep").checked="keep"===this.mode,"draw"===this.type)this.updateBrush()},this.zoomChange=()=>{if("draw"===this.type)this.updateBrush()},this.keyDown=e=>{switch("Shift"!==e.key||this.isShiftDown||(this.isShiftDown=!0,this.toggleMode()),e.key){case",":e.shiftKey?this.brushPod.stepSoftness(.1):this.brushPod.stepSize(-10);break;case".":e.shiftKey?this.brushPod.stepSoftness(-.1):this.brushPod.stepSize(10)}},this.keyUp=e=>{"Shift"===e.key&&(this.isShiftDown=!1,this.toggleMode())},this.down=e=>{if(this.selected)if(this.downPoint=e,"magic"!==this.type){switch(this.type){case"draw":this.downDraw(e);break;case"lasso":this.downLasso(e);break;case"shape":this.downShape(e);break;case"gradient":this.downGradient(e)}this.addMoveListeners()}else this.applyMagic(e)},this.move=e=>{switch(this.type){case"shape":this.moveShape(e);break;case"draw":this.moveDraw(e);break;case"lasso":this.moveLasso(e);break;case"gradient":this.moveGradient(e)}},this.up=e=>{switch(this.removeMoveListeners(),this.type){case"shape":this.applyShape(this.stage.translateRasterToFresco(this.downPoint,this.selected.rect),this.stage.translateRasterToFresco(e,this.selected.rect));break;case"draw":this.applyDraw();break;case"lasso":this.applyLasso();break;case"gradient":this.applyGradient(this.stage.translateRasterToFresco(this.downPoint,this.selected.rect),this.stage.translateRasterToFresco(e,this.selected.rect))}},this.applyMagic=e=>{if((e=this.stage.translateRasterToFresco(e,this.selected.rect)).x<0||e.y<0||e.x>this.selected.canvas.width||e.y>this.selected.canvas.height)return;const t=this.prepareMask();let s=this.magicFeather.getValue(),a=this.selected.canvas.getContext("2d").getImageData(e.x,e.y,1,1).data,n=new c.Z(a[0],a[1],a[2],a[3]);if(0===n.a&&"remove"===this.mode&&0===s)return;let o=100*this.magicTolerance.getValue(),r=(this.selected.baked&&"remove"===this.mode?this.selected.baked:this.selected.canvas).getContext("2d").getImageData(0,0,this.selected.canvas.width,this.selected.canvas.height);this.cpx=new Uint32Array(r.data.buffer);let h=this.scratch.ctx.getImageData(0,0,this.scratch.canvas.width,this.scratch.canvas.height);this.mpx=new Uint32Array(h.data.buffer),(0,i.ZP)("cutout-magic-contiguous").checked?this.floodFill(e,n,o,0!==s):this.allFill(n,o),this.scratch.ctx.putImageData(h,0,0),h=null,r=null,this.cpx=null,this.mpx=null,this.drawToMask(t,this.magicFeather.getValue())},this.updateBrush=()=>{this.brush.generate("keep"===this.mode?new c.Z(0,255,0,255):new c.Z(255,0,0,255)),this.selected?this.stage.coating.setCursorImage(this.brush.getCursorImage(this.stage.zoom)):this.stage.coating.removeCursorImage()},this.downDraw=e=>{this.x=this.y=-1,this.scratch.settings.opacity=.4,this.moveDraw(e)},this.x=-1,this.y=-1,this.moveDraw=e=>{let t=this.brush.getStep(),s=!1;if(e=this.stage.translateRasterToFresco(e,this.selected.rect),-1===this.x&&(this.lx=e.x,this.ly=e.y,this.x=e.x,this.y=e.y,this.scratch.ctx.drawImage(this.brush.canvas,this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),s=!0),e.x!==this.x||e.y!==this.y){let i=e.x-this.x,a=e.y-this.y,n=i>0?1:-1,o=a>0?1:-1;if(i=i<0?-i:i,a=a<0?-a:a,i>a){let e=.5*i;for(let r=1;r<=i;r++)this.x+=n,e+=a,e>=i&&(e-=i,this.y+=o),(this.x>this.lx+t||this.x<this.lx-t||this.y>this.ly+t||this.y<this.ly-t)&&(this.scratch.ctx.drawImage(this.brush.canvas,this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),this.lx=this.x,this.ly=this.y,s=!0)}else{let e=.5*a;for(let r=1;r<=a;r++)this.y+=o,e+=i,e>=a&&(e-=a,this.x+=n),(this.x>this.lx+t||this.x<this.lx-t||this.y>this.ly+t||this.y<this.ly-t)&&(this.scratch.ctx.drawImage(this.brush.canvas,this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),this.lx=this.x,this.ly=this.y,s=!0)}}s&&window.requestAnimationFrame((()=>this.stage.render()))},this.applyDraw=()=>{const e=this.prepareMask();this.drawToMask(e,0,this.drawOpacity.getValue())},this.downLasso=e=>{this.points=[]},this.moveLasso=e=>{this.rasterctx.save(),this.points.push(e),this.stage.raster.style.opacity="0.6",this.rasterctx.clearRect(0,0,this.stage.raster.width,this.stage.raster.height),this.rasterctx.strokeStyle="keep"===this.mode?"#00ff00":"#ff0000",this.rasterctx.lineWidth=2,this.rasterctx.lineCap="round",this.rasterctx.setLineDash([6]),this.rasterctx.beginPath(),this.rasterctx.moveTo(this.points[0].x,this.points[0].y),this.points.forEach((e=>{this.rasterctx.lineTo(e.x,e.y)})),this.rasterctx.stroke(),this.rasterctx.restore()},this.applyLasso=()=>{if(this.stage.raster.style.opacity="1",this.rasterctx.clearRect(0,0,this.stage.raster.width,this.stage.raster.height),this.points.length<2)return;const e=this.points.map((e=>this.stage.translateRasterToFresco(e,this.selected.rect))),t=this.prepareMask();this.scratch.ctx.beginPath(),this.scratch.ctx.moveTo(e[0].x,e[0].y),e.forEach((e=>this.scratch.ctx.lineTo(e.x,e.y))),this.scratch.ctx.fill(),this.drawToMask(t,this.lassoFeather.getValue())},this.downShape=e=>{this.shapeType=document.querySelector('input[name="cutout-shape-type"]:checked').value},this.moveShape=e=>{switch(this.rasterctx.save(),this.stage.raster.style.opacity="0.6",this.rasterctx.clearRect(0,0,this.stage.raster.width,this.stage.raster.height),this.rasterctx.strokeStyle="keep"===this.mode?"#00ff00":"#ff0000",this.rasterctx.lineWidth=2,this.shapeType){case"rectangle":this.rasterctx.setLineDash([6]),this.rasterctx.strokeRect(this.downPoint.x,this.downPoint.y,e.x-this.downPoint.x,e.y-this.downPoint.y);break;case"ellipse":this.rasterctx.setLineDash([6]),v.Z.ellipse(this.rasterctx,this.downPoint,e),this.rasterctx.stroke();break;case"line":this.rasterctx.lineWidth=4,v.Z.line(this.rasterctx,this.downPoint,e),this.rasterctx.stroke()}this.rasterctx.restore()},this.applyShape=(e,t)=>{if(e.x===t.x&&e.y===t.y)return;this.stage.raster.style.opacity="1",this.rasterctx.clearRect(0,0,this.stage.raster.width,this.stage.raster.height);const s=this.prepareMask();switch(this.shapeType){case"rectangle":this.scratch.ctx.fillRect(e.x,e.y,t.x-e.x,t.y-e.y);break;case"ellipse":v.Z.ellipse(this.scratch.ctx,e,t),this.scratch.ctx.fill();break;case"line":this.scratch.ctx.lineWidth=4/this.stage.zoom,v.Z.line(this.scratch.ctx,e,t),this.scratch.ctx.stroke()}this.drawToMask(s,this.shapeFeather.getValue())},this.downGradient=e=>{this.stage.coating.ctx.strokeStyle=n.wf,this.stage.coating.ctx.fillStyle=n.xZ},this.moveGradient=e=>{window.requestAnimationFrame((()=>{this.downPoint&&(this.stage.coating.clear(!0),this.stage.coating.ctx.lineWidth=2,v.Z.line(this.stage.coating.ctx,this.downPoint,e),this.stage.coating.ctx.stroke(),v.Z.arc(this.stage.coating.ctx,this.downPoint,6),this.stage.coating.ctx.fill(),this.stage.coating.ctx.stroke(),v.Z.arc(this.stage.coating.ctx,e,6),this.stage.coating.ctx.fill(),this.stage.coating.ctx.stroke(),this.stage.coating.ctx.lineWidth=1,this.stage.coating.render())}))},this.applyGradient=(e,t)=>{if(this.rasterctx.clearRect(0,0,this.stage.raster.width,this.stage.raster.height),this.stage.coating.ctx.clearRect(0,0,this.stage.raster.width,this.stage.raster.height),e.x===t.x&&e.y===t.y)return;let s,i=document.querySelector('input[name="cutout-gradient-type"]:checked').value;if(this.scratch.clear(),this.scratch.ctx.save(),"radial"===i){const i=e.x-t.x,a=e.y-t.y;s=this.scratch.ctx.createRadialGradient(e.x,e.y,0,e.x,e.y,Math.sqrt(i*i+a*a))}else s=this.scratch.ctx.createLinearGradient(e.x,e.y,t.x,t.y);this.gradPod.grad.addStopToCanvasGradient(s,"remove"===this.mode),this.scratch.ctx.fillStyle=s,this.scratch.ctx.fillRect(0,0,this.scratch.canvas.width,this.scratch.canvas.height),this.scratch.ctx.restore();const a=this.prepareMask();this.drawToMask(a,0)},this.prepareMask=()=>{let e=!1;if(!this.selected.hasMask()&&(this.selected.addMask(),e=!0,"remove"===this.mode)){this.selected.mask.getContext("2d").fillRect(0,0,this.selected.mask.width,this.selected.mask.height)}return e},this.renderMask=()=>{this.selected.hasMask()&&(this.selected.render(),(0,i.ZP)("cutout-show-ghost").checked&&this.renderGhost(),this.stage.render())},this.renderGhost=()=>{if(this.selected.hasMask()){var e=this.selected.baked.getContext("2d");e.save(),e.globalAlpha=.33,e.drawImage(this.selected.canvas,0,0),e.restore(),e=null}},this.auto=e=>{this.selected&&(p.ZP.user.subscription?new y.Z(this.stage):new b.Z(this.stage,"CUTOUT"))},this.cleanUp=()=>{var e;this.stage.coating.freeze(!1),null===(e=this.stage.fresco)||void 0===e||e.removeScratch(),this.removeDownListeners(),(0,i.ZP)("cutout-show-ghost").checked&&(this.selected.render(),this.stage.render()),this.brushPod.cleanUp(),this.drawOpacity.cleanUp(),this.magicFeather.cleanUp(),this.shapeFeather.cleanUp(),this.lassoFeather.cleanUp(),this.magicTolerance.cleanUp(),document.removeEventListener("keydown",this.keyDown,!1),document.removeEventListener("keyup",this.keyUp,!1),document.removeEventListener("zoom-change",this.zoomChange,!1),document.removeEventListener("layer-select",this.layerSelect,!1),p.ZP.user.subscription&&"premium"!==p.ZP.user.subscriptionType&&(0,i.ZP)("cutout-auto").removeEventListener("click",this.auto,!1),(0,i.ZP)("cutout-show-ghost").removeEventListener("change",this.renderMask,!1),(0,i.ZP)("cutout-type-magic").removeEventListener("change",this.selectType,!1),(0,i.ZP)("cutout-type-draw").removeEventListener("change",this.selectType,!1),(0,i.ZP)("cutout-type-lasso").removeEventListener("change",this.selectType,!1),(0,i.ZP)("cutout-type-shape").removeEventListener("change",this.selectType,!1),(0,i.ZP)("cutout-type-gradient").removeEventListener("change",this.selectType,!1),(0,i.ZP)("cutout-mode-keep").removeEventListener("click",this.selectMode,!1),(0,i.ZP)("cutout-mode-remove").removeEventListener("click",this.selectMode,!1),(0,i.ZP)("cutout-tool-more").removeEventListener("click",this.more,!1),this.stage.raster.removeEventListener("contextmenu",this.contextMenu,!0),this.rasterctx=null,this.selected=null,this.brush=null},this.allFill=(e,t)=>{for(var s=0;s<this.mpx.length;++s)this.tolerate(s,e,t)&&(this.mpx[s]=4294967295)},this.floodFill=(e,t,s,i)=>{let a=this.selected.canvas.width,n=this.selected.canvas.height,o=new Array,r=new Array(a*n);for(this.linearFill(e.x,e.y,t,s,i,o,r);o.length>0;)for(var h=o.shift(),l=h.start;l<=h.stop;++l)h.row>0&&!r[(h.row-1)*a+l]&&this.linearFill(l,h.row-1,t,s,i,o,r),h.row<n-1&&!r[(h.row+1)*a+l]&&this.linearFill(l,h.row+1,t,s,i,o,r)},this.linearFill=(e,t,s,i,a,n,r)=>{var h=this.selected.canvas.width;if(r[h*t+e]=!0,this.tolerate(h*t+e,s,i)){this.mpx[h*t+e]=4294967295;for(var l=e-1,c=e+1;l>=0&&!r[h*t+l];){if(r[h*t+l]=!0,!this.tolerate(h*t+l,s,i)){a&&(this.mpx[h*t+l]=4294967295);break}this.mpx[h*t+l]=4294967295,--l}for(;c<h&&!r[h*t+c];){if(r[h*t+c]=!0,!this.tolerate(h*t+c,s,i)){a&&(this.mpx[h*t+c]=4294967295);break}this.mpx[h*t+c]=4294967295,++c}n.push(new o.Z(l+1,c-1,t))}else a&&(this.mpx[h*t+l]=4294967295)},this.tolerate=(e,t,s)=>{let i,a,n,o,r,h,l;return a=0,n=this.cpx[e],o=n>>24&255,o=t.a-o,i=o<0?-o:o,i>a&&(a=i),t.a>0&&(l=n>>16&255,h=n>>8&255,r=255&n,r=t.r-r,i=r<0?-r:r,i>a&&(a=i),h=t.g-h,i=h<0?-h:h,i>a&&(a=i),l=t.b-l,i=l<0?-l:l,i>a&&(a=i)),a<s},this.stage.coating.freeze(!0),this.stage.coating.clear(),this.rasterctx=this.stage.coating.ctx,(0,i.ZP)("cutout-tool-more").addEventListener("click",this.more,!1),p.ZP.user.subscription&&"premium"!==p.ZP.user.subscriptionType?(0,i.ZP)("cutout-auto").style.display="none":(0,i.ZP)("cutout-auto").addEventListener("click",this.auto,!1),(0,i.ZP)("cutout-type-magic").addEventListener("change",this.selectType,!1),(0,i.ZP)("cutout-type-draw").addEventListener("change",this.selectType,!1),(0,i.ZP)("cutout-type-lasso").addEventListener("change",this.selectType,!1),(0,i.ZP)("cutout-type-shape").addEventListener("change",this.selectType,!1),(0,i.ZP)("cutout-type-gradient").addEventListener("change",this.selectType,!1),(0,i.ZP)("cutout-mode-keep").addEventListener("click",this.selectMode,!1),(0,i.ZP)("cutout-mode-remove").addEventListener("click",this.selectMode,!1),(0,i.ZP)("cutout-show-ghost").addEventListener("change",this.renderMask,!1),document.addEventListener("keydown",this.keyDown,!1),document.addEventListener("keyup",this.keyUp,!1),document.addEventListener("layer-select",this.layerSelect,!1),document.addEventListener("zoom-change",this.zoomChange,!1),this.stage.raster.addEventListener("contextmenu",this.contextMenu,!0),this.brush=new u.Z(new w.Z),this.brushPod=new f.Z(e,"cutout-draw-brush",this.brush,this.updateBrush),this.drawOpacity=new l.Z("cutout-draw-opacity",{compact:!0,label:(0,a.Z)("opacity")+":",defaultValue:1,labelFormat:e=>(100*e).toFixed(0)+"%",labelParse:e=>parseInt(e,10)/100});let t=new r.ZP;t.addStop(new c.Z(0,255,0,255),0),t.addStop(new c.Z(0,255,0,0),1),this.gradPod=new g.Z("cutout-gradient-grad",t,!0),this.magicTolerance=new l.Z("cutout-magic-tolerance",{compact:!0,defaultValue:.32,label:(0,a.Z)("tolerance")+":",labelFormat:e=>(100*e).toFixed(0),labelParse:e=>parseInt(e,10)/100}),this.magicFeather=new l.Z("cutout-magic-feather",{compact:!0,defaultValue:0,label:(0,a.Z)("feather")+":",labelFormat:e=>(100*e).toFixed(0),labelParse:e=>parseInt(e,10)/100}),this.shapeFeather=new l.Z("cutout-shape-feather",{compact:!0,defaultValue:0,label:(0,a.Z)("feather")+":",labelFormat:e=>(100*e).toFixed(0),labelParse:e=>parseInt(e,10)/100}),this.lassoFeather=new l.Z("cutout-lasso-feather",{compact:!0,defaultValue:0,label:(0,a.Z)("feather")+":",labelFormat:e=>(100*e).toFixed(0),labelParse:e=>parseInt(e,10)/100}),(0,i.ZP)("cutout-magic-settings").style.display="none",(0,i.ZP)("cutout-draw-settings").style.display="none",(0,i.ZP)("cutout-shape-settings").style.display="none",(0,i.ZP)("cutout-lasso-settings").style.display="none",(0,i.ZP)("cutout-gradient-settings").style.display="none",this.addDownListeners(),this.layerSelect();const s=document.querySelector('input[name="cutout-type"]:checked').value;this.setType(s);const h=document.querySelector('input[name="cutout-mode"]:checked').value;this.setMode(h)}drawToMask(e,t,s=1){if(0!==t){let e=new m.Z;e.addShader("blur",t),this.scratch.replaceCanvas(e.apply(this.scratch.canvas))}const i=n.l(this.scratch.canvas);if(!i)return;let a;e||(a=n.$E(this.selected.mask,i));const o=this.selected.mask.getContext("2d");o.save(),o.globalAlpha=s,"remove"===this.mode&&(o.globalCompositeOperation="destination-out"),o.drawImage(this.scratch.canvas,0,0),o.restore(),this.scratch.clear(),this.renderMask(),this.stage.history.add({type:"mask",layer:this.selected,rect:i,patch:a})}}},2285:(e,t,s)=>{s.d(t,{Z:()=>d});var i=s(3947),a=s(6548),n=s(3655),o=s(8203),r=s(4188),h=s(2257),l=s(972),c=s(1126);class d extends o.Z{constructor(e){super("detail",e),this.mode="blur",this.layerSelect=()=>{if(!this.stage.fresco.isSelectedImageWithCanvas())return(0,i.ZP)("detail-no-layer").style.display="flex",(0,i.ZP)("detail-settings").style.display="none",this.selected=null,void this.updateBrush();(0,i.ZP)("detail-settings").style.display="flex",(0,i.ZP)("detail-no-layer").style.display="none",this.selected=this.stage.fresco.getSelected(),this.scratch=this.stage.fresco.addScratch(),this.scratch.setTarget(this.selected.id,this.selected.rect,"over"),this.stage.fresco.hasSelection()&&this.scratch.addBake(),this.updateBrush()},this.selectMode=e=>{switch(e.currentTarget.id){case"detail-mode-blur":this.setMode("blur");break;case"detail-mode-smudge":this.setMode("smudge");break;case"detail-mode-sharpen":this.setMode("sharpen")}},this.setMode=e=>{this.mode=e,(0,i.ZP)("detail-mode-blur").checked="blur"===this.mode,(0,i.ZP)("detail-mode-sharpen").checked="sharpen"===this.mode,(0,i.ZP)("detail-mode-smudge").checked="smudge"===this.mode},this.isShiftDown=!1,this.keyDown=e=>{if("Shift"!==e.key)switch(e.key){case",":e.shiftKey?this.brushPod.stepSoftness(.1):this.brushPod.stepSize(-10);break;case".":e.shiftKey?this.brushPod.stepSoftness(-.1):this.brushPod.stepSize(10)}else this.isShiftDown=!0},this.keyUp=e=>{"Shift"===e.key&&(this.isShiftDown=!1)},this.updateBrush=()=>{this.selected?this.stage.coating.setCursorImage(this.brush.getCursorImage(this.stage.zoom)):this.stage.coating.removeCursorImage()},this.down=(e,t)=>{this.selected&&(this.stage.coating.freeze(!0),this.isShiftDown||(this.x=this.y=-1),"smudge"===this.mode&&this.ptt&&this.ptt.clearRect(0,0,this.ptt.canvas.width,this.ptt.canvas.height),"touch"!==t&&this.move(e),this.addMoveListeners())},this.x=-1,this.y=-1,this.move=e=>{let t="smudge"===this.mode?1:this.brush.getStep(),s=!1;if(e=this.stage.translateRasterToFresco(e,this.selected.rect),-1===this.x&&(this.lx=e.x,this.ly=e.y,this.x=e.x,this.y=e.y,this.drawShape(this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),s=!0),e.x!==this.x||e.y!==this.y){let i=e.x-this.x,a=e.y-this.y,n=i>0?1:-1,o=a>0?1:-1;if(i=i<0?-i:i,a=a<0?-a:a,i>a){let e=.5*i;for(let r=1;r<=i;r++)this.x+=n,e+=a,e>=i&&(e-=i,this.y+=o),(this.x>this.lx+t||this.x<this.lx-t||this.y>this.ly+t||this.y<this.ly-t)&&(this.drawShape(this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),this.lx=this.x,this.ly=this.y,s=!0)}else{let e=.5*a;for(let r=1;r<=a;r++)this.y+=o,e+=i,e>=a&&(e-=a,this.x+=n),(this.x>this.lx+t||this.x<this.lx-t||this.y>this.ly+t||this.y<this.ly-t)&&(this.drawShape(this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),this.lx=this.x,this.ly=this.y,s=!0)}}s&&(this.scratch.applySelection(this.stage),window.requestAnimationFrame((()=>this.stage.render())))},this.drawShape=(e,t)=>{let s=this.strength.getValue(),i=this.getPatchContext(this.brush.canvas.width,this.brush.canvas.height);if(i.drawImage(this.selected.canvas,-e,-t),"smudge"===this.mode){if(this.x!==this.lx||this.y!==this.ly){i.drawImage(this.scratch.canvas,-e,-t);let a=this.getPatternContext(this.brush.canvas.width,this.brush.canvas.height);a.save(),a.drawImage(this.scratch.canvas,-(this.lx-~~(this.brush.canvas.width/2)),-(this.ly-~~(this.brush.canvas.height/2))),a.restore(),a.save(),a.globalCompositeOperation="destination-in",a.drawImage(this.brush.canvas,0,0),a.restore(),i.save(),i.globalAlpha=s/100,i.drawImage(this.ptt.canvas,0,0),i.restore()}this.scratch.ctx.drawImage(this.patch,e,t)}else"blur"===this.mode?this.blur(i):"sharpen"===this.mode&&this.sharpen(i),i.save(),i.globalCompositeOperation="destination-in",i.drawImage(this.brush.canvas,0,0),i.restore(),this.scratch.ctx.save(),this.scratch.ctx.globalAlpha=.01*s,this.scratch.ctx.drawImage(this.patch,e,t),this.scratch.ctx.restore()},this.getPatchContext=(e,t)=>this.patch?(this.patch.width!==e||this.patch.height!==t?(this.patch.width=e,this.patch.height=t):this.ptx.clearRect(0,0,e,t),this.ptx):(this.patch=n.vL(e,t),this.ptx=this.patch.getContext("2d"),this.ptx),this.getPatternContext=(e,t)=>this.pattern?(this.pattern.width!==e||this.pattern.height!==t?(this.pattern.width=e,this.pattern.height=t):this.ptt.clearRect(0,0,e,t),this.ptt):(this.pattern=n.vL(e,t),this.ptt=this.pattern.getContext("2d"),this.ptt),this.up=e=>{this.stage.coating.freeze(!1),this.removeMoveListeners();let t=n.l(this.scratch.canvas);if(t&&t.width>0&&t.height>0){let e=n.$E(this.selected.canvas,t);const s=this.selected.rect.clone();this.scratch.drawToLayer(this.selected),this.scratch.clear(),this.selected.render(),this.stage.history.add({type:"bitmapChange",kind:"detail",layer:this.selected,patchRect:t,patch:e,rect:s})}window.requestAnimationFrame((()=>this.stage.render()))},this.sharpen=e=>{const t=.3;for(var s,i,a,n,o,r,h,l,c,d,u,p,g,m=e.canvas.width,v=e.canvas.height,f=[0,-1,0,-1,5,-1,0,-1,0],y=Math.round(Math.sqrt(f.length)),w=.5*y|0,b=e.createImageData(m,v),x=b.data,Z=e.getImageData(0,0,m,v).data,k=v;k--;)for(s=m;s--;){for(a=k,i=s,h=4*(k*m+s),n=0,o=0,r=0,0,u=0;u<y;u++)for(d=0;d<y;d++)g=i+d-w,(p=a+u-w)>=0&&p<v&&g>=0&&g<m&&(c=f[u*y+d],n+=Z[l=4*(p*m+g)]*c,o+=Z[l+1]*c,r+=Z[l+2]*c,Z[l+3]*c);x[h]=n*t+.7*Z[h],x[h+1]=o*t+.7*Z[h+1],x[h+2]=r*t+.7*Z[h+2],x[h+3]=Z[h+3]}e.putImageData(b,0,0)},this.blur=e=>{var t,s,i,a,n,o,r,h,l,c,d,u,p,g,m=e.canvas.width,v=e.canvas.height,f=e.getImageData(0,0,m,v),y=f.data,w=m-1,b=v-1;var x=[],Z=[],k=[],P=[],E=[],S=[];for(p=u=0,o=0;o<v;o++){for(t=6*y[p],s=6*y[p+1],i=6*y[p+2],a=6*y[p+3],r=1;r<=5;r++)h=p+((r>w?w:r)<<2),t+=y[h++],s+=y[h++],i+=y[h++],a+=y[h];for(n=0;n<m;n++)x[u]=t,Z[u]=s,k[u]=i,P[u]=a,0==o&&(E[n]=((h=n+6)<w?h:w)<<2,S[n]=(h=n-5)>0?h<<2:0),l=p+E[n],c=p+S[n],t+=y[l++]-y[c++],s+=y[l++]-y[c++],i+=y[l++]-y[c++],a+=y[l]-y[c],u++;p+=m<<2}for(n=0;n<m;n++){for(t=6*x[d=n],s=6*Z[d],i=6*k[d],a=6*P[d],r=1;r<=5;r++)t+=x[d+=r>b?0:m],s+=Z[d],i+=k[d],a+=P[d];for(u=n<<2,o=0;o<v;o++)y[u+3]=g=34*a>>>12,g>0?(g=255/g,y[u]=(34*t>>>12)*g,y[u+1]=(34*s>>>12)*g,y[u+2]=(34*i>>>12)*g):y[u]=y[u+1]=y[u+2]=0,0===n&&(E[o]=((h=o+6)<b?h:b)*m,S[o]=(h=o-5)>0?h*m:0),l=n+E[o],c=n+S[o],t+=x[l]-x[c],s+=Z[l]-Z[c],i+=k[l]-k[c],a+=P[l]-P[c],u+=m<<2}e.putImageData(f,0,0)},this.cleanUp=()=>{var e;null===(e=this.stage.fresco)||void 0===e||e.removeScratch(),this.removeDownListeners(),this.brushPod.cleanUp(),this.strength.cleanUp(),document.removeEventListener("zoom-change",this.updateBrush,!1),document.removeEventListener("layer-select",this.layerSelect,!1),document.removeEventListener("keydown",this.keyDown,!1),document.removeEventListener("keyup",this.keyUp,!1),(0,i.ZP)("detail-mode-blur").removeEventListener("click",this.selectMode,!1),(0,i.ZP)("detail-mode-sharpen").removeEventListener("click",this.selectMode,!1),(0,i.ZP)("detail-mode-smudge").removeEventListener("click",this.selectMode,!1),this.selected=void 0,this.pattern=void 0,this.patch=void 0,this.ptx=void 0,this.ptt=void 0},document.addEventListener("keydown",this.keyDown,!1),document.addEventListener("keyup",this.keyUp,!1),(0,i.ZP)("detail-mode-blur").addEventListener("click",this.selectMode,!1),(0,i.ZP)("detail-mode-sharpen").addEventListener("click",this.selectMode,!1),(0,i.ZP)("detail-mode-smudge").addEventListener("click",this.selectMode,!1),document.addEventListener("layer-select",this.layerSelect,!1),document.addEventListener("zoom-change",this.updateBrush,!1),this.brush=new h.Z(new l.Z("circle",50,.5)),this.brushPod=new c.Z(e,"detail-brush",this.brush,this.updateBrush),this.strength=new r.Z("detail-strength",{compact:!0,label:(0,a.Z)("strength")+":",range:[1,100],defaultValue:40,step:1});const t=document.querySelector('input[name="detail-mode"]:checked').value;this.setMode(t),this.addDownListeners(),this.layerSelect()}}},7647:(e,t,s)=>{s.d(t,{Z:()=>w});var i=s(3947),a=s(6548),n=s(3655),o=s(6817),r=s(8776),h=s(8203),l=s(4188),c=s(3673),d=s(2257),u=s(4820),p=s(7976),g=s(972),m=s(1951),v=s(8829);class f extends v.Z{constructor(e,t,s,n){super(t,(0,a.Z)("options")),this.checkIt=()=>{this.options.shrink=(0,i.ZP)("disperse-shrink").checked,this.options.hollow=(0,i.ZP)("disperse-hollow").checked,this.callback(this.options)},this.cleanUp=()=>{(0,i.ZP)("disperse-shrink").removeEventListener("click",this.checkIt,!1),(0,i.ZP)("disperse-hollow").removeEventListener("click",this.checkIt,!1),this.direction.cleanUp(),this.stretch.cleanUp(),this.amount.cleanUp(),this.spread.cleanUp(),this.scale.cleanUp(),this.superClean()},this.stage=e,this.options=s,this.callback=n,this.setContent(`\n            <section>\n                <div id="disperse-scale"></div>\n                <div id="disperse-amount"></div>\n                <div id="disperse-stretch"></div>\n                <div id="disperse-direction"></div>\n                <div id="disperse-spread"></div>\n                <input type="checkbox" checked id="disperse-shrink" />\n                <label class="pad-16 switch" for="disperse-shrink">${(0,a.Z)("shrink")}<span></span></label>\n                <input type="checkbox" id="disperse-hollow" />\n                <label class="pad-10 switch" for="disperse-hollow">${(0,a.Z)("hollow")}<span></span></label>\n            </section>\n        `),this.scale=new l.Z("disperse-scale",{label:(0,a.Z)("scale")+":",range:[.02,1],step:.02,defaultValue:s.scale,labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,onEnd:e=>{this.options.scale=e,n(this.options)}}),this.amount=new l.Z("disperse-amount",{label:(0,a.Z)("amount")+":",range:[.01,1],step:.01,defaultValue:s.amount,labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,onEnd:e=>{this.options.amount=e,n(this.options)}}),this.stretch=new l.Z("disperse-stretch",{label:(0,a.Z)("stretch")+":",range:[0,1],step:.01,defaultValue:s.stretch,labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,onEnd:e=>{this.options.stretch=e,n(this.options)}}),this.direction=new l.Z("disperse-direction",{label:(0,a.Z)("direction")+":",range:[-180,180],defaultValue:s.direction,labelFormat:e=>e.toFixed(1),labelParse:e=>parseInt(e,10),onEnd:e=>{this.options.direction=e,n(this.options)}}),this.spread=new l.Z("disperse-spread",{label:(0,a.Z)("spread")+":",range:[-1,1],step:.02,defaultValue:s.spread,labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,onEnd:e=>{this.options.spread=e,n(this.options)}}),(0,i.ZP)("disperse-shrink").addEventListener("click",this.checkIt,!1),(0,i.ZP)("disperse-hollow").addEventListener("click",this.checkIt,!1),(0,i.ZP)("disperse-shrink").checked=this.options.shrink,(0,i.ZP)("disperse-hollow").checked=this.options.hollow}}class y{constructor(e,t,s,i,a,n,o,r,h){this.sx=e,this.sy=t,this.tx=s,this.ty=i,this.background=a,this.color=n,this.radius=o,this.rotation=r,this.factor=h}}class w extends h.Z{constructor(e){var t;super("disperse",e),this.mode="mask",this.layerSelect=async()=>{if(!(this.selected===this.stage.fresco.getSelected())&&this.maskRect&&!this.blocked){await new p.Z((0,a.Z)("apply"),(0,a.Z)("viewDisperseApply")).init()&&this.apply()}if(!this.stage.fresco.isSelectedImageWithCanvas())return(0,i.ZP)("disperse-no-layer").style.display="flex",(0,i.ZP)("disperse-settings").style.display="none",this.selected=null,void this.updateBrush();(0,i.ZP)("disperse-settings").style.display="flex",(0,i.ZP)("disperse-no-layer").style.display="none",this.selected=this.stage.fresco.getSelected(),this.scratch=this.stage.fresco.addScratch(),this.scratch.setTarget(this.selected.id,this.selected.rect,"over"),this.maskRect=void 0,window.requestAnimationFrame((()=>this.stage.render())),this.setMode("mask")},this.updateBrush=()=>{this.brush.generate(),this.selected&&"mask"===this.mode?this.stage.coating.setCursorImage(this.brush.getCursorImage(this.stage.zoom)):this.stage.coating.removeCursorImage(),this.scratch&&(this.scratch.settings.opacity="mask"===this.mode?.4:1)},this.selectMode=e=>{this.setMode(e.currentTarget===(0,i.ZP)("disperse-mode-mask")?"mask":"effect")},this.setMode=e=>{"effect"!==e||this.maskRect||(e="mask",this.stage.notify("viewDisperseMaskFirst")),this.mode=e,(0,i.ZP)("disperse-mode-mask").checked="mask"===this.mode,(0,i.ZP)("disperse-mode-effect").checked="effect"===this.mode,(0,i.ZP)("disperse-mask-settings").style.display="mask"===this.mode?"flex":"none",(0,i.ZP)("disperse-effect-settings").style.display="effect"===this.mode?"flex":"none",this.updateBrush(),this.disperse()},this.rand=(e,t)=>Math.random()*(t-e)+e,this.showOptions=()=>{new f(this.stage,(0,i.ZP)("disperse-options"),this.options,this.updateOptions)},this.updateOptions=e=>{this.options=e,this.disperse()},this.disperse=()=>{var e;if(this.scratch.clear(),"effect"!==this.mode||!this.maskRect)return;const t=this.maskRect,s=t.center(),i=this.scratch.ctx,a=this.selected.canvas.getContext("2d"),n=new Array,o=10*this.options.amount,h=Math.round(100*this.options.scale),l=Math.round(.5*h),d=Math.round(t.width/h)*Math.round(t.height/h)*o,u=this.options.direction*Math.PI/180,p=this.options.spread,g=Math.sqrt(t.width*t.width+t.height*t.height),m=Math.round(this.options.stretch*g),v=this.options.shrink,f=this.options.hollow;let w,b=0,x=0;for(;b<d&&x<5e4;){let o=new c.Z(Math.round(this.rand(t.x,t.x+t.width)),Math.round(this.rand(t.y,t.y+t.height)));if(x++,this.maskData.data[4*(o.y*i.canvas.width+o.x)]>0){b++;let t=g*Math.cos(u),i=g*Math.sin(u),c=this.getBound(o.x,o.y,o.x-t,o.y-i),d=this.getBound(o.x,o.y,o.x+t,o.y+i),f=null!==(e=o.distanceTo(c)/d.distanceTo(c))&&void 0!==e?e:0,w=1-f,x=l+this.rand(.2*-l,.2*l);v&&(x=.5*x+Math.round(.5*x*w));let Z=a.getImageData(d.x,d.y,1,1).data;const k=new r.Z(Z[0],Z[1],Z[2]);let P=a.getImageData(o.x,o.y,1,1).data;const E=new r.Z(P[0],P[1],P[2]);let S=f*f*m,T=Math.cos(u)*S,C=Math.sin(u)*S;if(0!==p){let e=s.rotateAround(o,u),t=(o.y-e.y)*p*f;T+=Math.sin(u)*t,C+=Math.cos(u)*t}if(n.push(new y(o.x,o.y,o.x+T,o.y+C,k,E,x,6.283185308*Math.random(),w)),v&&Math.random()>w){let e=2*h*f,t=this.rand(-e,e),s=this.rand(-e,e);n.push(new y(o.x+t,o.y+s,o.x+T+t,o.y+C+s,k,E,x,6.283185308*Math.random(),w))}}}switch(document.querySelector('input[name="disperse-type"]:checked').value){case"circle":w=this.circle;break;case"square":w=this.square;break;case"hexagon":w=this.hexagon;break;case"cross":w=this.cross;break;case"triangle":w=this.triangle;break;case"heart":w=this.heart;break;case"star":w=this.star;break;case"glimmer":w=this.glimmer}i.imageSmoothingEnabled=!0,i.imageSmoothingQuality="high",n.forEach((e=>{i.save(),i.translate(e.sx,e.sy),i.rotate(e.rotation),i.beginPath(),i.shadowBlur=2,i.fillStyle=i.shadowColor=e.background.toRGBA(245),w(i,l),i.closePath(),i.fill(),i.restore()})),n.forEach((e=>{Math.random()<.5&&(i.save(),i.translate(e.tx,e.ty),i.rotate(e.rotation),i.beginPath(),w(i,e.radius),i.closePath(),i.fillStyle=f?e.background.toRGBA():e.color.toRGBA(),i.fill(),f&&(i.lineWidth=.25*e.radius,i.strokeStyle=e.color.toRGBA(),i.stroke()),i.restore())})),window.requestAnimationFrame((()=>this.stage.render()))},this.getBound=(e,t,s,i)=>{let a=e,n=t,o=s-e,r=i-t,h=o>0?1:-1,l=r>0?1:-1;if(o=o<0?-o:o,r=r<0?-r:r,o>r){let e=.5*o;for(let t=1;t<=o&&(a+=h,e+=r,e>=o&&(e-=o,n+=l),0!==this.maskData.data[4*(n*this.scratch.canvas.width+a)]);t++);}else{let e=.5*r;for(let t=1;t<=r&&(n+=l,e+=o,e>=r&&(e-=r,a+=h),0!==this.maskData.data[4*(n*this.scratch.canvas.width+a)]);t++);}return new c.Z(a,n)},this.circle=(e,t)=>{e.arc(0,0,t,0,2*Math.PI)},this.square=(e,t)=>{e.moveTo(0,t);for(let s=0;s<4;s++)e.rotate(2*Math.PI/4),e.lineTo(0,t)},this.triangle=(e,t)=>{e.moveTo(0,0-t);for(let s=0;s<3;s++)e.rotate(Math.PI/3),e.lineTo(0,0-.5*t),e.rotate(Math.PI/3),e.lineTo(0,0-t)},this.hexagon=(e,t)=>{e.moveTo(0,t);for(let s=0;s<6;s++)e.rotate(2*Math.PI/6),e.lineTo(0,t)},this.heart=(e,t)=>{let s=.8*t;e.translate(0,-t/2),e.rotate(45*Math.PI/180),e.beginPath(),e.moveTo(0,0),e.bezierCurveTo(-s,0,-s,t,0,t),e.lineTo(t,t),e.lineTo(t,0),e.bezierCurveTo(t,-s,0,-s,0,0)},this.cross=(e,t)=>{let s=.35*t;e.moveTo(-s,-s);for(let i=0;i<4;i++)e.lineTo(-s,-t),e.lineTo(s,-t),e.lineTo(s,-s),e.rotate(Math.PI/2)},this.star=(e,t)=>{e.moveTo(0,0-t);for(let s=0;s<5;s++)e.rotate(Math.PI/5),e.lineTo(0,0-.5*t),e.rotate(Math.PI/5),e.lineTo(0,0-t)},this.glimmer=(e,t)=>{e.moveTo(0,0-t);for(let s=0;s<4;s++)e.rotate(Math.PI/4),e.lineTo(0,0-.2*t),e.rotate(Math.PI/4),e.lineTo(0,0-t)},this.down=e=>{this.selected&&"mask"===this.mode&&(this.x=this.y=-1,this.move(e),this.addMoveListeners())},this.x=-1,this.y=-1,this.move=e=>{let t=this.brush.getStep(),s=!1;if(e=this.stage.translateRasterToFresco(e,this.selected.rect),-1==this.x&&(this.lx=e.x,this.ly=e.y,this.x=e.x,this.y=e.y,this.scratch.ctx.drawImage(this.brush.canvas,this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),s=!0),e.x!==this.x||e.y!==this.y){let i=e.x-this.x,a=e.y-this.y,n=i>0?1:-1,o=a>0?1:-1;if(i=i<0?-i:i,a=a<0?-a:a,i>a){let e=.5*i;for(let r=1;r<=i;r++)this.x+=n,e+=a,e>=i&&(e-=i,this.y+=o),(this.x>this.lx+t||this.x<this.lx-t||this.y>this.ly+t||this.y<this.ly-t)&&(this.lx=this.x,this.ly=this.y,this.scratch.ctx.drawImage(this.brush.canvas,this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),s=!0)}else{let e=.5*a;for(let r=1;r<=a;r++)this.y+=o,e+=i,e>=a&&(e-=a,this.x+=n),(this.x>this.lx+t||this.x<this.lx-t||this.y>this.ly+t||this.y<this.ly-t)&&(this.lx=this.x,this.ly=this.y,this.scratch.ctx.drawImage(this.brush.canvas,this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),s=!0)}}s&&window.requestAnimationFrame((()=>this.stage.render()))},this.up=e=>{this.removeMoveListeners(),this.maskRect=n.l(this.scratch.canvas),this.maskData=this.maskRect?this.scratch.ctx.getImageData(0,0,this.scratch.canvas.width,this.scratch.canvas.height):void 0,this.maskData&&this.setMode("effect")},this.reset=()=>{var e;this.maskRect=void 0,null===(e=this.scratch)||void 0===e||e.clear(),this.layerSelect(),window.requestAnimationFrame((()=>this.stage.render())),document.dispatchEvent(new CustomEvent("notification",{detail:(0,a.Z)("reset")}))},this.applyClick=()=>{this.blocked?new m.Z(this.stage,"STUDIO"):this.apply()},this.apply=()=>{var e;if(!this.selected||!this.stage.fresco.hasLayer(this.selected))return;if(this.blocked||!this.maskRect)return;const t=new o.Z(0,0,this.selected.rect.width,this.selected.rect.height),s=n.$E(this.selected.canvas);this.scratch.drawToLayer(this.selected),this.scratch.clear(),this.selected.render(),this.stage.history.add({type:"bitmapChange",kind:"disperse",layer:this.selected,patchRect:t,patch:s,rect:this.selected.rect.clone()}),this.maskRect=void 0,null===(e=this.scratch)||void 0===e||e.clear(),this.layerSelect()},this.cleanUp=()=>{this.maskRect&&!this.blocked&&this.apply(),this.stage.fresco.block&&this.stage.fresco.setBlock(),this.stage.fresco.removeScratch(),this.removeDownListeners(),window.requestAnimationFrame((()=>this.stage.render())),(0,i.ZP)("disperse-apply").removeEventListener("click",this.applyClick,!1),(0,i.ZP)("disperse-reset").removeEventListener("click",this.reset,!1),(0,i.ZP)("disperse-options").removeEventListener("click",this.showOptions,!0),document.removeEventListener("layer-select",this.layerSelect,!1),document.removeEventListener("zoom-change",this.updateBrush,!1),(0,i.ZP)("disperse-mode-mask").removeEventListener("change",this.selectMode,!0),(0,i.ZP)("disperse-mode-effect").removeEventListener("change",this.selectMode,!0),document.querySelectorAll('input[name="disperse-type"]').forEach((e=>e.removeEventListener("change",this.disperse))),this.brushSize.cleanUp(),this.selected=null,this.scratch=null},this.blocked=null===(t=!u.ZP.user.subscription)||void 0===t||t,this.blocked&&this.stage.fresco.setBlock(!0),(0,i.ZP)("disperse-apply").addEventListener("click",this.applyClick,!1),(0,i.ZP)("disperse-reset").addEventListener("click",this.reset,!1),document.addEventListener("layer-select",this.layerSelect,!1),document.addEventListener("zoom-change",this.updateBrush,!1),(0,i.ZP)("disperse-mode-mask").addEventListener("change",this.selectMode,!0),(0,i.ZP)("disperse-mode-effect").addEventListener("change",this.selectMode,!0),(0,i.ZP)("disperse-options").addEventListener("click",this.showOptions,!0),this.brush=new d.Z(new g.Z("circle",50,0)),this.brushSize=new l.Z("disperse-brush-size",{label:(0,a.Z)("size")+":",step:2,compact:!0,range:[5,200],defaultValue:this.brush.settings.size,labelFormat:e=>e.toFixed(0)+"px",onEnd:e=>{this.brush.settings.size=e,this.updateBrush()}}),document.querySelectorAll('input[name="disperse-type"]').forEach((e=>e.addEventListener("change",this.disperse))),this.options={scale:.2,amount:.2,stretch:.5,direction:0,spread:.2,shrink:!0,hollow:!1},this.addDownListeners(),this.layerSelect()}}},810:(e,t,s)=>{s.d(t,{Z:()=>m});var i=s(3947),a=s(6548),n=s(3655),o=s(6817),r=s(8203),h=s(4188),l=s(8776),c=s(4820),d=s(2257),u=s(4170),p=s(972),g=s(1126);class m extends r.Z{constructor(e){super("draw",e),this.stage=e,this.isShiftDown=!1,this.keyDown=e=>{if("Shift"!==e.key)if("Control"!==e.key||this.stage.coating.override)switch(e.key){case",":e.shiftKey?this.brushPod.stepSoftness(.1):this.brushPod.stepSize(-10);break;case".":e.shiftKey?this.brushPod.stepSoftness(-.1):this.brushPod.stepSize(10)}else this.stage.coating.setPicker();else this.isShiftDown=!0},this.keyUp=e=>{"Shift"===e.key&&(this.isShiftDown=!1),"Control"===e.key&&this.stage.coating.override&&this.stage.coating.removePicker()},this.layerSelect=()=>{if(!this.stage.fresco.isSelectedType(u.Z.TYPE_IMAGE))return(0,i.ZP)("draw-no-layer").style.display="flex",(0,i.ZP)("draw-settings").style.display="none",this.selected=null,void this.updateBrush();(0,i.ZP)("draw-no-layer").style.display="none",(0,i.ZP)("draw-settings").style.display="flex",this.selected=this.stage.fresco.getSelected(),this.scratch=this.stage.fresco.addScratch(),this.scratch.setTarget(this.selected.id,new o.Z(0,0,this.stage.fresco.width,this.stage.fresco.height),"over"),this.stage.fresco.hasSelection()&&this.scratch.addBake(),this.updateBrush()},this.updateBrush=()=>{this.selected?this.stage.coating.setCursorImage(this.brush.getCursorImage(this.stage.zoom,new l.Z(255,255,255,255))):this.stage.coating.removeCursorImage(),this.lastTip=void 0,this.lastColor=void 0,this.lastSettings=void 0},this.down=(e,t,s)=>{if(!this.selected)return;this.stage.coating.freeze(!0),this.isShiftDown||(this.x=this.y=-1);let a=l.Z.fromHEX(c.ZP.mainColor),n=(0,i.ZP)("draw-hard-tip").checked;!p.Z.isEqual(this.brush.settings,this.lastSettings)&&a.isEqual(this.lastColor)&&n===this.lastTip||(this.brush.generate(a,n),this.lastSettings=this.brush.settings,this.lastColor=a,this.lastTip=n),this.scratch.settings.opacity=this.opacity.getValue(),this.mirror=(0,i.ZP)("draw-mirror").value,this.scatter=(0,i.ZP)("draw-scatter").checked,this.usePen=(0,i.ZP)("draw-pen-pressure").checked,"touch"!==t&&this.move(e,t,s),this.addMoveListeners()},this.x=-1,this.y=-1,this.move=(e,t,s=1)=>{let i=this.brush.getStep(),a=!1;if(this.scratch.ctx.globalAlpha=("pen"===t||"touch"===t)&&this.usePen&&s>0?s*s:this.flow.getValue(),e=this.stage.translateRasterToFresco(e),-1===this.x&&(this.lx=e.x,this.ly=e.y,this.x=e.x,this.y=e.y,this.scratch.ctx.drawImage(this.brush.canvas,this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),a=!0),e.x!==this.x||e.y!==this.y){let t=e.x-this.x,s=e.y-this.y,n=t>0?1:-1,o=s>0?1:-1;if(t=t<0?-t:t,s=s<0?-s:s,t>s){let e=.5*t;for(let r=1;r<=t;r++)this.x+=n,e+=s,e>=t&&(e-=t,this.y+=o),(this.x>this.lx+i||this.x<this.lx-i||this.y>this.ly+i||this.y<this.ly-i)&&(this.draw(this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),this.lx=this.x,this.ly=this.y,a=!0)}else{let e=.5*s;for(let r=1;r<=s;r++)this.y+=o,e+=t,e>=s&&(e-=s,this.x+=n),(this.x>this.lx+i||this.x<this.lx-i||this.y>this.ly+i||this.y<this.ly-i)&&(this.draw(this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),this.lx=this.x,this.ly=this.y,a=!0)}}a&&(this.scratch.applySelection(this.stage),window.requestAnimationFrame((()=>this.stage.render())))},this.draw=(e,t)=>{if(this.scatter){const s=.5*(this.brush.canvas.width+this.brush.canvas.height);e+=Math.round(Math.random()*s-.5*s),t+=Math.round(Math.random()*s-.5*s)}if(this.scratch.ctx.drawImage(this.brush.canvas,e,t),"vertical"===this.mirror||"fourway"===this.mirror){let s=this.scratch.rect.width-e;this.scratch.ctx.drawImage(this.brush.canvas,s,t)}if("horizontal"===this.mirror||"fourway"===this.mirror){let s=this.scratch.rect.height-t;this.scratch.ctx.drawImage(this.brush.canvas,e,s)}if("fourway"===this.mirror){let s=this.scratch.rect.width-e,i=this.scratch.rect.height-t;this.scratch.ctx.drawImage(this.brush.canvas,s,i)}},this.up=e=>{this.stage.coating.freeze(!1),this.removeMoveListeners();const t=n.l(this.scratch.canvas);if(t&&t.width>0&&t.height>0){let e=this.selected.rect?n.$E(this.selected.canvas,t.rebase(this.selected.rect.x,this.selected.rect.y)):void 0;const s=n.dN(this.selected.mask),i=this.selected.rect?this.selected.rect.clone():void 0;this.selected.extendCanvas(t),this.scratch.drawToLayer(this.selected,"source-over",this.opacity.getValue()),this.scratch.clear(),this.selected.render(),this.stage.history.add({type:"bitmapChange",kind:"draw",layer:this.selected,patchRect:this.selected.rect?t.rebase(this.selected.rect.x,this.selected.rect.y):t,patch:e,rect:i,mask:s})}window.requestAnimationFrame((()=>this.stage.render()))},this.cleanUp=()=>{var e;null===(e=this.stage.fresco)||void 0===e||e.removeScratch(),this.stage.coating.removePicker(),this.brushPod.cleanUp(),this.opacity.cleanUp(),this.flow.cleanUp(),this.stage.coating.freeze(!1),this.removeMoveListeners(),this.removeDownListeners(),document.removeEventListener("layer-select",this.layerSelect,!1),document.removeEventListener("zoom-change",this.updateBrush,!1),document.removeEventListener("keydown",this.keyDown,!1),document.removeEventListener("keyup",this.keyUp,!1)},document.addEventListener("layer-select",this.layerSelect,!1),document.addEventListener("zoom-change",this.updateBrush,!1),document.addEventListener("keydown",this.keyDown,!1),document.addEventListener("keyup",this.keyUp,!1),this.brush=new d.Z(new p.Z),this.brushPod=new g.Z(e,"draw-brush",this.brush,this.updateBrush),this.opacity=new h.Z("draw-opacity",{compact:!0,label:(0,a.Z)("opacity")+":",defaultValue:1,labelFormat:e=>(100*e).toFixed(0)+"%",labelParse:e=>parseInt(e,10)/100}),this.flow=new h.Z("draw-flow",{compact:!0,label:(0,a.Z)("flow")+":",defaultValue:1,labelFormat:e=>(100*e).toFixed(0)+"%",labelParse:e=>parseInt(e,10)/100}),this.addDownListeners(),this.layerSelect()}}},2553:(e,t,s)=>{s.d(t,{Z:()=>u});var i=s(3947),a=s(3655),n=s(8203),o=s(4188),r=s(8776),h=s(2257),l=s(972),c=s(1126),d=s(6548);class u extends n.Z{constructor(e){super("eraser",e),this.stage=e,this.isShiftDown=!1,this.keyDown=e=>{if("Shift"!==e.key)switch(e.key){case",":e.shiftKey?this.brushPod.stepSoftness(.1):this.brushPod.stepSize(-10);break;case".":e.shiftKey?this.brushPod.stepSoftness(-.1):this.brushPod.stepSize(10)}else this.isShiftDown=!0},this.keyUp=e=>{"Shift"===e.key&&(this.isShiftDown=!1)},this.layerSelect=()=>{if(!this.stage.fresco.isSelectedImageWithCanvas())return(0,i.ZP)("eraser-no-layer").style.display="flex",(0,i.ZP)("eraser-settings").style.display="none",this.selected=null,void this.updateBrush();(0,i.ZP)("eraser-no-layer").style.display="none",(0,i.ZP)("eraser-settings").style.display="flex",this.selected=this.stage.fresco.getSelected(),this.cached=a.dN(this.selected.canvas),this.scratch=this.stage.fresco.addScratch(),this.scratch.setTarget(this.selected.id,this.selected.rect,"none"),this.stage.fresco.hasSelection()&&this.scratch.addBake(),this.usePen=(0,i.ZP)("eraser-pen-pressure").checked,this.isTransparent=!(0===this.stage.fresco.selectedLayerNr()&&this.selected.settings.locked)||a.EL(this.selected.canvas),this.updateBrush()},this.updateBrush=()=>{this.selected?this.stage.coating.setCursorImage(this.brush.getCursorImage(this.stage.zoom,new r.Z(255,255,255,255))):this.stage.coating.removeCursorImage()},this.down=(e,t,s)=>{this.selected&&(this.stage.coating.freeze(!0),this.brush.generate(new r.Z,(0,i.ZP)("eraser-hard-tip").checked),this.isShiftDown||(this.x=this.y=-1),"touch"!==t&&this.move(e,t,s),this.addMoveListeners())},this.x=-1,this.y=-1,this.move=(e,t,s)=>{let i=this.brush.getStep(),a=!1;if(this.scratch.ctx.globalAlpha=("pen"===t||"touch"===t)&&this.usePen&&s>0?s*s:this.flow.getValue(),e=this.stage.translateRasterToFresco(e,this.selected.rect),-1===this.x&&(this.lx=e.x,this.ly=e.y,this.x=e.x,this.y=e.y,this.drawShape(this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),a=!0),e.x!==this.x||e.y!==this.y){let t=e.x-this.x,s=e.y-this.y,n=t>0?1:-1,o=s>0?1:-1;if(t=t<0?-t:t,s=s<0?-s:s,t>s){let e=.5*t;for(let r=1;r<=t;r++)this.x+=n,e+=s,e>=t&&(e-=t,this.y+=o),(this.x>this.lx+i||this.x<this.lx-i||this.y>this.ly+i||this.y<this.ly-i)&&(this.lx=this.x,this.ly=this.y,this.drawShape(this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),a=!0)}else{let e=.5*s;for(let r=1;r<=s;r++)this.y+=o,e+=t,e>=s&&(e-=s,this.x+=n),(this.x>this.lx+i||this.x<this.lx-i||this.y>this.ly+i||this.y<this.ly-i)&&(this.lx=this.x,this.ly=this.y,this.drawShape(this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),a=!0)}}a&&(this.scratch.applySelection(this.stage),this.selected.replaceCanvas(this.cached),this.scratch.drawToLayer(this.selected,this.isTransparent?"destination-out":"source-over",this.opacity.getValue()),this.selected.render(),window.requestAnimationFrame((()=>this.stage.render())))},this.drawShape=(e,t)=>{this.scratch.ctx.drawImage(this.brush.canvas,e,t)},this.up=e=>{this.stage.coating.freeze(!1),this.removeMoveListeners();let t=a.l(this.scratch.getCanvas());if(t&&t.width>0&&t.height>0){let e=a.$E(this.cached,t);const s=this.selected.rect.clone();this.cached=a.dN(this.selected.canvas);const i=this.selected.shrinkWrap();if(this.selected.rect&&(t=t.rebase(this.selected.rect.x-s.x,this.selected.rect.y-s.y)),this.stage.history.add({type:"bitmapChange",kind:"eraser",layer:this.selected,patchRect:t,patch:e,rect:s}),i)return void this.layerSelect()}this.scratch.clear(),window.requestAnimationFrame((()=>this.stage.render()))},this.cleanUp=()=>{var e;null===(e=this.stage.fresco)||void 0===e||e.removeScratch(),this.brushPod.cleanUp(),this.stage.coating.freeze(!1),this.removeMoveListeners(),this.removeDownListeners(),document.removeEventListener("layer-select",this.layerSelect,!1),document.removeEventListener("zoom-change",this.updateBrush,!1),document.removeEventListener("keydown",this.keyDown,!1),document.removeEventListener("keyup",this.keyUp,!1),this.cached=void 0},document.addEventListener("layer-select",this.layerSelect,!1),document.addEventListener("zoom-change",this.updateBrush,!1),document.addEventListener("keydown",this.keyDown,!1),document.addEventListener("keyup",this.keyUp,!1),this.brush=new h.Z(new l.Z),this.brushPod=new c.Z(e,"eraser-brush",this.brush,this.updateBrush),this.opacity=new o.Z("eraser-opacity",{compact:!0,label:(0,d.Z)("opacity")+":",defaultValue:1,labelFormat:e=>(100*e).toFixed(0)+"%",labelParse:e=>parseInt(e,10)/100}),this.flow=new o.Z("eraser-flow",{compact:!0,label:(0,d.Z)("flow")+":",defaultValue:1,labelFormat:e=>(100*e).toFixed(0)+"%",labelParse:e=>parseInt(e,10)/100}),this.addDownListeners(),this.layerSelect()}}},9457:(e,t,s)=>{s.d(t,{Z:()=>p});var i=s(3947),a=s(6548),n=s(3655),o=s(3347),r=s(6817),h=s(8203),l=s(4188),c=s(8776),d=s(4820),u=s(4170);class p extends h.Z{constructor(e){super("fill",e),this.keyDown=e=>{"Control"!==e.key||this.stage.coating.override||this.stage.coating.setPicker()},this.keyUp=e=>{"Control"===e.key&&this.stage.coating.override&&this.stage.coating.removePicker()},this.layerSelect=()=>{if(!this.stage.fresco.isSelectedType(u.Z.TYPE_IMAGE))return(0,i.ZP)("fill-no-layer").style.display="flex",(0,i.ZP)("fill-settings").style.display="none",this.stage.raster.style.cursor="unset",void(this.selected=null);(0,i.ZP)("fill-settings").style.display="flex",(0,i.ZP)("fill-no-layer").style.display="none",this.stage.raster.style.cursor="crosshair",this.selected=this.stage.fresco.getSelected(),this.scratch=this.stage.fresco.addScratch(),this.scratch.setTarget(this.selected.id,new r.Z(0,0,this.stage.fresco.width,this.stage.fresco.height),"over")},this.down=e=>{if(!this.selected)return;if((e=this.stage.translateRasterToFresco(e)).x<0||e.y<0||e.x>this.scratch.canvas.width||e.y>this.scratch.canvas.height)return;let t,s=this.tolerance.getValue(),a=c.Z.fromHEX(d.ZP.mainColor);if(this.selected.canvas&&this.selected.rect){if(this.scratch.rect.equalTo(this.selected.rect))this.canvasData=this.selected.canvas.getContext("2d").getImageData(0,0,this.selected.canvas.width,this.selected.canvas.height).data;else{let e=n.vL(this.scratch.canvas.width,this.scratch.canvas.height),t=e.getContext("2d");t.drawImage(this.selected.canvas,this.selected.rect.x,this.selected.rect.y),this.canvasData=t.getImageData(0,0,e.width,e.height).data,t=void 0}if(this.selected.rect.isInside(e)){const s=4*(e.y*this.scratch.canvas.width+e.x);t=new c.Z(this.canvasData[s],this.canvasData[s+1],this.canvasData[s+2],this.canvasData[s+3])}else t=new c.Z(0,0,0,0);let o=this.scratch.ctx.getImageData(0,0,this.scratch.canvas.width,this.scratch.canvas.height);this.scratchData=o.data,(0,i.ZP)("fill-contiguous").checked?this.floodFill(e,t,a,s,(0,i.ZP)("fill-anti-alias").checked):this.allFill(t,a,s,(0,i.ZP)("fill-anti-alias").checked),this.scratch.ctx.putImageData(o,0,0)}else this.scratch.ctx.fillStyle=a.toRGBA(255*this.opacity.getValue()),this.scratch.ctx.fillRect(0,0,this.scratch.canvas.width,this.scratch.canvas.height);this.scratch.applySelection(this.stage);let o=n.l(this.scratch.getCanvas());if(o&&o.width>0&&o.height>0){let e=this.selected.rect?n.$E(this.selected.canvas,o.rebase(this.selected.rect.x,this.selected.rect.y)):void 0;const t=this.selected.rect?this.selected.rect.clone():void 0,s=n.dN(this.selected.mask);this.selected.extendCanvas(o),this.scratch.drawToLayer(this.selected,"source-over",this.opacity.getValue()),this.scratch.clear(),this.selected.render(),this.stage.history.add({type:"bitmapChange",kind:"fill",layer:this.selected,patchRect:this.selected.rect?o.rebase(this.selected.rect.x,this.selected.rect.y):o,patch:e,rect:t,mask:s})}window.requestAnimationFrame((()=>this.stage.render()))},this.allFill=(e,t,s,i)=>{for(var a,n,o=0,r=this.scratch.canvas.height;o<r;++o)for(var h=0,l=this.scratch.canvas.width;h<l;++h)n=4*(o*l+h),(a=this.tolerate(n,e,s,i))>64&&(a>128&&(a=255),this.scratchData[n]=t.r,this.scratchData[n+1]=t.g,this.scratchData[n+2]=t.b,this.scratchData[n+3]=a)},this.floodFill=(e,t,s,i,a)=>{let n=this.scratch.canvas.width,o=this.scratch.canvas.height,r=new Array,h=new Array(n*o);for(this.linearFill(e.x,e.y,t,s,i,a,r,h);r.length>0;)for(var l=r.shift(),c=l.start;c<=l.stop;++c)l.row>0&&!h[(l.row-1)*n+c]&&this.linearFill(c,l.row-1,t,s,i,a,r,h),l.row<o-1&&!h[(l.row+1)*n+c]&&this.linearFill(c,l.row+1,t,s,i,a,r,h)},this.linearFill=(e,t,s,i,a,n,r,h)=>{var l=this.scratch.canvas.width;h[l*t+e]=!0;let c=4*(l*t+e),d=this.tolerate(c,s,a,n);if(d>5&&(this.scratchData[c]=i.r,this.scratchData[c+1]=i.g,this.scratchData[c+2]=i.b,this.scratchData[c+3]=d>160?255:d),d>64){for(var u=e-1,p=e+1;u>=0&&!h[l*t+u]&&d>64;)h[l*t+u]=!0,c=4*(l*t+u),d=this.tolerate(c,s,a,n),d>5&&(this.scratchData[c]=i.r,this.scratchData[c+1]=i.g,this.scratchData[c+2]=i.b,this.scratchData[c+3]=d>160?255:d),--u;for(d=255;p<l&&!h[l*t+p]&&d>64;)h[l*t+p]=!0,c=4*(l*t+p),d=this.tolerate(c,s,a,n),d>5&&(this.scratchData[c]=i.r,this.scratchData[c+1]=i.g,this.scratchData[c+2]=i.b,this.scratchData[c+3]=d>160?255:d),++p;r.push(new o.Z(u+1,p-1,t))}},this.tolerate=(e,t,s,i=!1)=>{let a,n,o,r,h,l,c;return r=t.a-this.canvasData[e+3],n=r<0?-r:r,t.a>0&&(h=t.r-this.canvasData[e],a=h<0?-h:h,a>n&&(n=a),l=t.g-this.canvasData[e+1],a=l<0?-l:l,a>n&&(n=a),c=t.b-this.canvasData[e+2],a=c<0?-c:c,a>n&&(n=a)),i&&s>0?(o=1.5-n/s,o<=0?0:o<.5?Math.round(512*o):255):n>s?0:255},this.cleanUp=()=>{var e;null===(e=this.stage.fresco)||void 0===e||e.removeScratch(),this.stage.coating.removePicker(),this.removeDownListeners(),this.tolerance.cleanUp(),this.opacity.cleanUp(),document.removeEventListener("layer-select",this.layerSelect,!1),document.removeEventListener("keydown",this.keyDown,!1),document.removeEventListener("keyup",this.keyUp,!1)},document.addEventListener("layer-select",this.layerSelect,!1),document.addEventListener("keydown",this.keyDown,!1),document.addEventListener("keyup",this.keyUp,!1),this.tolerance=new l.Z("fill-tolerance",{compact:!0,label:(0,a.Z)("tolerance")+":",defaultValue:32,range:[0,255],step:1}),this.opacity=new l.Z("fill-opacity",{compact:!0,label:(0,a.Z)("opacity")+":",defaultValue:1,labelFormat:e=>(100*e).toFixed(0)+"%"}),this.addDownListeners(),this.layerSelect()}}},718:(e,t,s)=>{s.d(t,{Z:()=>y});var i=s(3947),a=s(6548),n=s(3655),o=s(6817),r=s(8203),h=s(3673),l=s(4188),c=s(4820),d=s(4256),u=s(1726),p=s(7976),g=s(1951),m=s(8829),v=s(4178);class f extends m.Z{constructor(e,t,s,n){super(t,(0,a.Z)("options"),!0),this.checkBlur=()=>{this.options.bokehBlur=(0,i.ZP)("bokeh-blur").checked,this.options.bokehBlurType=document.querySelector('input[name="bokeh-blur-type"]:checked').value,this.callback(this.options,"blur")},this.checkShape=()=>{this.options.bokehShape=(0,i.ZP)("bokeh-shape").checked,this.options.bokehShapeDual=(0,i.ZP)("bokeh-shape-dual").checked,this.options.bokehShapeType=document.querySelector('input[name="bokeh-shape-type"]:checked').value,this.callback(this.options,"shape")},this.cleanUp=()=>{(0,i.ZP)("bokeh-blur").removeEventListener("change",this.checkBlur,!1),(0,i.ZP)("bokeh-shape").removeEventListener("change",this.checkShape,!1),(0,i.ZP)("bokeh-shape-dual").removeEventListener("change",this.checkShape,!1),document.querySelectorAll('input[name="bokeh-blur-type"]').forEach((e=>e.removeEventListener("change",this.checkBlur))),document.querySelectorAll('input[name="bokeh-shape-type"]').forEach((e=>e.removeEventListener("change",this.checkShape))),this.bokehBlurSize.cleanUp(),this.bokehBlurIntensity.cleanUp(),this.bokehShapeHue.cleanUp(),this.bokehShapeSize.cleanUp(),this.bokehShapeQuantity.cleanUp(),this.bokehShapeIntensity.cleanUp(),this.superClean()},this.stage=e,this.options=s,this.callback=n,this.content.id="focus-options-content",this.content.style.height="400px",this.content.style.overflow="hidden",this.content.style.paddingBottom="4px",this.setContent(`\n            <section>\n\n            <div>\n                <input type="checkbox" class="toggle-check" id="bokeh-blur" />\n                <label class="switch subline pad-16" for="bokeh-blur">${(0,a.Z)("bokehBlur")}<span></span><span class="arrow"></span></label>\n        \n                <div class="toggle">\n                    <div class="switch-icon-field stretch">\n                        <input type="radio" id="bokeh-blur-type-circle" name="bokeh-blur-type" value="circle" checked /><label for="bokeh-blur-type-circle" tooltip="${(0,a.Z)("circle")}" flow="up"><img src="/img/icon/shape-ellipse.svg" width="20" height="20" loading="lazy"/></label>\n                        <input type="radio" id="bokeh-blur-type-square" name="bokeh-blur-type" value="square" /><label for="bokeh-blur-type-square" tooltip="${(0,a.Z)("square")}" flow="up"><img src="/img/icon/shape-rectangle.svg" width="20" height="20" loading="lazy"/></label>\n                        <input type="radio" id="bokeh-blur-type-hexagon" name="bokeh-blur-type" value="hexagon" /><label for="bokeh-blur-type-hexagon" tooltip="${(0,a.Z)("hexagon")}" flow="up"><img src="/img/icon/shape-hexagon.svg"  width="20" height="20" loading="lazy"/></label>\n                        <input type="radio" id="bokeh-blur-type-cross" name="bokeh-blur-type" value="cross" /><label for="bokeh-blur-type-cross" tooltip="${(0,a.Z)("cross")}" flow="up"><img src="/img/icon/shape-cross.svg" width="20" height="20" loading="lazy"/></label>\n                    </div>\n                    <div id="bokeh-blur-size" class="pad-16"></div>\n                    <div id="bokeh-blur-intensity"></div>\n                </div>\n            </div>\n        \n            <div class="pad-16">\n                <input type="checkbox" class="toggle-check" id="bokeh-shape" />\n                <label class="switch subline pad-16" for="bokeh-shape">${(0,a.Z)("bokehShape")}<span></span><span class="arrow"></span></label>\n        \n                <div class="toggle">\n                    <div class="switch-icon-field stretch">\n                        <input type="radio" id="bokeh-shape-type-circle" name="bokeh-shape-type" value="circle" checked /><label for="bokeh-shape-type-circle" tooltip="${(0,a.Z)("circle")}" flow="up"><img src="/img/icon/shape-ellipse.svg" width="20" height="20" loading="lazy"/></label>\n                        <input type="radio" id="bokeh-shape-type-hexagon" name="bokeh-shape-type" value="hexagon" /><label for="bokeh-shape-type-hexagon" tooltip="${(0,a.Z)("hexagon")}" flow="up"><img src="/img/icon/shape-hexagon.svg"  width="20" height="20" loading="lazy"/></label>\n                        <input type="radio" id="bokeh-shape-type-square" name="bokeh-shape-type" value="square" /><label for="bokeh-shape-type-square" tooltip="${(0,a.Z)("square")}" flow="up"><img src="/img/icon/shape-rectangle.svg" width="20" height="20" loading="lazy"/></label>\n                        <input type="radio" id="bokeh-shape-type-triangle" name="bokeh-shape-type" value="triangle" /><label for="bokeh-shape-type-triangle" tooltip="${(0,a.Z)("triangle")}" flow="up"><img src="/img/icon/shape-triangle.svg" width="20" height="20" loading="lazy"/></label>\n                    </div>\n                    <div class="switch-icon-field stretch pad-4">\n                        <input type="radio" id="bokeh-shape-type-heart" name="bokeh-shape-type" value="heart" /><label for="bokeh-shape-type-heart" tooltip="${(0,a.Z)("heart")}" flow="up"><img src="/img/icon/shape-heart.svg" width="20" height="20" loading="lazy"/></label>\n                        <input type="radio" id="bokeh-shape-type-cross" name="bokeh-shape-type" value="cross" /><label for="bokeh-shape-type-cross" tooltip="${(0,a.Z)("cross")}" flow="up"><img src="/img/icon/shape-cross.svg" width="20" height="20" loading="lazy"/></label>\n                        <input type="radio" id="bokeh-shape-type-star" name="bokeh-shape-type" value="star" /><label for="bokeh-shape-type-star" tooltip="${(0,a.Z)("star")}" flow="up"><img src="/img/icon/shape-star.svg"  width="20" height="20" loading="lazy"/></label>\n                        <input type="radio" id="bokeh-shape-type-glimmer" name="bokeh-shape-type" value="glimmer" /><label for="bokeh-shape-type-glimmer" tooltip="${(0,a.Z)("glimmer")}" flow="up"><img src="/img/icon/shape-glimmer.svg" width="20" height="20" loading="lazy"/></label>\n                    </div>\n                    <div id="bokeh-shape-hue" class="pad-16"></div>\n                    <div id="bokeh-shape-size" ></div>\n                    <div id="bokeh-shape-quantity"></div>\n                    <div id="bokeh-shape-intensity"></div>\n                    <input type="checkbox" id="bokeh-shape-dual" />\n                    <label class="pad-16 switch" for="bokeh-shape-dual">${(0,a.Z)("dualTone")}<span></span></label>\n                </div>\n            </div>\n            </section>\n        `),this.bokehBlurSize=new l.Z("bokeh-blur-size",{label:(0,a.Z)("size"),range:[0,1],step:.01,defaultValue:this.options.bokehBlurSize,labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,onEnd:e=>{this.options.bokehBlurSize=e,n(this.options,"blur")}}),this.bokehBlurIntensity=new l.Z("bokeh-blur-intensity",{label:(0,a.Z)("intensity"),range:[0,1],step:.01,defaultValue:this.options.bokehBlurIntensity,labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,onEnd:e=>{this.options.bokehBlurIntensity=e,n(this.options,"blur")}}),this.bokehShapeHue=new l.Z("bokeh-shape-hue",{label:(0,a.Z)("color"),range:[-180,180],step:1,defaultValue:this.options.bokehShapeHue,labelFormat:e=>String(e),labelParse:e=>parseInt(e,10),onEnd:e=>{this.options.bokehShapeHue=e,n(this.options,"shape")}}),this.bokehShapeSize=new l.Z("bokeh-shape-size",{label:(0,a.Z)("size"),range:[0,1],step:.01,defaultValue:this.options.bokehShapeSize,labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,onEnd:e=>{this.options.bokehShapeSize=e,n(this.options,"shape")}}),this.bokehShapeQuantity=new l.Z("bokeh-shape-quantity",{label:(0,a.Z)("quantity"),range:[0,1],step:.01,defaultValue:this.options.bokehShapeQuantity,labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,onEnd:e=>{this.options.bokehShapeQuantity=e,n(this.options,"shape")}}),this.bokehShapeIntensity=new l.Z("bokeh-shape-intensity",{label:(0,a.Z)("intensity"),range:[0,1],step:.01,defaultValue:this.options.bokehShapeIntensity,labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,onEnd:e=>{this.options.bokehShapeIntensity=e,n(this.options,"shape")}}),(0,i.ZP)("bokeh-blur").addEventListener("change",this.checkBlur,!1),(0,i.ZP)("bokeh-shape").addEventListener("change",this.checkShape,!1),(0,i.ZP)("bokeh-shape-dual").addEventListener("change",this.checkShape,!1),document.querySelectorAll('input[name="bokeh-blur-type"]').forEach((e=>e.addEventListener("change",this.checkBlur))),document.querySelectorAll('input[name="bokeh-shape-type"]').forEach((e=>e.addEventListener("change",this.checkShape))),(0,i.ZP)("bokeh-blur").checked=this.options.bokehBlur,(0,i.ZP)("bokeh-blur-type-"+this.options.bokehBlurType).checked=!0,(0,i.ZP)("bokeh-shape").checked=this.options.bokehShape,(0,i.ZP)("bokeh-shape-dual").checked=this.options.bokehShapeDual,(0,i.ZP)("bokeh-shape-type-"+this.options.bokehShapeType).checked=!0,new v.Z((0,i.ZP)("focus-options-content"))}}class y extends r.Z{constructor(e){var t;super("focus",e),this.mode="symmetric",this.PI2=2*Math.PI,this.selectMode=e=>{this.mode=e.currentTarget.value,this.rotation=0,window.requestAnimationFrame((()=>{this.renderControls(),this.renderFocus()}))},this.layerSelect=async()=>{if(!(this.selected===this.stage.fresco.getSelected())&&!this.blocked&&(0!==this.blurAmount.getValue()||this.options.bokehShape||this.options.bokehBlur)){await new p.Z((0,a.Z)("apply"),(0,a.Z)("viewFocusApply")).init()&&this.apply()}if(!this.stage.fresco.isSelectedImageWithCanvas())return(0,i.ZP)("focus-no-layer").style.display="flex",(0,i.ZP)("focus-settings").style.display="none",this.selected=void 0,this.cached=void 0,this.shape=void 0,this.blur=void 0,void window.requestAnimationFrame((()=>{this.renderControls()}));(0,i.ZP)("focus-no-layer").style.display="none",(0,i.ZP)("focus-settings").style.display="flex",this.selected=this.stage.fresco.getSelected(),this.cached=this.selected.baked?this.selected.baked:this.selected.canvas,this.scratch=this.stage.fresco.addScratch(),this.scratch.setTarget(this.selected.id,this.selected.rect,"over",this.cached),this.scratch.settings.blendmode=this.selected.settings.blendmode,this.scratch.settings.opacity=this.selected.settings.opacity,this.center=new h.Z(Math.round(this.stage.fresco.width/2),Math.round(this.stage.fresco.height/2)),this.distance=Math.round(this.stage.fresco.height/2*.75),this.falloff=Math.round(.5*this.distance),this.rotation=0,this.addDownListeners(),this.addMoveListeners(),this.renderControls(),this.renderBlur(),this.renderShape()},this.showOptions=()=>{new f(this.stage,(0,i.ZP)("focus-options"),this.options,this.updateOptions)},this.updateOptions=(e,t)=>{this.options=e,"shape"===t?this.renderShape():this.renderBlur()},this.down=e=>{if(!this.selected)return;this.downPoint=this.stage.translateRasterToFresco(e);let t=this.downPoint.clone();if(0!==this.rotation&&(this.matrix.reset(),this.matrix.translate(this.center),this.matrix.rotate(this.rotation),this.matrix.invert(),t=this.matrix.transformPoint(t).add(this.center)),this.checkControl(t),this.control){switch(this.control){case"center":this.downPosition=this.center.clone();break;case"falloff":this.downPosition=new h.Z(this.center.y,this.falloff),this.downPoint=t;break;case"distance":this.downPosition=new h.Z(this.center.y,this.distance),this.downPoint=t;break;case"rotation":this.downRotation=Math.atan2(this.downPoint.y-this.center.y,this.downPoint.x-this.center.x)-this.rotation}this.raster.addEventListener("pointerup",this.pointerUp,!1)}else n.aG(0,0,this.stage.fresco.width,this.stage.fresco.height,this.downPoint.x,this.downPoint.y)?this.renderControls():this.rctx.clearRect(0,0,this.raster.width,this.raster.height)},this.move=e=>{if(!this.selected)return;let t=this.stage.translateRasterToFresco(e),s=t.clone();if(0!==this.rotation&&(this.matrix.reset(),this.matrix.translate(this.center),this.matrix.rotate(this.rotation),this.matrix.invert(),s=this.matrix.transformPoint(s).add(this.center)),this.isDown){if(this.control){switch(this.control){case"center":this.center.x=this.downPosition.x+(t.x-this.downPoint.x),this.center.y=this.downPosition.y+(t.y-this.downPoint.y);break;case"falloff":this.falloff=n.uZ(this.downPosition.y+(s.y-this.downPoint.y),20,this.distance-20);break;case"distance":this.distance=n.uZ(this.downPosition.y+(s.y-this.downPoint.y),this.falloff+20,Math.round(this.cached.height));break;case"rotation":this.rotation=Math.atan2(t.y-this.center.y,t.x-this.center.x)-this.downRotation,this.rotation<0?this.rotation+=this.PI2:this.rotation>=this.PI2&&(this.rotation-=this.PI2)}window.requestAnimationFrame((()=>{this.renderControls(),this.renderFocus()}))}}else this.checkControl(s)},this.checkControl=e=>{let t=28/this.stage.zoom,s=t/2,i=50/this.stage.zoom,a=!1,o=!1;n.aG(this.center.x-s,this.center.y+this.falloff-s,t,t,e.x,e.y)&&(o="falloff"===this.control,this.control="falloff",a=!0),n.aG(this.center.x-s,this.center.y+this.distance-s,t,t,e.x,e.y)&&(o="distance"===this.control,this.control="distance",a=!0),n.aG(this.center.x-s,this.center.y-s,t,t,e.x,e.y)&&(o="center"===this.control,this.control="center",a=!0),"radial"!==this.mode&&n.aG(this.center.x+i-s,this.center.y-i-s,t,t,e.x,e.y)&&(o="rotation"===this.control,this.control="rotation",a=!0),a&&!o?(window.requestAnimationFrame(this.renderControls),this.raster.style.cursor="pointer"):!a&&this.control&&(this.control=void 0,window.requestAnimationFrame(this.renderControls),this.raster.style.cursor="unset")},this.up=e=>{this.isDown=!1},this.renderBlurEvent=()=>{window.requestAnimationFrame(this.renderBlur)},this.renderBlur=()=>{this.options.bokehBlur?this.shaders.addShader("bokeh",{size:this.options.bokehBlurSize,amount:this.options.bokehBlurIntensity,type:this.options.bokehBlurType}):this.shaders.addShader("bokeh",void 0),this.shaders.addShader("blur",this.blurAmount.getValue()),this.blur=this.shaders.apply(this.cached),this.renderFocus()},this.rand=(e,t)=>Math.random()*(t-e)+e,this.hsla=(e,t,s,i)=>"hsla("+e+","+t+"%,"+s+"%,"+i+")",this.renderShape=()=>{if(!this.options.bokehShape)return this.shape=void 0,void this.renderFocus();this.shape||(this.shape=n.vL(this.cached.width,this.cached.height));const e=this.shape.getContext("2d");e.clearRect(0,0,this.shape.width,this.shape.height),e.save(),e.globalCompositeOperation="lighter";const t=this.shape.width,s=this.shape.height,i=t+s,a=this.options.bokehShapeHue+180,o=.1*i*this.options.bokehShapeSize,r=.03*i;let h,l=Math.floor(.1*i*this.options.bokehShapeQuantity);switch(this.options.bokehShapeType){case"circle":h=this.circle;break;case"square":h=this.square;break;case"hexagon":h=this.hexagon;break;case"cross":h=this.cross;break;case"triangle":h=this.triangle;break;case"heart":h=this.heart;break;case"star":h=this.star;break;case"glimmer":h=this.glimmer}const c=this.options.bokehShapeDual;for(;l--;){const i=this.rand(0,t),n=this.rand(0,s),d=this.rand(1,o);let u=this.rand(a-30,a+30);c&&l%2==0&&(u+=120),e.shadowColor=this.hsla(u,this.rand(10,80),this.rand(30,60),this.rand(.2,.8)),e.shadowBlur=this.rand(10,r),e.beginPath(),e.save(),e.translate(i,n),e.rotate(Math.random()*this.PI2),h(e,d),e.restore(),e.closePath(),e.fill()}for(l=Math.floor(.03*i*this.options.bokehShapeQuantity),e.shadowBlur=15,e.shadowColor="#fff";l--;){const i=this.rand(0,t),a=this.rand(0,s),n=this.rand(.5,.75*o);e.fillStyle=this.hsla(0,0,100,this.rand(.03,.1)),e.beginPath(),e.save(),e.translate(i,a),e.rotate(Math.random()*this.PI2),h(e,n),e.restore(),e.closePath(),e.fill()}e.restore(),this.renderFocus()},this.circle=(e,t)=>{e.arc(0,0,t,0,2*Math.PI)},this.square=(e,t)=>{e.moveTo(0,t);for(let s=0;s<4;s++)e.rotate(2*Math.PI/4),e.lineTo(0,t)},this.triangle=(e,t)=>{e.moveTo(0,0-t);for(let s=0;s<3;s++)e.rotate(Math.PI/3),e.lineTo(0,0-.5*t),e.rotate(Math.PI/3),e.lineTo(0,0-t)},this.hexagon=(e,t)=>{e.moveTo(0,t);for(let s=0;s<6;s++)e.rotate(2*Math.PI/6),e.lineTo(0,t)},this.heart=(e,t)=>{let s=.8*t;e.translate(0,-t/2),e.rotate(45*Math.PI/180),e.beginPath(),e.moveTo(0,0),e.bezierCurveTo(-s,0,-s,t,0,t),e.lineTo(t,t),e.lineTo(t,0),e.bezierCurveTo(t,-s,0,-s,0,0)},this.cross=(e,t)=>{let s=.35*t;e.moveTo(-s,-s);for(let i=0;i<4;i++)e.lineTo(-s,-t),e.lineTo(s,-t),e.lineTo(s,-s),e.rotate(Math.PI/2)},this.star=(e,t)=>{e.moveTo(0,0-t);for(let s=0;s<5;s++)e.rotate(Math.PI/5),e.lineTo(0,0-.5*t),e.rotate(Math.PI/5),e.lineTo(0,0-t)},this.glimmer=(e,t)=>{e.moveTo(0,0-t);for(let s=0;s<4;s++)e.rotate(Math.PI/4),e.lineTo(0,0-.2*t),e.rotate(Math.PI/4),e.lineTo(0,0-t)},this.renderFocus=()=>{if(this.scratch.replaceCanvas(this.blur),this.scratch.drawCanvas(this.shape,"screen",this.options.bokehShapeIntensity),"none"===this.mode)return void window.requestAnimationFrame(this.stage.render);let e;const t=(0,i.ZP)("focus-invert").checked,s=t?"#00000000":"#000000FF",a=t?"#000000FF":"#00000000";let n=this.center.neg(this.selected.rect.topLeft());if("radial"===this.mode){const t=this.falloff/this.distance;e=this.scratch.ctx.createRadialGradient(n.x,n.y,0,n.x,n.y,this.distance),e.addColorStop(0,s),e.addColorStop(t,s),e.addColorStop(1,a)}else if("symmetric"===this.mode){const t=this.falloff/this.distance*.5,i=new h.Z(n.x,n.y-this.distance).rotateAround(n,this.rotation),o=new h.Z(n.x,n.y+this.distance).rotateAround(n,this.rotation);e=this.scratch.ctx.createLinearGradient(i.x,i.y,o.x,o.y),e.addColorStop(0,a),e.addColorStop(.5-t,s),e.addColorStop(.5,s),e.addColorStop(.5+t,s),e.addColorStop(1,a)}else{const t=this.falloff/this.distance,i=new h.Z(n.x,n.y+this.distance).rotateAround(n,this.rotation);e=this.scratch.ctx.createLinearGradient(n.x,n.y,i.x,i.y),e.addColorStop(0,s),e.addColorStop(t,s),e.addColorStop(1,a)}this.scratch.ctx.save(),this.scratch.ctx.fillStyle=e,this.scratch.ctx.globalCompositeOperation="destination-out",this.scratch.ctx.fillRect(0,0,this.cached.width,this.cached.height),this.scratch.ctx.restore(),window.requestAnimationFrame(this.stage.render)},this.renderControls=()=>{if(this.rctx.clearRect(0,0,this.raster.width,this.raster.height),!this.selected||"none"===this.mode)return;const e=this.stage.translateFrescoToRaster(this.center),t=Math.round(this.falloff*this.stage.zoom),s=Math.round(this.distance*this.stage.zoom),i="radial"!==this.mode;this.rctx.save(),this.rctx.lineWidth=2,this.rctx.shadowBlur=6,this.rctx.shadowColor="rgba(0,0,0,0.5)",this.rctx.strokeStyle=n.XE,this.rctx.translate(e.x,e.y),this.rctx.rotate(this.rotation),"symmetric"===this.mode?(this.rctx.beginPath(),this.rctx.moveTo(-this.raster.width,-s),this.rctx.lineTo(this.raster.width,-s),this.rctx.closePath(),this.rctx.stroke(),this.rctx.beginPath(),this.rctx.moveTo(-this.raster.width,s),this.rctx.lineTo(this.raster.width,s),this.rctx.closePath(),this.rctx.stroke(),this.rctx.setLineDash([5,8]),this.rctx.beginPath(),this.rctx.moveTo(-this.raster.width,-t),this.rctx.lineTo(this.raster.width,-t),this.rctx.closePath(),this.rctx.stroke(),this.rctx.beginPath(),this.rctx.moveTo(-this.raster.width,t),this.rctx.lineTo(this.raster.width,+t),this.rctx.closePath(),this.rctx.stroke()):"linear"===this.mode?(this.rctx.beginPath(),this.rctx.moveTo(-this.raster.width,s),this.rctx.lineTo(this.raster.width,s),this.rctx.closePath(),this.rctx.stroke(),this.rctx.setLineDash([5,8]),this.rctx.beginPath(),this.rctx.moveTo(-this.raster.width,t),this.rctx.lineTo(this.raster.width,t),this.rctx.closePath(),this.rctx.stroke()):(this.rctx.beginPath(),this.rctx.arc(0,0,s,0,2*Math.PI,!1),this.rctx.closePath(),this.rctx.stroke(),this.rctx.setLineDash([5,5]),this.rctx.beginPath(),this.rctx.arc(0,0,t,0,2*Math.PI,!1),this.rctx.closePath(),this.rctx.stroke()),this.rctx.setLineDash([]),this.rctx.fillStyle=n.wf,this.rctx.beginPath(),this.rctx.arc(0,t,"falloff"===this.control?12:8,0,2*Math.PI,!1),this.rctx.closePath(),this.rctx.fill(),this.rctx.fillStyle="falloff"===this.control?n.xZ:n.Bs,this.rctx.beginPath(),this.rctx.arc(0,t,"falloff"===this.control?10:6,0,2*Math.PI,!1),this.rctx.closePath(),this.rctx.fill(),this.rctx.fillStyle=n.wf,this.rctx.beginPath(),this.rctx.arc(0,s,"distance"===this.control?12:8,0,2*Math.PI,!1),this.rctx.closePath(),this.rctx.fill(),this.rctx.fillStyle="distance"===this.control?n.xZ:n.Bs,this.rctx.beginPath(),this.rctx.arc(0,s,"distance"===this.control?10:6,0,2*Math.PI,!1),this.rctx.closePath(),this.rctx.fill(),i&&(this.rctx.fillStyle=n.wf,this.rctx.beginPath(),this.rctx.arc(50,-50,"rotation"===this.control?12:8,0,2*Math.PI,!1),this.rctx.closePath(),this.rctx.fill(),this.rctx.fillStyle="rotation"===this.control?n.xZ:n.Bs,this.rctx.beginPath(),this.rctx.arc(50,-50,"rotation"===this.control?10:6,0,2*Math.PI,!1),this.rctx.closePath(),this.rctx.fill()),this.rctx.fillStyle=n.wf,this.rctx.beginPath(),this.rctx.arc(0,0,"center"===this.control?12:10,0,2*Math.PI,!1),this.rctx.closePath(),this.rctx.fill(),this.rctx.fillStyle="center"===this.control?n.xZ:n.XI,this.rctx.beginPath(),this.rctx.arc(0,0,"center"===this.control?10:8,0,2*Math.PI,!1),this.rctx.closePath(),this.rctx.fill(),this.rctx.restore()},this.reset=()=>{this.options={bokehBlur:!1,bokehBlurType:"circle",bokehBlurSize:.3,bokehBlurIntensity:.5,bokehShape:!1,bokehShapeDual:!1,bokehShapeType:"circle",bokehShapeHue:0,bokehShapeSize:.4,bokehShapeQuantity:.4,bokehShapeIntensity:.6},this.blurAmount.setValue(0),this.selected=void 0,this.cached=void 0,this.shape=void 0,this.blur=void 0,window.requestAnimationFrame((()=>{this.renderControls()})),this.layerSelect(),document.dispatchEvent(new CustomEvent("notification",{detail:(0,a.Z)("reset")}))},this.applyClick=()=>{this.blocked?new g.Z(this.stage,"STUDIO"):this.apply()},this.apply=()=>{if(this.blocked||!this.selected||!this.stage.fresco.hasLayer(this.selected))return;if(0===this.blurAmount.getValue()&&!this.options.bokehShape&&!this.options.bokehBlur)return;const e=new o.Z(0,0,this.selected.rect.width,this.selected.rect.height),t=n.$E(this.selected.canvas);this.scratch.drawToLayer(this.selected),this.scratch.clear(),this.selected.render(),this.shaders.reset(),this.options.bokehBlur=!1,this.options.bokehShape=!1,this.blurAmount.setValue(0),this.stage.history.add({type:"bitmapChange",kind:"focus",layer:this.selected,patchRect:e,patch:t,rect:this.selected.rect.clone()}),this.layerSelect(),this.rctx.clearRect(0,0,this.raster.width,this.raster.height)},this.cleanUp=async()=>{var e;this.blocked||0===this.blurAmount.getValue()&&!this.options.bokehShape&&!this.options.bokehBlur||this.apply(),this.stage.fresco.block&&this.stage.fresco.setBlock(),this.removeMoveListeners(),this.removeDownListeners(),this.rctx.clearRect(0,0,this.raster.width,this.raster.height),this.stage.fresco.removeScratch(),null===(e=this.shaders)||void 0===e||e.cleanUp(),this.shaders=void 0,this.blurAmount.cleanUp(),(0,i.ZP)("focus-invert").removeEventListener("click",this.renderFocus,!0),(0,i.ZP)("focus-options").removeEventListener("click",this.showOptions,!0),(0,i.ZP)("focus-mode-symmetric").removeEventListener("change",this.selectMode,!1),(0,i.ZP)("focus-mode-linear").removeEventListener("change",this.selectMode,!1),(0,i.ZP)("focus-mode-radial").removeEventListener("change",this.selectMode,!1),(0,i.ZP)("focus-mode-none").removeEventListener("change",this.selectMode,!1),(0,i.ZP)("focus-apply").removeEventListener("click",this.applyClick,!1),(0,i.ZP)("focus-reset").removeEventListener("click",this.reset,!1),document.removeEventListener("layer-select",this.layerSelect,!1),document.removeEventListener("viewport-render",this.renderControls,!1),window.requestAnimationFrame((()=>this.stage.render())),this.cached=void 0,this.shape=void 0,this.blur=void 0,this.raster=void 0,this.rctx=void 0},this.matrix=new u.Z,this.shaders=new d.Z,this.raster=e.raster,this.rctx=this.raster.getContext("2d"),this.blocked=null===(t=!c.ZP.user.subscription)||void 0===t||t,this.blocked&&this.stage.fresco.setBlock(!0),(0,i.ZP)("focus-mode-symmetric").addEventListener("change",this.selectMode,!1),(0,i.ZP)("focus-mode-linear").addEventListener("change",this.selectMode,!1),(0,i.ZP)("focus-mode-radial").addEventListener("change",this.selectMode,!1),(0,i.ZP)("focus-mode-none").addEventListener("change",this.selectMode,!1),(0,i.ZP)("focus-invert").addEventListener("click",this.renderFocus,!0),(0,i.ZP)("focus-options").addEventListener("click",this.showOptions,!0),this.blurAmount=new l.Z("focus-blur-amount",{label:(0,a.Z)("blur")+":",range:[0,1],step:.01,compact:!0,defaultValue:0,labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,onEnd:e=>this.renderBlurEvent()}),(0,i.ZP)("focus-apply").addEventListener("click",this.applyClick,!1),(0,i.ZP)("focus-reset").addEventListener("click",this.reset,!1),document.addEventListener("layer-select",this.layerSelect,!1),document.addEventListener("viewport-render",this.renderControls,!1),this.mode=document.querySelector('input[name="focus-mode"]:checked').value,this.options={bokehBlur:!1,bokehBlurType:"circle",bokehBlurSize:.3,bokehBlurIntensity:.5,bokehShape:!1,bokehShapeDual:!1,bokehShapeType:"circle",bokehShapeHue:0,bokehShapeSize:.4,bokehShapeQuantity:.4,bokehShapeIntensity:.6},this.addDownListeners(),this.addMoveListeners(),this.layerSelect()}}},167:(e,t,s)=>{s.d(t,{Z:()=>w});var i=s(3947),a=s(3655),n=s(6817),o=s(8203),r=s(4170),h=s(2817),l=s(8495),c=s(7976),d=s(6548),u=s(8829),p=s(8776),g=s(4820),m=s(4211),v=s(4178),f=s(4188);class y extends u.Z{constructor(e,t){super(t,(0,d.Z)("styles"),!0),this.updateInputs=()=>{(0,i.ZP)("frame-outline").checked=this.selected.frameSettings.outline,this.outlineColor.setColor(this.selected.frameSettings.outlineColor),this.outlineSize.setValue(this.selected.frameSettings.outlineSize),(0,i.ZP)("frame-shadow").checked=this.selected.frameSettings.shadow,this.shadowColor.setColor(this.selected.frameSettings.shadowColor),this.shadowBlur.setValue(this.selected.frameSettings.shadowBlur),this.shadowOpacity.setValue(this.selected.frameSettings.shadowOpacity),this.shadowDistance.setValue(this.selected.frameSettings.shadowDistance),this.shadowDirection.setValue(this.selected.frameSettings.shadowDirection)},this.changeOutlineState=()=>{const e=this.selected.frameSettings.clone();this.changeOutline(),this.stage.history.add({type:"frameSettings",kind:"outline",layer:this.selected,settings:e})},this.changeOutline=()=>{let e=(0,i.ZP)("frame-outline").checked,t=this.outlineColor.getColor().toHEX(),s=this.outlineSize.getValue();this.selected.setOutline(e,s,t),document.dispatchEvent(new CustomEvent("viewport-render"))},this.changeOutlineColor=e=>{const t=this.selected.frameSettings.clone();this.changeOutline(),this.stage.history.add({type:"frameSettings",kind:"outline",layer:this.selected,settings:t})},this.changeShadowState=()=>{const e=this.selected.frameSettings.clone();this.changeShadow(),this.stage.history.add({type:"frameSettings",kind:"shadow",layer:this.selected,settings:e})},this.changeShadow=()=>{this.selected.setShadow((0,i.ZP)("frame-shadow").checked,this.shadowBlur.getValue(),this.shadowOpacity.getValue(),this.shadowColor.getColor().toHEX(),this.shadowDistance.getValue(),this.shadowDirection.getValue()),document.dispatchEvent(new CustomEvent("viewport-render"))},this.changeShadowColor=e=>{const t=this.selected.frameSettings.clone();this.changeShadow(),this.stage.history.add({type:"frameSettings",kind:"shadow",layer:this.selected,settings:t})},this.cleanUp=()=>{this.selected=void 0,this.outlineColor.cleanUp(),this.outlineColor=void 0,this.shadowColor.cleanUp(),this.shadowColor=void 0,this.outlineSize.cleanUp(),this.shadowBlur.cleanUp(),this.shadowOpacity.cleanUp(),this.shadowDistance.cleanUp(),this.shadowDirection.cleanUp(),(0,i.ZP)("frame-outline").removeEventListener("change",this.changeOutlineState,!1),(0,i.ZP)("frame-shadow").removeEventListener("change",this.changeShadowState,!1),this.superClean()},this.stage=e,this.selected=this.stage.fresco.getSelected(),this.content.id="frame-style-content",this.content.style.height="333px",this.content.style.overflow="hidden",this.content.style.paddingBottom="4px",this.setContent(`\n            <section>\n                <div>\n                    <input type="checkbox" class="toggle-check" id="frame-outline" />\n                    <label class="switch subline pad-4" for="frame-outline">${(0,d.Z)("outline")}<span></span><span class="arrow"></span></label>\n                    <div class="toggle">\n                        <label class="split">${(0,d.Z)("color")}<div id="frame-outline-color" class="pad-4"></div></label>\n                        <div id="frame-outline-size" class="pad-10"></div>\n                    </div>\n                </div>\n                <div>\n                    <input type="checkbox" class="toggle-check" id="frame-shadow" />\n                    <label class="switch subline pad-10" for="frame-shadow">${(0,d.Z)("shadow")}<span></span><span class="arrow"></span></label>\n                    <div class="toggle">\n                        <label class="split">${(0,d.Z)("color")}<div id="frame-shadow-color" class="pad-4"></div></label>\n                        <div id="frame-shadow-blur" class="pad-10"></div>\n                        <div id="frame-shadow-distance"></div>\n                        <div id="frame-shadow-direction"></div>\n                        <div id="frame-shadow-opacity"></div>\n                    </div>\n                </div>\n            </section>\n        `),this.outlineColor=new m.Z("frame-outline-color",p.Z.fromHEX(g.ZP.altColor),this.changeOutlineColor),this.shadowColor=new m.Z("frame-shadow-color",p.Z.fromHEX(g.ZP.altColor),this.changeShadowColor);let s=this.selected.frameSettings;const a={onStart:()=>{s=this.selected.frameSettings.clone()},labelFormat:e=>(100*e).toFixed(0),labelParse:e=>parseInt(e,100)/100};this.outlineSize=new f.Z("frame-outline-size",Object.assign(Object.assign({},a),{label:(0,d.Z)("size"),range:[.01,1],defaultValue:.3,step:.01,onChange:()=>this.changeOutline(),labelFormat:e=>(100*e).toFixed(0),labelParse:e=>parseInt(e,100)/100,onEnd:()=>{this.stage.history.add({type:"frameSettings",kind:"outline",layer:this.selected,settings:s})}}));const n=Object.assign(Object.assign({},a),{range:[0,1],onChange:()=>this.changeShadow(),onEnd:()=>{this.stage.history.add({type:"frameSettings",kind:"shadow",layer:this.selected,settings:s})}});this.shadowBlur=new f.Z("frame-shadow-blur",Object.assign(Object.assign({},n),{label:(0,d.Z)("blur")})),this.shadowOpacity=new f.Z("frame-shadow-opacity",Object.assign(Object.assign({},n),{label:(0,d.Z)("opacity"),defaultValue:1})),this.shadowDistance=new f.Z("frame-shadow-distance",Object.assign(Object.assign({},n),{label:(0,d.Z)("distance"),range:[0,1]})),this.shadowDirection=new f.Z("frame-shadow-direction",Object.assign(Object.assign({},n),{label:(0,d.Z)("direction"),range:[0,360],defaultValue:180,labelFormat:e=>e.toFixed(1),labelParse:e=>parseInt(e,10)})),(0,i.ZP)("frame-outline").addEventListener("change",this.changeOutlineState,!1),(0,i.ZP)("frame-shadow").addEventListener("change",this.changeShadowState,!1),this.updateInputs(),new v.Z(this.content)}}class w extends o.Z{constructor(e){super("frame",e),this.stage=e,this.showFrameStyles=()=>{new y(this.stage,(0,i.ZP)("frame-styles"))},this.keyDown=e=>{"Shift"!==e.key||this.isShiftDown||(this.isShiftDown=!0,this.reform.constrain=!1)},this.keyUp=e=>{"Shift"===e.key&&this.isShiftDown&&(this.isShiftDown=!1,this.reform.constrain=!0)},this.previewShape=e=>{this.selected.setPath(e,!0),window.requestAnimationFrame((()=>this.stage.render()))},this.selectShape=e=>{const t=this.selected.frameSettings.clone();this.selected.setPath(e),this.stage.history.add({type:"frameSettings",kind:"shape",layer:this.selected,settings:t}),window.requestAnimationFrame((()=>this.stage.render()))},this.layerSelect=()=>{if(this.selected&&this.selected!==this.stage.fresco.getSelected()&&(this.selected.editMode=!1,this.stage.history.commitTransaction()),!this.stage.fresco.isSelectedType(r.Z.TYPE_FRAME))return(0,i.ZP)("frame-settings").style.display="none",(0,i.ZP)("frame-no-layer").style.display="flex",void(this.selected=void 0);(0,i.ZP)("frame-settings").style.display="flex",(0,i.ZP)("frame-no-layer").style.display="none",this.selected=this.stage.fresco.getSelected(),this.shapePod.setPath(this.selected.frameSettings.clip)},this.toggle=()=>{this.selected.editMode||this.selected.canvas?(this.selected.editMode=!this.selected.editMode,document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render"))):this.stage.notify("frameNoContent")},this.reformDown=(e,t)=>{this.downPoint=e,this.usedtobe=t,this.stage.coating.freeze(!0),this.addMoveListeners()},this.move=e=>{const t=this.stage.translateToRect(this.downPoint,e,this.isShiftDown,!0);t.width>0&&t.height>0&&this.drawframe(t.topLeft(),t.bottomRight()),document.dispatchEvent(new CustomEvent("legend",{detail:"W: "+Math.round(t.width/this.stage.zoom)+"  H: "+Math.round(t.height/this.stage.zoom)}))},this.drawframe=(e,t)=>{const s=this.stage.coating.ctx;s.save(),s.lineWidth=2,s.strokeStyle=a.xZ,s.clearRect(0,0,s.canvas.width,s.canvas.height),s.strokeRect(e.x,e.y,t.x-e.x,t.y-e.y),s.lineWidth=1,s.beginPath(),s.moveTo(e.x,e.y),s.lineTo(t.x,t.y),s.moveTo(t.x,e.y),s.lineTo(e.x,t.y),s.closePath(),s.stroke()},this.up=async e=>{if(this.stage.coating.clear(!0),this.stage.coating.freeze(!1),this.removeMoveListeners(),document.dispatchEvent(new CustomEvent("legend",{detail:"stop"})),this.downPoint.distanceTo(e)>10){const t=this.stage.translateToRect(this.downPoint,e,this.isShiftDown,!1);this.addFrame(t)}else this.usedtobe||await new c.Z("Add Frame","Do you want to add a new Frame layer?","Add").init()&&this.addFrameEvent()},this.addFrameEvent=()=>{let e=this.stage.getViewPort(),t=new n.Z(Math.round(e.x+e.width/4),Math.round(e.y+e.height/4),Math.round(e.width/2),Math.round(e.width/2));this.addFrame(t)},this.addFrame=e=>{this.stage.addFrame(e)},this.deleteLayer=()=>this.stage.deleteLayer(),this.duplicateLayer=()=>this.stage.duplicateLayer(),this.cleanUp=()=>{var e,t;this.stage.history.commitTransaction(),null===(e=this.reform)||void 0===e||e.cleanUp(),this.reform=void 0,this.shapePod.cleanUp(),this.shapePod=void 0,null===(t=this.stage)||void 0===t||t.coating.wake(),(0,i.ZP)("frame-toggle").removeEventListener("click",this.toggle,!1),(0,i.ZP)("frame-add-button").removeEventListener("click",this.addFrameEvent,!1),(0,i.ZP)("frame-browse").removeEventListener("click",this.stage.browseFrameImage,!1),(0,i.ZP)("frame-add").removeEventListener("click",this.addFrameEvent,!1),(0,i.ZP)("frame-delete").removeEventListener("click",this.deleteLayer,!1),(0,i.ZP)("frame-duplicate").removeEventListener("click",this.duplicateLayer,!1),(0,i.ZP)("frame-styles").removeEventListener("click",this.showFrameStyles,!1),document.removeEventListener("layer-select",this.layerSelect,!1),document.removeEventListener("keydown",this.keyDown,!1),document.removeEventListener("keyup",this.keyUp,!1)},this.stage.coating.sleep(),document.addEventListener("layer-select",this.layerSelect,!1),document.addEventListener("keydown",this.keyDown,!1),document.addEventListener("keyup",this.keyUp,!1),(0,i.ZP)("frame-toggle").addEventListener("click",this.toggle,!1),(0,i.ZP)("frame-add-button").addEventListener("click",this.addFrameEvent,!1),(0,i.ZP)("frame-browse").addEventListener("click",this.stage.browseFrameImage,!1),(0,i.ZP)("frame-add").addEventListener("click",this.addFrameEvent,!1),(0,i.ZP)("frame-delete").addEventListener("click",this.deleteLayer,!1),(0,i.ZP)("frame-duplicate").addEventListener("click",this.duplicateLayer,!1),(0,i.ZP)("frame-styles").addEventListener("click",this.showFrameStyles,!1),this.reform=new h.Z(e,"FRAME"),this.reform.proxy=this.reformDown,this.shapePod=new l.Z("frame-shape",this.selectShape,this.previewShape),this.layerSelect()}}},709:(e,t,s)=>{s.d(t,{Z:()=>m});var i=s(3947),a=s(6548),n=s(3655),o=s(7359),r=s(6817),h=s(8203),l=s(8776),c=s(4188),d=s(4170),u=s(4820),p=s(5131),g=s(7175);class m extends h.Z{constructor(e){super("gradient",e),this.isShiftDown=!1,this.shiftDown=e=>{"Shift"===e.key&&(this.isShiftDown=!0)},this.shiftUp=e=>{"Shift"===e.key&&(this.isShiftDown=!1)},this.layerSelect=()=>{if(!this.stage.fresco.isSelectedType(d.Z.TYPE_IMAGE))return(0,i.ZP)("gradient-no-layer").style.display="flex",(0,i.ZP)("gradient-settings").style.display="none",this.stage.raster.style.cursor="auto",void(this.selected=null);(0,i.ZP)("gradient-no-layer").style.display="none",(0,i.ZP)("gradient-settings").style.display="flex",this.stage.raster.style.cursor="crosshair",this.selected=this.stage.fresco.getSelected(),this.scratch=this.stage.fresco.addScratch(),this.scratch.setTarget(this.selected.id,new r.Z(0,0,this.stage.fresco.width,this.stage.fresco.height),"over")},this.down=e=>{this.selected&&(this.stage.coating.freeze(!0),this.downPoint=e,this.stage.coating.ctx.strokeStyle=n.wf,this.stage.coating.ctx.fillStyle=n.xZ,this.addMoveListeners())},this.move=e=>{if(this.isShiftDown){const t=this.downPoint.x-e.x,s=this.downPoint.y-e.y;Math.abs(t)<Math.abs(s)?e.x=this.downPoint.x:e.y=this.downPoint.y}window.requestAnimationFrame((()=>{this.downPoint&&(this.stage.coating.clear(!0),this.stage.coating.ctx.lineWidth=2,g.Z.line(this.stage.coating.ctx,this.downPoint,e),this.stage.coating.ctx.stroke(),g.Z.arc(this.stage.coating.ctx,this.downPoint,6),this.stage.coating.ctx.fill(),this.stage.coating.ctx.stroke(),g.Z.arc(this.stage.coating.ctx,e,6),this.stage.coating.ctx.fill(),this.stage.coating.ctx.stroke(),this.stage.coating.ctx.lineWidth=1,this.stage.coating.render())}))},this.up=e=>{if(this.stage.coating.ctx.clearRect(0,0,this.stage.raster.width,this.stage.raster.height),this.stage.coating.freeze(!1),this.removeMoveListeners(),this.downPoint.x===e.x&&this.downPoint.y===e.y)return;if(this.downPoint=this.stage.translateRasterToFresco(this.downPoint),e=this.stage.translateRasterToFresco(e),this.isShiftDown){const t=this.downPoint.x-e.x,s=this.downPoint.y-e.y;Math.abs(t)<Math.abs(s)?e.x=this.downPoint.x:e.y=this.downPoint.y}let t,s=document.querySelector('input[name="gradient-type"]:checked').value;if(this.scratch.clear(),this.scratch.ctx.save(),"radial"===s){const s=this.downPoint.x-e.x,i=this.downPoint.y-e.y;t=this.scratch.ctx.createRadialGradient(this.downPoint.x,this.downPoint.y,0,this.downPoint.x,this.downPoint.y,Math.sqrt(s*s+i*i))}else t=this.scratch.ctx.createLinearGradient(this.downPoint.x,this.downPoint.y,e.x,e.y);this.downPoint=void 0,this.gradPod.grad.addStopToCanvasGradient(t),this.scratch.ctx.fillStyle=t,this.scratch.ctx.fillRect(0,0,this.scratch.canvas.width,this.scratch.canvas.height),this.scratch.ctx.restore(),this.scratch.applySelection(this.stage);let a=n.l(this.scratch.getCanvas());if(a&&a.width>0&&a.height>0){let e=n.$E(this.selected.canvas,this.selected.rect?a.rebase(this.selected.rect.x,this.selected.rect.y):a);const t=n.dN(this.selected.mask),s=this.selected.rect?this.selected.rect.clone():void 0;this.selected.extendCanvas(a),this.scratch.drawToLayer(this.selected,(0,i.ZP)("gradient-blend").value,this.opacity.getValue()),this.scratch.clear(),this.selected.render(),this.stage.history.add({type:"bitmapChange",kind:"gradient",layer:this.selected,patchRect:this.selected.rect?a.rebase(this.selected.rect.x,this.selected.rect.y):a,patch:e,rect:s,mask:t})}window.requestAnimationFrame((()=>this.stage.render()))},this.cleanUp=()=>{var e;null===(e=this.stage.fresco)||void 0===e||e.removeScratch(),this.removeDownListeners(),document.removeEventListener("layer-select",this.layerSelect,!1),document.removeEventListener("keydown",this.shiftDown,!1),document.removeEventListener("keyup",this.shiftUp,!1),this.gradPod.cleanUp(),this.opacity.cleanUp()},document.addEventListener("layer-select",this.layerSelect,!1),document.addEventListener("keydown",this.shiftDown,!1),document.addEventListener("keyup",this.shiftUp,!1);let t=new o.ZP;t.addStop(l.Z.fromHEX(u.ZP.mainColor),0),t.addStop(l.Z.fromHEX(u.ZP.altColor),1),this.gradPod=new p.Z("gradient-grad",t),this.opacity=new c.Z("gradient-opacity",{compact:!0,label:(0,a.Z)("opacity")+":",defaultValue:1,labelFormat:e=>(100*e).toFixed(0)+"%"}),this.addDownListeners(),this.layerSelect()}}},7375:(e,t,s)=>{s.d(t,{Z:()=>n});var i=s(3947),a=s(8203);class n extends a.Z{constructor(e){super("hand",e),this.stage=e,this.z1x=()=>{this.stage.setZoom("1")},this.fit=()=>{this.stage.setZoom("fit")},this.fill=()=>{this.stage.setZoom("fill")},this.cleanUp=()=>{this.stage.coating.removePan(),this.removeDownListeners(),(0,i.ZP)("hand-1x").removeEventListener("click",this.z1x,!1),(0,i.ZP)("hand-fit").removeEventListener("click",this.fit,!1),(0,i.ZP)("hand-fill").removeEventListener("click",this.fill,!1)},(0,i.ZP)("hand-1x").addEventListener("click",this.z1x,!1),(0,i.ZP)("hand-fit").addEventListener("click",this.fit,!1),(0,i.ZP)("hand-fill").addEventListener("click",this.fill,!1),this.stage.coating.setPan(),this.addDownListeners()}}},4230:(e,t,s)=>{s.d(t,{Z:()=>f});var i=s(3947),a=s(6548),n=s(3655),o=s(6817),r=s(8203),h=s(4188),l=s(3673),c=s(8776),d=s(2257),u=s(4820),p=s(972);class g{constructor(e){this.stage=e,this.resize=()=>{const e=document.querySelector(".raster");this.container.style.top=e.style.top,this.container.style.left=e.style.left,this.container.style.width=e.style.width},this.bar=(0,i.T)("div"),this.container=(0,i.T)("div",{id:"workspace-progress"},this.bar),(0,i.ZP)("workspace").append(this.container),this.resize(),document.addEventListener("viewport-update",this.resize),document.addEventListener("resize",this.resize)}update(e){this.bar.style.width=`${(100*e).toFixed(0)}%`}show(){this.bar.style.width="0",this.container.style.display="block",this.resize()}hide(){this.container.style.display="none",this.resize()}cleanUp(){this.bar.remove()}}var m=s(7282);const v={speed:[2,20],balanced:[20,20],quality:[50,50],ultra:[100,100]};class f extends r.Z{constructor(e){var t;super("heal",e),this.workset=null,this.blocked=!1,this.changeMode=()=>{this.mode=document.querySelector('input[name="heal-mode"]:checked').value,"object"===this.mode&&this.blocked?(this.stage.fresco.setBlock(!0),this.setAlternativeCanvas()):(this.stage.fresco.setBlock(),this.updateBrush(),this.selected&&this.selected.transient&&(this.selected.transient=void 0,this.cleanUpWorker(),this.worker=new m.$p)),this.stage.render(),(0,i.ZP)("heal-presets").style.display="object"===this.mode?"flex":"none"},this.setAlternativeCanvas=()=>{"object"===this.mode&&this.blocked&&this.selected&&this.selected.setAltCanvas()},this.layerSelect=()=>{var e,t;if((null===(e=this.selected)||void 0===e?void 0:e.id)!==(null===(t=this.stage.fresco.getSelected())||void 0===t?void 0:t.id)&&(this.cleanUpWorker(),this.worker=new m.$p,this.selected&&this.selected.transient&&(this.selected.transient=void 0,this.stage.render())),!this.stage.fresco.isSelectedImageWithCanvas())return(0,i.ZP)("heal-no-layer").style.display="flex",(0,i.ZP)("heal-settings").style.display="none",this.selected=null,void this.updateBrush();(0,i.ZP)("heal-settings").style.display="flex",(0,i.ZP)("heal-no-layer").style.display="none",this.selected=this.stage.fresco.getSelected(),this.scratch=this.stage.fresco.addScratch(),this.scratch.setTarget(this.selected.id,this.selected.rect,"over"),this.scratch.settings.opacity=.4,this.setAlternativeCanvas(),this.updateBrush()},this.keyDown=e=>{if(","===e.key||"."===e.key){switch(e.key){case",":this.size.setValue(this.size.getValue()-10);break;case".":this.size.setValue(this.size.getValue()+10)}this.brush.settings.size=this.size.getValue(),this.updateBrush()}},this.updateBrush=()=>{this.brush.generate(new c.Z(0,255,0,255)),this.selected?this.stage.coating.setCursorImage(this.brush.getCursorImage(this.stage.zoom)):this.stage.coating.removeCursorImage()},this.down=(e,t)=>{if(!this.selected||null!==this.workset)return;let s=document.querySelector('input[name="heal-mode"]:checked').value;"spot"===s?(this.stage.coating.animateCursorTap(),this.applyHealSpot(e)):"soft"===s?(this.stage.coating.animateCursorTap(),this.applyHealSoft(e)):(this.brushPoints=[],this.x=this.y=-1,"touch"!==t&&this.move(e),this.addMoveListeners())},this.x=-1,this.y=-1,this.move=e=>{let t=this.brush.getStep(),s=!1;if(e=this.stage.translateRasterToFresco(e,this.selected.rect),-1==this.x&&(this.lx=e.x,this.ly=e.y,this.x=e.x,this.y=e.y,this.drawShape(this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),s=!0),e.x!==this.x||e.y!==this.y){let i=e.x-this.x,a=e.y-this.y,n=i>0?1:-1,o=a>0?1:-1;if(i=i<0?-i:i,a=a<0?-a:a,i>a){let e=.5*i;for(let r=1;r<=i;r++)this.x+=n,e+=a,e>=i&&(e-=i,this.y+=o),(this.x>this.lx+t||this.x<this.lx-t||this.y>this.ly+t||this.y<this.ly-t)&&(this.lx=this.x,this.ly=this.y,this.drawShape(this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),s=!0)}else{let e=.5*a;for(let r=1;r<=a;r++)this.y+=o,e+=i,e>=a&&(e-=a,this.x+=n),(this.x>this.lx+t||this.x<this.lx-t||this.y>this.ly+t||this.y<this.ly-t)&&(this.lx=this.x,this.ly=this.y,this.drawShape(this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),s=!0)}}s&&window.requestAnimationFrame((()=>this.stage.render()))},this.drawShape=(e,t)=>{this.brushPoints.push(new l.Z(e,t)),this.scratch.ctx.drawImage(this.brush.canvas,e,t)},this.up=async e=>{try{this.removeMoveListeners();const e=document.querySelector('input[name="heal-preset"]:checked').value,[t,s]=v[e];let i=50;"ultra"===e&&(i=100);let a=o.Z.fromPointRects(this.brushPoints,this.brush.canvas.width,this.brush.canvas.height);if(a.x-=i,a.y-=i,a.width+=2*i,a.height+=2*i,a=a.intersect(new o.Z(0,0,this.scratch.canvas.width,this.scratch.canvas.height)),!a)return;const r=n.$E(this.selected.canvas,a);if(this.workset=[a,r],await this.fill(a,!0,t,s),this.blocked)return;this.stage.history.add({type:"bitmapChange",kind:"healObject",layer:this.selected,patchRect:a,patch:r,rect:this.selected.rect.clone()})}finally{this.workset=null}},this.applyHealSpot=async e=>{try{(e=this.stage.translateRasterToFresco(e,this.selected.rect)).x-=~~(this.brush.canvas.width/2),e.y-=~~(this.brush.canvas.height/2),this.scratch.ctx.drawImage(this.brush.canvas,e.x,e.y);let t=this.brush.canvas.width,s=this.brush.canvas.height;const i=50;let a=new o.Z(e.x-i,e.y-i,t+2*i,s+2*i);if(a=a.intersect(new o.Z(0,0,this.scratch.canvas.width,this.scratch.canvas.height)),!a)return;const r=n.$E(this.selected.canvas,a);this.workset=[a,r];const[h,l]=v.balanced;await this.fill(a,!1,h,l),this.stage.history.add({type:"bitmapChange",kind:"healSpot",layer:this.selected,patchRect:a,patch:r,rect:this.selected.rect.clone()})}finally{this.workset=null}},this.fill=async(e,t,s,i)=>{t&&(this.stage.coating.removeCursorImage(),this.progress.show());const a=this.selected.getCanvas().getContext("2d"),o=a.getImageData(e.x,e.y,e.width,e.height),r=n.vL(e.width,e.height),h=r.getContext("2d");h.fillStyle="#fff",h.fillRect(0,0,e.width,e.height),h.drawImage(this.scratch.canvas,e.x,e.y,e.width,e.height,0,0,e.width,e.height);const l=h.getImageData(0,0,e.width,e.height);this.worker.send({image:o,neighbour:s,random:i,mask:l,intermediateImage:t},[o.data.buffer,l.data.buffer]),h.globalCompositeOperation="copy",h.drawImage(this.scratch.canvas,e.x,e.y,e.width,e.height,0,0,e.width,e.height);const c=n.vL(e.width,e.height),d=c.getContext("2d");for(d.globalCompositeOperation="destination-atop",this.scratch.clear(),this.stage.render();;){const{progress:t,image:s}=await this.worker.receive();if("done"===t){this.progress.update(1),a.putImageData(s,e.x,e.y);break}this.progress.update(t),s&&(d.putImageData(s,0,0),d.drawImage(r,0,0),a.drawImage(c,0,0,e.width,e.height,e.x,e.y,e.width,e.height),window.requestAnimationFrame((()=>{this.stage.render()})))}t&&(setTimeout((()=>this.progress.hide()),300),this.updateBrush()),this.selected.render(),this.scratch.clear(),this.stage.render()},this.cleanUpWorker=()=>{var e;if(null===(e=this.worker)||void 0===e||e.terminate(),this.progress.hide(),this.workset){const[e,t]=this.workset;this.selected.getCanvas().getContext("2d").putImageData(t,e.x,e.y),this.stage.render(),this.workset=null}},this.apply=()=>{this.blocked&&((0,i.ZP)("heal-mode-spot").checked=!0,this.changeMode())},this.applyHealSoft=e=>{(e=this.stage.translateRasterToFresco(e,this.selected.rect)).x-=~~(this.brush.canvas.width/2),e.y-=~~(this.brush.canvas.height/2);let t=this.brush.canvas.width,s=this.brush.canvas.height;const i=new o.Z(e.x,e.y,t,s),a=n.$E(this.selected.canvas,i);this.blendImages(e),this.selected.render(),this.stage.render(),this.stage.history.add({type:"bitmapChange",kind:"healSoft",layer:this.selected,patchRect:i,patch:a,rect:this.selected.rect.clone()})},this.blendImages=e=>{let t=this.brush.canvas.width,s=this.brush.canvas.height,i=this.brush.canvas.getContext("2d").getImageData(0,0,t,s),a=this.selected.canvas.getContext("2d");var n=a.getImageData(e.x,e.y,t,s),r=a.getImageData(e.x,e.y,t,s);r=this.createGradient(r,n);let h=new o.Z(e.x-t,e.y-s,3*t,3*s),l=a.getImageData(h.x,h.y,h.width,h.height);var c=this.locateBestTexture(l,h,t);c.x+=e.x-t,c.y+=e.y-s;var d=a.getImageData(c.x,c.y,t,s);let u,p,g,m=1,v=0,f=0,y=0,w=0,b=0,x=0,Z=0,k=0;for(;;){for(u=0,p=0,y=1;y<s-1;y++)for(f=1;f<t-1;f++)if(w=4*(y*t+f),i.data[w+3]>0)for(g=[4*((y-1)*t+f),4*((y+1)*t+f),4*(y*t+(f-1)),4*(y*t+(f+1))],x=0;x<3;x++){for(Z=0,b=0;b<4;b++)i.data[w+3]>64?Z+=r.data[g[b]+x]:Z+=n.data[g[b]+x],Z+=d.data[w+x]-d.data[g[b]+x];k=Z/4,u+=Math.abs(k-r.data[w+x]),p+=Math.abs(k),r.data[w+x]=k}v++;var P=u/p;if(!P||m-P==0||v>250)break;m=P}a.putImageData(r,e.x,e.y)},this.locateBestTexture=(e,t,s)=>{let i=this.sobel(e),a=new l.Z(-1,-1),n=Number.POSITIVE_INFINITY,r=new l.Z(Math.round(t.width/2),Math.round(t.height/2));const h=Math.round(s/2);let c=new o.Z(0,0,this.selected.canvas.width,this.selected.canvas.height);for(let l=0;l<40;l++){const e=r.y-Math.round(Math.sin(2*Math.PI*l/40)*s),d=r.x+Math.round(Math.cos(2*Math.PI*l/40)*s);if(!c.contains(new o.Z(d-h+t.x,e-h+t.y,s,s)))continue;let u=this.computeEnergy(i,t.width,d-h,e-h,s);u<n&&(n=u,a.x=d-h,a.y=e-h)}return a},this.computeEnergy=(e,t,s,i,a)=>{let n=0;for(let o=i;o<i+a;o+=2)for(let i=s;i<s+a;i+=2){let s=e[o*t+i];n+=s*s}return n},this.pixelAt=(e,t,s,i)=>s[t*i+e],this.sobel=e=>{var t,s,i,a=e.width,n=e.height,o=[[-1,0,1],[-2,0,2],[-1,0,1]],r=[[-1,-2,-1],[0,0,0],[1,2,1]],h=new Array,l=new Array;for(s=0;s<n;s++)for(t=0;t<a;t++)i=4*(s*a+t),l.push(Math.round((e.data[i]+e.data[i+1]+e.data[i+2])/3));for(s=0;s<n;s++)for(t=0;t<a;t++){var c=o[0][0]*this.pixelAt(t-1,s-1,l,a)+o[0][1]*this.pixelAt(t,s-1,l,a)+o[0][2]*this.pixelAt(t+1,s-1,l,a)+o[1][0]*this.pixelAt(t-1,s,l,a)+o[1][1]*this.pixelAt(t,s,l,a)+o[1][2]*this.pixelAt(t+1,s,l,a)+o[2][0]*this.pixelAt(t-1,s+1,l,a)+o[2][1]*this.pixelAt(t,s+1,l,a)+o[2][2]*this.pixelAt(t+1,s+1,l,a),d=r[0][0]*this.pixelAt(t-1,s-1,l,a)+r[0][1]*this.pixelAt(t,s-1,l,a)+r[0][2]*this.pixelAt(t+1,s-1,l,a)+r[1][0]*this.pixelAt(t-1,s,l,a)+r[1][1]*this.pixelAt(t,s,l,a)+r[1][2]*this.pixelAt(t+1,s,l,a)+r[2][0]*this.pixelAt(t-1,s+1,l,a)+r[2][1]*this.pixelAt(t,s+1,l,a)+r[2][2]*this.pixelAt(t+1,s+1,l,a),u=Math.sqrt(c*c+d*d)>>>0;h.push(u)}return h},this.createGradient=(e,t)=>{var s,i,a=Math.round(.4*t.height);let n=Math.round(.1*a),o=~~(t.width/2),r=~~(t.height/2),h=t.width,l=0,c=0;for(var d=-a;d<a;d++)for(var u=-a;u<a;u++)(i=(Math.sqrt(d*d+u*u)+1)/(a-1))<1&&(s=Math.round(u/i+(Math.random()*n-n/2)),l=4*((r+d)*h+(o+u)),c=4*((r+Math.round(d/i+(Math.random()*n-n/2)))*h+(o+s)),e.data[l]=t.data[c],e.data[l+1]=t.data[c+1],e.data[l+2]=t.data[c+2]);n=Math.round(.5*a);for(d=-(a=Math.round(.8*a));d<a;d++)for(u=-a;u<a;u++)Math.sqrt(d*d+u*u)<a&&(s=Math.round(u+(Math.random()*n-n/2)),l=4*((r+d)*h+(o+u)),c=4*((r+Math.round(d+(Math.random()*n-n/2)))*h+(o+s)),e.data[l]=e.data[c],e.data[l+1]=e.data[c+1],e.data[l+2]=e.data[c+2]);return e},this.cleanUp=()=>{var e;this.cleanUpWorker(),this.stage.fresco.block&&this.stage.fresco.setBlock(),this.selected&&this.selected.transient&&(this.selected.transient=void 0,this.stage.render()),null===(e=this.stage.fresco)||void 0===e||e.removeScratch(),this.removeDownListeners(),document.removeEventListener("layer-select",this.layerSelect,!1),document.removeEventListener("zoom-change",this.updateBrush,!1),document.removeEventListener("fresco-select",this.changeMode,!1),document.removeEventListener("keydown",this.keyDown,!1),this.size.cleanUp(),this.progress.cleanUp(),document.getElementsByName("heal-mode").forEach((e=>{e.removeEventListener("click",this.changeMode,!1)})),this.selected=null,this.scratch=null},this.blocked=null===(t=!u.ZP.user.subscription)||void 0===t||t,document.addEventListener("layer-select",this.layerSelect,!1),document.addEventListener("zoom-change",this.updateBrush,!1),document.addEventListener("fresco-select",this.changeMode,!1),document.addEventListener("keydown",this.keyDown,!1),this.brush=new d.Z(new p.Z("circle",50,0)),this.progress=new g(this.stage),this.size=new h.Z("heal-brush-size",{compact:!0,label:(0,a.Z)("size")+":",step:2,range:[5,200],defaultValue:this.brush.settings.size,labelFormat:e=>e.toFixed(0),onEnd:e=>{this.brush.settings.size=e,this.updateBrush()}}),document.getElementsByName("heal-mode").forEach((e=>{e.addEventListener("click",this.changeMode,!1)})),this.addDownListeners(),this.changeMode(),this.layerSelect()}}},3232:(e,t,s)=>{s.d(t,{Z:()=>u});var i=s(3947),a=s(6548),n=s(3655),o=s(4256),r=s(3673),h=s(4188),l=s(2257),c=s(972),d=s(887);class u extends d.Z{constructor(e){super("lasso",e),this.points=[],this.selectMode=()=>{this.mode=document.querySelector('input[name="lasso-mode"]:checked').value},this.selectType=e=>{this.type=e.currentTarget.value,(0,i.ZP)("lasso-magnet-settings").style.display="magnet"===this.type?"block":"none",this.noGoZone="lasso"!==this.type,"magnet"!==this.type||this.edges||this.generateEdges()},this.layerSelect=()=>{"magnet"===this.type&&this.generateEdges()},this.viewportChange=()=>{this.points&&this.points.length>1&&window.requestAnimationFrame((()=>{"bezier"===this.type?this.stage.coating.drawAntBezier(this.points.map((e=>this.stage.translateFrescoToRaster(e)))):this.stage.coating.drawAntPolygon(this.points.map((e=>this.stage.translateFrescoToRaster(e))))}))},this.generateEdges=()=>{const e=new o.Z([]);e.addShader("gaussian",.2),e.addShader("sobel",1),this.edges=n.dN(e.apply(this.stage.getOutputCanvas(1))),this.edgeData=this.edges.getContext("2d").getImageData(0,0,this.edges.width,this.edges.height)},this.keyDown=e=>{"Shift"!==e.key||this.isShiftDown||(this.isShiftDown=!0,this.isDown||((0,i.ZP)("lasso-mode-add").checked=!0,this.selectMode())),"Control"!==e.key||this.isCtrlDown||(this.isCtrlDown=!0,this.isDown||((0,i.ZP)("lasso-mode-remove").checked=!0,this.selectMode()))},this.keyUp=e=>{"Shift"===e.key&&this.isShiftDown&&(this.isShiftDown=!1,this.isCtrlDown||this.isDown||((0,i.ZP)("lasso-mode-new").checked=!0,this.selectMode())),"Control"===e.key&&this.isCtrlDown&&(this.isCtrlDown=!1,this.isDown||((0,i.ZP)("lasso-mode-new").checked=!0,this.selectMode()))},this.down=e=>{if(e=this.stage.translateRasterToFresco(e,void 0,!1),(new Date).getTime()-this.stamp<350&&"free"!==this.type&&(this.points.length<2||this.points[this.points.length-1].distanceTo(this.points[this.points.length-2])<10))return 0!==this.points.length&&this.closeLoop(),this.removeMoveListeners(),void(this.isDown=!1);if(this.stamp=(new Date).getTime(),this.stage.coating.freeze(!0),0===this.points.length&&this.setHistory(),0===this.points.length&&"new"===this.mode&&this.stage.fresco.selection&&(this.stage.fresco.selection.clear(),window.requestAnimationFrame((()=>this.stage.coating.render()))),0===this.points.length&&(this.addMoveListeners(),"magnet"===this.type&&this.stage.coating.setCursorImage(new l.Z(new c.Z("circle",this.size.getValue(),0)).getCursorImage(1))),this.points.length>3&&"free"!==this.type)if("bezier"===this.type){if(this.points[0].distanceTo(this.points[this.points.length-2])<10/this.stage.zoom)return void this.closeLoop()}else if(this.points[0].distanceTo(this.points[this.points.length-1])<10/this.stage.zoom)return void this.closeLoop();this.points.push(e),"free"!==this.type&&1===this.points.length&&this.points.push(e.clone())},this.move=e=>{switch(e=this.stage.translateRasterToFresco(e,void 0,!1),this.type){case"free":if(!this.isDown)return;this.points.push(e);break;case"polygon":case"bezier":this.points[this.points.length-1]=e;break;case"magnet":this.findAnchor(e)}window.requestAnimationFrame((()=>{"bezier"===this.type?this.stage.coating.drawAntBezier(this.points.map((e=>this.stage.translateFrescoToRaster(e)))):this.stage.coating.drawAntPolygon(this.points.map((e=>this.stage.translateFrescoToRaster(e))))}))},this.up=e=>{"free"===this.type&&(e=this.stage.translateRasterToFresco(e,void 0,!1),this.isDown=!1,this.removeMoveListeners(),this.stage.coating.freeze(!1),this.points.length<3?this.stage.fresco.selection&&this.stage.fresco.selection.bounds&&this.stage.fresco.selection.bounds.width>0&&(this.stage.fresco.selection.reset(),this.addHistory("deselect")):(this.stage.fresco.addSelection(),this.stage.fresco.selection.editPolygon(this.points,this.feather.getValue(),!(0,i.ZP)("lasso-anti-alias").checked,"remove"===this.mode),this.addHistory()),window.requestAnimationFrame((()=>this.stage.coating.render())),this.points=[])},this.closeLoop=()=>{this.isDown=!1,this.removeMoveListeners(),this.stage.coating.freeze(!1),this.stage.coating.removeCursorImage(),this.stage.raster.style.cursor="crosshair",this.points.length>2?(this.stage.fresco.addSelection(),"bezier"===this.type?this.stage.fresco.selection.editBezier(this.points,this.feather.getValue(),!(0,i.ZP)("lasso-anti-alias").checked,"remove"===this.mode):this.stage.fresco.selection.editPolygon(this.points,this.feather.getValue(),!(0,i.ZP)("lasso-anti-alias").checked,"remove"===this.mode),this.addHistory()):this.stage.fresco.hasSelection()&&(this.stage.fresco.selection.reset(),this.addHistory("deselect")),window.requestAnimationFrame((()=>this.stage.coating.render())),this.points=[]},this.findAnchor=e=>{let t=this.size.getValue();if(e=new r.Z(Math.round(e.x),Math.round(e.y)),0===this.points.length||this.points[this.points.length-1].distanceTo(e)>t/10){let s,i=this.size.getValue()/2,a=this.edges.width,n=new r.Z,o=t;for(let r=e.y-i,h=e.y+i;r<h;++r)for(let l=e.x-i,c=e.x+i;l<c;++l){n.x=l,n.y=r;let i=e.distanceTo(n);if(i>t)continue;let h=this.edgeData.data[4*(r*a+l)];h>18&&(h=.333*i+i*(1-h/255)*.666,h<o&&(s=n.clone(),o=h))}s&&(e=s),this.checkAndAdd(e,t/10)}},this.checkAndAdd=(e,t)=>{let s=this.points.slice(Math.max(this.points.length-3,0)),i=!1;s.forEach((s=>{s.distanceTo(e)<t&&(i=!0)})),i||this.points.push(e)},this.cancel=()=>{"free"!==this.type&&(this.points.length>2?("polygon"===this.type||"bezier"===this.type?this.points.splice(-2,1):this.points.pop(),window.requestAnimationFrame((()=>{"bezier"===this.type?this.stage.coating.drawAntBezier(this.points.map((e=>this.stage.translateFrescoToRaster(e)))):this.stage.coating.drawAntPolygon(this.points.map((e=>this.stage.translateFrescoToRaster(e))))}))):(this.points=[],this.isDown=!1,this.removeMoveListeners(),this.stage.coating.freeze(!1),this.stage.coating.removeCursorImage(),this.stage.raster.style.cursor="crosshair",this.stage.fresco.hasSelection()&&(this.stage.fresco.selection.reset(),this.addHistory("deselect")),window.requestAnimationFrame((()=>this.stage.coating.render()))))},this.apply=()=>{"free"!==this.type&&this.points.length>2&&this.closeLoop()},this.cleanUp=()=>{var e;this.superClean(),this.stage.fresco&&this.stage.fresco.selection&&0===(null===(e=this.stage.fresco.selection.outline)||void 0===e?void 0:e.length)&&this.stage.fresco.removeSelection(),this.removeMoveListeners(),this.size.cleanUp(),this.feather.cleanUp(),this.edges=void 0,this.edgeData=void 0,document.removeEventListener("layer-select",this.layerSelect,!1),document.removeEventListener("viewport-render",this.viewportChange,!1),document.removeEventListener("keydown",this.keyDown,!1),document.removeEventListener("keyup",this.keyUp,!1),(0,i.ZP)("lasso-type-free").removeEventListener("change",this.selectType,!1),(0,i.ZP)("lasso-type-polygon").removeEventListener("change",this.selectType,!1),(0,i.ZP)("lasso-type-bezier").removeEventListener("change",this.selectType,!1),(0,i.ZP)("lasso-type-magnet").removeEventListener("change",this.selectType,!1)},document.addEventListener("layer-select",this.layerSelect,!1),document.addEventListener("viewport-render",this.viewportChange,!1),document.addEventListener("keydown",this.keyDown,!1),document.addEventListener("keyup",this.keyUp,!1),(0,i.ZP)("lasso-type-free").addEventListener("change",this.selectType,!1),(0,i.ZP)("lasso-type-polygon").addEventListener("change",this.selectType,!1),(0,i.ZP)("lasso-type-bezier").addEventListener("change",this.selectType,!1),(0,i.ZP)("lasso-type-magnet").addEventListener("change",this.selectType,!1),this.feather=new h.Z("lasso-feather",{compact:!0,defaultValue:0,label:(0,a.Z)("feather")+":",labelFormat:e=>(100*e).toFixed(0),labelParse:e=>parseInt(e,10)/100}),this.size=new h.Z("lasso-magnet-size",{compact:!0,label:(0,a.Z)("size")+":",step:2,range:[5,120],defaultValue:50,labelFormat:e=>e.toFixed(0)}),this.type=document.querySelector('input[name="lasso-type"]:checked').value,"magnet"===this.type&&this.generateEdges(),this.noGoZone="lasso"!==this.type,(0,i.ZP)("lasso-mode-new").addEventListener("change",this.selectMode,!1),(0,i.ZP)("lasso-mode-add").addEventListener("change",this.selectMode,!1),(0,i.ZP)("lasso-mode-remove").addEventListener("change",this.selectMode,!1),this.selectMode()}}},8565:(e,t,s)=>{s.d(t,{Z:()=>d});var i=s(3947),a=s(3655),n=s(8203),o=s(4188),r=s(8776),h=s(2257),l=s(972),c=s(6548);class d extends n.Z{constructor(e){super("liquify",e),this.timedStroke=!1,this.keyDown=e=>{if(","===e.key||"."===e.key){switch(e.key){case",":this.size.setValue(this.size.getValue()-10);break;case".":this.size.setValue(this.size.getValue()+10)}this.updateBrush()}},this.layerSelect=async()=>{const{Displacement:e}=await Promise.resolve().then(s.bind(s,8132));if(!this.stage.fresco.isSelectedImageWithCanvas())return(0,i.ZP)("liquify-no-layer").style.display="flex",(0,i.ZP)("liquify-settings").style.display="none",this.selected=null,void this.updateBrush();(0,i.ZP)("liquify-settings").style.display="flex",(0,i.ZP)("liquify-no-layer").style.display="none",this.selected=this.stage.fresco.getSelected(),this.scratch=this.stage.fresco.addScratch(),this.scratch.setTarget(this.selected.id,this.selected.rect,"replace"),this.scratch.ctx.drawImage(this.selected.canvas,0,0);const t=this.selected.canvas.getContext("2d").getImageData(0,0,this.selected.canvas.width,this.selected.canvas.height);if(this.displacement)this.displacement.retarget(t.data,t.width,t.height);else{this.displacement=new e(t.data,t.width,t.height,this.size.getValue(),this.strength.getValue(),this.density.getValue());const s=document.querySelector('input[name="liquify-mode"]:checked').value;this.setMode(s),this.brush.settings.size=this.size.getValue()}this.updateBrush()},this.selectMode=e=>{this.setMode(e.currentTarget.value)},this.setMode=e=>{var t;this.timedStroke="MOVE"!==e,null===(t=this.displacement)||void 0===t||t.setMode(e)},this.updateBrush=()=>{var e;this.brush.settings.size=this.size.getValue(),null===(e=this.displacement)||void 0===e||e.setStampSize(this.size.getValue()),this.brush.generate(),this.selected?this.stage.coating.setCursorImage(this.brush.getCursorImage(this.stage.zoom,new r.Z(255,255,255,255))):this.stage.coating.removeCursorImage()},this.down=(e,t)=>{this.selected&&this.displacement&&(this.stage.coating.freeze(!0),this.stroke=this.displacement.beginStroke(),this.highQualityStroke=(0,i.ZP)("liquify-hq-preview").checked,"touch"!==t&&this.move(e),this.addMoveListeners())},this.move=e=>{const t=this.stage.translateRasterToFresco(e,this.selected.rect),s=this.stroke.push(t.x,t.y,this.timedStroke);if(s){this.strokeDamage=s.union(this.strokeDamage);const e=this.highQualityStroke?this.displacement.applyQuality(s):this.displacement.applyFast(s);this.scratch.ctx.putImageData(new ImageData(e,s.width,s.height),s.x,s.y),window.requestAnimationFrame((()=>this.stage.render()))}this.timedStroke&&(window.clearTimeout(this.strokeTimeout),this.strokeTimeout=window.setTimeout((()=>this.move(e)),16))},this.up=e=>{var t;if(null===(t=this.stroke)||void 0===t||t.free(),this.stroke=void 0,window.clearTimeout(this.strokeTimeout),this.removeMoveListeners(),!this.displacement||!this.strokeDamage)return;const s=this.strokeDamage;if(this.strokeDamage=void 0,!this.highQualityStroke){let e=this.displacement.applyQuality(s);this.scratch.ctx.putImageData(new ImageData(e,s.width,s.height),s.x,s.y),window.requestAnimationFrame((()=>this.stage.render()))}const i=a.$E(this.selected.canvas,s),n=this.selected.rect.clone(),o=this.selected.canvas.getContext("2d");o.clearRect(s.x,s.y,s.width,s.height),o.drawImage(this.scratch.canvas,s.x,s.y,s.width,s.height,s.x,s.y,s.width,s.height),this.scratch.clear(),this.scratch.ctx.drawImage(this.selected.canvas,0,0),this.selected.render(),this.stage.render(),this.stage.history.add({type:"bitmapChange",kind:"liquify",layer:this.selected,patchRect:s,patch:i,rect:n})},this.cleanUp=()=>{var e,t,s;null===(e=this.displacement)||void 0===e||e.free(),null===(t=this.stroke)||void 0===t||t.free(),null===(s=this.stage.fresco)||void 0===s||s.removeScratch(),this.removeDownListeners(),this.size.cleanUp(),this.strength.cleanUp(),this.density.cleanUp(),document.removeEventListener("zoom-change",this.updateBrush,!1),document.removeEventListener("layer-select",this.layerSelect,!1),document.removeEventListener("keydown",this.keyDown,!1),document.getElementsByName("liquify-mode").forEach((e=>{e.removeEventListener("click",this.selectMode,!1)}))},document.addEventListener("layer-select",this.layerSelect,!1),document.addEventListener("zoom-change",this.updateBrush,!1),document.addEventListener("keydown",this.keyDown,!1),document.getElementsByName("liquify-mode").forEach((e=>{e.addEventListener("click",this.selectMode,!1)})),this.brush=new h.Z(new l.Z("circle",50,0)),this.size=new o.Z("liquify-brush-size",{compact:!0,label:(0,c.Z)("size")+":",step:2,range:[5,500],defaultValue:50,labelFormat:e=>e.toFixed(0),onEnd:()=>this.updateBrush()}),this.strength=new o.Z("liquify-brush-strength",{compact:!0,label:(0,c.Z)("strength")+":",range:[.01,1],defaultValue:.5,step:.01,labelFormat:e=>(100*e).toFixed(0)+"%",labelParse:e=>parseInt(e,10)/100,onEnd:e=>{var t;return null===(t=this.displacement)||void 0===t?void 0:t.setStrength(e)}}),this.density=new o.Z("liquify-brush-density",{compact:!0,label:(0,c.Z)("density")+":",range:[0,.95],defaultValue:.5,step:.01,labelFormat:e=>(100*e).toFixed(0)+"%",labelParse:e=>parseInt(e,10)/100,onEnd:e=>{var t;return null===(t=this.displacement)||void 0===t?void 0:t.setDensity(e)}}),this.addDownListeners(),this.layerSelect()}}},4445:(e,t,s)=>{s.d(t,{Z:()=>h});var i=s(887),a=s(4188),n=s(6817),o=s(3947),r=s(6548);class h extends i.Z{constructor(e){super("marquee",e),this.selectMode=()=>{this.mode=document.querySelector('input[name="marquee-mode"]:checked').value},this.keyDown=e=>{"Shift"!==e.key||this.isShiftDown||(this.isShiftDown=!0,this.isDown||((0,o.ZP)("marquee-mode-add").checked=!0,this.selectMode())),"Control"!==e.key||this.isCtrlDown||(this.isCtrlDown=!0,this.isDown||((0,o.ZP)("marquee-mode-remove").checked=!0,this.selectMode()))},this.keyUp=e=>{"Shift"===e.key&&this.isShiftDown&&(this.isShiftDown=!1,this.isCtrlDown||this.isDown||((0,o.ZP)("marquee-mode-new").checked=!0,this.selectMode())),"Control"===e.key&&this.isCtrlDown&&(this.isCtrlDown=!1,this.isDown||((0,o.ZP)("marquee-mode-new").checked=!0,this.selectMode()))},this.down=e=>{this.setHistory(),this.stage.coating.freeze(!0),this.addMoveListeners(),this.type=document.querySelector('input[name="marquee-type"]:checked').value,"new"===this.mode&&this.stage.fresco.selection&&(this.stage.fresco.selection.clear(),window.requestAnimationFrame((()=>this.stage.coating.render())))},this.move=e=>{if(this.isDown){let t=this.stage.translateToRect(this.downPoint,e,!this.stage.fresco.hasSelection()&&this.isShiftDown,!0);window.requestAnimationFrame((()=>{"rectangle"===this.type?this.stage.coating.drawAntRectangle(t):this.stage.coating.drawAntEllipse(t)})),document.dispatchEvent(new CustomEvent("legend",{detail:"W: "+Math.round(t.width/this.stage.zoom)+"  H: "+Math.round(t.height/this.stage.zoom)}))}},this.up=e=>{this.isDown=!1,this.stage.coating.freeze(!1),this.removeMoveListeners(),document.dispatchEvent(new CustomEvent("legend",{detail:"stop"}));let t=this.stage.translateToRect(this.downPoint,e,!this.stage.fresco.hasSelection()&&this.isShiftDown,!1);this.downPoint.x===e.x&&this.downPoint.y===e.y||!t.intersect(new n.Z(0,0,this.stage.fresco.width,this.stage.fresco.height))?this.stage.fresco.selection&&this.stage.fresco.selection.bounds.width>0&&(this.stage.fresco.selection.reset(),this.addHistory("deselect"),window.requestAnimationFrame((()=>this.stage.coating.render()))):(this.stage.fresco.addSelection(),"rectangle"===this.type?this.stage.fresco.selection.editRectangle(t,this.feather.getValue(),"remove"===this.mode):this.stage.fresco.selection.editEllipse(t,this.feather.getValue(),!(0,o.ZP)("marquee-anti-alias").checked,"remove"===this.mode),window.requestAnimationFrame((()=>this.stage.coating.render())),this.addHistory())},this.cleanUp=()=>{var e;this.superClean(),this.stage.fresco&&this.stage.fresco.selection&&0===(null===(e=this.stage.fresco.selection.outline)||void 0===e?void 0:e.length)&&this.stage.fresco.removeSelection(),this.feather.cleanUp(),document.removeEventListener("keydown",this.keyDown,!1),document.removeEventListener("keyup",this.keyUp,!1),(0,o.ZP)("marquee-mode-new").removeEventListener("change",this.selectMode,!1),(0,o.ZP)("marquee-mode-add").removeEventListener("change",this.selectMode,!1),(0,o.ZP)("marquee-mode-remove").removeEventListener("change",this.selectMode,!1)},document.addEventListener("keydown",this.keyDown,!1),document.addEventListener("keyup",this.keyUp,!1),this.feather=new a.Z("marquee-feather",{compact:!0,defaultValue:0,label:(0,r.Z)("feather")+":",labelFormat:e=>(100*e).toFixed(0),labelParse:e=>parseInt(e,10)/100}),(0,o.ZP)("marquee-mode-new").addEventListener("change",this.selectMode,!1),(0,o.ZP)("marquee-mode-add").addEventListener("change",this.selectMode,!1),(0,o.ZP)("marquee-mode-remove").addEventListener("change",this.selectMode,!1),this.selectMode()}}},9200:(e,t,s)=>{s.d(t,{Z:()=>p});var i=s(3947),a=s(6548),n=s(3655),o=s(6817),r=s(8203);function h(e,t){return Math.floor(Math.random()*(t-e+1))+e}var l=s(4188),c=s(4170),d=s(4820),u=s(9198);class p extends r.Z{constructor(e){super("pen",e),this.stage=e,this.pathPoints=[],this.layerSelect=()=>{if(!this.stage.fresco.isSelectedType(c.Z.TYPE_IMAGE))return(0,i.ZP)("pen-no-layer").style.display="flex",(0,i.ZP)("pen-settings").style.display="none",this.stage.raster.style.cursor="auto",void(this.selected=null);(0,i.ZP)("pen-no-layer").style.display="none",(0,i.ZP)("pen-settings").style.display="flex",this.stage.raster.style.cursor="crosshair",this.selected=this.stage.fresco.getSelected(),this.scratch=this.stage.fresco.addScratch(),this.scratch.setTarget(this.selected.id,new o.Z(0,0,this.stage.fresco.width,this.stage.fresco.height),"over"),this.stage.fresco.hasSelection()&&this.scratch.addBake()},this.keyDown=e=>{if("Control"!==e.key||this.stage.coating.override){if(","===e.key||"."===e.key)switch(e.key){case",":this.size.setValue(this.size.getValue()-1);break;case".":this.size.setValue(this.size.getValue()+1)}}else this.stage.coating.setPicker()},this.keyUp=e=>{"Control"===e.key&&this.stage.coating.override&&this.stage.coating.removePicker()},this.down=e=>{this.selected&&(this.stage.coating.freeze(!0),this.mode=(0,i.ZP)("pen-mode").value,this.scratch.settings.opacity=this.opacity.getValue(),this.scratch.ctx.save(),this.scratch.ctx.lineWidth=this.size.getValue()/2,this.scratch.ctx.lineJoin=this.scratch.ctx.lineCap="round","neon"===this.mode?(this.scratch.ctx.strokeStyle="#ffffff",this.scratch.ctx.shadowColor=d.ZP.mainColor,this.scratch.ctx.shadowBlur=.1*this.amount.getValue()):(this.scratch.ctx.strokeStyle=d.ZP.mainColor,this.scratch.ctx.fillStyle=d.ZP.mainColor),this.pathPoints=[],this.pp=this.stage.translateRasterToFresco(e,null),this.pathPoints.push(this.pp),this.addMoveListeners())},this.move=e=>{e=this.stage.translateRasterToFresco(e,null),this.pathPoints.push(e);(function(e,t,s,i,a){let n,o,r,l,c;const d=a.length;if(d<2)return!1;let u=a[d-2],p=a[d-1];const g=Math.sqrt(Math.pow(u.x-p.x,2)+Math.pow(u.y-p.y,2));switch(t){case"plain":case"neon":e.beginPath(),e.moveTo(u.x,u.y),e.lineTo(p.x,p.y),e.stroke();break;case"parallel":if(n=p.x-u.x,o=p.y-u.y,n*n+o*o<500)return!1;s=Math.round(s*i*5),e.beginPath(),e.moveTo(u.x-h(0,s),u.y-h(0,s)),e.lineTo(p.x-h(0,s),p.y-h(0,s)),e.moveTo(u.x,u.y),e.lineTo(p.x,p.y),e.moveTo(u.x+h(0,s),u.y+h(0,s)),e.lineTo(p.x+h(0,s),p.y+h(0,s)),e.stroke();break;case"sketchy":if(g<.8*s)return!1;for(e.beginPath(),e.moveTo(u.x,u.y),e.lineTo(p.x,p.y),e.stroke(),e.beginPath(),e.globalAlpha=.33,l=0;l<a.length;++l)n=a[l].x-p.x,o=a[l].y-p.y,r=n*n+o*o,r<s/2*4e3&&Math.random()<i&&(e.moveTo(p.x+.3*n,p.y+.3*o),e.lineTo(a[l].x-.3*n,a[l].y-.3*o));e.stroke(),e.globalAlpha=1;break;case"shaded":for(e.beginPath(),e.moveTo(u.x,u.y),e.lineTo(p.x,p.y),e.stroke(),e.beginPath(),e.globalAlpha=.1,l=0,c=a.length-2;l<c&&!(l>50);++l)n=a[c-l].x-p.x,o=a[c-l].y-p.y,r=n*n+o*o,r<s/2*5e3*i&&(e.beginPath(),e.moveTo(p.x,p.y),e.lineTo(a[c-l].x,a[c-l].y),e.stroke());e.globalAlpha=1;break;case"furry":if(g<.8*s)return!1;for(e.beginPath(),e.moveTo(a[a.length-2].x,a[a.length-2].y),e.lineTo(a[a.length-1].x,a[a.length-1].y),e.stroke(),e.globalAlpha=.3,e.beginPath(),l=0,c=a.length;l<c;l++)n=a[l].x-a[a.length-1].x,o=a[l].y-a[a.length-1].y,r=n*n+o*o,r<s/2*2e3&&Math.random()>r/2e3&&(e.moveTo(p.x+n*i*2,p.y+o*i*2),e.lineTo(p.x-n*i*2,p.y-o*i*2));e.stroke(),e.globalAlpha=1;break;case"trail":if(g<.8*s)return!1;for(e.globalAlpha=.3,e.beginPath(),l=a.length-1,c=a.length-Math.round(25*i);l>c;--l)l>0&&(e.moveTo(p.x,p.y),e.lineTo(a[l].x,a[l].y));e.stroke(),e.globalAlpha=1;break;case"crayon":var m=Math.round(Math.sqrt(Math.pow(p.x-u.x,2)+Math.pow(p.y-u.y,2))/(5/(100*i))),v=(p.x-u.x)/m,f=(p.y-u.y)/m;for(l=0;l<m;l++)e.save(),e.globalAlpha=.4+.2*Math.random(),n=u.x+l*v,o=u.y+l*f,e.fillRect(n+(Math.random()-.5)*(s+5),o+(Math.random()-.5)*(s+5),2*Math.random()+2,Math.random()+1),e.restore();break;case"ink":e.save(),e.lineWidth=h(s,2*s),e.beginPath(),e.moveTo(u.x,u.y),e.lineTo(p.x,p.y),e.stroke(),e.restore()}return!0})(this.scratch.ctx,this.mode,this.size.getValue(),this.amount.getValue()/100,this.pathPoints)?(this.scratch.applySelection(this.stage),window.requestAnimationFrame((()=>this.stage.render()))):this.pathPoints.length>1&&this.pathPoints.pop()},this.up=e=>{if(this.stage.coating.freeze(!1),this.removeMoveListeners(),this.pathPoints.length>2&&"neon"===this.mode){this.scratch.clear(),this.scratch.ctx.beginPath(),this.scratch.ctx.moveTo(this.pathPoints[0].x,this.pathPoints[0].y);for(let e=1;e<this.pathPoints.length;++e)this.scratch.ctx.lineTo(this.pathPoints[e].x,this.pathPoints[e].y);this.scratch.ctx.shadowBlur=.1*this.amount.getValue(),this.scratch.ctx.stroke(),this.scratch.ctx.shadowBlur=.2*this.amount.getValue(),this.scratch.ctx.stroke(),this.scratch.ctx.shadowBlur=.3*this.amount.getValue(),this.scratch.ctx.stroke(),this.scratch.ctx.shadowBlur=.2*this.amount.getValue(),this.scratch.ctx.stroke(),this.scratch.ctx.shadowBlur=this.amount.getValue(),this.scratch.ctx.stroke(),this.scratch.applySelection(this.stage)}this.scratch.ctx.restore();let t=n.l(this.scratch.canvas);if(t&&t.width>0&&t.height>0){let e=this.selected.rect?n.$E(this.selected.canvas,t.rebase(this.selected.rect.x,this.selected.rect.y)):void 0;const s=n.dN(this.selected.mask),i=this.selected.rect?this.selected.rect.clone():void 0;this.selected.extendCanvas(t),this.scratch.drawToLayer(this.selected,"source-over",this.opacity.getValue()),this.scratch.clear(),this.selected.render(),this.stage.history.add({type:"bitmapChange",kind:"pen",layer:this.selected,patchRect:this.selected.rect?t.rebase(this.selected.rect.x,this.selected.rect.y):t,patch:e,rect:i,mask:s})}window.requestAnimationFrame((()=>this.stage.render()))},this.cleanUp=()=>{var e;null===(e=this.stage.fresco)||void 0===e||e.removeScratch(),this.stage.coating.removePicker(),this.size.cleanUp(),this.amount.cleanUp(),this.opacity.cleanUp(),this.stage.coating.freeze(!1),this.removeMoveListeners(),this.removeDownListeners(),document.removeEventListener("keyup",this.keyUp,!1),document.removeEventListener("keydown",this.keyDown,!1),document.removeEventListener("layer-select",this.layerSelect,!1)},this.scratch=new u.Z,document.addEventListener("keyup",this.keyUp,!1),document.addEventListener("keydown",this.keyDown,!1),document.addEventListener("layer-select",this.layerSelect,!1),this.size=new l.Z("pen-size",{compact:!0,label:(0,a.Z)("size")+":",defaultValue:3,range:[1,50],step:1}),this.amount=new l.Z("pen-amount",{compact:!0,label:(0,a.Z)("amount")+":",defaultValue:30,range:[1,100],step:1}),this.opacity=new l.Z("pen-opacity",{compact:!0,label:(0,a.Z)("opacity")+":",defaultValue:1,labelFormat:e=>(100*e).toFixed(0)+"%",labelParse:e=>parseInt(e,10)/100}),this.addDownListeners(),this.layerSelect()}}},2112:(e,t,s)=>{s.d(t,{Z:()=>h});var i=s(3947),a=s(8203),n=s(3673),o=s(8776),r=s(4820);class h extends a.Z{constructor(e,t){super("picker",e),this.stage=e,this.target="main",this.toggleTarget=()=>{this.setTarget("main"===this.target?"alt":"main")},this.selectTarget=e=>{this.setTarget(e.currentTarget===(0,i.ZP)("picker-target-main")?"main":"alt")},this.setTarget=e=>{this.target=e,(0,i.ZP)("picker-target-main").checked="main"===this.target,(0,i.ZP)("picker-target-alt").checked="alt"===this.target},this.setPreset=e=>{let t=o.Z.fromRGB(e.currentTarget.style.backgroundColor);this.callback(t,!this.isShiftDown,!0)},this.shiftDown=e=>{"Shift"!==e.key||this.isShiftDown||(this.isShiftDown=!0,this.toggleTarget())},this.shiftUp=e=>{"Shift"===e.key&&(this.isShiftDown=!1,this.toggleTarget())},this.layerSelect=()=>{this.output=this.stage.getOutputCanvas(),this.ctx=this.output.getContext("2d")},this.down=e=>{this.stage.coating.freeze(!0),e=this.stage.translateRasterToFresco(e,void 0,!1);let t=this.ctx.getImageData(e.x,e.y,1,1).data;this.callback(new o.Z(t[0],t[1],t[2]),"main"===this.target),this.addMoveListeners()},this.move=e=>{e=this.stage.translateRasterToFresco(e,void 0,!1);let t=this.ctx.getImageData(e.x,e.y,1,1).data;this.callback(new o.Z(t[0],t[1],t[2]),"main"===this.target,!1)},this.pickerPreviewColor=e=>{let t=new n.Z(e.clientX,e.clientY);if(this.preview.style.top=t.y-50+"px",this.preview.style.left=t.x+10+"px",this.preview.style.display="block",t.x-=this.stage.canvas.offsetLeft,t.y-=this.stage.canvas.offsetTop,t.x<0||t.y<0||t.x>this.stage.canvas.width||t.y>this.stage.canvas.height)return void(this.preview.style.display="none");let s=this.stage.canvas.getContext("2d").getImageData(t.x,t.y,1,1).data;this.preview.style.backgroundColor=new o.Z(s[0],s[1],s[2]).toHEX()},this.pickerPreviewLeave=()=>{this.preview.style.display="none"},this.up=e=>{this.stage.coating.freeze(!1),this.removeMoveListeners(),e=this.stage.translateRasterToFresco(e,void 0,!1);let t=this.ctx.getImageData(e.x,e.y,1,1).data;this.callback(new o.Z(t[0],t[1],t[2]),"main"===this.target,!0),this.setShades()},this.setShades=()=>{let e=o.Z.fromHEX("main"===this.target?r.ZP.mainColor:r.ZP.altColor);(0,i.ZP)("picker-shade-1").style.backgroundColor=new o.Z(e.r-50,e.g-50,e.b-50).toHEX(),(0,i.ZP)("picker-shade-2").style.backgroundColor=new o.Z(e.r-25,e.g-25,e.b-25).toHEX(),(0,i.ZP)("picker-shade-3").style.backgroundColor=e.toHEX(),(0,i.ZP)("picker-shade-4").style.backgroundColor=new o.Z(e.r+25,e.g+25,e.b+25).toHEX(),(0,i.ZP)("picker-shade-5").style.backgroundColor=new o.Z(e.r+50,e.g+50,e.b+50).toHEX(),(0,i.ZP)("picker-triad-1").style.backgroundColor=e.toHEX(),(0,i.ZP)("picker-triad-2").style.backgroundColor=e.rotateHue(90).toHEX(),(0,i.ZP)("picker-triad-3").style.backgroundColor=e.rotateHue(180).toHEX(),(0,i.ZP)("picker-tetra-1").style.backgroundColor=e.toHEX(),(0,i.ZP)("picker-tetra-2").style.backgroundColor=e.rotateHue(60).toHEX(),(0,i.ZP)("picker-tetra-3").style.backgroundColor=e.rotateHue(120).toHEX(),(0,i.ZP)("picker-tetra-4").style.backgroundColor=e.rotateHue(180).toHEX(),(0,i.ZP)("picker-analo-1").style.backgroundColor=e.rotateHue(-30).toHEX(),(0,i.ZP)("picker-analo-2").style.backgroundColor=e.toHEX(),(0,i.ZP)("picker-analo-3").style.backgroundColor=e.rotateHue(30).toHEX(),(0,i.ZP)("picker-comp-1").style.backgroundColor=e.toHEX(),(0,i.ZP)("picker-comp-2").style.backgroundColor=e.rotateHue(180).toHEX()},this.cleanUp=()=>{this.removeDownListeners(),this.ctx=void 0,this.output=void 0,this.preview.remove(),this.preview=void 0,(0,i.ZP)("picker").querySelectorAll(".color-pod").forEach((e=>e.removeEventListener("click",this.setPreset))),(0,i.ZP)("picker-target-main").removeEventListener("click",this.selectTarget,!1),(0,i.ZP)("picker-target-alt").removeEventListener("click",this.selectTarget,!1),document.removeEventListener("layer-select",this.layerSelect,!1),document.removeEventListener("keydown",this.shiftDown,!1),document.removeEventListener("keyup",this.shiftUp,!1),this.stage.raster.removeEventListener("mousemove",this.pickerPreviewColor,!0),this.stage.raster.removeEventListener("mouseleave",this.pickerPreviewLeave,!0)},this.callback=t,document.addEventListener("layer-select",this.layerSelect,!1),document.addEventListener("keydown",this.shiftDown,!1),document.addEventListener("keyup",this.shiftUp,!1),this.stage.raster.addEventListener("mousemove",this.pickerPreviewColor,!0),this.stage.raster.addEventListener("mouseleave",this.pickerPreviewLeave,!0),(0,i.ZP)("picker-target-main").addEventListener("click",this.selectTarget,!1),(0,i.ZP)("picker-target-alt").addEventListener("click",this.selectTarget,!1),this.stage.raster.style.cursor="crosshair",(0,i.ZP)("picker").querySelectorAll(".color-pod").forEach((e=>e.addEventListener("click",this.setPreset))),this.addDownListeners(),this.layerSelect(),this.setShades(),this.preview=(0,i.T)("div",{id:"color-picker-preview",style:"display:none"}),(0,i.ZP)("workspace").appendChild(this.preview);const s=document.querySelector('input[name="picker-target"]:checked').value;this.setTarget(s)}}},6258:(e,t,s)=>{s.d(t,{Z:()=>p});var i=s(3947),a=s(6548),n=s(3655),o=s(8203),r=s(4188),h=s(4820),l=s(2257),c=s(1126),d=s(8776),u=s(972);class p extends o.Z{constructor(e){super("replace",e),this.stage=e,this.isShiftDown=!1,this.keyDown=e=>{if("Shift"!==e.key)if("Control"!==e.key||this.stage.coating.override)switch(e.key){case",":e.shiftKey?this.brushPod.stepSoftness(.1):this.brushPod.stepSize(-10);break;case".":e.shiftKey?this.brushPod.stepSoftness(-.1):this.brushPod.stepSize(10)}else this.stage.coating.setPicker();else this.isShiftDown=!0},this.keyUp=e=>{"Shift"===e.key&&(this.isShiftDown=!1),"Control"===e.key&&this.stage.coating.override&&this.stage.coating.removePicker()},this.layerSelect=()=>{if(!this.stage.fresco.isSelectedImageWithCanvas())return(0,i.ZP)("replace-no-layer").style.display="flex",(0,i.ZP)("replace-settings").style.display="none",this.selected=null,void this.updateBrush();(0,i.ZP)("replace-no-layer").style.display="none",(0,i.ZP)("replace-settings").style.display="flex",this.selected=this.stage.fresco.getSelected(),this.scratch=this.stage.fresco.addScratch(),this.scratch.setTarget(this.selected.id,this.selected.rect,"over"),this.cache=n.dN(this.selected.canvas),this.cachectx=this.cache.getContext("2d"),this.stage.fresco.hasSelection()&&this.scratch.addBake(),this.updateBrush()},this.updateBrush=()=>{this.selected?this.stage.coating.setCursorImage(this.brush.getCursorImage(this.stage.zoom,new d.Z(255,255,255,255))):this.stage.coating.removeCursorImage()},this.down=(e,t)=>{if(!this.selected)return;this.stage.coating.freeze(!0),this.mode=(0,i.ZP)("replace-mode").value,this.scratch.settings.opacity=this.opacity.getValue();const s=this.tolerance.getValue();this.sRGB=this.getSourcePixelAverage(this.stage.translateRasterToFresco(e,this.selected.rect)),this.sHSB=this.sRGB.toHSB(),this.shmax=this.sHSB.h+s,this.shmin=this.sHSB.h-s,this.shmax>360&&(this.shmax-=360),this.shmin<0&&(this.shmin+=360),this.tRGB=d.Z.fromHEX(h.ZP.mainColor),this.tHSB=this.tRGB.toHSB(),this.isShiftDown||(this.x=this.y=-1),"touch"!==t&&this.move(e),this.addMoveListeners()},this.getSourcePixelAverage=e=>{let t=0,s=0,i=0;const a=this.cache.getContext("2d").getImageData(e.x-1,e.y-1,3,3).data;for(let n=0;n<36;n+=4)t+=a[n],s+=a[n+1],i+=a[n+2];return new d.Z(Math.round(t/9),Math.round(s/9),Math.round(i/9))},this.x=-1,this.y=-1,this.move=e=>{let t=this.brush.getStep(),s=!1;if(e=this.stage.translateRasterToFresco(e,this.selected.rect),-1===this.x&&(this.lx=e.x,this.ly=e.y,this.x=e.x,this.y=e.y,this.drawShape(this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),s=!0),e.x!==this.x||e.y!==this.y){let i=e.x-this.x,a=e.y-this.y,n=i>0?1:-1,o=a>0?1:-1;if(i=i<0?-i:i,a=a<0?-a:a,i>a){let e=.5*i;for(let r=1;r<=i;r++)this.x+=n,e+=a,e>=i&&(e-=i,this.y+=o),(this.x>this.lx+t||this.x<this.lx-t||this.y>this.ly+t||this.y<this.ly-t)&&(this.drawShape(this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),this.lx=this.x,this.ly=this.y,s=!0)}else{let e=.5*a;for(let r=1;r<=a;r++)this.y+=o,e+=i,e>=a&&(e-=a,this.x+=n),(this.x>this.lx+t||this.x<this.lx-t||this.y>this.ly+t||this.y<this.ly-t)&&(this.drawShape(this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),this.lx=this.x,this.ly=this.y,s=!0)}}s&&(this.scratch.applySelection(this.stage),window.requestAnimationFrame((()=>this.stage.render())))},this.drawShape=(e,t)=>{const s=this.brush.canvas.width,i=this.brush.canvas.height;let a=this.getPatchContext(s,i);a.save(),a.drawImage(this.selected.canvas,-e,-t);const n=a.getImageData(0,0,s,i),o=this.cachectx.getImageData(e,t,s,i);switch(this.mode){case"auto":this.changeAuto(n.data,o.data,s,i);break;case"hue":this.changeHue(n.data,s,i);break;case"sat":this.changeSat(n.data,s,i);break;case"bri":this.changeBri(n.data,s,i);break;case"fill":this.changeFill(n.data,s,i)}a.putImageData(n,0,0),a.globalCompositeOperation="destination-in",a.drawImage(this.brush.canvas,0,0),a.restore(),this.scratch.ctx.drawImage(this.patch,e,t)},this.changeAuto=(e,t,s,i)=>{let a,n,o,r,h,l,c,d,u,p,g,m,v,f,y,w,b=i;const x=this.tHSB.b/this.sHSB.b,Z=this.tHSB.s/this.sHSB.s;for(;b--;)for(a=s;a--;)if(w=4*(b*s+a),o=t[w],r=t[w+1],h=t[w+2],u=Math.min(o,r,h),p=Math.max(o,r,h),d=p/255,g=p-u,l=c=0,g&&(c=g/p,l=o==p?(r-h)/g*60:r==p?60*(2+(h-o)/g):60*(4+(o-r)/g),l>360?l-=360:l<0&&(l+=360)),c<.05||d<.05||l<this.shmax&&l>this.shmin||this.shmax<this.shmin&&(l>this.shmin||l<this.shmax)){if(l=this.tHSB.h,d*=x,c*=Z,d<0?d=0:d>1&&(d=1),0===d)o=0,r=0,h=0;else if(0===c)o=r=h=d;else switch(m=l/60,n=m-~~m,f=d*(1-c),y=d*(1-c*n),v=d*(1-c*(1-n)),~~m){case 0:case 6:o=d,r=v,h=f;break;case 1:o=y,r=d,h=f;break;case 2:o=f,r=d,h=v;break;case 3:o=f,r=y,h=d;break;case 4:o=v,r=f,h=d;break;case 5:o=d,r=f,h=y}o*=255,r*=255,h*=255,e[w]=o,e[w+1]=r,e[w+2]=h}},this.changeHue=(e,t,s)=>{let i,a,n,o,r,h,l,c,d,u,p,g,m,v,f,y,w=s;for(;w--;)for(i=t;i--;)if(y=4*(w*t+i),n=e[y],o=e[y+1],r=e[y+2],d=Math.min(n,o,r),u=Math.max(n,o,r),c=u/255,p=u-d,h=l=0,p&&(l=p/u,h=n==u?(o-r)/p*60:o==u?60*(2+(r-n)/p):60*(4+(n-o)/p),h>360?h-=360:h<0&&(h+=360)),l>.2&&h<this.shmax&&h>this.shmin||this.shmax<this.shmin&&(h>this.shmin||h<this.shmax)){if(h=this.tHSB.h,c<0?c=0:c>1&&(c=1),0==c)n=0,o=0,r=0;else if(0==l)n=o=r=c;else switch(g=h/60,a=g-~~g,v=c*(1-l),f=c*(1-l*a),m=c*(1-l*(1-a)),~~g){case 0:case 6:n=c,o=m,r=v;break;case 1:n=f,o=c,r=v;break;case 2:n=v,o=c,r=m;break;case 3:n=v,o=f,r=c;break;case 4:n=m,o=v,r=c;break;case 5:n=c,o=v,r=f}n*=255,o*=255,r*=255,e[y]=n,e[y+1]=o,e[y+2]=r}},this.changeSat=(e,t,s)=>{let i,a,n,o,r,h,l,c,d,u,p,g,m,v,f,y,w=s;const b=this.tHSB.s/this.sHSB.s;for(;w--;)for(i=t;i--;)if(y=4*(w*t+i),n=e[y],o=e[y+1],r=e[y+2],d=Math.min(n,o,r),u=Math.max(n,o,r),c=u/255,p=u-d,h=l=0,p&&(l=p/u,h=n==u?(o-r)/p*60:o==u?60*(2+(r-n)/p):60*(4+(n-o)/p),h>360?h-=360:h<0&&(h+=360)),h<this.shmax&&h>this.shmin||this.shmax<this.shmin&&(h>this.shmin||h<this.shmax)){if(l*=b,c<0?c=0:c>1&&(c=1),0==c)n=0,o=0,r=0;else if(0==l)n=o=r=c;else switch(g=h/60,a=g-~~g,v=c*(1-l),f=c*(1-l*a),m=c*(1-l*(1-a)),~~g){case 0:case 6:n=c,o=m,r=v;break;case 1:n=f,o=c,r=v;break;case 2:n=v,o=c,r=m;break;case 3:n=v,o=f,r=c;break;case 4:n=m,o=v,r=c;break;case 5:n=c,o=v,r=f}n*=255,o*=255,r*=255,e[y]=n,e[y+1]=o,e[y+2]=r}},this.changeBri=(e,t,s)=>{let i,a,n,o,r,h,l,c,d,u,p,g,m,v,f,y=s;const w=this.tHSB.b/this.sHSB.b;for(;y--;)for(i=t;i--;){f=4*(y*t+i),n=e[f],o=e[f+1],r=e[f+2],d=Math.min(n,o,r),u=Math.max(n,o,r),c=u/255;var b=u-d;if(h=l=0,b&&(l=b/u,h=n==u?(o-r)/b*60:o==u?60*(2+(r-n)/b):60*(4+(n-o)/b),h>360?h-=360:h<0&&(h+=360)),h<this.shmax&&h>this.shmin||this.shmax<this.shmin&&(h>this.shmin||h<this.shmax)){if(c*=w,c<0?c=0:c>1&&(c=1),0==c)n=0,o=0,r=0;else if(0==l)n=o=r=c;else switch(p=h/60,a=p-~~p,m=c*(1-l),v=c*(1-l*a),g=c*(1-l*(1-a)),~~p){case 0:case 6:n=c,o=g,r=m;break;case 1:n=v,o=c,r=m;break;case 2:n=m,o=c,r=g;break;case 3:n=m,o=v,r=c;break;case 4:n=g,o=m,r=c;break;case 5:n=c,o=m,r=v}n*=255,o*=255,r*=255,e[f]=n,e[f+1]=o,e[f+2]=r}}},this.changeFill=(e,t,s)=>{let i,a,n,o,r,h,l,c,d,u,p=s;for(;p--;)for(i=t;i--;){u=4*(p*t+i),a=e[u],n=e[u+1],o=e[u+2],c=Math.min(a,n,o),d=Math.max(a,n,o),l=d/255;var g=d-c;r=h=0,g&&(h=g/d,r=a==d?(n-o)/g*60:n==d?60*(2+(o-a)/g):60*(4+(a-n)/g),r>360?r-=360:r<0&&(r+=360)),(h>.2&&l>.1&&r<this.shmax&&r>this.shmin||this.shmax<this.shmin&&(r>this.shmin||r<this.shmax))&&(e[u]=this.tRGB.r,e[u+1]=this.tRGB.g,e[u+2]=this.tRGB.b)}},this.getPatchContext=(e,t)=>this.patch?(this.patch.width!==e||this.patch.height!==t?(this.patch.width=e,this.patch.height=t):this.ptx.clearRect(0,0,e,t),this.ptx):(this.patch=n.vL(e,t),this.ptx=this.patch.getContext("2d"),this.ptx),this.up=e=>{this.stage.coating.freeze(!1),this.removeMoveListeners();let t=n.l(this.scratch.getCanvas());if(t&&t.width>0&&t.height>0){let e=n.$E(this.selected.canvas,t);const s=this.selected.rect.clone();this.scratch.drawToLayer(this.selected,"source-over",this.opacity.getValue()),this.scratch.clear(),this.selected.render(),this.stage.history.add({type:"bitmapChange",kind:"replace",layer:this.selected,patchRect:t,patch:e,rect:s})}window.requestAnimationFrame((()=>this.stage.render()))},this.cleanUp=()=>{var e;null===(e=this.stage.fresco)||void 0===e||e.removeScratch(),this.brushPod.cleanUp(),this.stage.coating.freeze(!1),this.removeMoveListeners(),this.removeDownListeners(),document.removeEventListener("layer-select",this.layerSelect,!1),document.removeEventListener("zoom-change",this.updateBrush,!1),document.removeEventListener("keydown",this.keyDown,!1),document.removeEventListener("keyup",this.keyUp,!1)},document.addEventListener("layer-select",this.layerSelect,!1),document.addEventListener("zoom-change",this.updateBrush,!1),document.addEventListener("keydown",this.keyDown,!1),document.addEventListener("keyup",this.keyUp,!1),this.brush=new l.Z(new u.Z),this.brushPod=new c.Z(e,"replace-brush",this.brush,this.updateBrush),this.tolerance=new r.Z("replace-tolerance",{compact:!0,label:(0,a.Z)("tolerance")+":",defaultValue:36,range:[0,150],step:1}),this.opacity=new r.Z("replace-opacity",{compact:!0,label:(0,a.Z)("opacity")+":",defaultValue:1,range:[0,1],labelFormat:e=>(100*e).toFixed(0)+"%",labelParse:e=>parseInt(e,10)/100}),this.addDownListeners(),this.layerSelect()}}},108:(e,t,s)=>{s.d(t,{Z:()=>k});var i=s(3947),a=s(6548),n=s(3655),o=s(6817),r=s(9591),h=s(8203),l=s(8776),c=s(4188),d=s(4170),u=s(4820),p=s(7175),g=s(2817),m=s(7146),v=s(4211),f=s(8495),y=s(4686),w=s(7108),b=s(8829),x=s(4178);class Z extends b.Z{constructor(e,t){super(t,(0,a.Z)("styles"),!0),this.updateInputs=()=>{(0,i.ZP)("shape-outline-settings").style.display="line"===this.selected.shapeSettings.variant?"none":"block",(0,i.ZP)("shape-outline").checked=this.selected.shapeSettings.outlineSize>0,this.outlineColor.setColor(this.selected.shapeSettings.outlineColor),this.outlineSize.setValue(this.selected.shapeSettings.outlineSize),(0,i.ZP)("shape-shadow").checked=this.selected.shapeSettings.shadow,this.shadowColor.setColor(this.selected.shapeSettings.shadowColor),this.shadowBlur.setValue(this.selected.shapeSettings.shadowBlur),this.shadowOpacity.setValue(this.selected.shapeSettings.shadowOpacity),this.shadowDistance.setValue(this.selected.shapeSettings.shadowDistance),this.shadowDirection.setValue(this.selected.shapeSettings.shadowDirection)},this.changeOutlineState=()=>{const e=this.selected.shapeSettings.clone();this.changeOutline(),this.stage.history.add({type:"shapeSettings",kind:"outline",layer:this.selected,settings:e})},this.changeOutline=()=>{let e=(0,i.ZP)("shape-outline").checked,t=this.outlineColor.getColor().toHEX(),s=this.outlineSize.getValue();this.selected.setOutline(e?s:0,t),document.dispatchEvent(new CustomEvent("viewport-render"))},this.changeOutlineColor=e=>{const t=this.selected.shapeSettings.clone();this.changeOutline(),this.stage.history.add({type:"shapeSettings",kind:"outline",layer:this.selected,settings:t})},this.changeShadowState=()=>{const e=this.selected.shapeSettings.clone();this.changeShadow(),this.stage.history.add({type:"shapeSettings",kind:"shadow",layer:this.selected,settings:e})},this.changeShadow=()=>{this.selected.setShadow((0,i.ZP)("shape-shadow").checked,this.shadowBlur.getValue(),this.shadowOpacity.getValue(),this.shadowColor.getColor().toHEX(),this.shadowDistance.getValue(),this.shadowDirection.getValue()),document.dispatchEvent(new CustomEvent("viewport-render"))},this.changeShadowColor=e=>{const t=this.selected.shapeSettings.clone();this.changeShadow(),this.stage.history.add({type:"shapeSettings",kind:"shadow",layer:this.selected,settings:t})},this.cleanUp=()=>{this.selected=void 0,this.outlineColor.cleanUp(),this.outlineColor=void 0,this.shadowColor.cleanUp(),this.shadowColor=void 0,this.outlineSize.cleanUp(),this.shadowBlur.cleanUp(),this.shadowOpacity.cleanUp(),this.shadowDistance.cleanUp(),this.shadowDirection.cleanUp(),(0,i.ZP)("shape-outline").removeEventListener("change",this.changeOutlineState,!1),(0,i.ZP)("shape-shadow").removeEventListener("change",this.changeShadowState,!1),this.superClean()},this.stage=e,this.selected=this.stage.fresco.getSelected(),this.content.id="shape-style-content",this.content.style.height="400px",this.setContent(`\n            <section>\n                <div id="shape-outline-settings">\n                    <input type="checkbox" class="toggle-check" id="shape-outline" />\n                    <label class="switch subline pad-4" for="shape-outline">${(0,a.Z)("outline")}<span></span><span class="arrow"></span></label>\n                    <div class="toggle">\n                        <label class="split">${(0,a.Z)("color")}<div id="shape-outline-color" class="pad-4"></div></label>\n                        <div id="shape-outline-size" class="pad-10"></div>\n                    </div>\n                </div>\n                <div>\n                    <input type="checkbox" class="toggle-check" id="shape-shadow" />\n                    <label class="switch subline pad-10" for="shape-shadow">${(0,a.Z)("shadow")}<span></span><span class="arrow"></span></label>\n                    <div class="toggle">\n                        <label class="split">${(0,a.Z)("color")}<div id="shape-shadow-color" class="pad-4"></div></label>\n                        <div id="shape-shadow-blur" class="pad-10"></div>\n                        <div id="shape-shadow-distance"></div>\n                        <div id="shape-shadow-direction"></div>\n                        <div id="shape-shadow-opacity"></div>\n                    </div>\n                </div>\n            </section>\n        `),this.outlineColor=new v.Z("shape-outline-color",l.Z.fromHEX(u.ZP.altColor),this.changeOutlineColor),this.shadowColor=new v.Z("shape-shadow-color",l.Z.fromHEX(u.ZP.altColor),this.changeShadowColor);let s=this.selected.shapeSettings;const n={onStart:()=>{s=this.selected.shapeSettings.clone()},labelFormat:e=>(100*e).toFixed(0),labelParse:e=>parseInt(e,100)/100};this.outlineSize=new c.Z("shape-outline-size",{label:(0,a.Z)("size"),defaultValue:4,range:[1,100],step:1,onChange:()=>this.changeOutline(),onEnd:()=>{this.stage.history.add({type:"shapeSettings",kind:"outline",layer:this.selected,settings:s})}});const o=Object.assign(Object.assign({},n),{range:[0,1],onChange:()=>this.changeShadow(),onEnd:()=>{this.stage.history.add({type:"shapeSettings",kind:"shadow",layer:this.selected,settings:s})}});this.shadowBlur=new c.Z("shape-shadow-blur",Object.assign(Object.assign({},o),{label:(0,a.Z)("blur")})),this.shadowOpacity=new c.Z("shape-shadow-opacity",Object.assign(Object.assign({},o),{label:(0,a.Z)("opacity"),defaultValue:1})),this.shadowDistance=new c.Z("shape-shadow-distance",Object.assign(Object.assign({},o),{label:(0,a.Z)("distance"),range:[0,1]})),this.shadowDirection=new c.Z("shape-shadow-direction",Object.assign(Object.assign({},o),{label:(0,a.Z)("direction"),range:[0,360],defaultValue:180,labelFormat:e=>e.toFixed(1),labelParse:e=>parseInt(e,10)})),(0,i.ZP)("shape-outline").addEventListener("change",this.changeOutlineState,!1),(0,i.ZP)("shape-shadow").addEventListener("change",this.changeShadowState,!1),this.updateInputs(),new x.Z(this.content)}}class k extends h.Z{constructor(e){super("shape",e),this.stage=e,this.isShiftDown=!1,this.showShapeStyles=()=>{new Z(this.stage,(0,i.ZP)("shape-styles"))},this.keyDown=e=>{if("Shift"!==e.key||this.isShiftDown||(this.isShiftDown=!0,this.reform&&(this.reform.constrain=!1)),"Control"!==e.key||this.stage.coating.override||"draw"!==this.mode){if(","===e.key||"."===e.key)switch(e.key){case",":"draw"===this.mode?this.drawStroke.setValue(this.drawStroke.getValue()-1):this.lineSize.setValue(this.lineSize.getValue()-1,!0);break;case".":"draw"===this.mode?this.drawStroke.setValue(this.drawStroke.getValue()+1):this.lineSize.setValue(this.lineSize.getValue()+1,!0)}}else this.stage.coating.setPicker()},this.keyUp=e=>{"Shift"===e.key&&this.isShiftDown&&(this.isShiftDown=!1,this.reform&&(this.reform.constrain=!0)),"Control"===e.key&&this.stage.coating.override&&this.stage.coating.removePicker()},this.setMode=()=>{this.mode=document.querySelector('input[name="shape-mode"]:checked').value,"draw"===this.mode?this.setDrawType():this.setType(),this.layerSelect()},this.setDrawType=()=>{this.stage.coating.wake(),"bezier"===this.variant&&(this.stage.coating.freeze(!1),this.removeMoveListeners(),window.requestAnimationFrame((()=>this.stage.render()))),this.variant=document.querySelector('input[name="shape-draw-type"]:checked').value,(0,i.ZP)("shape-draw-fill-settings").style.display="line"===this.variant||"bezier"===this.variant?"none":"flex",(0,i.ZP)("shape-draw-radii").style.display="rounded"===this.variant?"block":"none"},this.setType=()=>{this.stage.coating.sleep(),this.removeMoveListeners(),this.variant=document.querySelector('input[name="shape-type"]:checked').value,(0,i.ZP)("shape-path").style.display="path"===this.variant?"flex":"none",(0,i.ZP)("shape-fill-settings").style.display="line"===this.variant?"none":"flex",(0,i.ZP)("shape-line-settings").style.display="line"!==this.variant?"none":"flex",(0,i.ZP)("shape-outline-radii").style.display="rounded"===this.variant?"block":"none"},this.selectType=()=>{if(this.selected instanceof w.Z){this.variant=document.querySelector('input[name="shape-type"]:checked').value;const e=this.selected.shapeSettings.clone();"path"===this.variant?this.selected.setPath(this.shape.getPath()):this.selected.setVariant(this.variant),this.stage.history.add({type:"shapeSettings",kind:"type",layer:this.selected,settings:e}),window.requestAnimationFrame((()=>this.stage.render()))}this.setType()},this.previewShape=e=>{this.selected instanceof w.Z&&(this.selected.setPath(e,!0),window.requestAnimationFrame((()=>this.stage.render())))},this.selectShape=e=>{if(this.selected instanceof w.Z){const t=this.selected.shapeSettings.clone();this.selected.setPath(e),this.stage.history.add({type:"shapeSettings",kind:"shape",layer:this.selected,settings:t}),window.requestAnimationFrame((()=>this.stage.render()))}},this.previewFill=e=>{this.selected instanceof w.Z&&(this.selected.setFill(e,!0),window.requestAnimationFrame((()=>this.stage.render())))},this.selectFill=e=>{if(this.selected instanceof w.Z){const t=this.selected.shapeSettings.clone();this.selected.setFill(e),this.stage.history.add({type:"shapeSettings",kind:"fill",layer:this.selected,settings:t}),window.requestAnimationFrame((()=>this.stage.render()))}},this.selectLine=()=>{if(this.selected instanceof w.Z){const e=this.selected.shapeSettings.clone();this.selected.setOutline(this.lineSize.getValue(),this.lineColor.getColor().toHEX()),this.stage.history.add({type:"shapeSettings",kind:"outline",layer:this.selected,settings:e}),document.dispatchEvent(new CustomEvent("viewport-render"))}},this.previewLineColor=e=>{this.selected instanceof w.Z&&(this.selected.setOutline(this.lineSize.getValue(),this.lineColor.getColor().toHEX()),document.dispatchEvent(new CustomEvent("viewport-render")))},this.selectOutlineRadii=()=>{if(this.selected instanceof w.Z){const e=this.selected.shapeSettings.clone();this.selected.setRadii(this.outlineRadii.getValue()),this.stage.history.add({type:"shapeSettings",kind:"radii",layer:this.selected,settings:e}),window.requestAnimationFrame((()=>this.stage.render()))}},this.layerSelect=()=>{if((0,i.ZP)("shape-settings").style.display="none",(0,i.ZP)("shape-draw-settings").style.display="none",(0,i.ZP)("shape-draw-no-layer").style.display="none","draw"===this.mode){if(this.stage.history.commitTransaction(),this.reform&&this.reform.cleanUp(),this.reform=void 0,!this.stage.fresco.isSelectedType(d.Z.TYPE_IMAGE))return(0,i.ZP)("shape-draw-no-layer").style.display="flex",this.stage.raster.style.cursor="auto",void(this.selected=void 0);(0,i.ZP)("shape-draw-settings").style.display="flex",this.stage.raster.style.cursor="crosshair",this.selected=this.stage.fresco.getSelected(),this.scratch=this.stage.fresco.addScratch(),this.scratch.setTarget(this.selected.id,new o.Z(0,0,this.stage.fresco.width,this.stage.fresco.height),"over")}else{if(this.selected!==this.stage.fresco.getSelected()&&this.stage.history.commitTransaction(),(0,i.ZP)("shape-settings").style.display="flex",(0,i.ZP)("shape-action").style.display="none",(0,i.ZP)("shape-styles-settings").style.display="none",this.reform||(this.reform=new g.Z(this.stage,"SHAPE"),this.reform.proxy=this.downReform),this.stage.fresco.isSelectedType(d.Z.TYPE_SHAPE))if(this.selected=this.stage.fresco.getSelected(),"svg"===this.selected.shapeSettings.variant)this.selected=void 0;else{let e=this.selected.shapeSettings;(0,i.ZP)("shape-type-"+e.variant).checked=!0,this.setType(),this.outlineRadii.setValue(e.radii),this.lineSize.setValue(e.outlineSize),this.lineColor.setColor(e.outlineColor),this.fill.setFill(this.selected.fill),"path"===e.variant&&this.shape.setPath(e.content),(0,i.ZP)("shape-action").style.display="flex",(0,i.ZP)("shape-styles-settings").style.display="flex"}else this.selected=void 0;document.querySelectorAll('input[name="shape-type"]').forEach((e=>{let t=!0;this.selected instanceof w.Z&&("line"===this.selected.shapeSettings.variant&&"line"!==e.value||"line"!==this.selected.shapeSettings.variant&&"line"===e.value)&&(t=!1),(0,i.ZP)(e.id+"-label").style.display=t?"block":"none"}))}},this.down=e=>{this.reform||this.downDraw(e)},this.move=e=>{"draw"===this.mode?this.moveDraw(e):this.moveDesign(e)},this.up=e=>{"draw"===this.mode?this.upDraw(e):this.upDesign(e)},this.downReform=(e,t)=>{this.downPoint=e,"line"===this.variant&&0===this.lineSize.getValue()||("line"===this.variant||this.fill.getFill()&&this.fill.getFill().value)&&("path"===this.variant&&(this.path2D=new Path2D(this.shape.getPath())),this.addMoveListeners())},this.moveDesign=e=>{if(this.isShiftDown){const t=this.downPoint.x-e.x,s=this.downPoint.y-e.y;if("line"===this.variant)Math.abs(t)<Math.abs(s)?e.x=this.downPoint.x:e.y=this.downPoint.y;else{let i=Math.sqrt(t*t+s*s)/Math.sqrt(2);e.x=this.downPoint.x+(t>0?-i:i),e.y=this.downPoint.y+(s>0?-i:i)}}const t=this.stage.coating.ctx;switch(t.lineWidth="line"===this.variant?Math.max(Math.round(this.lineSize.getValue()*this.stage.zoom),1):2,t.strokeStyle=n.xZ,t.clearRect(0,0,t.canvas.width,t.canvas.height),t.save(),this.variant){case"path":const s=this.stage.translateToRect(this.downPoint,e,this.isShiftDown,!0);if(s.width>0&&s.height>0){const e=new Path2D;e.addPath(this.path2D,(new DOMMatrix).scale(s.width/100,s.height/100)),t.translate(s.x,s.y),t.stroke(e)}break;case"rounded":const i=o.Z.fromPoints([this.downPoint,e]);p.Z.roundRect(t,i.x,i.y,i.width,i.height,Math.max(Math.round(this.outlineRadii.getValue()*this.stage.zoom),1)),t.stroke();break;case"rectangle":t.strokeRect(this.downPoint.x,this.downPoint.y,e.x-this.downPoint.x,e.y-this.downPoint.y);break;case"ellipse":p.Z.ellipse(t,this.downPoint,e),t.stroke();break;case"line":p.Z.line(t,this.downPoint,e),t.stroke()}t.restore()},this.upDesign=e=>{const t=this.stage.coating.ctx;if(t.clearRect(0,0,t.canvas.width,t.canvas.height),this.removeMoveListeners(),this.downPoint.distanceTo(e)<6)return;let s=this.stage.translateToRect(this.downPoint,e,"line"!==this.variant&&this.isShiftDown,!1),i=new y.Z;switch(this.variant){case"path":i.variant="path",i.content=this.shape.getPath();break;case"rounded":i.variant="rounded",i.radii=this.outlineRadii.getValue();break;case"rectangle":i.variant="rectangle";break;case"ellipse":i.variant="ellipse";break;case"line":if(i.variant="line",this.isShiftDown){const t=this.downPoint.x-e.x,s=this.downPoint.y-e.y;if("line"===this.variant)Math.abs(t)<Math.abs(s)?e.x=this.downPoint.x:e.y=this.downPoint.y;else{let i=Math.sqrt(t*t+s*s)/Math.sqrt(2);e.x=this.downPoint.x+(t>0?-i:i),e.y=this.downPoint.y+(s>0?-i:i)}}let t=s.center(),a=s.bottomRight().distanceTo(s.topLeft());s.x=Math.round(t.x-a/2),s.y=t.y-Math.ceil(this.lineSize.getValue()/2),s.width=Math.round(a),s.height=this.lineSize.getValue(),s.rotation=this.stage.translateRasterToFresco(this.downPoint).angleTo(this.stage.translateRasterToFresco(e)),i.outlineSize=this.lineSize.getValue(),i.outlineColor=this.lineColor.getColor().toHEX()}let a=this.fill.getFill();a&&a.value&&(i.fillType=this.fill.getFill().getType(),i.fillValue=this.fill.getFill().getStringValue()),this.stage.addShape(s,i)},this.downDraw=e=>{if(!this.selected)return;if((0,i.ZP)("shape-draw-fill").checked||0!==this.drawStroke.getValue()){if("bezier"===this.variant&&this.upPoint)return this.stage.coating.freeze(!1),this.addDrawHistory(),this.downPoint=this.upPoint=void 0,void this.removeMoveListeners();this.scratch.ctx.fillStyle=u.ZP.altColor,this.scratch.ctx.strokeStyle=u.ZP.mainColor,this.scratch.ctx.lineWidth=this.drawStroke.getValue(),this.scratch.settings.opacity=this.drawOpacity.getValue(),this.downPoint=this.stage.translateRasterToFresco(e),this.stage.coating.freeze(!0),this.addMoveListeners()}},this.moveDraw=e=>{this.scratch.clear(),e=this.stage.translateRasterToFresco(e),this.scratch.ctx.save();const t=(0,i.ZP)("shape-draw-fill").checked;if(this.isShiftDown){const t=this.downPoint.x-e.x,s=this.downPoint.y-e.y;if("line"===this.variant||"bezier"===this.variant)Math.abs(t)<Math.abs(s)?e.x=this.downPoint.x:e.y=this.downPoint.y;else{let i=Math.sqrt(t*t+s*s)/Math.sqrt(2);e.x=this.downPoint.x+(t>0?-i:i),e.y=this.downPoint.y+(s>0?-i:i)}}this.isDown||"bezier"!==this.variant?("bezier"===this.variant?(p.Z.line(this.scratch.ctx,this.downPoint,e),this.scratch.ctx.stroke()):(t||"line"===this.variant)&&p.Z.fill(this.scratch.ctx,this.variant,this.downPoint,e,this.drawRadii.getValue()),this.drawStroke.getValue()>0&&"line"!==this.variant&&"bezier"!==this.variant&&p.Z.stroke(this.scratch.ctx,this.variant,this.downPoint,e,this.drawRadii.getValue())):(p.Z.bezier(this.scratch.ctx,this.downPoint,this.upPoint,e),this.scratch.ctx.stroke()),this.scratch.ctx.restore(),this.scratch.applySelection(this.stage),window.requestAnimationFrame((()=>this.stage.render()))},this.upDraw=e=>{this.upPoint=this.stage.translateRasterToFresco(e);const t=this.downPoint.x===this.upPoint.x&&this.downPoint.y===this.upPoint.y;!t&&"bezier"===this.variant&&this.upPoint||(this.upPoint=void 0,this.stage.coating.freeze(!1),this.removeMoveListeners(),t||(this.move(e),this.addDrawHistory()))},this.addDrawHistory=()=>{let e=n.l(this.scratch.getCanvas());if(e&&e.width>0&&e.height>0){let t=this.selected.rect?n.$E(this.selected.canvas,e.rebase(this.selected.rect.x,this.selected.rect.y)):void 0;const s=n.dN(this.selected.mask),i=this.selected.rect?this.selected.rect.clone():void 0;this.selected.extendCanvas(e),this.scratch.drawToLayer(this.selected,void 0,this.drawOpacity.getValue()),this.scratch.clear(),this.selected.render(),this.stage.history.add({type:"bitmapChange",kind:"shape",layer:this.selected,patchRect:this.selected.rect?e.rebase(this.selected.rect.x,this.selected.rect.y):e,patch:t,rect:i,mask:s})}},this.deleteLayer=()=>this.stage.deleteLayer(),this.duplicateLayer=()=>this.stage.duplicateLayer(),this.cleanUp=()=>{var e;this.stage.history.commitTransaction(),this.reform&&(this.reform.cleanUp(),this.reform=void 0),null===(e=this.stage.fresco)||void 0===e||e.removeScratch(),this.stage.coating.removePicker(),this.stage.coating.wake(),this.stage.coating.freeze(!1),this.removeMoveListeners(),this.removeDownListeners(),window.requestAnimationFrame((()=>this.stage.render())),this.drawRadii.cleanUp(),this.drawStroke.cleanUp(),this.drawOpacity.cleanUp(),this.fill.cleanUp(),this.shape.cleanUp(),this.lineColor.cleanUp(),this.lineSize.cleanUp(),this.outlineRadii.cleanUp(),document.removeEventListener("layer-select",this.layerSelect,!1),document.removeEventListener("keyup",this.keyUp,!1),document.removeEventListener("keydown",this.keyDown,!1),document.querySelectorAll('input[name="shape-draw-type"]').forEach((e=>e.removeEventListener("change",this.setDrawType))),document.querySelectorAll('input[name="shape-type"]').forEach((e=>e.removeEventListener("change",this.selectType))),(0,i.ZP)("shape-delete").removeEventListener("click",this.deleteLayer,!0),(0,i.ZP)("shape-duplicate").removeEventListener("click",this.duplicateLayer,!0),(0,i.ZP)("shape-mode-draw").removeEventListener("change",this.setMode),(0,i.ZP)("shape-mode-design").removeEventListener("change",this.setMode),(0,i.ZP)("shape-styles").removeEventListener("click",this.showShapeStyles,!1)},document.addEventListener("layer-select",this.layerSelect,!1),document.addEventListener("keydown",this.keyDown,!1),document.addEventListener("keyup",this.keyUp,!1),(0,i.ZP)("shape-mode-draw").addEventListener("change",this.setMode),(0,i.ZP)("shape-mode-design").addEventListener("change",this.setMode),(0,i.ZP)("shape-styles").addEventListener("click",this.showShapeStyles,!1),this.drawStroke=new c.Z("shape-draw-size",{compact:!0,label:(0,a.Z)("outline")+":",defaultValue:5,range:[0,50],step:1}),this.drawRadii=new c.Z("shape-draw-radii",{compact:!0,label:(0,a.Z)("radius")+":",defaultValue:5,range:[0,100],step:1}),this.drawOpacity=new c.Z("shape-draw-opacity",{compact:!0,label:(0,a.Z)("opacity")+":",defaultValue:1,labelFormat:e=>(100*e).toFixed(0)+"%"}),document.querySelectorAll('input[name="shape-draw-type"]').forEach((e=>e.addEventListener("change",this.setDrawType))),document.querySelectorAll('input[name="shape-type"]').forEach((e=>e.addEventListener("change",this.selectType))),this.shape=new f.Z("shape-shape",this.selectShape,this.previewShape),this.fill=new m.Z("shape-fill",new r.Z(l.Z.fromHEX(u.ZP.mainColor)),this.selectFill,this.previewFill),this.lineColor=new v.Z("shape-line-color",l.Z.fromHEX(u.ZP.altColor),this.selectLine,this.previewLineColor),this.lineSize=new c.Z("shape-line-size",{compact:!0,label:(0,a.Z)("size")+":",defaultValue:4,range:[1,100],step:1,onEnd:this.selectLine}),this.outlineRadii=new c.Z("shape-outline-radii",{compact:!0,label:(0,a.Z)("radius")+":",defaultValue:5,range:[0,100],step:1,onEnd:this.selectOutlineRadii}),(0,i.ZP)("shape-delete").addEventListener("click",this.deleteLayer,!0),(0,i.ZP)("shape-duplicate").addEventListener("click",this.duplicateLayer,!0),this.addDownListeners(),this.setMode()}}},8822:(e,t,s)=>{s.d(t,{Z:()=>d});var i=s(3947),a=s(3655),n=s(8203),o=s(4188),r=s(2257),h=s(972),l=s(1126),c=s(6548);class d extends n.Z{constructor(e){super("temper",e),this.mode="increase",this.method="vibrance",this.layerSelect=()=>{if(!this.stage.fresco.isSelectedImageWithCanvas())return(0,i.ZP)("temper-no-layer").style.display="flex",(0,i.ZP)("temper-settings").style.display="none",this.selected=null,void this.updateBrush();(0,i.ZP)("temper-settings").style.display="flex",(0,i.ZP)("temper-no-layer").style.display="none",this.selected=this.stage.fresco.getSelected(),this.scratch=this.stage.fresco.addScratch(),this.scratch.setTarget(this.selected.id,this.selected.rect,"over"),this.stage.fresco.hasSelection()&&this.scratch.addBake(),this.updateBrush()},this.toggleMode=()=>{this.setMode("increase"===this.mode?"decrease":"increase")},this.selectMode=e=>{this.setMode(e.currentTarget===(0,i.ZP)("temper-mode-increase")?"increase":"decrease")},this.setMode=e=>{this.mode=e,(0,i.ZP)("temper-mode-increase").checked="increase"===this.mode,(0,i.ZP)("temper-mode-decrease").checked="decrease"===this.mode},this.isShiftDown=!1,this.keyDown=e=>{if("Shift"===e.key&&!this.isShiftDown)return this.isShiftDown=!0,void this.toggleMode();switch(e.key){case",":e.shiftKey?this.brushPod.stepSoftness(.1):this.brushPod.stepSize(-10);break;case".":e.shiftKey?this.brushPod.stepSoftness(-.1):this.brushPod.stepSize(10)}},this.keyUp=e=>{"Shift"===e.key&&(this.isShiftDown=!1,this.toggleMode())},this.updateBrush=()=>{this.selected?this.stage.coating.setCursorImage(this.brush.getCursorImage(this.stage.zoom)):this.stage.coating.removeCursorImage()},this.down=(e,t)=>{this.selected&&(this.stage.coating.freeze(!0),this.method=document.querySelector('input[name="temper-method"]:checked').value,this.isShiftDown||(this.x=this.y=-1),"touch"!==t&&this.move(e),this.addMoveListeners())},this.x=-1,this.y=-1,this.move=e=>{let t=2*this.brush.getStep(),s=!1;if(e=this.stage.translateRasterToFresco(e,this.selected.rect),-1===this.x&&(this.lx=e.x,this.ly=e.y,this.x=e.x,this.y=e.y,this.drawShape(this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),s=!0),e.x!==this.x||e.y!==this.y){let i=e.x-this.x,a=e.y-this.y,n=i>0?1:-1,o=a>0?1:-1;if(i=i<0?-i:i,a=a<0?-a:a,i>a){let e=.5*i;for(let r=1;r<=i;r++)this.x+=n,e+=a,e>=i&&(e-=i,this.y+=o),(this.x>this.lx+t||this.x<this.lx-t||this.y>this.ly+t||this.y<this.ly-t)&&(this.lx=this.x,this.ly=this.y,this.drawShape(this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),s=!0)}else{let e=.5*a;for(let r=1;r<=a;r++)this.y+=o,e+=i,e>=a&&(e-=a,this.x+=n),(this.x>this.lx+t||this.x<this.lx-t||this.y>this.ly+t||this.y<this.ly-t)&&(this.lx=this.x,this.ly=this.y,this.drawShape(this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),s=!0)}}s&&(this.scratch.applySelection(this.stage),window.requestAnimationFrame((()=>this.stage.render())))},this.drawShape=(e,t)=>{let s=this.strength.getValue();"decrease"===this.mode&&(s*=-1);let i=this.getPatchContext(this.brush.canvas.width,this.brush.canvas.height);switch(i.save(),i.drawImage(this.selected.canvas,-e,-t),this.method){case"vibrance":this.vibrance(i,s);break;case"saturation":this.saturation(i,s);break;case"temperature":this.temperature(i,s)}i.globalCompositeOperation="destination-in",i.drawImage(this.brush.canvas,0,0),i.restore(),this.scratch.ctx.drawImage(this.patch,e,t)},this.getPatchContext=(e,t)=>this.patch?(this.patch.width!==e||this.patch.height!==t?(this.patch.width=e,this.patch.height=t):this.ptx.clearRect(0,0,e,t),this.ptx):(this.patch=a.vL(e,t),this.ptx=this.patch.getContext("2d"),this.ptx),this.up=e=>{this.stage.coating.freeze(!1),this.removeMoveListeners();let t=a.l(this.scratch.getCanvas());if(t&&t.width>0&&t.height>0){let e=a.$E(this.selected.canvas,t);const s=this.selected.rect.clone();this.scratch.drawToLayer(this.selected),this.scratch.clear(),this.selected.render(),this.stage.history.add({type:"bitmapChange",kind:"temper",layer:this.selected,patchRect:t,patch:e,rect:s})}window.requestAnimationFrame((()=>this.stage.render()))},this.saturation=(e,t)=>{var s=e.canvas.width,i=e.canvas.height;t+=100,t/=100;for(var a,n,o,r,h,l,c=e.getImageData(0,0,s,i),d=c.data,u=i;u--;)for(a=s;a--;)n=d[h=4*(u*s+a)],o=d[h+1],r=d[h+2],(n=(l=Math.sqrt(n*n*.299+o*o*.587+r*r*.114))+(n-l)*t)>255?n=255:n<0&&(n=0),(o=l+(o-l)*t)>255?o=255:o<0&&(o=0),(r=l+(r-l)*t)>255?r=255:r<0&&(r=0),d[h]=n,d[h+1]=o,d[h+2]=r;e.putImageData(c,0,0)},this.vibrance=(e,t)=>{var s=e.canvas.width,i=e.canvas.height;t*=-.02;for(var n,o,r,h,l,c,d,u,p=e.getImageData(0,0,s,i),g=p.data,m=i;m--;)for(n=s;n--;)c=.299*(o=g[l=4*(m*s+n)])+.587*(r=g[l+1])+.114*(h=g[l+2]),d=Math.max(o,r,h),Math.min(o,r,h),u=(d-c)*t/255,(o=a.CD(o,d,u))>255?o=255:o<0&&(o=0),(r=a.CD(r,d,u))>255?r=255:r<0&&(r=0),(h=a.CD(h,d,u))>255?h=255:h<0&&(h=0),g[l]=o,g[l+1]=r,g[l+2]=h;e.putImageData(p,0,0)},this.temperature=(e,t)=>{var s=e.canvas.width,i=e.canvas.height;t=Math.round(t/10);for(var a,n,o,r,h=e.getImageData(0,0,s,i),l=h.data,c=i;c--;)for(a=s;a--;)(n=l[r=4*(c*s+a)]+t)>255?n=255:n<0&&(n=0),(o=l[r+2]-t)>255?o=255:o<0&&(o=0),l[r]=n,l[r+2]=o;e.putImageData(h,0,0)},this.cleanUp=()=>{var e;null===(e=this.stage.fresco)||void 0===e||e.removeScratch(),this.brushPod.cleanUp(),this.strength.cleanUp(),this.stage.coating.freeze(!1),this.removeMoveListeners(),this.removeDownListeners(),document.removeEventListener("zoom-change",this.updateBrush,!1),document.removeEventListener("layer-select",this.layerSelect,!1),document.removeEventListener("keydown",this.keyDown,!1),document.removeEventListener("keyup",this.keyUp,!1),(0,i.ZP)("temper-mode-increase").removeEventListener("click",this.selectMode,!1),(0,i.ZP)("temper-mode-decrease").removeEventListener("click",this.selectMode,!1),this.selected=null,this.patch=null,this.ptx=null},document.addEventListener("keydown",this.keyDown,!1),document.addEventListener("keyup",this.keyUp,!1),(0,i.ZP)("temper-mode-increase").addEventListener("click",this.selectMode,!1),(0,i.ZP)("temper-mode-decrease").addEventListener("click",this.selectMode,!1),document.addEventListener("layer-select",this.layerSelect,!1),document.addEventListener("zoom-change",this.updateBrush,!1),this.brush=new r.Z(new h.Z),this.brushPod=new l.Z(e,"temper-brush",this.brush,this.updateBrush),this.strength=new o.Z("temper-brush-strength",{compact:!0,label:(0,c.Z)("strength")+":",range:[1,100],defaultValue:30,step:1});const t=document.querySelector('input[name="temper-mode"]:checked').value;this.setMode(t),this.addDownListeners(),this.layerSelect()}}},2932:(e,t,s)=>{s.d(t,{Z:()=>L});var i=s(3947),a=s(6548),n=s(3655),o=s(9591),r=s(6817),h=s(8203),l=s(4188),c=s(8776),d=s(4170),u=s(4820),p=s(7146),g=s(2817),m=s(7163),v=s(4178),f=s(5934),y=s(3673),w=s(1951);class b{constructor(e,t,s,o){if(this.addLocalFont=()=>{(0,f.Q0)(!0).then((async e=>{for(var t,s=0;t=e[s];s++)await(0,f.ZB)(this.stage,t);this.removeEventHandlers(),this.showFontList()}))},this.showFontList=()=>{(0,i.ZP)("font-wrap").classList.add("show"),(0,i.ZP)("font-wrap").classList.add("modal"),this.populateFonts(),this.setEventHandlers(),this.selected&&this.setFont(this.selected)},this.hideFontList=(e=!0)=>{(0,i.ZP)("font-wrap").classList.remove("show"),(0,i.ZP)("font-wrap").classList.remove("modal"),e&&this.inFocus&&this.inFocus.getAttribute("data")!==this.selected&&this.loadFont(this.selected,!0),this.selected&&(0,i.ZP)("font:"+this.selected)&&(0,i.ZP)("font:"+this.selected).classList.remove("selected"),this.removeEventHandlers()},this.populateFonts=()=>{const e=(0,i.ZP)("font-list-holder-ss-content");e.childElementCount!==m.Z.fontList.length&&(e.innerHTML="",m.Z.fontList.forEach((t=>{let s=document.createElement("div");t.local?s.append((0,i.T)("img",{src:URL.createObjectURL(t.thumb),title:t.name,className:"thumb ic",loading:"lazy",width:200,height:40}),(0,i.T)("img",{src:"/img/icon/close.svg",title:"Remove font",className:"close ic",onclick:e=>this.removeFont(e,"font:"+t.name)})):s.append((0,i.T)("img",{src:"/font/"+t.short+".png",title:t.name,className:"thumb ic",loading:"lazy",width:200,height:40})),s.setAttribute("data",t.name),s.setAttribute("id","font:"+t.name),s.classList.add("font-pod"),t.premium&&s.classList.add("premium"),e.appendChild(s)})))},this.setEventHandlers=()=>{document.addEventListener("keydown",this.keyPress,!0);const e=document.querySelectorAll("#font-list-holder div.font-pod");for(let t=0;t<e.length;t++)e[t].addEventListener("click",this.selectFont,!1),e[t].addEventListener("mouseenter",this.enterFont,!1)},this.removeEventHandlers=()=>{document.removeEventListener("keydown",this.keyPress,!0);const e=document.querySelectorAll("#font-list-holder div.font-pod");for(let t=0;t<e.length;t++)e[t].removeEventListener("click",this.selectFont,!1),e[t].removeEventListener("mouseenter",this.enterFont,!1)},this.dragStart=e=>{e.stopPropagation(),this.p=new y.Z(e.clientX,e.clientY),this.d=new y.Z(this.fontList.offsetLeft,this.fontList.offsetTop),document.addEventListener("mousemove",this.dragMove,!0),document.addEventListener("mouseup",this.dragEnd,!0)},this.dragMove=e=>{e.stopPropagation(),this.fontList.style.left=Math.round(this.d.x+(e.clientX-this.p.x))+"px",this.fontList.style.top=Math.round(this.d.y+(e.clientY-this.p.y))+"px"},this.dragEnd=e=>{e.stopPropagation(),this.p=void 0,document.removeEventListener("mousemove",this.dragMove,!0),document.removeEventListener("mouseup",this.dragEnd,!0)},this.keyPress=e=>{var t;if(e.preventDefault(),e.stopPropagation(),null===(t=this.inFocus)||void 0===t||t.classList.remove("focus"),!this.inFocus){const e=document.querySelectorAll("#font-list-holder div.font-pod");this.inFocus=e[0]}if("ArrowUp"===e.key){for(this.inFocus=this.inFocus.previousElementSibling;this.inFocus&&"none"===this.inFocus.style.display;)this.inFocus=this.inFocus.previousElementSibling;if(!this.inFocus){const e=document.querySelectorAll("#font-list-holder div.font-pod");this.inFocus=e[e.length-1]}}else if("ArrowDown"===e.key){for(this.inFocus=this.inFocus.nextElementSibling;this.inFocus&&"none"===this.inFocus.style.display;)this.inFocus=this.inFocus.nextElementSibling;if(!this.inFocus){const e=document.querySelectorAll("#font-list-holder div.font-pod");this.inFocus=e[0]}}else{if("Escape"===e.key)return void this.hideFontList();if("Enter"===e.key)this.inFocus&&this.inFocus.getAttribute("data")!==this.selected&&((!this.inFocus.classList.contains("premium")||u.ZP.user.subscription||this.stage.fresco.block)&&(this.loadFont(this.inFocus.getAttribute("data")),this.hideFontList(!1)),this.hideFontList(!0));else{let t=(0,i.ZP)("font-search").value;if("Backspace"===e.key)t=t.substring(0,t.length-1);else if("Delete"===e.key)t="";else{if(e.key.length>1)return;t+=e.key}(0,i.ZP)("font-search").value=t;const s=document.querySelectorAll("#font-list-holder div.font-pod"),a=(0,i.ZP)("font-search").value;this.inFocus=void 0;for(let e=0;e<s.length;e++){s[e].getAttribute("data").toLowerCase().startsWith(a)?(s[e].style.display="block",this.inFocus||(this.inFocus=s[e])):s[e].style.display="none"}}}if(this.inFocus){this.inFocus.classList.add("focus");const e=this.inFocus.getAttribute("data");this.inFocus.scrollIntoView({behavior:"auto",block:"nearest",inline:"nearest"}),n.Ds("preview",200,(()=>{this.loadFont(e,!0)}))}},this.lx=0,this.ly=0,this.enterFont=e=>{var t;if(e.clientX===this.lx&&e.clientY===this.ly)return;this.lx=e.clientX,this.ly=e.clientY,null===(t=this.inFocus)||void 0===t||t.classList.remove("focus"),this.inFocus=e.currentTarget,this.inFocus.classList.add("focus");const s=this.inFocus.getAttribute("data");n.Ds("preview",200,(()=>{this.loadFont(s,!0)}))},this.selectFont=e=>{var t;let s=e.currentTarget,i=s.classList.contains("premium"),a=s.getAttribute("data");!i||(null===(t=u.ZP.user)||void 0===t?void 0:t.subscription)||this.stage.fresco.block?(this.loadFont(a),this.hideFontList(!1)):new w.Z(this.stage,"FONT")},this.removeFont=(e,t)=>{e.preventDefault(),e.stopPropagation();let s=(0,i.ZP)(t);m.Z.removeLocalFontDesc(s.getAttribute("data")),s.remove()},this.loadFont=async(e,t=!1)=>{try{await m.Z.loadFont(e);if(t)this.preview(e);else{const t=this.selected;t!==e&&(this.setFont(e),this.callback(e,t))}}catch(s){console.error("Could not load font",e,s)}},this.cleanUp=()=>{this.removeEventHandlers(),this.holder.removeEventListener("click",this.showFontList,!1),this.hideFontList()},this.stage=e,this.holder=t,this.preview=o,this.callback=s,this.holder.addEventListener("click",this.showFontList,!1),this.selected=m.Z.fontList[0].name,!(0,i.ZP)("font-list")){let e=(0,i.T)("div",{id:"font-wrap",onmousedown:e=>{e.target===(0,i.ZP)("font-wrap")&&this.hideFontList()}},(0,i.T)("div",{id:"font-list"},(0,i.T)("img",{id:"font-close",className:"close ic",src:"/img/icon/close.svg",onclick:()=>this.hideFontList()}),(0,i.T)("div",{id:"font-list-title",className:"title",onmousedown:e=>this.dragStart(e)},(0,a.Z)("font")),(0,i.T)("div",{className:"splitter"}),(0,i.T)("div",{style:"position:relative"},(0,i.T)("input",{id:"font-search",className:"font-search",type:"text",placeholder:(0,a.Z)("search")}),(0,i.T)("img",{id:"font-search-icon",className:"search-icon ic",src:"/img/tool/thick/zoom.svg"})),(0,i.T)("div",{id:"font-list-holder"}),(0,i.T)("div",{id:"font-list-add"},(0,i.T)("a",{className:"button positive",onclick:()=>this.addLocalFont()},(0,a.Z)("addLocalFont")))));(0,i.ZP)("workspace").appendChild(e),new v.Z((0,i.ZP)("font-list-holder"))}this.fontList=(0,i.ZP)("font-list")}setFont(e){this.selected&&(0,i.ZP)("font:"+this.selected)&&(0,i.ZP)("font:"+this.selected).classList.remove("selected");let t=(0,i.ZP)("font:"+e);if(t){t.classList.add("selected");let e=t.childNodes[0];this.holder.innerHTML='<img src="'+e.src+'" class="ic" title="'+e.title+'" />'}else{let t=m.Z.getFontDesc(e);t&&(t.local?this.holder.innerHTML='<img src="'+URL.createObjectURL(t.thumb)+'" class="ic" title="'+t.name+'" />':this.holder.innerHTML='<img src="/font/'+t.short+'.png" class="ic" title="'+t.name+'" />')}this.selected=e}}var x=s(7758),Z=s(7976),k=s(8829);class P extends k.Z{constructor(e,t){super(t,(0,a.Z)("format")),this.changeUppercase=()=>{const e=this.selected.textSettings.clone();this.selected.setTextUpperCase(!this.selected.textSettings.uppercase),(0,i.ZP)("text-uppercase").classList.toggle("selected",this.selected.textSettings.uppercase),this.stage.history.add({type:"textSettings",kind:"uppercase",layer:this.selected,settings:e}),document.dispatchEvent(new CustomEvent("viewport-render"))},this.changeItalic=()=>{const e=this.selected.textSettings.clone();this.selected.setTextItalic(!this.selected.textSettings.italic),(0,i.ZP)("text-italic").classList.toggle("selected",this.selected.textSettings.italic),this.stage.history.add({type:"textSettings",kind:"italic",layer:this.selected,settings:e}),document.dispatchEvent(new CustomEvent("viewport-render"))},this.changeBold=()=>{const e=this.selected.textSettings.clone();this.selected.setTextBold(!this.selected.textSettings.bold),(0,i.ZP)("text-bold").classList.toggle("selected",this.selected.textSettings.bold),this.stage.history.add({type:"textSettings",kind:"bold",layer:this.selected,settings:e}),document.dispatchEvent(new CustomEvent("viewport-render"))},this.changeLineSpace=e=>{this.selected.textSettings.lineSpace=e,n.Ds("text-change",50,(()=>{this.selected.setLineSpace(e),document.dispatchEvent(new CustomEvent("viewport-render"))}))},this.changeLetterSpace=e=>{this.selected.textSettings.letterSpace=e,n.Ds("text-change",50,(()=>{this.selected.setLetterSpace(e),document.dispatchEvent(new CustomEvent("viewport-render"))}))},this.changeAlign=e=>{const t=this.selected.textSettings.clone(),s=document.querySelector('input[name="text-align"]:checked').value;this.selected.setTextAlign(s),t.align!==this.selected.textSettings.align&&this.stage.history.add({type:"textSettings",kind:"align",layer:this.selected,settings:t}),document.dispatchEvent(new CustomEvent("viewport-render"))},this.cleanUp=()=>{this.lineSpacing.cleanUp(),this.letterSpacing.cleanUp(),(0,i.ZP)("text-align-left").removeEventListener("click",this.changeAlign,!1),(0,i.ZP)("text-align-center").removeEventListener("click",this.changeAlign,!1),(0,i.ZP)("text-align-right").removeEventListener("click",this.changeAlign,!1),(0,i.ZP)("text-uppercase").removeEventListener("click",this.changeUppercase,!1),(0,i.ZP)("text-italic").removeEventListener("click",this.changeItalic,!1),(0,i.ZP)("text-bold").removeEventListener("click",this.changeBold,!1),this.superClean()},this.stage=e,this.setContent(`\n            <section>\n                <div id="line-space" class="range-box pad-5"></div>\n                <div id="letter-space" class="range-box pad-10"></div>\n                <label class="pad-10">${(0,a.Z)("align")}</label>\n                <div class="switch-icon-field">\n                    <input type="radio" id="text-align-left" name="text-align" value="left"><label for="text-align-left" tooltip="${(0,a.Z)("alignLeft")}" flow="up-right"><img src="/img/icon/align-left.svg" class="ic"></label>\n                    <input type="radio" id="text-align-center" name="text-align" value="center"><label for="text-align-center" tooltip="${(0,a.Z)("alignCenter")}" flow="up"><img src="/img/icon/align-center.svg" class="ic"></label>\n                    <input type="radio" id="text-align-right" name="text-align" value="right"><label for="text-align-right" tooltip="${(0,a.Z)("alignRight")}" flow="up"><img src="/img/icon/align-right.svg" class="ic"></label>\n                </div>\n                <label class="pad-16">${(0,a.Z)("style")}</label>\n                <ul class="icon-button-set pad-4">\n                    <li id="text-uppercase" tooltip="${(0,a.Z)("uppercase")}" flow="up"><img class="ic" src="/img/icon/uppercase.svg" /></li>\n                    <li id="text-italic" tooltip="${(0,a.Z)("italic")}" flow="up"><img class="ic" src="/img/icon/italic.svg" /></li>\n                    <li id="text-bold" tooltip="${(0,a.Z)("bold")}" flow="up"><img class="ic" src="/img/icon/bold.svg" /></li>\n                </ul>\n            </section>\n        `),this.selected=this.stage.fresco.getSelected();let s=this.selected.textSettings;const o={onStart:()=>{s=this.selected.textSettings.clone()},labelFormat:e=>(100*e).toFixed(0),labelParse:e=>parseInt(e,10)/100};this.lineSpacing=new l.Z("line-space",Object.assign(Object.assign({},o),{label:(0,a.Z)("lineSpace"),range:[-1,1],onChange:this.changeLineSpace,onEnd:()=>{this.stage.history.add({type:"textSettings",kind:"linespace",layer:this.selected,settings:s})}})),this.lineSpacing.setValue(s.lineSpace),this.letterSpacing=new l.Z("letter-space",Object.assign(Object.assign({},o),{label:(0,a.Z)("letterSpace"),range:[-.2,1],onChange:this.changeLetterSpace,onEnd:()=>{this.stage.history.add({type:"textSettings",kind:"letterspace",layer:this.selected,settings:s})}})),this.letterSpacing.setValue(s.letterSpace),(0,i.ZP)("text-uppercase").classList.toggle("selected",this.selected.textSettings.uppercase),(0,i.ZP)("text-italic").classList.toggle("selected",this.selected.textSettings.italic),(0,i.ZP)("text-bold").classList.toggle("selected",this.selected.textSettings.bold),(0,i.ZP)("text-align-left").checked="left"===this.selected.textSettings.align,(0,i.ZP)("text-align-center").checked="center"===this.selected.textSettings.align,(0,i.ZP)("text-align-right").checked="right"===this.selected.textSettings.align,(0,i.ZP)("text-align-left").addEventListener("click",this.changeAlign,!1),(0,i.ZP)("text-align-center").addEventListener("click",this.changeAlign,!1),(0,i.ZP)("text-align-right").addEventListener("click",this.changeAlign,!1),(0,i.ZP)("text-uppercase").addEventListener("click",this.changeUppercase,!1),(0,i.ZP)("text-italic").addEventListener("click",this.changeItalic,!1),(0,i.ZP)("text-bold").addEventListener("click",this.changeBold,!1)}}var E=s(4211);class S extends k.Z{constructor(e,t){super(t,(0,a.Z)("styles"),!0),this.updateInputs=()=>{(0,i.ZP)("text-background").checked=this.selected.textSettings.background,(0,i.ZP)("text-background-punch").checked=this.selected.textSettings.backgroundPunch,this.backgroundColor.setColor(this.selected.textSettings.backgroundColor),this.backgroundOffset.setValue(this.selected.textSettings.backgroundOffset),(0,i.ZP)("text-background-type-full").checked=this.selected.textSettings.backgroundType==x.Z.BACKGROUND_FULL,(0,i.ZP)("text-background-type-line").checked=this.selected.textSettings.backgroundType==x.Z.BACKGROUND_LINE,(0,i.ZP)("text-background-type-word").checked=this.selected.textSettings.backgroundType==x.Z.BACKGROUND_WORD,(0,i.ZP)("text-outline").checked=this.selected.textSettings.outline,(0,i.ZP)("text-outline-punch").checked=this.selected.textSettings.outlinePunch,this.outlineColor.setColor(this.selected.textSettings.outlineColor),this.outlineSize.setValue(this.selected.textSettings.outlineSize),this.outlineDistance.setValue(this.selected.textSettings.outlineDistance),this.outlineDirection.setValue(this.selected.textSettings.outlineDirection),(0,i.ZP)("text-shadow").checked=this.selected.textSettings.shadow,this.shadowColor.setColor(this.selected.textSettings.shadowColor),this.shadowBlur.setValue(this.selected.textSettings.shadowBlur),this.shadowAlpha.setValue(this.selected.textSettings.shadowAlpha),this.shadowDirection.setValue(this.selected.textSettings.shadowDirection),this.shadowDistance.setValue(this.selected.textSettings.shadowDistance),(0,i.ZP)("text-curve").checked=this.selected.textSettings.curve,this.curveAmount.setValue(this.selected.textSettings.curveAmount),(0,i.ZP)("text-curve-flip").checked=this.selected.textSettings.curveFlip,(0,i.ZP)("text-curve-spread").checked=this.selected.textSettings.curveSpread,(0,i.ZP)("text-curve-type-arc").checked="arc"===this.selected.textSettings.curveType,(0,i.ZP)("text-curve-type-circle").checked="circle"===this.selected.textSettings.curveType,(0,i.ZP)("text-curve-type-half").checked="half"===this.selected.textSettings.curveType,(0,i.ZP)("text-curve-amount").style.display="arc"!==this.selected.textSettings.curveType?"none":"block",(0,i.ZP)("text-curve-flip-label").style.display="arc"!==this.selected.textSettings.curveType?"block":"none",(0,i.ZP)("text-curve-spread-label").style.display="arc"!==this.selected.textSettings.curveType?"block":"none"},this.changeBackground=e=>{const t=this.selected.textSettings.clone();let s=(0,i.ZP)("text-background").checked,a=(0,i.ZP)("text-background-punch").checked,n=this.backgroundOffset.getValue(),o=this.backgroundColor.getColor().toHEX(),r="";r=(0,i.ZP)("text-background-type-full").checked?x.Z.BACKGROUND_FULL:(0,i.ZP)("text-background-type-line").checked?x.Z.BACKGROUND_LINE:x.Z.BACKGROUND_WORD,this.selected.setBackground(s,r,o,a,n),this.stage.history.add({type:"textSettings",kind:"background",layer:this.selected,settings:t}),document.dispatchEvent(new CustomEvent("viewport-render"))},this.changeCurveState=()=>{const e=this.selected.textSettings.clone();this.changeCurve(),this.stage.history.add({type:"textSettings",kind:"curve",layer:this.selected,settings:e})},this.changeCurve=()=>{let e=this.curveAmount.getValue(),t=(0,i.ZP)("text-curve").checked,s=(0,i.ZP)("text-curve-flip").checked,a=(0,i.ZP)("text-curve-spread").checked,n=document.querySelector('input[name="curve-type"]:checked').value;(0,i.ZP)("text-curve-amount").style.display="arc"!==n?"none":"block",(0,i.ZP)("text-curve-flip-label").style.display="arc"!==n?"block":"none",(0,i.ZP)("text-curve-spread-label").style.display="arc"!==n?"block":"none",this.selected.setCurve(t,n,e,a,s),document.dispatchEvent(new CustomEvent("viewport-render"))},this.changeOutlineState=()=>{const e=this.selected.textSettings.clone();this.changeOutline(),this.stage.history.add({type:"textSettings",kind:"outline",layer:this.selected,settings:e})},this.changeOutline=()=>{let e=(0,i.ZP)("text-outline").checked,t=(0,i.ZP)("text-outline-punch").checked,s=this.outlineColor.getColor().toHEX(),a=this.outlineSize.getValue(),n=this.outlineDistance.getValue(),o=this.outlineDirection.getValue();this.selected.setOutline(e,a,s,t,n,o),document.dispatchEvent(new CustomEvent("viewport-render"))},this.changeOutlineColor=e=>{const t=this.selected.textSettings.clone();this.changeOutline(),this.stage.history.add({type:"textSettings",kind:"outline",layer:this.selected,settings:t})},this.changeShadowState=()=>{const e=this.selected.textSettings.clone();this.changeShadow(),this.stage.history.add({type:"textSettings",kind:"shadow",layer:this.selected,settings:e})},this.changeShadow=()=>{this.selected.setShadow((0,i.ZP)("text-shadow").checked,this.shadowBlur.getValue(),this.shadowAlpha.getValue(),this.shadowColor.getColor().toHEX(),this.shadowDistance.getValue(),this.shadowDirection.getValue()),document.dispatchEvent(new CustomEvent("viewport-render"))},this.changeShadowColor=e=>{const t=this.selected.textSettings.clone();this.changeShadow(),this.stage.history.add({type:"textSettings",kind:"shadow",layer:this.selected,settings:t})},this.cleanUp=()=>{this.selected=void 0,this.backgroundColor.cleanUp(),this.backgroundColor=void 0,this.outlineColor.cleanUp(),this.outlineColor=void 0,this.shadowColor.cleanUp(),this.shadowColor=void 0,this.curveAmount.cleanUp(),this.outlineSize.cleanUp(),this.outlineDistance.cleanUp(),this.outlineDirection.cleanUp(),this.shadowBlur.cleanUp(),this.shadowAlpha.cleanUp(),this.shadowDistance.cleanUp(),this.shadowDirection.cleanUp(),(0,i.ZP)("text-background").removeEventListener("change",this.changeBackground,!1),(0,i.ZP)("text-background-punch").removeEventListener("change",this.changeBackground,!1),(0,i.ZP)("text-background-type-full").removeEventListener("change",this.changeBackground,!1),(0,i.ZP)("text-background-type-line").removeEventListener("change",this.changeBackground,!1),(0,i.ZP)("text-background-type-word").removeEventListener("change",this.changeBackground,!1),(0,i.ZP)("text-outline").removeEventListener("change",this.changeOutlineState,!1),(0,i.ZP)("text-outline-punch").removeEventListener("change",this.changeOutlineState,!1),(0,i.ZP)("text-shadow").removeEventListener("change",this.changeShadowState,!1),(0,i.ZP)("text-curve-flip").removeEventListener("change",this.changeCurveState,!1),(0,i.ZP)("text-curve-spread").removeEventListener("change",this.changeCurveState,!1),(0,i.ZP)("text-curve-type-arc").removeEventListener("change",this.changeCurveState,!1),(0,i.ZP)("text-curve-type-circle").removeEventListener("change",this.changeCurveState,!1),(0,i.ZP)("text-curve-type-half").removeEventListener("change",this.changeCurveState,!1),this.superClean()},this.stage=e,this.selected=this.stage.fresco.getSelected(),this.content.id="text-style-content",this.content.style.height="333px",this.setContent(`\n            <section>\n                <div>\n                    <input type="checkbox" class="toggle-check" id="text-curve" />\n                    <label class="switch subline pad-4" for="text-curve">${(0,a.Z)("curve")}<span></span><span class="arrow"></span></label>\n                    <div class="toggle">\n                        <div id="text-curve-type" class="switch-field stretch pad-4">\n                            <input type="radio" id="text-curve-type-arc" name="curve-type" value="arc" checked/><label for="text-curve-type-arc">${(0,a.Z)("arc")}</label>\n                            <input type="radio" id="text-curve-type-circle" name="curve-type" value="circle" /><label for="text-curve-type-circle">${(0,a.Z)("circle")}</label>\n                            <input type="radio" id="text-curve-type-half" name="curve-type" value="half" /><label for="text-curve-type-half">${(0,a.Z)("half")}</label>\n                        </div>\n                        <div id="text-curve-amount" class="pad-16"></div>\n                        <input type="checkbox" id="text-curve-spread" />\n                        <label class="pad-16 switch" id="text-curve-spread-label" for="text-curve-spread">${(0,a.Z)("spread")}<span></span></label>\n                        <input type="checkbox" id="text-curve-flip" />\n                        <label class="pad-16 switch" id="text-curve-flip-label" for="text-curve-flip">${(0,a.Z)("flip")}<span></span></label>\n                    </div>\n                </div>\n                <div>\n                    <input type="checkbox" class="toggle-check" id="text-background" />\n                    <label class="switch subline pad-10" for="text-background">${(0,a.Z)("background")}<span></span><span class="arrow"></span></label>\n                    <div class="toggle">\n                        <label class="split">${(0,a.Z)("color")}<div id="text-background-color" class="pad-4"></div></label>\n                        <input type="checkbox" id="text-background-punch" />\n                        <label class="pad-10 switch" for="text-background-punch">${(0,a.Z)("punchout")}<span></span></label>\n                        <div id="text-background-offset" class="pad-10"></div>\n                        <div id="text-background-type" class="switch-field stretch pad-16">\n                            <input type="radio" id="text-background-type-full" name="background-type" value="full" checked/><label for="text-background-type-full">${(0,a.Z)("full")}</label>\n                            <input type="radio" id="text-background-type-line" name="background-type" value="line" /><label for="text-background-type-line">${(0,a.Z)("line")}</label>\n                            <input type="radio" id="text-background-type-word" name="background-type" value="word" /><label for="text-background-type-word">${(0,a.Z)("word")}</label>\n                        </div>\n                    </div>\n                </div>\n                <div>\n                    <input type="checkbox" class="toggle-check" id="text-outline" />\n                    <label class="switch subline pad-10" for="text-outline">${(0,a.Z)("outline")}<span></span><span class="arrow"></span></label>\n                    <div class="toggle">\n                        <label class="split">${(0,a.Z)("color")}<div id="text-outline-color" class="pad-4"></div></label>\n                        <input type="checkbox" id="text-outline-punch" />\n                        <label class="pad-10 switch" for="text-outline-punch">${(0,a.Z)("punchout")}<span></span></label>\n                        <div id="text-outline-size" class="pad-10"></div>\n                        <div id="text-outline-distance"></div>\n                        <div id="text-outline-direction"></div>\n                    </div>\n                </div>\n                <div>\n                <input type="checkbox" class="toggle-check" id="text-shadow" />\n                <label class="switch subline pad-10" for="text-shadow">${(0,a.Z)("shadow")}<span></span><span class="arrow"></span></label>\n                <div class="toggle">\n                        <label class="split">${(0,a.Z)("color")}<div id="text-shadow-color" class="pad-4"></div></label>\n                        <div id="text-shadow-blur" class="pad-10"></div>\n                        <div id="text-shadow-distance"></div>\n                        <div id="text-shadow-direction"></div>\n                        <div id="text-shadow-alpha"></div>\n                    </div>\n                </div>\n            <section>\n        `);let s=this.selected.textSettings;this.backgroundColor=new E.Z("text-background-color",c.Z.fromHEX(u.ZP.altColor),this.changeBackground),this.outlineColor=new E.Z("text-outline-color",c.Z.fromHEX(u.ZP.altColor),this.changeOutlineColor),this.shadowColor=new E.Z("text-shadow-color",c.Z.fromHEX(u.ZP.altColor),this.changeShadowColor);const n={onStart:()=>{s=this.selected.textSettings.clone()},labelFormat:e=>(100*e).toFixed(0),labelParse:e=>parseInt(e,10)/100};this.outlineSize=new l.Z("text-outline-size",Object.assign(Object.assign({},n),{label:(0,a.Z)("size"),range:[.01,1],defaultValue:.3,onChange:()=>this.changeOutline(),onEnd:()=>{this.stage.history.add({type:"textSettings",kind:"outline",layer:this.selected,settings:s})}})),this.outlineDistance=new l.Z("text-outline-distance",Object.assign(Object.assign({},n),{label:(0,a.Z)("distance"),range:[0,1],onChange:()=>this.changeOutline(),onEnd:()=>{this.stage.history.add({type:"textSettings",kind:"outline",layer:this.selected,settings:s})}})),this.outlineDirection=new l.Z("text-outline-direction",Object.assign(Object.assign({},n),{label:(0,a.Z)("direction"),range:[0,360],defaultValue:180,labelFormat:e=>e.toFixed(1),labelParse:e=>parseInt(e,10),onChange:()=>this.changeOutline(),onEnd:()=>{this.stage.history.add({type:"textSettings",kind:"outline",layer:this.selected,settings:s})}}));const o=Object.assign(Object.assign({},n),{range:[0,1],onChange:()=>this.changeShadow(),onEnd:()=>{this.stage.history.add({type:"textSettings",kind:"shadow",layer:this.selected,settings:s})}});this.backgroundOffset=new l.Z("text-background-offset",Object.assign(Object.assign({},n),{label:(0,a.Z)("offset"),range:[-1,1],onEnd:()=>{this.changeBackground()}})),this.shadowBlur=new l.Z("text-shadow-blur",Object.assign(Object.assign({},o),{label:(0,a.Z)("blur")})),this.shadowAlpha=new l.Z("text-shadow-alpha",Object.assign(Object.assign({},o),{label:(0,a.Z)("opacity"),defaultValue:1})),this.shadowDistance=new l.Z("text-shadow-distance",Object.assign(Object.assign({},o),{label:(0,a.Z)("distance"),range:[0,1]})),this.shadowDirection=new l.Z("text-shadow-direction",Object.assign(Object.assign({},o),{label:(0,a.Z)("direction"),range:[0,360],defaultValue:180,labelFormat:e=>e.toFixed(1),labelParse:e=>parseInt(e,10)})),this.curveAmount=new l.Z("text-curve-amount",{label:(0,a.Z)("amount"),step:.01,range:[-1,1],labelFormat:e=>`${Math.round(100*e)}`,labelParse:e=>parseInt(e,10)/100,onChange:()=>this.changeCurve(),onEnd:()=>{this.stage.history.add({type:"textSettings",kind:"curve",layer:this.selected,settings:s})}}),(0,i.ZP)("text-background").addEventListener("change",this.changeBackground,!1),(0,i.ZP)("text-background-punch").addEventListener("change",this.changeBackground,!1),(0,i.ZP)("text-background-type-full").addEventListener("change",this.changeBackground,!1),(0,i.ZP)("text-background-type-line").addEventListener("change",this.changeBackground,!1),(0,i.ZP)("text-background-type-word").addEventListener("change",this.changeBackground,!1),(0,i.ZP)("text-curve").addEventListener("change",this.changeCurveState,!1),(0,i.ZP)("text-curve-flip").addEventListener("change",this.changeCurveState,!1),(0,i.ZP)("text-curve-spread").addEventListener("change",this.changeCurveState,!1),(0,i.ZP)("text-curve-type-arc").addEventListener("change",this.changeCurveState,!1),(0,i.ZP)("text-curve-type-circle").addEventListener("change",this.changeCurveState,!1),(0,i.ZP)("text-curve-type-half").addEventListener("change",this.changeCurveState,!1),(0,i.ZP)("text-outline").addEventListener("change",this.changeOutlineState,!1),(0,i.ZP)("text-outline-punch").addEventListener("change",this.changeOutlineState,!1),(0,i.ZP)("text-shadow").addEventListener("change",this.changeShadowState,!1),this.updateInputs(),new v.Z(this.content)}}var T=s(1030);class C extends k.Z{constructor(e,t){super(t,(0,a.Z)("preset"),!0),this.SERVER_URL="/",this.populatePresets=async()=>{const e=await fetch("/text/index.json"),t=await e.json(),s=(0,i.ZP)("text-preset-content-ss-content");s.innerHTML="",t.presets.forEach((e=>{const t="/text/"+e.id+"/thumbnail.webp",a=(0,i.T)("div",{id:e.id,className:"text-box"});a.setAttribute("loading","lazy"),e.premium&&a.classList.add("premium"),a.addEventListener("click",this.selectPreset,!0),a.style.backgroundImage="url("+t+")",s.append(a)}))},this.selectPreset=async e=>{if(this.working)return;if(e.currentTarget.classList.contains("premium")&&!u.ZP.user.subscription)return this.cleanUp(),void new w.Z(this.stage,"FONT");this.working=!0;const t=e.currentTarget.getAttribute("id");await(0,f.d3)(this.stage,"/text/"+t+"/manifest.json"),this.working=!1,(0,T.Z)("text-preset",t)},this.cleanUp=()=>{this.superClean()},this.stage=e,this.float.style.height="70%",this.float.style.width="265px",this.content.id="text-preset-content",new v.Z(this.content),this.populatePresets()}}class L extends h.Z{constructor(e){let t;super("text",e),this.showTextFormat=()=>{new P(this.stage,(0,i.ZP)("text-format"))},this.showTextStyles=()=>{new S(this.stage,(0,i.ZP)("text-styles"))},this.showTextPresets=()=>{new C(this.stage,(0,i.ZP)("text-presets"))},this.layerSelect=()=>{if(this.stage.fresco.getSelected()!==this.selected&&this.stage.history.commitTransaction(),!this.stage.fresco.isSelectedType(d.Z.TYPE_TEXT))return(0,i.ZP)("text-settings").style.display="none",(0,i.ZP)("text-no-layer").style.display="flex",void(this.selected=void 0);(0,i.ZP)("text-settings").style.display="flex",(0,i.ZP)("text-no-layer").style.display="none",this.selected=this.stage.fresco.getSelected(),this.fill.setFill(this.selected.fill),this.font.setFont(this.selected.textSettings.font),this.textSize.setValue(this.selected.textSettings.size)},this.layerArrange=()=>{this.selected&&this.textSize.setValue(this.selected.textSettings.size)},this.changeSize=e=>{this.selected.textSettings.size=e,n.Ds("text-change",50,(()=>{this.selected.setTextSize(e),document.dispatchEvent(new CustomEvent("viewport-render"))}))},this.previewFill=e=>{this.selected.setTextFill(e,!0),document.dispatchEvent(new CustomEvent("viewport-render"))},this.changeFill=e=>{const t=this.selected.textSettings.clone();this.selected.setTextFill(e),this.stage.history.add({type:"textSettings",kind:"fill",layer:this.selected,settings:t}),document.dispatchEvent(new CustomEvent("viewport-render"))},this.previewFont=e=>{this.selected&&(this.selected.setTextFont(e,!0),document.dispatchEvent(new CustomEvent("viewport-render")))},this.changeFont=(e,t)=>{if(!this.selected)return;const s=this.selected.textSettings.clone();s.font=t,this.selected.setTextFont(e),this.stage.history.add({type:"textSettings",kind:"font",layer:this.selected,settings:s}),document.dispatchEvent(new CustomEvent("viewport-render"))},this.reformDown=(e,t)=>{this.downPoint=e,this.usedtobe=t,this.stage.coating.freeze(!0),this.addMoveListeners()},this.move=e=>{const t=this.stage.translateToRect(this.downPoint,e,!1,!0);t.width>0&&t.height>0&&this.drawframe(t.topLeft(),t.bottomRight()),document.dispatchEvent(new CustomEvent("legend",{detail:"W: "+Math.round(t.width/this.stage.zoom)+"  H: "+Math.round(t.height/this.stage.zoom)}))},this.drawframe=(e,t)=>{const s=this.stage.coating.ctx;s.lineWidth=2,s.strokeStyle=n.xZ,s.clearRect(0,0,s.canvas.width,s.canvas.height),s.strokeRect(e.x,e.y,t.x-e.x,t.y-e.y)},this.up=async e=>{if(this.stage.coating.clear(!0),this.stage.coating.freeze(!1),this.removeMoveListeners(),document.dispatchEvent(new CustomEvent("legend",{detail:"stop"})),this.downPoint.distanceTo(e)>10){const t=this.stage.translateToRect(this.downPoint,e,!1,!1);t.height=Math.round(t.height/2),t.height<20&&(t.height=20),this.addText(t)}else this.usedtobe||await new Z.Z((0,a.Z)("addText"),(0,a.Z)("doYouWantToAddANewTextLayer"),(0,a.Z)("add")).init()&&this.addTextEvent()},this.addTextEvent=()=>{let e=this.stage.getViewPort();this.addText(new r.Z(Math.round(e.x+(e.width-Math.round(e.width/1.2))/2),Math.round(e.y+e.height/2.5),Math.round(e.width/1.2),this.textSize.getValue()))},this.addText=async e=>{let t=new x.Z(this.font.selected,e.height);await this.font.loadFont(this.font.selected),t.fillType=this.fill.getFill().getType(),t.fillValue=this.fill.getFill().getStringValue(),await this.stage.addText((0,a.Z)("loremIpsum"),e,t,"add"),this.editMode()},this.editMode=()=>{this.reform.dblClick()},this.deleteLayer=()=>{this.stage.deleteLayer()},this.duplicateLayer=()=>{this.stage.duplicateLayer()},this.cleanUp=()=>{this.stage.history.commitTransaction(),this.reform.cleanUp(),this.reform=void 0,this.stage.coating.wake(),this.font.cleanUp(),this.font=null,this.fill.cleanUp(),this.fill=null,this.textSize.cleanUp(),(0,i.ZP)("text-edit").removeEventListener("click",this.editMode,!0),(0,i.ZP)("add-text-button").removeEventListener("click",this.addTextEvent,!0),(0,i.ZP)("text-format").removeEventListener("click",this.showTextFormat,!1),(0,i.ZP)("text-styles").removeEventListener("click",this.showTextStyles,!1),(0,i.ZP)("text-presets").removeEventListener("click",this.showTextPresets,!1),(0,i.ZP)("text-add").removeEventListener("click",this.addTextEvent,!1),(0,i.ZP)("text-delete").removeEventListener("click",this.deleteLayer,!1),(0,i.ZP)("text-duplicate").removeEventListener("click",this.duplicateLayer,!1),document.removeEventListener("add-text",this.addTextEvent,!1),document.removeEventListener("layer-select",this.layerSelect,!1),document.removeEventListener("layer-arrange",this.layerArrange,!1)},this.stage=e,this.stage.coating.sleep(),this.fill=new p.Z("text-fill",new o.Z(c.Z.fromHEX(u.ZP.mainColor)),this.changeFill,this.previewFill),this.font=new b(this.stage,(0,i.ZP)("text-font-picker"),this.changeFont,this.previewFont),(0,i.ZP)("add-text-button").addEventListener("click",this.addTextEvent,!0),(0,i.ZP)("text-edit").addEventListener("click",this.editMode,!0),this.textSize=new l.Z("text-size",{compact:!0,label:(0,a.Z)("size")+":",range:[4,100,1e3],defaultValue:60,step:[2,5],stops:[0,.4,1],labelFormat:e=>e.toString(),labelParse:e=>parseInt(e),onStart:()=>{t=this.selected.textSettings.clone()},onEnd:()=>{this.stage.history.add({type:"textSettings",kind:"size",layer:this.selected,settings:t})},onChange:this.changeSize}),(0,i.ZP)("text-add").addEventListener("click",this.addTextEvent,!1),(0,i.ZP)("text-delete").addEventListener("click",this.deleteLayer,!1),(0,i.ZP)("text-duplicate").addEventListener("click",this.duplicateLayer,!1),(0,i.ZP)("text-format").addEventListener("click",this.showTextFormat,!1),(0,i.ZP)("text-styles").addEventListener("click",this.showTextStyles,!1),(0,i.ZP)("text-presets").addEventListener("click",this.showTextPresets,!1),document.addEventListener("add-text",this.addTextEvent,!1),document.addEventListener("layer-select",this.layerSelect,!1),document.addEventListener("layer-arrange",this.layerArrange,!1),this.reform=new g.Z(e,"TEXT"),this.reform.proxy=this.reformDown,this.layerSelect()}}},3200:(e,t,s)=>{s.d(t,{Z:()=>d});var i=s(3947),a=s(6548),n=s(3655),o=s(8203),r=s(4188),h=s(2257),l=s(972),c=s(1126);class d extends o.Z{constructor(e){super("toning",e),this.mode="lighten",this.range="midtone",this.layerSelect=()=>{if(!this.stage.fresco.isSelectedImageWithCanvas())return(0,i.ZP)("toning-no-layer").style.display="flex",(0,i.ZP)("toning-settings").style.display="none",this.selected=null,void this.updateBrush();(0,i.ZP)("toning-settings").style.display="flex",(0,i.ZP)("toning-no-layer").style.display="none",this.selected=this.stage.fresco.getSelected(),this.scratch=this.stage.fresco.addScratch(),this.scratch.setTarget(this.selected.id,this.selected.rect,"over"),this.stage.fresco.hasSelection()&&this.scratch.addBake(),this.updateBrush()},this.toggleMode=()=>{this.setMode("lighten"===this.mode?"darken":"lighten")},this.selectMode=e=>{this.setMode(e.currentTarget===(0,i.ZP)("toning-mode-lighten")?"lighten":"darken")},this.setMode=e=>{this.mode=e,(0,i.ZP)("toning-mode-lighten").checked="lighten"===this.mode,(0,i.ZP)("toning-mode-darken").checked="darken"===this.mode},this.isShiftDown=!1,this.keyDown=e=>{if("Shift"===e.key&&!this.isShiftDown)return this.isShiftDown=!0,void this.toggleMode();switch(e.key){case",":e.shiftKey?this.brushPod.stepSoftness(.1):this.brushPod.stepSize(-10);break;case".":e.shiftKey?this.brushPod.stepSoftness(-.1):this.brushPod.stepSize(10)}},this.keyUp=e=>{"Shift"===e.key&&(this.isShiftDown=!1,this.toggleMode())},this.updateBrush=()=>{this.selected?this.stage.coating.setCursorImage(this.brush.getCursorImage(this.stage.zoom)):this.stage.coating.removeCursorImage()},this.down=(e,t)=>{this.selected&&(this.stage.coating.freeze(!0),this.range=document.querySelector('input[name="toning-range"]:checked').value,this.isShiftDown||(this.x=this.y=-1),"touch"!==t&&this.move(e),this.addMoveListeners())},this.x=-1,this.y=-1,this.move=e=>{let t=2*this.brush.getStep(),s=!1;if(e=this.stage.translateRasterToFresco(e,this.selected.rect),-1===this.x&&(this.lx=e.x,this.ly=e.y,this.x=e.x,this.y=e.y,this.drawShape(this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),s=!0),e.x!==this.x||e.y!==this.y){let i=e.x-this.x,a=e.y-this.y,n=i>0?1:-1,o=a>0?1:-1;if(i=i<0?-i:i,a=a<0?-a:a,i>a){let e=.5*i;for(let r=1;r<=i;r++)this.x+=n,e+=a,e>=i&&(e-=i,this.y+=o),(this.x>this.lx+t||this.x<this.lx-t||this.y>this.ly+t||this.y<this.ly-t)&&(this.lx=this.x,this.ly=this.y,this.drawShape(this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),s=!0)}else{let e=.5*a;for(let r=1;r<=a;r++)this.y+=o,e+=i,e>=a&&(e-=a,this.x+=n),(this.x>this.lx+t||this.x<this.lx-t||this.y>this.ly+t||this.y<this.ly-t)&&(this.lx=this.x,this.ly=this.y,this.drawShape(this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),s=!0)}}s&&(this.scratch.applySelection(this.stage),window.requestAnimationFrame((()=>this.stage.render())))},this.drawShape=(e,t)=>{let s=this.strength.getValue(),i=this.getPatchContext(this.brush.canvas.width,this.brush.canvas.height);i.save(),i.drawImage(this.selected.canvas,-e,-t),"lighten"===this.mode?this.lighten(i,this.range,s):this.darken(i,this.range,s),i.globalCompositeOperation="destination-in",i.drawImage(this.brush.canvas,0,0),i.restore(),this.scratch.ctx.drawImage(this.patch,e,t)},this.getPatchContext=(e,t)=>this.patch?(this.patch.width!==e||this.patch.height!==t?(this.patch.width=e,this.patch.height=t):this.ptx.clearRect(0,0,e,t),this.ptx):(this.patch=n.vL(e,t),this.ptx=this.patch.getContext("2d"),this.ptx),this.up=e=>{this.stage.coating.freeze(!1),this.removeMoveListeners();let t=n.l(this.scratch.getCanvas());if(t&&t.width>0&&t.height>0){let e=n.$E(this.selected.canvas,t);const s=this.selected.rect.clone();this.scratch.drawToLayer(this.selected),this.scratch.clear(),this.selected.render(),this.stage.history.add({type:"bitmapChange",kind:"toning",layer:this.selected,patchRect:t,patch:e,rect:s})}window.requestAnimationFrame((()=>this.stage.render()))},this.lighten=(e,t,s)=>{var i=e.canvas.width,a=e.canvas.height;s/=100;for(var n,o,r,h,l,c,d=e.getImageData(0,0,i,a),u=d.data,p=a;p--;)for(n=i;n--;){switch(o=u[l=4*(p*i+n)]/255,r=u[l+1]/255,h=u[l+2]/255,t){case"highlight":o+=s*(Math.exp(o)-1),r+=s*(Math.exp(r)-1),h+=s*(Math.exp(h)-1);break;case"midtone":o+=(c=.25*s)*Math.sin(o*Math.PI),r+=c*Math.sin(r*Math.PI),h+=c*Math.sin(h*Math.PI);break;case"shadow":o=(c=1-.5*s)*o+(1-c),r=c*r+(1-c),h=c*h+(1-c)}(o*=255)>255&&(o=255),(r*=255)>255&&(r=255),(h*=255)>255&&(h=255),u[l]=o,u[l+1]=r,u[l+2]=h}e.putImageData(d,0,0)},this.darken=(e,t,s)=>{var i=e.canvas.width,a=e.canvas.height;s/=100;for(var n,o,r,h,l,c,d=e.getImageData(0,0,i,a),u=d.data,p=a;p--;)for(n=i;n--;){switch(o=u[l=4*(p*i+n)]/255,r=u[l+1]/255,h=u[l+2]/255,t){case"highlight":o*=c=1-.75*s,r*=c,h*=c;break;case"midtone":o-=(c=.25*s)*Math.sin(o*Math.PI),r-=c*Math.sin(r*Math.PI),h-=c*Math.sin(h*Math.PI);break;case"shadow":o+=s*(1-Math.exp(1-o)),r+=s*(1-Math.exp(1-r)),h+=s*(1-Math.exp(1-h))}(o*=255)<0&&(o=0),(r*=255)<0&&(r=0),(h*=255)<0&&(h=0),u[l]=o,u[l+1]=r,u[l+2]=h}e.putImageData(d,0,0)},this.cleanUp=()=>{var e;null===(e=this.stage.fresco)||void 0===e||e.removeScratch(),this.brushPod.cleanUp(),this.strength.cleanUp(),this.stage.coating.freeze(!1),this.removeMoveListeners(),this.removeDownListeners(),document.removeEventListener("zoom-change",this.updateBrush,!1),document.removeEventListener("layer-select",this.layerSelect,!1),document.removeEventListener("keydown",this.keyDown,!1),document.removeEventListener("keyup",this.keyUp,!1),(0,i.ZP)("toning-mode-lighten").removeEventListener("click",this.selectMode,!1),(0,i.ZP)("toning-mode-darken").removeEventListener("click",this.selectMode,!1),this.selected=null,this.patch=null,this.ptx=null},document.addEventListener("keydown",this.keyDown,!1),document.addEventListener("keyup",this.keyUp,!1),(0,i.ZP)("toning-mode-lighten").addEventListener("click",this.selectMode,!1),(0,i.ZP)("toning-mode-darken").addEventListener("click",this.selectMode,!1),document.addEventListener("layer-select",this.layerSelect,!1),document.addEventListener("zoom-change",this.updateBrush,!1),this.brush=new h.Z(new l.Z),this.brushPod=new c.Z(e,"toning-brush",this.brush,this.updateBrush),this.strength=new r.Z("toning-brush-strength",{compact:!0,label:(0,a.Z)("strength")+":",range:[1,100],defaultValue:30,step:1});const t=document.querySelector('input[name="toning-mode"]:checked').value;this.setMode(t),this.addDownListeners(),this.layerSelect()}}},3921:(e,t,s)=>{s.d(t,{Z:()=>d});var i=s(3947),a=s(6548),n=s(3655),o=s(3347),r=s(6817),h=s(4188),l=s(8776),c=s(887);class d extends c.Z{constructor(e){super("wand",e),this.selectMode=()=>{this.mode=document.querySelector('input[name="wand-mode"]:checked').value},this.keyDown=e=>{"Shift"!==e.key||this.isShiftDown||(this.isShiftDown=!0,this.isDown||((0,i.ZP)("wand-mode-add").checked=!0,this.selectMode())),"Control"!==e.key||this.isCtrlDown||(this.isCtrlDown=!0,this.isDown||((0,i.ZP)("wand-mode-remove").checked=!0,this.selectMode()))},this.keyUp=e=>{"Shift"===e.key&&this.isShiftDown&&(this.isShiftDown=!1,this.isCtrlDown||this.isDown||((0,i.ZP)("wand-mode-new").checked=!0,this.selectMode())),"Control"===e.key&&this.isCtrlDown&&(this.isCtrlDown=!1,this.isDown||((0,i.ZP)("wand-mode-new").checked=!0,this.selectMode()))},this.layerSelect=()=>{this.scratch=this.stage.fresco.addScratch(),this.flat=this.stage.getOutputCanvas(),this.canvas=this.stage.getSingleLayerOutputCanvas()},this.down=e=>{let t=!this.canvas||(0,i.ZP)("wand-sample-all").checked;e=this.stage.translateRasterToFresco(e),"new"===this.mode&&this.stage.fresco.selection&&this.stage.fresco.selection.clear();let s=this.tolerance.getValue();if(t)this.canvasData=new Uint8Array(this.flat.getContext("2d").getImageData(0,0,this.flat.width,this.flat.height).data.buffer),this.scratch.setTarget("flat",new r.Z(0,0,this.flat.width,this.flat.height),"none");else{if(!this.canvas)return;this.canvasData=new Uint8Array(this.canvas.getContext("2d").getImageData(0,0,this.canvas.width,this.canvas.height).data.buffer),this.scratch.setTarget("flat",new r.Z(0,0,this.canvas.width,this.canvas.height),"none")}if(this.setHistory(),e.x<0||e.y<0||e.x>this.scratch.canvas.width||e.y>this.scratch.canvas.height)return void(this.stage.fresco.hasSelection()&&(this.stage.fresco.selection.reset(),this.addHistory("deselect")));let a=4*(e.y*(t?this.flat.width:this.canvas.width)+e.x),o=new l.Z(this.canvasData[a],this.canvasData[a+1],this.canvasData[a+2],this.canvasData[a+3]),h=this.scratch.ctx.getImageData(0,0,this.scratch.canvas.width,this.scratch.canvas.height);this.scratchData=new Uint8Array(h.data.buffer),(0,i.ZP)("wand-contiguous").checked?this.floodFill(e,o,s,(0,i.ZP)("wand-anti-alias").checked):this.allFill(o,s,(0,i.ZP)("wand-anti-alias").checked),this.scratch.ctx.putImageData(h,0,0);let c=n.l(this.scratch.canvas);c&&c.width>0&&c.height>0&&(this.stage.fresco.addSelection(),this.stage.fresco.selection.drawOnMask(this.scratch.canvas,this.feather.getValue(),!1,"remove"===this.mode),window.requestAnimationFrame((()=>{this.stage.coating.render()}))),this.isDown=!1,this.addHistory()},this.allFill=(e,t,s)=>{var i,a;let n,o,r,h,l,c,d;for(var u=0,p=this.scratch.canvas.height;u<p;++u)for(var g=0,m=this.scratch.canvas.width;g<m;++g)a=4*(u*m+g),h=e.a-this.canvasData[a+3],o=h<0?-h:h,e.a>0&&(l=e.r-this.canvasData[a],n=l<0?-l:l,n>o&&(o=n),c=e.g-this.canvasData[a+1],n=c<0?-c:c,n>o&&(o=n),d=e.b-this.canvasData[a+2],n=d<0?-d:d,n>o&&(o=n)),s&&t>0?(r=1.5-o/t,i=r<=0?0:r<.5?Math.round(512*r):255):i=o>t?0:255,i>64&&(i>128&&(i=255),this.scratchData[a+3]=i)},this.floodFill=(e,t,s,i)=>{let a=this.scratch.canvas.width,n=this.scratch.canvas.height,o=new Array,r=new Array(a*n);for(this.linearFill(e.x,e.y,t,s,i,o,r);o.length>0;)for(var h=o.shift(),l=h.start;l<=h.stop;++l)h.row>0&&!r[(h.row-1)*a+l]&&this.linearFill(l,h.row-1,t,s,i,o,r),h.row<n-1&&!r[(h.row+1)*a+l]&&this.linearFill(l,h.row+1,t,s,i,o,r)},this.linearFill=(e,t,s,i,a,n,r)=>{var h=this.scratch.canvas.width;r[h*t+e]=!0;let l=4*(h*t+e),c=this.tolerate(l,s,i,a);if(c>5&&(this.scratchData[l+3]=c>160?255:c),c>64){for(var d=e-1,u=e+1;d>=0&&!r[h*t+d]&&c>64;)r[h*t+d]=!0,l=4*(h*t+d),c=this.tolerate(l,s,i,a),c>5&&(this.scratchData[l+3]=c>160?255:c),--d;for(c=255;u<h&&!r[h*t+u]&&c>64;)r[h*t+u]=!0,l=4*(h*t+u),c=this.tolerate(l,s,i,a),c>5&&(this.scratchData[l+3]=c>160?255:c),++u;n.push(new o.Z(d+1,u-1,t))}},this.tolerate=(e,t,s,i=!1)=>{let a,n,o,r,h,l,c;return r=t.a-this.canvasData[e+3],n=r<0?-r:r,t.a>0&&(h=t.r-this.canvasData[e],a=h<0?-h:h,a>n&&(n=a),l=t.g-this.canvasData[e+1],a=l<0?-l:l,a>n&&(n=a),c=t.b-this.canvasData[e+2],a=c<0?-c:c,a>n&&(n=a)),i&&s>0?(o=1.5-n/s,o<=0?0:o<.5?Math.round(512*o):255):n>s?0:255},this.cleanUp=()=>{var e,t;this.superClean(),this.stage.fresco&&this.stage.fresco.selection&&0===(null===(e=this.stage.fresco.selection.outline)||void 0===e?void 0:e.length)&&this.stage.fresco.removeSelection(),null===(t=this.stage.fresco)||void 0===t||t.removeScratch(),this.canvas=void 0,this.flat=void 0,this.feather.cleanUp(),this.tolerance.cleanUp(),document.removeEventListener("layer-select",this.layerSelect,!1),document.removeEventListener("keydown",this.keyDown,!1),document.removeEventListener("keyup",this.keyUp,!1),(0,i.ZP)("wand-mode-new").removeEventListener("change",this.selectMode,!1),(0,i.ZP)("wand-mode-add").removeEventListener("change",this.selectMode,!1),(0,i.ZP)("wand-mode-remove").removeEventListener("change",this.selectMode,!1)},document.addEventListener("layer-select",this.layerSelect,!1),document.addEventListener("keydown",this.keyDown,!1),document.addEventListener("keyup",this.keyUp,!1),this.tolerance=new h.Z("wand-tolerance",{compact:!0,label:(0,a.Z)("tolerance")+":",defaultValue:32,range:[0,255],step:1}),this.feather=new h.Z("wand-feather",{compact:!0,defaultValue:0,label:(0,a.Z)("feather")+":",labelFormat:e=>(100*e).toFixed(0),labelParse:e=>parseInt(e,10)/100}),(0,i.ZP)("wand-mode-new").addEventListener("change",this.selectMode,!1),(0,i.ZP)("wand-mode-add").addEventListener("change",this.selectMode,!1),(0,i.ZP)("wand-mode-remove").addEventListener("change",this.selectMode,!1),this.selectMode(),this.layerSelect()}}},4332:(e,t,s)=>{s.d(t,{Z:()=>h});var i=s(3947),a=s(6548),n=s(8203),o=s(3673),r=s(9924);class h extends n.Z{constructor(e){super("zoom",e),this.stage=e,this.mode="plus",this.contextMenu=e=>{e.preventDefault(),e.stopPropagation(),new r.C(new o.Z(e.clientX,e.clientY),[new r.Z((0,a.Z)("titleFitScreen"),(()=>this.stage.setZoom("fit")),"Ctrl + 0"),new r.Z((0,a.Z)("titleFillScreen"),(()=>this.stage.setZoom("fill")),"Ctrl + 2"),new r.Z("100%",(()=>this.stage.setZoom("1")),"Ctrl + 1"),new r.Z("200%",(()=>this.stage.setZoom("2"))),new r.Z("300%",(()=>this.stage.setZoom("3")),"Ctrl + 3"),new r.Z,new r.Z((0,a.Z)("titleZoomIn"),(()=>this.stage.setZoomStep(!0)),"Ctrl + +"),new r.Z((0,a.Z)("titleZoomOut"),(()=>this.stage.setZoomStep(!1)),"Ctrl + -")])},this.z1x=()=>{this.stage.setZoom("1")},this.fit=()=>{this.stage.setZoom("fit")},this.fill=()=>{this.stage.setZoom("fill")},this.toggleMode=()=>{this.setMode("plus"===this.mode?"minus":"plus")},this.selectMode=e=>{this.setMode(e.currentTarget===(0,i.ZP)("zoom-mode-plus")?"plus":"minus")},this.setMode=e=>{this.mode=e,(0,i.ZP)("zoom-mode-plus").checked="plus"===this.mode,(0,i.ZP)("zoom-mode-minus").checked="minus"===this.mode,this.stage.raster.style.cursor="plus"===this.mode?"zoom-in":"zoom-out"},this.shiftDown=e=>{"Shift"!==e.key||this.isShiftDown||(this.isShiftDown=!0,this.toggleMode())},this.shiftUp=e=>{"Shift"===e.key&&(this.isShiftDown=!1,this.toggleMode())},this.down=e=>{this.stage.supressRender=!0;const t=this.stage.getViewPortCenter(),s=this.stage.translateRasterToFresco(e,void 0,!1);this.stage.setZoomStep("plus"===this.mode,2);const i=this.stage.translateRasterToFresco(e,void 0,!1);this.stage.supressRender=!1,this.stage.setAnchor(new o.Z(t.x+(s.x-i.x),t.y+(s.y-i.y))),this.stage.updateViewport()},this.cleanUp=()=>{this.removeDownListeners(),document.removeEventListener("keydown",this.shiftDown,!1),document.removeEventListener("keyup",this.shiftUp,!1),(0,i.ZP)("zoom-1x").removeEventListener("click",this.z1x,!1),(0,i.ZP)("zoom-fit").removeEventListener("click",this.fit,!1),(0,i.ZP)("zoom-fill").removeEventListener("click",this.fill,!1),(0,i.ZP)("zoom-mode-plus").removeEventListener("click",this.selectMode,!1),(0,i.ZP)("zoom-mode-minus").removeEventListener("click",this.selectMode,!1),this.stage.raster.removeEventListener("contextmenu",this.contextMenu,!0)},document.addEventListener("keydown",this.shiftDown,!1),document.addEventListener("keyup",this.shiftUp,!1),(0,i.ZP)("zoom-1x").addEventListener("click",this.z1x,!1),(0,i.ZP)("zoom-fit").addEventListener("click",this.fit,!1),(0,i.ZP)("zoom-fill").addEventListener("click",this.fill,!1),this.stage.raster.addEventListener("contextmenu",this.contextMenu,!0),(0,i.ZP)("zoom-mode-plus").addEventListener("click",this.selectMode,!1),(0,i.ZP)("zoom-mode-minus").addEventListener("click",this.selectMode,!1);const t=document.querySelector('input[name="zoom-mode"]:checked').value;this.setMode(t),this.addDownListeners()}}},6822:(e,t,s)=>{s.d(t,{Z:()=>b});var i=s(6548),a=s(3947),n=s(8829),o=s(1030),r=s(3673),h=s(4820),l=s(3655),c=s(4178),d=s(7339),u=s(1750);class p{constructor(e,t,s=1,i=0,a=0,n=!1,o=u.Z.EASE_LINEAR,r=p.DIRECTION_FORWARD,h="center",l="all"){this.method=e,this.value=t,this.iterations=s,this.duration=i,this.delay=a,this.fill=n,this.easing=o,this.direction=r,this.manner=h,this.filter=l}}p.INFINITE=0,p.DIRECTION_FORWARD=1,p.DIRECTION_REVERSE=2,p.DIRECTION_ALTERNATE=3,p.DIRECTION_ALTERNATE_REVERSE=4;var g=s(7318),m=s(3990);class v{static getOption(e,t,s){return void 0===e||void 0===e[t]?s:e[t]}static flipOption(e){switch(e){case"up":return"down";case"down":return"up";case"left":return"right";case"right":return"left"}return e}static getLayerAnimation(e,t){switch(e){case"fade-in":return{enter:new m.Z(e,[new p("opacity",{from:0},1,750,0,!0,u.Z.EASE_LINEAR)])};case"grow-in":{const s=v.getOption(t,"anchor","center");return{enter:new m.Z(e,[new p("opacity",{from:0},1,1e3,0,!0,u.Z.EASE_LINEAR),new p("scale",{from:.5},1,1e3,0,!0,u.Z.EASE_LINEAR,p.DIRECTION_FORWARD,s)],{anchor:s})}}case"shrink-in":{const s=v.getOption(t,"anchor","center");return{enter:new m.Z(e,[new p("opacity",{from:0},1,1e3,0,!0,u.Z.EASE_LINEAR),new p("scale",{from:1.2},1,1e3,0,!0,u.Z.EASE_LINEAR,p.DIRECTION_FORWARD,s)],{anchor:s})}}case"rise-in":return{enter:new m.Z(e,[new p("opacity",{from:0},1,750,0,!0,u.Z.EASE_LINEAR),new p("offset-y",{from:.2},1,750,0,!0,u.Z.EASE_OUT_CIRC)])};case"sink-in":return{enter:new m.Z(e,[new p("opacity",{from:0},1,750,0,!0,u.Z.EASE_LINEAR),new p("offset-y",{from:-.2},1,750,0,!0,u.Z.EASE_OUT_CIRC)])};case"vertical-in":return{enter:new m.Z(e,[new p("scale-height",{from:0},1,500,0,!0,u.Z.EASE_OUT_BACK)])};case"horizontal-in":return{enter:new m.Z(e,[new p("scale-width",{from:0},1,500,0,!0,u.Z.EASE_OUT_BACK)])};case"flicker-in":return{enter:new m.Z(e,[new p("opacity",{from:0},1,50,0,!0),new p("opacity",{to:0},1,100,100),new p("opacity",{to:1},1,50,200),new p("opacity",{to:0},1,100,300),new p("opacity",{to:1},1,50,400),new p("opacity",{to:0},1,100,600),new p("opacity",{to:1},1,50,800)])};case"tumble-in":{let s,i=v.getOption(t,"fourway","left");switch(i){case"right":s=new p("offset-x",{from:-1},1,400,0,!0,u.Z.EASE_LINEAR);break;case"left":s=new p("offset-x",{from:2},1,400,0,!0,u.Z.EASE_LINEAR);break;case"up":s=new p("offset-y",{from:2},1,400,0,!0,u.Z.EASE_LINEAR);break;case"down":s=new p("offset-y",{from:-1},1,400,0,!0,u.Z.EASE_LINEAR)}return{enter:new m.Z(e,[new p("rotate",{from:.2},1,380,0,!0,u.Z.EASE_LINEAR),s,new p("rotate",{to:.01},2,300,380,!1,u.Z.EASE_OUT_BACK,p.DIRECTION_ALTERNATE)],{fourway:i})}}case"8-bit-in":{let s=v.getOption(t,"eightway","upleft");const i={enter:new m.Z(e,[new p("rotate",{from:.1,to:-.1},1,500,0,!0,u.Z.EASE_FIVE_LADDER),new p("rotate",{from:-.1,to:.1},1,500,500,!1,u.Z.EASE_FIVE_LADDER),new p("rotate",{set:0},1,0,1e3,!1)],{eightway:s})};switch(s){case"up":i.enter.motions.push(new p("offset-y",{from:.5},1,1e3,0,!0,u.Z.EASE_FIVE_LADDER));break;case"down":i.enter.motions.push(new p("offset-y",{from:-.5},1,1e3,0,!0,u.Z.EASE_FIVE_LADDER));break;case"left":i.enter.motions.push(new p("offset-x",{from:.5},1,1e3,0,!0,u.Z.EASE_FIVE_LADDER));break;case"right":i.enter.motions.push(new p("offset-x",{from:-.5},1,1e3,0,!0,u.Z.EASE_FIVE_LADDER));break;case"upleft":i.enter.motions.push(new p("offset-y",{from:.5},1,1e3,0,!0,u.Z.EASE_FIVE_LADDER),new p("offset-x",{from:.4},1,1e3,0,!0,u.Z.EASE_FIVE_LADDER));break;case"upright":i.enter.motions.push(new p("offset-y",{from:.5},1,1e3,0,!0,u.Z.EASE_FIVE_LADDER),new p("offset-x",{from:-.4},1,1e3,0,!0,u.Z.EASE_FIVE_LADDER));break;case"downleft":i.enter.motions.push(new p("offset-y",{from:-.5},1,1e3,0,!0,u.Z.EASE_FIVE_LADDER),new p("offset-x",{from:.4},1,1e3,0,!0,u.Z.EASE_FIVE_LADDER));break;case"downright":i.enter.motions.push(new p("offset-y",{from:-.5},1,1e3,0,!0,u.Z.EASE_FIVE_LADDER),new p("offset-x",{from:-.4},1,1e3,0,!0,u.Z.EASE_FIVE_LADDER))}return i}case"whoa-in":return{enter:new m.Z(e,[new p("scale",{from:.5},1,500,0,!0,u.Z.EASE_LINEAR),new p("opacity",{from:0},1,750,0,!0,u.Z.EASE_LINEAR),new p("rotate",{to:-.075},2,750,0,!0,u.Z.EASE_OUT_BACK,p.DIRECTION_ALTERNATE)])};case"drop-in":return{enter:new m.Z(e,[new p("offset-y",{from:-1,to:0},1,750,0,!0,u.Z.EASE_OUT_BOUNCE)])};case"action-in":{let s=v.getOption(t,"twoway","right");return{enter:new m.Z(e,[new p("offset-x","right"===s?{from:-1,to:-.2}:{from:1,to:.2},1,350,0,!0,u.Z.EASE_LINEAR),new p("offset-x",{to:0},1,2e3,350,!1,u.Z.EASE_LINEAR)],{twoway:s})}}case"pop-in":return{enter:new m.Z(e,[new p("opacity",{from:0},1,300,0,!0,u.Z.EASE_LINEAR),new p("scale",{from:0},1,750,0,!0,u.Z.EASE_OUT_ELASTIC)])};case"stomp-in":return{enter:new m.Z(e,[new p("opacity",{from:0},1,300,0,!0,u.Z.EASE_LINEAR),new p("scale",{from:4},1,800,0,!0,u.Z.EASE_OUT_BOUNCE)])};case"spring-in":return{enter:new m.Z(e,[new p("self-x",{set:-1},0,1,0,!0,u.Z.EASE_LINEAR),new p("scale-width",{to:2},1,300,0,!1,u.Z.EASE_LINEAR,p.DIRECTION_FORWARD,"left"),new p("self-x",{set:0},0,1,300,!1,u.Z.EASE_LINEAR),new p("scale-width",{to:1},1,200,300,!1,u.Z.EASE_IN_OUT_ELASTIC,p.DIRECTION_FORWARD,"right")])};case"backdown-in":return{enter:new m.Z(e,[new p("scale",{set:.6},1,1,0,!0),new p("offset-y",{from:-1},1,500,0,!0,u.Z.EASE_OUT_CUBIC),new p("scale",{to:1},1,200,400,!1,u.Z.EASE_OUT_BACK)])};case"backup-in":return{enter:new m.Z(e,[new p("scale",{set:.6},1,1,0,!0),new p("offset-y",{from:2},1,500,0,!0,u.Z.EASE_OUT_CUBIC),new p("scale",{to:1},1,200,400,!1,u.Z.EASE_OUT_BACK)])};case"pixelate-in":return{enter:new m.Z(e,[new p("pixelate",{from:1,to:0},1,1500,0,!0,u.Z.EASE_IN_CIRC)])};case"mosaic-in":return{enter:new m.Z(e,[new p("mosaic",{from:1,to:0},1,1500,0,!0,u.Z.EASE_IN_CIRC)])};case"fringe-in":return{enter:new m.Z(e,[new p("opacity",{from:0,to:1},1,500,0,!0,u.Z.EASE_LINEAR),new p("fringe",{from:1,to:0},1,500,0,!0,u.Z.EASE_IN_OUT_BOUNCE)])};case"melt-in":{let s=v.getOption(t,"fiveway","center");return{enter:new m.Z(e,[new p("melt",{from:1,to:0},1,1e3,0,!0,u.Z.EASE_LINEAR,p.DIRECTION_FORWARD,s)],{fiveway:s})}}case"gooey-in":return{enter:new m.Z(e,[new p("gooey",{from:1,to:0},1,1e3,0,!0,u.Z.EASE_LINEAR)])};case"block-in":return{enter:new m.Z(e,[new p("block",{from:1,to:0},1,1e3,0,!0,u.Z.EASE_LINEAR)])};case"curtain-in":{let s=v.getOption(t,"plane","horizontal");return{enter:new m.Z(e,[new p("curtain",{from:1,to:0},1,1e3,0,!0,u.Z.EASE_OUT_QUART,p.DIRECTION_FORWARD,s)],{plane:s})}}case"blinds-in":{let s=v.getOption(t,"fourway","right");return{enter:new m.Z(e,[new p("blinds",{from:1,to:0},1,1e3,0,!0,u.Z.EASE_LINEAR,p.DIRECTION_FORWARD,s)],{fourway:s})}}case"wipe-in":{let s=v.getOption(t,"fourway","left");return{enter:new m.Z(e,[new p("wipe",{from:1,to:0},1,800,0,!0,u.Z.EASE_LINEAR,p.DIRECTION_FORWARD,s)],{fourway:s})}}case"slot-in":{let s=v.getOption(t,"fourway","left");return{enter:new m.Z(e,[new p("slot",{from:1,to:0},1,800,0,!0,u.Z.EASE_LINEAR,p.DIRECTION_FORWARD,s)],{fourway:s})}}case"split-in":{let s=v.getOption(t,"plane","vertical");return{enter:new m.Z(e,[new p("split",{from:1,to:0},1,500,0,!0,u.Z.EASE_LINEAR,p.DIRECTION_FORWARD,s)],{plane:s})}}case"line-in":{let s=v.getOption(t,"plane","vertical");return{enter:new m.Z(e,[new p("line",{from:1,to:0},1,500,0,!0,u.Z.EASE_LINEAR,p.DIRECTION_FORWARD,s)],{plane:s})}}case"circular-in":return{enter:new m.Z(e,[new p("circular",{from:1,to:0},1,1e3,0,!0,u.Z.EASE_LINEAR)])};case"ripple-in":return{enter:new m.Z(e,[new p("ripple",{from:1,to:0},1,1e3,0,!0,u.Z.EASE_LINEAR)])};case"warp-in":{let s=v.getOption(t,"fourway","left");return{enter:new m.Z(e,[new p("warp",{from:1,to:0},1,1e3,0,!0,u.Z.EASE_LINEAR,p.DIRECTION_FORWARD,s)],{fourway:s})}}case"rotate":{let s=v.getOption(t,"rotation","right");return{scene:new m.Z(e,[new p("rotate","right"===s?{from:0,to:1}:{from:1,to:0},1,2e3,0,!1,u.Z.EASE_LINEAR,p.DIRECTION_FORWARD)],{rotation:s})}}case"jiggle":return{scene:new m.Z(e,[new p("rotate",{from:-.05,to:.05},12,2e3,0,!1,u.Z.EASE_LINEAR)])};case"wave":{let s=v.getOption(t,"anchor","bottom");return{scene:new m.Z(e,[new p("rotate",{to:-.075},1,500,0,!1,u.Z.EASE_OUT_CUBIC,p.DIRECTION_FORWARD,s),new p("rotate",{from:-.075,to:.075},1,1e3,500,!1,u.Z.EASE_IN_OUT_CUBIC,p.DIRECTION_ALTERNATE,s),new p("rotate",{to:0},1,500,1500,!1,u.Z.EASE_IN_CUBIC,p.DIRECTION_FORWARD,s)],{anchor:s})}}case"floating":return{scene:new m.Z(e,[new p("self-y",{to:-.2},1,400,0,!1,u.Z.EASE_OUT_CUBIC),new p("self-y",{from:-.2,to:.2},1,800,400,!1,u.Z.EASE_IN_OUT_CUBIC,p.DIRECTION_ALTERNATE),new p("self-y",{to:0},1,400,1200,!1,u.Z.EASE_IN_CUBIC)])};case"flip":{const s=v.getOption(t,"plane","vertical");return"vertical"===s?{scene:new m.Z(e,[new p("scale-height",{from:1,to:0},1,200,0,!1,u.Z.EASE_LINEAR,p.DIRECTION_FORWARD),new p("scale-height",{from:0,to:-1},1,200,200,!1,u.Z.EASE_LINEAR,p.DIRECTION_FORWARD),new p("scale-height",{from:-1,to:1},1,400,400,!1,u.Z.EASE_LINEAR,p.DIRECTION_FORWARD)],{plane:s})}:{scene:new m.Z(e,[new p("scale-width",{from:1,to:0},1,200,0,!1,u.Z.EASE_LINEAR,p.DIRECTION_FORWARD),new p("scale-width",{from:0,to:-1},1,200,200,!1,u.Z.EASE_LINEAR,p.DIRECTION_FORWARD),new p("scale-width",{from:-1,to:1},1,400,400,!1,u.Z.EASE_LINEAR,p.DIRECTION_FORWARD)],{plane:s})}}case"drift":return{scene:new m.Z(e,[new p("offset-x",{to:.2},1,2e3,0,!1,u.Z.EASE_LINEAR),new p("offset-x",{to:-.2},1,4e3,2e3,!1,u.Z.EASE_LINEAR),new p("offset-x",{to:0},1,2e3,6e3,!1,u.Z.EASE_LINEAR)])};case"gelatine":return{scene:new m.Z(e,[new p("scale-width",{to:.9},1,100,0),new p("scale-width",{to:1.1},1,100,100),new p("scale-width",{to:.95},1,100,200),new p("scale-width",{to:1},1,100,300),new p("scale-height",{to:1.1},1,100,0),new p("scale-height",{to:.9},1,100,100),new p("scale-height",{to:1.05},1,100,200),new p("scale-height",{to:1},1,100,300)])};case"bounce":return{scene:new m.Z(e,[new p("scale-width",{to:1.1},1,100,0),new p("scale-height",{to:.9},1,100,0),new p("self-y",{to:.1},1,100,0),new p("scale-width",{to:.9},1,300,100),new p("scale-height",{to:1.1},1,300,100),new p("self-y",{to:-1.5},1,300,100,!1,u.Z.EASE_OUT_CUBIC),new p("scale-width",{to:1},1,300,410),new p("scale-height",{to:1},1,300,410),new p("self-y",{to:0},1,500,410,!1,u.Z.EASE_OUT_BOUNCE)])};case"vibrate":return{scene:new m.Z(e,[new p("self-x",{to:-.01},1,30,0,!1,u.Z.EASE_LINEAR),new p("self-y",{to:.01},1,30,0,!1,u.Z.EASE_LINEAR),new p("self-y",{to:-.01},1,30,30,!1,u.Z.EASE_LINEAR),new p("self-x",{to:.01},1,50,60,!1,u.Z.EASE_LINEAR),new p("self-y",{to:.01},1,50,60,!1,u.Z.EASE_LINEAR),new p("self-x",{to:0},1,30,110,!1,u.Z.EASE_LINEAR),new p("self-y",{to:0},1,30,120,!1,u.Z.EASE_LINEAR),new p("self-x",{to:-.01},1,30,120,!1,u.Z.EASE_LINEAR),new p("self-y",{to:.01},1,30,120,!1,u.Z.EASE_LINEAR),new p("self-y",{to:-.01},1,30,150,!1,u.Z.EASE_LINEAR),new p("self-x",{to:.01},1,50,180,!1,u.Z.EASE_LINEAR),new p("self-y",{to:.01},1,50,180,!1,u.Z.EASE_LINEAR),new p("self-x",{to:0},1,30,230,!1,u.Z.EASE_LINEAR),new p("self-y",{to:0},1,30,250,!1,u.Z.EASE_LINEAR)])};case"flicker":return{scene:new m.Z(e,[new p("opacity",{to:0},1,30,500),new p("opacity",{to:1},1,30,550),new p("opacity",{to:0},1,30,650),new p("opacity",{to:1},1,50,690),new p("opacity",{to:0},1,30,1300),new p("opacity",{to:1},1,30,1350),new p("opacity",{to:0},1,30,1700),new p("opacity",{to:1},1,30,1750),new p("opacity",{to:0},1,30,1900),new p("opacity",{to:1},1,50,1950)])};case"beat":return{scene:new m.Z(e,[new p("scale",{to:.91},1,150,0,!1,u.Z.EASE_OUT_QUAD),new p("scale",{to:.98},1,150,150,!1,u.Z.EASE_OUT_QUAD),new p("scale",{to:.91},1,150,400,!1,u.Z.EASE_OUT_QUAD),new p("scale",{to:1},1,200,600,!1,u.Z.EASE_OUT_QUAD)])};case"fade-out":return{exit:new m.Z(e,[new p("opacity",{to:0},1,750,0,!1,u.Z.EASE_LINEAR)])};case"grow-out":{const s=v.getOption(t,"anchor","center");return{exit:new m.Z(e,[new p("opacity",{to:0},1,1e3,0,!1,u.Z.EASE_LINEAR),new p("scale",{to:1.2},1,1e3,0,!1,u.Z.EASE_LINEAR,p.DIRECTION_FORWARD,s)],{anchor:s})}}case"shrink-out":{const s=v.getOption(t,"anchor","center");return{exit:new m.Z(e,[new p("opacity",{to:0},1,1e3,0,!1,u.Z.EASE_LINEAR),new p("scale",{to:.5},1,1e3,0,!1,u.Z.EASE_LINEAR,p.DIRECTION_FORWARD,s)],{anchor:s})}}case"rise-out":return{exit:new m.Z(e,[new p("opacity",{to:0},1,750,0,!1,u.Z.EASE_LINEAR),new p("offset-y",{to:-.2},1,750,0,!1,u.Z.EASE_IN_CIRC)])};case"sink-out":return{exit:new m.Z(e,[new p("opacity",{to:0},1,750,0,!1,u.Z.EASE_LINEAR),new p("offset-y",{to:.2},1,750,0,!1,u.Z.EASE_IN_CIRC)])};case"vertical-out":return{exit:new m.Z(e,[new p("scale-height",{to:0},1,500,0,!1,u.Z.EASE_IN_BACK)])};case"horizontal-out":return{exit:new m.Z(e,[new p("scale-width",{to:0},1,500,0,!1,u.Z.EASE_IN_BACK)])};case"flicker-out":return{exit:new m.Z(e,[new p("opacity",{to:0},1,50,0,!1),new p("opacity",{to:1},1,100,100),new p("opacity",{to:0},1,50,200),new p("opacity",{to:1},1,100,300),new p("opacity",{to:0},1,50,400),new p("opacity",{to:1},1,100,600),new p("opacity",{to:0},1,50,700)])};case"tumble-out":{let s,i=v.getOption(t,"fourway","right");switch(i){case"right":s=new p("offset-x",{to:1.5},1,400,300,!1,u.Z.EASE_LINEAR);break;case"left":s=new p("offset-x",{to:-1.5},1,400,300,!1,u.Z.EASE_LINEAR);break;case"up":s=new p("offset-y",{to:-1.5},1,400,300,!1,u.Z.EASE_LINEAR);break;case"down":s=new p("offset-y",{to:1.5},1,400,300,!1,u.Z.EASE_LINEAR)}return{exit:new m.Z(e,[new p("rotate",{to:.01},2,300,0,!1,u.Z.EASE_OUT_BACK,p.DIRECTION_ALTERNATE),new p("rotate",{to:.2},2,500,300,!1,u.Z.EASE_LINEAR,p.DIRECTION_ALTERNATE),s],{fourway:i})}}case"8-bit-out":{let s=v.getOption(t,"eightway","upleft");const i={exit:new m.Z(e,[new p("rotate",{from:.1,to:-.1},1,500,0,!0,u.Z.EASE_FIVE_LADDER),new p("rotate",{from:-.1,to:.1},1,500,500,!1,u.Z.EASE_FIVE_LADDER),new p("rotate",{set:0},1,0,1e3,!1)],{eightway:s})};switch(s){case"up":i.exit.motions.push(new p("offset-y",{to:-1.2},1,1e3,0,!0,u.Z.EASE_FIVE_LADDER));break;case"down":i.exit.motions.push(new p("offset-y",{to:1.2},1,1e3,0,!0,u.Z.EASE_FIVE_LADDER));break;case"left":i.exit.motions.push(new p("offset-x",{to:-1.2},1,1e3,0,!0,u.Z.EASE_FIVE_LADDER));break;case"right":i.exit.motions.push(new p("offset-x",{to:1.2},1,1e3,0,!0,u.Z.EASE_FIVE_LADDER));break;case"upleft":i.exit.motions.push(new p("offset-y",{to:-1.2},1,1e3,0,!0,u.Z.EASE_FIVE_LADDER),new p("offset-x",{to:-.4},1,1e3,0,!0,u.Z.EASE_FIVE_LADDER));break;case"upright":i.exit.motions.push(new p("offset-y",{to:-1.2},1,1e3,0,!0,u.Z.EASE_FIVE_LADDER),new p("offset-x",{to:.4},1,1e3,0,!0,u.Z.EASE_FIVE_LADDER));break;case"downleft":i.exit.motions.push(new p("offset-y",{to:1.2},1,1e3,0,!0,u.Z.EASE_FIVE_LADDER),new p("offset-x",{to:-.4},1,1e3,0,!0,u.Z.EASE_FIVE_LADDER));break;case"downright":i.exit.motions.push(new p("offset-y",{to:1.2},1,1e3,0,!0,u.Z.EASE_FIVE_LADDER),new p("offset-x",{to:.4},1,1e3,0,!0,u.Z.EASE_FIVE_LADDER))}return i}case"whoa-out":return{exit:new m.Z(e,[new p("scale",{to:1.5},1,500,0,!1,u.Z.EASE_LINEAR),new p("opacity",{to:0},1,750,0,!1,u.Z.EASE_LINEAR),new p("rotate",{to:-.075},2,750,0,!1,u.Z.EASE_OUT_BACK,p.DIRECTION_ALTERNATE)])};case"drop-out":return{exit:new m.Z(e,[new p("rotate",{to:.01},2,300,0,!1,u.Z.EASE_OUT_BACK,p.DIRECTION_ALTERNATE),new p("offset-y",{to:1},1,750,250,!1,u.Z.EASE_OUT_BOUNCE)])};case"action-out":{let s=v.getOption(t,"twoway","right");return{exit:new m.Z(e,[new p("offset-x","right"===s?{to:.1}:{to:-.1},1,1e3,0,!1,u.Z.EASE_LINEAR),new p("offset-x","right"===s?{to:1.5}:{to:-1.5},1,350,1e3,!1,u.Z.EASE_LINEAR)],{twoway:s})}}case"spring-out":return{exit:new m.Z(e,[new p("scale-width",{to:2},1,300,0,!1,u.Z.EASE_LINEAR,p.DIRECTION_FORWARD,"right"),new p("scale-width",{to:1},1,200,300,!1,u.Z.EASE_IN_OUT_ELASTIC,p.DIRECTION_FORWARD,"left"),new p("self-x",{set:1},0,1,300,!1,u.Z.EASE_LINEAR)])};case"backup-out":return{exit:new m.Z(e,[new p("scale",{to:.6},1,200,0,!1,u.Z.EASE_IN_BACK),new p("offset-y",{to:-1},1,500,150,!1,u.Z.EASE_IN_CUBIC)])};case"backdown-out":return{exit:new m.Z(e,[new p("scale",{to:.6},1,200,0,!1,u.Z.EASE_IN_BACK),new p("offset-y",{to:1},1,500,150,!1,u.Z.EASE_IN_CUBIC)])};case"pixelate-out":return{exit:new m.Z(e,[new p("pixelate",{from:0,to:1},1,1500,0,!1,u.Z.EASE_OUT_CIRC)])};case"mosaic-out":return{exit:new m.Z(e,[new p("mosaic",{from:0,to:1},1,1500,0,!1,u.Z.EASE_OUT_CIRC)])};case"fringe-out":return{exit:new m.Z(e,[new p("opacity",{from:1,to:0},1,500,0,!0,u.Z.EASE_LINEAR),new p("fringe",{from:0,to:1},1,500,0,!0,u.Z.EASE_IN_OUT_BOUNCE)])};case"melt-out":{let s=v.getOption(t,"fiveway","center");return{exit:new m.Z(e,[new p("melt",{from:0,to:1},1,1e3,0,!0,u.Z.EASE_LINEAR,p.DIRECTION_FORWARD,v.flipOption(s))],{fiveway:s})}}case"gooey-out":return{exit:new m.Z(e,[new p("gooey",{from:0,to:1},1,1e3,0,!1,u.Z.EASE_LINEAR)])};case"block-out":return{exit:new m.Z(e,[new p("block",{from:0,to:1},1,1e3,0,!1,u.Z.EASE_LINEAR)])};case"curtain-out":{let s=v.getOption(t,"plane","horizontal");return{exit:new m.Z(e,[new p("curtain",{from:0,to:1},1,1e3,0,!0,u.Z.EASE_IN_QUART,p.DIRECTION_FORWARD,s)],{plane:s})}}case"blinds-out":let s=v.getOption(t,"fourway","right");return{exit:new m.Z(e,[new p("blinds",{from:0,to:1},1,1e3,0,!1,u.Z.EASE_LINEAR,p.DIRECTION_FORWARD,v.flipOption(s))],{fourway:s})};case"wipe-out":{let s=v.getOption(t,"fourway","right");return{exit:new m.Z(e,[new p("wipe",{from:0,to:1},1,800,0,!1,u.Z.EASE_LINEAR,p.DIRECTION_FORWARD,v.flipOption(s))],{fourway:s})}}case"slot-out":{let s=v.getOption(t,"fourway","right");return{exit:new m.Z(e,[new p("slot",{from:0,to:1},1,800,0,!1,u.Z.EASE_LINEAR,p.DIRECTION_FORWARD,v.flipOption(s))],{fourway:s})}}case"split-out":{let s=v.getOption(t,"plane","vertical");return{exit:new m.Z(e,[new p("split",{from:0,to:1},1,500,0,!1,u.Z.EASE_LINEAR,p.DIRECTION_FORWARD,s)],{plane:s})}}case"line-out":{let s=v.getOption(t,"plane","vertical");return{exit:new m.Z(e,[new p("line",{from:0,to:1},1,500,0,!1,u.Z.EASE_LINEAR,p.DIRECTION_FORWARD,s)],{plane:s})}}case"circular-out":return{exit:new m.Z(e,[new p("circular",{from:0,to:1},1,1e3,0,!1,u.Z.EASE_LINEAR)])};case"ripple-out":return{exit:new m.Z(e,[new p("ripple",{from:0,to:1},1,1e3,0,!1,u.Z.EASE_LINEAR)])};case"warp-out":{let s=v.getOption(t,"fourway","left");return{exit:new m.Z(e,[new p("warp",{from:0,to:1},1,1e3,0,!0,u.Z.EASE_LINEAR,p.DIRECTION_FORWARD,v.flipOption(s))],{fourway:s})}}}console.log("No such layer animation preset")}static getPageAnimation(e){switch(e){case"fade":return{stagger:new g.Z(1500,"top"),enter:new m.Z(e,[new p("scale",{set:1.05},1,0,0,!0,u.Z.EASE_LINEAR,p.DIRECTION_FORWARD,"center","background"),new p("viewport-box-y",{from:0,to:1},1,7e3,0,!0,u.Z.EASE_LINEAR,p.DIRECTION_FORWARD,"center","background"),new p("opacity",{from:0},1,750,0,!0,u.Z.EASE_LINEAR)],void 0,750),scene:new m.Z(e,void 0,void 0,5e3),exit:new m.Z(e,[new p("opacity",{to:0},1,750,0,!1,u.Z.EASE_LINEAR)])};case"rise":return{stagger:new g.Z(1500,"top"),enter:new m.Z(e,[new p("opacity",{from:0},1,800,0,!0,u.Z.EASE_LINEAR),new p("offset-y",{from:.3},1,800,0,!0,u.Z.EASE_LINEAR)]),scene:new m.Z(e,void 0,void 0,5e3),exit:new m.Z(e,[new p("opacity",{to:0},1,800,0,!1,u.Z.EASE_LINEAR),new p("offset-y",{to:-.3},1,800,0,!1,u.Z.EASE_LINEAR)])};case"tumble":return{stagger:new g.Z(1500,"top"),enter:new m.Z(e,[new p("rotate",{from:.2},1,380,0,!0,u.Z.EASE_LINEAR,p.DIRECTION_FORWARD,"bottom","odd"),new p("offset-x",{from:2},1,400,0,!0,u.Z.EASE_LINEAR,p.DIRECTION_FORWARD,"center","odd"),new p("rotate",{to:.01},2,300,380,!1,u.Z.EASE_OUT_BACK,p.DIRECTION_ALTERNATE,"bottom","odd"),new p("rotate",{from:-.2},1,380,0,!0,u.Z.EASE_LINEAR,p.DIRECTION_FORWARD,"top","even"),new p("offset-x",{from:-2},1,400,0,!0,u.Z.EASE_LINEAR,p.DIRECTION_FORWARD,"center","even"),new p("rotate",{to:-.01},2,300,380,!1,u.Z.EASE_OUT_BACK,p.DIRECTION_ALTERNATE,"top","even")]),scene:new m.Z(e,void 0,void 0,3e3),exit:new m.Z(e,[new p("rotate",{to:.01},2,300,0,!1,u.Z.EASE_OUT_BACK,p.DIRECTION_ALTERNATE,"center","odd"),new p("rotate",{to:.2},2,500,300,!1,u.Z.EASE_LINEAR,p.DIRECTION_ALTERNATE,"center","odd"),new p("offset-x",{to:1.5},1,400,300,!1,u.Z.EASE_LINEAR,p.DIRECTION_FORWARD,"center","odd"),new p("rotate",{to:-.01},2,300,0,!1,u.Z.EASE_OUT_BACK,p.DIRECTION_ALTERNATE,"center","even"),new p("rotate",{to:-.2},2,500,300,!1,u.Z.EASE_LINEAR,p.DIRECTION_ALTERNATE,"center","even"),new p("offset-x",{to:-1.5},1,400,300,!1,u.Z.EASE_LINEAR,p.DIRECTION_FORWARD,"center","even")])};case"soothe":return{stagger:new g.Z(1500,"top"),enter:new m.Z(e,[new p("scale",{set:1.05},1,0,0,!0,u.Z.EASE_LINEAR,p.DIRECTION_FORWARD,"center","background"),new p("viewport-box-x",{from:0,to:1},1,8e3,0,!0,u.Z.EASE_LINEAR,p.DIRECTION_FORWARD,"center","background"),new p("viewport-box-y",{from:0,to:1},1,8e3,0,!0,u.Z.EASE_LINEAR,p.DIRECTION_FORWARD,"center","background"),new p("opacity",{from:0},1,2e3,0,!0,u.Z.EASE_LINEAR),new p("scale",{from:.9},1,2e3,0,!0,u.Z.EASE_LINEAR,p.DIRECTION_FORWARD,"center","large"),new p("scale",{from:.9},1,2e3,0,!0,u.Z.EASE_LINEAR,p.DIRECTION_FORWARD,"center","medium"),new p("scale",{from:.7},1,2e3,0,!0,u.Z.EASE_LINEAR,p.DIRECTION_FORWARD,"center","small")],void 0,2e3),scene:new m.Z(e,void 0,void 0,4e3),exit:new m.Z(e,[new p("opacity",{to:0},1,1e3,0,!1,u.Z.EASE_LINEAR)])};case"action":return{stagger:new g.Z(2e3,"top"),enter:new m.Z(e,[new p("viewport-x",{from:-1,to:.4},1,350,0,!0,u.Z.EASE_LINEAR,p.DIRECTION_FORWARD,"center","text")]),scene:new m.Z(e,[new p("viewport-x",{from:.4,to:.6},1,3e3,0,!1,u.Z.EASE_LINEAR,p.DIRECTION_FORWARD,"center","text")]),exit:new m.Z(e,[new p("viewport-x",{from:.6,to:2},1,350,0,!1,u.Z.EASE_LINEAR,p.DIRECTION_FORWARD,"center","text")])};case"parallax":return{enter:new m.Z(e,[new p("scale",{to:1.1},1,6e3,0,!0,u.Z.EASE_LINEAR,p.DIRECTION_FORWARD,"center","background"),new p("self-x",{from:.5,to:0},1,2e3,0,!0,u.Z.EASE_OUT_CUBIC,p.DIRECTION_FORWARD,"center","odd"),new p("self-x",{from:-.5,to:0},1,2e3,0,!0,u.Z.EASE_OUT_CUBIC,p.DIRECTION_FORWARD,"center","even")],void 0,2e3),scene:new m.Z(e,void 0,void 0,2e3),exit:new m.Z(e,[new p("self-x",{to:-.8},1,2e3,0,!1,u.Z.EASE_IN_CUBIC,p.DIRECTION_FORWARD,"center","odd"),new p("self-x",{to:.8},1,2e3,0,!1,u.Z.EASE_IN_CUBIC,p.DIRECTION_FORWARD,"center","even")])};case"stomp":return{enter:new m.Z(e,[new p("scale",{from:4,to:1},1,300,0,!1,u.Z.EASE_IN_CUBIC,p.DIRECTION_FORWARD,"center","foreground"),new p("scale",{to:1.05},4,400,300,!1,u.Z.EASE_OUT_CUBIC,p.DIRECTION_ALTERNATE,"center","odd"),new p("rotate",{to:.01},1,100,300,!1,u.Z.EASE_LINEAR,p.DIRECTION_ALTERNATE,"center","odd"),new p("rotate",{from:.01,to:-.01},1,200,400,!1,u.Z.EASE_LINEAR,p.DIRECTION_ALTERNATE,"center","odd"),new p("rotate",{to:0},1,100,600,!1,u.Z.EASE_LINEAR,p.DIRECTION_ALTERNATE,"center","odd"),new p("scale",{to:1.05},4,400,300,!1,u.Z.EASE_OUT_CUBIC,p.DIRECTION_ALTERNATE,"center","even"),new p("rotate",{to:-.01},1,100,300,!1,u.Z.EASE_LINEAR,p.DIRECTION_ALTERNATE,"center","even"),new p("rotate",{from:-.01,to:.01},1,200,400,!1,u.Z.EASE_LINEAR,p.DIRECTION_ALTERNATE,"center","even"),new p("rotate",{to:0},1,100,600,!1,u.Z.EASE_LINEAR,p.DIRECTION_ALTERNATE,"center","even")]),scene:new m.Z(e,void 0,void 0,4e3),exit:new m.Z(e,[new p("rotate",{to:.01},2,300,0,!1,u.Z.EASE_OUT_BACK,p.DIRECTION_ALTERNATE,"center","foreground"),new p("offset-y",{to:1},1,750,250,!1,u.Z.EASE_OUT_BOUNCE,p.DIRECTION_FORWARD,"center","foreground")])};case"neon":return{stagger:new g.Z(1e3,"top"),enter:new m.Z(e,[new p("opacity",{to:1},1,50,200,!1,u.Z.EASE_LINEAR,p.DIRECTION_FORWARD,"center","all"),new p("opacity",{to:0},1,100,300,!1,u.Z.EASE_LINEAR,p.DIRECTION_FORWARD,"center","all"),new p("opacity",{to:1},1,50,400,!1,u.Z.EASE_LINEAR,p.DIRECTION_FORWARD,"center","all"),new p("opacity",{to:0},1,100,600,!1,u.Z.EASE_LINEAR,p.DIRECTION_FORWARD,"center","all"),new p("opacity",{to:1},1,50,800,!1,u.Z.EASE_LINEAR,p.DIRECTION_FORWARD,"center","all")]),scene:new m.Z(e,[new p("opacity",{to:0},1,30,500,!1,u.Z.EASE_LINEAR,p.DIRECTION_FORWARD,"center","foreground"),new p("opacity",{to:1},1,30,550,!1,u.Z.EASE_LINEAR,p.DIRECTION_FORWARD,"center","foreground"),new p("opacity",{to:0},1,30,650,!1,u.Z.EASE_LINEAR,p.DIRECTION_FORWARD,"center","small"),new p("opacity",{to:1},1,50,690,!1,u.Z.EASE_LINEAR,p.DIRECTION_FORWARD,"center","small"),new p("opacity",{to:0},1,30,1300,!1,u.Z.EASE_LINEAR,p.DIRECTION_FORWARD,"center","small"),new p("opacity",{to:1},1,30,1350,!1,u.Z.EASE_LINEAR,p.DIRECTION_FORWARD,"center","small"),new p("opacity",{to:0},1,30,1700,!1,u.Z.EASE_LINEAR,p.DIRECTION_FORWARD,"center","text"),new p("opacity",{to:1},1,30,1750,!1,u.Z.EASE_LINEAR,p.DIRECTION_FORWARD,"center","text"),new p("opacity",{to:0},1,30,1900,!1,u.Z.EASE_LINEAR,p.DIRECTION_FORWARD,"center","text"),new p("opacity",{to:1},1,50,1950,!1,u.Z.EASE_LINEAR,p.DIRECTION_FORWARD,"center","text")],void 0,void 0,2e3),exit:new m.Z(e,[new p("opacity",{to:0},1,50,0),new p("opacity",{to:1},1,100,100),new p("opacity",{to:0},1,50,200),new p("opacity",{to:1},1,100,300),new p("opacity",{to:0},1,50,400),new p("opacity",{to:1},1,100,600)],void 0,void 0,1e3)}}console.log("No such page animation preset")}}v.layerEnterAnimations=[["fade-in",!1],["grow-in",!1,!0],["shrink-in",!1,!0],["rise-in",!1],["sink-in",!1],["vertical-in",!1],["horizontal-in",!1],["flicker-in",!0],["tumble-in",!0,!0],["8-bit-in",!0,!0],["whoa-in",!0],["drop-in",!0],["action-in",!0,!0],["pop-in",!0],["stomp-in",!0],["spring-in",!0],["backdown-in",!0],["backup-in",!0],["pixelate-in",!1],["mosaic-in",!0],["fringe-in",!0],["melt-in",!0,!0],["gooey-in",!0],["block-in",!0],["curtain-in",!0,!0],["blinds-in",!0,!0],["wipe-in",!1,!0],["slot-in",!1,!0],["split-in",!0,!0],["line-in",!0,!0],["circular-in",!0],["ripple-in",!0],["warp-in",!0,!0]],v.layerSceneAnimations=[["rotate",!1,!0],["jiggle",!1],["wave",!1,!0],["flip",!1,!0],["floating",!0],["drift",!0],["gelatine",!0],["bounce",!0],["vibrate",!0],["flicker",!0],["beat",!0]],v.layerExitAnimations=[["fade-out",!1],["grow-out",!1,!0],["shrink-out",!1,!0],["rise-out",!1],["sink-out",!1],["vertical-out",!1],["horizontal-out",!1],["flicker-out",!0],["tumble-out",!0,!0],["8-bit-out",!0,!0],["whoa-out",!0],["drop-out",!0],["action-out",!0,!0],["spring-out",!0],["backdown-out",!0],["backup-out",!0],["pixelate-out",!1],["mosaic-out",!0],["fringe-out",!0],["melt-out",!0,!0],["gooey-out",!0],["block-out",!0],["curtain-out",!0,!0],["blinds-out",!0,!0],["wipe-out",!1,!0],["slot-out",!1,!0],["split-out",!0,!0],["line-out",!0,!0],["circular-out",!0],["ripple-out",!0],["warp-out",!0,!0]],v.pageFullAnimations=[["none",!1],["fade",!1],["rise",!1],["tumble",!1],["soothe",!1],["action",!1],["parallax",!0],["stomp",!0],["neon",!0]];var f=s(1951),y=s(9924),w=s(2396);class b extends n.Z{constructor(e,t){super(void 0,(0,i.Z)("titleAnimation"),!0),this.closeCall=t,this.type="page",this.segment="enter",this.docked=!1,this.dock=e=>{document.dispatchEvent(new CustomEvent("panel-dock",{detail:"animation"}))},this.showSelector=e=>{const t=(0,a.ZP)(e+"-selector");t.classList.add("active");const s=e=>{t.classList.remove("active"),t.removeEventListener("mouseleave",s,!1),document.removeEventListener("mousedown",i,!0)},i=e=>{e.target===t||t.contains(e.target)||(e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault(),t.classList.remove("active"),t.removeEventListener("mouseleave",s,!1),document.removeEventListener("mousedown",i,!0))};t.addEventListener("mouseleave",s,!1),document.addEventListener("mousedown",i,!0)},this.more=e=>{e.preventDefault(),e.stopPropagation();const t=this.stage.fresco.getSelected(),s=new Array;let a,n=!1,o=!1,h=!1;t&&t.animation&&!t.animation.block&&(n=void 0!==t.animation.enter,o=void 0!==t.animation.scene,h=void 0!==t.animation.exit),!this.stage.fresco.animation||n||o||h||(a=t&&t.animation&&t.animation.block?"block":"page"),s.push(new y.Z("page"===a?(0,i.Z)("pageAnimation"):(0,i.Z)("revertPageAnimation"),this.stage.fresco.animation?()=>this.setPageOverride(!1):void 0,"page"===a?"":void 0,"/img/icon/animation/page.svg"),new y.Z((0,i.Z)("blockAnimation"),this.stage.fresco.animation?()=>this.setPageOverride(!0):void 0,"block"===a?"":void 0,"/img/icon/animation/none.svg"),new y.Z,new y.Z((0,i.Z)("titleCopy"),t&&t.animation&&!t.animation.block?()=>this.copy():void 0,void 0,"/img/icon/animation/copy.svg"),new y.Z((0,i.Z)("titlePaste"),this.stage.animation?()=>this.paste():void 0,void 0,"/img/icon/animation/paste.svg"),new y.Z((0,i.Z)("titleClear"),t&&t.animation&&!t.animation.block?()=>this.clear():void 0,void 0,"/img/icon/animation/empty.svg")),new y.C(new r.Z(e.clientX,e.clientY),s,!0)},this.copy=()=>{const e=this.stage.fresco.getSelected();e&&e.animation&&!e.animation.block&&(this.stage.animation=w.Z.clone(e.animation))},this.paste=()=>{const e=this.stage.fresco.getSelected();if(e&&this.stage.animation){let t=e.animation;e.animation=w.Z.clone(this.stage.animation),this.stage.history.add({type:"layerAnimation",kind:"paste",layer:e,animation:t})}this.setSegment(this.segment)},this.clear=()=>{const e=this.stage.fresco.getSelected();if(e&&e.animation&&!e.animation.block){let t=e.animation;e.animation=void 0,this.stage.history.add({type:"layerAnimation",kind:"clear",layer:e,animation:t})}this.setSegment(this.segment)},this.removeSegment=e=>{const t=this.stage.fresco.getSelected();if(t&&t.animation&&!t.animation.block){let s=t.animation;switch(e){case"enter":t.animation.enter=void 0;break;case"scene":t.animation.scene=void 0;break;case"exit":t.animation.exit=void 0}t.animation.enter||t.animation.scene||t.animation.exit||(t.animation=void 0),this.stage.history.add({type:"layerAnimation",kind:"remove",layer:t,animation:s})}this.setSegment(this.segment)},this.layerSelect=e=>{const t=this.stage.fresco.getSelected();this.setType(t&&t.animation?"layer":this.type),"page"!==this.type&&this.currentId===(null==t?void 0:t.id)||this.stage.history.commitTransaction(),this.currentId=null==t?void 0:t.id},this.selectType=e=>{let t=e.currentTarget;this.setType(t.id.replace("tab-",""))},this.selectSegment=e=>{let t=e.currentTarget;this.setSegment(t.id.replace("segment-",""))},this.setType=e=>{var t;null===(t=(0,a.ZP)("animation-message"))||void 0===t||t.remove();let s=(0,a.ZP)("animation-presets");if(this.type&&(0,a.ZP)("tab-"+this.type).classList.remove("selected"),(0,a.ZP)("tab-"+e).classList.add("selected"),this.type=e,this.float.style.width="page"===e?"340px":"400px",this.docked&&document.dispatchEvent(new CustomEvent("resize")),(0,a.ZP)("animation-settings").style.display="layer"===e?"block":"none",(0,a.ZP)("animation-more").style.display="layer"===e?"block":"none","page"===e){this.setTitle((0,i.Z)("page")+" "+(0,i.Z)("animation")),s.innerHTML="";let e="none",t=v.pageFullAnimations;e=this.stage.fresco.animation&&this.stage.fresco.animation.enter?this.stage.fresco.animation.enter.name:"none";for(const[i,n]of t){const t=(0,a.T)("div",{id:i,className:"apreset-page"});n&&t.classList.add("premium"),"none"!==i&&(t.addEventListener("pointerenter",this.enter,!1),t.addEventListener("pointerleave",this.leave,!1)),t.addEventListener("click",this.selectPagePreset,!1),e===i&&t.classList.add("selected"),t.append((0,a.T)("img",{src:"/img/icon/animation/"+i+".svg",className:"ic"}),(0,a.T)("span",{},i.replace("-"," "))),s.appendChild(t)}}else{let e=this.stage.fresco.getSelected();e?(this.setTitle((0,i.Z)("animation")+" : "+e.settings.name),this.setSegment(this.segment)):(this.setTitle((0,i.Z)("layer")+" "+(0,i.Z)("animation")),(0,a.ZP)("animation-settings").style.display="none",(0,a.ZP)("animation-presets").innerHTML="<p>"+(0,i.Z)("noLayerAnimation")+"</p>")}},this.setSegment=e=>{let t,s=(0,a.ZP)("animation-presets");this.segment&&(s.innerHTML="",(0,a.ZP)("segment-"+this.segment).classList.remove("selected")),(0,a.ZP)("segment-"+e).classList.add("selected"),this.segment=e,(0,a.ZP)("animation-segments").className=e;let n="empty";switch(e){case"enter":t=v.layerEnterAnimations;break;case"scene":t=v.layerSceneAnimations;break;case"exit":t=v.layerExitAnimations}const o=this.stage.fresco.getSelected();if(o&&o.animation&&!o.animation.block)switch(e){case"enter":n=void 0!==o.animation.enter?o.animation.enter.name:"empty";break;case"scene":n=void 0!==o.animation.scene?o.animation.scene.name:"empty";break;case"exit":n=void 0!==o.animation.exit?o.animation.exit.name:"empty"}const r=(0,a.T)("div",{id:"empty",className:"apreset-layer "+this.segment});"empty"===n&&r.classList.add("selected"),r.addEventListener("click",this.selectLayerPreset,!1),r.append((0,a.T)("img",{src:"/img/icon/animation/empty.svg",className:"ic"}),(0,a.T)("span",{},(0,i.Z)("none"))),s.appendChild(r);const l=h.ZP.user.subscription;for(const[i,h,c]of t){const e=(0,a.T)("div",{id:i,className:"apreset-layer "+this.segment});!l&&h&&e.classList.add("premium"),e.addEventListener("click",this.selectLayerPreset,!0),e.addEventListener("pointerenter",this.enter,!1),e.addEventListener("pointerleave",this.leave,!1),n===i&&e.classList.add("selected"),e.append((0,a.T)("img",{src:"/img/icon/animation/"+(c?"animation-multi.svg":"animation.svg"),className:"ic"}),(0,a.T)("span",{},this.prepName(i))),s.appendChild(e)}this.updateSegment()},this.prepName=e=>e.replace("-in","").replace("-out","").replace("-"," "),this.updateSegment=()=>{var e;null===(e=(0,a.ZP)("animation-message"))||void 0===e||e.remove(),(0,a.ZP)("animation-segments").classList.remove("message");const t=this.stage.fresco.getSelected();let s=!1,n=!1,o=!1;if(t&&t.animation&&!t.animation.block&&(s=void 0!==t.animation.enter,n=void 0!==t.animation.scene,o=void 0!==t.animation.exit),this.stage.fresco.animation&&!s&&!n&&!o){let e=t&&t.animation&&t.animation.block;this.float.append((0,a.T)("div",{id:"animation-message"},(0,a.T)("img",{src:e?"/img/icon/animation/none.svg":"/img/icon/animation/page.svg"}),e?(0,i.Z)("blockAnimationMessage"):(0,i.Z)("pageAnimationMessage"))),(0,a.ZP)("animation-segments").classList.add("message")}(0,a.ZP)("animation-settings-bar").classList.toggle("active",s||n||o),(0,a.ZP)("segment-enter").classList.toggle("set",s),(0,a.ZP)("segment-scene").classList.toggle("set",n),(0,a.ZP)("segment-exit").classList.toggle("set",o),(0,a.ZP)("segment-enter-name").innerText=s?this.prepName(t.animation.enter.name):(0,i.Z)("enter"),(0,a.ZP)("segment-scene-name").innerText=n?this.prepName(t.animation.scene.name):(0,i.Z)("scene"),(0,a.ZP)("segment-exit-name").innerText=o?this.prepName(t.animation.exit.name):(0,i.Z)("exit"),(0,a.ZP)("segment-enter-time").innerText=s?(0,l.M$)(t.animation.enter.duration):"",(0,a.ZP)("segment-scene-time").innerText=n?(0,l.M$)(t.animation.scene.duration):"",(0,a.ZP)("segment-exit-time").innerText=o?(0,l.M$)(t.animation.exit.duration):"",(0,a.ZP)("segment-enter-delay").innerText=s&&t.animation.enter.delay?(0,l.M$)(t.animation.enter.delay):"",(0,a.ZP)("segment-scene-delay").innerText=n&&t.animation.scene.delay?(0,l.M$)(t.animation.scene.delay):"",(0,a.ZP)("segment-exit-delay").innerText=o&&t.animation.exit.delay?(0,l.M$)(t.animation.exit.delay):"",(0,a.ZP)("segment-enter-image").src=s?"/img/icon/animation/animation.svg":"/img/icon/animation/empty.svg",(0,a.ZP)("segment-scene-image").src=n?"/img/icon/animation/animation.svg":"/img/icon/animation/empty.svg",(0,a.ZP)("segment-exit-image").src=o?"/img/icon/animation/animation.svg":"/img/icon/animation/empty.svg";let r=w.Z.getSegment(this.segment,null==t?void 0:t.animation);if(r){switch(this.setSegmentOptions(r),(0,a.ZP)("segment-settings").style.display="flex",r.speed){case m.Z.SPEED_SLOW:(0,a.ZP)("segment-speed").className="icon-meter one",(0,a.ZP)("segment-speed").setAttribute("tooltip",(0,i.Z)("slow")+" "+(0,i.Z)("speed"));break;case m.Z.SPEED_NORMAL:(0,a.ZP)("segment-speed").className="icon-meter two",(0,a.ZP)("segment-speed").setAttribute("tooltip",(0,i.Z)("normal")+" "+(0,i.Z)("speed"));break;case m.Z.SPEED_FAST:(0,a.ZP)("segment-speed").className="icon-meter three",(0,a.ZP)("segment-speed").setAttribute("tooltip",(0,i.Z)("high")+" "+(0,i.Z)("speed"))}(0,a.ZP)("delay-slider").value=r.delay.toString(),(0,a.ZP)("segment-delay-time").innerText=(0,a.ZP)("delay-slider-out").innerText=(0,l.M$)(r.delay),(0,a.ZP)("duration-slider").value=r.duration.toString(),(0,a.ZP)("segment-duration-time").innerText=(0,a.ZP)("duration-slider-out").innerText=(0,l.M$)(r.duration),(0,a.ZP)("segment-duration").classList.toggle("no-drop","scene"!==this.segment),(0,a.ZP)("segment-duration").setAttribute("tooltip","scene"!==this.segment?(0,i.Z)("fixedDuration"):(0,i.Z)("duration")),"scene"===this.segment?((0,a.ZP)("duration-slider").min=w.Z.getMotionsDuration(t.animation.scene.motions,t.animation.scene.speed).toString(),(0,a.ZP)("duration-slider").min=w.Z.getMotionsDuration(t.animation.scene.motions,t.animation.scene.speed).toString(),(0,a.ZP)("scene-settings").style.display="flex",r.repeat>0?((0,a.ZP)("segment-repeat").classList.add("set"),(0,a.ZP)("segment-repeat-amount").innerText=(r.repeat+1).toString(),(0,a.ZP)("segment-gap").style.display="flex",(0,a.ZP)("gap-slider").value=r.gap.toString(),(0,a.ZP)("segment-gap-time").innerText=(0,a.ZP)("gap-slider-out").innerText=(0,l.M$)(r.gap)):((0,a.ZP)("segment-repeat").classList.remove("set"),(0,a.ZP)("segment-repeat-amount").innerText="",(0,a.ZP)("segment-gap").style.display="none")):(0,a.ZP)("scene-settings").style.display="none"}else(0,a.ZP)("segment-settings").style.display="none"},this.setSegmentOptions=e=>{let t=(0,a.ZP)("segment-options");if(t.innerHTML="",e.option){if(e.option.rotation){const s=e.option.rotation,n=(0,a.T)("div",{id:"segment-rotate",className:"icon-button"},(0,a.T)("img",{src:"/img/icon/rotate-"+s+".svg"}));n.addEventListener("click",this.changeRotation,!0),n.setAttribute("tooltip",(0,i.Z)("rotate")+" "+(0,i.Z)(s)),n.setAttribute("flow","up"),t.append(n)}if(e.option.plane){const s=e.option.plane,n=(0,a.T)("div",{id:"segment-plane",className:"icon-button"},(0,a.T)("img",{src:"/img/icon/"+s+".svg"}));n.addEventListener("click",this.changePlane,!0),n.setAttribute("tooltip",(0,i.Z)("direction")+" "+(0,i.Z)(s)),n.setAttribute("flow","up"),t.append(n)}if(e.option.anchor){const s=e.option.anchor,n=(0,a.T)("div",{id:"segment-anchor",className:"icon-button"},(0,a.T)("img",{src:"/img/icon/anchor-"+s+".svg"}));n.addEventListener("click",(()=>this.showSelector("anchor"))),n.setAttribute("tooltip",(0,i.Z)("anchor")+" "+(0,i.Z)(s)),n.setAttribute("flow","up"),t.append(n)}if(e.option.eightway){const s=e.option.eightway,n=(0,a.T)("div",{id:"segment-eightway",className:"icon-button"},(0,a.T)("img",{src:"/img/icon/"+s+".svg"}));n.addEventListener("click",(()=>this.showSelector("eightway"))),n.setAttribute("tooltip",(0,i.Z)("direction")+" "+(0,i.Z)(s)),n.setAttribute("flow","up"),t.append(n)}if(e.option.fiveway){const s=e.option.fiveway,n=(0,a.T)("div",{id:"segment-fiveway",className:"icon-button"},(0,a.T)("img",{src:"/img/icon/"+s+".svg"}));n.addEventListener("click",(()=>this.showSelector("fiveway"))),n.setAttribute("tooltip",(0,i.Z)("direction")+" "+(0,i.Z)(s)),n.setAttribute("flow","up"),t.append(n)}if(e.option.fourway){const s=e.option.fourway,n=(0,a.T)("div",{id:"segment-direction",className:"icon-button"},(0,a.T)("img",{src:"/img/icon/"+s+".svg"}));n.addEventListener("click",this.changeFourway,!0),n.setAttribute("tooltip",(0,i.Z)("direction")+" "+(0,i.Z)(s)),n.setAttribute("flow","up"),t.append(n)}if(e.option.twoway){const s=e.option.twoway,n=(0,a.T)("div",{id:"segment-direction",className:"icon-button"},(0,a.T)("img",{src:"/img/icon/"+s+".svg"}));n.addEventListener("click",this.changeTwoway,!0),n.setAttribute("tooltip",(0,i.Z)("direction")+" "+(0,i.Z)(s)),n.setAttribute("flow","up"),t.append(n)}t.append((0,a.T)("div",{className:"aset-line"}))}},this.changeSpeed=()=>{const e=this.stage.fresco.getSelected();if(e&&e.animation){const t=w.Z.clone(e.animation);let s=w.Z.getSegment(this.segment,e.animation);s.speed===m.Z.SPEED_SLOW?w.Z.setSegmentSpeed(s,m.Z.SPEED_NORMAL):s.speed===m.Z.SPEED_NORMAL?w.Z.setSegmentSpeed(s,m.Z.SPEED_FAST):s.speed===m.Z.SPEED_FAST&&w.Z.setSegmentSpeed(s,m.Z.SPEED_SLOW),this.stage.history.add({type:"layerAnimation",kind:"speed",layer:e,animation:t})}this.updateSegment(),this.playSegment()},this.changeDelay=()=>{this.stage.stopAnimation();const e=this.stage.fresco.getSelected();if(e&&e.animation){const t=w.Z.clone(e.animation);let s=w.Z.getSegment(this.segment,null==e?void 0:e.animation);s&&(s.delay=Number((0,a.ZP)("delay-slider").value)),this.stage.history.add({type:"layerAnimation",kind:"delay",layer:e,animation:t})}this.updateSegment()},this.changeDuration=()=>{this.stage.stopAnimation();const e=this.stage.fresco.getSelected();if(e&&e.animation){const t=w.Z.clone(e.animation);let s=w.Z.getSegment(this.segment,null==e?void 0:e.animation);if(s&&(s.duration=Number((0,a.ZP)("duration-slider").value),"scene"===this.segment)){let e=w.Z.getMotionsDuration(s.motions,s.speed);s.repeat=Math.floor((s.duration-e)/(e+s.gap))}this.stage.history.add({type:"layerAnimation",kind:"duration",layer:e,animation:t})}this.updateSegment()},this.changeRepeat=()=>{const e=this.stage.fresco.getSelected();if(e&&e.animation){const t=w.Z.clone(e.animation);let s=w.Z.getSegment(this.segment,e.animation),i=s.repeat;i<9?i+=1:i=9===i?14:14===i?19:0,w.Z.setSegmentRepeat(s,i),this.stage.history.add({type:"layerAnimation",kind:"repeat",layer:e,animation:t})}this.updateSegment()},this.changeGap=()=>{this.stage.stopAnimation();const e=this.stage.fresco.getSelected();if(e&&e.animation){const t=w.Z.clone(e.animation);let s=w.Z.getSegment(this.segment,null==e?void 0:e.animation);s&&w.Z.setSegmentGap(s,Number((0,a.ZP)("gap-slider").value)),this.stage.history.add({type:"layerAnimation",kind:"gap",layer:e,animation:t})}this.updateSegment()},this.changeRotation=e=>{e.preventDefault(),e.stopPropagation(),this.stage.stopAnimation();const t=this.stage.fresco.getSelected();if(t&&t.animation){const e=t.animation;let s=w.Z.getSegment(this.segment,t.animation);s.option.rotation="right"===s.option.rotation?"left":"right";let i=v.getLayerAnimation(s.name,s.option);t.animation=w.Z.fromInjection(i,t.animation),(0,o.Z)("layer-animation",s.name),this.stage.history.add({type:"layerAnimation",kind:s.name,layer:t,animation:e})}this.updateSegment(),this.playSegment()},this.changePlane=e=>{e.preventDefault(),e.stopPropagation(),this.stage.stopAnimation();const t=this.stage.fresco.getSelected();if(t&&t.animation){const e=t.animation;let s=w.Z.getSegment(this.segment,t.animation);s.option.plane="vertical"===s.option.plane?"horizontal":"vertical";let i=v.getLayerAnimation(s.name,s.option);t.animation=w.Z.fromInjection(i,t.animation),(0,o.Z)("layer-animation",s.name),this.stage.history.add({type:"layerAnimation",kind:s.name,layer:t,animation:e})}this.updateSegment(),this.playSegment()},this.changeAnchor=e=>{e.preventDefault(),e.stopPropagation(),this.stage.stopAnimation();const t=this.stage.fresco.getSelected();if(t&&t.animation){const s=t.animation;let i=w.Z.getSegment(this.segment,t.animation);i.option.anchor=e.currentTarget.getAttribute("data");let a=v.getLayerAnimation(i.name,i.option);t.animation=w.Z.fromInjection(a,t.animation),(0,o.Z)("layer-animation",i.name),this.stage.history.add({type:"layerAnimation",kind:i.name,layer:t,animation:s})}this.updateSegment(),this.playSegment()},this.changeEightway=e=>{e.preventDefault(),e.stopPropagation(),this.stage.stopAnimation();const t=this.stage.fresco.getSelected();if(t&&t.animation){const s=t.animation;let i=w.Z.getSegment(this.segment,t.animation);i.option.eightway=e.currentTarget.getAttribute("data");let a=v.getLayerAnimation(i.name,i.option);t.animation=w.Z.fromInjection(a,t.animation),(0,o.Z)("layer-animation",i.name),this.stage.history.add({type:"layerAnimation",kind:i.name,layer:t,animation:s})}this.updateSegment(),this.playSegment()},this.changeFiveway=e=>{e.preventDefault(),e.stopPropagation(),this.stage.stopAnimation();const t=this.stage.fresco.getSelected();if(t&&t.animation){const s=t.animation;let i=w.Z.getSegment(this.segment,t.animation);i.option.fiveway=e.currentTarget.getAttribute("data");let a=v.getLayerAnimation(i.name,i.option);t.animation=w.Z.fromInjection(a,t.animation),(0,o.Z)("layer-animation",i.name),this.stage.history.add({type:"layerAnimation",kind:i.name,layer:t,animation:s})}this.updateSegment(),this.playSegment()},this.changeFourway=e=>{e.preventDefault(),e.stopPropagation(),this.stage.stopAnimation();const t=this.stage.fresco.getSelected();if(t&&t.animation){const e=t.animation;let s=w.Z.getSegment(this.segment,t.animation);switch(s.option.fourway){case"left":s.option.fourway="up";break;case"up":s.option.fourway="right";break;case"right":s.option.fourway="down";break;case"down":s.option.fourway="left"}let i=v.getLayerAnimation(s.name,s.option);t.animation=w.Z.fromInjection(i,t.animation),(0,o.Z)("layer-animation",s.name),this.stage.history.add({type:"layerAnimation",kind:s.name,layer:t,animation:e})}this.updateSegment(),this.playSegment()},this.changeTwoway=e=>{e.preventDefault(),e.stopPropagation(),this.stage.stopAnimation();const t=this.stage.fresco.getSelected();if(t&&t.animation){const e=t.animation;let s=w.Z.getSegment(this.segment,t.animation);s.option.twoway="left"===s.option.twoway?"right":"left";let i=v.getLayerAnimation(s.name,s.option);t.animation=w.Z.fromInjection(i,t.animation),(0,o.Z)("layer-animation",s.name),this.stage.history.add({type:"layerAnimation",kind:s.name,layer:t,animation:e})}this.updateSegment(),this.playSegment()},this.enter=e=>{this.stage.stopAnimation();const t=e.currentTarget.id;if("none"===t)return;const s="page"===this.type?v.getPageAnimation(t):v.getLayerAnimation(t),i=this.prepareAnimators(s);this.stage.playAnimation(24,i)},this.playSegment=()=>{this.stage.stopAnimation();const e=this.stage.fresco.getSelected();if(e&&e.animation){const t=w.Z.getSegment(this.segment,e.animation),s=new Array(new d.Z(e,d.Z.createSegmentTransitions(t)));this.stage.playAnimation(24,s)}},this.playAll=()=>{this.stage.stopAnimation();const e=new Array,t=this.stage.fresco.getSelected();t&&t.animation&&(e.push(new d.Z(t,d.Z.createLayerTransitions(t.animation,!0))),document.addEventListener("animation-play",this.animationPlayEvent,!0),document.addEventListener("animation-step",this.animationStepEvent,!0),document.addEventListener("animation-stop",this.animationStopEvent,!0),this.stage.playAnimation(24,e))},this.prepareAnimators=(e,t=!0)=>{const s=new Array;if("page"===this.type){const t=w.Z.fromInjection(e);for(const e of this.stage.fresco.layers)if(e.animation)e.animation&&!e.animation.block&&s.push(new d.Z(e,d.Z.createLayerTransitions(e.animation)));else{const i=d.Z.createPageTransitions(e,this.stage.fresco,t);i&&i.length>0&&s.push(new d.Z(e,i))}}else for(const i of this.stage.fresco.getSelectedStack()){let t=w.Z.fromInjection(e),a=w.Z.getSegment(this.segment,t);s.push(new d.Z(i,d.Z.createSegmentTransitions(a)))}return s},this.leave=e=>{this.stage.stopAnimation()},this.selectPagePreset=e=>{this.stage.stopAnimation();let t=e.currentTarget;if(!h.ZP.user.subscription&&t.classList.contains("premium"))return void new f.Z(this.stage,"animation");let s=(0,a.ZP)("animation-presets").getElementsByClassName("apreset-page");for(var i=0;i<s.length;i++)s[i].classList.remove("selected");t.classList.add("selected");const n=t.id,r=this.stage.fresco.animation;this.stage.fresco.animation="none"===n?void 0:w.Z.fromInjection(v.getPageAnimation(n)),(0,o.Z)("page-animation",n),this.stage.history.add({type:"pageAnimation",kind:n,animation:r})},this.setPageOverride=e=>{this.unselctLayerPreset();for(const t of this.stage.fresco.getSelectedStack()){const s=t.animation;t.animation=e?new w.Z(!0):void 0,this.stage.history.add({type:"layerAnimation",kind:e?"block":"page",layer:t,animation:s})}this.setSegment(this.segment)},this.unselctLayerPreset=()=>{let e=(0,a.ZP)("animation-presets").getElementsByClassName("apreset-layer");for(var t=0;t<e.length;t++)e[t].classList.remove("selected")},this.selectLayerPreset=e=>{this.stage.stopAnimation();let t=e.currentTarget;if(!h.ZP.user.subscription&&t.classList.contains("premium"))return void new f.Z(this.stage,"animation");this.unselctLayerPreset(),t.classList.add("selected");const s=t.id;for(const i of this.stage.fresco.getSelectedStack()){const e=i.animation;if("empty"===s){switch(this.segment){case"enter":i.animation.enter=void 0;break;case"scene":i.animation.scene=void 0;break;case"exit":i.animation.exit=void 0}i.animation.enter||i.animation.scene||i.animation.exit||(i.animation=void 0)}else{let e=v.getLayerAnimation(s);i.animation=w.Z.fromInjection(e,i.animation)}(0,o.Z)("layer-animation",s),this.stage.history.add({type:"layerAnimation",kind:s,layer:i,animation:e})}this.updateSegment()},this.animationPlayEvent=e=>{(0,a.ZP)("animation-segments").classList.add("playing"),(0,a.ZP)("little-animator").classList.add("playing"),(0,a.ZP)("little-animator").setAttribute("time",e.detail),(0,a.ZP)("little-animator-progress-line").style.left="0%",(0,a.ZP)("little-animator-progress").style.display="block",(0,a.ZP)("little-animator-timer").style.display="flex",(0,a.ZP)("little-animator-elapsed").innerText="0.0s",(0,a.ZP)("little-animator-total").innerText=(0,l.M$)(e.detail),(0,a.ZP)("segment-settings").style.display="none"},this.animationStepEvent=e=>{const t=Number(e.detail),s=Number((0,a.ZP)("little-animator").getAttribute("time"));(0,a.ZP)("little-animator-elapsed").innerText=(0,l.M$)(Math.min(t,s));const i=Math.min(t/s,1);(0,a.ZP)("little-animator-progress-line").style.left=100*i+"%"},this.animationStopEvent=e=>{document.removeEventListener("animation-play",this.animationPlayEvent,!0),document.removeEventListener("animation-step",this.animationStepEvent,!0),document.removeEventListener("animation-stop",this.animationStopEvent,!0),(0,a.ZP)("little-animator").classList.remove("playing"),(0,a.ZP)("animation-segments").classList.remove("playing"),(0,a.ZP)("little-animator-timer").style.display="none",(0,a.ZP)("little-animator-progress").style.display="none",this.updateSegment()},this.cleanUp=()=>{this.stage.stopAnimation(),document.removeEventListener("layer-select",this.layerSelect,!1),document.removeEventListener("fresco-select",this.layerSelect,!1),this.superClean(),this.closeCall()},this.stage=e,this.float.id="animation-panel",this.content.id="animation-panel-content",document.addEventListener("layer-select",this.layerSelect,!1),document.addEventListener("fresco-select",this.layerSelect,!1),this.setContent(`\n            <div id="animation-panel-dock" tooltip="${(0,i.Z)("dockPanel")}" flow="down" class="icon-button">\n                <img src="/img/icon/drawer.svg" class="ic" width="18" height="18" loading="lazy">\n            </div>\n            <ul id="animation-type" class="tab-list spread">\n                <li id="tab-page">${(0,i.Z)("page")}</li>\n                <li id="tab-layer">${(0,i.Z)("layer")}</li>  \n            </ul>\n            <div id="animation-more" class="icon-button"><img src="/img/icon/three-dot.svg" class="ic"/></div> \n            <div id="animation-settings">\n                <div id="animation-segments">\n                    <div id="animation-segments-tick"></div>\n                    <div class="animation-segment enter" id="segment-enter">\n                        <img id="segment-enter-image" src="/img/icon/animation/empty.svg" class="ic">\n                        <span class="name" id="segment-enter-name">${(0,i.Z)("enter")}</span>\n                        <div class="time"><span id="segment-enter-time"></span></div>\n                        <div class="delay"><span id="segment-enter-delay"></span></div>\n                        <img id="segment-enter-remove" src="/img/icon/close.svg" class="close">\n                    </div>\n                    <div class="animation-segment scene" id="segment-scene">\n                        <img id="segment-scene-image" src="/img/icon/animation/empty.svg" class="ic">\n                        <span class="name" id="segment-scene-name">${(0,i.Z)("scene")}</span>\n                        <div class="time"><span id="segment-scene-time"></span></div>\n                        <div class="delay"><span id="segment-scene-delay"></span></div>\n                        <img id="segment-scene-remove" src="/img/icon/close.svg" class="close">\n                    </div>\n                    <div class="animation-segment exit" id="segment-exit">\n                        <img id="segment-exit-image" src="/img/icon/animation/empty.svg" class="ic">\n                        <span class="name" id="segment-exit-name">${(0,i.Z)("exit")}</span>\n                        <div class="time"><span id="segment-exit-time"></span></div>\n                        <div class="delay"><span id="segment-exit-delay"></span></div>\n                        <img id="segment-exit-remove" src="/img/icon/close.svg" class="close">\n                    </div>\n                    <div id="segment-pointer"></div>\n                    <div id="little-animator-progress">\n                        <div id="little-animator-progress-line"></div>\n                    </div>\n                </div>\n                \n                <div id="animation-settings-bar">\n                    <div id="little-animator" class="little-animator">\n                        <div id="little-animator-play" tooltip="Play animation" flow="up">\n                            <img id="little-animator-play-icon" src="/img/icon/play.svg" class="ic" width="18" height="18">\n                        </div>\n                        <div id="little-animator-stop">\n                            <img id="little-animator-stop-icon" src="/img/icon/stop.svg" class="ic" width="18" height="18">\n                        </div>\n                    </div>\n                    <div id="little-animator-timer">\n                        <span id="little-animator-elapsed"></span> / <span id="little-animator-total"></span>\n                    </div>\n                    <div id="segment-settings">\n                        \n                        <ul id="fiveway-selector" class="selector">\n                            <li data='up' tooltip="${(0,i.Z)("up")}" flow="up" class="icon-button"><img src="/img/icon/up.svg"></li>\n                            <li data='down' tooltip="${(0,i.Z)("down")}" flow="up" class="icon-button"><img src="/img/icon/down.svg"></li>\n                            <li data='center' tooltip="${(0,i.Z)("center")}" flow="up" class="icon-button"><img src="/img/icon/center.svg"></li>\n                            <li data='left' tooltip="${(0,i.Z)("left")}" flow="up" class="icon-button" ><img src="/img/icon/left.svg"></li>\n                            <li data='right' tooltip="${(0,i.Z)("right")}" flow="up" class="icon-button"><img src="/img/icon/right.svg"></li>\n                        </ul>\n                        <ul id="eightway-selector" class="selector">\n                            <li data='up' tooltip="${(0,i.Z)("up")}" flow="up" class="icon-button"><img src="/img/icon/up.svg"></li>\n                            <li data='down' tooltip="${(0,i.Z)("down")}" flow="up" class="icon-button"><img src="/img/icon/down.svg"></li>\n                            <li data='left' tooltip="${(0,i.Z)("left")}" flow="up" class="icon-button" ><img src="/img/icon/left.svg"></li>\n                            <li data='right' tooltip="${(0,i.Z)("right")}" flow="up" class="icon-button"><img src="/img/icon/right.svg"></li>\n                            <li data='upleft' tooltip="${(0,i.Z)("upleft")}" flow="up" class="icon-button"><img src="/img/icon/upleft.svg"></li>\n                            <li data='downright' tooltip="${(0,i.Z)("downright")}" flow="up" class="icon-button"><img src="/img/icon/downright.svg"></li>\n                            <li data='upright' tooltip="${(0,i.Z)("upright")}" flow="up" class="icon-button"><img src="/img/icon/upright.svg"></li>\n                            <li data='downleft' tooltip="${(0,i.Z)("downleft")}" flow="up" class="icon-button"><img src="/img/icon/downleft.svg"></li>\n                        </ul>\n                        <ul id="anchor-selector" class="selector">\n                            <li data='topleft' tooltip="${(0,i.Z)("topleft")}" flow="up" class="icon-button"><img src="/img/icon/anchor-topleft.svg"></li>\n                            <li data='top' tooltip="${(0,i.Z)("top")}" flow="up" class="icon-button"><img src="/img/icon/anchor-top.svg"></li>\n                            <li data='topright' tooltip="${(0,i.Z)("topright")}" flow="up" class="icon-button" ><img src="/img/icon/anchor-topright.svg"></li>\n                            <li data='left' tooltip="${(0,i.Z)("left")}" flow="up" class="icon-button"><img src="/img/icon/anchor-left.svg"></li>\n                            <li data='center' tooltip="${(0,i.Z)("center")}" flow="up" class="icon-button"><img src="/img/icon/anchor-center.svg"></li>\n                            <li data='right' tooltip="${(0,i.Z)("right")}" flow="up" class="icon-button"><img src="/img/icon/anchor-right.svg"></li>\n                            <li data='bottomleft' tooltip="${(0,i.Z)("bottomleft")}" flow="up" class="icon-button"><img src="/img/icon/anchor-bottomleft.svg"></li>\n                            <li data='bottom' tooltip="${(0,i.Z)("bottom")}" flow="up" class="icon-button"><img src="/img/icon/anchor-bottom.svg"></li>\n                            <li data='bottomright' tooltip="${(0,i.Z)("bottomright")}" flow="up" class="icon-button"><img src="/img/icon/anchor-bottomright.svg"></li>\n                        </ul>\n                        <div id="gap-selector" class="selector">\n                            <img src="/img/icon/gap.svg" class="ic">\n                            <input type="range" min="0" max="5000" step="100" id="gap-slider">\n                            <span id="gap-slider-out">0.0s</span>\n                        </div>\n                        <div id="delay-selector" class="selector">\n                            <img src="/img/icon/delay.svg" class="ic">\n                            <input type="range" min="0" max="20000" step="100" id="delay-slider">\n                            <span id="delay-slider-out">5.0s</span>\n                        </div>\n                        <div id="duration-selector" class="selector">\n                            <img src="/img/icon/duration.svg" class="ic">\n                            <input type="range" min="1000" max="20000" step="100" id="duration-slider">\n                            <span id="duration-slider-out">5.0s</span>\n                        </div>\n\n                        <div id="segment-options"></div>\n                        <div id="scene-settings">\n\n                            <div id="segment-gap" tooltip="${(0,i.Z)("repeatGap")}" flow="up" class="icon-button">\n                                <img src="/img/icon/gap.svg" class="ic">\n                                <span id="segment-gap-time">0.0s</span>\n                            </div>\n\n                            <div id="segment-repeat" tooltip="${(0,i.Z)("repeat")}" flow="up" class="icon-button">\n                                <img src="/img/icon/repeat.svg" class="ic">\n                                <span id="segment-repeat-amount"></span>\n                            </div>\n                            <div class="aset-line"></div>\n                        </div>\n\n                        <div id="segment-speed" tooltip="${(0,i.Z)("speed")}" flow="up" class="icon-meter">\n                            <img src="/img/icon/speed.svg" class="ic"><img src="/img/icon/speed.svg" class="ic"><img src="/img/icon/speed.svg" class="ic">\n                        </div>\n\n                        <div class="aset-line"></div>\n\n                        <div id="segment-delay" tooltip="${(0,i.Z)("delay")}" flow="up" class="icon-button">\n                            <img src="/img/icon/delay.svg" class="ic">\n                            <span id="segment-delay-time"></span>\n                        </div>\n                        <div id="segment-duration" tooltip="${(0,i.Z)("duration")}" flow="up-left" class="icon-button">\n                            <img src="/img/icon/duration.svg" class="ic">\n                            <span id="segment-duration-time"></span>\n                        </div>\n                    </div>\n                </div>\n            </div>\n            <div id="animation-preset-content">\n                <div id="animation-presets" style="width:100%"></div>\n            </div>\n         `),(0,a.ZP)("animation-panel-dock").addEventListener("click",this.dock,!1),(0,a.ZP)("tab-page").addEventListener("click",this.selectType,!1),(0,a.ZP)("tab-layer").addEventListener("click",this.selectType,!1),(0,a.ZP)("animation-more").addEventListener("click",this.more,!1),(0,a.ZP)("animation-segments").addEventListener("contextmenu",this.more,!0),(0,a.ZP)("little-animator-play").addEventListener("click",this.playAll,!1),(0,a.ZP)("little-animator-stop").addEventListener("click",this.stage.stopAnimation,!1),(0,a.ZP)("segment-enter").addEventListener("click",this.selectSegment,!1),(0,a.ZP)("segment-scene").addEventListener("click",this.selectSegment,!1),(0,a.ZP)("segment-exit").addEventListener("click",this.selectSegment,!1),(0,a.ZP)("segment-enter-remove").addEventListener("click",(()=>this.removeSegment("enter")),!1),(0,a.ZP)("segment-scene-remove").addEventListener("click",(()=>this.removeSegment("scene")),!1),(0,a.ZP)("segment-exit-remove").addEventListener("click",(()=>this.removeSegment("exit")),!1),(0,a.ZP)("segment-speed").addEventListener("click",this.changeSpeed,!1),(0,a.ZP)("segment-repeat").addEventListener("click",this.changeRepeat,!1),(0,a.ZP)("segment-delay").addEventListener("click",(()=>this.showSelector("delay"))),(0,a.ZP)("segment-gap").addEventListener("click",(()=>this.showSelector("gap"))),(0,a.ZP)("segment-duration").addEventListener("click",(()=>{(0,a.ZP)("segment-duration").classList.contains("no-drop")||this.showSelector("duration")})),(0,a.ZP)("gap-slider").addEventListener("change",this.changeGap,!1),(0,a.ZP)("gap-slider").addEventListener("input",(e=>{(0,a.ZP)("gap-slider-out").innerText=(0,l.M$)(Number((0,a.ZP)("gap-slider").value))}),!1),(0,a.ZP)("delay-slider").addEventListener("change",this.changeDelay,!1),(0,a.ZP)("delay-slider").addEventListener("input",(e=>{(0,a.ZP)("delay-slider-out").innerText=(0,l.M$)(Number((0,a.ZP)("delay-slider").value))}),!1),(0,a.ZP)("duration-slider").addEventListener("change",this.changeDuration,!1),(0,a.ZP)("duration-slider").addEventListener("input",(()=>{(0,a.ZP)("duration-slider-out").innerText=(0,l.M$)(Number((0,a.ZP)("duration-slider").value))}),!1),(0,a.ZP)("eightway-selector").childNodes.forEach((e=>e.addEventListener("click",this.changeEightway,!1))),(0,a.ZP)("fiveway-selector").childNodes.forEach((e=>e.addEventListener("click",this.changeFiveway,!1))),(0,a.ZP)("anchor-selector").childNodes.forEach((e=>e.addEventListener("click",this.changeAnchor,!1))),new c.Z((0,a.ZP)("animation-preset-content")),this.layerSelect()}}},3799:(e,t,s)=>{s.d(t,{Z:()=>r});var i=s(6548),a=s(3673),n=s(3947),o=s(4178);class r{constructor(e,t){this.stage=e,this.active=t,this.dragStart=e=>{this.p=e,this.d=new a.Z(this.panel.offsetLeft,this.panel.offsetTop)},this.dragMove=e=>{this.panel.style.left=Math.round(this.d.x+(e.x-this.p.x))+"px",this.panel.style.top=Math.round(this.d.y+(e.y-this.p.y))+"px"},this.dragEnd=e=>{let t=Math.round(this.d.y+(e.y-this.p.y)),s=Math.round(this.d.x+(e.x-this.p.x));t<76&&(t=76),s<0&&(s=0),s+120>(0,n.ZP)("workspace").offsetWidth&&(s=(0,n.ZP)("workspace").offsetWidth-240),this.panel.style.left=s+"px",this.panel.style.top=t+"px"},this.resizeStart=e=>{this.d=new a.Z(this.panel.clientHeight,e.y)},this.resizeMove=e=>{const t=this.d.x+(e.y-this.d.y);this.panel.style.height=(t<120?120:t)+"px"},this.activate=e=>{this.panel.classList.toggle("active",e),e&&this.panel.classList.remove("collapse"),this.active=e,this.render()},this.render=()=>{if(!this.active||!this.stage.fresco||!this.stage.history)return;const e=this.stage.history.undos(!1),t=this.stage.history.undos(!0),s=e.length+t.length,a=e=>()=>this.stage.history.jump(e-s),o=e=>()=>this.stage.history.jump(e),r=e.map(((e,t)=>{const s=h(e,!1);return(0,n.T)("li",(0,n.T)("div",{className:"history-item",onclick:a(t+1)},(0,n.T)("div",s.title),(0,n.T)("img",{src:`/img/tool/${s.icon}.svg`,className:"ic"})))}));if(0===t.length&&r.length>0){const e=r[r.length-1].querySelector(".history-item");e.classList.add("selected"),e.children[1].classList.remove("ic"),e.onclick=void 0}const l=this.stage.history.redos(!1);r.push(...l.map(((e,t)=>{const s=h(e,!1);return(0,n.T)("li",(0,n.T)("div",{className:"history-item redo",onclick:o(t+1)},(0,n.T)("div",s.title),(0,n.T)("img",{src:`/img/tool/${s.icon}.svg`,className:"ic"})))})));const c=this.stage.history.getActiveTransaction();if(c){const s=t.map(((s,i)=>{const o=h(s,!0);return i===t.length-1?(0,n.T)("li",{className:"selected"},o.title,(0,n.T)("img",{src:`/img/tool/${o.icon}.svg`})):(0,n.T)("li",{onclick:a(e.length+i+1)},o.title,(0,n.T)("img",{src:`/img/tool/${o.icon}.svg`,className:"ic"}))})),d=this.stage.history.redos(!0);s.push(...d.map(((e,t)=>{const s=h(e,!0);return(0,n.T)("li",{className:"redo",onclick:o(l.length+t+1)},s.title,(0,n.T)("img",{src:`/img/tool/${s.icon}.svg`,className:"ic"}))})));const u=function(e){switch(e){case"arrange":case"arrangeStack":return{title:(0,i.Z)("historyArrange"),icon:"thick/arrange"};case"textSettings":return{title:(0,i.Z)("historyText"),icon:"text"};case"frameSettings":return{title:(0,i.Z)("historyFrame"),icon:"frame"};case"shapeSettings":return{title:(0,i.Z)("historyShape"),icon:"shape"};case"pageAnimation":return{title:(0,i.Z)("historyPageAnimation"),icon:"animation"};case"layerAnimation":return{title:(0,i.Z)("historyLayerAnimation"),icon:"animation"};default:return{title:e,icon:e}}}(c.type);r.push((0,n.T)("li",(0,n.T)("div",{className:"history-item local "+(0===t.length?"redo":"")},(0,n.T)("div",u.title),(0,n.T)("img",{src:`/img/tool/${u.icon}.svg`,className:"ic"})),(0,n.T)("ol",{className:"history-local"},...s)))}this.list.innerHTML="",this.list.append(...r);let d=this.list.querySelector(".selected");d&&d.scrollIntoView({behavior:"auto",block:"nearest",inline:"nearest"})},this.panel=(0,n.ZP)("history-panel"),this.panel.classList.toggle("active",t),this.list=(0,n.ZP)("history-list"),new o.Z((0,n.ZP)("history-panel-content")),document.addEventListener("history-update",this.render,!1),(0,n.ZP)("history-minimize").addEventListener("pointerdown",(e=>{e.stopPropagation(),(0,n.ZP)("history-panel").classList.toggle("collapse")}),!0),(0,n.ZP)("history-close").addEventListener("pointerdown",(e=>{e.stopPropagation(),document.dispatchEvent(new CustomEvent("panel-state",{detail:"history-panel"}))}),!0);const s=(0,n.T)("img",{id:"layer-panel-resize",src:"/img/icon/three-dot.svg",className:"resize ic"});(0,n.Rg)(s,this.resizeStart,this.resizeMove),this.panel.append(s),(0,n.Rg)((0,n.ZP)("history-panel-title"),this.dragStart,this.dragMove,this.dragEnd)}}function h(e,t){switch(e.type){case"addLayer":{let t="empty",s=(e.kind||"").charAt(0).toUpperCase()+(e.kind||"").substring(1);switch(e.kind){case"addimage":case"pasteimage":case"duplicateimage":t="image";break;case"addtext":case"pastetext":case"duplicatetext":t="text";break;case"addframe":case"pasteframe":case"duplicateframe":t="frame";break;case"addshape":case"pasteshape":case"duplicateshape":t="shape";break;case"addelement":case"pasteelement":case"duplicateelement":t="element"}return{title:(0,i.Z)(`history${s}`),icon:t}}case"order":return{title:(0,i.Z)("historyOrder"),icon:"menu"};case"textSettings":{let t="menu",s=(e.kind||"").charAt(0).toUpperCase()+(e.kind||"").substring(1);return{title:(0,i.Z)("historyText"+s),icon:t}}case"textChange":return{title:(0,i.Z)("historyTextChange"),icon:"menu"};case"bitmapSwitch":case"bitmapChange":{if(!e.kind)return{title:(0,i.Z)("bitmapChange"),icon:"image"};if("eff"===e.kind.substr(0,3)){const t=e.kind.split(" - ")[1];return{title:(0,i.Z)("historyEffect",t),icon:"effect"}}let t="menu",s=(e.kind||"").charAt(0).toUpperCase()+(e.kind||"").substring(1);switch(e.kind){case"adjust":t="adjust";break;case"transform":t="transform";break;case"distort":t="distort";break;case"shadow":case"shape":t="thick/shape";break;case"draw":t="thick/draw";break;case"fill":t="thick/fill";break;case"gradient":case"lookup":t="thick/gradient";break;case"pen":t="thick/pen";break;case"temper":t="thick/temper";break;case"detail":t="thick/detail";break;case"toning":t="thick/toning";break;case"eraser":t="thick/eraser";break;case"clone":t="thick/clone";break;case"liquify":t="thick/liquify";break;case"healPatch":case"healInfill":t="thick/heal";break;case"glitch":t="thick/glitch";break;case"focus":t="thick/focus";break;case"disperse":t="thick/disperse";break;case"dispersion":t="thick/dispersion";break;case"auto":t="auto";break;case"brightnessContrast":t="contrast";break;case"temperatureTint":t="temperature";break;case"hueSaturation":case"desaturate":t="saturation";break;case"vibrance":t="vibrance";break;case"mimicHDR":t="hdr";break;case"highlightsShadows":t="highlights";break;case"exposure":t="exposure";break;case"curves":case"levels":case"rgbSplit":t="hue";break;case"posterize":t="posterize";break;case"monochrome":t="monochrome";break;case"sharpen":t="sharpen";break;case"clarity":t="clarity";break;case"blur":case"gaussian":case"motionblur":case"zoom":t="blur";break;case"smooth":t="smooth";break;case"grain":case"noise":case"denoise":t="grain";break;case"fringe":t="fringe";break;case"vignette":t="vignette";break;case"bloom":t="bloom";break;case"glamour":t="glamour";break;case"dehaze":t="dehaze";break;case"pixelate":t="pixelate";break;case"mosaic":t="mosaic";break;case"halftone":t="halftone"}return{title:(0,i.Z)(`history${s}`),icon:t}}case"crop":return{title:(0,i.Z)("historyCrop"),icon:"thick/crop"};case"straighten":return{title:(0,i.Z)("historyStraighten"),icon:"thick/crop"};case"deleteLayer":return{title:(0,i.Z)(`historyDelete${e.layer.type}`),icon:"delete"};case"arrange":{let t=(e.kind||"").charAt(0).toUpperCase()+(e.kind||"").substring(1);return{title:(0,i.Z)(`history${t}`),icon:"thick/arrange"}}case"arrangeStack":{let t=(e.kind||"").charAt(0).toUpperCase()+(e.kind||"").substring(1);return{title:(0,i.Z)(`historyStack${t}`),icon:"thick/arrange"}}case"flipLayer":case"flip":return{title:(0,i.Z)("historyFlip"),icon:"menu"};case"rotateLayer":case"rotate":return{title:(0,i.Z)("historyRotate"),icon:"menu"};case"layerSettings":return{title:(0,i.Z)(`historyLayer${e.kind.charAt(0).toUpperCase()+e.kind.substring(1)}`),icon:"menu"};case"background":return{title:(0,i.Z)("historyBackground"),icon:"thick/picker"};case"pageSize":return{title:(0,i.Z)("historyPageSize"),icon:"menu"};case"pageResize":return{title:(0,i.Z)("historyPageResize"),icon:"menu"};case"mask":return{title:(0,i.Z)("historyMask"),icon:"thick/cutout"};case"maskInvert":return{title:(0,i.Z)("historyMaskInvert"),icon:"thick/cutout"};case"merge":return{title:(0,i.Z)("historyMerge"),icon:"menu"};case"adjust":return{title:(0,i.Z)("history"+e.kind.charAt(0).toUpperCase()+e.kind.substring(1)),icon:e.kind};case"glitch":return{title:(0,i.Z)("historyGlitch"+e.kind.charAt(0).toUpperCase()+e.kind.substring(1)),icon:e.kind};case"effect":return{title:e.kind.charAt(0).toUpperCase()+e.kind.substring(1),icon:"effect"};case"selectionAndBitmapSwitch":case"selectionChange":{let t="thick/marquee",s=e.kind;switch(e.kind){case"lasso":s="Lasso",t="thick/lasso";break;case"wand":s="Wand",t="thick/wand";break;case"marquee":s="Marquee",t="thick/marquee";break;case"move":s="SelectionMove";break;case"invert":s="SelectionInvert";break;case"pixels":s="SelectionPixels";break;case"all":s="SelectionAll";break;case"restore":s="SelectionRestore";break;case"deselect":s="Deselect";break;case"cut":s="SelectionCut";break;case"copy":s="SelectionCopy"}return{title:(0,i.Z)(`history${s}`),icon:t}}case"open":return{title:(0,i.Z)("historyOpen"),icon:"menu"};case"rasterize":return{title:(0,i.Z)("historyRasterize"+e.kind),icon:"menu"};case"convertSelectionToMask":return{title:(0,i.Z)("historyConvertSelectionToMask"),icon:"thick/cutout"};case"convertMaskToSelection":return{title:(0,i.Z)("historyConvertMaskToSelection"),icon:"thick/marquee"};case"applyMask":return{title:(0,i.Z)("historyApplyMask"),icon:"menu"};case"frameContent":{let t=(e.kind||"").charAt(0).toUpperCase()+(e.kind||"").substring(1);return{title:(0,i.Z)("historyFrameContent"+t),icon:"image"}}case"frameSettings":{let t=(e.kind||"").charAt(0).toUpperCase()+(e.kind||"").substring(1);return{title:(0,i.Z)("historyFrame"+t),icon:"frame"}}case"shapeSettings":{let t=(e.kind||"").charAt(0).toUpperCase()+(e.kind||"").substring(1);return{title:(0,i.Z)("historyShape"+t),icon:"shape"}}case"pageAnimation":return{title:t?e.kind.charAt(0).toUpperCase()+e.kind.substring(1):(0,i.Z)("historyPageAnimation"),icon:"animation"};case"layerAnimation":return{title:t?e.kind.charAt(0).toUpperCase()+e.kind.substring(1):(0,i.Z)("historyLayerAnimation"),icon:"animation"};default:}}},9575:(e,t,s)=>{s.d(t,{Z:()=>m});var i=s(6548),a=s(3655),n=s(6817),o=s(4188),r=s(3673),h=s(4820),l=s(3947),c=s(4178),d=s(2282),u=s(3868),p=s(5934);class g extends u.Z{constructor(e){super((0,i.Z)("dialogAddLayerTitle"),!0),this.rotation=0,this.maxSize=1920,this.checkNeverAskAgain=()=>{(0,l.ZP)("add-layer-never-ask-again").checked&&(0,h.Lt)("askToAddLayer",!1)},this.addLayerChoice=async e=>{e.stopPropagation(),this.checkNeverAskAgain();let t="x"===h.ZP.product;switch(e.currentTarget.getAttribute("data")){case"text":this.stage.addText(),document.dispatchEvent(new CustomEvent("select-tool",{detail:t?"arrange":"text"})),this.stage.reform&&this.stage.reform.dblClick();break;case"image":await(0,p.Q0)(!0).then((async e=>{document.dispatchEvent(new CustomEvent("loading",{detail:"start"}));for(let t=0;t<e.length;t++)await(0,p.ZB)(this.stage,e[t],!1);document.dispatchEvent(new CustomEvent("loading",{detail:"stop"})),document.dispatchEvent(new CustomEvent("select-tool",{detail:"arrange"}))}));break;case"shape":this.stage.addShape(),document.dispatchEvent(new CustomEvent("select-tool",{detail:t?"arrange":"shape"}));break;case"frame":this.stage.addFrame(),document.dispatchEvent(new CustomEvent("select-tool",{detail:t?"arrange":"frame"}));break;case"empty":this.stage.addEmpty(),this.stage.notify("layerAdded")}this.cleanUp()},this.stage=e,this.dialog.style.width="500px",this.dialog.style.maxWidth="500px",this.setContent(`\n            <label class="pad-0">${(0,i.Z)("dialogAddLayerHL")}</label>\n\n            <ul id="add-layer-type" class="push-buttons small pad-20">\n                <li id="add-layer-empty" data="empty"><img src="/img/tool/empty.svg" class="ic"><span>${(0,i.Z)("empty")}</span></li>\n                <li id="add-layer-image" data="image"><img src="/img/tool/image.svg" class="ic"><span>${(0,i.Z)("image")}</span></li>\n                <li id="add-layer-frame" data="frame"><img src="/img/tool/frame.svg" class="ic"><span>${(0,i.Z)("frame")}</span></li>\n                <li id="add-layer-text" data="text"><img src="/img/tool/text.svg" class="ic"><span>${(0,i.Z)("text")}</span></li>\n                <li id="add-layer-shape" data="shape"><img src="/img/tool/shape.svg" class="ic"><span>${(0,i.Z)("shape")}</span></li>\n            </ul>\n            <input type="checkbox" id="add-layer-never-ask-again" />\n            <label class="switch pad-20" for="add-layer-never-ask-again">${(0,i.Z)("neverAskMeAgain")}<span></span></label>\n        `),(0,l.ZP)("add-layer-empty").addEventListener("click",this.addLayerChoice,!0),(0,l.ZP)("add-layer-image").addEventListener("click",this.addLayerChoice,!0),(0,l.ZP)("add-layer-text").addEventListener("click",this.addLayerChoice,!0),(0,l.ZP)("add-layer-frame").addEventListener("click",this.addLayerChoice,!0),(0,l.ZP)("add-layer-shape").addEventListener("click",this.addLayerChoice,!0),(0,l.ZP)("dialog-apply"+this.mid).style.display="none"}}class m{constructor(e,t){this.stage=e,this.active=t,this.isDown=!1,this.isRight=!1,this.stamp=(new Date).getTime(),this.dragStart=e=>{this.p=e,this.d=new r.Z(this.panel.offsetLeft,this.panel.offsetTop)},this.dragMove=e=>{this.panel.style.left=Math.round(this.d.x+(e.x-this.p.x))+"px",this.panel.style.top=Math.round(this.d.y+(e.y-this.p.y))+"px"},this.dragEnd=e=>{let t=Math.round(this.d.y+(e.y-this.p.y)),s=Math.round(this.d.x+(e.x-this.p.x));t<76&&(t=76),s<0&&(s=0),s+120>(0,l.ZP)("workspace").offsetWidth&&(s=(0,l.ZP)("workspace").offsetWidth-240),this.panel.style.left=s+"px",this.panel.style.top=t+"px"},this.resizeStart=e=>{this.d=new r.Z(this.panel.clientHeight,e.y)},this.resizeMove=e=>{const t=this.d.x+(e.y-this.d.y);this.panel.style.height=(t<120?120:t)+"px"},this.activate=e=>{this.panel.classList.toggle("active",e),e&&this.panel.classList.remove("collapse"),this.active=e,this.render()},this.addLayer=e=>{h.ZP.askToAddLayer?new g(this.stage):this.stage.addEmpty()},this.delay=!1,this.addLayerChoice=async e=>{if(e.stopPropagation(),!this.delay){this.delay=!0;try{switch(e.currentTarget.getAttribute("data")){case"text":this.stage.addText(),document.dispatchEvent(new CustomEvent("select-tool",{detail:"text"})),this.stage.reform&&this.stage.reform.dblClick();break;case"image":this.delay=!1,await(0,p.Q0)(!0).then((async e=>{document.dispatchEvent(new CustomEvent("loading",{detail:"start"}));for(let t=0;t<e.length;t++)await(0,p.ZB)(this.stage,e[t],!1);document.dispatchEvent(new CustomEvent("loading",{detail:"stop"})),document.dispatchEvent(new CustomEvent("select-tool",{detail:"arrange"}))}));break;case"shape":this.stage.addShape(),document.dispatchEvent(new CustomEvent("select-tool",{detail:"shape"}));break;case"frame":this.stage.addFrame(),document.dispatchEvent(new CustomEvent("select-tool",{detail:"frame"}));break;case"empty":this.stage.addEmpty(),this.stage.notify("layerAdded")}}catch(t){}a.Ds("add-layer",500,(()=>{this.delay=!1}))}},this.changeName=()=>{this.stamp=(new Date).getTime();let e=this.stage.fresco.getLayerById(this.settingsId),t=Object.assign({},e.settings);const s=(0,l.ZP)("layer-settings-name").value;e.settings.name!==s&&(e.settings.name=s,this.stage.history.add({type:"layerSettings",kind:"name",layer:e,settings:t}),(0,l.ZP)(e.id+"-name")&&((0,l.ZP)(e.id+"-name").innerHTML=e.settings.name+"<span>"+(0,i.Z)(e.type)+"</span>"))},this.changeBlendMode=()=>{this.stamp=(new Date).getTime();let e=this.stage.fresco.getLayerById(this.settingsId),t=Object.assign({},e.settings);e.settings.blendmode=(0,l.ZP)("layer-settings-blend-mode").value,this.stage.history.add({type:"layerSettings",kind:"blendMode",layer:e,settings:t}),document.dispatchEvent(new CustomEvent("viewport-render"))},this.changeLocked=e=>{this.stamp=(new Date).getTime();const t=(0,l.ZP)("layer-settings-locked-true").checked;this.stage.changeLocked(void 0,t)},this.changeVisible=e=>{this.stamp=(new Date).getTime();let t=this.stage.fresco.getLayerById(this.settingsId);const s=(0,l.ZP)("layer-settings-visible-true").checked;this.stage.changeVisible(t,s)},this.markSelected=e=>{if(this.isRight||(this.settingsId="",(0,l.ZP)("layer-settings").style.display="none"),void 0===e&&"block"===(0,l.ZP)("layer-settings").style.display&&this.toggleSettings(),this.stage&&this.stage.fresco&&(0,l.ZP)("layer-panel")){let e=(0,l.ZP)("layer-list").getElementsByClassName("layer");for(var t=0;t<e.length;t++)e[t].classList.toggle("selected",this.stage.fresco.isSelectedById(e[t].id))}},this.render=e=>{if(!this.active||!this.stage||this.stage.supressRender)return;if(this.isDown&&!this.stage.layerDrag)return;const t=(0,l.ZP)("layer-list");for((new Date).getTime()-this.stamp>1e3&&(this.settingsId="",(0,l.ZP)("layer-settings").style.display="none");t.lastChild;)t.removeChild(t.lastChild);if(this.stage.fresco){const e=n.Z.bestFit(this.stage.fresco.width,this.stage.fresco.height,32,32),o=e.width/this.stage.fresco.width,r=this.stage.fresco.width,h=this.stage.fresco.height;for(var s=this.stage.fresco.layers.length-1;s>=0;s--){const c=this.stage.fresco.layers[s],u=this.stage.fresco.isSelectedById(c.id);let p=(0,l.T)("div",{id:c.id,className:"layer"});u&&p.classList.add("selected"),c.settings.visible||p.classList.add("hidden");let g=a.vL(e.width,e.height);if(c.canvas){let t=g.getContext("2d");if(c.rect.width/r>.5||c.rect.height/h>.5)t.scale(o,o),this.stage.renderLayer(t,c,!0);else{t.translate(e.width/2,e.height/2),t.imageSmoothingEnabled=!0,t.imageSmoothingQuality="high",t.rotate(c.rect.rotation*Math.PI/180);const s=n.Z.bestFit(c.rect.width,c.rect.height,e.width-8,e.height-8);t.drawImage(c.baked?c.baked:c.canvas,-s.width/2,-s.height/2,Math.max(s.width,1),Math.max(s.height,1))}}p.appendChild((0,l.T)("div",{className:"vertical-align thumb"},g));let m=(0,l.T)("div",{id:c.id+"-name",className:"name"},c.settings.name,(0,l.T)("span",(0,i.Z)(c.type)));if(p.appendChild(m),c.settings.locked&&!c.settings.visible||!c.settings.locked){const e=(0,l.T)("img",{className:"visibility ic",title:c.settings.visible?(0,i.Z)("visible"):(0,i.Z)("hidden"),src:c.settings.visible?"/img/icon/visible.svg":"/img/icon/hidden.svg"});e.addEventListener("mousedown",(e=>{e.stopPropagation(),e.preventDefault()}),!0),e.addEventListener("click",(e=>{e.stopPropagation(),e.preventDefault(),this.stage.changeVisible(c,!c.settings.visible)}),!1),p.appendChild((0,l.T)("div",{className:"right"},e))}else{let e=(0,l.T)("img",{src:"/img/icon/locked.svg",className:"locked ic",title:(0,i.Z)("locked")});e.addEventListener("mousedown",(e=>{e.stopPropagation(),e.preventDefault()}),!0),e.addEventListener("click",(e=>{e.stopPropagation(),e.preventDefault(),this.stage.changeLocked(c,!1)}),!1),p.appendChild((0,l.T)("div",{className:"right"},e))}let v=(0,l.T)("div",{className:"icons"});if(p.appendChild(v),c.animation){const e=(0,l.T)("img",{src:c.animation.block?"/img/icon/animation/none.svg":"/img/icon/animation/animation.svg",title:(0,i.Z)("animation"),className:"animation ic"});e.addEventListener("mousedown",(()=>{document.dispatchEvent(new CustomEvent("panel-animation"))})),v.appendChild(e)}if(c instanceof d.Z&&c.hasMask()){const e=(0,l.T)("img",{src:"/img/icon/mask.svg",title:(0,i.Z)("hasCutout"),className:"cutout ic"});e.addEventListener("mousedown",(()=>{document.dispatchEvent(new CustomEvent("select-tool",{detail:"cutout"}))})),e.addEventListener("dblclick",(()=>{this.stage.maskApply()})),v.appendChild(e)}p.addEventListener("mousedown",this.mouseDown,!1),p.addEventListener("touchstart",this.touchStart,{passive:!1}),t.appendChild(p)}}},this.settingsId="",this.toggleSettings=e=>{null==e||e.preventDefault(),null==e||e.stopPropagation();let t=this.stage.fresco.getSelected();t&&(t.id!==this.settingsId?((0,l.ZP)("layer-settings").style.display="block",this.settingsId=t.id,this.opacity.setValue(t.settings.opacity),(0,l.ZP)("layer-settings-name").value=t.settings.name,(0,l.ZP)("layer-settings-blend-mode").value=t.settings.blendmode,(0,l.ZP)("layer-settings-visible-true").checked=t.settings.visible,(0,l.ZP)("layer-settings-visible-false").checked=!t.settings.visible,(0,l.ZP)("layer-settings-locked-true").checked=t.settings.locked,(0,l.ZP)("layer-settings-locked-false").checked=!t.settings.locked,window.requestAnimationFrame((()=>{let t=(0,l.ZP)("layer-settings");const s=t.getBoundingClientRect(),i=a.HS(e.target),n=a.HS(this.panel),o=(0,l.ZP)("layer-panel-content-ss-content").scrollTop;let r=i.y-n.y+(0,l.ZP)("panel-bar").clientTop-o;n.y+r+s.height>(0,l.ZP)("workspace").clientHeight&&(r=(0,l.ZP)("workspace").clientHeight-n.y-s.height-4),t.style.top=r-32+"px"}))):this.hideSettings())},this.hideSettings=()=>{this.isRight=!1,this.settingsId="",(0,l.ZP)("layer-settings").style.display="none",document.dispatchEvent(new CustomEvent("layer-arrange"))},this.touchStart=e=>{1!==e.touches.length&&(e.preventDefault(),e.stopPropagation(),this.down(e.touches[0].clientX,e.touches[0].clientY,e.currentTarget,e.shiftKey||e.ctrlKey),this.stage.fresco.getSelected()&&(document.addEventListener("touchmove",this.touchMove,{passive:!1}),document.addEventListener("touchend",this.touchEnd,{passive:!1})))},this.touchMove=e=>{1!==e.touches.length&&(e.preventDefault(),e.stopPropagation(),this.move(e.touches[0].clientX,e.touches[0].clientY))},this.touchEnd=e=>{e.preventDefault(),e.stopPropagation(),this.up(e.touches[0].clientX,e.touches[0].clientY),document.removeEventListener("touchmove",this.touchMove),document.removeEventListener("touchend",this.touchEnd)},this.mouseDown=e=>{"INPUT"!==document.activeElement.nodeName&&"SELECT"!==document.activeElement.nodeName&&(e.stopPropagation(),this.down(e.clientX,e.clientY,e.currentTarget,e.shiftKey||e.ctrlKey),e.button>0?this.isRight=!0:(this.isRight=!1,(0,l.ZP)("layer-settings").style.display="none",this.stage.fresco.getSelected()&&(document.addEventListener("mousemove",this.mouseMove,!0),document.addEventListener("mouseup",this.mouseUp,!0),(0,l.ZP)("layer-panel").classList.add("down"),this.isDown=!0)))},this.mouseMove=e=>{e.button>0||(e.stopPropagation(),this.move(e.clientX,e.clientY))},this.mouseUp=e=>{e.stopPropagation(),this.up(e.clientX,e.clientY),document.removeEventListener("mousemove",this.mouseMove,!0),document.removeEventListener("mouseup",this.mouseUp,!0)},this.down=(e,t,s,i)=>{this.downY=t,this.heightY=(0,l.ZP)("layer-panel-content-ss-content").scrollHeight,(i||this.stage.fresco.isSelectedStack()||!this.stage.fresco.isSelectedById(s.id))&&(i&&this.stage.fresco.isSelectedById(s.id)?this.stage.unselectLayerById(s.id):this.stage.selectLayerById(s.id,i,!0))},this.pointInLayerPanel=(e,t)=>{const s=(0,l.ZP)("layer-list").getBoundingClientRect();return e>=s.x&&e<=s.x+s.width&&t>=s.y&&t<=s.y+s.height},this.move=(e,t)=>{const s=(0,l.ZP)("layer-list");if(!this.pointInLayerPanel(e,t)){if(this.ghost){this.ghost.classList.remove("ghost"),this.ghost.style.left="unset",this.ghost.style.top="unset",this.ghostFill.remove();const e=this.stage.fresco.layers.length-this.stage.fresco.selectedLayerNr()-1;s.children[e].before(this.ghost),this.ghost=null,this.ghostFill=null}if(!this.stage.layerDrag){const s=this.stage.fresco.getSelected(),i=(0,l.ZP)(s.id);this.stage.layerDrag={fresco:this.stage.fresco.id,layer:s,node:(0,l.T)("div",{className:"grabbed-layer"},(0,l.T)("div",{className:"thumb"},a.dN(i.querySelector("canvas"))),(0,l.T)("div",s.settings.name)),position:new r.Z(e,t),blocked:this.stage.fresco.block},this.stage.workspace.append(this.stage.layerDrag.node),document.body.style.cursor="move"}const i=this.stage.layerDrag.node.getBoundingClientRect();return this.stage.layerDrag.node.style.left=e-i.width/2+"px",this.stage.layerDrag.node.style.top=t-i.height/2+"px",this.stage.layerDrag.position=new r.Z(e,t),void document.dispatchEvent(new CustomEvent("layer-drag-move"))}if(this.stage.layerDrag){if(this.stage.coating.clear(),document.body.style.cursor="unset",this.stage.layerDrag.fresco!==this.stage.fresco.id){const s=this.stage.layerDrag.node.getBoundingClientRect();return this.stage.layerDrag.node.style.left=e-s.width/2+"px",this.stage.layerDrag.node.style.top=t-s.height/2+"px",void(this.stage.layerDrag.position=new r.Z(e,t))}this.stage.layerDrag.node.remove(),this.stage.layerDrag=null}this.ghost||(this.ghost=(0,l.ZP)(this.stage.fresco.getSelected().id),this.startY=this.ghost.offsetTop-1,this.ghost.style.left=this.ghost.offsetLeft+"px",this.ghostFill=document.createElement("div"),this.ghostFill.id="ghost-fill",this.ghost.before(this.ghostFill),this.ghost.classList.add("ghost"),s.appendChild(this.ghost)),-1===this.startY&&(this.startY=this.ghost.offsetTop-4,this.downY=t),this.ghost.style.top=this.startY-(this.downY-t)+"px",this.moveGhostFill(),window.clearTimeout(this.auto);let i=(0,l.ZP)("layer-panel-content-ss-content");this.ghost.offsetTop<i.scrollTop-5?this.autoScroll(-20):this.ghost.offsetTop+this.ghost.offsetHeight>i.scrollTop+i.offsetHeight+5&&this.autoScroll(20)},this.moveGhostFill=()=>{this.ghost.offsetTop>this.ghostFill.offsetTop+this.ghostFill.offsetHeight/2+2?this.ghostFill.nextElementSibling.classList.contains("selected")||this.ghostFill.nextElementSibling.after(this.ghostFill):this.ghost.offsetTop<this.ghostFill.offsetTop-this.ghostFill.offsetHeight/2-2&&this.ghostFill.previousElementSibling&&this.ghostFill.previousElementSibling.before(this.ghostFill)},this.autoScroll=e=>{window.clearTimeout(this.auto);const t=(0,l.ZP)("layer-panel-content-ss-content"),s=()=>{this.ghost&&(e<0&&t.scrollTop>10||e>0&&t.scrollTop+10<this.heightY-t.clientHeight)&&(this.startY=-1,t.scrollTop+=e,this.ghost.style.top=this.ghost.offsetTop-1+e+"px",this.moveGhostFill(),this.auto=window.setTimeout(s,80))};this.auto=window.setTimeout(s,80)},this.up=(e,t)=>{this.isDown=!1,(0,l.ZP)("layer-panel").classList.remove("down"),document.body.style.cursor="unset",this.stage.layerDrag&&(this.pointInLayerPanel(e,t)||document.dispatchEvent(new CustomEvent("layer-drag-drop")),this.stage.layerDrag.node.remove(),this.stage.layerDrag=void 0),this.ghost&&(this.ghost.classList.remove("ghost"),this.ghost.style.left="0px",this.ghost.style.top="0px",this.ghostFill.before(this.ghost),this.ghostFill.remove(),this.ghost=void 0,this.ghostFill=void 0);let s=this.stage.fresco.selectedLayerNr(),i=(0,l.ZP)("layer-list").getElementsByClassName("layer");const a=this.stage.fresco.getSelected();for(var n=0;n<i.length;n++)if(i[n].id===a.id){let e=i.length-n-1;e!=s&&this.stage.changeOrder(s,e);break}},this.panel=(0,l.ZP)("layer-panel"),this.panel.classList.toggle("active",t),document.addEventListener("layer-list-render",(()=>this.render()),!0),document.addEventListener("layer-select",(()=>this.markSelected()),!1),(0,l.ZP)("layer-panel-add").addEventListener("click",this.addLayer,!1),(0,l.ZP)("layer-panel-copy").addEventListener("click",(()=>this.stage.duplicateLayer()),!1),(0,l.ZP)("layer-panel-delete").addEventListener("click",(()=>this.stage.deleteLayer()),!1),(0,l.ZP)("layer-panel-more").addEventListener("click",(e=>this.toggleSettings(e)),!0),(0,l.ZP)("layer-panel-more").addEventListener("pointerdown",(e=>{e.preventDefault(),e.stopPropagation()}),!0),(0,l.ZP)("layer-settings-name").addEventListener("blur",this.changeName,!1),(0,l.ZP)("layer-settings-name").addEventListener("keydown",(e=>{"Enter"===e.key&&(e.currentTarget.blur(),this.hideSettings())}),!0),(0,l.ZP)("layer-settings-close").addEventListener("click",this.hideSettings,!1),(0,l.ZP)("layer-settings-blend-mode").addEventListener("change",this.changeBlendMode,!1),(0,l.ZP)("layer-settings-visible-false").addEventListener("click",this.changeVisible,!1),(0,l.ZP)("layer-settings-visible-true").addEventListener("click",this.changeVisible,!1),(0,l.ZP)("layer-settings-locked-false").addEventListener("click",this.changeLocked,!1),(0,l.ZP)("layer-settings-locked-true").addEventListener("click",this.changeLocked,!1),(0,l.ZP)("layer-settings-merge-down").addEventListener("click",(()=>this.stage.mergeDown()),!1),(0,l.ZP)("layer-settings-merge-visible").addEventListener("click",(()=>this.stage.mergeVisible()),!1),(0,l.ZP)("layer-settings-merge-flatten").addEventListener("click",(()=>this.stage.mergeFlatten()),!1),(0,l.ZP)("layer-panel-add-frame").addEventListener("click",this.addLayerChoice,!0),(0,l.ZP)("layer-panel-add-text").addEventListener("click",this.addLayerChoice,!0),(0,l.ZP)("layer-panel-add-image").addEventListener("click",this.addLayerChoice,!0),(0,l.ZP)("layer-panel-add-shape").addEventListener("click",this.addLayerChoice,!0),(0,l.ZP)("layer-panel-add-empty").addEventListener("click",this.addLayerChoice,!0),this.opacity=new o.Z("layer-settings-opacity",{defaultValue:1,label:(0,i.Z)("opacity"),labelFormat:e=>(100*e).toFixed(0),labelParse:e=>parseInt(e,10)/100,onChange:e=>{this.stage.fresco.getLayerById(this.settingsId).settings.opacity=e,document.dispatchEvent(new CustomEvent("viewport-render"))},onEnd:(e,t)=>{this.stamp=(new Date).getTime();let s=this.stage.fresco.getLayerById(this.settingsId);this.stage.history.add({type:"layerSettings",kind:"opacity",layer:s,settings:Object.assign(Object.assign({},s.settings),{opacity:t})})}}),new c.Z((0,l.ZP)("layer-panel-content")),(0,l.ZP)("layer-panel-content").oncontextmenu=e=>{e.preventDefault(),this.toggleSettings(e)},(0,l.ZP)("layer-minimize").addEventListener("pointerdown",(e=>{e.stopPropagation(),(0,l.ZP)("layer-panel").classList.toggle("collapse")}),!0),(0,l.ZP)("layer-close").addEventListener("pointerdown",(e=>{e.stopPropagation(),document.dispatchEvent(new CustomEvent("panel-state",{detail:"layer-panel"}))}),!0);const s=(0,l.T)("img",{id:"layer-panel-resize",src:"/img/icon/three-dot.svg",className:"resize ic"});(0,l.Rg)(s,this.resizeStart,this.resizeMove),this.panel.append(s),(0,l.Rg)((0,l.ZP)("layer-panel-title"),this.dragStart,this.dragMove,this.dragEnd)}}},9250:(e,t,s)=>{s.d(t,{Z:()=>r});var i=s(3655),a=s(3947),n=s(6817),o=s(3673);class r{constructor(e,t){this.stage=e,this.active=t,this.isMouseDown=!1,this.dragStart=e=>{this.p=e,this.d=new o.Z(this.panel.offsetLeft,this.panel.offsetTop)},this.dragMove=e=>{this.panel.style.left=Math.round(this.d.x+(e.x-this.p.x))+"px",this.panel.style.top=Math.round(this.d.y+(e.y-this.p.y))+"px"},this.dragEnd=e=>{let t=Math.round(this.d.y+(e.y-this.p.y)),s=Math.round(this.d.x+(e.x-this.p.x));t<76&&(t=76),s<0&&(s=0),s+120>(0,a.ZP)("workspace").offsetWidth&&(s=(0,a.ZP)("workspace").offsetWidth-240),this.panel.style.left=s+"px",this.panel.style.top=t+"px"},this.activate=e=>{this.panel.classList.toggle("active",e),e&&this.panel.classList.remove("collapse"),this.active=e,this.render()},this.render=()=>{if(!this.active||this.isMouseDown||!this.stage||!this.stage.fresco||this.stage.supressRender)return;this.viewport=n.Z.bestFit(this.stage.fresco.width,this.stage.fresco.height,140,120),this.scale=this.viewport.width/this.stage.fresco.width,this.nav.style.width=this.viewport.width+2+"px",this.nav.style.height=this.viewport.height+2+"px",this.back.width=this.viewport.width,this.back.height=this.viewport.height;var e=this.back.getContext("2d");e.imageSmoothingEnabled=!0,e.imageSmoothingQuality="high";let t=this.stage.getOutputCanvas(this.scale);t&&t.width>0&&t.height>0&&e.drawImage(t,0,0),this.position()},this.position=()=>{if(this.active&&this.stage){let e=this.viewport.width,t=this.viewport.height,s=0,i=0;e=Math.round(this.back.width*(this.stage.canvas.width/(this.stage.fresco.width*this.stage.zoom))),t=Math.round(this.back.height*(this.stage.canvas.height/(this.stage.fresco.height*this.stage.zoom))),s=-Math.round((this.stage.offset.x<0?this.stage.offset.x/this.stage.zoom:0)*this.scale),i=-Math.round((this.stage.offset.y<0?this.stage.offset.y/this.stage.zoom:0)*this.scale),this.marker.style.width=e+"px",this.marker.style.height=t+"px",this.marker.style.left=s+"px",this.marker.style.top=i+"px",this.setSelectionOrImageSize()}},this.mouseCord=e=>{if(!this.active||!this.stage.fresco)return;let t=e.detail;t&&this.stage&&t.x>-1&&t.y>-1&&t.x<this.stage.fresco.width&&t.y<this.stage.fresco.height?(this.navx.innerText=t.x.toString(),this.navy.innerText=t.y.toString()):(this.navx.innerText="",this.navy.innerText="")},this.setSelectionOrImageSize=()=>{this.stage.fresco.hasSelection()?(this.navw.innerText=this.stage.fresco.selection.bounds.width.toString(),this.navh.innerText=this.stage.fresco.selection.bounds.height.toString()):(this.navw.innerText=this.stage.fresco.width.toString(),this.navh.innerText=this.stage.fresco.height.toString())},this.backDown=e=>{e.stopPropagation();let t=this.back.getBoundingClientRect(),s=this.stage.fresco.width/this.back.width;this.stage.setAnchor(new o.Z(Math.round((e.clientX-t.x)*s),Math.round((e.clientY-t.y)*s))),this.stage.updateViewport()},this.touchStart=e=>{e.preventDefault(),e.stopPropagation(),this.down(e.changedTouches[0].clientX,e.changedTouches[0].clientY),document.addEventListener("touchmove",this.touchMove,{passive:!1}),document.addEventListener("touchend",this.touchEnd,{passive:!1})},this.touchMove=e=>{e.preventDefault(),e.stopPropagation(),this.move(e.changedTouches[0].clientX,e.changedTouches[0].clientY)},this.touchEnd=e=>{e.preventDefault(),e.stopPropagation(),this.up(e.changedTouches[0].clientX,e.changedTouches[0].clientY),document.removeEventListener("touchmove",this.touchMove),document.removeEventListener("touchend",this.touchEnd)},this.mouseDown=e=>{e.stopPropagation(),this.down(e.clientX,e.clientY),document.addEventListener("mousemove",this.mouseMove,!0),document.addEventListener("mouseup",this.mouseUp,!0)},this.mouseMove=e=>{e.stopPropagation(),this.move(e.clientX,e.clientY)},this.mouseUp=e=>{e.stopPropagation(),this.up(e.clientX,e.clientY),document.removeEventListener("mousemove",this.mouseMove,!0),document.removeEventListener("mouseup",this.mouseUp,!0)},this.down=(e,t)=>{this.isMouseDown=!0,this.downPoint=new o.Z(e,t),this.downPosition=new o.Z(this.marker.offsetLeft,this.marker.offsetTop)},this.move=(e,t)=>{let s=this.downPosition.x+(e-this.downPoint.x),a=this.downPosition.y+(t-this.downPoint.y),n=new o.Z(Math.round((s+this.marker.clientWidth/2)/this.scale),Math.round((a+this.marker.clientHeight/2)/this.scale));s=i.uZ(s,0,this.nav.clientWidth-this.marker.clientWidth-2),a=i.uZ(a,0,this.nav.clientHeight-this.marker.clientHeight-2),this.marker.style.left=s+"px",this.marker.style.top=a+"px",this.stage.setAnchor(n),this.stage.updateViewport()},this.up=(e,t)=>{this.isMouseDown=!1},this.panel=(0,a.ZP)("navigator-panel"),this.panel.classList.toggle("active",t),this.viewport=new n.Z,this.nav=(0,a.ZP)("zoom-nav"),this.back=(0,a.ZP)("zoom-nav-back"),this.marker=(0,a.ZP)("zoom-nav-marker"),this.navx=(0,a.ZP)("nav-cord-x"),this.navy=(0,a.ZP)("nav-cord-y"),this.navw=(0,a.ZP)("nav-size-w"),this.navh=(0,a.ZP)("nav-size-h"),this.marker.addEventListener("mousedown",this.mouseDown,!1),this.marker.addEventListener("touchstart",this.touchStart,{passive:!1}),this.back.addEventListener("mousedown",this.backDown,!1),(0,a.ZP)("zoom-out").addEventListener("click",(()=>this.stage.setZoomStep(!1)),!1),(0,a.ZP)("zoom-in").addEventListener("click",(()=>this.stage.setZoomStep(!0)),!1),(0,a.ZP)("zoom-input").addEventListener("input",(()=>{const e=Number.parseFloat((0,a.ZP)("zoom-input").value.replace("%",""))/100;e>0&&this.stage.setZoom(e.toString())}),!1),(0,a.ZP)("zoom-input").addEventListener("blur",(()=>{(0,a.ZP)("zoom-input").value=Math.round(100*this.stage.zoom)+"%"}),!1),(0,a.ZP)("zoom-slider").addEventListener("input",(()=>{let e=Number.parseFloat((0,a.ZP)("zoom-slider").value),t=1;t=e<=40?.1+e/40*.9:e<=75?1+(e-40)/35*4:5+(e-75)/25*45,this.stage.setZoom(t.toString())}),!1),document.addEventListener("zoom-change",(()=>{(0,a.ZP)("zoom-input")!==document.activeElement&&((0,a.ZP)("zoom-input").value=Math.round(100*this.stage.zoom)+"%");let e=this.stage.zoom,t=(0,a.ZP)("zoom-slider");t.value=e<=1?Math.round(40*(e-.1)).toString():e<=5?Math.round(40+(e-1)/4*35).toString():Math.round(75+(e-5)/45*25).toString()})),(0,a.ZP)("navigator-minimize").addEventListener("pointerdown",(e=>{e.stopPropagation(),(0,a.ZP)("navigator-panel").classList.toggle("collapse")}),!0),(0,a.ZP)("navigator-close").addEventListener("pointerdown",(e=>{e.stopPropagation(),document.dispatchEvent(new CustomEvent("panel-state",{detail:"navigator-panel"}))}),!0),document.addEventListener("mouse-cord",this.mouseCord),document.addEventListener("viewport-update",this.render),document.addEventListener("layer-list-render",this.render),(0,a.Rg)((0,a.ZP)("navigator-panel-title"),this.dragStart,this.dragMove,this.dragEnd)}}},8198:(e,t,s)=>{s.d(t,{Z:()=>o});var i=s(3947),a=s(3673),n=s(9924);class o{constructor(e){this.web=e,this.resize=()=>{this.bar.style.left=this.web.stage.raster.offsetLeft+"px",this.bar.style.width=this.web.stage.raster.offsetWidth+"px"},this.render=()=>{if(this.tabs.innerHTML="",this.web.stage.showTabs){this.bar.style.display="block",this.resize();for(let e=0;e<this.web.stage.tabs.length;e++){const t=this.web.stage.tabs[e].fresco;if(this.web.stage.fresco&&t.id===this.web.stage.fresco.id){const e=(0,i.T)("li",{id:t.id,title:t.name,className:"active"},t.name,(0,i.T)("img",{className:"close ic",width:10,height:10,src:"/img/icon/close.svg",onclick:()=>{this.web.tabClose(t.id)}}));this.tabs.appendChild(e)}else{let e;const s=(0,i.T)("li",{id:t.id,title:t.name,onclick:()=>this.web.tabSelect(t.id),onmouseenter:()=>{this.web.stage.layerDrag&&!this.web.stage.layerDrag.blocked&&(s.classList.add("countup"),e=window.setTimeout((()=>this.web.tabSelect(t.id)),300))},onmouseleave:()=>{window.clearTimeout(e),e=void 0,s.classList.remove("countup")}},t.name,(0,i.T)("img",{className:"close ic",src:"/img/icon/close.svg",width:10,height:10,onclick:()=>this.web.tabClose(t.id)}));this.tabs.appendChild(s)}}}else this.bar.style.display="none"},this.tabs=(0,i.T)("ul",{id:"tabs"}),this.bar=(0,i.T)("div",{id:"tab-bar"},this.tabs,(0,i.T)("div",{id:"tabs-drop"},(0,i.T)("img",{src:"/img/icon/tabs.svg",className:"ic",width:18,height:18,loading:"lazy"}))),(0,i.ZP)("workspace").appendChild(this.bar),this.bar.style.display="none",(0,i.ZP)("tabs-drop").addEventListener("click",(e=>{e.preventDefault(),e.stopPropagation();const t=e.currentTarget.getBoundingClientRect(),s=new Array;for(let i=0;i<this.web.stage.tabs.length;i++){const e=this.web.stage.tabs[i].fresco;s.push(new n.Z(e.name,(()=>this.web.tabSelect(e.id))))}new n.C(new a.Z(t.x+25,t.y+16),s,!0)})),document.addEventListener("fresco-select",this.render),document.addEventListener("resize",this.resize)}}},6670:(e,t,s)=>{s.d(t,{CF:()=>c,Ef:()=>h,Zn:()=>o,qC:()=>l,te:()=>r});var i=s(3947),a=s(6548);const n={AF:"Afghanistan",AX:"land Islands",AL:"Albania",DZ:"Algeria",AS:"American Samoa",AD:"Andorra",AO:"Angola",AI:"Anguilla",AQ:"Antarctica",AG:"Antigua and Barbuda",AR:"Argentina",AM:"Armenia",AW:"Aruba",AU:"Australia",AT:"Austria",AZ:"Azerbaijan",BS:"Bahamas",BH:"Bahrain",BD:"Bangladesh",BB:"Barbados",BY:"Belarus",BE:"Belgium",BZ:"Belize",BJ:"Benin",BM:"Bermuda",BT:"Bhutan",BO:"Bolivia",BQ:"Bonaire, Sint Eustatius and Saba",BA:"Bosnia and Herzegovina",BW:"Botswana",BV:"Bouvet Island",BR:"Brazil",IO:"British Indian Ocean Territory",BN:"Brunei Darussalam",BG:"Bulgaria",BF:"Burkina Faso",BI:"Burundi",KH:"Cambodia",CM:"Cameroon",CA:"Canada",CV:"Cape Verde",KY:"Cayman Islands",CF:"Central African Republic",TD:"Chad",CL:"Chile",CN:"China",CX:"Christmas Island",CC:"Cocos (Keeling) Islands",CO:"Colombia",KM:"Comoros",CG:"Congo, Republic of the (Brazzaville)",CD:"Congo, the Democratic Republic of the (Kinshasa)",CK:"Cook Islands",CR:"Costa Rica",CI:"Cte d'Ivoire, Republic of",HR:"Croatia",CU:"Cuba",CW:"Curaao",CY:"Cyprus",CZ:"Czech Republic",DK:"Denmark",DJ:"Djibouti",DM:"Dominica",DO:"Dominican Republic",EC:"Ecuador",EG:"Egypt",SV:"El Salvador",GQ:"Equatorial Guinea",ER:"Eritrea",EE:"Estonia",ET:"Ethiopia",FK:"Falkland Islands (Islas Malvinas)",FO:"Faroe Islands",FJ:"Fiji",FI:"Finland",FR:"France",GF:"French Guiana",PF:"French Polynesia",TF:"French Southern and Antarctic Lands",GA:"Gabon",GM:"Gambia, The",GE:"Georgia",DE:"Germany",GH:"Ghana",GI:"Gibraltar",GR:"Greece",GL:"Greenland",GD:"Grenada",GP:"Guadeloupe",GU:"Guam",GT:"Guatemala",GG:"Guernsey",GN:"Guinea",GW:"Guinea-Bissau",GY:"Guyana",HT:"Haiti",HM:"Heard Island and McDonald Islands",VA:"Holy See (Vatican City)",HN:"Honduras",HK:"Hong Kong",HU:"Hungary",IS:"Iceland",IN:"India",ID:"Indonesia",IR:"Iran, Islamic Republic of",IQ:"Iraq",IE:"Ireland",IM:"Isle of Man",IL:"Israel",IT:"Italy",JM:"Jamaica",JP:"Japan",JE:"Jersey",JO:"Jordan",KZ:"Kazakhstan",KE:"Kenya",KI:"Kiribati",KP:"Korea, Democratic People's Republic of",KR:"Korea, Republic of",KW:"Kuwait",KG:"Kyrgyzstan",LA:"Laos",LV:"Latvia",LB:"Lebanon",LS:"Lesotho",LR:"Liberia",LY:"Libya",LI:"Liechtenstein",LT:"Lithuania",LU:"Luxembourg",MO:"Macao",MK:"Macedonia, Republic of",MG:"Madagascar",MW:"Malawi",MY:"Malaysia",MV:"Maldives",ML:"Mali",MT:"Malta",MH:"Marshall Islands",MQ:"Martinique",MR:"Mauritania",MU:"Mauritius",YT:"Mayotte",MX:"Mexico",FM:"Micronesia, Federated States of",MD:"Moldova",MC:"Monaco",MN:"Mongolia",ME:"Montenegro",MS:"Montserrat",MA:"Morocco",MZ:"Mozambique",MM:"Myanmar",NA:"Namibia",NR:"Nauru",NP:"Nepal",NL:"Netherlands",NC:"New Caledonia",NZ:"New Zealand",NI:"Nicaragua",NE:"Niger",NG:"Nigeria",NU:"Niue",NF:"Norfolk Island",MP:"Northern Mariana Islands",NO:"Norway",OM:"Oman",PK:"Pakistan",PW:"Palau",PS:"Palestine, State of",PA:"Panama",PG:"Papua New Guinea",PY:"Paraguay",PE:"Peru",PH:"Philippines",PN:"Pitcairn",PL:"Poland",PT:"Portugal",PR:"Puerto Rico",QA:"Qatar",RE:"Runion",RO:"Romania",RU:"Russian Federation",RW:"Rwanda",BL:"Saint Barthlemy",SH:"Saint Helena, Ascension and Tristan da Cunha",KN:"Saint Kitts and Nevis",LC:"Saint Lucia",MF:"Saint Martin",PM:"Saint Pierre and Miquelon",VC:"Saint Vincent and the Grenadines",WS:"Samoa",SM:"San Marino",ST:"Sao Tome and Principe",SA:"Saudi Arabia",SN:"Senegal",RS:"Serbia",SC:"Seychelles",SL:"Sierra Leone",SG:"Singapore",SX:"Sint Maarten (Dutch part)",SK:"Slovakia",SI:"Slovenia",SB:"Solomon Islands",SO:"Somalia",ZA:"South Africa",GS:"South Georgia and South Sandwich Islands",SS:"South Sudan",ES:"Spain",LK:"Sri Lanka",SD:"Sudan",SR:"Suriname",SZ:"Swaziland",SE:"Sweden",CH:"Switzerland",SY:"Syrian Arab Republic",TW:"Taiwan",TJ:"Tajikistan",TZ:"Tanzania, United Republic of",TH:"Thailand",TL:"Timor-Leste",TG:"Togo",TK:"Tokelau",TO:"Tonga",TT:"Trinidad and Tobago",TN:"Tunisia",TR:"Turkey",TM:"Turkmenistan",TC:"Turks and Caicos Islands",TV:"Tuvalu",UG:"Uganda",UA:"Ukraine",AE:"United Arab Emirates",GB:"United Kingdom",US:"United States",UM:"United States Minor Outlying Islands",UY:"Uruguay",UZ:"Uzbekistan",VU:"Vanuatu",VE:"Venezuela, Bolivarian Republic of",VN:"Viet Nam",VG:"Virgin Islands, British",VI:"Virgin Islands, U.S.",WF:"Wallis and Futuna",EH:"Western Sahara",YE:"Yemen",ZM:"Zambia",ZW:"Zimbabwe"},o=["AT","BE","BG","HR","CY","CZ","DK","EE","FI","FR","DE","GR","HU","IE","IT","LV","LT","LU","MT","NL","PL","PT","RO","SK","SI","ES","SE","GB"],r=()=>({I:{},COUNTRY:"US",COUNTRIES:n,COUNTRIES_EU:o}),h=async()=>{try{const e=await fetch("/api/geoip/"),t=await e.json();return t.registered_country.iso_code}catch(e){return"US"}},l=async(e,t={},s="POST",a=!1)=>{try{const n={"Content-Type":"application/json"};a&&(n.Authorization=`Bearer ${(0,i.pR)("__pat","")}`);const o=await fetch(e,{method:s,headers:n,body:JSON.stringify(t)});return await o.json()}catch(n){return console.log(n),{status:!1}}},c=(e="success",t="common-ServerError",s=3,i={})=>{const n=document.createElement("div");let o=t?(0,a.Z)(t):"danger"==e?(0,a.Z)("common-ServerError"):(0,a.Z)("common-success");i.email&&(o=o.replace("{email}",i.email)),n.id="dialog-box",n.classList.add("toast",e),n.innerHTML=`\n        <span><img src="/images/icon/${e}_alert.png" /></span>\n        <span class="toast-text">${o}</span>\n        <span class="toast-close ${e}" onclick="this.parentElement.style.display = 'none'">&times;</span>\n    `,document.body.append(n),setTimeout((()=>document.getElementById("dialog-box").remove()),1e3*s)}},6854:(e,t,s)=>{s.d(t,{k:()=>h});var i=s(6548),a=s(3947),n=s(3655),o=s(1281),r=s(6670);(0,r.te)();class h{constructor(e="register",t={method:"popup"}){this.setContent=async(e,t)=>{var s;let i="";switch(e){case"register":i=await this.Form.register();break;case"login":i=this.Form.login();break;case"forgotPassword":i=this.Form.forgotPassword();break;case"setPassword":this.loadCaptcha(),i=this.Form.resetPassword(!0),this.renderCaptcha();break;case"resetPassword":this.loadCaptcha(),i=this.Form.resetPassword(),this.renderCaptcha();break;case"verification":i=this.Form.verification(null!==(s=t.verify)&&void 0!==s?s:"verification");break;case"agreements":i=await this.Form.agreements();break;case"socialAgreements":i=await this.Form.agreements(!0);break;case"changePassword":i=this.Form.changePassword();break;case"changeEmail":i=this.Form.changeEmail();break;case"changeUsername":i=this.Form.changeUsername((0,a.ZP)("change-name").dataset.name);break;case"deleteAccount":const e=(0,a.ZP)("delete-account").dataset.name||"User";i=this.Form.deleteAccount(e);break;case"deleteAccountConfirmation":i=this.Form.deleteAccountConfirmation(t.reason)}this.content.innerHTML=i,this.setFooter(e)},this.setFooter=e=>{switch(this.footer.style.display="block",e){case"login":this.footer.innerHTML=`${(0,i.Z)("common-notMember")} &nbsp; <a class="anchor" id="load-register">${(0,i.Z)("common-signUpNow")}</a>`;break;case"register":this.footer.innerHTML=`${(0,i.Z)("common-alreadyMember")} &nbsp; <a class="anchor" id="load-login">${(0,i.Z)("common-loginHere")}</a>`;break;case"forgotPassword":this.footer.innerHTML=`<a class="anchor back" id="entry-back">&#10094; &nbsp; ${(0,i.Z)("common-back")}</a>`,(0,a.ZP)("entry-back").onclick=()=>this.loadForm("login");break;case"resetPassword":this.footer.innerHTML=`<a class="anchor back" id="entry-back">&#10094; &nbsp; ${(0,i.Z)("common-back")}</a>`,(0,a.ZP)("entry-back").onclick=()=>this.loadForm("forgotPassword");break;default:return this.footer.innerHTML="",void(this.footer.style.display="none")}},this.position=()=>{this.dialog.style.left=Math.round((this.holder.offsetWidth-this.dialog.offsetWidth)/2)+"px",this.dialog.style.top=Math.round((this.holder.offsetHeight-this.dialog.offsetHeight)/2)+"px";let e=this.dialog.getBoundingClientRect(),t=this.holder.getBoundingClientRect();e.bottom>t.bottom&&(this.dialog.style.top=t.height-e.height<0?"0px":t.height-e.height+"px"),e.right>t.right&&(this.dialog.style.left=t.width-e.width<0?"0px":t.width-e.width+"px"),this.dialog.offsetTop<0&&(this.dialog.style.top="0px"),this.dialog.offsetLeft<0&&(this.dialog.style.left="0px")},this.keyDown=e=>{"Escape"!==e.key&&"Esc"!==e.key||this.cleanUp()},this.cleanUp=()=>{var e,t;document.removeEventListener("keydown",this.keyDown,!1),null===(e=this.holder)||void 0===e||e.remove(),this.holder=null,null===(t=this.dialog)||void 0===t||t.remove(),this.dialog=null},this.loadForm=async(e,t={})=>{var s,i,n,o,r,h,l,c,d,u,p,g;if(this.form=e,await this.setContent(e,t),"agreements"!==e&&"socialAgreements"!==e||"popup"!==this.options.method?this.dialog.classList.remove("agreements"):this.dialog.classList.add("agreements"),"popup"===this.options.method&&this.position(),null===(s=(0,a.ZP)("entry-form"))||void 0===s||s.addEventListener("submit",(e=>{this.submitForm((0,a.ZP)("entry-form").dataset.entry,e)})),"register"!==this.form&&"resetPassword"!==this.form||(null===(i=(0,a.ZP)("entry-password"))||void 0===i||i.addEventListener("focus",(()=>{this.passwordMeter("show",(0,a.ZP)("entry-password"))})),null===(n=(0,a.ZP)("entry-password"))||void 0===n||n.addEventListener("input",(()=>{this.updatePasswordMeter((0,a.ZP)("entry-password"))}))),"setPassword"===this.form&&(t.email=(0,a.ZP)("set-password").dataset.email),"resetPassword"!==this.form&&"setPassword"!==this.form||((0,a.ZP)("entry-email").value=t.email),"agreements"===this.form&&this.agreementsRenderer(),(0,a.ZP)("entry-to-email")){const e=(0,a.ZP)("entry-to-email").dataset.text.replace("[EMAIL]",t.email);(0,a.ZP)("entry-to-email").innerHTML=e}(0,a.ZP)("verification-email")&&((0,a.ZP)("verification-email").value=t.email),(0,a.ZP)("entry-resend")&&(clearTimeout(this.resendCodeTimeouts),this.resendCodeTimeouts=setTimeout((()=>{(0,a.ZP)("entry-resend").classList.remove("hide")}),3e4),null===(o=(0,a.ZP)("entry-resend"))||void 0===o||o.addEventListener("click",(()=>this.resendCode(t.email)))),[(0,a.ZP)("entry-readAgreements"),(0,a.ZP)("entry-above16")].forEach((e=>{null==e||e.addEventListener("change",(()=>this.verifyAgreements()))})),null===(r=(0,a.ZP)("entry-email"))||void 0===r||r.addEventListener("keyup",(()=>{this.validateInputTimer("email")})),null===(h=(0,a.ZP)("entry-email"))||void 0===h||h.addEventListener("blur",(()=>{this.validateInput((0,a.ZP)("entry-email"),"","email")})),null===(l=(0,a.ZP)("entry-cancel"))||void 0===l||l.addEventListener("click",(()=>this.cleanUp())),null===(c=(0,a.ZP)("load-register"))||void 0===c||c.addEventListener("click",(()=>this.loadForm("register"))),null===(d=(0,a.ZP)("load-login"))||void 0===d||d.addEventListener("click",(()=>this.loadForm("login"))),null===(u=(0,a.ZP)("load-forgotPassword"))||void 0===u||u.addEventListener("click",(()=>this.loadForm("forgotPassword"))),null===(p=(0,a.ZP)("toggle-password"))||void 0===p||p.addEventListener("click",(()=>this.togglePassword())),null===(g=(0,a.ZP)("toggle-password-2"))||void 0===g||g.addEventListener("click",(()=>this.togglePassword("toggle-password-2","entry-password-new"))),Array.from(document.getElementsByClassName("social-button")).forEach((e=>{e.addEventListener("click",(()=>{this.loadSocialLogin(e.dataset.social)}))}))},this.loadSocialLogin=async e=>{if("apple"===e){const e=await new Promise(((e,t)=>{let s=document.createElement("script");s.type="text/javascript",s.crossOrigin="anonymous",s.src="https://appleid.cdn-apple.com/appleauth/static/jsapi/appleid/1/en_US/appleid.auth.js",document.body.appendChild(s),s.onload=function(){e(AppleID?AppleID.auth:null)},s.onerror=function(){t("Failed to load apple auth script")}}));e&&(e.init({clientId:"com.pixlr.web",scope:"name email",redirectURI:new URL(location.href).origin+"/auth/apple/callback",state:location.href,nonce:"",usePopup:!1}),e.signIn())}else{const t=window.location.origin;window.location.href=`${t}/auth/${e}?callbackUrl=${window.location.href}`}},this.togglePassword=(e="toggle-password",t="entry-password")=>{const s=(0,a.ZP)(e),i=(0,a.ZP)(t);"text"===i.type?(i.type="password",s.src="/img/icon/eye-hide.svg"):(i.type="text",s.src="/img/icon/eye-show.svg")},this.passwordMeter=(e="show",t)=>{if("show"==e&&t){const e=(0,a.ZP)(t.id),s=(0,a.ZP)(t.id).nextElementSibling;e.classList.remove("invalid"),s.style.display="none"}(0,a.ZP)("password-meter").style.display="show"==e?"flex":"none"},this.updatePasswordMeter=e=>{let t=(0,a.ZP)("password-meter"),s=(0,a.ZP)("password-meter").classList.value.replace(" ",","),i=0;switch(e.value.match(/[a-z]/)&&i++,e.value.match(/[A-Z]/)&&i++,e.value.match(/\d/)&&i++,e.value.match(/[!@#$%&*?'"~_./+\-|()^`:;<>,]/)&&i++,e.value.length<8&&0!==i&&(i=0),i){case 0:t.classList.replace(s,"none");break;case 1:t.classList.replace(s,"weak");break;case 2:t.classList.replace(s,"soso");break;case 3:t.classList.replace(s,"good");break;case 4:t.classList.replace(s,"great")}},this.validateInput=(e,t,s)=>{let a=!1;if(t||(t=e.value),"email"===s)t.match(/^[^\s@]+@[^\s@]+\.[^\s@]+$/)?(e.classList.remove("invalid"),e.nextElementSibling.style.display="none"):(a=!0,e.classList.add("invalid"),e.nextElementSibling.style.display="block");else if("password"===s){const s=e.nextElementSibling;t.length<8||t.length>50?(a=!0,e.classList.add("invalid"),s.style.display="block",t.length<8?s.innerHTML=(0,i.Z)("common-MinPassword"):t.length>50&&(s.innerHTML=(0,i.Z)("common-MaxPassword"))):(e.classList.remove("invalid"),s.style.display="none")}else if("code"===s){const s=e.nextElementSibling;6!==t.length?(e.classList.add("invalid"),s.style.display="block",a=!0):(e.classList.remove("invalid"),s.style.display="none"),setTimeout((()=>{e.classList.remove("invalid"),s.style.display="none"}),3e3)}return!a},this.validateInputTimer=e=>{this.validationTimer[e]&&clearTimeout(this.validationTimer[e]),this.validationTimer[e]=setTimeout((()=>this.validateInput((0,a.ZP)(`entry-${e}`),"",e)),1e3)},this.verifyAgreements=()=>{const e=(0,a.ZP)("entry-readAgreements"),t=(0,a.ZP)("entry-above16");this.enableAgreementButton(!(!e.checked||!t.checked))},this.enableAgreementButton=e=>{const t=(0,a.ZP)("entry-submit");e?(t.disabled=!1,t.classList.remove("disable")):(t.disabled=!0,t.classList.add("disable"))},this.agreementsRenderer=()=>{"CA"===this.registerData.country&&((0,a.ZP)("entry-newsletter").checked=!1),r.Zn.some((e=>e===this.registerData.country))&&((0,a.ZP)("entry-above16").parentElement.classList.remove("hide"),(0,a.ZP)("entry-recommendations").parentElement.classList.add("hide"),(0,a.ZP)("entry-readAgreements").parentElement.classList.remove("hide"),this.enableAgreementButton(!1))},this.loadCaptcha=()=>{let e=document.createElement("script");e.id="recaptcha-js-api",e.defer=!0,e.src="https://www.google.com/recaptcha/api.js",document.getElementsByTagName("head")[0].appendChild(e)},this.renderCaptcha=()=>{this.captcha=void 0;const e=window.location.href.includes("localhost")?"6LeBQzcaAAAAAPwVny3IG23_fY_FasFVKXvQG9qB":"6LcqBEsaAAAAAF-JcOUzRtVKASZt5b-EMITWxEJf";setTimeout((()=>{this.captcha=grecaptcha.render((0,a.ZP)("recaptcha"),{sitekey:e})}),500)},this.getFormInput=()=>{const e={},t=(0,a.ZP)("entry-form");return Array.from(t.getElementsByTagName("input")).map((t=>{"checkbox"==t.type?e[t.name]=t.checked:e[t.name]=t.value})),Array.from(t.getElementsByTagName("select")).map((t=>{e[t.name]=t.value})),e},this.submitForm=async(e,t)=>{switch(t.preventDefault(),e){case"login":this.loginHandler();break;case"register":this.registerHandler();break;case"agreements":this.agreementsHandler(t.submitter?t.submitter.dataset.option:t.target.dataset.option);break;case"socialAgreements":this.socialAgreementsHandler(t.submitter?t.submitter.dataset.option:t.target.dataset.option);break;case"verification":this.verificationHandler();break;case"forgotPassword":this.forgotPasswordHandler();break;case"setPassword":this.passwordResetHandler(!0);break;case"resetPassword":this.passwordResetHandler();break;case"changeEmail":this.changeEmailHandler();break;case"changeEmailVerification":this.changeEmailVerificationHandler();break;case"changePassword":this.changePasswordHandler();break;case"changeUsername":this.changeUsernameHandler();break;case"deleteAccount":this.deleteAccountHandler();break;case"deleteAccountConfirmation":this.deleteAccountConfirmationHandler()}},this.loginHandler=async()=>{const e=this.getFormInput(),t=this.validateInput((0,a.ZP)("entry-email"),e.email,"email"),s=this.validateInput((0,a.ZP)("entry-password"),e.password,"password");if(!t||!s)return;(0,a.ZP)("entry-submit").innerHTML='\n            <img src="/images/myaccount/loading.gif" alt="loading" style="margin-top:12px;">\n        ';const i=await(0,r.qC)("/auth/login",e);if(i.status)if((0,a.ZP)("entry-submit").innerHTML='<img src="/images/license/green_tick.svg" class="checkmark" alt="green tick icon">',this.callbackUrl){const e=decodeURIComponent(this.callbackUrl).split("#")[0];window.location.href=e}else window.location.reload();else i.verify?(this.loadForm("verification",{email:e.email}),(0,r.CF)("danger",i.message,5)):((0,a.ZP)("entry-submit").innerText="Login",(0,r.CF)("danger",i.message,5))},this.registerHandler=async()=>{this.registerData=this.getFormInput();const e=this.validateInput((0,a.ZP)("entry-email"),this.registerData.email,"email"),t=this.validateInput((0,a.ZP)("entry-password"),this.registerData.password,"password");e&&t&&this.loadForm("agreements")},this.agreementsHandler=async e=>{if("refuse"===e)return this.cleanUp();const t=this.getFormInput();Object.assign(t,this.registerData);const s=await(0,r.qC)("/auth/register",t);if(!s.status)return(0,r.CF)("danger",s.message,5),void this.loadForm("register");this.loadForm("verification",{email:t.email})},this.socialAgreementsHandler=async e=>{if("refuse"===e)return this.cleanUp();const t=new URLSearchParams(window.location.search),s=t.get("social"),i=await(0,r.Ef)(),a=this.getFormInput();a.country=i;const n=await(0,r.qC)(`/auth/${s}/register`,a);n.status||(0,r.CF)("danger",n.message,5),t.has("redirectUrl")?window.location.href=t.get("redirectUrl"):window.location.href=window.location.pathname},this.verificationHandler=async()=>{const e=this.getFormInput(),t=await(0,r.qC)("/auth/verify",e);if(!t.status)return(0,r.CF)("danger",t.message,5);(0,r.CF)("success",t.message,5),this.cleanUp(),setTimeout((()=>{if(this.callbackUrl){const e=decodeURIComponent(this.callbackUrl).split("#")[0];window.location.href=e}else window.location.reload()}),1e3)},this.forgotPasswordHandler=async()=>{const e=this.getFormInput();if(!this.validateInput((0,a.ZP)("entry-email"),e.email,"email"))return;e.resend=!1;const t=await(0,r.qC)("/auth/request/code/",e);if(!t.status)return(0,r.CF)("danger",t.message,5);(0,r.CF)("success",t.message,5,{email:e.email}),this.loadForm("resetPassword",{email:e.email})},this.passwordResetHandler=async(e=!1)=>{const t=grecaptcha.getResponse(this.captcha);if(grecaptcha.reset(this.captcha),!t)return(0,r.CF)("danger","Please complete the CAPTCHA!",3);const s=this.getFormInput();s.token=t;const i=this.validateInput((0,a.ZP)("entry-email"),s.email,"email"),n=this.validateInput((0,a.ZP)("entry-password"),s.password,"password"),o=this.validateInput((0,a.ZP)("entry-code"),s.code,"code");if(!i||!n||!o)return;const h=await(0,r.qC)("/auth/reset",s);if(!h.status)return(0,r.CF)("danger",h.message,5);(0,r.CF)("success",h.message,5),this.cleanUp(),setTimeout((()=>{e?window.location.href="/logout":window.location.reload()}),1e3)},this.resendCode=async e=>{(0,a.ZP)("entry-resend").classList.add("hide"),this.resendCodeTimeouts=setTimeout((()=>{(0,a.ZP)("entry-resend").classList.remove("hide")}),3e4);const t=await(0,r.qC)("/auth/request/code/",{email:e,resend:!0});if(!t.status)return(0,r.CF)("danger",t.message,5);(0,r.CF)("success",t.message,5,{email:e})},this.changeEmailHandler=async()=>{const e=this.getFormInput();if(!this.validateInput((0,a.ZP)("entry-email"),e.email,"email"))return;const t=await(0,r.qC)("/auth/changeemail/request",{newEmail:e.email});if(!t.status)return(0,r.CF)("danger",t.message);this.loadForm("verification",{email:e.email,verify:"changeEmailVerification"}),(0,r.CF)("success",t.message,5,{email:e.email})},this.changeEmailVerificationHandler=async()=>{const e=this.getFormInput();e.newEmail=e.email;if(!this.validateInput((0,a.ZP)("entry-code"),e.code,"code"))return;const t=await(0,r.qC)("/auth/changeemail/verify",e);if(!t.status)return(0,r.CF)("danger",t.message,5);(0,r.CF)("success",t.message,5),setTimeout((()=>{window.location.replace(`/logout?callbackUrl=${window.location.href}`)}),1e3)},this.changePasswordHandler=async()=>{const e=this.getFormInput(),t=this.validateInput((0,a.ZP)("entry-password"),e.password,"password"),s=this.validateInput((0,a.ZP)("entry-password-new"),e["new-password"],"password");if(!t||!s)return;const i=await(0,r.qC)("/auth/changepassword",{oldPassword:e.password,newPassword:e["new-password"]},"PUT");if(!i.status)return(0,r.CF)("danger",i.message,5);(0,r.CF)("success",i.message,5),setTimeout((()=>{window.location.replace(`/logout?callbackUrl=${window.location.href}`)}),2e3)},this.changeUsernameHandler=async()=>{const e=this.getFormInput(),t=await(0,r.qC)("/myaccount/api/profile",e,"PUT",!0);if(!t.status)return(0,r.CF)("danger",t.message);(0,r.CF)("success",t.message),setTimeout((()=>window.location.reload()),500)},this.deleteAccountHandler=async()=>{const e=this.getFormInput();"leavingReasonDefault"!==e.reason&&this.loadForm("deleteAccountConfirmation",{reason:e.reason})},this.deleteAccountConfirmationHandler=async()=>{const e=this.getFormInput();if(!this.validateInput((0,a.ZP)("entry-password"),e.password,"password"))return;const t=await(0,r.qC)("/api/myaccount/profile",e,"DELETE",!0);if(!t.status)return(0,r.CF)("danger",t.message);window.location.href="/logout/"},this.Form=new o.Z,this.form=e,this.options=t,this.registerData={},this.validationTimer={},this.captcha={},t.callback&&(this.callbackUrl=t.callback),"popup"===this.options.method?(this.mid=(0,n.Zd)(),this.holder=(0,a.T)("div",{id:"entry-modal",className:"modal dim"}),document.body.appendChild(this.holder),this.dialog=(0,a.T)("div",{className:"entry pop"}),this.holder.appendChild(this.dialog),this.content=(0,a.T)("div",{className:"entry-content"}),this.footer=(0,a.T)("div",{id:"entry-footer"}),this.dialog.append((0,a.T)("img",{id:"popup-close"+this.mid,className:"close",src:"/img/icon/close-black.svg",onclick:()=>this.cleanUp()}),this.content,this.footer),document.addEventListener("keydown",this.keyDown,!1)):(this.dialog=this.options.holder,this.dialog.classList.add("entry"),this.content=(0,a.T)("div",{className:"entry-content"}),this.footer=(0,a.T)("div",{id:"entry-footer"}),this.dialog.append(this.content,this.footer)),"popup"===this.options.method&&this.position(),this.loadForm(e)}}},1281:(e,t,s)=>{s.d(t,{Z:()=>o});var i=s(6548),a=s(6670);const n=(0,a.te)();class o{constructor(){this.login=()=>`\n            <h1>${(0,i.Z)("common-login")}</h1>\n\n            \n        <div class="column space-between top-30">\n            <div class="social-button" data-social="google">\n                <img src="/images/icon/google.svg" alt="google">\n            </div>\n            <div class="social-button" data-social="facebook">\n                <img src="/images/icon/facebook.svg" alt="facebook">\n            </div>\n            <div class="social-button" data-social="apple">\n                <img src="/images/icon/apple_gray.svg" alt="apple">\n            </div>\n        </div>\n    \n            <div class="separator">${(0,i.Z)("OR")}</div>\n\n            <form id="entry-form" data-entry="login">\n                <div class="input-group">\n                    <label for="entry-email">${(0,i.Z)("common-email")}</label>\n                    <input type="text" name="email" id="entry-email">\n                    <p class="error-msg">${(0,i.Z)("common-enterValidEmail")}</p>\n                </div>\n                <div class="input-group">\n                    <label for="entry-password">${(0,i.Z)("common-password")}</label>\n                    <input type="password" name="password" id="entry-password">\n                    <p class="error-msg"></p>\n                    <img id="toggle-password" class="input-icon" src="/img/icon/eye-hide.svg">\n                </div>\n\n                <button type="submit" class="button big positive full top-40" id="entry-submit">${(0,i.Z)("common-login")}</button>\n                <div class="input-group inline space-between">\n                    <div class="inline">\n                        <input type="checkbox" id="entry-rememberMe" name="rememberMe"/>\n                        <label for="entry-rememberMe" class="custom-checkbox">${(0,i.Z)("common-rememberMe")}</label>\n                    </div>\n                    <div>\n                        <a class="anchor" id="load-forgotPassword">${(0,i.Z)("common-forgotPass")}</a>\n                    </div>\n                </div>\n            </form>\n        `,this.register=async()=>{let e="",t=!1;const s=await(0,a.Ef)();for(let i in n.COUNTRIES)t||"US"!==i&&s!=i?e+=`<option value="${i}">${n.COUNTRIES[i]}</option>`:(e+=`<option value="${i}" selected>${n.COUNTRIES[i]}</option>`,t=!0);return`\n            <h1>${(0,i.Z)("common-signUp")}</h1>\n\n            \n        <div class="column space-between top-30">\n            <div class="social-button" data-social="google">\n                <img src="/images/icon/google.svg" alt="google">\n            </div>\n            <div class="social-button" data-social="facebook">\n                <img src="/images/icon/facebook.svg" alt="facebook">\n            </div>\n            <div class="social-button" data-social="apple">\n                <img src="/images/icon/apple_gray.svg" alt="apple">\n            </div>\n        </div>\n    \n            <div class="separator">${(0,i.Z)("OR")}</div>\n\n            <form id="entry-form" data-entry="register">\n                <div class="input-group">\n                    <label for="entry-email">${(0,i.Z)("common-email")}</label>\n                    <input type="text" name="email" id="entry-email">\n                    <p class="error-msg">${(0,i.Z)("common-enterValidEmail")}</p>\n                </div>\n                <div class="input-group">\n                    <label for="entry-password">${(0,i.Z)("common-password")}</label>\n                    <input type="password" name="password" id="entry-password">\n                    <p class="error-msg"></p>\n                    <img id="toggle-password" class="input-icon" src="/img/icon/eye-hide.svg">\n                    <span id="password-meter" class="none">\n                        <span></span><span></span><span></span><span></span>\n                    </span>\n                </div>\n                <div class="input-group">\n                    <label for="country">${(0,i.Z)("common-country")}</label>\n                    <select name="country">\n                        ${e}\n                    </select>\n                </div>\n\n                <button type="submit" class="button big positive full top-40" style="margin-bottom: 20px">${(0,i.Z)("common-signUp")}</button>\n            </form>\n        `},this.forgotPassword=()=>`\n            <h1>${(0,i.Z)("common-forgotPass")}</h1>\n\n            <form id="entry-form" class="top-30" data-entry="forgotPassword">\n                <div class="input-group">\n                    <label for="entry-email">${(0,i.Z)("common-email")}</label>\n                    <input type="email" name="email" id="entry-email"/>\n                    <p class="error-msg">${(0,i.Z)("common-enterValidEmail")}</p>\n                </div>\n\n                <button type="submit" class="button big positive full top-40" id="load-verification">${(0,i.Z)("common-reqCode")}</button>\n            </form>\n        `,this.resetPassword=(e=!1)=>{const t=e?"setPassword":"resetPassword";return`\n            <h1>${e?(0,i.Z)("common-setPassword"):(0,i.Z)("common-resetPass")}</h1>\n\n            <form id="entry-form" class="top-30" data-entry="${t}">\n                <div class="input-group">\n                    <label for="entry-email">${(0,i.Z)("common-email")}</label>\n                    <input type="email" name="email" id="entry-email" readonly/>\n                    <p class="error-msg">${(0,i.Z)("common-enterValidEmail")}</p>\n                </div>\n                <div class="input-group">\n                    <label for="entry-password">${(0,i.Z)("common-newPass")}</label>\n                    <input type="password" name="password" id="entry-password">\n                    <p class="error-msg"></p>\n                    <img id="toggle-password" class="input-icon" src="/img/icon/eye-hide.svg">\n                    <span id="password-meter" class="none">\n                        <span></span><span></span><span></span><span></span>\n                    </span>\n                </div>\n                <div class="input-group">\n                    <label for="entry-code">${(0,i.Z)("common-code")}</label>\n                    <input type="number" name="code" id="entry-code" onkeypress="if(this.value.length===6)return false;">\n                    <p class="error-msg">${(0,i.Z)("common-enterValidCode")}</p>                    \n                </div>\n                \n                ${e?`<p class="top-10 text-center"><a class="anchor" id="entry-resend">${(0,i.Z)("common-SendResetCode")}</a></p>`:""}\n\n                <div id="recaptcha" style="padding-top: 5px"></div>\n                <button class="button big positive full">${(0,i.Z)("common-updatePass")}</button>\n                ${e?"":`<p class="top-10 hide text-center" id="entry-resend">${(0,i.Z)("common-didNotReceiveCode")} <a class="anchor">${(0,i.Z)("common-resend")}</a></p>`}\n            </form>\n        `},this.verification=e=>`\n            <h1>${(0,i.Z)("common-verifyAcc")}</h1>\n            <p id="entry-to-email" data-text="${(0,i.Z)("common-sentCodeDesc")}">${(0,i.Z)("common-sentCodeDesc")}</p>\n\n            <form id="entry-form" data-entry="${e}">\n                <input id="verification-email" type="hidden" name="email" readonly/>\n                <div class="input-group">\n                    <label for="code">${(0,i.Z)("common-code")}</label>\n                    <input type="number" name="code" id="entry-code" onkeypress="if(this.value.length===6)return false;">\n                    <p class="error-msg">${(0,i.Z)("common-enterValidCode")}</p>\n                </div>\n\n                <button type="submit" class="button big positive full top-20">${(0,i.Z)("common-verify")}</button>\n                <p class="top-20 hide text-center" id="entry-resend">${(0,i.Z)("common-didNotReceiveCode")} &nbsp; <a class="anchor">${(0,i.Z)("common-resend")}</a></p>\n            </form>\n        `,this.agreements=async(e=!1)=>{const t=await(async()=>{try{const e=await fetch("/api/agreement/");return await e.text()}catch(e){return""}})();return`\n            <h1 class="text-center">${(0,i.Z)("common-terms")}</h1>\n\n            <div class="agreements-wrapper">${t}</div>\n            <form id="entry-form" data-entry="${e?"socialAgreements":"agreements"}">\n                <div class="input-group checkbox-group inline">\n                    <input type="checkbox" id="entry-newsletter" name="newsletter" checked/>\n                    <label for="entry-newsletter" class="custom-checkbox">${(0,i.Z)("common-regNewsletter")}</label>\n                </div>\n                <div class="input-group checkbox-group inline">\n                    <input type="checkbox" id="entry-recommendations" name="recommendations" />\n                    <label for="entry-recommendations" class="custom-checkbox">${(0,i.Z)("common-regRecommendations")}</label>\n                </div>\n                <div class="input-group checkbox-group inline hide">\n                    <input type="checkbox" id="entry-above16" name="above16" />\n                    <label for="entry-above16" class="custom-checkbox">${(0,i.Z)("common-above16")}</label>\n                </div>\n                <div class="input-group checkbox-group inline hide">\n                    <input type="checkbox" id="entry-readAgreements" name="readAgreements" />\n                    <label for="entry-readAgreements" class="custom-checkbox">${(0,i.Z)("common-readAgreements")}</label>\n                </div>\n\n                <div class="input-group checkbox-group inline justify-center top-20">\n                    <button type="submit" data-option="refuse" class="button transparent">${(0,i.Z)("common-refuse")}</button>\n                    <button type="submit" id="entry-submit" data-option="agree" class="button big positive">${(0,i.Z)("common-agree")}</button>\n                </div>\n            </form>\n        `},this.changePassword=()=>`\n            <h1>${(0,i.Z)("common-changePassword")}</h1>\n            <form id="entry-form" class="top-30" data-entry="changePassword">\n                <div class="input-group">\n                    <label for="entry-password">${(0,i.Z)("common-oldPass")}</label>\n                    <input type="password" name="password" id="entry-password">\n                    <p class="error-msg"></p>\n                    <img id="toggle-password" class="input-icon" src="/img/icon/eye-hide.svg">\n                </div>\n                <div class="input-group">\n                    <label for="entry-password">${(0,i.Z)("common-newPass")}</label>\n                    <input type="password" name="new-password" id="entry-password-new">\n                    <p class="error-msg"></p>\n                    <img id="toggle-password-2" class="input-icon" src="/img/icon/eye-hide.svg">\n                    <span id="password-meter" class="none">\n                        <span></span><span></span><span></span><span></span>\n                    </span>\n                </div>\n                <button type="submit" class="button full top-20" style="margin-bottom: 20px">${(0,i.Z)("common-changePassword")}</button>\n            </form>\n        `,this.changeEmail=()=>`\n            <h1>${(0,i.Z)("common-changeEmail")}</h1>\n\n            <form id="entry-form" class="top-30" data-entry="changeEmail">\n                <div class="input-group">\n                    <label for="email">${(0,i.Z)("common-newEmail")}</label>\n                    <input type="text" name="email" id="entry-email">\n                    <p class="error-msg">${(0,i.Z)("common-EnterValidEmail")}</p>\n                </div>\n            \n                <button type="submit" class="button full top-20" style="margin-bottom: 20px">${(0,i.Z)("common-changeEmail")}</button>\n            </form>\n        `,this.changeUsername=(e="")=>`\n            <h1>${(0,i.Z)("changeUsername")}</h1>\n\n            <form id="entry-form" class="top-30" data-entry="changeUsername">\n                <div class="input-group">\n                    <label for="entry-username">${(0,i.Z)("newUsername")}</label>\n                    <input type="text" name="name" id="entry-username" value="${e}">\n                </div>\n\n                <button type="submit" class="button full top-20">${(0,i.Z)("update")}</button>\n            </form>\n        `,this.deleteAccount=e=>`\n            <h1>${(0,i.Z)("common-deleteMyAccount")}</h1>\n            <p class="top-20">Hey ${e},</p>\n            <p class="no-margin">${(0,i.Z)("common-sadToSeeYouGoWhyLeaving")}</p>\n\n            <form id="entry-form" data-entry="deleteAccount">\n                <div class="input-group">\n                    <label class="top-20 text-uppercase">${(0,i.Z)("common-leavingBecause")}</label>\n                    <select name="reason">\n                        <option value="leavingReasonDefault" disabled selected>${(0,i.Z)("common-leavingReasonDefault")}</option>\n                        <option value="leavingReasons1">${(0,i.Z)("common-leavingReasons1")}</option>\n                        <option value="leavingReasons2">${(0,i.Z)("common-leavingReasons2")}</option>\n                        <option value="leavingReasons3">${(0,i.Z)("common-leavingReasons3")}</option>\n                        <option value="leavingReasons4">${(0,i.Z)("common-leavingReasons4")}</option>\n                        <option value="leavingReasons5">${(0,i.Z)("common-leavingReasons5")}</option>\n                    <select>\n                </div>\n\n                <button type="submit" class="button full top-20" style="margin-bottom: 20px">${(0,i.Z)("common-deleteMyAccount")}</button>\n            </form>\n        `,this.deleteAccountConfirmation=(e="leavingReasonDefault")=>`\n            <h4 class="top-35 text-default">${(0,i.Z)("areYouSureYouWantToDelete")} </h4>\n            <p class="top-35">${(0,i.Z)("youCanStillChangeYourMind")} </p>\n\n            <form id="entry-form" data-entry="deleteAccountConfirmation">\n                <input type="hidden" name="reason" value="${e}">\n                <div class="input-group">\n                    <label for="entry-password">${(0,i.Z)("common-password")}</label>\n                    <input type="password" name="password" id="entry-password">\n                    <p class="error-msg"></p>\n                    <img id="toggle-password" class="input-icon" src="/img/icon/eye-hide.svg">\n                </div>\n\n                <div class="input-group checkbox-group inline justify-center" style="margin-top: 30px">\n                    <button type="submit" class="button small transparent">${(0,i.Z)("deleteMyAccount")}</button>\n                    <button class="button small positive" id="entry-cancel">${(0,i.Z)("cancel")}</button>\n                </div>\n            </form>\n        `}}},2982:(e,t,s)=>{s.a(e,(async(i,a)=>{try{var n,o=i([n=s(2646)]),[n]=o.then?(await o)():o;await s.v(t,e.id,"6e8beab9bcfa48b484e0",{"./pixlr_bg.js":{__wbindgen_string_new:n.h4,__wbg_x_84616b3462f445c9:n.bi,__wbg_y_3b1c131c2eb62473:n.lK,__wbg_width_5491bf1bf3b1e78a:n.gI,__wbg_height_28c0c13811abedde:n.mE,__wbindgen_memory:n.oH,__wbg_buffer_397eaa4d72ee94dd:n.jp,__wbg_newwithbyteoffsetandlength_8252bb2eb6e239b2:n.dZ,__wbindgen_object_drop_ref:n.ug,__wbg_new_de1f835fd3453d3d:n.MS,__wbindgen_throw:n.Or,__wbindgen_rethrow:n.nD}}),a()}catch(r){a(r)}}),1)}},l={};function c(e){var t=l[e];if(void 0!==t)return t.exports;var s=l[e]={id:e,loaded:!1,exports:{}};return h[e](s,s.exports,c),s.loaded=!0,s.exports}c.m=h,e="function"==typeof Symbol?Symbol("webpack queues"):"__webpack_queues__",t="function"==typeof Symbol?Symbol("webpack exports"):"__webpack_exports__",s="function"==typeof Symbol?Symbol("webpack error"):"__webpack_error__",i=e=>{e&&!e.d&&(e.d=1,e.forEach((e=>e.r--)),e.forEach((e=>e.r--?e.r++:e())))},c.a=(a,n,o)=>{var r;o&&((r=[]).d=1),r&&(r.moduleId=a.id);var h,l,c,d=new Set,u=a.exports,p=new Promise(((e,t)=>{c=t,l=e}));p[t]=u,p[e]=e=>(r&&e(r),d.forEach(e),p.catch((e=>{}))),p.moduleId=a.id,a.exports=p,n((a=>{var n;h=(a=>a.map((a=>{if(null!==a&&"object"==typeof a){if(a[e])return a;if(a.then){var n=[];n.d=0,a.then((e=>{o[t]=e,i(n)}),(e=>{o[s]=e,i(n)}));var o={};return o[e]=e=>e(n),o}}var r={};return r[e]=e=>{},r[t]=a,r})))(a);var o=()=>h.map((e=>{if(e[s])throw e[s];return e[t]})),l=new Promise((t=>{(n=()=>t(o)).r=0;var s=e=>e!==r&&!d.has(e)&&(d.add(e),e&&!e.d&&(n.r++,e.push(n)));h.map((t=>t[e](s)))}));return n.r?l:o()}),(e=>(e?c(p[s]=e):l(u),i(r)))),r&&(r.d=0)},c.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return c.d(t,{a:t}),t},n=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,c.t=function(e,t){if(1&t&&(e=this(e)),8&t)return e;if("object"==typeof e&&e){if(4&t&&e.__esModule)return e;if(16&t&&"function"==typeof e.then)return e}var s=Object.create(null);c.r(s);var i={};a=a||[null,n({}),n([]),n(n)];for(var o=2&t&&e;"object"==typeof o&&!~a.indexOf(o);o=n(o))Object.getOwnPropertyNames(o).forEach((t=>i[t]=()=>e[t]));return i.default=()=>e,c.d(s,i),s},c.d=(e,t)=>{for(var s in t)c.o(t,s)&&!c.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},c.f={},c.e=e=>Promise.all(Object.keys(c.f).reduce(((t,s)=>(c.f[s](e,t),t)),[])),c.u=e=>(({155:"ffmpeg",200:"gif",215:"native",346:"infill",500:"pdf-lib",556:"tiff",600:"adyen"}[e]||e)+"."+{30:"c09c5a95167a042a7289",126:"d9c3d8c8052cf6f45542",132:"aa314f020245f43ef712",155:"0504991b2012ff8a26c8",184:"9e639613adaa4a4b34e6",200:"9f856c0e6828dab009a4",215:"9438b49ea7cd56b92a63",250:"91b2833de2b5caa97de1",251:"cedbf54a78c2a5b69ad1",289:"92967676bcc7eb9c965d",304:"932be47fccde4cb565c1",312:"2cc2557536b872355335",316:"387876773281b1dad94d",346:"fbcd17bafcc07e9ffb1c",382:"149eaca6c7cd1a96ea96",391:"fefe7ba625e4f5756dcd",392:"1308fa47b160c4b93ad6",432:"555921f9d9464f9a0297",495:"9cc63b318311e7aaeb74",496:"cd264056835aeae218d8",500:"2b528a9d09058a33661b",501:"5b3fdd03e21ee0ca7678",513:"a31d579d7131151a02bc",556:"092e9694c7af0e9c7051",562:"73b292bc0298a468eacd",600:"2c29bd4b833e192d8350",630:"dca33d53b9f75cac1ad8",633:"c255182816b983add412",638:"f867b0df2d63a6b15a69",886:"04c4e19a2291ef041213",905:"bded37b59f54f7b2243c",977:"a1dc33b897dba8d280e6"}[e]+".js"),c.miniCssF=e=>{},c.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),c.hmd=e=>((e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e),c.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o={},r="pixlr:",c.l=(e,t,s,i)=>{if(o[e])o[e].push(t);else{var a,n;if(void 0!==s)for(var h=document.getElementsByTagName("script"),l=0;l<h.length;l++){var d=h[l];if(d.getAttribute("src")==e||d.getAttribute("data-webpack")==r+s){a=d;break}}a||(n=!0,(a=document.createElement("script")).charset="utf-8",a.timeout=120,c.nc&&a.setAttribute("nonce",c.nc),a.setAttribute("data-webpack",r+s),a.src=e),o[e]=[t];var u=(t,s)=>{a.onerror=a.onload=null,clearTimeout(p);var i=o[e];if(delete o[e],a.parentNode&&a.parentNode.removeChild(a),i&&i.forEach((e=>e(s))),t)return t(s)},p=setTimeout(u.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=u.bind(null,a.onerror),a.onload=u.bind(null,a.onload),n&&document.head.appendChild(a)}},c.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},c.v=(e,t,s,i)=>{var a=fetch(c.p+""+s+".module.wasm");return"function"==typeof WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(a,i).then((t=>Object.assign(e,t.instance.exports))):a.then((e=>e.arrayBuffer())).then((e=>WebAssembly.instantiate(e,i))).then((t=>Object.assign(e,t.instance.exports)))},c.p="/dist/",(()=>{c.b=document.baseURI||self.location.href;var e={979:0,215:0,132:0};c.f.j=(t,s)=>{var i=c.o(e,t)?e[t]:void 0;if(0!==i)if(i)s.push(i[2]);else{var a=new Promise(((s,a)=>i=e[t]=[s,a]));s.push(i[2]=a);var n=c.p+c.u(t),o=new Error;c.l(n,(s=>{if(c.o(e,t)&&(0!==(i=e[t])&&(e[t]=void 0),i)){var a=s&&("load"===s.type?"missing":s.type),n=s&&s.target&&s.target.src;o.message="Loading chunk "+t+" failed.\n("+a+": "+n+")",o.name="ChunkLoadError",o.type=a,o.request=n,i[1](o)}}),"chunk-"+t,t)}};var t=(t,s)=>{var i,a,[n,o,r]=s,h=0;if(n.some((t=>0!==e[t]))){for(i in o)c.o(o,i)&&(c.m[i]=o[i]);if(r)r(c)}for(t&&t(s);h<n.length;h++)a=n[h],c.o(e,a)&&e[a]&&e[a][0](),e[a]=0},s=self.webpackChunkpixlr=self.webpackChunkpixlr||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))})(),c.nc=void 0;c(2360)})();